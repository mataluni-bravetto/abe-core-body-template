"use strict";var tf=(()=>{var vc=(r=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(r,{get:(e,t)=>(typeof require<"u"?require:e)[t]}):r)(function(r){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+r+'" is not supported')});var Vr=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);var Cw=Vr(()=>{});var Xo=Vr(D=>{"use strict";function SM(r,e){return e.forEach(function(t){t&&typeof t!="string"&&!Array.isArray(t)&&Object.keys(t).forEach(function(n){if(n!=="default"&&!(n in r)){var a=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(r,n,a.get?a:{enumerable:!0,get:function(){return t[n]}})}})}),r}var zd=function(r,e){return zd=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},zd(r,e)};function Ii(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");zd(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function $e(r,e,t,n){function a(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function s(l){try{c(n.next(l))}catch(f){o(f)}}function u(l){try{c(n.throw(l))}catch(f){o(f)}}function c(l){l.done?i(l.value):a(l.value).then(s,u)}c((n=n.apply(r,e||[])).next())})}function We(r,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(c){return function(l){return u([c,l])}}function u(c){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,a&&(i=c[0]&2?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[c[0]&2,i.value]),c[0]){case 0:case 1:i=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,a=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){t.label=c[1];break}if(c[0]===6&&t.label<i[1]){t.label=i[1],i=c;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(c);break}i[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(r,t)}catch(l){c=[6,l],a=0}finally{n=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function Ur(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function ke(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=n.next()).done;)i.push(a.value)}catch(s){o={error:s}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return i}function pt(r,e,t){if(t||arguments.length===2)for(var n=0,a=e.length,i;n<a;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return r.concat(i||Array.prototype.slice.call(e))}var EM=1e-7,TM=1e-4,NM=(function(){function r(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}return r.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)},r.prototype.set=function(e,t){this.dataIdsCount++,this.data.set(e,t)},r.prototype.has=function(e){return this.data.has(e)},r.prototype.delete=function(e){return this.dataIdsCount--,this.data.delete(e)},r.prototype.numDataIds=function(){return this.dataIdsCount},r})(),Yw=(function(){function r(){}return r.prototype.refCount=function(e){return In("refCount")},r.prototype.incRef=function(e){return In("incRef")},r.prototype.timerAvailable=function(){return!0},r.prototype.time=function(e){return In("time")},r.prototype.read=function(e){return In("read")},r.prototype.readSync=function(e){return In("readSync")},r.prototype.readToGPU=function(e,t){return In("readToGPU")},r.prototype.numDataIds=function(){return In("numDataIds")},r.prototype.disposeData=function(e,t){return In("disposeData")},r.prototype.write=function(e,t,n){return In("write")},r.prototype.move=function(e,t,n,a,i){return In("move")},r.prototype.createTensorFromGPUData=function(e,t,n){return In("createTensorFromGPUData")},r.prototype.memory=function(){return In("memory")},r.prototype.floatPrecision=function(){return In("floatPrecision")},r.prototype.epsilon=function(){return this.floatPrecision()===32?EM:TM},r.prototype.dispose=function(){return In("dispose")},r})();function In(r){throw new Error("'".concat(r,"' not yet implemented or not found in the registry. ")+"This kernel may not be supported by the tfjs backend you have chosen")}function Zw(r){for(var e=r.length,t=0;e>0;)t=Math.random()*e|0,e--,Df(r,e,t)}function IM(r,e){if(r.length!==e.length)throw new Error("Array sizes must match to be shuffled together "+"First array length was ".concat(r.length)+"Second array length was ".concat(e.length));for(var t=r.length,n=0;t>0;)n=Math.random()*t|0,t--,Df(r,t,n),Df(e,t,n)}function kc(r,e,t){return Math.max(r,Math.min(e,t))}function CM(r){return r%2===0?r:r+1}function Df(r,e,t){var n=r[e];r[e]=r[t],r[t]=n}function AM(r){for(var e=0,t=0;t<r.length;t++)e+=r[t];return e}function DM(r,e){var t=Math.random();return e*t+(1-t)*r}function _M(r,e){for(var t=0,n=0;n<r.length;n++){var a=Number(r[n])-Number(e[n]);t+=a*a}return t}function W(r,e){if(!r)throw new Error(typeof e=="string"?e:e())}function sn(r,e,t){t===void 0&&(t=""),W(Ci(r,e),function(){return t+" Shapes ".concat(r," and ").concat(e," must match")})}function Ho(r){W(r!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function Dt(r){if(r.length===0)return 1;for(var e=r[0],t=1;t<r.length;t++)e*=r[t];return e}function FM(r){return r.length===0}function Jw(r,e){if(r===e)return!0;if(r==null||e==null||r.length!==e.length)return!1;for(var t=0;t<r.length;t++)if(r[t]!==null&&e[t]!==null&&r[t]!==e[t])return!1;return!0}function Ci(r,e){if(r===e)return!0;if(r==null||e==null||r.length!==e.length)return!1;for(var t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}function tu(r){return r%1===0}function RM(r){if(Math.tanh!=null)return Math.tanh(r);if(r===1/0)return 1;if(r===-1/0)return-1;var e=Math.exp(2*r);return(e-1)/(e+1)}function OM(r){var e=Math.ceil(Math.sqrt(r));return[e,Math.ceil(r/e)]}function PM(r){for(var e=new Uint32Array(r),t=0;t<r;++t)e[t]=t;return Zw(e),e}function bc(r,e){return e<=r.length?r:r+" ".repeat(e-r.length)}function MM(r,e,t,n){return e===void 0&&(e=function(a){return 0}),new Promise(function(a,i){var o=0,s=function(){if(r()){a();return}o++;var u=e(o);if(t!=null&&o>=t){i();return}n!=null?n(s,u):setTimeout(s,u)};s()})}function BM(r,e){for(var t=1,n=-1,a=0;a<r.length;++a)if(r[a]>=0)t*=r[a];else if(r[a]===-1){if(n!==-1)throw Error("Shapes can only have 1 implicit size. "+"Found -1 at dim ".concat(n," and dim ").concat(a));n=a}else if(r[a]<0)throw Error("Shapes can not be < 0. Found ".concat(r[a]," at dim ").concat(a));if(n===-1){if(e>0&&e!==t)throw Error("Size(".concat(e,") must match the product of shape ").concat(r));return r}if(t===0)throw Error("Cannot infer the missing size in [".concat(r,"] when ")+"there are 0 elements");if(e%t!==0)throw Error("The implicit shape can't be a fractional number. "+"Got ".concat(e," / ").concat(t));var i=r.slice();return i[n]=e/t,i}function Bc(r,e){var t=e.length;return r=r==null?e.map(function(n,a){return a}):[].concat(r),W(r.every(function(n){return n>=-t&&n<t}),function(){return"All values in axis param must be in range [-".concat(t,", ").concat(t,") but ")+"got axis ".concat(r)}),W(r.every(function(n){return tu(n)}),function(){return"All values in axis param must be integers but "+"got axis ".concat(r)}),r.map(function(n){return n<0?t+n:n})}function Qw(r,e){for(var t=[],n=[],a=e!=null&&Array.isArray(e)&&e.length===0,i=e==null||a?null:Bc(e,r).sort(),o=0,s=0;s<r.length;++s){if(i!=null){if(i[o]===s&&r[s]!==1)throw new Error("Can't squeeze axis ".concat(s," since its dim '").concat(r[s],"' is not 1"));(i[o]==null||i[o]>s)&&r[s]===1&&(t.push(r[s]),n.push(s)),i[o]<=s&&o++}r[s]!==1&&(t.push(r[s]),n.push(s))}return{newShape:t,keptDims:n}}function e1(r,e){return fv(r,e)}function fv(r,e){var t=null;if(r==null||r==="float32")t=new Float32Array(e);else if(r==="int32")t=new Int32Array(e);else if(r==="bool")t=new Uint8Array(e);else if(r==="string")t=new Array(e);else throw new Error("Unknown data type ".concat(r));return t}function t1(r,e){for(var t=0;t<r.length;t++){var n=r[t];if(isNaN(n)||!isFinite(n))throw Error("A tensor of type ".concat(e," being uploaded contains ").concat(n,"."))}}function r1(r){return r==="bool"||r==="complex64"||r==="float32"||r==="int32"||r==="string"}function LM(r,e){return!(e==="complex64"||e==="float32"&&r!=="complex64"||e==="int32"&&r!=="float32"&&r!=="complex64"||e==="bool"&&r==="bool")}function _f(r){if(r==="float32"||r==="int32")return 4;if(r==="complex64")return 8;if(r==="bool")return 1;throw new Error("Unknown dtype ".concat(r))}function n1(r){if(r==null)return 0;var e=0;return r.forEach(function(t){return e+=t.length}),e}function ji(r){return typeof r=="string"||r instanceof String}function a1(r){return typeof r=="boolean"}function i1(r){return typeof r=="number"}function Lc(r){return Array.isArray(r)?Lc(r[0]):r instanceof Float32Array?"float32":r instanceof Int32Array||r instanceof Uint8Array||r instanceof Uint8ClampedArray?"int32":i1(r)?"float32":ji(r)?"string":a1(r)?"bool":"float32"}function Ji(r){return!!(r&&r.constructor&&r.call&&r.apply)}function Ff(r,e){for(var t=e;t<r;++t)if(r%t===0)return t;return r}function iu(r){var e=r.length;if(e<2)return[];var t=new Array(e-1);t[e-2]=r[e-1];for(var n=e-3;n>=0;--n)t[n]=t[n+1]*r[n+1];return t}function o1(r,e,t,n){n===void 0&&(n=!1);var a=new Array;if(e.length===1)for(var i=e[0]*(n?2:1),o=0;o<i;o++)a[o]=t[r+o];else for(var i=e[0],s=e.slice(1),u=s.reduce(function(l,f){return l*f})*(n?2:1),o=0;o<i;o++)a[o]=o1(r+o*u,s,t,n);return a}function Xs(r,e,t){if(t===void 0&&(t=!1),r.length===0)return e[0];var n=r.reduce(function(a,i){return a*i})*(t?2:1);if(n===0)return[];if(n!==e.length)throw new Error("[".concat(r,"] does not match the input size ").concat(e.length).concat(t?" for a complex tensor":"","."));return o1(0,r,e,t)}function zM(r,e){if(Array.isArray(r))return r;if(e==="float32")return r instanceof Float32Array?r:new Float32Array(r);if(e==="int32")return r instanceof Int32Array?r:new Int32Array(r);if(e==="bool"||e==="string")return Uint8Array.from(new Int32Array(r));throw new Error("Unknown dtype ".concat(e))}function hv(r,e){for(var t=Vf(r,e),n=0;n<t.length;n++)t[n]=1;return t}function Vf(r,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool")return new Uint8Array(r);throw new Error("Unknown data type ".concat(e))}function $M(r,e){var t=r.reduce(function(n,a){return n*a},1);if(e==null||e==="float32")return Xs(r,new Float32Array(t));if(e==="int32")return Xs(r,new Int32Array(t));if(e==="bool")return Xs(r,new Uint8Array(t));throw new Error("Unknown data type ".concat(e))}function Dn(r){r.forEach(function(e){W(Number.isInteger(e)&&e>=0,function(){return"Tensor must have a shape comprised of positive integers but got "+"shape [".concat(r,"].")})})}function WM(r,e,t){if(e===0)return 0;if(e===1)return r[0];for(var n=r[r.length-1],a=0;a<r.length-1;++a)n+=t[a]*r[a];return n}function GM(r,e,t){if(e===0)return[];if(e===1)return[r];for(var n=new Array(e),a=0;a<n.length-1;++a)n[a]=Math.floor(r/t[a]),r-=n[a]*t[a];return n[n.length-1]=r,n}function Uf(r){return r&&r.then&&typeof r.then=="function"}var Aw="tfjsflags",s1=(function(){function r(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=VM,this.populateURLFlags()}return r.prototype.setPlatform=function(e,t){this.platform!=null&&(st().getBool("IS_TEST")||st().getBool("PROD")||console.warn("Platform ".concat(this.platformName," has already been set. ")+"Overwriting the platform with ".concat(e,"."))),this.platformName=e,this.platform=t},r.prototype.registerFlag=function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},this.urlFlags[e]!=null){var a=this.urlFlags[e];st().getBool("IS_TEST")||st().getBool("PROD")||console.warn("Setting feature override from URL ".concat(e,": ").concat(a,".")),this.set(e,a)}},r.prototype.getAsync=function(e){return $e(this,void 0,void 0,function(){var t,n;return We(this,function(a){switch(a.label){case 0:return e in this.flags?[2,this.flags[e]]:(t=this.flags,n=e,[4,this.evaluateFlag(e)]);case 1:return t[n]=a.sent(),[2,this.flags[e]]}})})},r.prototype.get=function(e){if(e in this.flags)return this.flags[e];var t=this.evaluateFlag(e);if(Uf(t))throw new Error("Flag ".concat(e," cannot be synchronously evaluated. ")+"Please use getAsync() instead.");return this.flags[e]=t,this.flags[e]},r.prototype.getNumber=function(e){return this.get(e)},r.prototype.getBool=function(e){return this.get(e)},r.prototype.getString=function(e){return this.get(e)},r.prototype.getFlags=function(){return this.flags},Object.defineProperty(r.prototype,"features",{get:function(){return this.flags},enumerable:!1,configurable:!0}),r.prototype.set=function(e,t){if(this.flagRegistry[e]==null)throw new Error("Cannot set flag ".concat(e," as it has not been registered."));this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)},r.prototype.evaluateFlag=function(e){if(this.flagRegistry[e]==null)throw new Error("Cannot evaluate flag '".concat(e,"': no evaluation function found."));return this.flagRegistry[e].evaluationFn()},r.prototype.setFlags=function(e){this.flags=Object.assign({},e)},r.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},r.prototype.populateURLFlags=function(){var e=this;if(!(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")){var t=this.getQueryParams(this.global.location.search);if(Aw in t){var n=t[Aw].split(",");n.forEach(function(a){var i=ke(a.split(":"),2),o=i[0],s=i[1];e.urlFlags[o]=HM(o,s)})}}},r})();function VM(r){var e={};return r.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(t){for(var n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];return UM(e,n[0],n[1]),n.join("=")}),e}function UM(r,e,t){r[decodeURIComponent(e)]=decodeURIComponent(t||"")}function HM(r,e){var t=e.toLowerCase();return t==="true"||t==="false"?t==="true":"".concat(+t)===t?+t:e}function st(){return D.ENV}D.ENV=null;function qM(r){D.ENV=r}var Rd;function u1(){if(Rd==null){var r=void 0;if(typeof window<"u")r=window;else if(typeof global<"u")r=global;else if(typeof process<"u")r=process;else if(typeof self<"u")r=self;else throw new Error("Could not find a global object");Rd=r}return Rd}function KM(){var r=u1();return r._tfGlobals==null&&(r._tfGlobals=new Map),r._tfGlobals}function pv(r,e){var t=KM();if(t.has(r))return t.get(r);var n=e();return t.set(r,n),t.get(r)}var c1="Abs",l1="Acos",f1="Acosh",dv="Add",h1="AddN",p1="All",d1="Any",v1="ArgMax",m1="ArgMin",g1="Asin",y1="Asinh",b1="Atan",w1="Atanh",x1="Atan2",k1="AvgPool",jM="AvgPoolGrad",S1="AvgPool3D",XM="AvgPool3DGrad",E1="BatchMatMul",T1="BatchToSpaceND",N1="Bincount",I1="BitwiseAnd",YM="BroadcastTo",C1="BroadcastArgs",vv="Cast",A1="Ceil",D1="ClipByValue",_1="Complex",F1="ComplexAbs",R1="Concat",O1="Conv2D",P1="Conv2DBackpropFilter",M1="Conv2DBackpropInput",B1="Conv3D",ZM="Conv3DBackpropFilterV2",L1="Conv3DBackpropInputV2",z1="Cos",$1="Cosh",W1="Cumprod",G1="Cumsum",V1="CropAndResize",U1="DenseBincount",H1="DepthToSpace",q1="DepthwiseConv2dNative",K1="DepthwiseConv2dNativeBackpropFilter",j1="DepthwiseConv2dNativeBackpropInput",X1="Diag",Y1="Dilation2D",JM="Dilation2DBackpropInput",QM="Dilation2DBackpropFilter",mv="Draw",Z1="RealDiv",J1="Einsum",Q1="Elu",eB="EluGrad",ex="Erf",tx="Equal",rx="Exp",nx="ExpandDims",ax="Expm1",ix="FFT",ox="Fill",sx="FlipLeftRight",ux="Floor",cx="FloorDiv",lx="FusedBatchNorm",fx="GatherV2",hx="GatherNd",px="Greater",dx="GreaterEqual",gv="Identity",vx="IFFT",mx="Imag",gx="IsFinite",yx="IsInf",bx="IsNan",wx="LeakyRelu",xx="Less",kx="LessEqual",Sx="LinSpace",Ex="Log",Tx="Log1p",Nx="LogicalAnd",Ix="LogicalNot",Cx="LogicalOr",tB="LogicalXor",rB="LogSoftmax",nB="LowerBound",Ax="LRN",aB="LRNGrad",iB="MatrixBandPart",Dx="Max",_x="Maximum",Fx="MaxPool",oB="MaxPoolGrad",Rx="MaxPool3D",sB="MaxPool3DGrad",Ox="MaxPoolWithArgmax",Px="Mean",Mx="Min",Bx="Minimum",Lx="MirrorPad",zx="Mod",$x="Multinomial",Wx="Multiply",Gx="Neg",Vx="NotEqual",Ux="NonMaxSuppressionV3",Hx="NonMaxSuppressionV4",qx="NonMaxSuppressionV5",Kx="OnesLike",jx="OneHot",Xx="Pack",Yx="PadV2",uB="Pool",Zx="Pow",Jx="Prelu",Qx="Prod",ek="RaggedGather",tk="RaggedRange",rk="RaggedTensorToTensor",nk="Range",ak="Real",ik="Reciprocal",ok="Relu",sk="Reshape",uk="ResizeNearestNeighbor",cB="ResizeNearestNeighborGrad",ck="ResizeBilinear",lB="ResizeBilinearGrad",lk="Relu6",fk="Reverse",hk="Round",pk="Rsqrt",dk="ScatterNd",vk="TensorScatterUpdate",mk="SearchSorted",gk="Select",yk="Selu",bk="Slice",wk="Sin",xk="Sinh",kk="Sign",Sk="Sigmoid",Ek="Softplus",Tk="Sqrt",Nk="Sum",Ik="SpaceToBatchND",Ck="SplitV",Ak="Softmax",Dk="SparseFillEmptyRows",_k="SparseReshape",Fk="SparseSegmentMean",Rk="SparseSegmentSum",Ok="SparseToDense",Pk="SquaredDifference",fB="Square",Mk="StaticRegexReplace",Bk="StridedSlice",Lk="StringNGrams",zk="StringSplit",$k="StringToHashBucketFast",Wk="Sub",Gk="Tan",Vk="Tanh",yv="Tile",Uk="TopK",Hk="Transform",Nf="Transpose",qk="Unique",Kk="Unpack",jk="UnsortedSegmentSum",hB="UpperBound",Xk="ZerosLike",Yk="Step",$d="FromPixels",Zk="RotateWithOffset",Wd="_FusedMatMul",Gd="FusedConv2D",Vd="FusedDepthwiseConv2D";function Ki(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];st().getBool("IS_TEST")||st().getBool("PROD")||console.warn.apply(console,pt([],ke(r),!1))}function pB(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];st().getBool("IS_TEST")||st().getBool("PROD")||console.log.apply(console,pt([],ke(r),!1))}var ru=pv("kernelRegistry",function(){return new Map}),Sc=pv("gradRegistry",function(){return new Map});function Ec(r,e){var t=bv(r,e);return ru.get(t)}function Ud(r){return Sc.get(r)}function Rf(r){for(var e=ru.entries(),t=[];;){var n=e.next(),a=n.done,i=n.value;if(a)break;var o=ke(i,2),s=o[0],u=o[1],c=ke(s.split("_"),1),l=c[0];l===r&&t.push(u)}return t}function Jk(r){var e=r.kernelName,t=r.backendName,n=bv(e,t);ru.has(n)&&Ki("The kernel '".concat(e,"' for backend ")+"'".concat(t,"' is already registered")),ru.set(n,r)}function dB(r){var e=r.kernelName;Sc.has(e)&&st().getBool("DEBUG")&&Ki("Overriding the gradient for '".concat(e,"'")),Sc.set(e,r)}function vB(r,e){var t=bv(r,e);if(!ru.has(t))throw new Error("The kernel '".concat(r,"' for backend ")+"'".concat(e,"' is not registered"));ru.delete(t)}function mB(r){if(!Sc.has(r))throw new Error("The gradient '".concat(r,"' for backend is not registered"));Sc.delete(r)}function gB(r,e){var t=Rf(r);t.forEach(function(n){var a=Object.assign({},n,{backendName:e});Jk(a)})}function bv(r,e){return"".concat(e,"_").concat(r)}function Qk(r){return r instanceof Float32Array||r instanceof Int32Array||r instanceof Uint8Array||r instanceof Uint8ClampedArray}var qo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function yB(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var e2=zt,la=null;try{la=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function zt(r,e,t){this.low=r|0,this.high=e|0,this.unsigned=!!t}zt.prototype.__isLong__;Object.defineProperty(zt.prototype,"__isLong__",{value:!0});function _n(r){return(r&&r.__isLong__)===!0}zt.isLong=_n;var Dw={},_w={};function Ko(r,e){var t,n,a;return e?(r>>>=0,(a=0<=r&&r<256)&&(n=_w[r],n)?n:(t=$t(r,(r|0)<0?-1:0,!0),a&&(_w[r]=t),t)):(r|=0,(a=-128<=r&&r<128)&&(n=Dw[r],n)?n:(t=$t(r,r<0?-1:0,!1),a&&(Dw[r]=t),t))}zt.fromInt=Ko;function fa(r,e){if(isNaN(r))return e?Po:ha;if(e){if(r<0)return Po;if(r>=t2)return a2}else{if(r<=-Rw)return Cn;if(r+1>=Rw)return n2}return r<0?fa(-r,e).neg():$t(r%nu|0,r/nu|0,e)}zt.fromNumber=fa;function $t(r,e,t){return new zt(r,e,t)}zt.fromBits=$t;var Of=Math.pow;function wv(r,e,t){if(r.length===0)throw Error("empty string");if(r==="NaN"||r==="Infinity"||r==="+Infinity"||r==="-Infinity")return ha;if(typeof e=="number"?(t=e,e=!1):e=!!e,t=t||10,t<2||36<t)throw RangeError("radix");var n;if((n=r.indexOf("-"))>0)throw Error("interior hyphen");if(n===0)return wv(r.substring(1),e,t).neg();for(var a=fa(Of(t,8)),i=ha,o=0;o<r.length;o+=8){var s=Math.min(8,r.length-o),u=parseInt(r.substring(o,o+s),t);if(s<8){var c=fa(Of(t,s));i=i.mul(c).add(fa(u))}else i=i.mul(a),i=i.add(fa(u))}return i.unsigned=e,i}zt.fromString=wv;function $a(r,e){return typeof r=="number"?fa(r,e):typeof r=="string"?wv(r,e):$t(r.low,r.high,typeof e=="boolean"?e:r.unsigned)}zt.fromValue=$a;var Fw=65536,bB=1<<24,nu=Fw*Fw,t2=nu*nu,Rw=t2/2,Ow=Ko(bB),ha=Ko(0);zt.ZERO=ha;var Po=Ko(0,!0);zt.UZERO=Po;var js=Ko(1);zt.ONE=js;var r2=Ko(1,!0);zt.UONE=r2;var Hd=Ko(-1);zt.NEG_ONE=Hd;var n2=$t(-1,2147483647,!1);zt.MAX_VALUE=n2;var a2=$t(-1,-1,!0);zt.MAX_UNSIGNED_VALUE=a2;var Cn=$t(0,-2147483648,!1);zt.MIN_VALUE=Cn;var De=zt.prototype;De.toInt=function(){return this.unsigned?this.low>>>0:this.low};De.toNumber=function(){return this.unsigned?(this.high>>>0)*nu+(this.low>>>0):this.high*nu+(this.low>>>0)};De.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Cn)){var t=fa(e),n=this.div(t),a=n.mul(t).sub(this);return n.toString(e)+a.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var i=fa(Of(e,6),this.unsigned),o=this,s="";;){var u=o.div(i),c=o.sub(u.mul(i)).toInt()>>>0,l=c.toString(e);if(o=u,o.isZero())return l+s;for(;l.length<6;)l="0"+l;s=""+l+s}};De.getHighBits=function(){return this.high};De.getHighBitsUnsigned=function(){return this.high>>>0};De.getLowBits=function(){return this.low};De.getLowBitsUnsigned=function(){return this.low>>>0};De.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Cn)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return this.high!=0?t+33:t+1};De.isZero=function(){return this.high===0&&this.low===0};De.eqz=De.isZero;De.isNegative=function(){return!this.unsigned&&this.high<0};De.isPositive=function(){return this.unsigned||this.high>=0};De.isOdd=function(){return(this.low&1)===1};De.isEven=function(){return(this.low&1)===0};De.equals=function(e){return _n(e)||(e=$a(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};De.eq=De.equals;De.notEquals=function(e){return!this.eq(e)};De.neq=De.notEquals;De.ne=De.notEquals;De.lessThan=function(e){return this.comp(e)<0};De.lt=De.lessThan;De.lessThanOrEqual=function(e){return this.comp(e)<=0};De.lte=De.lessThanOrEqual;De.le=De.lessThanOrEqual;De.greaterThan=function(e){return this.comp(e)>0};De.gt=De.greaterThan;De.greaterThanOrEqual=function(e){return this.comp(e)>=0};De.gte=De.greaterThanOrEqual;De.ge=De.greaterThanOrEqual;De.compare=function(e){if(_n(e)||(e=$a(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};De.comp=De.compare;De.negate=function(){return!this.unsigned&&this.eq(Cn)?Cn:this.not().add(js)};De.neg=De.negate;De.add=function(e){_n(e)||(e=$a(e));var t=this.high>>>16,n=this.high&65535,a=this.low>>>16,i=this.low&65535,o=e.high>>>16,s=e.high&65535,u=e.low>>>16,c=e.low&65535,l=0,f=0,h=0,p=0;return p+=i+c,h+=p>>>16,p&=65535,h+=a+u,f+=h>>>16,h&=65535,f+=n+s,l+=f>>>16,f&=65535,l+=t+o,l&=65535,$t(h<<16|p,l<<16|f,this.unsigned)};De.subtract=function(e){return _n(e)||(e=$a(e)),this.add(e.neg())};De.sub=De.subtract;De.multiply=function(e){if(this.isZero())return ha;if(_n(e)||(e=$a(e)),la){var t=la.mul(this.low,this.high,e.low,e.high);return $t(t,la.get_high(),this.unsigned)}if(e.isZero())return ha;if(this.eq(Cn))return e.isOdd()?Cn:ha;if(e.eq(Cn))return this.isOdd()?Cn:ha;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(Ow)&&e.lt(Ow))return fa(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,a=this.high&65535,i=this.low>>>16,o=this.low&65535,s=e.high>>>16,u=e.high&65535,c=e.low>>>16,l=e.low&65535,f=0,h=0,p=0,d=0;return d+=o*l,p+=d>>>16,d&=65535,p+=i*l,h+=p>>>16,p&=65535,p+=o*c,h+=p>>>16,p&=65535,h+=a*l,f+=h>>>16,h&=65535,h+=i*c,f+=h>>>16,h&=65535,h+=o*u,f+=h>>>16,h&=65535,f+=n*l+a*c+i*u+o*s,f&=65535,$t(p<<16|d,f<<16|h,this.unsigned)};De.mul=De.multiply;De.divide=function(e){if(_n(e)||(e=$a(e)),e.isZero())throw Error("division by zero");if(la){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?la.div_u:la.div_s)(this.low,this.high,e.low,e.high);return $t(t,la.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Po:ha;var n,a,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Po;if(e.gt(this.shru(1)))return r2;i=Po}else{if(this.eq(Cn)){if(e.eq(js)||e.eq(Hd))return Cn;if(e.eq(Cn))return js;var o=this.shr(1);return n=o.div(e).shl(1),n.eq(ha)?e.isNegative()?js:Hd:(a=this.sub(e.mul(n)),i=n.add(a.div(e)),i)}else if(e.eq(Cn))return this.unsigned?Po:ha;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=ha}for(a=this;a.gte(e);){n=Math.max(1,Math.floor(a.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(n)/Math.LN2),u=s<=48?1:Of(2,s-48),c=fa(n),l=c.mul(e);l.isNegative()||l.gt(a);)n-=u,c=fa(n,this.unsigned),l=c.mul(e);c.isZero()&&(c=js),i=i.add(c),a=a.sub(l)}return i};De.div=De.divide;De.modulo=function(e){if(_n(e)||(e=$a(e)),la){var t=(this.unsigned?la.rem_u:la.rem_s)(this.low,this.high,e.low,e.high);return $t(t,la.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};De.mod=De.modulo;De.rem=De.modulo;De.not=function(){return $t(~this.low,~this.high,this.unsigned)};De.and=function(e){return _n(e)||(e=$a(e)),$t(this.low&e.low,this.high&e.high,this.unsigned)};De.or=function(e){return _n(e)||(e=$a(e)),$t(this.low|e.low,this.high|e.high,this.unsigned)};De.xor=function(e){return _n(e)||(e=$a(e)),$t(this.low^e.low,this.high^e.high,this.unsigned)};De.shiftLeft=function(e){return _n(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?$t(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):$t(0,this.low<<e-32,this.unsigned)};De.shl=De.shiftLeft;De.shiftRight=function(e){return _n(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?$t(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):$t(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};De.shr=De.shiftRight;De.shiftRightUnsigned=function(e){if(_n(e)&&(e=e.toInt()),e&=63,e===0)return this;var t=this.high;if(e<32){var n=this.low;return $t(n>>>e|t<<32-e,t>>>e,this.unsigned)}else return e===32?$t(t,0,this.unsigned):$t(t>>>e-32,0,this.unsigned)};De.shru=De.shiftRightUnsigned;De.shr_u=De.shiftRightUnsigned;De.toSigned=function(){return this.unsigned?$t(this.low,this.high,!1):this};De.toUnsigned=function(){return this.unsigned?this:$t(this.low,this.high,!0)};De.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};De.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};De.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};zt.fromBytes=function(e,t,n){return n?zt.fromBytesLE(e,t):zt.fromBytesBE(e,t)};zt.fromBytesLE=function(e,t){return new zt(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)};zt.fromBytesBE=function(e,t){return new zt(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};var i2=yB(e2),wB=SM({__proto__:null,default:i2},[e2]),Oo=i2||wB;function zc(r){return Oo.fromString(r,!0,16)}var o2=zc("c3a5c85c97cb3127"),Ro=zc("b492b66fbe98f273"),on=zc("9ae16a3b2f90404f");function qd(r){return r.xor(r.shru(47))}function s2(r,e,t){var n=r.slice(e,e+t);return Oo.fromBytes(Array.from(n),!0,!0)}function Pt(r,e){return s2(r,e,8)}function Pw(r,e){return s2(r,e,4)}function Or(r,e){return e===0?r:r.shru(e).or(r.shl(64-e))}function Yi(r,e,t){t===void 0&&(t=zc("9ddfea08eb382d69"));var n=r.xor(e).mul(t);n=n.xor(n.shru(47));var a=e.xor(n).mul(t);return a=a.xor(a.shru(47)),a=a.mul(t),a}function xB(r,e,t,n,a,i){a=a.add(r),i=Or(i.add(a).add(n),21);var o=a;return a=a.add(e),a=a.add(t),i=i.add(Or(a,44)),[a.add(n),i.add(o)]}function Ef(r,e,t,n){return xB(Pt(r,e),Pt(r,e+8),Pt(r,e+16),Pt(r,e+24),t,n)}function kB(r,e){if(e===void 0&&(e=r.length),e>=8){var t=on.add(e*2),n=Pt(r,0).add(on),a=Pt(r,e-8),i=Or(a,37).mul(t).add(n),o=Or(n,25).add(a).mul(t);return Yi(i,o,t)}if(e>=4){var t=on.add(e*2),n=Pw(r,0);return Yi(n.shl(3).add(e),Pw(r,e-4),t)}if(e>0){var n=r[0],a=r[e>>1],i=r[e-1],s=n+(a<<8),u=e+(i<<2);return qd(on.mul(s).xor(o2.mul(u))).mul(on)}return on}function SB(r,e){e===void 0&&(e=r.length);var t=on.add(e*2),n=Pt(r,0).mul(Ro),a=Pt(r,8),i=Pt(r,e-8).mul(t),o=Pt(r,e-16).mul(on);return Yi(Or(n.add(a),43).add(Or(i,30)).add(o),n.add(Or(a.add(on),18)).add(i),t)}function EB(r,e){e===void 0&&(e=r.length);var t=on.add(e*2),n=Pt(r,0).mul(on),a=Pt(r,8),i=Pt(r,e-8).mul(t),o=Pt(r,e-16).mul(on),s=Or(n.add(a),43).add(Or(i,30)).add(o),u=Yi(s,n.add(Or(a.add(on),18)).add(i),t),c=Pt(r,16).mul(t),l=Pt(r,24),f=s.add(Pt(r,e-32)).mul(t),h=u.add(Pt(r,e-24)).mul(t);return Yi(Or(c.add(l),43).add(Or(f,30)).add(h),c.add(Or(l.add(n),18)).add(f),t)}function TB(r,e){var t,n;e===void 0&&(e=r.length);var a=Oo.fromNumber(81,!0);if(e<=32)return e<=16?kB(r,e):SB(r,e);if(e<=64)return EB(r,e);var i=a,o=a.mul(Ro).add(113),s=qd(o.mul(on).add(113)).mul(on),u=[Oo.UZERO,Oo.UZERO],c=[Oo.UZERO,Oo.UZERO];i=i.mul(on).add(Pt(r,0));var l=0,f=(e-1>>6)*64,h=f+(e-1&63)-63;do i=Or(i.add(o).add(u[0]).add(Pt(r,l+8)),37).mul(Ro),o=Or(o.add(u[1]).add(Pt(r,l+48)),42).mul(Ro),i=i.xor(c[1]),o=o.add(u[0]).add(Pt(r,l+40)),s=Or(s.add(c[0]),33).mul(Ro),u=Ef(r,l,u[1].mul(Ro),i.add(c[0])),c=Ef(r,l+32,s.add(c[1]),o.add(Pt(r,l+16))),t=ke([i,s],2),s=t[0],i=t[1],l+=64;while(l!==f);var p=Ro.add(s.and(255).shl(1));return l=h,c[0]=c[0].add(e-1&63),u[0]=u[0].add(c[0]),c[0]=c[0].add(u[0]),i=Or(i.add(o).add(u[0]).add(Pt(r,l+8)),37).mul(p),o=Or(o.add(u[1]).add(Pt(r,l+48)),42).mul(p),i=i.xor(c[1].mul(9)),o=o.add(u[0].mul(9).add(Pt(r,l+40))),s=Or(s.add(c[0]),33).mul(p),u=Ef(r,l,u[1].mul(p),i.add(c[0])),c=Ef(r,l+32,s.add(c[1]),o.add(Pt(r,l+16))),n=ke([i,s],2),s=n[0],i=n[1],Yi(Yi(u[0],c[0],p).add(qd(o).mul(o2)).add(s),Yi(u[1],c[1],p).add(i),p)}function NB(r,e){return e==="string"?$c(r):Hf([r],e)}function IB(r,e){return r instanceof Float32Array&&e==="float32"||r instanceof Int32Array&&e==="int32"||r instanceof Uint8Array&&e==="bool"}function Hf(r,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(r)&&(r=Qi(r)),st().getBool("DEBUG")&&t1(r,e),IB(r,e))return r;if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool"){for(var t=new Uint8Array(r.length),n=0;n<t.length;++n)Math.round(r[n])!==0&&(t[n]=1);return t}else throw new Error("Unknown data type ".concat(e))}function Tc(){return st().platform.now()}function CB(r,e){return st().platform.fetch(r,e)}function $c(r,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",st().platform.encode(r,e)}function Pf(r,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",st().platform.decode(r,e)}function Pr(r){return st().platform.isTypedArray!=null?st().platform.isTypedArray(r):Qk(r)}function Qi(r,e,t){var n,a;if(e===void 0&&(e=[]),t===void 0&&(t=!1),e==null&&(e=[]),typeof r=="boolean"||typeof r=="number"||typeof r=="string"||Uf(r)||r==null||Pr(r)&&t)e.push(r);else if(Array.isArray(r)||Pr(r))for(var i=0;i<r.length;++i)Qi(r[i],e,t);else{var o=-1;try{for(var s=Ur(Object.keys(r)),u=s.next();!u.done;u=s.next()){var c=u.value;/^([1-9]+[0-9]*|0)$/.test(c)&&(o=Math.max(o,Number(c)))}}catch(l){n={error:l}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(n)throw n.error}}for(var i=0;i<=o;i++)Qi(r[i],e,t)}return e}var AB={__proto__:null,arraysEqual:Ci,arraysEqualWithNull:Jw,assert:W,assertNonNegativeIntegerDimensions:Dn,assertNonNull:Ho,assertShapesMatch:sn,bytesFromStringArray:n1,bytesPerElement:_f,checkConversionForErrors:t1,clamp:kc,computeStrides:iu,convertBackendValuesAndArrayBuffer:zM,createScalarValue:NB,createShuffledIndices:PM,decodeString:Pf,distSquared:_M,encodeString:$c,fetch:CB,fingerPrint64:TB,flatten:Qi,getArrayFromDType:fv,getTypedArrayFromDType:e1,hasEncodingLoss:LM,hexToLong:zc,indexToLoc:GM,inferDtype:Lc,inferFromImplicitShape:BM,isBoolean:a1,isFunction:Ji,isInt:tu,isNumber:i1,isPromise:Uf,isScalarShape:FM,isString:ji,isTypedArray:Pr,isValidDtype:r1,locToIndex:WM,makeOnesTypedArray:hv,makeZerosNestedTypedArray:$M,makeZerosTypedArray:Vf,nearestDivisor:Ff,nearestLargerEven:CM,now:Tc,parseAxisParam:Bc,randUniform:DM,repeatedTry:MM,rightPad:bc,shuffle:Zw,shuffleCombo:IM,sizeFromShape:Dt,sizeToSquarishShape:OM,squeezeShape:Qw,sum:AM,swap:Df,tanh:RM,toNestedArray:Xs,toTypedArray:Hf},DB=(function(){function r(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new FB)}return r.prototype.profileKernel=function(e,t,n){var a,i,o,s=function(){o=n()},u,c=Tc();if(this.backendTimer.timerAvailable())u=this.backendTimer.time(s);else{s();try{for(var l=Ur(o),f=l.next();!f.done;f=l.next()){var h=f.value;h.dataSync()}}catch(v){a={error:v}}finally{try{f&&!f.done&&(i=l.return)&&i.call(l)}finally{if(a)throw a.error}}u=Promise.resolve({kernelMs:Tc()-c})}if(st().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(var p=function(v){var g=o[v];g.data().then(function(y){_B(y,g.dtype,e)})},d=0;d<o.length;d++)p(d);var m={kernelName:e,outputs:o,inputs:t,timeMs:u.then(function(v){return v.kernelMs}),extraInfo:u.then(function(v){return v.getExtraProfileInfo!=null?v.getExtraProfileInfo():""})};return m},r.prototype.logKernelProfile=function(e){var t=this,n=e.kernelName,a=e.outputs,i=e.timeMs,o=e.inputs,s=e.extraInfo;a.forEach(function(u){Promise.all([u.data(),i,s]).then(function(c){t.logger.logKernelProfile(n,u,c[0],c[1],o,c[2])})})},r})();function _B(r,e,t){if(e!=="float32")return!1;for(var n=0;n<r.length;n++){var a=r[n];if(isNaN(a)||!isFinite(a))return console.warn("Found ".concat(a," in the result of '").concat(t,"'")),!0}return!1}var FB=(function(){function r(){}return r.prototype.logKernelProfile=function(e,t,n,a,i,o){var s=typeof a=="number"?bc("".concat(a,"ms"),9):a.error,u=bc(e,25),c=t.rank,l=t.size,f=bc(t.shape.toString(),14),h="";for(var p in i){var d=i[p];if(d!=null){var m=d.shape||t.shape,v=m.length;h+="".concat(p,": ").concat(v,"D ").concat(v>0?m:""," ")}}console.log("%c".concat(u,"	%c").concat(s,"	%c").concat(c,"D ").concat(f,"	%c").concat(l,"	%c").concat(h,"	%c").concat(o),"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},r})();function RB(r,e,t){for(var n={},a={},i=0;i<e.length;i++)n[e[i].id]=!0;for(var i=0;i<r.length;i++){var o=r[i],s=o.inputs;for(var u in s){for(var c=s[u],l=!1,f=0;f<e.length;f++)if(n[c.id]){o.outputs.forEach(function(w){return n[w.id]=!0}),l=!0,a[o.id]=!0;break}if(l)break}}var h={};h[t.id]=!0;for(var p={},i=r.length-1;i>=0;i--)for(var o=r[i],s=o.inputs,f=0;f<o.outputs.length;f++)if(h[o.outputs[f].id]){for(var u in s)h[s[u].id]=!0,p[o.id]=!0;break}for(var d=[],i=0;i<r.length;i++){var o=r[i];if(a[o.id]&&p[o.id]){var m={};for(var u in o.inputs){var v=o.inputs[u];n[v.id]&&(m[u]=v)}var g=Object.assign({},o);g.inputs=m,g.outputs=o.outputs,d.push(g)}}return d}function OB(r,e,t,n){for(var a=function(o){var s=e[o],u=[];if(s.outputs.forEach(function(h){var p=r[h.id];p!=null?u.push(p):u.push(null)}),s.gradient==null)throw new Error("Cannot compute gradient: gradient function not found "+"for ".concat(s.kernelName,"."));var c=s.gradient(u),l=function(h){if(!(h in c))throw new Error("Cannot backprop through input ".concat(h,". ")+"Available gradients found: ".concat(Object.keys(c),"."));var p=t(function(){return c[h]()});if(p.dtype!=="float32")throw new Error("Error in gradient for op ".concat(s.kernelName,". The gradient of input ")+"".concat(h," must have 'float32' dtype, but has '").concat(p.dtype,"'"));var d=s.inputs[h];if(!Ci(p.shape,d.shape))throw new Error("Error in gradient for op ".concat(s.kernelName,". The gradient of input ")+"'".concat(h,"' has shape '").concat(p.shape,"', which does not match ")+"the shape of the input '".concat(d.shape,"'"));if(r[d.id]==null)r[d.id]=p;else{var m=r[d.id];r[d.id]=n(m,p),m.dispose()}};for(var f in s.inputs)l(f)},i=e.length-1;i>=0;i--)a(i)}var Mw=20,mc=3,Od=7;function PB(r,e,t,n){var a=iu(e),i=MB(r,e,t,a),o=e.length,s=If(r,e,t,a,i),u=["Tensor"];return n&&(u.push("  dtype: ".concat(t)),u.push("  rank: ".concat(o)),u.push("  shape: [".concat(e,"]")),u.push("  values:")),u.push(s.map(function(c){return"    "+c}).join(`
`)),u.join(`
`)}function MB(r,e,t,n){var a=Dt(e),i=n[n.length-1],o=new Array(i).fill(0),s=e.length,u=t==="complex64"?yc(r):r;if(s>1)for(var c=0;c<a/i;c++)for(var l=c*i,f=0;f<i;f++)o[f]=Math.max(o[f],gc(u[l+f],0,t).length);return o}function gc(r,e,t){var n;return Array.isArray(r)?n="".concat(parseFloat(r[0].toFixed(Od))," + ")+"".concat(parseFloat(r[1].toFixed(Od)),"j"):ji(r)?n="'".concat(r,"'"):t==="bool"?n=u2(r):n=parseFloat(r.toFixed(Od)).toString(),bc(n,e)}function u2(r){return r===0?"false":"true"}function If(r,e,t,n,a,i){i===void 0&&(i=!0);var o=t==="complex64"?2:1,s=e[0],u=e.length;if(u===0){if(t==="complex64"){var c=yc(r);return[gc(c[0],0,t)]}return t==="bool"?[u2(r[0])]:[r[0].toString()]}if(u===1){if(s>Mw){var l=mc*o,f=Array.from(r.slice(0,l)),h=Array.from(r.slice((s-mc)*o,s*o));return t==="complex64"&&(f=yc(f),h=yc(h)),["["+f.map(function(T,N){return gc(T,a[N],t)}).join(", ")+", ..., "+h.map(function(T,N){return gc(T,a[s-mc+N],t)}).join(", ")+"]"]}var p=t==="complex64"?yc(r):Array.from(r);return["["+p.map(function(T,N){return gc(T,a[N],t)}).join(", ")+"]"]}var d=e.slice(1),m=n.slice(1),v=n[0]*o,g=[];if(s>Mw){for(var y=0;y<mc;y++){var w=y*v,b=w+v;g.push.apply(g,pt([],ke(If(r.slice(w,b),d,t,m,a,!1)),!1))}g.push("...");for(var y=s-mc;y<s;y++){var w=y*v,b=w+v;g.push.apply(g,pt([],ke(If(r.slice(w,b),d,t,m,a,y===s-1)),!1))}}else for(var y=0;y<s;y++){var w=y*v,b=w+v;g.push.apply(g,pt([],ke(If(r.slice(w,b),d,t,m,a,y===s-1)),!1))}var x=u===2?",":"";g[0]="["+(s>0?g[0]+x:"");for(var y=1;y<g.length-1;y++)g[y]=" "+g[y]+x;for(var S=`,
`,y=2;y<u;y++)S+=`
`;return g[g.length-1]=" "+g[g.length-1]+"]"+(i?"":S),g}function yc(r){for(var e=[],t=0;t<r.length;t+=2)e.push([r[t],r[t+1]]);return e}var Mf=(function(){function r(e,t,n){var a=this;if(this.dtype=t,this.shape=e.slice(),this.size=Dt(e),n!=null){var i=n.length;W(i===this.size,function(){return"Length of values '".concat(i,"' does not match the size ")+"inferred by the shape '".concat(a.size,"'.")})}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||fv(t,this.size),this.strides=iu(e)}return r.prototype.set=function(e){for(var t=this,n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];n.length===0&&(n=[0]),W(n.length===this.rank,function(){return"The number of provided coordinates (".concat(n.length,") must ")+"match the rank (".concat(t.rank,")")});var i=this.locToIndex(n);this.values[i]=e},r.prototype.get=function(){for(var e,t,n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];n.length===0&&(n=[0]);var i=0;try{for(var o=Ur(n),s=o.next();!s.done;s=o.next()){var u=s.value;if(u<0||u>=this.shape[i]){var c="Requested out of range element at ".concat(n,". ")+"  Buffer shape=".concat(this.shape);throw new Error(c)}i++}}catch(h){e={error:h}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}for(var l=n[n.length-1],f=0;f<n.length-1;++f)l+=this.strides[f]*n[f];return this.values[l]},r.prototype.locToIndex=function(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t},r.prototype.indexToLoc=function(e){if(this.rank===0)return[];if(this.rank===1)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t},Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!1,configurable:!0}),r.prototype.toTensor=function(){return La().makeTensor(this.values,this.shape,this.dtype)},r})(),La=null,Hs=null;function BB(r){La=r}function LB(r){Hs=r}var Sr=(function(){function r(e,t,n,a){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=Dt(e),this.strides=iu(e),this.dataId=n,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}return Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!1,configurable:!0}),r.prototype.buffer=function(){return $e(this,void 0,void 0,function(){var e;return We(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,Hs.buffer(this.shape,this.dtype,e)]}})})},r.prototype.bufferSync=function(){return Hs.buffer(this.shape,this.dtype,this.dataSync())},r.prototype.array=function(){return $e(this,void 0,void 0,function(){var e;return We(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,Xs(this.shape,e,this.dtype==="complex64")]}})})},r.prototype.arraySync=function(){return Xs(this.shape,this.dataSync(),this.dtype==="complex64")},r.prototype.data=function(){return $e(this,void 0,void 0,function(){var e,t;return We(this,function(n){switch(n.label){case 0:return this.throwIfDisposed(),e=La().read(this.dataId),this.dtype!=="string"?[3,2]:[4,e];case 1:t=n.sent();try{return[2,t.map(function(a){return Pf(a)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}n.label=2;case 2:return[2,e]}})})},r.prototype.dataToGPU=function(e){return this.throwIfDisposed(),La().readToGPU(this.dataId,e)},r.prototype.dataSync=function(){this.throwIfDisposed();var e=La().readSync(this.dataId);if(this.dtype==="string")try{return e.map(function(t){return Pf(t)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},r.prototype.bytes=function(){return $e(this,void 0,void 0,function(){var e;return We(this,function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,La().read(this.dataId)];case 1:return e=t.sent(),this.dtype==="string"?[2,e]:[2,new Uint8Array(e.buffer)]}})})},r.prototype.dispose=function(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),La().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(r.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!1,configurable:!0}),r.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},r.prototype.print=function(e){return e===void 0&&(e=!1),Hs.print(this,e)},r.prototype.clone=function(){return this.throwIfDisposed(),Hs.clone(this)},r.prototype.toString=function(e){e===void 0&&(e=!1);var t=this.dataSync();return PB(t,this.shape,this.dtype,e)},r.prototype.cast=function(e){return this.throwIfDisposed(),Hs.cast(this,e)},r.prototype.variable=function(e,t,n){return e===void 0&&(e=!0),this.throwIfDisposed(),La().makeVariable(this,e,t,n)},r})();Object.defineProperty(Sr,Symbol.hasInstance,{value:function(r){return!!r&&r.data!=null&&r.dataSync!=null&&r.throwIfDisposed!=null}});function c2(){return pv("Tensor",function(){return Sr})}c2();var Nc=(function(r){Ii(e,r);function e(t,n,a,i){var o=r.call(this,t.shape,t.dtype,t.dataId,i)||this;return o.trainable=n,o.name=a,o}return e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value (".concat(t.dtype,") and ")+"previous value (".concat(this.dtype,") must match"));if(!Ci(t.shape,this.shape))throw new Error("shape of the new value (".concat(t.shape,") and ")+"previous value (".concat(this.shape,") must match"));La().disposeTensor(this),this.dataId=t.dataId,La().incRef(this,null)},e.prototype.dispose=function(){La().disposeVariable(this),this.isDisposedInternal=!0},e})(Sr);Object.defineProperty(Nc,Symbol.hasInstance,{value:function(r){return r instanceof Sr&&r.assign!=null&&r.assign instanceof Function}});D.Rank=void 0;(function(r){r.R0="R0",r.R1="R1",r.R2="R2",r.R3="R3",r.R4="R4",r.R5="R5",r.R6="R6"})(D.Rank||(D.Rank={}));var Kd;(function(r){r.float32="float32",r.int32="int32",r.bool="int32",r.complex64="complex64"})(Kd||(Kd={}));var jd;(function(r){r.float32="float32",r.int32="int32",r.bool="bool",r.complex64="complex64"})(jd||(jd={}));var Xd;(function(r){r.float32="float32",r.int32="float32",r.bool="float32",r.complex64="complex64"})(Xd||(Xd={}));var Yd;(function(r){r.float32="complex64",r.int32="complex64",r.bool="complex64",r.complex64="complex64"})(Yd||(Yd={}));var zB={float32:Xd,int32:Kd,bool:jd,complex64:Yd};function qf(r,e){if(r==="string"||e==="string"){if(r==="string"&&e==="string")return"string";throw new Error("Can not upcast ".concat(r," with ").concat(e))}return zB[r][e]}function $B(r){return qf(r,"int32")}function l2(r){return r!=null&&typeof r=="object"&&"texture"in r&&r.texture instanceof WebGLTexture}function f2(r){return typeof GPUBuffer<"u"&&r!=null&&typeof r=="object"&&"buffer"in r&&r.buffer instanceof GPUBuffer}function or(r,e){if(r.dtype===e.dtype)return[r,e];var t=qf(r.dtype,e.dtype);return[r.cast(t),e.cast(t)]}function h2(r,e){W(r.dtype===e.dtype,function(){return"The dtypes of the first(".concat(r.dtype,") and")+" second(".concat(e.dtype,") input must match")})}function WB(r,e){return e.some(function(t){return t.id===r.id})}function xv(r){var e=[],t=new Set;return p2(r,e,t),e}function p2(r,e,t){if(r!=null){if(r instanceof Sr){e.push(r);return}if(GB(r)){var n=r;for(var a in n){var i=n[a];t.has(i)||(t.add(i),p2(i,e,t))}}}}function GB(r){return Array.isArray(r)||typeof r=="object"}var VB={__proto__:null,assertTypesMatch:h2,getTensorsInContainer:xv,isTensorInList:WB,makeTypesMatch:or};function Pd(r){return r.kernelName!=null}var Bw=(function(){function r(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(function(e){return e.name})))}}}return r.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},r})(),kv=(function(){function r(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Bw}return r.prototype.ready=function(){return $e(this,void 0,void 0,function(){var e,t,n,a;return We(this,function(i){switch(i.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];e=this.getSortedBackends(),t=0,i.label=1;case 1:return t<e.length?(n=e[t],[4,this.initializeBackend(n).success]):[3,5];case 2:return a=i.sent(),a?[4,this.setBackend(n)]:[3,4];case 3:return i.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(r.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '".concat(this.backendName,"' has not yet been initialized. Make ")+"sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var e=this.initializeBackendsAndReturnBest(),t=e.name,n=e.asyncInit;if(n)throw new Error("The highest priority backend '".concat(t,"' has not yet been ")+"initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!1,configurable:!0}),r.prototype.backendNames=function(){return Object.keys(this.registryFactory)},r.prototype.findBackend=function(e){if(!(e in this.registry))if(e in this.registryFactory){var t=this.initializeBackend(e).asyncInit;if(t)return null}else return null;return this.registry[e]},r.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},r.prototype.registerBackend=function(e,t,n){return n===void 0&&(n=1),e in this.registryFactory?(Ki("".concat(e," backend was already registered. ")+"Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)},r.prototype.setBackend=function(e){return $e(this,void 0,void 0,function(){var t,n,a,i,o;return We(this,function(s){switch(s.label){case 0:if(this.registryFactory[e]==null)throw new Error("Backend name '".concat(e,"' not found in registry"));return this.backendName=e,this.registry[e]!=null?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),n=t.success,a=t.asyncInit,a?[4,n]:[3,2]);case 1:return o=s.sent(),[3,3];case 2:o=n,s.label=3;case 3:if(i=o,!i)return[2,!1];s.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new DB(this.backendInstance),[2,!0]}})})},r.prototype.setupRegisteredKernels=function(){var e=this,t=Rf(this.backendName);t.forEach(function(n){n.setupFunc!=null&&n.setupFunc(e.backendInstance)})},r.prototype.disposeRegisteredKernels=function(e){var t=this,n=Rf(e);n.forEach(function(a){a.disposeFunc!=null&&a.disposeFunc(t.registry[e])})},r.prototype.initializeBackend=function(e){var t=this,n=this.registryFactory[e];if(n==null)throw new Error("Cannot initialize backend ".concat(e,", no registration found."));try{var a=n.factory();if(a&&!(a instanceof Yw)&&typeof a.then=="function"){var i=++this.pendingBackendInitId,o=a.then(function(s){return i<t.pendingBackendInitId?!1:(t.registry[e]=s,t.pendingBackendInit=null,!0)}).catch(function(s){return i<t.pendingBackendInitId||(t.pendingBackendInit=null,Ki("Initialization of backend ".concat(e," failed")),Ki(s.stack||s.message)),!1});return this.pendingBackendInit=o,{success:o,asyncInit:!0}}else return this.registry[e]=a,{success:!0,asyncInit:!1}}catch(s){return Ki("Initialization of backend ".concat(e," failed")),Ki(s.stack||s.message),{success:!1,asyncInit:!1}}},r.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error("".concat(e," backend not found in registry"));this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},r.prototype.getSortedBackends=function(){var e=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority})},r.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],a=this.initializeBackend(n),i=a.success,o=a.asyncInit;if(o||i)return{name:n,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")},r.prototype.moveData=function(e,t){var n=this.state.tensorInfo.get(t),a=n.backend,i=this.readSync(t),o=a.refCount(t);a.disposeData(t,!0),n.backend=e,e.move(t,i,n.shape,n.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},r.prototype.tidy=function(e,t){var n=this,a=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}var i;return this.scopedRun(function(){return n.startScope(a)},function(){return n.endScope(i)},function(){return i=t(),i instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),i})},r.prototype.scopedRun=function(e,t,n){e();try{var a=n();return t(),a}catch(i){throw t(),i}},r.prototype.nextTensorId=function(){return r.nextTensorId++},r.prototype.nextVariableId=function(){return r.nextVariableId++},r.prototype.clone=function(e){var t=q.runKernel(gv,{x:e}),n={x:e},a=function(o){return{x:function(){var s="float32",u={x:o},c={dtype:s};return q.runKernel(vv,u,c)}}},i=[];return this.addTapeNode(this.state.activeScope.name,n,[t],a,i,{}),t},r.prototype.runKernel=function(e,t,n){this.backendName==null&&this.backend;var a=Ec(e,this.backendName)!=null;if(!a)throw new Error("Kernel '".concat(e,"' not registered for backend '").concat(this.backendName,"'"));return this.runKernelFunc({kernelName:e,inputs:t,attrs:n})},r.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},r.prototype.checkKernelForMemLeak=function(e,t,n){var a=this.backend.numDataIds(),i=0;n.forEach(function(u){i+=u.dtype==="complex64"?3:1});var o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=a-t-i-o;if(s>0)throw new Error("Backend '".concat(this.backendName,"' has an internal memory leak ")+"(".concat(s," data ids) after running '").concat(e,"'"))},r.prototype.runKernelFunc=function(e){var t=this,n,a=[],i=this.isTapeOn(),o=this.state.numBytes,s=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var u;this.backendName==null&&this.backend;var c,l=Pd(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(Pd(e)){var f=e.kernelName,h=e.inputs,p=e.attrs;this.backendName==null&&this.backend;var d=Ec(f,this.backendName);W(d!=null,function(){return"Cannot find registered kernel '".concat(f,"' for backend '").concat(t.backendName,"'")}),u=function(){var x=t.backend.numDataIds();c=d.kernelFunc({inputs:h,attrs:p,backend:t.backend});var S=Array.isArray(c)?c:[c];t.shouldCheckForMemLeaks()&&t.checkKernelForMemLeak(f,x,S);var T=S.map(function(C){return C.rank!=null?C:t.makeTensorFromTensorInfo(C)});if(i){var N=t.getTensorsForGradient(f,h,T);a=t.saveTensorsForBackwardMode(N)}return T}}else{var m=e.forwardFunc,v=function(x){i&&(a=x.map(function(S){return t.keep(t.clone(S))}))};u=function(){var x=t.backend.numDataIds();c=t.tidy(function(){return m(t.backend,v)});var S=Array.isArray(c)?c:[c];return t.shouldCheckForMemLeaks()&&t.checkKernelForMemLeak(l,x,S),S}}var g=e.inputs,y=e.attrs,w=Pd(e)?null:e.backwardsFunc,b;return this.scopedRun(function(){return t.state.kernelDepth++},function(){return t.state.kernelDepth--},function(){!t.ENV.getBool("DEBUG")&&!t.state.profiling?n=u():(b=t.profiler.profileKernel(l,g,function(){return u()}),t.ENV.getBool("DEBUG")&&t.profiler.logKernelProfile(b),n=b.outputs)}),i&&this.addTapeNode(l,g,n,w,a,y),this.state.profiling&&this.state.activeProfile.kernels.push({name:l,bytesAdded:this.state.numBytes-o,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-s,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(g).map(function(x){return g[x]!=null?g[x].shape:null}),outputShapes:n.map(function(x){return x.shape}),kernelTimeMs:b.timeMs,extraInfo:b.extraInfo}),Array.isArray(c)?n:n[0]},r.prototype.saveTensorsForBackwardMode=function(e){var t=this,n=e.map(function(a){return t.keep(t.clone(a))});return n},r.prototype.getTensorsForGradient=function(e,t,n){var a=Ud(e);if(a!=null){var i=a.inputsToSave||[],o=a.outputsToSave||[],s=void 0;a.saveAllInputs?(W(Array.isArray(t),function(){return"saveAllInputs is true, expected inputs to be an array."}),s=Object.keys(t).map(function(c){return t[c]})):s=i.map(function(c){return t[c]});var u=n.filter(function(c,l){return o[l]});return s.concat(u)}return[]},r.prototype.makeTensor=function(e,t,n,a){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",a=a||this.backend;var i=e;n==="string"&&ji(e[0])&&(i=e.map(function(l){return $c(l)}));var o=a.write(i,t,n),s=new Sr(t,n,o,this.nextTensorId());if(this.trackTensor(s,a),n==="string"){var u=this.state.tensorInfo.get(o),c=n1(i);this.state.numBytes+=c-u.bytes,u.bytes=c}return s},r.prototype.makeTensorFromDataId=function(e,t,n,a){n=n||"float32";var i={dataId:e,shape:t,dtype:n};return this.makeTensorFromTensorInfo(i,a)},r.prototype.makeTensorFromTensorInfo=function(e,t){var n=e.dataId,a=e.shape,i=e.dtype,o=new Sr(a,i,n,this.nextTensorId());return this.trackTensor(o,t),o},r.prototype.makeVariable=function(e,t,n,a){t===void 0&&(t=!0),n=n||this.nextVariableId().toString(),a!=null&&a!==e.dtype&&(e=e.cast(a));var i=new Nc(e,t,n,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error("Variable with name ".concat(i.name," was already registered"));return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i},r.prototype.trackTensor=function(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;var n=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(n=e.size*_f(e.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n})),e instanceof Nc||this.track(e)},r.prototype.incRef=function(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)},r.prototype.removeDataId=function(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)},r.prototype.disposeTensor=function(e){if(this.state.tensorInfo.has(e.dataId)){var t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){var n=e.size*_f(e.dtype);this.state.numBytes-=n}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}},r.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},r.prototype.disposeVariable=function(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]},r.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},r.prototype.profile=function(e){return $e(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l,f,h;return We(this,function(p){switch(p.label){case 0:return this.state.profiling=!0,t=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],a=this.state.activeProfile,[4,e()];case 1:a.result=p.sent(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,pt([],ke(this.state.activeProfile.kernels.map(function(d){return d.totalBytesSnapshot})),!1)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n,p.label=2;case 2:p.trys.push([2,8,9,10]),i=Ur(this.state.activeProfile.kernels),o=i.next(),p.label=3;case 3:return o.done?[3,7]:(s=o.value,u=s,[4,s.kernelTimeMs]);case 4:return u.kernelTimeMs=p.sent(),c=s,[4,s.extraInfo];case 5:c.extraInfo=p.sent(),p.label=6;case 6:return o=i.next(),[3,3];case 7:return[3,10];case 8:return l=p.sent(),f={error:l},[3,10];case 9:try{o&&!o.done&&(h=i.return)&&h.call(i)}finally{if(f)throw f.error}return[7];case 10:return[2,this.state.activeProfile]}})})},r.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},r.prototype.addTapeNode=function(e,t,n,a,i,o){var s=this,u={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:i},c=Ud(e);c!=null&&(a=c.gradFunc),a!=null&&(u.gradient=function(l){return l=l.map(function(f,h){if(f==null){var p=n[h],d=Vf(p.size,p.dtype);return s.makeTensor(d,p.shape,p.dtype)}return f}),a(l.length>1?l:l[0],i,o)}),this.state.activeTape.push(u)},r.prototype.keep=function(e){return e.kept=!0,e},r.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},r.prototype.endTape=function(){this.state.gradientDepth--},r.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},r.prototype.endScope=function(e){for(var t=this,n=xv(e),a=new Set(n.map(function(u){return u.id})),i=0;i<this.state.activeScope.track.length;i++){var o=this.state.activeScope.track[i];!o.kept&&!a.has(o.id)&&o.dispose()}var s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(function(u){!u.kept&&u.scopeId===s.id&&t.track(u)})},r.prototype.gradients=function(e,t,n,a){var i=this;if(a===void 0&&(a=!1),W(t.length>0,function(){return"gradients() received an empty list of xs."}),n!=null&&n.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '".concat(n.dtype,"'"));var o=this.scopedRun(function(){return i.startTape()},function(){return i.endTape()},function(){return i.tidy("forward",e)});W(o instanceof Sr,function(){return"The result y returned by f() must be a tensor."});var s=RB(this.state.activeTape,t,o);if(!a&&s.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u={};u[o.id]=n??UB(o.shape),OB(u,s,function(l){return i.tidy(l)},HB);var c=t.map(function(l){return u[l.id]});return i.state.gradientDepth===0&&(i.state.activeTape.forEach(function(l){var f,h;try{for(var p=Ur(l.saved),d=p.next();!d.done;d=p.next()){var m=d.value;m.dispose()}}catch(v){f={error:v}}finally{try{d&&!d.done&&(h=p.return)&&h.call(p)}finally{if(f)throw f.error}}}),i.state.activeTape=null),{value:o,grads:c}})},r.prototype.customGrad=function(e){var t=this;return W(Ji(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];W(n.every(function(c){return c instanceof Sr}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var i,o={};n.forEach(function(c,l){o[l]=c});var s=function(c,l){return i=e.apply(void 0,pt([],ke(pt(pt([],ke(n),!1),[l],!1)),!1)),W(i.value instanceof Sr,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),W(Ji(i.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),i.value},u=function(c,l){var f=i.gradFunc(c,l),h=Array.isArray(f)?f:[f];W(h.length===n.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),W(h.every(function(d){return d instanceof Sr}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var p={};return h.forEach(function(d,m){p[m]=function(){return d}}),p};return t.runKernelFunc({forwardFunc:s,backwardsFunc:u,inputs:o})}},r.prototype.readSync=function(e){var t=this.state.tensorInfo.get(e);return t.backend.readSync(e)},r.prototype.read=function(e){var t=this.state.tensorInfo.get(e);return t.backend.read(e)},r.prototype.readToGPU=function(e,t){var n=this.state.tensorInfo.get(e);return n.backend.readToGPU(e,t)},r.prototype.time=function(e){return $e(this,void 0,void 0,function(){var t,n;return We(this,function(a){switch(a.label){case 0:return t=Tc(),[4,this.backend.time(e)];case 1:return n=a.sent(),n.wallMs=Tc()-t,[2,n]}})})},r.prototype.track=function(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(r.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!1,configurable:!0}),r.prototype.reset=function(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Bw;for(var e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},r})();kv.nextTensorId=0;kv.nextVariableId=0;function UB(r){var e=hv(Dt(r),"float32");return q.makeTensor(e,r,"float32")}function d2(){var r=u1();if(r._tfengine==null){var e=new s1(r);r._tfengine=new kv(e)}return qM(r._tfengine.ENV),BB(function(){return r._tfengine}),r._tfengine}var q=d2();function HB(r,e){var t={a:r,b:e};return q.runKernel(dv,t)}function qB(){return typeof navigator<"u"&&navigator!=null}var Zd;function KB(r){Zd=r}function jB(r){if(Zd!==void 0)return Zd;if(r||qB()){if(r||(r=navigator),r.product==="ReactNative")return!0;var e=r.userAgent||r.vendor||(typeof window<"u"?window.opera:"");if(!e){var t=r;return t.userAgentData&&t.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function v2(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var XB={__proto__:null,isBrowser:v2,isMobile:jB,mockIsMobile:KB};var vn=st();vn.registerFlag("DEBUG",function(){return!1},function(r){r&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});vn.registerFlag("IS_BROWSER",function(){return v2()});vn.registerFlag("IS_NODE",function(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"});vn.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)});vn.registerFlag("IS_SAFARI",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor)});vn.registerFlag("PROD",function(){return!1});vn.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return vn.getBool("DEBUG")});vn.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0});vn.registerFlag("IS_TEST",function(){return!1});vn.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",function(){return vn.getBool("DEBUG")});vn.registerFlag("WRAP_TO_IMAGEBITMAP",function(){return!1});vn.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",function(){return!1});vn.registerFlag("USE_SETTIMEOUTCUSTOM",function(){return!1});function si(r,e){var t=r;if(Pr(r))return e==="string"?[]:[r.length];if(l2(r)){var n=r.channels||"RGBA";return[r.height,r.width*n.length]}else if(f2(r))return[r.buffer.size/(e==null?4:_f(e))];if(!Array.isArray(r))return[];for(var a=[];Array.isArray(t)||Pr(t)&&e!=="string";)a.push(t.length),t=t[0];return Array.isArray(r)&&st().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&m2(r,a,[]),a}function m2(r,e,t){if(t=t||[],!Array.isArray(r)&&!Pr(r)){W(e.length===0,function(){return"Element arr[".concat(t.join("]["),"] is a primitive, ")+"but should be an array/TypedArray of ".concat(e[0]," elements")});return}W(e.length>0,function(){return"Element arr[".concat(t.join("]["),"] should be a primitive, ")+"but is an array of ".concat(r.length," elements")}),W(r.length===e[0],function(){return"Element arr[".concat(t.join("]["),"] should have ").concat(e[0]," ")+"elements, but has ".concat(r.length," elements")});for(var n=e.slice(1),a=0;a<r.length;++a)m2(r[a],n,t.concat(a))}function Lw(r,e,t,n){if(r!=="string_or_numeric"){if(r==null)throw new Error("Expected dtype cannot be null.");if(r!=="numeric"&&r!==e||r==="numeric"&&e==="string")throw new Error("Argument '".concat(t,"' passed to '").concat(n,"' must ")+"be ".concat(r," tensor, but got ").concat(e," tensor"))}}function O(r,e,t,n){if(n===void 0&&(n="numeric"),r instanceof c2())return Lw(n,r.dtype,e,t),r;var a=Lc(r);if(a!=="string"&&["bool","int32","float32"].indexOf(n)>=0&&(a=n),Lw(n,a,e,t),r==null||!Pr(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string"){var i=r==null?"null":r.constructor.name;throw new Error("Argument '".concat(e,"' passed to '").concat(t,"' must be a ")+"Tensor or TensorLike, but got '".concat(i,"'"))}var o=si(r,a);!Pr(r)&&!Array.isArray(r)&&(r=[r]);var s=!0,u=a!=="string"?Hf(r,a):Qi(r,[],s);return q.makeTensor(u,o,a)}function Ic(r,e,t,n){if(n===void 0&&(n="numeric"),!Array.isArray(r))throw new Error("Argument ".concat(e," passed to ").concat(t," must be a ")+"`Tensor[]` or `TensorLike[]`");var a=r;return a.map(function(i,o){return O(i,"".concat(e,"[").concat(o,"]"),t,n)})}var g2="__op";function H(r){var e=Object.keys(r);if(e.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+"".concat(e.length," keys."));var t=e[0],n=r[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+g2;var a=function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];q.startScope(t);try{var s=n.apply(void 0,pt([],ke(i),!1));return Uf(s)&&console.error("Cannot return a Promise inside of tidy."),q.endScope(s),s}catch(u){throw q.endScope(null),u}};return Object.defineProperty(a,"name",{value:t,configurable:!0}),a}function YB(r,e){var t=O(r,"real","complex"),n=O(e,"imag","complex");sn(t.shape,n.shape,"real and imag shapes, ".concat(t.shape," and ").concat(n.shape,", ")+"must match in call to tf.complex().");var a={real:t,imag:n};return q.runKernel(_1,a)}var eo=H({complex_:YB});function no(r,e,t,n){if(n==null)n=Lc(r);else if(n==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(f2(r)||l2(r)){if(n!=="float32"&&n!=="int32")throw new Error("Creating tensor from GPU data only supports "+"'float32'|'int32' dtype, while the dtype is ".concat(n,"."));return q.backend.createTensorFromGPUData(r,e||t,n)}if(!Pr(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){Dn(e);var a=Dt(e),i=Dt(t);W(a===i,function(){return"Based on the provided shape, [".concat(e,"], the tensor should have ")+"".concat(a," values but has ").concat(i)});for(var o=0;o<t.length;++o){var s=t[o],u=o===t.length-1?s!==Dt(e.slice(o)):!0;W(t[o]===e[o]||!u,function(){return"Error creating a new Tensor. Inferred shape "+"(".concat(t,") does not match the provided ")+"shape (".concat(e,"). ")})}}return!Pr(r)&&!Array.isArray(r)&&(r=[r]),e=e||t,r=n!=="string"?Hf(r,n):Qi(r,[],!0),q.makeTensor(r,e,n)}function Ys(r,e,t){var n=si(r,t);return no(r,e,n,t)}var zo={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8},Ai=(function(){function r(e){if(this.shards=[],this.previousShardIndex=0,e!=null&&(e instanceof Array||(e=[e]),e=e.map(function(o){return Pr(o)?o.buffer:o}),e.length!==0)){this.bufferUniformSize=e[0].byteLength;for(var t=0,n=0;n<e.length;n++){var a=e[n];n!==e.length-1&&a.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);var i=t+a.byteLength;this.shards.push({buffer:a,start:t,end:i}),t=i}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}}return r.join=function(e){return new r(e).slice()},r.prototype.slice=function(e,t){if(e===void 0&&(e=0),t===void 0&&(t=this.byteLength),this.shards.length===0)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,t=isNaN(Number(t))?0:t,e=Math.max(0,e),t=Math.min(this.byteLength,t),t<=e)return new ArrayBuffer(0);var n=this.findShardForByte(e);if(n===-1)throw new Error("Could not find start shard for byte ".concat(e));for(var a=t-e,i=new ArrayBuffer(a),o=new Uint8Array(i),s=0,u=n;u<this.shards.length;u++){var c=this.shards[u],l=e+s,f=l-c.start,h=s,p=Math.min(t,c.end),d=p-c.start,m=new Uint8Array(c.buffer,f,d-f);if(o.set(m,h),s+=m.length,t<c.end)break}return i},r.prototype.findShardForByte=function(e){if(this.shards.length===0||e<0||e>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function t(a){return e<a.start?-1:e>=a.end?1:0}if(t(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;var n=ZB(this.shards,t);return n===-1?-1:(this.previousShardIndex=n,this.previousShardIndex)},r})();function ZB(r,e){for(var t=0,n=r.length;t<=n;){var a=Math.floor((n-t)/2)+t,i=e(r[a]);if(i===0)return a;i<0?n=a:t=a+1}return-1}function JB(){st().set("PROD",!0)}function QB(){st().set("DEBUG",!0)}function eL(){st().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function tL(r){st().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(r+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function rL(){q.disposeVariables()}function nL(){return q}function aL(){return q.memory()}function iL(r){return q.profile(r)}function Er(r,e){return q.tidy(r,e)}function dn(r){var e=xv(r);e.forEach(function(t){return t.dispose()})}function y2(r){return q.keep(r)}function oL(r){return q.time(r)}function sL(r){return q.setBackend(r)}function uL(){return q.ready()}function b2(){return q.backendName}function cL(r){q.removeBackend(r)}function lL(r){return q.findBackend(r)}function fL(r){return q.findBackendFactory(r)}function hL(r,e,t){return t===void 0&&(t=1),q.registerBackend(r,e,t)}function w2(){return q.backend}function pL(r,e){st().setPlatform(r,e)}var to=4;function dL(r,e){return $e(this,void 0,void 0,function(){var t,n,a,i,o,s,u=this;return We(this,function(c){switch(c.label){case 0:for(t=[],n=[],a=Array.isArray(r)?r.map(function(l){return l.name}):Object.keys(r),i=function(l){var f=a[l],h=Array.isArray(r)?r[l].tensor:r[f];if(h.dtype!=="float32"&&h.dtype!=="int32"&&h.dtype!=="bool"&&h.dtype!=="string"&&h.dtype!=="complex64")throw new Error("Unsupported dtype in weight '".concat(f,"': ").concat(h.dtype));var p={name:f,shape:h.shape,dtype:h.dtype};if(h.dtype==="string"){var d=new Promise(function(m){return $e(u,void 0,void 0,function(){var v,g,y,w,b,x,S;return We(this,function(T){switch(T.label){case 0:return[4,h.bytes()];case 1:for(v=T.sent(),g=v.reduce(function(N,C){return N+C.length},0)+to*v.length,y=new Uint8Array(g),w=0,b=0;b<v.length;b++)x=v[b],S=new Uint8Array(new Uint32Array([x.length]).buffer),y.set(S,w),w+=to,y.set(x,w),w+=x.length;return m(y),[2]}})})});n.push(d)}else n.push(h.data());e!=null&&(p.group=e),t.push(p)},o=0;o<a.length;++o)i(o);return[4,Promise.all(n)];case 1:return s=c.sent(),[2,{data:yL(s),specs:t}]}})})}function x2(r,e){var t,n,a=new Ai(r),i={},o=0;try{for(var s=Ur(e),u=s.next();!u.done;u=s.next()){var c=u.value,l=vL(c,function(f,h){return a.slice(o+f,o+h)});i[c.name]=k2(c,a.slice(o,o+l)),o+=l}}catch(f){t={error:f}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}return i}function vL(r,e){var t=Dt(r.shape),n;if("quantization"in r){var a=r.quantization;n=zo[a.dtype]}else if(r.dtype==="string"){for(var i=0,o=0;o<t;o++)i+=to+new Uint32Array(e(i,i+to))[0];return i}else n=zo[r.dtype];return t*n}function mL(r,e){return $e(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c;return We(this,function(l){switch(l.label){case 0:return t=Dt(r.shape),"quantization"in r?(a=r.quantization,n=zo[a.dtype],[3,7]):[3,1];case 1:if(r.dtype!=="string")return[3,6];i=0,o=0,l.label=2;case 2:return o<t?(s=i,u=to,c=Uint32Array.bind,[4,e(i,i+to)]):[3,5];case 3:i=s+(u+new(c.apply(Uint32Array,[void 0,l.sent()]))()[0]),l.label=4;case 4:return o++,[3,2];case 5:return[2,i];case 6:n=zo[r.dtype],l.label=7;case 7:return[2,t*n]}})})}function k2(r,e){var t=r.name,n=r.dtype,a=r.shape,i=Dt(a),o,s=0;if("quantization"in r){var u=r.quantization;if(u.dtype==="uint8"||u.dtype==="uint16"){if(!("min"in u&&"scale"in u))throw new Error("Weight ".concat(r.name," with quantization ").concat(u.dtype," ")+"doesn't have corresponding metadata min and scale.")}else if(u.dtype==="float16"){if(n!=="float32")throw new Error("Weight ".concat(r.name," is quantized with ").concat(u.dtype," ")+"which only supports weights of type float32 not ".concat(n,"."))}else throw new Error("Weight ".concat(r.name," has unknown ")+"quantization dtype ".concat(u.dtype,". ")+"Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.");var c=zo[u.dtype],l=u.dtype==="uint8"?new Uint8Array(e):new Uint16Array(e);if(n==="float32")if(u.dtype==="uint8"||u.dtype==="uint16"){o=new Float32Array(l.length);for(var f=0;f<l.length;f++){var h=l[f];o[f]=h*u.scale+u.min}}else if(u.dtype==="float16"){var p=TL();o=p(l)}else throw new Error("Unsupported quantization type ".concat(u.dtype," ")+"for weight type float32.");else if(n==="int32"){if(u.dtype!=="uint8"&&u.dtype!=="uint16")throw new Error("Unsupported quantization type ".concat(u.dtype," ")+"for weight type int32.");o=new Int32Array(l.length);for(var f=0;f<l.length;f++){var h=l[f];o[f]=Math.round(h*u.scale+u.min)}}else throw new Error("Unsupported dtype in weight '".concat(t,"': ").concat(n));s+=i*c}else if(n==="string"){var d=Dt(r.shape);o=[];for(var f=0;f<d;f++){var m=new Uint32Array(e.slice(s,s+to))[0];s+=to;var v=new Uint8Array(e.slice(s,s+m));o.push(v),s+=m}}else{var g=zo[n];if(n==="float32")o=new Float32Array(e);else if(n==="int32")o=new Int32Array(e);else if(n==="bool")o=new Uint8Array(e);else if(n==="complex64"){o=new Float32Array(e);for(var y=new Float32Array(o.length/2),w=new Float32Array(o.length/2),f=0;f<y.length;f++)y[f]=o[f*2],w[f]=o[f*2+1];var b=Ys(y,a,"float32"),x=Ys(w,a,"float32"),S=eo(b,x);return b.dispose(),x.dispose(),S}else throw new Error("Unsupported dtype in weight '".concat(t,"': ").concat(n));s+=i*g}return Ys(o,a,n)}function zw(r,e,t){return $e(this,void 0,void 0,function(){var n,a,i,o,s,u;return We(this,function(c){switch(c.label){case 0:n=new Uint8Array(e),c.label=1;case 1:return n.byteLength<t?[4,r.read()]:[3,3];case 2:if(a=c.sent(),i=a.done,o=a.value,i&&o==null)throw s=t-n.byteLength,new Error("Reader is done but ".concat(s," bytes are still expected"));return u=new Uint8Array(n.length+o.byteLength),u.set(n,0),u.set(new Uint8Array(o),n.length),n=u,[3,1];case 3:return[2,n.buffer]}})})}function gL(r,e){return $e(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l,f,h,p,d,m=this;return We(this,function(v){switch(v.label){case 0:t={},n=r.getReader(),a=new ArrayBuffer(0),v.label=1;case 1:v.trys.push([1,7,8,9]),i=Ur(e),o=i.next(),v.label=2;case 2:return o.done?[3,6]:(s=o.value,[4,mL(s,function(g,y){return $e(m,void 0,void 0,function(){return We(this,function(w){switch(w.label){case 0:return[4,zw(n,a,y)];case 1:return a=w.sent(),[2,a.slice(g,y)]}})})})]);case 3:return u=v.sent(),[4,zw(n,a,u)];case 4:a=v.sent(),c=a.slice(0,u),a=a.slice(u),l=k2(s,c),t[s.name]=l,b2()==="webgpu"&&(f=w2(),"uploadToGPU"in f&&Dt(l.shape)>=st().get("WEBGPU_CPU_HANDOFF_SIZE_THRESHOLD")&&f.uploadToGPU(l.dataId)),v.label=5;case 5:return o=i.next(),[3,2];case 6:return[3,9];case 7:return h=v.sent(),p={error:h},[3,9];case 8:try{o&&!o.done&&(d=i.return)&&d.call(i)}finally{if(p)throw p.error}return[7];case 9:return[2,t]}})})}function yL(r){if(r===null)throw new Error("Invalid input value: ".concat(JSON.stringify(r)));var e=0,t=[];r.forEach(function(i){if(e+=i.byteLength,t.push(i.byteLength===i.buffer.byteLength?i:new i.constructor(i)),!(i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: ".concat(i.constructor.name))});var n=new Uint8Array(e),a=0;return t.forEach(function(i){n.set(new Uint8Array(i.buffer),a),a+=i.byteLength}),n.buffer}var Sv=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function $w(r){return Sv?Buffer.byteLength(r,"utf8"):new Blob([r]).size}function bL(r){if(Sv)return Buffer.from(r).toString("base64");for(var e=new Uint8Array(r),t="",n=0,a=e.length;n<a;n++)t+=String.fromCharCode(e[n]);return btoa(t)}function wL(r){if(Sv){var e=Buffer.from(r,"base64");return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}for(var t=atob(r),n=new Uint8Array(t.length),a=0;a<t.length;++a)n.set([t.charCodeAt(a)],a);return n.buffer}function xL(r){return Ai.join(r)}function Ww(r){var e="/";for(r=r.trim();r.endsWith(e);)r=r.slice(0,r.length-1);var t=r.split(e);return t[t.length-1]}function S2(r,e){var t={modelTopology:r.modelTopology,format:r.format,generatedBy:r.generatedBy,convertedBy:r.convertedBy,weightsManifest:e};return r.signature!=null&&(t.signature=r.signature),r.userDefinedMetadata!=null&&(t.userDefinedMetadata=r.userDefinedMetadata),r.modelInitializer!=null&&(t.modelInitializer=r.modelInitializer),r.initializerSignature!=null&&(t.initializerSignature=r.initializerSignature),r.trainingConfig!=null&&(t.trainingConfig=r.trainingConfig),t}function E2(r,e,t){var n={modelTopology:r.modelTopology,format:r.format,generatedBy:r.generatedBy,convertedBy:r.convertedBy};if(r.trainingConfig!=null&&(n.trainingConfig=r.trainingConfig),r.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!t)throw new Error("modelJSON has weightsManifest but weightData is null");n.weightSpecs=e,n.weightData=t}return r.signature!=null&&(n.signature=r.signature),r.userDefinedMetadata!=null&&(n.userDefinedMetadata=r.userDefinedMetadata),r.modelInitializer!=null&&(n.modelInitializer=r.modelInitializer),r.initializerSignature!=null&&(n.initializerSignature=r.initializerSignature),n}function Ev(r,e){return $e(this,void 0,void 0,function(){var t,n,a;return We(this,function(i){switch(i.label){case 0:return r.weightsManifest==null?[3,2]:[4,e(r.weightsManifest)];case 1:a=ke.apply(void 0,[i.sent(),2]),t=a[0],n=a[1],i.label=2;case 2:return[2,E2(r,t,n)]}})})}function Wc(r){if(r.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:r.modelTopology==null?0:$w(JSON.stringify(r.modelTopology)),weightSpecsBytes:r.weightSpecs==null?0:$w(JSON.stringify(r.weightSpecs)),weightDataBytes:r.weightData==null?0:new Ai(r.weightData).byteLength}}function Jd(r){var e,t,n=[];try{for(var a=Ur(r),i=a.next();!i.done;i=a.next()){var o=i.value;n.push.apply(n,pt([],ke(o.weights),!1))}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return n}function kL(){var r=function(n){for(var a=n<<13,i=0;(a&8388608)===0;)i-=8388608,a<<=1;return a&=-8388609,i+=947912704,a|i},e=new Uint32Array(2048);e[0]=0;for(var t=1;t<1024;t++)e[t]=r(t);for(var t=1024;t<2048;t++)e[t]=939524096+(t-1024<<13);return e}function SL(){var r=new Uint32Array(64);r[0]=0,r[31]=1199570944,r[32]=2147483648,r[63]=3347054592;for(var e=1;e<31;e++)r[e]=e<<23;for(var e=33;e<63;e++)r[e]=2147483648+(e-32<<23);return r}function EL(){for(var r=new Uint32Array(64),e=0;e<64;e++)r[e]=1024;return r[0]=r[32]=0,r}function TL(){var r=kL(),e=SL(),t=EL();return function(n){for(var a=new ArrayBuffer(4*n.length),i=new Uint32Array(a),o=0;o<n.length;o++){var s=n[o],u=r[t[s>>10]+(s&1023)]+e[s>>10];i[o]=u}return new Float32Array(a)}}var Jn=(function(){function r(){this.saveRouters=[],this.loadRouters=[]}return r.getInstance=function(){return r.instance==null&&(r.instance=new r),r.instance},r.registerSaveRouter=function(e){r.getInstance().saveRouters.push(e)},r.registerLoadRouter=function(e){r.getInstance().loadRouters.push(e)},r.getSaveHandlers=function(e){return r.getHandlers(e,"save")},r.getLoadHandlers=function(e,t){return r.getHandlers(e,"load",t)},r.getHandlers=function(e,t,n){var a=[],i=t==="load"?r.getInstance().loadRouters:r.getInstance().saveRouters;return i.forEach(function(o){var s=o(e,n);s!==null&&a.push(s)}),a},r})(),NL=function(r){return Jn.registerSaveRouter(r)},IL=function(r){return Jn.registerLoadRouter(r)},CL=function(r){return Jn.getSaveHandlers(r)},AL=function(r,e){return Jn.getLoadHandlers(r,e)},Qd="tensorflowjs",ev=1,Mo="models_store",Xi="model_info_store";function T2(){if(!st().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var r=typeof window>"u"?self:window,e=r.indexedDB||r.mozIndexedDB||r.webkitIndexedDB||r.msIndexedDB||r.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function tv(r){var e=r.result;e.createObjectStore(Mo,{keyPath:"modelPath"}),e.createObjectStore(Xi,{keyPath:"modelPath"})}var $o=(function(){function r(e){if(this.indexedDB=T2(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return r.prototype.save=function(e){return $e(this,void 0,void 0,function(){return We(this,function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]})})},r.prototype.load=function(){return $e(this,void 0,void 0,function(){return We(this,function(e){return[2,this.databaseAction(this.modelPath)]})})},r.prototype.databaseAction=function(e,t){var n=this;return new Promise(function(a,i){var o=n.indexedDB.open(Qd,ev);o.onupgradeneeded=function(){return tv(o)},o.onsuccess=function(){var s=o.result;if(t==null){var u=s.transaction(Mo,"readonly"),c=u.objectStore(Mo),l=c.get(n.modelPath);l.onsuccess=function(){if(l.result==null)return s.close(),i(new Error("Cannot find model with path '".concat(n.modelPath,"' ")+"in IndexedDB."));a(l.result.modelArtifacts)},l.onerror=function(v){return s.close(),i(l.error)},u.oncomplete=function(){return s.close()}}else{t.weightData=Ai.join(t.weightData);var f=Wc(t),h=s.transaction(Xi,"readwrite"),p=h.objectStore(Xi),d;try{d=p.put({modelPath:n.modelPath,modelArtifactsInfo:f})}catch(v){return i(v)}var m;d.onsuccess=function(){m=s.transaction(Mo,"readwrite");var v=m.objectStore(Mo),g;try{g=v.put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:f})}catch(y){return i(y)}g.onsuccess=function(){return a({modelArtifactsInfo:f})},g.onerror=function(y){p=h.objectStore(Xi);var w=p.delete(n.modelPath);w.onsuccess=function(){return s.close(),i(g.error)},w.onerror=function(b){return s.close(),i(g.error)}}},d.onerror=function(v){return s.close(),i(d.error)},h.oncomplete=function(){m==null?s.close():m.oncomplete=function(){return s.close()}}}},o.onerror=function(s){return i(o.error)}})},r})();$o.URL_SCHEME="indexeddb://";var N2=function(r){return st().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith($o.URL_SCHEME)?DL(r.slice($o.URL_SCHEME.length)):null};Jn.registerSaveRouter(N2);Jn.registerLoadRouter(N2);function DL(r){return new $o(r)}function _L(r){return r.startsWith($o.URL_SCHEME)?r.slice($o.URL_SCHEME.length):r}var FL=(function(){function r(){this.indexedDB=T2()}return r.prototype.listModels=function(){return $e(this,void 0,void 0,function(){var e=this;return We(this,function(t){return[2,new Promise(function(n,a){var i=e.indexedDB.open(Qd,ev);i.onupgradeneeded=function(){return tv(i)},i.onsuccess=function(){var o=i.result,s=o.transaction(Xi,"readonly"),u=s.objectStore(Xi),c=u.getAll();c.onsuccess=function(){var l,f,h={};try{for(var p=Ur(c.result),d=p.next();!d.done;d=p.next()){var m=d.value;h[m.modelPath]=m.modelArtifactsInfo}}catch(v){l={error:v}}finally{try{d&&!d.done&&(f=p.return)&&f.call(p)}finally{if(l)throw l.error}}n(h)},c.onerror=function(l){return o.close(),a(c.error)},s.oncomplete=function(){return o.close()}},i.onerror=function(o){return a(i.error)}})]})})},r.prototype.removeModel=function(e){return $e(this,void 0,void 0,function(){var t=this;return We(this,function(n){return e=_L(e),[2,new Promise(function(a,i){var o=t.indexedDB.open(Qd,ev);o.onupgradeneeded=function(){return tv(o)},o.onsuccess=function(){var s=o.result,u=s.transaction(Xi,"readwrite"),c=u.objectStore(Xi),l=c.get(e),f;l.onsuccess=function(){if(l.result==null)return s.close(),i(new Error("Cannot find model with path '".concat(e,"' ")+"in IndexedDB."));var h=c.delete(e),p=function(){f=s.transaction(Mo,"readwrite");var d=f.objectStore(Mo),m=d.delete(e);m.onsuccess=function(){return a(l.result.modelArtifactsInfo)},m.onerror=function(v){return i(l.error)}};h.onsuccess=p,h.onerror=function(d){return p(),s.close(),i(l.error)}},l.onerror=function(h){return s.close(),i(l.error)},u.oncomplete=function(){f==null?s.close():f.oncomplete=function(){return s.close()}}},o.onerror=function(s){return i(o.error)}})]})})},r})(),Ei="/",qs="tensorflowjs_models",I2="info",RL="model_topology",OL="weight_specs",PL="weight_data",ML="model_metadata";function C2(r){return{info:[qs,r,I2].join(Ei),topology:[qs,r,RL].join(Ei),weightSpecs:[qs,r,OL].join(Ei),weightData:[qs,r,PL].join(Ei),modelMetadata:[qs,r,ML].join(Ei)}}function A2(r){var e,t;try{for(var n=Ur(Object.values(r)),a=n.next();!a.done;a=n.next()){var i=a.value;window.localStorage.removeItem(i)}}catch(o){e={error:o}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}}function BL(r){var e=r.split(Ei);if(e.length<3)throw new Error("Invalid key format: ".concat(r));return e.slice(1,e.length-1).join(Ei)}function LL(r){return r.startsWith(Wo.URL_SCHEME)?r.slice(Wo.URL_SCHEME.length):r}var Wo=(function(){function r(e){if(!st().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=C2(this.modelPath)}return r.prototype.save=function(e){return $e(this,void 0,void 0,function(){var t,n,a,i,o;return We(this,function(s){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),a=Wc(e),i=Ai.join(e.weightData);try{return this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,bL(i)),o={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0},this.LS.setItem(this.keys.modelMetadata,JSON.stringify(o)),[2,{modelArtifactsInfo:a}]}catch{throw A2(this.keys),new Error("Failed to save model '".concat(this.modelPath,"' to local storage: ")+"size quota being exceeded is a possible cause of this failure: "+"modelTopologyBytes=".concat(a.modelTopologyBytes,", ")+"weightSpecsBytes=".concat(a.weightSpecsBytes,", ")+"weightDataBytes=".concat(a.weightDataBytes,"."))}return[2]})})},r.prototype.load=function(){return $e(this,void 0,void 0,function(){var e,t,n,a,i,o,s;return We(this,function(u){if(e=JSON.parse(this.LS.getItem(this.keys.info)),e==null)throw new Error("In local storage, there is no model with name '".concat(this.modelPath,"'"));if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},n=JSON.parse(this.LS.getItem(this.keys.topology)),n==null)throw new Error("In local storage, the topology of model '".concat(this.modelPath,"' ")+"is missing.");if(t.modelTopology=n,a=JSON.parse(this.LS.getItem(this.keys.weightSpecs)),a==null)throw new Error("In local storage, the weight specs of model '".concat(this.modelPath,"' ")+"are missing.");if(t.weightSpecs=a,i=this.LS.getItem(this.keys.modelMetadata),i!=null&&(o=JSON.parse(i),t.format=o.format,t.generatedBy=o.generatedBy,t.convertedBy=o.convertedBy,o.signature!=null&&(t.signature=o.signature),o.userDefinedMetadata!=null&&(t.userDefinedMetadata=o.userDefinedMetadata),o.modelInitializer!=null&&(t.modelInitializer=o.modelInitializer),o.initializerSignature!=null&&(t.initializerSignature=o.initializerSignature),o.trainingConfig!=null&&(t.trainingConfig=o.trainingConfig)),s=this.LS.getItem(this.keys.weightData),s==null)throw new Error("In local storage, the binary weight values of model "+"'".concat(this.modelPath,"' are missing."));return t.weightData=wL(s),[2,t]})})},r})();Wo.URL_SCHEME="localstorage://";var D2=function(r){return st().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(Wo.URL_SCHEME)?zL(r.slice(Wo.URL_SCHEME.length)):null};Jn.registerSaveRouter(D2);Jn.registerLoadRouter(D2);function zL(r){return new Wo(r)}var $L=(function(){function r(){W(st().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),W(typeof window>"u"||typeof window.localStorage<"u",function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return r.prototype.listModels=function(){return $e(this,void 0,void 0,function(){var e,t,n,a,i,o;return We(this,function(s){for(e={},t=qs+Ei,n=Ei+I2,a=0;a<this.LS.length;++a)i=this.LS.key(a),i.startsWith(t)&&i.endsWith(n)&&(o=BL(i),e[o]=JSON.parse(this.LS.getItem(i)));return[2,e]})})},r.prototype.removeModel=function(e){return $e(this,void 0,void 0,function(){var t,n;return We(this,function(a){if(e=LL(e),t=C2(e),this.LS.getItem(t.info)==null)throw new Error("Cannot find model at path '".concat(e,"'"));return n=JSON.parse(this.LS.getItem(t.info)),A2(t),[2,n]})})},r})(),Zs="://",ro=(function(){function r(){this.managers={}}return r.getInstance=function(){return r.instance==null&&(r.instance=new r),r.instance},r.registerManager=function(e,t){W(e!=null,function(){return"scheme must not be undefined or null."}),e.endsWith(Zs)&&(e=e.slice(0,e.indexOf(Zs))),W(e.length>0,function(){return"scheme must not be an empty string."});var n=r.getInstance();W(n.managers[e]==null,function(){return"A model store manager is already registered for scheme '".concat(e,"'.")}),n.managers[e]=t},r.getManager=function(e){var t=r.getInstance().managers[e];if(t==null)throw new Error("Cannot find model manager for scheme '".concat(e,"'"));return t},r.getSchemes=function(){return Object.keys(r.getInstance().managers)},r})();function Cf(r){if(r.indexOf(Zs)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+"".concat(ro.getSchemes().join(",")));return{scheme:r.split(Zs)[0],path:r.split(Zs)[1]}}function _2(r,e,t){return t===void 0&&(t=!1),$e(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f;return We(this,function(h){switch(h.label){case 0:return W(r!==e,function(){return"Old path and new path are the same: '".concat(r,"'")}),n=Jn.getLoadHandlers(r),W(n.length>0,function(){return"Copying failed because no load handler is found for source URL ".concat(r,".")}),W(n.length<2,function(){return"Copying failed because more than one (".concat(n.length,") ")+"load handlers for source URL ".concat(r,".")}),a=n[0],i=Jn.getSaveHandlers(e),W(i.length>0,function(){return"Copying failed because no save handler is found for destination "+"URL ".concat(e,".")}),W(i.length<2,function(){return"Copying failed because more than one (".concat(n.length,") ")+"save handlers for destination URL ".concat(e,".")}),o=i[0],s=Cf(r).scheme,u=Cf(r).path,c=s===Cf(r).scheme,[4,a.load()];case 1:return l=h.sent(),t&&c?[4,ro.getManager(s).removeModel(u)]:[3,3];case 2:h.sent(),h.label=3;case 3:return[4,o.save(l)];case 4:return f=h.sent(),t&&!c?[4,ro.getManager(s).removeModel(u)]:[3,6];case 5:h.sent(),h.label=6;case 6:return[2,f.modelArtifactsInfo]}})})}function WL(){return $e(this,void 0,void 0,function(){var r,e,t,n,a,i,o,s,u,c,l;return We(this,function(f){switch(f.label){case 0:r=ro.getSchemes(),e={},f.label=1;case 1:f.trys.push([1,6,7,8]),t=Ur(r),n=t.next(),f.label=2;case 2:return n.done?[3,5]:(a=n.value,[4,ro.getManager(a).listModels()]);case 3:i=f.sent();for(o in i)s=a+Zs+o,e[s]=i[o];f.label=4;case 4:return n=t.next(),[3,2];case 5:return[3,8];case 6:return u=f.sent(),c={error:u},[3,8];case 7:try{n&&!n.done&&(l=t.return)&&l.call(t)}finally{if(c)throw c.error}return[7];case 8:return[2,e]}})})}function GL(r){return $e(this,void 0,void 0,function(){var e,t;return We(this,function(n){return e=Cf(r),t=ro.getManager(e.scheme),[2,t.removeModel(e.path)]})})}function VL(r,e){return $e(this,void 0,void 0,function(){var t;return We(this,function(n){return t=!1,[2,_2(r,e,t)]})})}function UL(r,e){return $e(this,void 0,void 0,function(){var t;return We(this,function(n){return t=!0,[2,_2(r,e,t)]})})}var HL=(function(){function r(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}return r.prototype.fetch=function(e,t){return fetch(e,t)},r.prototype.now=function(){return performance.now()},r.prototype.encode=function(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got ".concat(t));return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)},r.prototype.decode=function(e,t){return new TextDecoder(t).decode(e)},r.prototype.setTimeoutCustom=function(e,t){var n=this;if(typeof window>"u"||!st().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,t);return}this.functionRefs.push(e),setTimeout(function(){window.postMessage({name:n.messageName,index:n.functionRefs.length-1},"*")},t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",function(a){if(a.source===window&&a.data.name===n.messageName){a.stopPropagation();var i=n.functionRefs[a.data.index];i(),n.handledMessageCount++,n.handledMessageCount===n.functionRefs.length&&(n.functionRefs=[],n.handledMessageCount=0)}},!0))},r.prototype.isTypedArray=function(e){return Qk(e)},r})();if(st().get("IS_BROWSER")){st().setPlatform("browser",new HL);try{ro.registerManager(Wo.URL_SCHEME,new $L)}catch{}try{ro.registerManager($o.URL_SCHEME,new FL)}catch{}}var qL={importFetch:function(){return Cw()}},Md,KL=(function(){function r(){this.util=vc("util"),this.textEncoder=new this.util.TextEncoder}return r.prototype.fetch=function(e,t){return st().global.fetch!=null?st().global.fetch(e,t):(Md==null&&(Md=qL.importFetch()),Md(e,t))},r.prototype.now=function(){var e=process.hrtime();return e[0]*1e3+e[1]/1e6},r.prototype.encode=function(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got ".concat(t));return this.textEncoder.encode(e)},r.prototype.decode=function(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)},r.prototype.isTypedArray=function(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)},r})();st().get("IS_NODE")&&!st().get("IS_BROWSER")&&st().setPlatform("node",new KL);function Ti(r,e,t){return e===void 0&&(e="float32"),e=e||"float32",Dn(r),new Mf(r,e,t)}function jL(r,e){var t=O(r,"x","cast");if(!r1(e))throw new Error("Failed to cast to unknown dtype ".concat(e));if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");var n={x:t},a={dtype:e};return q.runKernel(vv,n,a)}var Wt=H({cast_:jL});function XL(r){var e=O(r,"x","clone","string_or_numeric"),t={x:e};return q.runKernel(gv,t)}var Lo=H({clone_:XL});function F2(r,e){e===void 0&&(e=!1),console.log(r.toString(e))}d2();var YL={buffer:Ti,cast:Wt,clone:Lo,print:F2};LB(YL);function ZL(r,e){var t,n=O(r,"a","add"),a=O(e,"b","add");t=ke(or(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return q.runKernel(dv,i)}var at=H({add_:ZL});function JL(r,e){var t,n=O(r,"a","floorDiv"),a=O(e,"b","floorDiv");t=ke(or(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return q.runKernel(cx,i)}var R2=H({floorDiv_:JL});function QL(r,e){var t,n=O(r,"a","div"),a=O(e,"b","div");if(t=ke(or(n,a),2),n=t[0],a=t[1],n.dtype==="int32"&&a.dtype==="int32")return R2(n,a);var i={a:n,b:a},o={};return q.runKernel(Z1,i,o)}var Lt=H({div_:QL});function e4(r,e){var t,n=O(r,"a","mul"),a=O(e,"b","mul");t=ke(or(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return q.runKernel(Wx,i)}var Pe=H({mul_:e4});function t4(r){var e=O(r,"x","abs");if(e.dtype==="complex64"){var t={x:e};return q.runKernel(F1,t)}else{var t={x:e};return q.runKernel(c1,t)}}var Yn=H({abs_:t4});function r4(r){var e=O(r,"x","acos"),t={x:e};return q.runKernel(l1,t)}var n4=H({acos_:r4});function a4(r){var e=O(r,"x","acosh"),t={x:e};return q.runKernel(f1,t)}var i4=H({acosh_:a4});function o4(r){W(Array.isArray(r),function(){return"The argument passed to tf.addN() must be a list of tensors"}),W(r.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+"".concat(r.length)});var e=r.map(function(a,i){return O(a,"tensors".concat(i),"addN")}),t=e[0];e.forEach(function(a){if(a.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(function(a){if(!Ci(a.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var n=e;return q.runKernel(h1,n)}var s4=H({addN_:o4});function u4(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=O(r,"x","all","bool"),a={x:n},i={axis:e,keepDims:t};return q.runKernel(p1,a,i)}var c4=H({all_:u4});function l4(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=O(r,"x","any","bool"),a={x:n},i={axis:e,keepDims:t};return q.runKernel(d1,a,i)}var f4=H({any_:l4});function h4(r,e){e===void 0&&(e=0);var t=O(r,"x","argMax"),n={x:t},a={axis:e};return q.runKernel(v1,n,a)}var p4=H({argMax_:h4});function d4(r,e){e===void 0&&(e=0);var t=O(r,"x","argMin"),n={x:t},a={axis:e};return q.runKernel(m1,n,a)}var v4=H({argMin_:d4});function m4(r){var e=O(r,"x","asin"),t={x:e};return q.runKernel(g1,t)}var g4=H({asin_:m4});function y4(r){var e=O(r,"x","asinh"),t={x:e};return q.runKernel(y1,t)}var b4=H({asinh_:y4});function w4(r){var e=O(r,"x","atan"),t={x:e};return q.runKernel(b1,t)}var x4=H({atan_:w4});function k4(r,e){var t,n=O(r,"a","atan2"),a=O(e,"b","atan2");t=ke(or(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return q.runKernel(x1,i)}var S4=H({atan2_:k4});function E4(r){var e=O(r,"x","atanh"),t={x:e};return q.runKernel(w1,t)}var T4=H({atanh_:E4});function N4(r,e,t,n,a,i){a===void 0&&(a="NHWC");var o=r[3],s=pt(pt([],ke(e),!1),[o],!1),u=M2(a);return Gc(r,s,t,i,n,null,null,u)}function O2(r,e,t,n,a,i,o){o===void 0&&(o="channelsLast");var s=ke(Cc(e),2),u=s[0],c=s[1],l;if(o==="channelsLast")l=[u,c,r[3],r[3]];else if(o==="channelsFirst")l=[u,c,r[1],r[1]];else throw new Error("Unknown dataFormat ".concat(o));return Gc(r,l,t,n,a,i,!1,o)}function I4(r,e,t,n,a,i,o){o===void 0&&(o="NDHWC");var s=ke(rv(e),3),u=s[0],c=s[1],l=s[2],f,h;if(o==="NDHWC")h="channelsLast",f=[u,c,l,r[4],r[4]];else if(o==="NCDHW")h="channelsFirst",f=[u,c,l,r[1],r[1]];else throw new Error("Unknown dataFormat ".concat(o));return P2(r,f,t,n,a,!1,h,i)}function Gc(r,e,t,n,a,i,o,s){var u,c;o===void 0&&(o=!1),s===void 0&&(s="channelsLast");var l=ke([-1,-1,-1,-1],4),f=l[0],h=l[1],p=l[2],d=l[3];if(s==="channelsLast")u=ke(r,4),f=u[0],h=u[1],p=u[2],d=u[3];else if(s==="channelsFirst")c=ke(r,4),f=c[0],d=c[1],h=c[2],p=c[3];else throw new Error("Unknown dataFormat ".concat(s));var m=ke(e,4),v=m[0],g=m[1],y=m[3],w=ke(Cc(t),2),b=w[0],x=w[1],S=ke(Cc(n),2),T=S[0],N=S[1],C=Js(v,T),R=Js(g,N),_=D4(a,h,p,b,x,C,R,i,s),P=_.padInfo,$=_.outHeight,z=_.outWidth,L=o?y*d:y,B;return s==="channelsFirst"?B=[f,L,$,z]:s==="channelsLast"&&(B=[f,$,z,L]),{batchSize:f,dataFormat:s,inHeight:h,inWidth:p,inChannels:d,outHeight:$,outWidth:z,outChannels:L,padInfo:P,strideHeight:b,strideWidth:x,filterHeight:v,filterWidth:g,effectiveFilterHeight:C,effectiveFilterWidth:R,dilationHeight:T,dilationWidth:N,inShape:r,outShape:B,filterShape:e}}function P2(r,e,t,n,a,i,o,s){var u,c;i===void 0&&(i=!1),o===void 0&&(o="channelsLast");var l=ke([-1,-1,-1,-1,-1],5),f=l[0],h=l[1],p=l[2],d=l[3],m=l[4];if(o==="channelsLast")u=ke(r,5),f=u[0],h=u[1],p=u[2],d=u[3],m=u[4];else if(o==="channelsFirst")c=ke(r,5),f=c[0],m=c[1],h=c[2],p=c[3],d=c[4];else throw new Error("Unknown dataFormat ".concat(o));var v=ke(e,5),g=v[0],y=v[1],w=v[2],b=v[4],x=ke(rv(t),3),S=x[0],T=x[1],N=x[2],C=ke(rv(n),3),R=C[0],_=C[1],P=C[2],$=Js(g,R),z=Js(y,_),L=Js(w,P),B=_4(a,h,p,d,S,T,N,$,z,L,s),G=B.padInfo,X=B.outDepth,Z=B.outHeight,V=B.outWidth,j=i?b*m:b,re;return o==="channelsFirst"?re=[f,j,X,Z,V]:o==="channelsLast"&&(re=[f,X,Z,V,j]),{batchSize:f,dataFormat:o,inDepth:h,inHeight:p,inWidth:d,inChannels:m,outDepth:X,outHeight:Z,outWidth:V,outChannels:j,padInfo:G,strideDepth:S,strideHeight:T,strideWidth:N,filterDepth:g,filterHeight:y,filterWidth:w,effectiveFilterDepth:$,effectiveFilterHeight:z,effectiveFilterWidth:L,dilationDepth:R,dilationHeight:_,dilationWidth:P,inShape:r,outShape:re,filterShape:e}}function C4(r,e,t,n,a){n==null&&(n=Tv(r,e,t));var i=r[0],o=r[1],s=Ac((i-e+2*n)/t+1,a),u=Ac((o-e+2*n)/t+1,a);return[s,u]}function A4(r,e,t,n,a,i){a==null&&(a=Tv(r,e[0],n[0]));for(var o=[0,0,0,t],s=0;s<3;s++)r[s]+2*a>=e[s]&&(o[s]=Ac((r[s]-e[s]+2*a)/n[s]+1,i));return o}function Tv(r,e,t,n){n===void 0&&(n=1);var a=Js(e,n);return Math.floor((r[0]*(t-1)-t+a)/2)}function Cc(r){return typeof r=="number"?[r,r,r]:r.length===2?[r[0],r[1],1]:r}function rv(r){return typeof r=="number"?[r,r,r]:r}function Js(r,e){return e<=1?r:r+(r-1)*(e-1)}function D4(r,e,t,n,a,i,o,s,u){var c,l,f;if(typeof r=="number"){var h=r===0?"VALID":"NUMBER";c={top:r,bottom:r,left:r,right:r,type:h};var p=C4([e,t],i,n,r,s);l=p[0],f=p[1]}else if(r==="same"){l=Math.ceil(e/n),f=Math.ceil(t/a);var d=Math.max(0,(l-1)*n+i-e),m=Math.max(0,(f-1)*a+o-t),v=Math.floor(d/2),g=d-v,y=Math.floor(m/2),w=m-y;c={top:v,bottom:g,left:y,right:w,type:"SAME"}}else if(r==="valid")c={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((e-i+1)/n),f=Math.ceil((t-o+1)/a);else if(typeof r=="object"){var v=u==="channelsLast"?r[1][0]:r[2][0],g=u==="channelsLast"?r[1][1]:r[2][1],y=u==="channelsLast"?r[2][0]:r[3][0],w=u==="channelsLast"?r[2][1]:r[3][1],h=v===0&&g===0&&y===0&&w===0?"VALID":"EXPLICIT";c={top:v,bottom:g,left:y,right:w,type:h},l=Ac((e-i+v+g)/n+1,s),f=Ac((t-o+y+w)/a+1,s)}else throw Error("Unknown padding parameter: ".concat(r));return{padInfo:c,outHeight:l,outWidth:f}}function _4(r,e,t,n,a,i,o,s,u,c,l){var f,h,p,d;if(r==="valid"&&(r=0),typeof r=="number"){var m=r===0?"VALID":"NUMBER";f={top:r,bottom:r,left:r,right:r,front:r,back:r,type:m};var v=A4([e,t,n,1],[s,u,c],1,[a,i,o],r,l);h=v[0],p=v[1],d=v[2]}else if(r==="same"){h=Math.ceil(e/a),p=Math.ceil(t/i),d=Math.ceil(n/o);var g=(h-1)*a+s-e,y=(p-1)*i+u-t,w=(d-1)*o+c-n,b=Math.floor(g/2),x=g-b,S=Math.floor(y/2),T=y-S,N=Math.floor(w/2),C=w-N;f={top:S,bottom:T,left:N,right:C,front:b,back:x,type:"SAME"}}else throw Error("Unknown padding parameter: ".concat(r));return{padInfo:f,outDepth:h,outHeight:p,outWidth:d}}function Ac(r,e){if(!e)return Math.trunc(r);switch(e){case"round":return Math.round(r);case"ceil":return Math.ceil(r);case"floor":return Math.floor(r);default:throw new Error("Unknown roundingMode ".concat(e))}}function Dc(r){var e=ke(Cc(r),3),t=e[0],n=e[1],a=e[2];return t===1&&n===1&&a===1}function Di(r,e){return Dc(r)||Dc(e)}function Go(r){return Cc(r).every(function(e){return e>0})}function M2(r){if(r==="NHWC")return"channelsLast";if(r==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat ".concat(r))}function da(r,e,t){if(t!=null){if(typeof e=="string")throw Error("Error in ".concat(r,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(e,"."));if(typeof e=="number")W(tu(e),function(){return"Error in ".concat(r,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(e,".")});else if(typeof e=="object")e.forEach(function(n){n.forEach(function(a){W(tu(a),function(){return"Error in ".concat(r,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(a,".")})})});else throw Error("Error in ".concat(r,": Unknown padding parameter: ").concat(e))}}function F4(r,e){var t=O(r,"x","reshape","string_or_numeric"),n={x:t},a={shape:e};return q.runKernel(sk,n,a)}var ve=H({reshape_:F4});function R4(r,e,t,n,a){var i=O(r,"x","avgPool","float32"),o=1;W(Di(t,o),function(){return"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(o,"'")});var s=i,u=!1;i.rank===3&&(u=!0,s=ve(i,[1,i.shape[0],i.shape[1],i.shape[2]])),W(s.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank ".concat(s.rank,".")}),da("avgPool",n,a);var c={x:s},l={filterSize:e,strides:t,pad:n,dimRoundingMode:a},f=q.runKernel(k1,c,l);return f=Wt(f,i.dtype),u?ve(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var B2=H({avgPool_:R4});function O4(r,e,t,n,a,i){i===void 0&&(i="NDHWC");var o=O(r,"x","avgPool3d","float32"),s=o,u=!1;o.rank===4&&(u=!0,s=ve(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),W(s.rank===5,function(){return"Error in avgPool3d: x must be rank 5 but got rank ".concat(s.rank,".")}),W(i==="NDHWC",function(){return"Error in avgPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(i)}),W(typeof t=="number"&&t>0||Array.isArray(t)&&t[0]>0&&t[1]>0&&t[2]>0,function(){return"Error in avgPool3d: Stride must be > 0, but got '".concat(t,"'")}),da("avgPool3d",n,a);var c={x:s},l={filterSize:e,strides:t,pad:n,dimRoundingMode:a,dataFormat:i},f=q.runKernel(S1,c,l);return f=Wt(f,s.dtype),u?ve(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}var P4=H({avgPool3d_:O4});function M4(r,e){e===void 0&&(e=0),W(r.length>=1,function(){return"Pass at least one tensor to concat"});var t=Ic(r,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(function(i){if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `.concat(i.dtype,". "))}),t.length===1)return Lo(t[0]);var n=t,a={axis:e};return q.runKernel(R1,n,a)}var An=H({concat_:M4});function B4(r,e,t,n){var a;t===void 0&&(t=!1),n===void 0&&(n=!1);var i=O(r,"a","matMul"),o=O(e,"b","matMul");a=ke(or(i,o),2),i=a[0],o=a[1];var s={a:i,b:o},u={transposeA:t,transposeB:n};return q.runKernel(E1,s,u)}var Nt=H({matMul_:B4});function L4(r){var e=O(r,"x","sigmoid","float32"),t={x:e};return q.runKernel(Sk,t)}var Qs=H({sigmoid_:L4});function z4(r,e,t){var n=O(r,"x","slice","string_or_numeric");if(n.rank===0)throw new Error("Slicing scalar is not possible");var a={x:n},i={begin:e,size:t};return q.runKernel(bk,a,i)}var Jt=H({slice_:z4});function $4(r){var e=O(r,"x","tanh","float32"),t={x:e};return q.runKernel(Vk,t)}var nv=H({tanh_:$4});function W4(r,e,t,n,a,i){var o=O(r,"forgetBias","basicLSTMCell"),s=O(e,"lstmKernel","basicLSTMCell"),u=O(t,"lstmBias","basicLSTMCell"),c=O(n,"data","basicLSTMCell"),l=O(a,"c","basicLSTMCell"),f=O(i,"h","basicLSTMCell"),h=An([c,f],1),p=Nt(h,s),d=at(p,u),m=d.shape[0],v=d.shape[1]/4,g=[m,v],y=Jt(d,[0,0],g),w=Jt(d,[0,v],g),b=Jt(d,[0,v*2],g),x=Jt(d,[0,v*3],g),S=at(Pe(Qs(y),nv(w)),Pe(l,Qs(at(o,b)))),T=Pe(nv(S),Qs(x));return[S,T]}var G4=H({basicLSTMCell_:W4});function V4(r,e,t){var n=O(r,"x","batchToSpaceND"),a=e.reduce(function(s,u){return s*u});W(n.rank>=1+e.length,function(){return"input rank is ".concat(n.rank," but should be > than blockShape.length ").concat(e.length)}),W(t.length===e.length,function(){return"crops.length is ".concat(t.length," but should be equal to blockShape.length  ").concat(e.length)}),W(n.shape[0]%a===0,function(){return"input tensor batch is ".concat(n.shape[0]," but is not divisible by the product of ")+"the elements of blockShape ".concat(e.join(" * ")," === ").concat(a)});var i={x:n},o={blockShape:e,crops:t};return q.runKernel(T1,i,o)}var L2=H({batchToSpaceND_:V4});function U4(r){var e;return r.rank===0||r.rank===1?e=ve(r,[1,1,1,r.size]):r.rank===2?e=ve(r,[1,1,r.shape[0],r.shape[1]]):r.rank===3?e=ve(r,[1,r.shape[0],r.shape[1],r.shape[2]]):e=r,e}function H4(r,e,t,n,a,i){i==null&&(i=.001);var o=O(r,"x","batchNorm"),s=O(e,"mean","batchNorm"),u=O(t,"variance","batchNorm"),c;a!=null&&(c=O(a,"scale","batchNorm"));var l;n!=null&&(l=O(n,"offset","batchNorm")),W(s.rank===u.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),W(l==null||s.rank===l.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),W(c==null||s.rank===c.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."});var f=U4(o),h={x:f,scale:c,offset:l,mean:s,variance:u},p={varianceEpsilon:i},d=q.runKernel(lx,h,p);return ve(d,o.shape)}var Kf=H({batchNorm_:H4});function q4(r,e,t,n,a,i){var o=O(r,"x","batchNorm"),s=O(e,"mean","batchNorm"),u=O(t,"variance","batchNorm"),c;a!=null&&(c=O(a,"scale","batchNorm"));var l;return n!=null&&(l=O(n,"offset","batchNorm")),W(o.rank===2,function(){return"Error in batchNorm2D: x must be rank 2 but got rank "+"".concat(o.rank,".")}),W(s.rank===2||s.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but "+"got rank ".concat(s.rank,".")}),W(u.rank===2||u.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 "+"but got rank ".concat(u.rank,".")}),c!=null&&W(c.rank===2||c.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 "+"but got rank ".concat(c.rank,".")}),l!=null&&W(l.rank===2||l.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 "+"but got rank ".concat(l.rank,".")}),Kf(o,s,u,l,c,i)}var K4=H({batchNorm2d_:q4});function j4(r,e,t,n,a,i){var o=O(r,"x","batchNorm"),s=O(e,"mean","batchNorm"),u=O(t,"variance","batchNorm"),c;a!=null&&(c=O(a,"scale","batchNorm"));var l;return n!=null&&(l=O(n,"offset","batchNorm")),W(o.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+"".concat(o.rank,".")}),W(s.rank===3||s.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but "+"got rank ".concat(s.rank,".")}),W(u.rank===3||u.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 "+"but got rank ".concat(u.rank,".")}),c!=null&&W(c.rank===3||c.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 "+"but got rank ".concat(c.rank,".")}),l!=null&&W(l.rank===3||l.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 "+"but got rank ".concat(l.rank,".")}),Kf(o,s,u,l,c,i)}var X4=H({batchNorm3d_:j4});function Y4(r,e,t,n,a,i){var o=O(r,"x","batchNorm"),s=O(e,"mean","batchNorm"),u=O(t,"variance","batchNorm"),c;a!=null&&(c=O(a,"scale","batchNorm"));var l;return n!=null&&(l=O(n,"offset","batchNorm")),W(o.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+"".concat(o.rank,".")}),W(s.rank===4||s.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but "+"got rank ".concat(s.rank,".")}),W(u.rank===4||u.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 "+"but got rank ".concat(u.rank,".")}),c!=null&&W(c.rank===4||c.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 "+"but got rank ".concat(c.rank,".")}),l!=null&&W(l.rank===4||l.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 "+"but got rank ".concat(l.rank,".")}),Kf(o,s,u,l,c,i)}var Z4=H({batchNorm4d_:Y4});function J4(r,e,t){var n=O(r,"x","bincount"),a=O(e,"weights","bincount");W(n.dtype==="int32",function(){return"Error in bincount: input "+"dtype must be int32, but got ".concat(n.dtype)}),W(t>=0,function(){return"size must be non-negative, but got ".concat(t,".")}),W(a.size===n.size||a.size===0,function(){return"Error in bincount: weights must have the same size as input or"+"0-length, but got input shape: ".concat(n.shape,", weights shape: ")+"".concat(a.shape,".")});var i={x:n,weights:a},o={size:t};return q.runKernel(N1,i,o)}var z2=H({bincount_:J4});function Q4(r,e){var t=O(r,"x","bitwiseAnd"),n=O(e,"y","bitwiseAnd");if(!Ci(t.shape,n.shape))throw new Error("BitwiseAnd: Tensors must have the same shape. x: ".concat(t.shape,", y: ").concat(n.shape));if(t.dtype!=="int32"||n.dtype!=="int32")throw new Error("BitwiseAnd: Only supports 'int32' values in tensor, found type of x: ".concat(t.dtype," and type of y: ").concat(n.dtype));var a={a:t,b:n};return q.runKernel(I1,a)}var ez=H({bitwiseAnd_:Q4});function tz(r,e){var t=O(r,"s0","broadcastArgs","int32"),n=O(e,"s1","broadcastArgs","int32");if(t.rank!==1)throw new Error("broadcastArgs(): first input must be a vector (rank=1). "+"Has rank ".concat(t.rank));if(n.rank!==1)throw new Error("broadcastArgs(): second input must be a vector (rank=1). "+"Has rank ".concat(n.rank));var a={s0:t,s1:n};return q.runKernel(C1,a)}var rz=H({broadcastArgs_:tz});function nz(r,e){var t=O(r,"broadcastTo","x"),n=t.shape;if(Dn(e),e.length<t.rank)throw new Error("broadcastTo(): shape.length=".concat(e.length," < input.rank=").concat(t.rank,"."));if(e.length>t.rank){for(var a=t.shape.slice();a.length<e.length;)a.unshift(1);t=ve(t,a)}for(var i=t.shape,o=Array.from(e),s=e.length-1;s>=0;s--)if(i[s]===e[s])o[s]=1;else if(t.shape[s]!==1)throw new Error("broadcastTo(): [".concat(n,"] cannot be broadcast to [").concat(e,"]."));var u=o.map(function(f,h){return f>1?h:-1}).filter(function(f){return f>=0});if(u.length===0)return Lo(t);var c={x:t},l={reps:o};return q.runKernel(yv,c,l)}var Af=H({broadcastTo_:nz});function az(r){var e=O(r,"x","ceil","float32"),t={x:e};return q.runKernel(A1,t)}var iz=H({ceil_:az});function Vc(r,e,t){Dn(r),t=t||Lc(e);var n={shape:r,value:e,dtype:t};return q.runKernel(ox,{},n)}function oz(r,e,t){var n=O(r,"x","clipByValue");if(W(e<=t,function(){return"Error in clip: min (".concat(e,") must be ")+"less than or equal to max (".concat(t,").")}),e===t)return Vc(n.shape,e,n.dtype);var a={x:n},i={clipValueMin:e,clipValueMax:t};return q.runKernel(D1,a,i)}var sz=H({clipByValue_:oz});function uz(r){return An(r,0)}var cz=H({concat1d_:uz});function lz(r,e){return An(r,e)}var fz=H({concat2d_:lz});function hz(r,e){return An(r,e)}var pz=H({concat3d_:hz});function dz(r,e){return An(r,e)}var vz=H({concat4d_:dz});function mz(r,e,t,n,a,i,o){a===void 0&&(a="NHWC"),i===void 0&&(i=[1,1]);var s=O(r,"x","conv2d","float32"),u=O(e,"filter","conv2d","float32"),c=s,l=!1;s.rank===3&&(l=!0,c=ve(s,[1,s.shape[0],s.shape[1],s.shape[2]])),W(c.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank ".concat(c.rank,".")}),W(u.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+"".concat(u.rank,".")}),da("conv2d",n,o);var f=a==="NHWC"?c.shape[3]:c.shape[1];W(f===u.shape[2],function(){return"Error in conv2d: depth of input (".concat(f,") must match ")+"input depth for filter ".concat(u.shape[2],".")}),W(Di(t,i),function(){return"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(i,"'")}),W(Go(i),function(){return"Error in conv2D: Dilated rates should be larger than 0."}),W(Go(t),function(){return"Error in conv2D: Strides should be larger than 0."});var h={x:c,filter:u},p={strides:t,pad:n,dataFormat:a,dilations:i,dimRoundingMode:o},d=q.runKernel(O1,h,p);return l?ve(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var jf=H({conv2d_:mz});function gz(r,e,t,n,a,i,o){a===void 0&&(a="NWC"),i===void 0&&(i=1);var s=O(r,"x","conv1d"),u=O(e,"filter","conv1d"),c=s,l=!1;s.rank===2&&(l=!0,c=ve(s,[1,s.shape[0],s.shape[1]])),W(c.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank ".concat(c.rank,".")}),W(u.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+"".concat(u.rank,".")}),da("conv1d",n,o),W(c.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input (".concat(c.shape[2],") must match ")+"input depth for filter ".concat(u.shape[1],".")}),W(Di(t,i),function(){return"Error in conv1D: Either stride or dilation must be 1. "+"Got stride ".concat(t," and dilation '").concat(i,"'")}),W(Go(i),function(){return"Error in conv1D: Dilated rates should be larger than 0."}),W(Go(t),function(){return"Error in conv1D: Stride should be larger than 0."}),W(a==="NWC",function(){return"Error in conv1d: got dataFormat of ".concat(a," but only NWC is currently supported.")});var f=ve(u,[1,u.shape[0],u.shape[1],u.shape[2]]),h=ve(c,[c.shape[0],1,c.shape[1],c.shape[2]]),p=[1,t],d=[1,i],m="NHWC",v=jf(h,f,p,n,m,d,o);return l?ve(v,[v.shape[2],v.shape[3]]):ve(v,[v.shape[0],v.shape[2],v.shape[3]])}var yz=H({conv1d_:gz});function bz(r,e,t,n,a,i,o){i===void 0&&(i="NHWC"),W(r.length===e.rank,function(){return"Length of inShape "+"(".concat(r.length,") and rank of dy (").concat(e.rank,") must match")});var s=r,u=e,c=!1;e.rank===3&&(c=!0,u=ve(e,[1,e.shape[0],e.shape[1],e.shape[2]]),s=[1,r[0],r[1],r[2]]),W(s.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+"".concat(s.length,".")}),W(u.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got "+"rank ".concat(u.rank)}),W(t.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got "+"rank ".concat(t.rank)});var l=i==="NHWC"?s[3]:s[1],f=i==="NHWC"?u.shape[3]:u.shape[1];W(l===t.shape[2],function(){return"Error in conv2dDerInput: depth of input (".concat(l,") must ")+"match input depth for filter ".concat(t.shape[2],".")}),W(f===t.shape[3],function(){return"Error in conv2dDerInput: depth of output (".concat(f,") must ")+"match output depth for filter ".concat(t.shape[3],".")}),da("conv2dDerInput",a,o);var h={dy:u,filter:t},p={strides:n,pad:a,dataFormat:i,dimRoundingMode:o,inputShape:s},d=q.runKernel(M1,h,p);return c?ve(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var $2=H({conv2DBackpropInput_:bz});function wz(r,e,t,n,a,i){var o=O(r,"x","conv2dTranspose"),s=O(e,"filter","conv2dTranspose");return $2(t,o,s,n,a,"NHWC",i)}var xz=H({conv2dTranspose_:wz});function kz(r,e,t,n,a,i){a===void 0&&(a="NDHWC"),i===void 0&&(i=[1,1,1]);var o=O(r,"x","conv3d"),s=O(e,"filter","conv3d"),u=o,c=!1;o.rank===4&&(c=!0,u=ve(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),W(u.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank ".concat(u.rank,".")}),W(s.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+"".concat(s.rank,".")}),W(u.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input (".concat(u.shape[4],") must match ")+"input depth for filter ".concat(s.shape[3],".")}),W(Di(t,i),function(){return"Error in conv3D: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(i,"'")}),W(a==="NDHWC",function(){return"Error in conv3d: got dataFormat of ".concat(a," but only NDHWC is currently supported.")}),W(Go(i),function(){return"Error in conv3D: Dilated rates should be larger than 0."}),W(Go(t),function(){return"Error in conv3D: Strides should be larger than 0."});var l={x:u,filter:s},f={strides:t,pad:n,dataFormat:a,dilations:i},h=q.runKernel(B1,l,f);return c?ve(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var Sz=H({conv3d_:kz});function Ez(r,e,t,n,a){W(r.length===e.rank,function(){return"Length of inShape "+"(".concat(r.length,") and rank of dy (").concat(e.rank,") must match")});var i=r,o=e,s=!1;e.rank===4&&(s=!0,o=ve(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),i=[1,r[0],r[1],r[2],r[3]]);var u=i[4],c=o.shape[4];W(i.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+"".concat(i.length,".")}),W(o.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got "+"rank ".concat(o.rank)}),W(t.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got "+"rank ".concat(t.rank)}),W(u===t.shape[3],function(){return"Error in conv3dDerInput: depth of input (".concat(u,") must ")+"match input depth for filter ".concat(t.shape[3],".")}),W(c===t.shape[4],function(){return"Error in conv3dDerInput: depth of output (".concat(c,") must ")+"match output depth for filter ".concat(t.shape[4],".")});var l={dy:o,filter:t},f={pad:a,strides:n,inputShape:i},h=q.runKernel(L1,l,f);return s?ve(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var Tz=H({conv3DBackpropInput_:Ez});function Nz(r,e,t,n,a){var i=O(r,"x","conv3dTranspose"),o=O(e,"filter","conv3dTranspose");return Tz(t,i,o,n,a)}var Iz=H({conv3dTranspose_:Nz});function Cz(r){var e=O(r,"x","cos","float32"),t={x:e};return q.runKernel(z1,t)}var Az=H({cos_:Cz});function Dz(r){var e=O(r,"x","cosh","float32"),t={x:e};return q.runKernel($1,t)}var _z=H({cosh_:Dz});function Fz(r,e,t,n){e===void 0&&(e=0),t===void 0&&(t=!1),n===void 0&&(n=!1);var a=O(r,"x","cumprod"),i={x:a},o={axis:e,exclusive:t,reverse:n};return q.runKernel(W1,i,o)}var Rz=H({cumprod_:Fz});function Oz(r,e,t,n){e===void 0&&(e=0),t===void 0&&(t=!1),n===void 0&&(n=!1);var a=O(r,"x","cumsum"),i={x:a},o={axis:e,exclusive:t,reverse:n};return q.runKernel(G1,i,o)}var Pz=H({cumsum_:Oz});function Mz(r,e,t,n){n===void 0&&(n=!1);var a=O(r,"x","denseBincount"),i=O(e,"weights","denseBincount");W(a.dtype==="int32",function(){return"Error in denseBincount: input "+"dtype must be int32, but got ".concat(a.dtype)}),W(a.rank<=2,function(){return"Error in denseBincount: input must be at most rank 2, but got "+"rank ".concat(a.rank,".")}),W(t>=0,function(){return"size must be non-negative, but got ".concat(t,".")}),W(i.size===a.size||i.size===0,function(){return"Error in denseBincount: weights must have the same shape as x or "+"0-length, but got x shape: ".concat(a.shape,", weights shape: ")+"".concat(i.shape,".")});var o={x:a,weights:i},s={size:t,binaryOutput:n};return q.runKernel(U1,o,s)}var Bz=H({denseBincount_:Mz});function Lz(r,e,t){t===void 0&&(t="NHWC");var n=O(r,"x","depthToSpace","float32"),a=t==="NHWC"?n.shape[1]:n.shape[2],i=t==="NHWC"?n.shape[2]:n.shape[3],o=t==="NHWC"?n.shape[3]:n.shape[1];W(e>1,function(){return"blockSize should be > 1 for depthToSpace, but was: ".concat(e)}),W(a*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
    `.concat(a," and ").concat(e,`  for depthToSpace with input shape
    `).concat(n.shape)}),W(i*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
    `.concat(i," and ").concat(e,` for depthToSpace with input shape
        `).concat(n.shape)}),W(o%(e*e)===0,function(){return"Dimension size must be evenly divisible by ".concat(e*e," but is ").concat(o," for depthToSpace with input shape ").concat(n.shape)});var s={x:n},u={blockSize:e,dataFormat:t};return q.runKernel(H1,s,u)}var zz=H({depthToSpace_:Lz});function $z(r,e,t,n,a,i,o){a===void 0&&(a="NHWC"),i===void 0&&(i=[1,1]);var s=O(r,"x","depthwiseConv2d","float32"),u=O(e,"filter","depthwiseConv2d","float32"),c=s,l=!1;s.rank===3&&(l=!0,c=ve(s,[1,s.shape[0],s.shape[1],s.shape[2]])),W(c.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got "+"rank ".concat(c.rank,".")}),W(u.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+"".concat(u.rank,".")});var f=a==="NHWC"?c.shape[3]:c.shape[1];W(f===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels "+"(".concat(f,") must match the inChannels dimension in ")+"filter ".concat(u.shape[2],".")}),da("depthwiseConv2d",n,o);var h={x:c,filter:u},p={strides:t,pad:n,dataFormat:a,dilations:i,dimRoundingMode:o},d=q.runKernel(q1,h,p);return l?ve(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var Nv=H({depthwiseConv2d_:$z});function Wz(r){var e=O(r,"x","diag"),t={x:e};return q.runKernel(X1,t)}var Gz=H({diag_:Wz});function Vz(r,e,t,n,a,i){a===void 0&&(a=[1,1]),i===void 0&&(i="NHWC");var o=O(r,"x","dilation2d"),s=O(e,"filter","dilation2d");W(o.rank===3||o.rank===4,function(){return"Error in dilation2d: input must be rank 3 or 4, but got rank "+"".concat(o.rank,".")}),W(s.rank===3,function(){return"Error in dilation2d: filter must be rank 3, but got rank "+"".concat(s.rank,".")}),W(i==="NHWC",function(){return"Error in dilation2d: Only NHWC is currently supported, "+"but got dataFormat of ".concat(i)});var u=o,c=!1;o.rank===3&&(u=ve(o,[1,o.shape[0],o.shape[1],o.shape[2]]),c=!0),W(u.shape[3]===s.shape[2],function(){return"Error in dilation2d:  input and filter must have the same depth: ".concat(u.shape[3]," vs ").concat(s.shape[2])});var l={x:u,filter:s},f={strides:t,pad:n,dilations:a},h=q.runKernel(Y1,l,f);return c?ve(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var Uz=H({dilation2d_:Vz});function W2(r,e){for(var t=r.length,n=[],a=0;a<t;a++){var i=t-1-a,o=r[i]||1,s=e[e.length-1-a]||1;s>1&&o===1&&n.unshift(i)}return n}function Iv(r,e){for(var t=[],n=0;n<e.length;n++){var a=r[r.length-n-1],i=e.length-n-1,o=e[i];(a==null||a===1&&o>1)&&t.unshift(i)}return t}function Tr(r,e){for(var t=Math.max(r.length,e.length),n=new Array(t),a=0;a<t;a++){var i=r[r.length-a-1];i==null&&(i=1);var o=e[e.length-a-1];if(o==null&&(o=1),i===1)n[t-a-1]=o;else if(o===1)n[t-a-1]=i;else if(i!==o){var s="Operands could not be broadcast together with shapes "+"".concat(r," and ").concat(e,".");throw Error(s)}else n[t-a-1]=i}return n}var Hz={__proto__:null,assertAndGetBroadcastShape:Tr,getBroadcastDims:W2,getReductionAxes:Iv};function qz(r,e){var t,n=O(r,"a","equal","string_or_numeric"),a=O(e,"b","equal","string_or_numeric");t=ke(or(n,a),2),n=t[0],a=t[1],Tr(n.shape,a.shape);var i={a:n,b:a};return q.runKernel(tx,i)}var G2=H({equal_:qz});function Kz(r,e,t){var n=O(e,"a","where"),a=O(t,"b","where"),i=O(r,"condition","where","bool"),o=Tr(Tr(i.shape,n.shape),a.shape),s=Af(i,o),u=Af(n,o),c=Af(a,o),l={condition:s,t:u,e:c};return q.runKernel(gk,l)}var Zi=H({where_:Kz});function jz(r){var e=O(r,"x","zerosLike"),t={x:e};return q.runKernel(Xk,t)}var Zn=H({zerosLike_:jz});function Xz(r,e){var t,n=O(r,"a","div"),a=O(e,"b","div");t=ke(or(n,a),2),n=t[0],a=t[1];var i=Lt(n,a),o=Zn(i),s=G2(a,o);return Zi(s,o,i)}var Yz=H({divNoNan_:Xz});function Zz(r,e){var t=O(r,"t1","dot"),n=O(e,"t2","dot");W((t.rank===1||t.rank===2)&&(n.rank===1||n.rank===2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+"".concat(t.rank," and ").concat(n.rank,".")});var a=t.rank===1?t.size:t.shape[1],i=n.rank===1?n.size:n.shape[0];if(W(a===i,function(){return"Error in dot: inner dimensions of inputs must match, but got "+"".concat(a," and ").concat(i,".")}),t.rank===1&&n.rank===1){var o=ve(t,[1,-1]),s=ve(n,[-1,1]),u=Nt(o,s);return ve(u,[])}else if(t.rank===1&&n.rank===2){var o=ve(t,[1,-1]),s=ve(n,[n.shape[0],n.shape[1]]),u=Nt(o,s);return ve(u,[u.size])}else if(t.rank===2&&n.rank===1){var s=ve(n,[-1,1]),u=Nt(t,s);return ve(u,[u.size])}else{var s=ve(n,[n.shape[0],n.shape[1]]),u=Nt(t,s);return u}}var Jz=H({dot_:Zz});function Qz(r){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];var n=e.map(function(i,o){return O(i,"tensors".concat(o),"einsum")}),a={equation:r};return q.runKernel(J1,n,a)}var Ks=H({einsum_:Qz});function e$(r){var e=O(r,"x","elu","float32"),t={x:e};return q.runKernel(Q1,t)}var V2=H({elu_:e$});function t$(r,e){var t=O(r,"x","ensureShape","string_or_numeric");if(!Jw(t.shape,e))throw new Error("EnsureShape: Shape of tensor ".concat(t.shape," is not compatible with expected shape ").concat(e));return r}var r$=H({ensureShape_:t$});function n$(r){var e=O(r,"x","erf");W(e.dtype==="int32"||e.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),e.dtype==="int32"&&(e=Wt(e,"float32"));var t={x:e};return q.runKernel(ex,t)}var a$=H({erf_:n$});function Cv(r,e){for(var t=0;t<r.length;++t)if(r[r.length-t-1]!==e-1-t)return!1;return!0}function U2(r,e,t){for(var n=r.length+e.length,a=[],i=0,o=0,s=0;s<n;s++)t.indexOf(s)===-1?a.push(r[i++]):a.push(e[o++]);return a}function i$(r,e){for(var t=[],n=r.length,a=0;a<n;a++)e.indexOf(a)===-1&&t.push(r[a]);var i=e.map(function(o){return r[o]});return[t,i]}function Uc(r,e){var t=e.map(function(n){return 1});return U2(r,t,e)}function o$(r,e,t){W(Cv(e,t),function(){return"".concat(r," supports only inner-most axes for now. ")+"Got axes ".concat(e," and rank-").concat(t," input.")})}function s$(r,e){if(Cv(r,e))return null;for(var t=[],n=0;n<e;++n)r.indexOf(n)===-1&&t.push(n);return r.forEach(function(a){return t.push(a)}),t}function u$(r){return r.map(function(e,t){return[t,e]}).sort(function(e,t){return e[1]-t[1]}).map(function(e){return e[0]})}function c$(r,e){for(var t=[],n=e-r;n<e;++n)t.push(n);return t}function l$(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=O(r,"x","max"),a={x:n},i={reductionIndices:e,keepDims:t};return q.runKernel(Dx,a,i)}var eu=H({max_:l$});function f$(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=O(r,"x","min"),a={x:n},i={axis:e,keepDims:t};return q.runKernel(Mx,a,i)}var av=H({min_:f$});function h$(r,e){var t,n=O(r,"base","pow"),a=O(e,"exp","pow");t=ke(or(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return q.runKernel(Zx,i)}var _c=H({pow_:h$});function Rt(r,e){if((Pr(r)&&e!=="string"||Array.isArray(r))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&Pr(r)&&!(r instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");var t=[],n=[];return no(r,t,n,e)}function p$(r){var e=O(r,"x","sqrt","float32"),t={x:e};return q.runKernel(Tk,t)}var Ni=H({sqrt_:p$});function d$(r){var e=O(r,"x","square"),t={};return q.runKernel("Square",{x:e},t)}var za=H({square_:d$});function v$(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=O(r,"x","sum");n.dtype==="bool"&&(n=Wt(n,"int32"));var a={x:n},i={axis:e,keepDims:t};return q.runKernel(Nk,a,i)}var Bt=H({sum_:v$});function m$(r,e,t,n){e===void 0&&(e="euclidean"),t===void 0&&(t=null),n===void 0&&(n=!1),r=O(r,"x","norm");var a=H2(r,e,t),i=a.shape;if(n){var o=Bc(t,r.shape);i=Uc(a.shape,o)}return ve(a,i)}function H2(r,e,t){if(t===void 0&&(t=null),r.rank===0)return Yn(r);if(r.rank!==1&&t===null)return H2(ve(r,[-1]),e,t);if(r.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return Bt(Yn(r),t);if(e===1/0)return eu(Yn(r),t);if(e===-1/0)return av(Yn(r),t);if(e==="euclidean"||e===2)return Ni(Bt(_c(Yn(r),Rt(2,"int32")),t));throw new Error("Error in norm: invalid ord value: ".concat(e))}if(Array.isArray(t)&&t.length===2){if(e===1)return eu(Bt(Yn(r),t[0]),t[1]-1);if(e===1/0)return eu(Bt(Yn(r),t[1]),t[0]);if(e===-1/0)return av(Bt(Yn(r),t[1]),t[0]);if(e==="fro"||e==="euclidean")return Ni(Bt(za(r),t));throw new Error("Error in norm: invalid ord value: ".concat(e))}throw new Error("Error in norm: invalid axis: ".concat(t))}var Xf=H({norm_:m$});function g$(r,e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),Xf(r,"euclidean",e,t)}var y$=H({euclideanNorm_:g$});function b$(r){var e=O(r,"x","exp"),t={x:e};return q.runKernel(rx,t)}var Vo=H({exp_:b$});function w$(r,e){e===void 0&&(e=0);var t=O(r,"x","expandDims","string_or_numeric");W(e<=t.rank,function(){return"Axis must be <= rank of the tensor"});var n={input:t},a={dim:e};return q.runKernel(nx,n,a)}var qi=H({expandDims_:w$});function x$(r){var e=O(r,"x","expm1"),t={x:e};return q.runKernel(ax,t)}var k$=H({expm1_:x$});function S$(r,e){var t=O(r,"x","tile","string_or_numeric");W(t.rank===e.length,function(){return"Error in transpose: rank of input ".concat(t.rank," ")+"must match length of reps ".concat(e,".")});var n={x:t},a={reps:e};return q.runKernel(yv,n,a)}var wc=H({tile_:S$});function E$(r,e,t,n){n===void 0&&(n="float32"),e==null&&(e=r);for(var a=Ti([r,e],n),i=r<=e?r:e,o=0;o<i;++o)a.set(1,o,o);var s=ve(a.toTensor(),[r,e]);if(t==null)return s;if(t.length===1)return wc(qi(s,0),[t[0],1,1]);if(t.length===2)return wc(qi(qi(s,0),0),[t[0],t[1],1,1]);if(t.length===3)return wc(qi(qi(qi(s,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error("eye() currently supports only 1D and 2D "+"batchShapes, but received ".concat(t.length,"D."))}var q2=H({eye_:E$});function T$(r){var e=O(r,"x","floor","float32"),t={x:e};return q.runKernel(ux,t)}var K2=H({floor_:T$});function N$(r,e,t,n){t===void 0&&(t=0),n===void 0&&(n=0);var a=O(r,"x","gather"),i=O(e,"indices","gather","int32"),o={x:a,indices:i},s={axis:t,batchDims:n};return q.runKernel(fx,o,s)}var j2=H({gather_:N$});function I$(r,e){var t,n=O(r,"a","greater","string_or_numeric"),a=O(e,"b","greater","string_or_numeric");t=ke(or(n,a),2),n=t[0],a=t[1],Tr(n.shape,a.shape);var i={a:n,b:a};return q.runKernel(px,i)}var Yf=H({greater_:I$});function C$(r,e){var t,n=O(r,"a","greaterEqual","string_or_numeric"),a=O(e,"b","greaterEqual","string_or_numeric");t=ke(or(n,a),2),n=t[0],a=t[1],Tr(n.shape,a.shape);var i={a:n,b:a};return q.runKernel(dx,i)}var X2=H({greaterEqual_:C$});function A$(r){var e=O(r,"input","imag"),t={input:e};return q.runKernel(mx,t)}var Zf=H({imag_:A$});function D$(r){var e=O(r,"x","isFinite"),t={x:e};return q.runKernel(gx,t)}var _$=H({isFinite_:D$});function F$(r){var e=O(r,"x","isInf"),t={x:e};return q.runKernel(yx,t)}var R$=H({isInf_:F$});function O$(r){var e=O(r,"x","isNaN"),t={x:e};return q.runKernel(bx,t)}var P$=H({isNaN_:O$});function M$(r,e){e===void 0&&(e=.2);var t=O(r,"x","leakyRelu"),n={x:t},a={alpha:e};return q.runKernel(wx,n,a)}var Y2=H({leakyRelu_:M$});function B$(r,e){var t,n=O(r,"a","less","string_or_numeric"),a=O(e,"b","less","string_or_numeric");t=ke(or(n,a),2),n=t[0],a=t[1],Tr(n.shape,a.shape);var i={a:n,b:a};return q.runKernel(xx,i)}var iv=H({less_:B$});function L$(r,e){var t,n=O(r,"a","lessEqual","string_or_numeric"),a=O(e,"b","lessEqual","string_or_numeric");t=ke(or(n,a),2),n=t[0],a=t[1],Tr(n.shape,a.shape);var i={a:n,b:a};return q.runKernel(kx,i)}var Av=H({lessEqual_:L$});function z$(r,e,t){if(t<=0)throw new Error("The number of values should be positive.");var n={start:r,stop:e,num:t};return q.runKernel(Sx,{},n)}function $$(r,e,t,n,a){e===void 0&&(e=5),t===void 0&&(t=1),n===void 0&&(n=1),a===void 0&&(a=.5);var i=O(r,"x","localResponseNormalization");W(i.rank===4||i.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `.concat(i.rank,".")}),W(tu(e),function(){return"Error in localResponseNormalization: depthRadius must be an "+"integer but got depthRadius ".concat(e,".")});var o=i,s=!1;i.rank===3&&(s=!0,o=ve(i,[1,i.shape[0],i.shape[1],i.shape[2]]));var u={x:o},c={depthRadius:e,bias:t,alpha:n,beta:a},l=q.runKernel(Ax,u,c);return s?ve(l,[l.shape[1],l.shape[2],l.shape[3]]):l}var W$=H({localResponseNormalization_:$$});function G$(r){var e=O(r,"x","log","float32"),t={x:e};return q.runKernel(Ex,t)}var Fc=H({log_:G$});function V$(r){var e=O(r,"x","log1p"),t={x:e};return q.runKernel(Tx,t)}var Z2=H({log1p_:V$});function U$(r){return W(Ji(r),function(){return"The f passed in grad(f) must be a function"}),function(e,t){var n=O(e,"x","tf.grad","string_or_numeric"),a=t!=null?O(t,"dy","tf.grad"):null;return q.tidy(function(){var i=q.gradients(function(){return r(n)},[n],a),o=i.value,s=i.grads;return a!=null&&sn(o.shape,a.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),Jf(s),s[0]})}}function H$(r){return W(Ji(r),function(){return"The f passed in grads(f) must be a function"}),function(e,t){W(Array.isArray(e),function(){return"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s"});var n=Ic(e,"args","tf.grads","string_or_numeric"),a=t!=null?O(t,"dy","tf.grads"):null;return q.tidy(function(){var i=q.gradients(function(){return r.apply(void 0,pt([],ke(n),!1))},n,a),o=i.value,s=i.grads;return a!=null&&sn(o.shape,a.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),Jf(s),s})}}function q$(r){return W(Ji(r),function(){return"The f passed in valueAndGrad(f) must be a function"}),function(e,t){W(e instanceof Sr,function(){return"The x passed in valueAndGrad(f)(x) must be a tensor"}),W(t==null||t instanceof Sr,function(){return"The dy passed in valueAndGrad(f)(x, dy) must be a tensor"});var n=q.gradients(function(){return r(e)},[e],t),a=n.grads,i=n.value;return Jf(a),{grad:a[0],value:i}}}function K$(r){return W(Ji(r),function(){return"The f passed in valueAndGrads(f) must be a function"}),function(e,t){W(Array.isArray(e)&&e.every(function(a){return a instanceof Sr}),function(){return"The args passed in valueAndGrads(f)(args) must be array of tensors"}),W(t==null||t instanceof Sr,function(){return"The dy passed in valueAndGrads(f)(args, dy) must be a tensor"});var n=q.gradients(function(){return r.apply(void 0,pt([],ke(e),!1))},e,t);return t!=null&&sn(n.value.shape,t.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),Jf(n.grads),n}}function J2(r,e){W(Ji(r),function(){return"The f passed in variableGrads(f) must be a function"}),W(e==null||Array.isArray(e)&&e.every(function(f){return f instanceof Nc}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var t=e!=null;if(!t){e=[];for(var n in q.registeredVariables)e.push(q.registeredVariables[n])}var a=t?e.filter(function(f){return!f.trainable}):null,i=e.length;e=e.filter(function(f){return f.trainable}),W(e.length>0,function(){return"variableGrads() expects at least one of the input variables to "+"be trainable, but none of the ".concat(i," variables is ")+"trainable."});var o=!0,s=q.gradients(r,e,null,o),u=s.value,c=s.grads;W(c.some(function(f){return f!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),W(u.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it "+"returned a rank-".concat(u.rank," tensor")});var l={};return e.forEach(function(f,h){c[h]!=null&&(l[f.name]=c[h])}),a?.forEach(function(f){return l[f.name]=null}),{value:u,grads:l}}function ui(r){return q.customGrad(r)}function Jf(r){var e=r.filter(function(t){return t==null}).length;if(e>0)throw new Error(`Cannot compute gradient of y=f(x) with respect to x. Make sure that
    the f you passed encloses all operations that lead from x to y.`)}function j$(r){var e=O(r,"x","neg"),t={x:e};return q.runKernel(Gx,t)}var oi=H({neg_:j$});function X$(r){var e=O(r,"x","softplus"),t={x:e};return q.runKernel(Ek,t)}var Q2=H({softplus_:X$});function Y$(r){var e=O(r,"x","logSigmoid"),t=ui(function(n){var a=oi(Q2(oi(n))),i=function(o){var s=Pe(o,Qs(oi(n)));return s};return{value:a,gradFunc:i}});return t(e)}var Z$=H({logSigmoid_:Y$});function J$(r,e){var t,n=O(r,"a","sub"),a=O(e,"b","sub");t=ke(or(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return q.runKernel(Wk,i)}var ht=H({sub_:J$});function Q$(r,e){e===void 0&&(e=-1);var t=O(r,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(t.rank," and axis was ").concat(e));var n=ui(function(a,i){var o=!0,s=eu(a,e,!0),u=ht(a,s),c=ht(Wt(u,"float32"),Fc(Bt(Vo(u),e,o)));i([c]);var l=function(f,h){var p=ke(h,1),d=p[0],m=!0,v=Vo(d);return ht(f,Pe(Bt(f,e,m),v))};return{value:c,gradFunc:l}});return n(t)}var eW=H({logSoftmax_:Q$});function tW(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=O(r,"x","logSumExp"),a=Bc(e,n.shape),i=eu(n,a,!0),o=ht(n,i),s=Vo(o),u=Bt(s,a),c=Fc(u),l=at(ve(i,c.shape),c);if(t){var f=Uc(l.shape,a);return ve(l,f)}return l}var eS=H({logSumExp_:tW});function rW(r,e){var t=O(r,"a","logicalAnd","bool"),n=O(e,"b","logicalAnd","bool");Tr(t.shape,n.shape);var a={a:t,b:n};return q.runKernel(Nx,a)}var Bf=H({logicalAnd_:rW});function nW(r){var e=O(r,"x","logicalNot","bool"),t={x:e};return q.runKernel(Ix,t)}var tS=H({logicalNot_:nW});function aW(r,e){var t=O(r,"a","logicalOr","bool"),n=O(e,"b","logicalOr","bool");Tr(t.shape,n.shape);var a={a:t,b:n};return q.runKernel(Cx,a)}var rS=H({logicalOr_:aW});function iW(r,e){var t=O(r,"a","logicalXor","bool"),n=O(e,"b","logicalXor","bool");return Tr(t.shape,n.shape),Bf(rS(r,e),tS(Bf(r,e)))}var oW=H({logicalXor_:iW});var Tf=2147483648;function sW(r,e,t){t===void 0&&(t="left");var n=O(r,"sortedSequence","searchSorted"),a=O(e,"values","searchSorted"),i=n.shape[n.shape.length-1],o=a.shape[a.shape.length-1],s=ve(n,[-1,i]),u=ve(a,[-1,o]);if(s.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(s.shape[0]!==u.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(Dt(u.shape)>=Tf)throw new Error("values tensor size must less than ".concat(Tf));if(s.shape[1]>=Tf)throw new Error("trailing dim_size must less than ".concat(Tf," for int32 output type, was ").concat(s.shape[1]));var c={sortedSequence:s,values:u},l={side:t};return q.runKernel(mk,c,l)}var Dv=H({searchSorted_:sW});function uW(r,e){return Dv(r,e,"left")}function cW(r,e,t,n,a){var i=O(r,"x","maxPool"),o=1,s=i,u=!1;i.rank===3&&(u=!0,s=ve(i,[1,i.shape[0],i.shape[1],i.shape[2]])),W(s.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(s.rank,".")}),W(Di(t,o),function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(o,"'")}),da("maxPool",n,a);var c={x:s},l={filterSize:e,strides:t,pad:n,dimRoundingMode:a},f=q.runKernel(Fx,c,l);return u?ve(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var nS=H({maxPool_:cW});function lW(r,e,t,n,a,i){e===void 0&&(e=[1,1,1]),i===void 0&&(i="NDHWC");var o=O(r,"x","maxPool3d"),s=o,u=!1;o.rank===4&&(u=!0,s=ve(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),W(s.rank===5,function(){return"Error in maxPool3d: x must be rank 5 but got rank ".concat(s.rank,".")}),W(i==="NDHWC",function(){return"Error in maxPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(i)}),da("maxPool3d",n,a);var c={x:s},l={filterSize:e,strides:t,pad:n,dimRoundingMode:a,dataFormat:i},f=q.runKernel(Rx,c,l);return u?ve(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}var fW=H({maxPool3d_:lW});function hW(r,e,t,n,a){a===void 0&&(a=!1);var i=O(r,"x","maxPoolWithArgmax"),o={x:i},s={filterSize:e,strides:t,pad:n,includeBatchInIndex:a},u=q.runKernel(Ox,o,s);return{result:u[0],indexes:u[1]}}var pW=H({maxPoolWithArgmax_:hW});function dW(r,e){var t,n=O(r,"a","maximum"),a=O(e,"b","maximum");t=ke(or(n,a),2),n=t[0],a=t[1],n.dtype==="bool"&&(n=Wt(n,"int32"),a=Wt(a,"int32")),Tr(n.shape,a.shape);var i={a:n,b:a};return q.runKernel(_x,i)}var aS=H({maximum_:dW});function vW(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=O(r,"x","mean"),a={x:n},i={axis:e,keepDims:t};return q.runKernel(Px,a,i)}var Lf=H({mean_:vW});function au(r,e){if(e===void 0&&(e="float32"),Dn(r),e==="complex64"){var t=au(r,"float32"),n=au(r,"float32");return eo(t,n)}var a=Vf(Dt(r),e);return q.makeTensor(a,r,e)}function Bo(r,e){if(e===void 0&&(e="float32"),Dn(r),e==="complex64"){var t=Bo(r,"float32"),n=au(r,"float32");return eo(t,n)}var a=hv(Dt(r),e);return q.makeTensor(a,r,e)}function mW(r,e,t){var n=t===void 0?{}:t,a=n.indexing,i=a===void 0?"xy":a;if(i!=="xy"&&i!=="ij")throw new TypeError("".concat(i," is not a valid third argument to meshgrid"));if(r===void 0)return[];var o=O(r,"x","meshgrid",r instanceof Sr?r.dtype:"float32");if(e===void 0)return[o];var s=O(e,"y","meshgrid",e instanceof Sr?e.dtype:"float32"),u=Dt(o.shape),c=Dt(s.shape);return i==="xy"?(o=ve(o,[1,-1]),s=ve(s,[-1,1]),[Nt(Bo([c,1],o.dtype),o),Nt(s,Bo([1,u],s.dtype))]):(o=ve(o,[-1,1]),s=ve(s,[1,-1]),[Nt(o,Bo([1,c],o.dtype)),Nt(Bo([u,1],s.dtype),s)])}function gW(r,e){var t,n=O(r,"a","minimum"),a=O(e,"b","minimum");t=ke(or(n,a),2),n=t[0],a=t[1],n.dtype==="bool"&&(n=Wt(n,"int32"),a=Wt(a,"int32")),Tr(n.shape,a.shape);var i={a:n,b:a};return q.runKernel(Bx,i)}var zf=H({minimum_:gW});function yW(r,e,t){W(t==="reflect"||t==="symmetric",function(){return"Invalid mode. Mode must be either reflect or symmetric. "+"Got ".concat(t,".")});var n=O(r,"x","mirrorPad");if(n.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");W(e.length===n.rank,function(){return"Padding doesn't match input. Must be ".concat(n.rank,". ")+"Got ".concat(e.length,".")});for(var a=t==="reflect"?1:0,i=function(c){W(e[c].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),W(e[c][0]>=0&&e[c][0]<=n.shape[c]-a&&e[c][1]>=0&&e[c][1]<=n.shape[c]-a,function(){return"Padding in dimension ".concat(c," cannot be greater than or equal ")+"to ".concat(n.shape[c]-a," or less than 0 for input of ")+"shape ".concat(n.shape)})},o=0;o<n.rank;o++)i(o);var s={paddings:e,mode:t},u={x:n};return q.runKernel(Lx,u,s)}var bW=H({mirrorPad_:yW});function wW(r,e){var t,n=O(r,"a","mod"),a=O(e,"b","mod");t=ke(or(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return q.runKernel(zx,i)}var xW=H({mod_:wW});function kW(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1),r=O(r,"x","moments");var n=Bc(e,r.shape),a=Lf(r,n,t),i=a.shape;t||(i=Uc(a.shape,n));var o=za(ht(Wt(r,"float32"),ve(a,i))),s=Lf(o,n,t);return{mean:a,variance:s}}var SW=H({moments_:kW});function EW(r,e,t,n){for(var a=O(e,"data","multiRNNCell"),i=Ic(t,"c","multiRNNCell"),o=Ic(n,"h","multiRNNCell"),s=a,u=[],c=0;c<r.length;c++){var l=r[c](s,i[c],o[c]);u.push(l[0]),u.push(l[1]),s=l[1]}for(var f=[],h=[],c=0;c<u.length;c+=2)f.push(u[c]),h.push(u[c+1]);return[f,h]}var TW=H({multiRNNCell_:EW});function NW(r,e,t,n){n===void 0&&(n=!1);var a=O(r,"logits","multinomial"),i=a.size,o=a.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+"".concat(i,"."));if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is ".concat(o));t=t||Math.random();var s=o===1?ve(a,[1,-1]):a,u={logits:s},c={numSamples:e,seed:t,normalized:n},l=q.runKernel($x,u,c);return o===1?ve(l,[l.size]):l}var IW=H({multinomial_:NW});function CW(r,e){var t,n=O(r,"a","notEqual","string_or_numeric"),a=O(e,"b","notEqual","string_or_numeric");t=ke(or(n,a),2),n=t[0],a=t[1],Tr(n.shape,a.shape);var i={a:n,b:a};return q.runKernel(Vx,i)}var iS=H({notEqual_:CW});function AW(r,e,t,n,a){if(t===void 0&&(t=1),n===void 0&&(n=0),a===void 0&&(a="int32"),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is ".concat(e));var i=O(r,"indices","oneHot","int32"),o={indices:i},s={dtype:a,depth:e,onValue:t,offValue:n};return q.runKernel(jx,o,s)}var ov=H({oneHot_:AW});function DW(r){var e=O(r,"x","onesLike"),t={x:e};return q.runKernel(Kx,t)}var _W=H({onesLike_:DW});function FW(r,e){var t=O(r,"v1","outerProduct"),n=O(e,"v2","outerProduct");W(t.rank===1&&n.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+"".concat(t.rank," and ").concat(n.rank,".")});var a=ve(t,[-1,1]),i=ve(n,[1,-1]);return Nt(a,i)}var RW=H({outerProduct_:FW});function OW(r,e,t){t===void 0&&(t=0);var n=O(r,"x","pad");if(n.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var a={paddings:e,constantValue:t},i={x:n};return q.runKernel(Yx,i,a)}var Hc=H({pad_:OW});function PW(r,e,t){return t===void 0&&(t=0),W(e.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),Hc(r,[e],t)}var MW=H({pad1d_:PW});function BW(r,e,t){return t===void 0&&(t=0),W(e.length===2&&e[0].length===2&&e[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Hc(r,e,t)}var LW=H({pad2d_:BW});function zW(r,e,t){return t===void 0&&(t=0),W(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Hc(r,e,t)}var $W=H({pad3d_:zW});function WW(r,e,t){return t===void 0&&(t=0),W(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Hc(r,e,t)}var GW=H({pad4d_:WW});function VW(r,e,t){var n=O(r,"x","spaceToBatchND");W(n.rank>=1+e.length,function(){return"input rank ".concat(n.rank," should be > than [blockShape] ").concat(e.length)}),W(t.length===e.length,function(){return"paddings.shape[0] ".concat(t.length," must be equal to [blockShape] ").concat(e.length)}),W(n.shape.reduce(function(o,s,u){return u>0&&u<=e.length?o&&(s+t[u-1][0]+t[u-1][1])%e[u-1]===0:o},!0),function(){return"input spatial dimensions ".concat(n.shape.slice(1)," with paddings ").concat(t.toString()," must be divisible by blockShapes ").concat(e.toString())});var a={x:n},i={blockShape:e,paddings:t};return q.runKernel(Ik,a,i)}var oS=H({spaceToBatchND_:VW});function UW(r,e,t,n,a,i,o){a==null&&(a=[1,1]),i==null&&(i=1),n===0&&(n="valid");var s=O(r,"x","maxPool"),u=s,c=!1;s.rank===3&&(c=!0,u=ve(s,[1,s.shape[0],s.shape[1],s.shape[2]])),W(Di(i,a),function(){return"Error in pool: Either strides or dilations must be 1. "+"Got strides ".concat(i," and dilations '").concat(a,"'")});var l=O2(u.shape,e,i,a,n),f=[l.dilationHeight,l.dilationWidth],h;n==="same"?h=qW([l.filterHeight,l.filterWidth],f):h=[[0,0],[0,0]];var p=f[0]===1&&f[1]===1,d=ke(HW([l.inHeight,l.inWidth],f,h),2),m=d[0],v=d[1],g=p?n:"valid",y=p?u:oS(u,f,m),w=t==="avg"?function(){return B2(y,e,i,g,o)}:function(){return nS(y,e,i,g,o)},b=w(),x=p?b:L2(b,f,v);return c?ve(x,[x.shape[1],x.shape[2],x.shape[3]]):x}function HW(r,e,t){var n=t.map(function(l){return l[0]}),a=t.map(function(l){return l[1]}),i=r.concat(n,a),o=e.map(function(l,f){return(l-i[f]%l)%l}),s=a.map(function(l,f){return l+o[f]}),u=e.map(function(l,f){return[n[f],s[f]]}),c=e.map(function(l,f){return[0,o[f]]});return[u,c]}function qW(r,e){var t=r.map(function(o,s){return o+(o-1)*(e[s]-1)}),n=t.map(function(o){return o-1}),a=n.map(function(o){return Math.floor(o/2)}),i=n.map(function(o,s){return o-a[s]});return n.map(function(o,s){return[a[s],i[s]]})}var KW=H({pool_:UW});function jW(r,e){var t=O(r,"x","prelu"),n=O(e,"alpha","prelu"),a={x:t,alpha:n};return q.runKernel(Jx,a)}var sS=H({prelu_:jW});function XW(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=O(r,"x","prod");n.dtype==="bool"&&(n=Wt(n,"int32"));var a={x:n},i={axis:e,keepDims:t};return q.runKernel(Qx,a,i)}var YW=H({prod_:XW});function ZW(r,e,t,n){var a=r.map(function(l,f){return O(l,"tensors".concat(f),"raggedGather","int32")}),i=O(e,"paramsDenseValues","raggedGather"),o=O(t,"indices","raggedGather","int32"),s={paramsNestedSplits:a,paramsDenseValues:i,indices:o},u={outputRaggedRank:n},c=q.runKernel(ek,s,u);return{outputNestedSplits:c.slice(0,c.length-1),outputDenseValues:c[c.length-1]}}var JW=H({raggedGather_:ZW});function QW(r,e,t){var n=O(r,"starts","raggedRange"),a=O(e,"limits","raggedRange",n.dtype),i=O(t,"deltas","raggedRange",n.dtype),o={starts:n,limits:a,deltas:i},s=q.runKernel(tk,o);return{rtNestedSplits:s[0],rtDenseValues:s[1]}}var eG=H({raggedRange_:QW});function tG(r,e,t,n,a){var i=O(r,"shape","raggedTensorToTensor","int32"),o=O(e,"values","raggedTensorToTensor"),s=O(t,"defaultValue","raggedTensorToTensor",o.dtype),u=n.map(function(f,h){return O(f,"tensors".concat(h),"raggedTensorToTensor","int32")}),c={shape:i,values:o,defaultValue:s,rowPartitionTensors:u},l={rowPartitionTypes:a};return q.runKernel(rk,c,l)}var rG=H({raggedTensorToTensor_:tG});function nG(r,e,t){Dn(r);var n=Dt(r),a=null;if(t==null||t==="float32")a=new Float32Array(n);else if(t==="int32")a=new Int32Array(n);else if(t==="bool")a=new Uint8Array(n);else throw new Error("Unknown data type ".concat(t));for(var i=0;i<n;i++)a[i]=e();return q.makeTensor(a,r,t)}var aG=H({rand_:nG}),uS={exports:{}};(function(r){(function(e,t,n){function a(u){var c=this,l=s();c.next=function(){var f=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=f-(c.c=f|0)},c.c=1,c.s0=l(" "),c.s1=l(" "),c.s2=l(" "),c.s0-=l(u),c.s0<0&&(c.s0+=1),c.s1-=l(u),c.s1<0&&(c.s1+=1),c.s2-=l(u),c.s2<0&&(c.s2+=1),l=null}function i(u,c){return c.c=u.c,c.s0=u.s0,c.s1=u.s1,c.s2=u.s2,c}function o(u,c){var l=new a(u),f=c&&c.state,h=l.next;return h.int32=function(){return l.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,f&&(typeof f=="object"&&i(f,l),h.state=function(){return i(l,{})}),h}function s(){var u=4022871197,c=function(l){l=String(l);for(var f=0;f<l.length;f++){u+=l.charCodeAt(f);var h=.02519603282416938*u;u=h>>>0,h-=u,h*=u,u=h>>>0,h-=u,u+=h*4294967296}return(u>>>0)*23283064365386963e-26};return c}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.alea=o})(qo,r,!1)})(uS);var iG=uS.exports,cS={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this,c="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var f=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^f^f>>>8},s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor128=o})(qo,r,!1)})(cS);var oG=cS.exports,lS={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this,c="";u.next=function(){var f=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^(f^f<<1))|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,l==c.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorwow=o})(qo,r,!1)})(lS);var sG=lS.exports,fS={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var l=u.x,f=u.i,h,p;return h=l[f],h^=h>>>7,p=h^h<<24,h=l[f+1&7],p^=h^h>>>10,h=l[f+3&7],p^=h^h>>>3,h=l[f+4&7],p^=h^h<<7,h=l[f+7&7],h=h^h<<13,p^=h^h<<9,l[f]=p,u.i=f+1&7,p};function c(l,f){var h,p=[];if(f===(f|0))p[0]=f;else for(f=""+f,h=0;h<f.length;++h)p[h&7]=p[h&7]<<15^f.charCodeAt(h)+p[h+1&7]<<13;for(;p.length<8;)p.push(0);for(h=0;h<8&&p[h]===0;++h);for(h==8?p[7]=-1:p[h],l.x=p,l.i=0,h=256;h>0;--h)l.next()}c(u,s)}function i(s,u){return u.x=s.x.slice(),u.i=s.i,u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(l.x&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorshift7=o})(qo,r,!1)})(fS);var uG=fS.exports,hS={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var l=u.w,f=u.X,h=u.i,p,d;return u.w=l=l+1640531527|0,d=f[h+34&127],p=f[h=h+1&127],d^=d<<13,p^=p<<17,d^=d>>>15,p^=p>>>12,d=f[h]=d^p,u.i=h,d+(l^l>>>16)|0};function c(l,f){var h,p,d,m,v,g=[],y=128;for(f===(f|0)?(p=f,f=null):(f=f+"\0",p=0,y=Math.max(y,f.length)),d=0,m=-32;m<y;++m)f&&(p^=f.charCodeAt((m+32)%f.length)),m===0&&(v=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,m>=0&&(v=v+1640531527|0,h=g[m&127]^=p+v,d=h==0?d+1:0);for(d>=128&&(g[(f&&f.length||0)&127]=-1),d=127,m=512;m>0;--m)p=g[d+34&127],h=g[d=d+1&127],p^=p<<13,h^=h<<17,p^=p>>>15,h^=h>>>12,g[d]=p^h;l.w=v,l.X=g,l.i=d}c(u,s)}function i(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(l.X&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor4096=o})(qo,r,!1)})(hS);var cG=hS.exports,pS={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this,c="";u.next=function(){var f=u.b,h=u.c,p=u.d,d=u.a;return f=f<<25^f>>>7^h,h=h-p|0,p=p<<24^p>>>8^d,d=d-f|0,u.b=f=f<<20^f>>>12^h,u.c=h=h-p|0,u.d=p<<16^h>>>16^d,u.a=d-f|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=s|0):c+=s;for(var l=0;l<c.length+20;l++)u.b^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.tychei=o})(qo,r,!1)})(pS);var lG=pS.exports,dS={exports:{}};(function(r){(function(e,t,n){var a=256,i=6,o=52,s="random",u=n.pow(a,i),c=n.pow(2,o),l=c*2,f=a-1,h;function p(b,x,S){var T=[];x=x==!0?{entropy:!0}:x||{};var N=g(v(x.entropy?[b,w(t)]:b??y(),3),T),C=new d(T),R=function(){for(var _=C.g(i),P=u,$=0;_<c;)_=(_+$)*a,P*=a,$=C.g(1);for(;_>=l;)_/=2,P/=2,$>>>=1;return(_+$)/P};return R.int32=function(){return C.g(4)|0},R.quick=function(){return C.g(4)/4294967296},R.double=R,g(w(C.S),t),(x.pass||S||function(_,P,$,z){return z&&(z.S&&m(z,C),_.state=function(){return m(C,{})}),$?(n[s]=_,P):_})(R,N,"global"in x?x.global:this==n,x.state)}function d(b){var x,S=b.length,T=this,N=0,C=T.i=T.j=0,R=T.S=[];for(S||(b=[S++]);N<a;)R[N]=N++;for(N=0;N<a;N++)R[N]=R[C=f&C+b[N%S]+(x=R[N])],R[C]=x;(T.g=function(_){for(var P,$=0,z=T.i,L=T.j,B=T.S;_--;)P=B[z=f&z+1],$=$*a+B[f&(B[z]=B[L=f&L+P])+(B[L]=P)];return T.i=z,T.j=L,$})(a)}function m(b,x){return x.i=b.i,x.j=b.j,x.S=b.S.slice(),x}function v(b,x){var S=[],T=typeof b,N;if(x&&T=="object")for(N in b)try{S.push(v(b[N],x-1))}catch{}return S.length?S:T=="string"?b:b+"\0"}function g(b,x){for(var S=b+"",T,N=0;N<S.length;)x[f&N]=f&(T^=x[f&N]*19)+S.charCodeAt(N++);return w(x)}function y(){try{var b;return h&&(b=h.randomBytes)?b=b(a):(b=new Uint8Array(a),(e.crypto||e.msCrypto).getRandomValues(b)),w(b)}catch{var x=e.navigator,S=x&&x.plugins;return[+new Date,e,S,e.screen,w(t)]}}function w(b){return String.fromCharCode.apply(0,b)}if(g(n.random(),t),r.exports){r.exports=p;try{h=vc("crypto")}catch{}}else n["seed"+s]=p})(typeof self<"u"?self:qo,[],Math)})(dS);var fG=dS.exports,hG=iG,pG=oG,dG=sG,vG=uG,mG=cG,gG=lG,jo=fG;jo.alea=hG;jo.xor128=pG;jo.xorwow=dG;jo.xorshift7=vG;jo.xor4096=mG;jo.tychei=gG;var _v=jo,yG=.001,vS=.1;function bG(r,e,t){return t==null&&(t=Fv()),sv(r,e,function(n,a){return Rv(n,a,t)})}function Fv(){return q.backend.floatPrecision()===32?yG:vS}function sv(r,e,t){var n=!0;if((Pr(r)||Pr(e))&&(n=!1),Pr(r)&&Pr(e)&&(n=!0),n){var a=r.constructor.name,i=e.constructor.name;if(a!==i)throw new Error("Arrays are of different type. Actual: ".concat(a,". ")+"Expected: ".concat(i))}if(Array.isArray(r)&&Array.isArray(e)){var o=si(r),s=si(e);if(!Ci(o,s))throw new Error("Arrays have different shapes. "+"Actual: [".concat(o,"]. Expected: [").concat(s,"]"))}var u=Pr(r)?r:Qi(r),c=Pr(e)?e:Qi(e);if(u.length!==c.length)throw new Error("Arrays have different lengths actual: ".concat(u.length," vs ")+"expected: ".concat(c.length,`.
`)+"Actual:   ".concat(u,`.
`)+"Expected: ".concat(c,"."));for(var l=0;l<c.length;++l){var f=u[l],h=c[l];if(!t(f,h))throw new Error("Arrays differ: actual[".concat(l,"] = ").concat(f,", expected[").concat(l,"] = ").concat(h,`.
`)+"Actual:   ".concat(u,`.
`)+"Expected: ".concat(c,"."))}typeof expect<"u"&&expect().nothing()}function wG(r,e){r().then(function(){return e.fail()},function(){return e()}),typeof expect<"u"&&expect().nothing()}function xG(r,e){var t=typeof e=="string"||typeof e=="number"||typeof e=="boolean"?[e]:e;return ji(r)||ji(r[0])||ji(e)||ji(e[0])?sv(r,t,function(n,a){return n==a}):sv(r,e,function(n,a){return Rv(n,a,0)})}function kG(r,e,t){if(t==null&&(t=Fv()),!Rv(r,e,t))throw new Error("Numbers differ: actual === ".concat(r,", expected === ").concat(e));typeof expect<"u"&&expect().nothing()}function Rv(r,e,t){return!isFinite(r)&&!isFinite(e)?!0:!(isNaN(r)||isNaN(e)||Math.abs(r-e)>t)}function SG(r,e,t){for(var n=0;n<r.length;n++)if(r[n]<e||r[n]>t)throw new Error("Value out of range:".concat(r[n]," low: ").concat(e,", high: ").concat(t))}function EG(r,e){var t=new Float32Array(r),n=new Float32Array(e);if(t.length!==n.length)throw new Error("Expected ArrayBuffer to be of length "+"".concat(n.length,", but it was ").concat(t.length));for(var a=0;a<n.length;a++)if(t[a]!==n[a])throw new Error("Expected ArrayBuffer value at ".concat(a," to be ")+"".concat(n[a]," but got ").concat(t[a]," instead"))}function mS(r){for(var e=0;e<r.length;e++){var t=r[e];Array.isArray(t)?mS(t):r[e]=$c(t)}return r}function TG(r){var e=document.createElement("video");return"playsInline"in e&&(e.playsInline=!0),e.muted=!0,e.loop=!0,e.style.position="fixed",e.style.left="0px",e.style.top="0px",e.preload="auto",e.appendChild(r),new Promise(function(t){e.addEventListener("loadeddata",function(n){return t(e)}),e.load()})}function NG(r){return $e(this,void 0,void 0,function(){return We(this,function(e){switch(e.label){case 0:return[4,r.play()];case 1:return e.sent(),"requestVideoFrameCallback"in r?[4,new Promise(function(t){r.requestVideoFrameCallback(t)})]:[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}})})}var IG={__proto__:null,TEST_EPSILON_FLOAT16:vS,createVideoElement:TG,encodeStrings:mS,expectArrayBuffersEqual:EG,expectArraysClose:bG,expectArraysEqual:xG,expectNumbersClose:kG,expectPromiseToFail:wG,expectValuesInRange:SG,play:NG,testEpsilon:Fv};var Ov=(function(){function r(e,t,n,a,i){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=a,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);var o=i||Math.random();this.random=_v.alea(o.toString())}return r.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,a=!1;!a;){var i=void 0,o=void 0,s=void 0;do i=2*this.random()-1,o=2*this.random()-1,s=i*i+o*o;while(s>=1||s===0);var u=Math.sqrt(-2*Math.log(s)/s);t=this.mean+this.stdDev*i*u,n=this.mean+this.stdDev*o*u,(!this.truncated||this.isValidTruncated(t))&&(a=!0)}return(!this.truncated||this.isValidTruncated(n))&&(this.nextVal=this.convertValue(n)),this.convertValue(t)},r.prototype.convertValue=function(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)},r.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},r})(),CG=(function(){function r(e,t,n,a){this.alpha=e,this.beta=1/t,this.dtype=n;var i=a||Math.random();this.randu=_v.alea(i.toString()),this.randn=new Ov(0,1,n,!1,this.randu()),e<1?this.d=e+2/3:this.d=e-1/3,this.c=1/Math.sqrt(9*this.d)}return r.prototype.nextValue=function(){for(var e,t,n,a,i,o;;){do a=this.randn.nextValue(),o=1+this.c*a;while(o<=0);if(o*=o*o,e=a*a,t=1-.331*e*e,n=.5*e+this.d*(1-o+Math.log(o)),i=this.randu(),i<t||Math.log(i)<n)break}return o=1/this.beta*this.d*o,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)},r.prototype.convertValue=function(e){return this.dtype==="float32"?e:Math.round(e)},r})(),AG=(function(){function r(e,t,n,a){e===void 0&&(e=0),t===void 0&&(t=1);var i=this;if(this.canReturnFloat=function(){return i.dtype==null||i.dtype==="float32"},this.min=e,this.range=t-e,this.dtype=n,a==null&&(a=Math.random()),typeof a=="number"&&(a=a.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between ".concat(e," - ").concat(t," <= 1 and dtype is not float"));this.random=_v.alea(a)}return r.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},r.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},r})();function DG(r,e,t,n,a){if(t===void 0&&(t=1),n===void 0&&(n="float32"),Dn(r),t==null&&(t=1),n==null&&(n="float32"),n!=="float32"&&n!=="int32")throw new Error("Unsupported data type ".concat(n));for(var i=new CG(e,t,n,a),o=Ti(r,n),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var _G=H({randomGamma_:DG});function FG(r,e,t,n,a){if(e===void 0&&(e=0),t===void 0&&(t=1),Dn(r),n!=null&&n==="bool")throw new Error("Unsupported data type ".concat(n));for(var i=new Ov(e,t,n,!1,a),o=Ti(r,n),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var gS=H({randomNormal_:FG});function RG(r,e,t){if(e!=null&&e==="bool")throw new Error("Unsupported data type ".concat(e));return gS(r,0,1,e,t)}var OG=H({randomStandardNormal_:RG});function PG(r,e,t,n,a){e===void 0&&(e=0),t===void 0&&(t=1),n===void 0&&(n="float32"),Dn(r);for(var i=Ti(r,n),o=new AG(e,t,null,a),s=0;s<i.values.length;s++)i.values[s]=o.nextValue();return i.toTensor()}var Pv=H({randomUniform_:PG});function MG(r,e,t,n){return Pv(r,e,t,"int32",n)}var BG=H({randomUniformInt_:MG});function Rc(r,e,t,n){if(t===void 0&&(t=1),n===void 0&&(n="float32"),t===0)throw new Error("Cannot have a step of zero");var a={start:r,stop:e,step:t,dtype:n};return q.runKernel(nk,{},a)}function LG(r){var e=O(r,"input","real"),t={input:e};return q.runKernel(ak,t)}var Oc=H({real_:LG});function zG(r){var e=O(r,"x","reciprocal"),t={x:e};return q.runKernel(ik,t)}var $G=H({reciprocal_:zG});function WG(r){var e=O(r,"x","relu"),t={x:e};return q.runKernel(ok,t)}var Qf=H({relu_:WG});function GG(r){var e=O(r,"x","relu6"),t={x:e};return q.runKernel(lk,t)}var yS=H({relu6_:GG});function VG(r,e){var t=O(r,"x","reverse"),n={x:t},a={dims:e};return q.runKernel(fk,n,a)}var Uo=H({reverse_:VG});function UG(r){var e=O(r,"x","reverse");return W(e.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank ".concat(e.rank,".")}),Uo(e,0)}var HG=H({reverse1d_:UG});function qG(r,e){var t=O(r,"x","reverse");return W(t.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank ".concat(t.rank,".")}),Uo(t,e)}var KG=H({reverse2d_:qG});function jG(r,e){var t=O(r,"x","reverse");return W(t.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank ".concat(t.rank,".")}),Uo(t,e)}var XG=H({reverse3d_:jG});function YG(r,e){var t=O(r,"x","reverse");return W(t.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank ".concat(t.rank,".")}),Uo(t,e)}var ZG=H({reverse4d_:YG});function JG(r){var e=O(r,"x","round"),t={x:e};return q.runKernel(hk,t)}var bS=H({round_:JG});function QG(r){var e=O(r,"x","rsqrt","float32"),t={x:e};return q.runKernel(pk,t)}var eV=H({rsqrt_:QG});function tV(r){var e=O(r,"x","selu"),t={x:e};return q.runKernel(yk,t)}var rV=H({selu_:tV});function nV(r,e,t,n,a,i,o){i===void 0&&(i=[1,1]),o===void 0&&(o="NHWC");var s=O(r,"x","separableConv2d"),u=O(e,"depthwiseFilter","separableConv2d"),c=O(t,"pointwiseFilter","separableConv2d"),l=s,f=!1;if(s.rank===3&&(f=!0,l=ve(s,[1,s.shape[0],s.shape[1],s.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");W(l.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got "+"rank ".concat(l.rank,".")}),W(u.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but "+"got rank ".concat(u.rank,".")}),W(c.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but "+"got rank ".concat(u.rank,".")}),W(c.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter "+" must be 1, but got ".concat(c.shape[0],".")}),W(c.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise "+"filter must be 1, but got ".concat(c.shape[1],".")});var h=u.shape[2],p=u.shape[3];W(c.shape[2]===h*p,function(){return"Error in separableConv2d: the third dimension of pointwise filter "+"must be ".concat(h*p,", ")+"but got ".concat(c.shape[2],".")});var d=Nv(l,u,n,a,o,i),m=1,v=jf(d,c,m,"valid",o);return f?ve(v,[v.shape[1],v.shape[2],v.shape[3]]):v}var aV=H({separableConv2d_:nV});function iV(r,e){return $e(this,void 0,void 0,function(){var t,n,a,i,o,s,l,u,c,l,f;return We(this,function(h){switch(h.label){case 0:return t=O(r,"x","setdiff1d"),n=O(e,"y","setdiff1d"),W(t.dtype===n.dtype,function(){return"x and y should have the same dtype, but got x (".concat(t.dtype,") and y (").concat(n.dtype,").")}),W(t.rank===1,function(){return"x should be 1D tensor, but got x (".concat(t.shape,").")}),W(n.rank===1,function(){return"y should be 1D tensor, but got y (".concat(n.shape,").")}),[4,t.data()];case 1:return a=h.sent(),[4,n.data()];case 2:for(i=h.sent(),o=new Set(i),s=0,l=0;l<a.length;l++)o.has(a[l])||s++;for(u=new Mf([s],t.dtype),c=new Mf([s],"int32"),l=0,f=0;l<a.length;l++)o.has(a[l])||(u.values[f]=a[l],c.values[f]=l,f++);return[2,[u.toTensor(),c.toTensor()]]}})})}var oV=iV;function sV(r){var e=O(r,"x","sign"),t={x:e};return q.runKernel(kk,t)}var uV=H({sign_:sV});function cV(r){var e=O(r,"x","sin","float32"),t={x:e};return q.runKernel(wk,t)}var lV=H({sin_:cV});function fV(r){var e=O(r,"x","sinh"),t={x:e};return q.runKernel(xk,t)}var hV=H({sinh_:fV});function pV(r,e,t){var n=O(r,"x","slice1d");return W(n.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-".concat(n.rank," tensor")}),Jt(n,[e],[t])}var dV=H({slice1d_:pV});function vV(r,e,t){var n=O(r,"x","slice2d");return W(n.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-".concat(n.rank," tensor")}),Jt(n,e,t)}var mV=H({slice2d_:vV});function gV(r,e,t){var n=O(r,"x","slice3d");return W(n.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-".concat(n.rank," tensor")}),Jt(n,e,t)}var yV=H({slice3d_:gV});function bV(r,e,t){var n=O(r,"x","slice4d");return W(n.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-".concat(n.rank," tensor")}),Jt(n,e,t)}var wV=H({slice4d_:bV});function xV(r,e){e===void 0&&(e=-1);var t=O(r,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(t.rank," and dim was ").concat(e));var n={logits:t},a={dim:e};return q.runKernel(Ak,n,a)}var kV=H({softmax_:xV});function SV(r){W(r.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 "+"but got ".concat(r.dtype,".")});var e={input:r};return q.runKernel(ix,e)}var Mv=H({fft_:SV});function EV(r){W(r.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 "+"but got ".concat(r.dtype,".")});var e={input:r};return q.runKernel(vx,e)}var $f=H({ifft_:EV});function TV(r){var e=r.shape[r.shape.length-1],t=r.size/e,n;if(e<=2){var a=ve(r,[t,e]);n=$f(a)}else{var i=[t,2*(e-1)],o=ve(Oc(r),[t,e]),s=ve(Zf(r),[t,e]),u=Uo(Jt(o,[0,1],[t,e-2]),1),c=Pe(Uo(Jt(s,[0,1],[t,e-2]),1),Rt(-1)),l=An([o,u],1),f=An([s,c],1),a=ve(eo(l,f),[i[0],i[1]]);n=$f(a)}if(n=Oc(n),r.rank===3&&r.shape[0]!==0){var h=n,p=r.shape[0];n=ve(n,[p,n.shape[0]/p,n.shape[1]]),h.dispose()}return n}var wS=H({irfft_:TV});function NV(r,e,t){t===void 0&&(t=0);var n=O(r,"x","split"),a={x:n},i={numOrSizeSplits:e,axis:t};return q.runKernel(Ck,a,i)}var Pc=H({split_:NV});function IV(r,e){W(r.dtype==="float32",function(){return"The dtype for rfft() must be real value but got ".concat(r.dtype)});var t=r.shape[r.shape.length-1],n=r.size/t,a;if(e!=null&&e<t){var i=r.shape.map(function(g){return 0}),o=r.shape.map(function(g){return g});o[r.shape.length-1]=e,a=Jt(r,i,o),t=e}else if(e!=null&&e>t){var s=r.shape.map(function(g){return g});s[r.shape.length-1]=e-t,a=An([r,au(s)],r.shape.length-1),t=e}else a=r;var u=Zn(a),c=ve(eo(a,u),[n,t]),l=Mv(c),f=Math.floor(t/2)+1,h=Oc(l),p=Zf(l),d=Pc(h,[f,t-f],h.shape.length-1),m=Pc(p,[f,t-f],p.shape.length-1),v=a.shape.slice();return v[a.shape.length-1]=f,ve(eo(d[0],m[0]),v)}var Bv=H({rfft_:IV});function CV(r,e){var t,n=O(r,"a","squaredDifference"),a=O(e,"b","squaredDifference");t=ke(or(n,a),2),n=t[0],a=t[1],Tr(n.shape,a.shape);var i={a:n,b:a},o={};return q.runKernel(Pk,i,o)}var xS=H({squaredDifference_:CV});function AV(r,e){var t=O(r,"x","squeeze","string_or_numeric");return ve(t,Qw(t.shape,e).newShape)}var Lv=H({squeeze_:AV});function DV(r,e){e===void 0&&(e=0);var t=Ic(r,"tensors","stack","string_or_numeric");W(t.length>=1,function(){return"Pass at least one tensor to tf.stack"}),t.length>0&&W(e<=t[0].rank,function(){return"Axis must be <= rank of the tensor"});var n=t,a={axis:e};return q.runKernel(Xx,n,a)}var Mc=H({stack_:DV});function _V(r,e){e===void 0&&(e=0);var t=O(r,"x","step"),n={x:t},a={alpha:e};return q.runKernel(Yk,n,a)}var kS=H({step_:_V});function FV(r,e,t,n,a,i,o,s,u){a===void 0&&(a=0),i===void 0&&(i=0),o===void 0&&(o=0),s===void 0&&(s=0),u===void 0&&(u=0);var c=O(r,"x","stridedSlice","string_or_numeric"),l={x:c},f={begin:e,end:t,strides:n,beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u};return q.runKernel(Bk,l,f)}var RV=H({stridedSlice_:FV});function OV(r){var e=O(r,"x","tan","float32"),t={x:e};return q.runKernel(Gk,t)}var PV=H({tan_:OV});function pa(r,e){Ho(r);var t=si(r,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");var n=null;return no(r,n,t,e)}function xc(r,e,t){if(Ho(r),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var n=si(r,t);if(n.length!==2&&n.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return no(r,e,n,t)}function SS(r,e,t){if(Ho(r),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var n=si(r,t);if(n.length!==3&&n.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return no(r,e,n,t)}function MV(r,e,t){if(Ho(r),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var n=si(r,t);if(n.length!==4&&n.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return no(r,e,n,t)}function BV(r,e,t){if(Ho(r),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var n=si(r,t);if(n.length!==5&&n.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return no(r,e,n,t)}function LV(r,e,t){if(Ho(r),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var n=si(r,t);if(n.length!==6&&n.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return e=e||n,no(r,e,n,t)}function zv(r,e,t){var n=e.rank>1?e.shape[e.rank-1]:1,a=e.rank>1?e.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + "+"shape[sliceDim:], got updates.shape: ".concat(t.shape)+", indices.shape: ".concat(e.shape,", shape: ").concat(r)+", sliceDim: ".concat(n,", and batchDim: ").concat(a,".");if(t.rank<a)throw new Error(i+" update.rank < ".concat(a,". "));if(r.length<n+(t.rank-a))throw new Error(i+" Output shape length < ".concat(n+(t.rank-a)));if(t.rank!==a+r.length-n)throw new Error(i+" update.rank != ".concat(a+r.length-n));for(var o=0;o<a;++o)if(t.shape[o]!==e.shape[o])throw new Error(i+" updates.shape[".concat(o,"] (").concat(t.shape[o],") != indices.shape[").concat(o,"] (").concat(e.shape[o],")."));for(var o=0;o<t.rank-a;++o)if(t.shape[o+a]!==r[o+n])throw new Error(i+" updates.shape[".concat(o+a,"] (").concat(t.shape[o+a],") != shape[").concat(o+a,"] (").concat(r[o+a],")"))}function eh(r,e,t){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher,"+" but the rank was ".concat(e.rank,"."));if(r.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher,"+" but the rank was ".concat(r.rank,"."));if(e.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: ".concat(e.dtype));if(t.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: ".concat(t));if(t.length===0){if(e.size===0)throw new Error("Indices specified for empty output. indices shape: ".concat(e.shape));if(r.size===0)throw new Error("Updates specified for empty output. updates shape: ".concat(r.shape))}zv(t,e,r)}function ES(r,e,t){for(var n=e.shape.length,a=n>1?e.shape[n-1]:1,i=t.length,o=1,s=a;s<i;++s)o*=t[s];var u=a<1?1:a,c=Dt(e.shape)/u,l=pt(pt([],ke(iu(t.slice(0,a))),!1),[1],!1),f=Dt(t);return{sliceRank:a,numUpdates:c,sliceSize:o,strides:l,outputSize:f}}var zV={__proto__:null,calculateShapes:ES,validateInput:eh,validateUpdateShape:zv};function $V(r,e,t){var n=O(r,"tensor","tensorScatterupdate"),a=O(e,"indices","tensorScatterupdate","int32"),i=O(t,"updates","tensorScatterupdate");if(eh(i,a,n.shape),n.dtype!==i.dtype)throw new Error("tensor and updates must have the same dtype, instead they are ".concat(n.dtype," and ").concat(i.dtype,"."));var o={tensor:n,indices:a,updates:i},s={};return q.runKernel(vk,o,s)}var WV=H({tensorScatterUpdate_:$V});function GV(r,e,t){e===void 0&&(e=1),t===void 0&&(t=!0);var n=O(r,"x","topk");if(n.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var a=n.shape[n.shape.length-1];if(e<0)throw new Error("'k' passed to topk() must be >= 0 but got ".concat(e));if(e>a)throw new Error("'k' passed to topk() must be <= the last dimension (".concat(a,") ")+"but got ".concat(e));var i={x:n},o={k:e,sorted:t},s=ke(q.runKernel(Uk,i,o),2),u=s[0],c=s[1];return{values:u,indices:c}}var VV=H({topk_:GV});function UV(r,e,t,n,a){if(e===void 0&&(e=0),t===void 0&&(t=1),Dn(r),n!=null&&n==="bool")throw new Error("Unsupported data type $ { dtype }");for(var i=new Ov(e,t,n,!0,a),o=Ti(r,n),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var HV=H({truncatedNormal_:UV});function qV(r,e){e===void 0&&(e=0);var t=O(r,"x","unique","string_or_numeric");W(t.rank>0,function(){return"The input tensor must be at least 1D"});var n={x:t},a={axis:e},i=ke(q.runKernel(qk,n,a),2),o=i[0],s=i[1];return{values:o,indices:s}}var KV=H({unique_:qV});function jV(r,e,t){var n=O(r,"x","unsortedSegmentSum"),a=O(e,"segmentIds","unsortedSegmentSum","int32");W(tu(t),function(){return"numSegments must be of dtype int"});var i={x:n,segmentIds:a},o={numSegments:t};return q.runKernel(jk,i,o)}var XV=H({unsortedSegmentSum_:jV});function YV(r,e){e===void 0&&(e=0);var t=O(r,"x","unstack","string_or_numeric");W(e>=-t.shape.length&&e<t.shape.length,function(){return"Axis = ".concat(e," is not in [-").concat(t.shape.length,", ").concat(t.shape.length,")")});var n={value:t},a={axis:e};return q.runKernel(Kk,n,a)}var $v=H({unstack_:YV});function ZV(r,e){return Dv(r,e,"right")}function JV(r,e,t,n){return e===void 0&&(e=!0),q.makeVariable(r,e,t,n)}function TS(r,e){for(var t=[],n=0;n<e.length;n++)e[n]&&t.push(n);for(var a=Ti(r,"int32"),i=Ti([t.length,r.length],"int32"),n=0;n<t.length;n++){var o=a.indexToLoc(t[n]),s=n*r.length;i.values.set(o,s)}return i.toTensor()}function QV(r){return $e(this,void 0,void 0,function(){var e,t,n;return We(this,function(a){switch(a.label){case 0:return e=O(r,"condition","whereAsync","bool"),[4,e.data()];case 1:return t=a.sent(),n=TS(e.shape,t),r!==e&&e.dispose(),[2,n]}})})}var NS=QV;function eU(r,e,t){return $e(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f,h,p,d,m;return We(this,function(v){switch(v.label){case 0:for(n=O(r,"tensor","boolMask"),a=O(e,"mask","boolMask","bool"),i=t??0,o=a.rank,s=n.shape,W(o>0,function(){return"mask cannot be scalar"}),sn(s.slice(i,i+o),a.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,c=i;c<i+o;c++)u*=s[c];return l=s.slice(0,i).concat([u],s.slice(i+o)),f=ve(n,l),h=ve(a,[-1]),[4,NS(h)];case 1:return p=v.sent(),d=Lv(p,[1]),m=j2(f,d,i),r!==n&&n.dispose(),e!==a&&a.dispose(),d.dispose(),f.dispose(),h.dispose(),p.dispose(),[2,m]}})})}var tU=eU;function rU(r,e,t){var n=O(r,"x","transpose");if(e==null&&(e=n.shape.map(function(o,s){return s}).reverse()),W(n.rank===e.length,function(){return"Error in transpose: rank of input ".concat(n.rank," ")+"must match length of perm ".concat(e,".")}),e.forEach(function(o){W(o>=0&&o<n.rank,function(){return"All entries in 'perm' must be between 0 and ".concat(n.rank-1)+" but got ".concat(e)})}),n.rank<=1)return n.clone();var a={x:n},i={perm:e};return n.dtype==="complex64"?Er(function(){var o=Oc(n),s=Zf(n);return o=q.runKernel(Nf,{x:o},i),s=q.runKernel(Nf,{x:s},i),t&&(s=oi(s)),eo(o,s)}):q.runKernel(Nf,a,i)}var Wf=H({transpose_:rU});function nU(r,e,t,n,a){a===void 0&&(a=!0);var i=O(r,"v","movingAverage"),o=O(e,"x","movingAverage"),s=O(t,"decay","movingAverage");h2(i,o),W(Ci(i.shape,o.shape),function(){return"Shape mismatch in v and x"});var u=Rt(1),c=ht(u,s),l=Pe(ht(o,i),c);if(a){W(n!=null,function(){return"When using zeroDebias: true, step is required."});var f=O(n,"step","movingAverage");l=Lt(l,ht(u,_c(s,f)))}return at(i,l)}var aU=H({movingAverage_:nU});function iU(r,e,t){Dn(t);var n=O(r,"indices","scatterND","int32"),a=O(e,"updates","scatterND");eh(a,n,t);var i={indices:n,updates:a},o={shape:t};return q.runKernel(dk,i,o)}var oU=H({scatterND_:iU});function sU(r,e,t,n){if(r.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type,"+" but the dtype was ".concat(r.dtype,"."));if(r.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix,"+" but got shape ".concat(r.shape,"."));var a=r.rank>0?r.shape[0]:1,i=r.rank>1?r.shape[1]:1;if(t.length!==i)throw new Error("outputShape has incorrect number of elements:,"+" ".concat(t.length,", should be: ").concat(i,"."));var o=e.size;if(!(e.rank===0||e.rank===1&&o===a))throw new Error("sparseValues has incorrect shape "+"".concat(e.shape,", should be [] or [").concat(a,"]"));if(e.dtype!==n.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}function uU(r,e,t,n){n===void 0&&(n=0),Dn(t);var a=O(r,"sparseIndices","sparseToDense","int32"),i=O(e,"sparseValues","sparseToDense","string_or_numeric"),o=O(n,"defaultValue","sparseToDense",i.dtype);sU(a,i,t,o);var s={sparseIndices:a,sparseValues:i,defaultValue:o},u={outputShape:t};return q.runKernel(Ok,s,u)}var cU=H({sparseToDense_:uU});function lU(r,e){var t=O(e,"indices","gatherND","int32"),n=O(r,"x","gatherND","string_or_numeric"),a={params:n,indices:t};return q.runKernel(hx,a)}var fU=H({gatherND_:lU});function hU(r,e){if(e==null)return r.shape.slice();if(Ci(r.shape,e))return e;if(r.shape.length===e.length){for(var t=[],n=0;n<r.shape.length;n++)e[n]==null&&r.shape[n]!=null?t.push(r.shape[n]):t.push(e[n]);return t}return e}function pU(r,e,t,n){var a=O(r,"x","dropout");if(W(a.dtype==="float32",function(){return"x has to be a floating point tensor since it's going to be "+"scaled, but got a ".concat(a.dtype," tensor instead.")}),W(e>=0&&e<1,function(){return"rate must be a float in the range [0, 1), but got ".concat(e,".")}),e===0)return r instanceof Sr?a.clone():a;var i=hU(a,t),o=1-e,s=Lt(K2(at(Pv(i,0,1,"float32",n),o)),o);return Pe(a,s)}var dU=H({dropout_:pU});function IS(r){return Math.floor(Math.pow(2,Math.ceil(Math.log(r)/Math.log(2))))}function Wv(r,e,t){for(var n=1-r%2,a=new Float32Array(r),i=0;i<r;++i){var o=2*Math.PI*i/(r+n-1);a[i]=e-t*Math.cos(o)}return pa(a,"float32")}function vU(r,e,t){return t===void 0&&(t=1),$e(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f,h,p,d,m,v,v;return We(this,function(g){switch(g.label){case 0:return n=O(r,"predictions","inTopK"),a=O(e,"targets","inTopK"),W(n.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, "+"but got ".concat(n.rank)}),W(n.rank-1===a.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+"".concat(n.rank," and targets rank ").concat(a.rank)}),sn(n.shape.slice(0,n.shape.length-1),a.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),i=n.shape[n.shape.length-1],W(t>0&&t<=i,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last "+"dimension (".concat(i,"), but got ").concat(t)}),[4,n.data()];case 1:return o=g.sent(),[4,a.data()];case 2:for(s=g.sent(),u=ke([o.length/i,i],2),c=u[0],l=u[1],f=e1("bool",c),h=0;h<c;h++){for(p=h*l,d=o.subarray(p,p+l),m=[],v=0;v<d.length;v++)m.push({value:d[v],index:v});for(m.sort(function(y,w){return w.value-y.value}),f[h]=0,v=0;v<t;v++)if(m[v].index===s[h]){f[h]=1;break}}return r!==n&&n.dispose(),e!==a&&a.dispose(),[2,Ys(f,a.shape,"bool")]}})})}var mU=vU;function gU(r,e,t,n,a,i,o){i===void 0&&(i="NHWC");var s=r;r.rank===3&&(s=ve(r,[1,r.shape[0],r.shape[1],r.shape[2]]));var u=e;u.rank===3&&(u=ve(e,[1,e.shape[0],e.shape[1],e.shape[2]])),W(s.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+"".concat(s.shape,".")}),W(u.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+"".concat(u.shape,".")}),W(t.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+"".concat(t,".")});var c=i==="NHWC"?s.shape[3]:s.shape[1],l=i==="NHWC"?u.shape[3]:u.shape[1];W(c===t[2],function(){return"Error in conv2dDerFilter: depth of input ".concat(c,") must ")+"match input depth in filter (".concat(t[2],".")}),W(l===t[3],function(){return"Error in conv2dDerFilter: depth of dy (".concat(l,") must ")+"match output depth for filter (".concat(t[3],").")}),da("conv2dDerFilter",a,o);var f={x:s,dy:u},h={strides:n,pad:a,dataFormat:i,dimRoundingMode:o,filterShape:t};return q.runKernel(P1,f,h)}var yU=H({conv2DBackpropFilter_:gU});function th(r,e,t){if(t==null||t==="linear")return r;if(t==="relu")return Pe(r,kS(e));throw new Error("Cannot compute gradient for fused activation ".concat(t,"."))}function rh(r,e){var t=e,n=Iv(r.shape,e.shape);return n.length>0&&(t=Bt(t,n)),ve(t,r.shape)}function nh(r,e,t,n){if(e==="linear")return r;if(e==="relu")return Qf(r);if(e==="elu")return V2(r);if(e==="relu6")return yS(r);if(e==="prelu")return sS(r,t);if(e==="leakyrelu")return Y2(r,n);if(e==="sigmoid")return Qs(r);throw new Error("Unknown fused activation ".concat(e,"."))}var ah=function(r,e){var t=r>0;return!t||e==="linear"};function bU(r){var e,t=r.x,n=r.filter,a=r.strides,i=r.pad,o=r.dataFormat,s=o===void 0?"NHWC":o,u=r.dilations,c=u===void 0?[1,1]:u,l=r.dimRoundingMode,f=r.bias,h=r.activation,p=h===void 0?"linear":h,d=r.preluActivationWeights,m=r.leakyreluAlpha;if(p=p||"linear",ah(q.state.gradientDepth,p)===!1){W(s==="NHWC",function(){return"Error in fused conv2d: got dataFormat of ".concat(s," but ")+"only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear."});var v=jf(t,n,a,i,s,c,l);return f!=null&&(v=at(v,f)),nh(v,p,d,m)}var g=O(t,"x","conv2d","float32"),y=O(n,"filter","conv2d","float32"),w=g,b=!1;g.rank===3&&(b=!0,w=ve(g,[1,g.shape[0],g.shape[1],g.shape[2]])),W(w.rank===4,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+"".concat(w.rank,".")}),W(y.rank===4,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+"".concat(y.rank,".")}),da("fused conv2d",i,l);var x=s==="NHWC"?w.shape[3]:w.shape[1];W(y.shape[2]===x,function(){return"Error in conv2d: depth of input (".concat(x,") must match ")+"input depth for filter ".concat(y.shape[2],".")}),W(Di(a,c),function(){return"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(a," and dilations '").concat(c,"'")});var S=Gc(w.shape,y.shape,a,c,i,l),T;f!=null&&(T=O(f,"bias","fused conv2d"),e=ke(or(T,g),1),T=e[0],s==="NHWC"?Tr(S.outShape,T.shape):(W(T.shape.length<=1,function(){return"Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of "+"rank-".concat(T.shape.length,".")}),W(T.shape.length===0||T.shape[0]===S.outChannels||T.shape[0]===1,function(){return"Error in fused conv2d: bias shape (".concat(T.shape,") is not ")+"compatible with the number of output channels "+"(".concat(S.outChannels,")")})));var N;if(d!=null){var C=d.shape;if(W(C.length<=1||C.length===3,function(){return"Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of "+"rank-".concat(C.length,".")}),C.length===1)W(C[0]===1||C[0]===S.outChannels,function(){return"Error in fused conv2d: PReLU activation weights "+"(".concat(C,") is not compatible with the number of output ")+"channels (".concat(S.outChannels,").")});else if(C.length===3)try{Tr(C,S.outShape)}catch{var R="Error in fused conv2d: PReLU activation weights (".concat(C,") ")+"is not compatible with the output shape of the conv2d "+"(".concat(S.outShape,").");throw Error(R)}N=O(d,"prelu weights","fused conv2d")}var _=function(B,G){W(s==="NHWC",function(){return"Error in gradient of fused conv2D: got dataFormat of ".concat(s," but only NHWC is currently supported.")});var X=ke(G,4),Z=X[0],V=X[1],j=X[2],re=X[3],te=th(B,j,p);W(Dc(c),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 "+"are not yet supported in gradients. Got dilations '".concat(c,"'")});var oe=$2(V.shape,te,Z,a,i),ce=yU(V,te,Z.shape,a,i),pe=[oe,ce];if(re!=null){var xe=rh(re,te);pe.push(xe)}return pe},P={x:w,filter:y,bias:T,preluActivationWeights:N},$={strides:a,pad:i,dataFormat:s,dilations:c,dimRoundingMode:l,activation:p,leakyreluAlpha:m};if(f==null){var z=ui(function(B,G,X){var Z=q.runKernel(Gd,P,$);return X([G,B,Z]),b&&(Z=ve(Z,[Z.shape[1],Z.shape[2],Z.shape[3]])),{value:Z,gradFunc:_}});return z(w,y)}else{var L=ui(function(B,G,X,Z){var V=q.runKernel(Gd,P,$);return Z([G,B,V,X]),b&&(V=ve(V,[V.shape[1],V.shape[2],V.shape[3]])),{value:V,gradFunc:_}});return L(w,y,T)}}var wU=H({fusedConv2d_:bU});function xU(r,e,t,n,a,i,o){i===void 0&&(i=[1,1]);var s=r;r.rank===3&&(s=ve(r,[1,r.shape[0],r.shape[1],r.shape[2]]));var u=e;u.rank===3&&(u=ve(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var c={x:s,dy:u},l={strides:n,pad:a,dimRoundingMode:o,dilations:i,filterShape:t};return q.runKernel(K1,c,l)}var kU=H({depthwiseConv2dNativeBackpropFilter_:xU});function SU(r,e,t,n,a,i,o){i===void 0&&(i=[1,1]);var s=e,u=!1;e.rank===3&&(u=!0,s=ve(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var c={dy:s,filter:t},l={strides:n,pad:a,dimRoundingMode:o,dilations:i,inputShape:r},f=q.runKernel(j1,c,l);return u?ve(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var EU=H({depthwiseConv2dNativeBackpropInput_:SU});function TU(r){var e,t=r.x,n=r.filter,a=r.strides,i=r.pad,o=r.dataFormat,s=o===void 0?"NHWC":o,u=r.dilations,c=u===void 0?[1,1]:u,l=r.dimRoundingMode,f=r.bias,h=r.activation,p=h===void 0?"linear":h,d=r.preluActivationWeights,m=r.leakyreluAlpha;if(ah(q.state.gradientDepth,p)===!1){var v=Nv(t,n,a,i,s,c,l);return f!=null&&(v=at(v,f)),nh(v,p,d,m)}var g=O(t,"x","depthwiseConv2d","float32"),y=O(n,"filter","depthwiseConv2d","float32"),w=g,b=!1;g.rank===3&&(b=!0,w=ve(g,[1,g.shape[0],g.shape[1],g.shape[2]])),W(w.rank===4,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got "+"rank ".concat(w.rank,".")}),W(y.rank===4,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, "+"but got rank ".concat(y.rank,".")}),W(w.shape[3]===y.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels "+"(".concat(w.shape[3],") must match the inChannels dimension in ")+"filter ".concat(y.shape[2],".")}),c==null&&(c=[1,1]),W(Di(a,c),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must "+"be 1. Got strides ".concat(a," and dilations '").concat(c,"'")}),da("fused depthwiseConv2d",i,l);var x=Gc(w.shape,y.shape,a,c,i,l,!0),S;f!=null&&(S=O(f,"bias","fused conv2d"),e=ke(or(S,g),1),S=e[0],Tr(x.outShape,S.shape));var T;d!=null&&(T=O(d,"prelu weights","fused depthwiseConv2d"));var N=function($,z){W(Dc(c),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations "+"'".concat(c,"'")});var L=ke(z,4),B=L[0],G=L[1],X=L[2],Z=L[3],V=th($,X,p),j=EU(G.shape,V,B,a,i,c,l),re=kU(G,V,B.shape,a,i,c,l);if(Z!=null){var te=rh(S,V);return[j,re,te]}return[j,re]},C={x:w,filter:y,bias:S,preluActivationWeights:T},R={strides:a,pad:i,dataFormat:s,dilations:c,dimRoundingMode:l,activation:p,leakyreluAlpha:m};if(f==null){var _=ui(function($,z,L){var B=q.runKernel(Vd,C,R);return L([z,$,B]),b&&(B=ve(B,[B.shape[1],B.shape[2],B.shape[3]])),{value:B,gradFunc:N}});return _(w,y)}else{var P=ui(function($,z,L,B){var G=q.runKernel(Vd,C,R);return B([z,$,G,L]),b&&(G=ve(G,[G.shape[1],G.shape[2],G.shape[3]])),{value:G,gradFunc:N}});return P(w,y,S)}}var NU=H({fusedDepthwiseConv2d_:TU});function IU(r){var e,t,n=r.a,a=r.b,i=r.transposeA,o=i===void 0?!1:i,s=r.transposeB,u=s===void 0?!1:s,c=r.bias,l=r.activation,f=l===void 0?"linear":l,h=r.preluActivationWeights,p=r.leakyreluAlpha,d=p===void 0?.2:p;if(ah(q.state.gradientDepth,f)===!1){var m=Nt(n,a,o,u);return c!=null&&(m=at(m,c)),nh(m,f,h,d)}var v=O(n,"a","fused matMul"),g=O(a,"b","fused matMul");e=ke(or(v,g),2),v=e[0],g=e[1];var y=o?v.shape[v.rank-2]:v.shape[v.rank-1],w=u?g.shape[g.rank-1]:g.shape[g.rank-2],b=o?v.shape[v.rank-1]:v.shape[v.rank-2],x=u?g.shape[g.rank-2]:g.shape[g.rank-1],S=v.shape.slice(0,-2),T=g.shape.slice(0,-2),N=Dt(S),C=Dt(T);W(y===w,function(){return"Error in fused matMul: inner shapes (".concat(y,") and (")+"".concat(w,") of Tensors with shapes ").concat(v.shape," and ")+"".concat(g.shape," and transposeA=").concat(o)+" and transposeB=".concat(u," must match.")});var R=Tr(v.shape.slice(0,-2),g.shape.slice(0,-2)),_=R.concat([b,x]),P=o?ve(v,[N,y,b]):ve(v,[N,b,y]),$=u?ve(g,[C,x,w]):ve(g,[C,w,x]),z;c!=null&&(z=O(c,"bias","fused matMul"),t=ke(or(z,v),1),z=t[0],Tr(_,z.shape));var L;h!=null&&(L=O(h,"prelu weights","fused matMul"));var B=function(j,re){var te=ke(re,4),oe=te[0],ce=te[1],pe=te[2],xe=te[3],fe=th(ve(j,pe.shape),pe,f),ge,we;if(!o&&!u?(ge=Nt(fe,ce,!1,!0),we=Nt(oe,fe,!0,!1)):!o&&u?(ge=Nt(fe,ce,!1,!1),we=Nt(fe,oe,!0,!1)):o&&!u?(ge=Nt(ce,fe,!1,!0),we=Nt(oe,fe,!1,!1)):(ge=Nt(ce,fe,!0,!0),we=Nt(fe,oe,!0,!0)),c!=null){var Ae=rh(xe,fe);return[ge,we,Ae]}else return[ge,we]},G={a:P,b:$,bias:z,preluActivationWeights:L},X={transposeA:o,transposeB:u,activation:f,leakyreluAlpha:d};if(c==null){var Z=ui(function(j,re,te){var oe=q.runKernel(Wd,G,X);return te([j,re,oe]),{value:ve(oe,_),gradFunc:B}});return Z(P,$)}else{var V=ui(function(j,re,te,oe){var ce=q.runKernel(Wd,G,X);return oe([j,re,ce,te]),{value:ve(ce,_),gradFunc:B}});return V(P,$,z)}}var CU=H({fusedMatMul_:IU});var AU={__proto__:null,conv2d:wU,depthwiseConv2d:NU,matMul:CU};function DU(r){return Wv(r,.54,.46)}var _U=H({hammingWindow_:DU});function FU(r){return Wv(r,.5,.5)}var CS=H({hannWindow_:FU});function RU(r,e,t,n,a){n===void 0&&(n=!1),a===void 0&&(a=0);for(var i=0,o=[];i+e<=r.size;)o.push(Jt(r,i,e)),i+=t;if(n)for(;i<r.size;){var s=i+e-r.size,u=An([Jt(r,i,e-s),Vc([s],a)]);o.push(u),i+=t}return o.length===0?xc([],[0,e]):ve(An(o),[o.length,e])}var AS=H({frame_:RU});function OU(r,e,t,n,a){a===void 0&&(a=CS),n==null&&(n=IS(e));var i=AS(r,e,t),o=Pe(i,a(e));return Bv(o,n)}var PU=H({stft_:OU});function MU(r,e,t,n,a,i){a===void 0&&(a="bilinear"),i===void 0&&(i=0);var o=O(r,"image","cropAndResize"),s=O(e,"boxes","cropAndResize","float32"),u=O(t,"boxInd","cropAndResize","int32"),c=s.shape[0];W(o.rank===4,function(){return"Error in cropAndResize: image must be rank 4,"+"but got rank ".concat(o.rank,".")}),W(s.rank===2&&s.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size [".concat(c,",4] ")+"but had shape ".concat(s.shape,".")}),W(u.rank===1&&u.shape[0]===c,function(){return"Error in cropAndResize: boxInd must be have size [".concat(c,"] ")+"but had shape ".concat(s.shape,".")}),W(n.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got "+"length ".concat(n.length,".")}),W(n[0]>=1&&n[1]>=1,function(){return"cropSize must be atleast [1,1], but was ".concat(n)}),W(a==="bilinear"||a==="nearest",function(){return"method must be bilinear or nearest, but was ".concat(a)});var l={image:o,boxes:s,boxInd:u},f={method:a,extrapolationValue:i,cropSize:n},h=q.runKernel(V1,l,f);return h}var BU=H({cropAndResize_:MU});function LU(r){var e=O(r,"image","flipLeftRight","float32");W(e.rank===4,function(){return"Error in flipLeftRight: image must be rank 4,"+"but got rank ".concat(e.rank,".")});var t={image:e},n=q.runKernel(sx,t,{});return n}var zU=H({flipLeftRight_:LU});function $U(r){var e=O(r,"image","grayscaleToRGB"),t=e.rank-1,n=e.shape[t];W(e.rank>=2,function(){return"Error in grayscaleToRGB: images must be at least rank 2, "+"but got rank ".concat(e.rank,".")}),W(n===1,function(){return"Error in grayscaleToRGB: last dimension of a grayscale image "+"should be size 1, but got size ".concat(n,".")});var a=new Array(e.rank);return a.fill(1,0,t),a[t]=3,wc(e,a)}var WU=H({grayscaleToRGB_:$U});function GU(r){var e=O(r,"image","RGBToGrayscale"),t=e.rank-1,n=e.shape[t];W(e.rank>=2,function(){return"Error in RGBToGrayscale: images must be at least rank 2, "+"but got rank ".concat(e.rank,".")}),W(n===3,function(){return"Error in RGBToGrayscale: last dimension of an RGB image "+"should be size 3, but got size ".concat(n,".")});var a=e.dtype,i=Wt(e,"float32"),o=pa([.2989,.587,.114]),s;switch(e.rank){case 2:s=Ks("ij,j->i",i,o);break;case 3:s=Ks("ijk,k->ij",i,o);break;case 4:s=Ks("ijkl,l->ijk",i,o);break;case 5:s=Ks("ijklm,m->ijkl",i,o);break;case 6:s=Ks("ijklmn,n->ijklm",i,o);break;default:throw new Error("Not a valid tensor rank.")}return s=qi(s,-1),Wt(s,a)}var VU=H({rgbToGrayscale_:GU});function UU(r,e,t,n){t===void 0&&(t=0),n===void 0&&(n=.5);var a=O(r,"image","rotateWithOffset","float32");W(a.rank===4,function(){return"Error in rotateWithOffset: image must be rank 4,"+"but got rank ".concat(a.rank,".")});var i={image:a},o={radians:e,fillValue:t,center:n},s=q.runKernel(Zk,i,o);return s}var HU=H({rotateWithOffset_:UU});function ou(r,e,t,n,a,i){n==null&&(n=.5),a==null&&(a=Number.NEGATIVE_INFINITY),i==null&&(i=0);var o=r.shape[0];return t=Math.min(t,o),W(0<=n&&n<=1,function(){return"iouThreshold must be in [0, 1], but was '".concat(n,"'")}),W(r.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '".concat(r.rank,"'")}),W(r.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was ".concat(r.shape[1])}),W(e.rank===1,function(){return"scores must be a 1D tensor"}),W(e.shape[0]===o,function(){return"scores has incompatible shape with boxes. Expected ".concat(o,", ")+"but was ".concat(e.shape[0])}),W(0<=i&&i<=1,function(){return"softNmsSigma must be in [0, 1], but was '".concat(i,"'")}),{maxOutputSize:t,iouThreshold:n,scoreThreshold:a,softNmsSigma:i}}function qU(r,e,t,n,a){n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY);var i=O(r,"boxes","nonMaxSuppression","float32"),o=O(e,"scores","nonMaxSuppression","float32"),s=ou(i,o,t,n,a);t=s.maxOutputSize,n=s.iouThreshold,a=s.scoreThreshold;var u={maxOutputSize:t,iouThreshold:n,scoreThreshold:a};return q.runKernel(Ux,{boxes:i,scores:o},u)}var KU=H({nonMaxSuppression_:qU});function jU(r,e,t){var n=XU(r,e,t),a=n<0?-(n+1):n;r.splice(a,0,e)}function XU(r,e,t){return ZU(r,e,t||YU)}function YU(r,e){return r>e?1:r<e?-1:0}function ZU(r,e,t){for(var n=0,a=r.length,i=0,o=!1;n<a;){i=n+(a-n>>>1);var s=t(e,r[i]);s>0?n=i+1:(a=i,o=!s)}return o?n:-n-1}function DS(r,e,t,n,a){return Gv(r,e,t,n,a,0)}function _S(r,e,t,n,a,i){return Gv(r,e,t,n,a,0,!1,i,!0)}function FS(r,e,t,n,a,i){return Gv(r,e,t,n,a,i,!0)}function Gv(r,e,t,n,a,i,o,s,u){o===void 0&&(o=!1),s===void 0&&(s=!1),u===void 0&&(u=!1);for(var c=[],l=0;l<e.length;l++)e[l]>a&&c.push({score:e[l],boxIndex:l,suppressBeginIndex:0});c.sort(Gw);for(var f=i>0?-.5/i:0,h=[],p=[];h.length<t&&c.length>0;){var d=c.pop(),m=d.score,v=d.boxIndex,g=d.suppressBeginIndex;if(m<a)break;for(var y=!1,w=h.length-1;w>=g;--w){var b=JU(r,v,h[w]);if(b>=n){y=!0;break}if(d.score=d.score*QU(n,f,b),d.score<=a)break}d.suppressBeginIndex=h.length,y||(d.score===m?(h.push(v),p.push(d.score)):d.score>a&&jU(c,d,Gw))}var x=h.length,S=t-x;s&&S>0&&(h.push.apply(h,pt([],ke(new Array(S).fill(0)),!1)),p.push.apply(p,pt([],ke(new Array(S).fill(0)),!1)));var T={selectedIndices:h};return o&&(T.selectedScores=p),u&&(T.validOutputs=x),T}function JU(r,e,t){var n=r.subarray(e*4,e*4+4),a=r.subarray(t*4,t*4+4),i=Math.min(n[0],n[2]),o=Math.min(n[1],n[3]),s=Math.max(n[0],n[2]),u=Math.max(n[1],n[3]),c=Math.min(a[0],a[2]),l=Math.min(a[1],a[3]),f=Math.max(a[0],a[2]),h=Math.max(a[1],a[3]),p=(s-i)*(u-o),d=(f-c)*(h-l);if(p<=0||d<=0)return 0;var m=Math.max(i,c),v=Math.max(o,l),g=Math.min(s,f),y=Math.min(u,h),w=Math.max(g-m,0)*Math.max(y-v,0);return w/(p+d-w)}function QU(r,e,t){var n=Math.exp(e*t*t);return t<=r?n:0}function Gw(r,e){return r.score-e.score||r.score===e.score&&e.boxIndex-r.boxIndex}function e6(r,e,t,n,a){return n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),$e(this,void 0,void 0,function(){var i,o,s,u,c,l,f;return We(this,function(h){switch(h.label){case 0:return i=O(r,"boxes","nonMaxSuppressionAsync"),o=O(e,"scores","nonMaxSuppressionAsync"),s=ou(i,o,t,n,a),t=s.maxOutputSize,n=s.iouThreshold,a=s.scoreThreshold,[4,Promise.all([i.data(),o.data()])];case 1:return u=h.sent(),c=u[0],l=u[1],f=DS(c,l,t,n,a).selectedIndices,i!==r&&i.dispose(),o!==e&&o.dispose(),[2,pa(f,"int32")]}})})}var t6=e6;function r6(r,e,t,n,a,i){n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=0);var o=O(r,"boxes","nonMaxSuppression"),s=O(e,"scores","nonMaxSuppression"),u=ou(o,s,t,n,a,i);t=u.maxOutputSize,n=u.iouThreshold,a=u.scoreThreshold,i=u.softNmsSigma;var c={boxes:o,scores:s},l={maxOutputSize:t,iouThreshold:n,scoreThreshold:a,softNmsSigma:i},f=q.runKernel(qx,c,l);return{selectedIndices:f[0],selectedScores:f[1]}}var n6=H({nonMaxSuppressionWithScore_:r6});function a6(r,e,t,n,a,i){return n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=0),$e(this,void 0,void 0,function(){var o,s,u,c,l,f,h,p,d;return We(this,function(m){switch(m.label){case 0:return o=O(r,"boxes","nonMaxSuppressionAsync"),s=O(e,"scores","nonMaxSuppressionAsync"),u=ou(o,s,t,n,a,i),t=u.maxOutputSize,n=u.iouThreshold,a=u.scoreThreshold,i=u.softNmsSigma,[4,Promise.all([o.data(),s.data()])];case 1:return c=m.sent(),l=c[0],f=c[1],h=FS(l,f,t,n,a,i),p=h.selectedIndices,d=h.selectedScores,o!==r&&o.dispose(),s!==e&&s.dispose(),[2,{selectedIndices:pa(p,"int32"),selectedScores:pa(d)}]}})})}var i6=a6;function o6(r,e,t,n,a,i){n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=!1);var o=O(r,"boxes","nonMaxSuppression"),s=O(e,"scores","nonMaxSuppression"),u=ou(o,s,t,n,a,null),c=u.maxOutputSize,l=u.iouThreshold,f=u.scoreThreshold,h={boxes:o,scores:s},p={maxOutputSize:c,iouThreshold:l,scoreThreshold:f,padToMaxOutputSize:i},d=q.runKernel(Hx,h,p);return{selectedIndices:d[0],validOutputs:d[1]}}var s6=H({nonMaxSuppressionPadded_:o6});function u6(r,e,t,n,a,i){return n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=!1),$e(this,void 0,void 0,function(){var o,s,u,c,l,f,h,p,d,m,v,g;return We(this,function(y){switch(y.label){case 0:return o=O(r,"boxes","nonMaxSuppressionAsync"),s=O(e,"scores","nonMaxSuppressionAsync"),u=ou(o,s,t,n,a,null),c=u.maxOutputSize,l=u.iouThreshold,f=u.scoreThreshold,[4,Promise.all([o.data(),s.data()])];case 1:return h=ke.apply(void 0,[y.sent(),2]),p=h[0],d=h[1],m=_S(p,d,c,l,f,i),v=m.selectedIndices,g=m.validOutputs,o!==r&&o.dispose(),s!==e&&s.dispose(),[2,{selectedIndices:pa(v,"int32"),validOutputs:Rt(g,"int32")}]}})})}var c6=u6;function l6(r,e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!1);var a=O(r,"images","resizeBilinear");W(a.rank===3||a.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got "+"rank ".concat(a.rank,".")}),W(e.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+"".concat(e,".")}),W(n===!1||t===!1,function(){return"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."});var i=a,o=!1;a.rank===3&&(o=!0,i=ve(a,[1,a.shape[0],a.shape[1],a.shape[2]])),ke(e,0);var s={images:i},u={alignCorners:t,halfPixelCenters:n,size:e},c=q.runKernel(ck,s,u);return o?ve(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var f6=H({resizeBilinear_:l6});function h6(r,e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!1);var a=O(r,"images","resizeNearestNeighbor");W(a.rank===3||a.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got "+"rank ".concat(a.rank,".")}),W(e.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+"".concat(e,".")}),W(a.dtype==="float32"||a.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"}),W(n===!1||t===!1,function(){return"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."});var i=a,o=!1;a.rank===3&&(o=!0,i=ve(a,[1,a.shape[0],a.shape[1],a.shape[2]])),ke(e,0);var s={images:i},u={alignCorners:t,halfPixelCenters:n,size:e},c=q.runKernel(uk,s,u);return o?ve(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var p6=H({resizeNearestNeighbor_:h6});function d6(r,e,t,n){var a;e===void 0&&(e="binary"),t===void 0&&(t=!1),n===void 0&&(n=.5);var i=O(r,"image","threshold"),o=.2989,s=.587,u=.114,c=i.shape[0]*i.shape[1],l=Pe(pa([n]),255),f,h,p,d;if(W(i.rank===3,function(){return"Error in threshold: image must be rank 3,"+"but got rank ".concat(i.rank,".")}),W(i.shape[2]===3||i.shape[2]===1,function(){return"Error in threshold: image color channel must be equal to 3 or 1"+"but got ".concat(i.shape[2],".")}),W(i.dtype==="int32"||i.dtype==="float32",function(){return"Error in dtype: image dtype must be int32 or float32,"+"but got dtype ".concat(i.dtype,".")}),W(e==="otsu"||e==="binary",function(){return"Method must be binary or otsu, but was ".concat(e)}),i.shape[2]===3){a=ke(Pc(i,[1,1,1],-1),3),f=a[0],h=a[1],p=a[2];var m=Pe(f,o),v=Pe(h,s),g=Pe(p,u);d=at(at(m,v),g)}else d=r;if(e==="otsu"){var y=z2(Wt(bS(d),"int32"),Ys([]),256);l=v6(y,c)}var w=t?Av(d,l):Yf(d,l),b=Wt(Pe(w,255),"int32");return b}function v6(r,e){for(var t=pa([-1]),n=pa([0]),a=pa([0]),i,o,s,u,c,l,f=0;f<r.size-1;f++){i=Jt(r,0,f+1),o=Jt(r,f+1),c=Lt(Bt(i),e),l=Lt(Bt(o),e);var h=Bt(Pe(i,Rc(0,i.size)));s=Lt(h,Bt(i));var p=Vc(o.shape,i.size),d=at(Rc(0,o.size),p),m=Pe(o,d);u=Lt(Bt(m),Bt(o));var v=ht(s,u),g=ht(s,u),y=Pe(c,l);a=Pe(Pe(y,v),g);var w=Yf(a,n);n=Zi(w,a,n),t=Zi(w,pa([f]),t)}return t}var m6=H({threshold_:d6});function g6(r,e,t,n,a,i){t===void 0&&(t="nearest"),n===void 0&&(n="constant"),a===void 0&&(a=0);var o=O(r,"image","transform","float32"),s=O(e,"transforms","transform","float32");W(o.rank===4,function(){return"Error in transform: image must be rank 4,"+"but got rank ".concat(o.rank,".")}),W(s.rank===2&&(s.shape[0]===o.shape[0]||s.shape[0]===1)&&s.shape[1]===8,function(){return"Error in transform: Input transform should be batch x 8 or 1 x 8"}),W(i==null||i.length===2,function(){return"Error in transform: outputShape must be [height, width] or null, "+"but got ".concat(i,".")});var u={image:o,transforms:s},c={interpolation:t,fillMode:n,fillValue:a,outputShape:i};return q.runKernel(Hk,u,c)}var y6=H({transform_:g6});function b6(r,e,t){var n=O(r,"a","bandPart");W(n.rank>=2,function(){return"bandPart(): Rank must be at least 2, got ".concat(n.rank,".")});var a=n.shape,i=ke(n.shape.slice(-2),2),o=i[0],s=i[1],u,c;typeof e=="number"?(W(e%1===0,function(){return"bandPart(): numLower must be an integer, got ".concat(e,".")}),W(e<=o,function(){return"bandPart(): numLower (".concat(e,")")+" must not be greater than the number of rows (".concat(o,").")}),u=O(e<0?o:e,"numLower","bandPart")):(W(e.dtype==="int32",function(){return"bandPart(): numLower's dtype must be an int32."}),u=Zi(iv(e,0),o,zf(e,o))),typeof t=="number"?(W(t%1===0,function(){return"bandPart(): numUpper must be an integer, got ".concat(t,".")}),W(t<=s,function(){return"bandPart(): numUpper (".concat(t,")")+" must not be greater than the number of columns (".concat(s,").")}),c=O(t<0?s:t,"numUpper","bandPart")):(W(t.dtype==="int32",function(){return"bandPart(): numUpper's dtype must be an int32."}),c=Zi(iv(t,0),s,zf(t,s)));var l=ve(Rc(0,o,1,"int32"),[-1,1]),f=Rc(0,s,1,"int32"),h=ht(l,f),p=Bf(Av(h,u),X2(h,oi(c))),d=au([o,s],n.dtype);return ve(Mc($v(ve(n,[-1,o,s])).map(function(m){return Zi(p,m,d)})),a)}var w6=H({bandPart_:b6});function x6(r){var e;if(Array.isArray(r)){e=!1,W(r!=null&&r.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var t=r[0].shape[0],n=function(u){W(r[u].shape[0]===t,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: "+"(".concat(r[u].shape[0]," vs. ").concat(t,")")})},a=1;a<r.length;++a)n(a)}else e=!0,r=Pc(r,r.shape[0],0).map(function(u){return Lv(u,[0])});W(r.length<=r[0].shape[0],function(){return"Gram-Schmidt: Number of vectors (".concat(r.length,") exceeds ")+"number of dimensions (".concat(r[0].shape[0],").")});for(var i=[],o=r,s=function(u){i.push(q.tidy(function(){var c=o[u];if(u>0)for(var l=0;l<u;++l){var f=Pe(Bt(Pe(i[l],c)),i[l]);c=ht(c,f)}return Lt(c,Xf(c,"euclidean"))}))},a=0;a<r.length;++a)s(a);return e?Mc(i,0):i}var k6=H({gramSchmidt_:x6});function S6(r,e){if(e===void 0&&(e=!1),W(r.rank>=2,function(){return"qr() requires input tensor to have a rank >= 2, but got rank ".concat(r.rank)}),r.rank===2)return Vw(r,e);var t=r.shape.slice(0,r.shape.length-2).reduce(function(u,c){return u*c}),n=$v(ve(r,[t,r.shape[r.shape.length-2],r.shape[r.shape.length-1]]),0),a=[],i=[];n.forEach(function(u){var c=ke(Vw(u,e),2),l=c[0],f=c[1];a.push(l),i.push(f)});var o=ve(Mc(a,0),r.shape),s=ve(Mc(i,0),r.shape);return[o,s]}function Vw(r,e){return e===void 0&&(e=!1),q.tidy(function(){W(r.shape.length===2,function(){return"qr2d() requires a 2D Tensor, but got a ".concat(r.shape.length,"D Tensor.")});for(var t=r.shape[0],n=r.shape[1],a=q2(t),i=Lo(r),o=xc([[1]],[1,1]),s=Lo(o),u=t>=n?n:t,c=function(f){var h,p=i,d=s,m=a;h=ke(q.tidy(function(){var v=Jt(i,[f,f],[t-f,1]),g=Xf(v),y=Jt(i,[f,f],[1,1]),w=Zi(Yf(y,0),xc([[-1]]),xc([[1]])),b=ht(y,Pe(w,g)),x=Lt(v,b);x.shape[0]===1?s=Lo(o):s=An([o,Jt(x,[1,0],[x.shape[0]-1,x.shape[1]])],0);var S=oi(Lt(Nt(w,b),g)),T=Jt(i,[f,0],[t-f,n]),N=Pe(S,s),C=Wf(s);if(f===0)i=ht(T,Nt(N,Nt(C,T)));else{var R=ht(T,Nt(N,Nt(C,T)));i=An([Jt(i,[0,0],[f,n]),R],0)}var _=Wf(N),P=Jt(a,[0,f],[t,a.shape[1]-f]);if(f===0)a=ht(P,Nt(Nt(P,s),_));else{var $=ht(P,Nt(Nt(P,s),_));a=An([Jt(a,[0,0],[t,f]),$],1)}return[s,i,a]}),3),s=h[0],i=h[1],a=h[2],dn([p,d,m])},l=0;l<u;++l)c(l);return!e&&t>n&&(a=Jt(a,[0,0],[t,n]),i=Jt(i,[0,0],[n,n])),[a,i]})}var E6=H({qr_:S6});D.Reduction=void 0;(function(r){r[r.NONE=0]="NONE",r[r.MEAN=1]="MEAN",r[r.SUM=2]="SUM",r[r.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(D.Reduction||(D.Reduction={}));function T6(r,e,t){t===void 0&&(t=D.Reduction.SUM_BY_NONZERO_WEIGHTS);var n=O(r,"losses","computeWeightedLoss"),a=null;e!=null&&(a=O(e,"weights","computeWeightedLoss"));var i=a==null?n:Pe(n,a);if(t===D.Reduction.NONE)return i;if(t===D.Reduction.SUM)return Bt(i);if(t===D.Reduction.MEAN){if(a==null)return Lf(i);var o=n.size/a.size,s=Lt(Bt(i),Bt(a));return o>1?Lt(s,Rt(o)):s}if(t===D.Reduction.SUM_BY_NONZERO_WEIGHTS){if(a==null)return Lt(Bt(i),Rt(n.size));var u=Pe(a,Bo(n.shape)),c=Wt(Bt(iS(u,Rt(0))),"float32");return Lt(Bt(i),c)}throw Error("Unknown reduction: ".concat(t))}var _i=H({computeWeightedLoss_:T6});function N6(r,e,t,n){n===void 0&&(n=D.Reduction.SUM_BY_NONZERO_WEIGHTS);var a=O(r,"labels","absoluteDifference"),i=O(e,"predictions","absoluteDifference"),o=null;t!=null&&(o=O(t,"weights","absoluteDifference")),sn(a.shape,i.shape,"Error in absoluteDifference: ");var s=Yn(ht(a,i));return _i(s,o,n)}var I6=H({absoluteDifference_:N6});function C6(r,e,t,n,a){a===void 0&&(a=D.Reduction.SUM_BY_NONZERO_WEIGHTS);var i=O(r,"labels","cosineDistance"),o=O(e,"predictions","cosineDistance"),s=null;n!=null&&(s=O(n,"weights","cosineDistance")),sn(i.shape,o.shape,"Error in cosineDistance: ");var u=Rt(1),c=ht(u,Bt(Pe(i,o),t,!0));return _i(c,s,a)}var A6=H({cosineDistance_:C6});function D6(r,e,t,n){n===void 0&&(n=D.Reduction.SUM_BY_NONZERO_WEIGHTS);var a=O(r,"labels","hingeLoss"),i=O(e,"predictions","hingeLoss"),o=null;t!=null&&(o=O(t,"weights","hingeLoss")),sn(a.shape,i.shape,"Error in hingeLoss: ");var s=Rt(1);a=ht(Pe(Rt(2),a),s);var u=Qf(ht(s,Pe(a,i)));return _i(u,o,n)}var _6=H({hingeLoss_:D6});function F6(r,e,t,n,a){n===void 0&&(n=1),a===void 0&&(a=D.Reduction.SUM_BY_NONZERO_WEIGHTS);var i=O(r,"labels","huberLoss"),o=O(e,"predictions","huberLoss"),s=null;t!=null&&(s=O(t,"weights","huberLoss")),sn(i.shape,o.shape,"Error in huberLoss: ");var u=Rt(n),c=Yn(ht(o,i)),l=zf(c,u),f=ht(c,l),h=at(Pe(Rt(.5),za(l)),Pe(u,f));return _i(h,s,a)}var R6=H({huberLoss_:F6});function O6(r,e,t,n,a){n===void 0&&(n=1e-7),a===void 0&&(a=D.Reduction.SUM_BY_NONZERO_WEIGHTS);var i=O(r,"labels","logLoss"),o=O(e,"predictions","logLoss"),s=null;t!=null&&(s=O(t,"weights","logLoss")),sn(i.shape,o.shape,"Error in logLoss: ");var u=Rt(1),c=Rt(n),l=oi(Pe(i,Fc(at(o,c)))),f=Pe(ht(u,i),Fc(at(ht(u,o),c))),h=ht(l,f);return _i(h,s,a)}var P6=H({logLoss_:O6});function M6(r,e,t,n){n===void 0&&(n=D.Reduction.SUM_BY_NONZERO_WEIGHTS);var a=O(r,"labels","meanSquaredError"),i=O(e,"predictions","meanSquaredError"),o=null;t!=null&&(o=O(t,"weights","meanSquaredError")),sn(a.shape,i.shape,"Error in meanSquaredError: ");var s=xS(a,i);return _i(s,o,n)}var B6=H({meanSquaredError_:M6});function L6(r,e){var t=O(r,"labels","sigmoidCrossEntropyWithLogits"),n=O(e,"logits","sigmoidCrossEntropyWithLogits");sn(t.shape,n.shape,"Error in sigmoidCrossEntropyWithLogits: ");var a=Qf(n),i=Pe(n,t),o=Z2(Vo(oi(Yn(n))));return at(ht(a,i),o)}function z6(r,e,t,n,a){n===void 0&&(n=0),a===void 0&&(a=D.Reduction.SUM_BY_NONZERO_WEIGHTS);var i=O(r,"multiClassLabels","sigmoidCrossEntropy"),o=O(e,"logits","sigmoidCrossEntropy"),s=null;if(t!=null&&(s=O(t,"weights","sigmoidCrossEntropy")),sn(i.shape,o.shape,"Error in sigmoidCrossEntropy: "),n>0){var u=Rt(n),c=Rt(1),l=Rt(.5);i=at(Pe(i,ht(c,u)),Pe(l,u))}var f=L6(i,o);return _i(f,s,a)}var $6=H({sigmoidCrossEntropy_:z6});function W6(r,e,t){if(t===void 0&&(t=-1),t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet "+"supported. Labels / logits was rank ".concat(e.rank," ")+"and dim was ".concat(t));var n=ui(function(a,i,o){var s=!0,u=eS(i,[t],s),c=ht(Wt(i,"float32"),u);o([a,c]);var l=oi(Pe(c,a)),f=Bt(l,[t]),h=function(p,d){var m=ke(d,2),v=m[0],g=m[1],y=Uc(p.shape,[t]);return[Pe(ve(p,y),ht(Wt(v,"float32"),Vo(g))),Pe(ve(p,y),ht(Vo(g),Wt(v,"float32")))]};return{value:f,gradFunc:h}});return n(r,e)}function G6(r,e,t,n,a){n===void 0&&(n=0),a===void 0&&(a=D.Reduction.SUM_BY_NONZERO_WEIGHTS);var i=O(r,"onehotLabels","softmaxCrossEntropy"),o=O(e,"logits","softmaxCrossEntropy"),s=null;if(t!=null&&(s=O(t,"weights","softmaxCrossEntropy")),sn(i.shape,o.shape,"Error in softmaxCrossEntropy: "),n>0){var u=Rt(n),c=Rt(1),l=Rt(i.shape[1]);i=at(Pe(i,ht(c,u)),Lt(u,l))}var f=W6(i,o);return _i(f,s,a)}var V6=H({softmaxCrossEntropy_:G6});function U6(r,e,t,n){var a=O(r,"indices","sparseFillEmptyRows","int32"),i=O(e,"values","sparseFillEmptyRows"),o=O(t,"denseShape","sparseFillEmptyRows","int32"),s=O(n,"defaultValue","sparseFillEmptyRows",i.dtype);if(a.rank!==2)throw new Error(`Indices should be Tensor2D but received shape
        `.concat(a.shape));if(i.rank!==1)throw new Error("Values should be Tensor1D but received shape ".concat(i.shape));if(o.rank!==1)throw new Error("Dense shape should be Tensor1D but received shape ".concat(o.shape));if(s.rank!==0)throw new Error("Default value should be a scalar but received shape ".concat(s.shape));var u={indices:a,values:i,denseShape:o,defaultValue:s},c=q.runKernel(Dk,u);return{outputIndices:c[0],outputValues:c[1],emptyRowIndicator:c[2],reverseIndexMap:c[3]}}var H6=H({sparseFillEmptyRows_:U6});function q6(r,e,t){var n=O(r,"inputIndices","sparseReshape","int32"),a=O(e,"inputShape","sparseReshape","int32"),i=O(t,"newShape","sparseReshape","int32");if(n.rank!==2)throw new Error(`Input indices should be Tensor2D but received shape
        `.concat(n.shape));if(a.rank!==1)throw new Error("Input shape should be Tensor1D but received shape ".concat(a.shape));if(i.rank!==1)throw new Error("New shape should be Tensor1D but received shape ".concat(i.shape));var o={inputIndices:n,inputShape:a,newShape:i},s=q.runKernel(_k,o);return{outputIndices:s[0],outputShape:s[1]}}var K6=H({sparseReshape_:q6});function j6(r,e,t){var n=O(r,"data","sparseSegmentMean"),a=O(e,"indices","sparseSegmentMean","int32"),i=O(t,"segmentIds","sparseSegmentMean","int32");if(n.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
          `.concat(a.shape));if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
          `.concat(i.shape));var o={data:n,indices:a,segmentIds:i};return q.runKernel(Fk,o)}var X6=H({sparseSegmentMean_:j6});function Y6(r,e,t){var n=O(r,"data","sparseSegmentSum"),a=O(e,"indices","sparseSegmentSum","int32"),i=O(t,"segmentIds","sparseSegmentSum","int32");if(n.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
         `.concat(a.shape));if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
         `.concat(i.shape));var o={data:n,indices:a,segmentIds:i};return q.runKernel(Rk,o)}var Z6=H({sparseSegmentSum_:Y6});function J6(r,e,t,n,a,i,o,s){var u=O(r,"data","stringNGrams","string");if(u.dtype!=="string")throw new Error("Data must be of datatype string");if(u.shape.length!==1)throw new Error("Data must be a vector, saw: ".concat(u.shape));var c=O(e,"dataSplits","stringNGrams");if(c.dtype!=="int32")throw new Error("Data splits must be of datatype int32");var l={separator:t,nGramWidths:n,leftPad:a,rightPad:i,padWidth:o,preserveShortSequences:s},f={data:u,dataSplits:c},h=q.runKernel(Lk,f,l);return{nGrams:h[0],nGramsSplits:h[1]}}var Q6=H({stringNGrams_:J6});function eH(r,e,t){t===void 0&&(t=!0);var n=O(r,"input","stringSplit","string"),a=O(e,"delimiter","stringSplit","string");if(n.rank!==1)throw new Error("Input should be Tensor1D but received shape ".concat(n.shape));if(a.rank!==0)throw new Error("Delimiter should be a scalar but received shape ".concat(a.shape));var i={skipEmpty:t},o={input:n,delimiter:a},s=q.runKernel(zk,o,i);return{indices:s[0],values:s[1],shape:s[2]}}var tH=H({stringSplit_:eH});function rH(r,e){var t=O(r,"input","stringToHashBucketFast","string"),n={numBuckets:e};if(e<=0)throw new Error("Number of buckets must be at least 1");var a={input:t};return q.runKernel($k,a,n)}var nH=H({stringToHashBucketFast_:rH});function aH(r,e,t,n){n===void 0&&(n=!0);var a=O(r,"input","staticRegexReplace","string"),i={pattern:e,rewrite:t,replaceGlobal:n};return q.runKernel(Mk,{x:a},i)}var iH=H({staticRegexReplace_:aH});var oH={fft:Mv,ifft:$f,rfft:Bv,irfft:wS},sH={hammingWindow:_U,hannWindow:CS,frame:AS,stft:PU},uH={flipLeftRight:zU,grayscaleToRGB:WU,resizeNearestNeighbor:p6,resizeBilinear:f6,rgbToGrayscale:VU,rotateWithOffset:HU,cropAndResize:BU,nonMaxSuppression:KU,nonMaxSuppressionAsync:t6,nonMaxSuppressionWithScore:n6,nonMaxSuppressionWithScoreAsync:i6,nonMaxSuppressionPadded:s6,nonMaxSuppressionPaddedAsync:c6,threshold:m6,transform:y6},cH={bandPart:w6,gramSchmidt:k6,qr:E6},lH={absoluteDifference:I6,computeWeightedLoss:_i,cosineDistance:A6,hingeLoss:_6,huberLoss:R6,logLoss:P6,meanSquaredError:B6,sigmoidCrossEntropy:$6,softmaxCrossEntropy:V6},fH={sparseFillEmptyRows:H6,sparseReshape:K6,sparseSegmentMean:X6,sparseSegmentSum:Z6},hH={stringNGrams:Q6,stringSplit:tH,stringToHashBucketFast:nH,staticRegexReplace:iH};var pH=new Map,uv=new Map,RS=(function(){function r(){}return r.prototype.getClassName=function(){return this.constructor.className},r.fromConfig=function(e,t){return new e(t)},r})(),OS=(function(){function r(){this.classNameMap={}}return r.getMap=function(){return r.instance==null&&(r.instance=new r),r.instance},r.register=function(e){r.getMap().classNameMap[e.className]=[e,e.fromConfig]},r})();function PS(r,e,t){W(r.className!=null,function(){return"Class being registered does not have the static className property defined."}),W(typeof r.className=="string",function(){return"className is required to be a string, but got type "+typeof r.className}),W(r.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),typeof e>"u"&&(e="Custom"),typeof t>"u"&&(t=r.className);var n=t,a=e+">"+n;return OS.register(r),pH.set(a,r),uv.set(r,a),r}function dH(r){return uv.has(r)?uv.get(r):r.className}var vH={__proto__:null,Serializable:RS,SerializationMap:OS,getRegisteredName:dH,registerClass:PS},ao=(function(r){Ii(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.minimize=function(t,n,a){n===void 0&&(n=!1);var i=this.computeGradients(t,a),o=i.value,s=i.grads;if(a!=null){var u=a.map(function(c){return{name:c.name,tensor:s[c.name]}});this.applyGradients(u)}else this.applyGradients(s);return dn(s),n?o:(o.dispose(),null)},Object.defineProperty(e.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!1,configurable:!0}),e.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},e.prototype.computeGradients=function(t,n){return J2(t,n)},e.prototype.dispose=function(){this.iterations_!=null&&dn(this.iterations_)},e.prototype.saveIterations=function(){return $e(this,void 0,void 0,function(){return We(this,function(t){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:Rt(this.iterations_,"int32")}]})})},e.prototype.getWeights=function(){return $e(this,void 0,void 0,function(){return We(this,function(t){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},e.prototype.setWeights=function(t){return $e(this,void 0,void 0,function(){return We(this,function(n){throw new Error("setWeights() is not implemented for this optimizer class "+"".concat(this.getClassName()))})})},e.prototype.extractIterations=function(t){return $e(this,void 0,void 0,function(){var n;return We(this,function(a){switch(a.label){case 0:return n=this,[4,t[0].tensor.data()];case 1:return n.iterations_=a.sent()[0],[2,t.slice(1)]}})})},e})(RS);Object.defineProperty(ao,Symbol.hasInstance,{value:function(r){return r.minimize!=null&&r.computeGradients!=null&&r.applyGradients!=null}});var Vv=(function(r){Ii(e,r);function e(t,n,a){a===void 0&&(a=null);var i=r.call(this)||this;return i.learningRate=t,i.rho=n,i.epsilon=a,i.accumulatedGrads=[],i.accumulatedUpdates=[],a==null&&(i.epsilon=q.backend.epsilon()),i}return Object.defineProperty(e,"className",{get:function(){return"Adadelta"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=q.registeredVariables[i],u=!1;n.accumulatedGrads[o]==null&&(n.accumulatedGrads[o]={originalName:"".concat(i,"/accum_grad"),variable:Er(function(){return Zn(s).variable(u)})}),n.accumulatedUpdates[o]==null&&(n.accumulatedUpdates[o]={originalName:"".concat(i,"/accum_var"),variable:Er(function(){return Zn(s).variable(u)})});var c=Array.isArray(t)?t[o].tensor:t[i];if(c!=null){var l=n.accumulatedGrads[o].variable,f=n.accumulatedUpdates[o].variable;Er(function(){var h=at(Pe(l,n.rho),Pe(za(c),1-n.rho)),p=Pe(Lt(Ni(at(f,n.epsilon)),Ni(at(l,n.epsilon))),c),d=at(Pe(f,n.rho),Pe(za(p),1-n.rho));l.assign(h),f.assign(d);var m=at(Pe(p,-n.learningRate),s);s.assign(m)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedUpdates!=null&&(dn(this.accumulatedGrads.map(function(t){return t.variable})),dn(this.accumulatedUpdates.map(function(t){return t.variable})))},e.prototype.getWeights=function(){return $e(this,void 0,void 0,function(){var t;return We(this,function(n){switch(n.label){case 0:return t=pt(pt([],ke(this.accumulatedGrads),!1),ke(this.accumulatedUpdates),!1),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(t.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},e.prototype.setWeights=function(t){return $e(this,void 0,void 0,function(){var n,a;return We(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),n=t.length/2,a=!1,this.accumulatedGrads=t.slice(0,n).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),this.accumulatedUpdates=t.slice(n,n*2).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(t,n){return new t(n.learningRate,n.rho,n.epsilon)},e})(ao),Uv=(function(r){Ii(e,r);function e(t,n){n===void 0&&(n=.1);var a=r.call(this)||this;return a.learningRate=t,a.initialAccumulatorValue=n,a.accumulatedGrads=[],a}return Object.defineProperty(e,"className",{get:function(){return"Adagrad"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=q.registeredVariables[i];if(n.accumulatedGrads[o]==null){var u=!1;n.accumulatedGrads[o]={originalName:"".concat(i,"/accumulator"),variable:Er(function(){return Vc(s.shape,n.initialAccumulatorValue).variable(u)})}}var c=Array.isArray(t)?t[o].tensor:t[i];if(c!=null){var l=n.accumulatedGrads[o].variable;Er(function(){var f=at(l,za(c));l.assign(f);var h=at(Pe(Lt(c,Ni(at(f,q.backend.epsilon()))),-n.learningRate),s);s.assign(h)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedGrads!=null&&dn(this.accumulatedGrads.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return $e(this,void 0,void 0,function(){return We(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulatedGrads.map(function(n){return{name:n.originalName,tensor:n.variable}}))]}})})},e.prototype.setWeights=function(t){return $e(this,void 0,void 0,function(){var n;return We(this,function(a){switch(a.label){case 0:return[4,this.extractIterations(t)];case 1:return t=a.sent(),n=!1,this.accumulatedGrads=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(n)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(t,n){return new t(n.learningRate,n.initialAccumulatorValue)},e})(ao),Hv=(function(r){Ii(e,r);function e(t,n,a,i){i===void 0&&(i=null);var o=r.call(this)||this;return o.learningRate=t,o.beta1=n,o.beta2=a,o.epsilon=i,o.accumulatedFirstMoment=[],o.accumulatedSecondMoment=[],Er(function(){o.accBeta1=Rt(n).variable(),o.accBeta2=Rt(a).variable()}),i==null&&(o.epsilon=q.backend.epsilon()),o}return Object.defineProperty(e,"className",{get:function(){return"Adam"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);Er(function(){var i=ht(1,n.accBeta1),o=ht(1,n.accBeta2);a.forEach(function(s,u){var c=q.registeredVariables[s],l=!1;n.accumulatedFirstMoment[u]==null&&(n.accumulatedFirstMoment[u]={originalName:"".concat(s,"/m"),variable:Er(function(){return Zn(c).variable(l)})}),n.accumulatedSecondMoment[u]==null&&(n.accumulatedSecondMoment[u]={originalName:"".concat(s,"/v"),variable:Er(function(){return Zn(c).variable(l)})});var f=Array.isArray(t)?t[u].tensor:t[s];if(f!=null){var h=n.accumulatedFirstMoment[u].variable,p=n.accumulatedSecondMoment[u].variable,d=at(Pe(h,n.beta1),Pe(f,1-n.beta1)),m=at(Pe(p,n.beta2),Pe(za(f),1-n.beta2)),v=Lt(d,i),g=Lt(m,o);h.assign(d),p.assign(m);var y=at(Pe(Lt(v,at(Ni(g),n.epsilon)),-n.learningRate),c);c.assign(y)}}),n.accBeta1.assign(Pe(n.accBeta1,n.beta1)),n.accBeta2.assign(Pe(n.accBeta2,n.beta2))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&dn(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedSecondMoment!=null&&dn(this.accumulatedSecondMoment.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return $e(this,void 0,void 0,function(){var t;return We(this,function(n){switch(n.label){case 0:return t=pt(pt([],ke(this.accumulatedFirstMoment),!1),ke(this.accumulatedSecondMoment),!1),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(t.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},e.prototype.setWeights=function(t){return $e(this,void 0,void 0,function(){var n,a,i=this;return We(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(t)];case 1:return t=o.sent(),Er(function(){i.accBeta1.assign(_c(i.beta1,i.iterations_+1)),i.accBeta2.assign(_c(i.beta2,i.iterations_+1))}),n=t.length/2,a=!1,this.accumulatedFirstMoment=t.slice(0,n).map(function(s){return{originalName:s.name,variable:s.tensor.variable(a)}}),this.accumulatedSecondMoment=t.slice(n,n*2).map(function(s){return{originalName:s.name,variable:s.tensor.variable(a)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(t,n){return new t(n.learningRate,n.beta1,n.beta2,n.epsilon)},e})(ao),qv=(function(r){Ii(e,r);function e(t,n,a,i,o){i===void 0&&(i=null),o===void 0&&(o=0);var s=r.call(this)||this;return s.learningRate=t,s.beta1=n,s.beta2=a,s.epsilon=i,s.decay=o,s.accumulatedFirstMoment=[],s.accumulatedWeightedInfNorm=[],Er(function(){s.iteration=Rt(0).variable(),s.accBeta1=Rt(n).variable()}),i==null&&(s.epsilon=q.backend.epsilon()),s}return Object.defineProperty(e,"className",{get:function(){return"Adamax"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);Er(function(){var i=ht(1,n.accBeta1),o=Lt(-n.learningRate,at(Pe(n.iteration,n.decay),1));a.forEach(function(s,u){var c=q.registeredVariables[s],l=!1;n.accumulatedFirstMoment[u]==null&&(n.accumulatedFirstMoment[u]={originalName:"".concat(s,"/m"),variable:Zn(c).variable(l)}),n.accumulatedWeightedInfNorm[u]==null&&(n.accumulatedWeightedInfNorm[u]={originalName:"".concat(s,"/v"),variable:Zn(c).variable(l)});var f=Array.isArray(t)?t[u].tensor:t[s];if(f!=null){var h=n.accumulatedFirstMoment[u].variable,p=n.accumulatedWeightedInfNorm[u].variable,d=at(Pe(h,n.beta1),Pe(f,1-n.beta1)),m=Pe(p,n.beta2),v=Yn(f),g=aS(m,v);h.assign(d),p.assign(g);var y=at(Pe(Lt(o,i),Lt(d,at(g,n.epsilon))),c);c.assign(y)}}),n.iteration.assign(at(n.iteration,1)),n.accBeta1.assign(Pe(n.accBeta1,n.beta1))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&dn(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedWeightedInfNorm!=null&&dn(this.accumulatedWeightedInfNorm.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return $e(this,void 0,void 0,function(){return We(this,function(t){throw new Error("getWeights() is not implemented for Adamax yet.")})})},e.prototype.setWeights=function(t){return $e(this,void 0,void 0,function(){return We(this,function(n){throw new Error("setWeights() is not implemented for Adamax yet.")})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(t,n){return new t(n.learningRate,n.beta1,n.beta2,n.epsilon,n.decay)},e})(ao),ih=(function(r){Ii(e,r);function e(t){var n=r.call(this)||this;return n.learningRate=t,n.setLearningRate(t),n}return Object.defineProperty(e,"className",{get:function(){return"SGD"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=Array.isArray(t)?t[o].tensor:t[i];if(s!=null){var u=q.registeredVariables[i];Er(function(){var c=at(Pe(n.c,s),u);u.assign(c)})}}),this.incrementIterations()},e.prototype.setLearningRate=function(t){this.learningRate=t,this.c!=null&&this.c.dispose(),this.c=y2(Rt(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getWeights=function(){return $e(this,void 0,void 0,function(){return We(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()]]}})})},e.prototype.setWeights=function(t){return $e(this,void 0,void 0,function(){return We(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(t)];case 1:if(t=n.sent(),t.length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(t,n){return new t(n.learningRate)},e})(ao),Kv=(function(r){Ii(e,r);function e(t,n,a){a===void 0&&(a=!1);var i=r.call(this,t)||this;return i.learningRate=t,i.momentum=n,i.useNesterov=a,i.accumulations=[],i.m=Rt(i.momentum),i}return Object.defineProperty(e,"className",{get:function(){return"Momentum"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=q.registeredVariables[i];if(n.accumulations[o]==null){var u=!1;n.accumulations[o]={originalName:"".concat(i,"/momentum"),variable:Er(function(){return Zn(s).variable(u)})}}var c=n.accumulations[o].variable,l=Array.isArray(t)?t[o].tensor:t[i];l!=null&&Er(function(){var f,h=at(Pe(n.m,c),l);n.useNesterov?f=at(Pe(n.c,at(l,Pe(h,n.m))),s):f=at(Pe(n.c,h),s),c.assign(h),s.assign(f)})}),this.incrementIterations()},e.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&dn(this.accumulations.map(function(t){return t.variable}))},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getWeights=function(){return $e(this,void 0,void 0,function(){return We(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulations.map(function(n){return{name:n.originalName,tensor:n.variable}}))]}})})},e.prototype.setWeights=function(t){return $e(this,void 0,void 0,function(){var n;return We(this,function(a){switch(a.label){case 0:return[4,this.extractIterations(t)];case 1:return t=a.sent(),n=!1,this.accumulations=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(n)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(t,n){return new t(n.learningRate,n.momentum,n.useNesterov)},e})(ih),jv=(function(r){Ii(e,r);function e(t,n,a,i,o){n===void 0&&(n=.9),a===void 0&&(a=0),i===void 0&&(i=null),o===void 0&&(o=!1);var s=r.call(this)||this;if(s.learningRate=t,s.decay=n,s.momentum=a,s.epsilon=i,s.accumulatedMeanSquares=[],s.accumulatedMoments=[],s.accumulatedMeanGrads=[],s.centered=o,i==null&&(s.epsilon=q.backend.epsilon()),t==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return s}return Object.defineProperty(e,"className",{get:function(){return"RMSProp"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=q.registeredVariables[i],u=!1;n.accumulatedMeanSquares[o]==null&&(n.accumulatedMeanSquares[o]={originalName:"".concat(i,"/rms"),variable:Er(function(){return Zn(s).variable(u)})}),n.accumulatedMoments[o]==null&&(n.accumulatedMoments[o]={originalName:"".concat(i,"/momentum"),variable:Er(function(){return Zn(s).variable(u)})}),n.accumulatedMeanGrads[o]==null&&n.centered&&(n.accumulatedMeanGrads[o]={originalName:"".concat(i,"/mg"),variable:Er(function(){return Zn(s).variable(u)})});var c=Array.isArray(t)?t[o].tensor:t[i];if(c!=null){var l=n.accumulatedMeanSquares[o].variable,f=n.accumulatedMoments[o].variable;Er(function(){var h=at(Pe(l,n.decay),Pe(za(c),1-n.decay));if(n.centered){var p=n.accumulatedMeanGrads[o].variable,d=at(Pe(p,n.decay),Pe(c,1-n.decay)),m=Lt(Pe(c,n.learningRate),Ni(ht(h,at(za(d),n.epsilon)))),v=at(Pe(f,n.momentum),m);l.assign(h),p.assign(d),f.assign(v);var g=ht(s,v);s.assign(g)}else{var y=at(Pe(l,n.decay),Pe(za(c),1-n.decay)),v=at(Pe(f,n.momentum),Lt(Pe(c,n.learningRate),Ni(at(y,n.epsilon))));l.assign(y),f.assign(v);var g=ht(s,v);s.assign(g)}})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&dn(this.accumulatedMeanSquares.map(function(t){return t.variable})),this.accumulatedMeanGrads!=null&&this.centered&&dn(this.accumulatedMeanGrads.map(function(t){return t.variable})),this.accumulatedMoments!=null&&dn(this.accumulatedMoments.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return $e(this,void 0,void 0,function(){var t;return We(this,function(n){switch(n.label){case 0:return t=pt(pt([],ke(this.accumulatedMeanSquares),!1),ke(this.accumulatedMoments),!1),this.centered&&t.push.apply(t,pt([],ke(this.accumulatedMeanGrads),!1)),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(t.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},e.prototype.setWeights=function(t){return $e(this,void 0,void 0,function(){var n,a;return We(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),n=this.centered?t.length/3:t.length/2,a=!1,this.accumulatedMeanSquares=t.slice(0,n).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),this.accumulatedMoments=t.slice(n,n*2).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),this.centered&&(this.accumulatedMeanGrads=t.slice(n*2,n*3).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}})),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(t,n){return new t(n.learningRate,n.decay,n.momentum,n.epsilon,n.centered)},e})(ao),mH=[Vv,Uv,Hv,qv,Kv,jv,ih];function gH(){var r,e;try{for(var t=Ur(mH),n=t.next();!n.done;n=t.next()){var a=n.value;PS(a)}}catch(i){r={error:i}}finally{try{n&&!n.done&&(e=t.return)&&e.call(t)}finally{if(r)throw r.error}}}var yH="model",bH=".json",wH=".weights.bin";function Uw(r){return new Promise(function(e){return setTimeout(e)}).then(r)}var Gf=(function(){function r(e){if(!st().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(r.URL_SCHEME)&&(e=e.slice(r.URL_SCHEME.length)),(e==null||e.length===0)&&(e=yH),this.modelJsonFileName=e+bH,this.weightDataFileName=e+wH}return r.prototype.save=function(e){return $e(this,void 0,void 0,function(){var t,n,a,i,o,s,u;return We(this,function(c){switch(c.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=Ai.join(e.weightData),n=window.URL.createObjectURL(new Blob([t],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return a=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],i=S2(e,a),o=window.URL.createObjectURL(new Blob([JSON.stringify(i)],{type:"application/json"})),s=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor,s.download=this.modelJsonFileName,s.href=o,[4,Uw(function(){return s.dispatchEvent(new MouseEvent("click"))})];case 2:return c.sent(),e.weightData==null?[3,4]:(u=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor,u.download=this.weightDataFileName,u.href=n,[4,Uw(function(){return u.dispatchEvent(new MouseEvent("click"))})]);case 3:c.sent(),c.label=4;case 4:return[2,{modelArtifactsInfo:Wc(e)}]}})})},r})();Gf.URL_SCHEME="downloads://";var xH=(function(){function r(e){if(e==null||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, "+"but received ".concat(e));this.jsonFile=e[0],this.weightsFiles=e.slice(1)}return r.prototype.load=function(){return $e(this,void 0,void 0,function(){var e=this;return We(this,function(t){return[2,new Promise(function(n,a){var i=new FileReader;i.onload=function(o){var s=JSON.parse(o.target.result),u=s.modelTopology;if(u==null){a(new Error("modelTopology field is missing from file ".concat(e.jsonFile.name)));return}var c=s.weightsManifest;if(c==null){a(new Error("weightManifest field is missing from file ".concat(e.jsonFile.name)));return}if(e.weightsFiles.length===0){n({modelTopology:u});return}var l=Ev(s,function(f){return e.loadWeights(f)});n(l)},i.onerror=function(o){return a("Failed to read model topology and weights manifest JSON "+"from file '".concat(e.jsonFile.name,"'. BrowserFiles supports loading ")+"Keras-style tf.Model artifacts only.")},i.readAsText(e.jsonFile)})]})})},r.prototype.loadWeights=function(e){var t,n,a=this,i=[],o=[];try{for(var s=Ur(e),u=s.next();!u.done;u=s.next()){var c=u.value;i.push.apply(i,pt([],ke(c.weights),!1)),o.push.apply(o,pt([],ke(c.paths),!1))}}catch(h){t={error:h}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}var l=this.checkManifestAndWeightFiles(e),f=o.map(function(h){return a.loadWeightsFile(h,l[h])});return Promise.all(f).then(function(h){return[i,h]})},r.prototype.loadWeightsFile=function(e,t){return new Promise(function(n,a){var i=new FileReader;i.onload=function(o){var s=o.target.result;n(s)},i.onerror=function(o){return a("Failed to weights data from file of path '".concat(e,"'."))},i.readAsArrayBuffer(t)})},r.prototype.checkManifestAndWeightFiles=function(e){var t,n,a=this,i=[],o=this.weightsFiles.map(function(f){return Ww(f.name)}),s={};try{for(var u=Ur(e),c=u.next();!c.done;c=u.next()){var l=c.value;l.paths.forEach(function(f){var h=Ww(f);if(i.indexOf(h)!==-1)throw new Error("Duplicate file basename found in weights manifest: "+"'".concat(h,"'"));if(i.push(h),o.indexOf(h)===-1)throw new Error("Weight file with basename '".concat(h,"' is not provided."));s[f]=a.weightsFiles[o.indexOf(h)]})}}catch(f){t={error:f}}finally{try{c&&!c.done&&(n=u.return)&&n.call(u)}finally{if(t)throw t.error}}if(i.length!==this.weightsFiles.length)throw new Error("Mismatch in the number of files in weights manifest "+"(".concat(i.length,") and the number of weight files provided ")+"(".concat(this.weightsFiles.length,")."));return s},r})(),kH=function(r){return st().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(Gf.URL_SCHEME)?SH(r.slice(Gf.URL_SCHEME.length)):null};Jn.registerSaveRouter(kH);function SH(r){return r===void 0&&(r="model"),new Gf(r)}function EH(r){return new xH(r)}function Hw(r,e,t,n){o(r),t=t??0,n=n??1,s(t,n);var a=0,i=function(u){return u.then(function(c){var l=t+ ++a/r.length*(n-t);return e(l),c}),u};function o(u){W(u!=null&&Array.isArray(u)&&u.length>0,function(){return"promises must be a none empty array"})}function s(u,c){W(u>=0&&u<=1,function(){return"Progress fraction must be in range [0, 1], but "+"got startFraction ".concat(u)}),W(c>=0&&c<=1,function(){return"Progress fraction must be in range [0, 1], but "+"got endFraction ".concat(c)}),W(c>=u,function(){return"startFraction must be no more than endFraction, but "+"got startFraction ".concat(u," and endFraction ")+"".concat(c)})}return Promise.all(r.map(i))}function MS(r,e){return $e(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l,f,h;return We(this,function(p){switch(p.label){case 0:return e==null&&(e={}),t=e.fetchFunc==null?st().platform.fetch:e.fetchFunc,n=r.map(function(d){return t(d,e.requestInit,{isBinary:!0})}),a=0,i=.5,e.onProgress!=null?[3,2]:[4,Promise.all(n)];case 1:return s=p.sent(),[3,4];case 2:return[4,Hw(n,e.onProgress,a,i)];case 3:s=p.sent(),p.label=4;case 4:return o=s,u=o.map(function(d){return d.arrayBuffer()}),c=.5,l=1,e.onProgress!=null?[3,6]:[4,Promise.all(u)];case 5:return h=p.sent(),[3,8];case 6:return[4,Hw(u,e.onProgress,c,l)];case 7:h=p.sent(),p.label=8;case 8:return f=h,[2,f]}})})}function TH(r,e){var t=this,n,a=e.fetchFunc==null?st().platform.fetch:e.fetchFunc,i=0,o;return(n=e.onProgress)===null||n===void 0||n.call(e,0),new ReadableStream({pull:function(s){return $e(t,void 0,void 0,function(){var u,c,l,f,h;return We(this,function(p){switch(p.label){case 0:return i<r.length?o?[3,2]:[4,a(r[i],e.requestInit,{isBinary:!0})]:[3,4];case 1:c=p.sent().body,o=c.getReader(),p.label=2;case 2:return[4,o.read()];case 3:return l=p.sent(),f=l.done,h=l.value,f?(i++,o=void 0,(u=e.onProgress)===null||u===void 0||u.call(e,i/r.length),[3,0]):(s.enqueue(h),[2]);case 4:return s.close(),[2]}})})}})}function NH(r,e,t,n){return e===void 0&&(e=""),$e(this,void 0,void 0,function(){var a,i;return We(this,function(o){return a=function(s){return MS(s,{requestInit:n})},i=BS(a),[2,i(r,e,t)]})})}function BS(r){var e=this;return function(t,n,a){return n===void 0&&(n=""),$e(e,void 0,void 0,function(){var i,o,s,u,c,l,f,h,p,d;return We(this,function(m){switch(m.label){case 0:if(i=t.map(function(){return!1}),o={},s=a!=null?a.map(function(){return!1}):[],u=[],t.forEach(function(v,g){var y=0;v.weights.forEach(function(w){var b="quantization"in w?w.quantization.dtype:w.dtype,x=zo[b]*Dt(w.shape),S=function(){i[g]=!0,o[g]==null&&(o[g]=[]),o[g].push({manifestEntry:w,groupOffset:y,sizeBytes:x})};a!=null?a.forEach(function(T,N){T===w.name&&(S(),s[N]=!0)}):S(),u.push(w.name),y+=x})}),!s.every(function(v){return v}))throw c=a.filter(function(v,g){return!s[g]}),new Error("Could not find weights in manifest with names: "+"".concat(c.join(", "),`. 
`)+"Manifest JSON has weights with names: "+"".concat(u.join(", "),"."));return l=i.reduce(function(v,g,y){return g&&v.push(y),v},[]),f=[],l.forEach(function(v){t[v].paths.forEach(function(g){var y=n+(n.endsWith("/")?"":"/")+g;f.push(y)})}),[4,r(f)];case 1:return h=m.sent(),p={},d=0,l.forEach(function(v){var g=t[v].paths.length,y=new Ai(h.slice(d,d+g)),w=o[v];w.forEach(function(b){var x=y.slice(b.groupOffset,b.groupOffset+b.sizeBytes),S=x2(x,[b.manifestEntry]);for(var T in S)p[T]=S[T]}),d+=g}),[2,p]}})})}}var IH="application/octet-stream",CH="application/json",Xv=(function(){function r(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.weightUrlConverter=t.weightUrlConverter,t.fetchFunc!=null?(W(typeof t.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=t.fetchFunc):this.fetch=st().platform.fetch,W(e!=null&&e.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(e)&&W(e.length===2,function(){return"URL paths for http must have a length of 2, "+"(actual length is ".concat(e.length,").")}),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{},this.loadOptions=t}return r.prototype.save=function(e){return $e(this,void 0,void 0,function(){var t,n,a,i,o;return We(this,function(s){switch(s.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit),t.body=new FormData,n=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],a=S2(e,n),t.body.append("model.json",new Blob([JSON.stringify(a)],{type:CH}),"model.json"),e.weightData!=null&&(i=Ai.join(e.weightData),t.body.append("model.weights.bin",new Blob([i],{type:IH}),"model.weights.bin")),[4,this.fetch(this.path,t)];case 1:if(o=s.sent(),o.ok)return[2,{modelArtifactsInfo:Wc(e),responses:[o]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+"".concat(o.status,"."))}})})},r.prototype.loadModelJSON=function(){return $e(this,void 0,void 0,function(){var e,t,n,a,i;return We(this,function(o){switch(o.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(e=o.sent(),!e.ok)throw new Error("Request to ".concat(this.path," failed with status code ")+"".concat(e.status,". Please verify this URL points to ")+"the model JSON of the model to load.");o.label=2;case 2:return o.trys.push([2,4,,5]),[4,e.json()];case 3:return t=o.sent(),[3,5];case 4:throw o.sent(),n="Failed to parse model JSON of response from ".concat(this.path,"."),this.path.endsWith(".pb")?n+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":n+=" Please make sure the server is serving valid JSON for this request.",new Error(n);case 5:if(a=t.modelTopology,i=t.weightsManifest,a==null&&i==null)throw new Error("The JSON from HTTP path ".concat(this.path," contains neither model ")+"topology or manifest for weights.");return[2,t]}})})},r.prototype.load=function(){return $e(this,void 0,void 0,function(){var e,t=this;return We(this,function(n){switch(n.label){case 0:return this.loadOptions.streamWeights?[2,this.loadStream()]:[4,this.loadModelJSON()];case 1:return e=n.sent(),[2,Ev(e,function(a){return t.loadWeights(a)})]}})})},r.prototype.loadStream=function(){return $e(this,void 0,void 0,function(){var e,t,n,a,i=this;return We(this,function(o){switch(o.label){case 0:return[4,this.loadModelJSON()];case 1:return e=o.sent(),[4,this.getWeightUrls(e.weightsManifest)];case 2:return t=o.sent(),n=Jd(e.weightsManifest),a=function(){return TH(t,i.loadOptions)},[2,Object.assign(Object.assign({},e),{weightSpecs:n,getWeightStream:a})]}})})},r.prototype.getWeightUrls=function(e){return $e(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l,f,h,p,d,m,v,g,y,w,b,x,S;return We(this,function(T){switch(T.label){case 0:t=Array.isArray(this.path)?this.path[1]:this.path,n=ke(AH(t),2),a=n[0],i=n[1],o=this.weightPathPrefix||a,s=[],u=[];try{for(c=Ur(e),l=c.next();!l.done;l=c.next()){f=l.value;try{for(h=(x=void 0,Ur(f.paths)),p=h.next();!p.done;p=h.next())d=p.value,this.weightUrlConverter!=null?u.push(this.weightUrlConverter(d)):s.push(o+d+i)}catch(N){x={error:N}}finally{try{p&&!p.done&&(S=h.return)&&S.call(h)}finally{if(x)throw x.error}}}}catch(N){w={error:N}}finally{try{l&&!l.done&&(b=c.return)&&b.call(c)}finally{if(w)throw w.error}}return this.weightUrlConverter?(v=(m=s.push).apply,g=[s],y=[[]],[4,Promise.all(u)]):[3,2];case 1:v.apply(m,g.concat([pt.apply(void 0,y.concat([ke.apply(void 0,[T.sent()]),!1]))])),T.label=2;case 2:return[2,s]}})})},r.prototype.loadWeights=function(e){return $e(this,void 0,void 0,function(){var t,n,a;return We(this,function(i){switch(i.label){case 0:return[4,this.getWeightUrls(e)];case 1:return t=i.sent(),n=Jd(e),[4,MS(t,this.loadOptions)];case 2:return a=i.sent(),[2,[n,a]]}})})},r})();Xv.URL_SCHEME_REGEX=/^https?:\/\//;function AH(r){var e=r.lastIndexOf("/"),t=r.lastIndexOf("?"),n=r.substring(0,e),a=t>e?r.substring(t):"";return[n+"/",a]}function cv(r){return r.match(Xv.URL_SCHEME_REGEX)!=null}var LS=function(r,e){if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;var t=!0;return Array.isArray(r)?t=r.every(function(n){return cv(n)}):t=cv(r),t?Yv(r,e):null};Jn.registerSaveRouter(LS);Jn.registerLoadRouter(LS);function Yv(r,e){return new Xv(r,e)}function DH(r,e){return Yv(r,e)}var Bd=(function(){function r(e){this.modelArtifacts=e}return r.prototype.load=function(){return this.modelArtifacts},r})(),zS=(function(){function r(e){this.saveHandler=e}return r.prototype.save=function(e){return this.saveHandler(e)},r})(),_H=(function(){function r(e){e.load&&(this.load=function(){return Promise.resolve(e.load())}),e.save&&(this.save=function(t){return Promise.resolve(e.save(t))})}return r})();function FH(r,e,t,n){var a=arguments;return new _H($S.apply(void 0,pt([],ke(a),!1)))}function $S(r,e,t,n){if(arguments.length===1){var a=r.modelTopology!=null||r.weightSpecs!=null;return a?new Bd(r):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Bd({modelTopology:r}))}else return console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Bd({modelTopology:r,weightSpecs:e,weightData:t,trainingConfig:n})}function RH(r){return new zS(r)}function OH(r){return new zS(r)}var PH={__proto__:null,CompositeArrayBuffer:Ai,browserFiles:EH,browserHTTPRequest:DH,concatenateArrayBuffers:xL,copyModel:VL,decodeWeights:x2,decodeWeightsStream:gL,encodeWeights:dL,fromMemory:FH,fromMemorySync:$S,getLoadHandlers:AL,getModelArtifactsForJSON:Ev,getModelArtifactsForJSONSync:E2,getModelArtifactsInfoForJSON:Wc,getSaveHandlers:CL,getWeightSpecs:Jd,http:Yv,isHTTPScheme:cv,listModels:WL,loadWeights:NH,moveModel:UL,registerLoadRouter:IL,registerSaveRouter:NL,removeModel:GL,weightsLoaderFactory:BS,withSaveHandler:RH,withSaveHandlerSync:OH};function MH(r,e,t){var n=O(r,"labels","confusionMatrix"),a=O(e,"predictions","confusionMatrix");W(t==null||t>0&&Number.isInteger(t),function(){return"If provided, numClasses must be a positive integer, "+"but got ".concat(t)}),W(n.rank===1,function(){return"Expected the rank of labels to be 1, but got ".concat(n.rank)}),W(a.rank===1,function(){return"Expected the rank of predictions to be 1, "+"but got ".concat(a.rank)}),W(n.shape[0]===a.shape[0],function(){return"Mismatch in the number of examples: "+"".concat(n.shape[0]," vs. ").concat(a.shape[0],". ")+"Labels and predictions should have the same number of elements."}),W(t>0&&Number.isInteger(t),function(){return"numClasses is required to be a positive integer, but got "+"".concat(t)});var i=ov(Wt(n,"int32"),t),o=ov(Wt(a,"int32"),t),s=Wf(i),u=Nt(s,o);return Wt(u,"int32")}var BH=H({confusionMatrix_:MH});var LH={__proto__:null,confusionMatrix:BH},Fo,qw=!1;function WS(r,e){if(e===void 0&&(e=3),e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(r==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var t=!1,n=!1,a=!1,i=!1,o=!1,s=!1;if(r.data instanceof Uint8Array)t=!0;else if(typeof ImageData<"u"&&r instanceof ImageData)n=!0;else if(typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement)a=!0;else if(typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement)i=!0;else if(r.getContext!=null)o=!0;else if(typeof ImageBitmap<"u"&&r instanceof ImageBitmap)s=!0;else throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, "+"but was ".concat(r.constructor.name));var u=Ec($d,q.backendName);if(u!=null){var c={pixels:r},l={numChannels:e};return q.runKernel($d,c,l)}var f=ke(a?[r.videoWidth,r.videoHeight]:[r.width,r.height],2),h=f[0],p=f[1],d;if(o)d=r.getContext("2d").getImageData(0,0,h,p).data;else if(n||t)d=r.data;else if(i||a||s){if(Fo==null)if(typeof document>"u")if(typeof OffscreenCanvas<"u"&&typeof OffscreenCanvasRenderingContext2D<"u")Fo=new OffscreenCanvas(1,1).getContext("2d");else throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");else Fo=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});Fo.canvas.width=h,Fo.canvas.height=p,Fo.drawImage(r,0,0,h,p),d=Fo.getImageData(0,0,h,p).data}var m;if(e===4)m=new Int32Array(d);else{var v=h*p;m=new Int32Array(v*e);for(var g=0;g<v;g++)for(var y=0;y<e;++y)m[g*e+y]=d[g*4+y]}var w=[p,h,e];return SS(m,w,"int32")}function zH(r){return r!=null&&r.data instanceof Uint8Array}function $H(){return typeof window<"u"&&typeof ImageBitmap<"u"&&window.hasOwnProperty("createImageBitmap")}function WH(r){return r!=null&&r.width!==0&&r.height!==0}function GH(r){return $H()&&!(r instanceof ImageBitmap)&&WH(r)&&!zH(r)}function VH(r,e){return e===void 0&&(e=3),$e(this,void 0,void 0,function(){var t,n;return We(this,function(a){switch(a.label){case 0:if(t=null,!(st().getBool("WRAP_TO_IMAGEBITMAP")&&GH(r)))return[3,5];n=void 0,a.label=1;case 1:return a.trys.push([1,3,,4]),[4,createImageBitmap(r,{premultiplyAlpha:"none"})];case 2:return n=a.sent(),[3,4];case 3:return a.sent(),n=null,[3,4];case 4:return n!=null&&n.width===r.width&&n.height===r.height?t=n:t=r,[3,6];case 5:t=r,a.label=6;case 6:return[2,WS(t,e)]}})})}function GS(r){if(r.rank!==2&&r.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank ".concat(r.rank,"."));var e=r.rank===2?1:r.shape[2];if(e>4||e===2)throw new Error("toPixels only supports depth of size "+"1, 3 or 4 but got ".concat(e));if(r.dtype!=="float32"&&r.dtype!=="int32")throw new Error("Unsupported type for toPixels: ".concat(r.dtype,".")+" Please use float32 or int32 tensors.")}function UH(r){var e=r?.alpha||1;if(e>1||e<0)throw new Error("Alpha value ".concat(e," is suppoed to be in range [0 - 1]."))}function HH(r,e){return $e(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l,f,h,p,d,m,v,g,y;return We(this,function(w){switch(w.label){case 0:return t=O(r,"img","toPixels"),r instanceof Sr||(n=t,t=Wt(n,"int32"),n.dispose()),GS(t),a=ke(t.shape.slice(0,2),2),i=a[0],o=a[1],s=t.rank===2?1:t.shape[2],[4,t.data()];case 1:for(u=w.sent(),c=t.dtype==="float32"?255:1,l=new Uint8ClampedArray(o*i*4),f=0;f<i*o;++f){for(h=[0,0,0,255],p=0;p<s;p++){if(d=u[f*s+p],t.dtype==="float32"){if(d<0||d>1)throw new Error("Tensor values for a float32 Tensor must be in the "+"range [0 - 1] but encountered ".concat(d,"."))}else if(t.dtype==="int32"&&(d<0||d>255))throw new Error("Tensor values for a int32 Tensor must be in the "+"range [0 - 255] but encountered ".concat(d,"."));s===1?(h[0]=d*c,h[1]=d*c,h[2]=d*c):h[p]=d*c}m=f*4,l[m+0]=Math.round(h[0]),l[m+1]=Math.round(h[1]),l[m+2]=Math.round(h[2]),l[m+3]=Math.round(h[3])}return e!=null&&(qw||(v=Ec(mv,q.backendName),v!=null&&(console.warn("tf.browser.toPixels is not efficient to draw tensor on canvas. Please try tf.browser.draw instead."),qw=!0)),e.width=o,e.height=i,g=e.getContext("2d"),y=new ImageData(l,o,i),g.putImageData(y,0,0)),t!==r&&t.dispose(),[2,l]}})})}function qH(r,e,t){var n=O(r,"img","draw");if(!(r instanceof Sr)){var a=n;n=Wt(a,"int32"),a.dispose()}GS(n),UH(t?.imageOptions);var i={image:n},o={canvas:e,options:t};q.runKernel(mv,i,o)}var KH=H({fromPixels_:WS}),jH={__proto__:null,draw:qH,fromPixels:KH,fromPixelsAsync:VH,toPixels:HH};function VS(r,e){var t=r.shape.length,n=e.shape.length;if(t<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher,"+" but the rank was ".concat(t,"."));if(n<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher,"+" but the rank was ".concat(n,"."));if(e.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type,"+" but the dtype was ".concat(e.dtype,"."));if(e.shape[n-1]>t)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+"".concat(e.shape[n-1]," vs. ").concat(t));if(Dt(r.shape)===0)throw new Error("Requested more than 0 entries, but input is empty."+" Input shape: ".concat(r.shape,"."));for(var a=e.shape,i=a[a.length-1],o=1,s=0;s<a.length-1;++s)o*=a[s];var u=r.shape,c=a.slice();c.pop();for(var l=1,s=i;s<t;++s)l*=u[s],c.push(u[s]);var f=pt(pt([],ke(iu(r.shape).map(function(h){return h/l})),!1),[1],!1).slice(0,i);return[c,o,l,f]}var XH={__proto__:null,prepareAndValidate:VS},lv=-2,YH=-1;function ZH(r,e,t){var n=r.shape.length;W(n===e.length,function(){return"Error in slice".concat(n,"D: Length of begin ").concat(e," must ")+"match the rank of the array (".concat(n,").")}),W(n===t.length,function(){return"Error in slice".concat(n,"D: Length of size ").concat(t," must ")+"match the rank of the array (".concat(n,").")});for(var a=function(o){W(e[o]+t[o]<=r.shape[o],function(){return"Error in slice".concat(n,"D: begin[").concat(o,"] + size[").concat(o,"] ")+"(".concat(e[o]+t[o],") would overflow input.shape[").concat(o,"] (").concat(r.shape[o],")")})},i=0;i<n;++i)a(i)}function JH(r){for(var e=[],t=0;r>0;)r&1&&e.push(t),r/=2,t++;return e}function QH(r,e,t){for(var n=[],a=0;a<r.length;a++)n[a]=Math.ceil((e[a]-r[a])/t[a]);return n}function US(r,e,t,n){for(var a=pt([],ke(r),!1),i=a.length;i<n.length;i++)a.push(1);for(var i=0;i<t;i++)i===0?a[e]=1:(a.splice(e,0,1),a.pop());return a}function HS(r,e,t){return t<=r?t:t-(e-1)}function qS(r,e){for(var t=[],n=0;n<r;n++)t.push(e+n);return t}function eq(r,e,t,n,a,i,o,s,u){var c=r.length,l=new Array(c),f=new Array(c),h=new Array(c);if(e.length&&t>0){var p=e[0],d=t+1;l=KS(o,p,d,n,r),f=jS(s,p,d,a,r),h=US(i,p,d,r)}else for(var m=0;m<c;m++)l[m]=YS(o,n,i,r,m,u),f[m]=ZS(s,a,i,r,m,u),h[m]=XS(i,m,u);return{begin:l,end:f,strides:h}}function KS(r,e,t,n,a){for(var i=pt([],ke(a),!1),o=qS(t,e),s=0;s<i.length;s++)if(o.indexOf(s)>-1)i[s]=0;else{var u=HS(e,t,s),c=n[u];r&1<<u&&(c=0),i[s]=c}return i}function jS(r,e,t,n,a){for(var i=pt([],ke(a),!1),o=qS(t,e),s=0;s<i.length;s++)if(o.indexOf(s)>-1)i[s]=Number.MAX_SAFE_INTEGER;else{var u=HS(e,t,s),c=n[u];r&1<<u&&(c=Number.MAX_SAFE_INTEGER),i[s]=c}for(var l=0;l<i.length;l++){var f=a[l];i[l]<0&&(i[l]+=f),i[l]=kc(0,i[l],a[l])}return i}function XS(r,e,t){var n=r[e];return(t&1<<e||n==null)&&(n=1),n}function YS(r,e,t,n,a,i){var o=e[a],s=t[a]||1;(r&1<<a||i&1<<a||o==null)&&(s>0?o=Number.MIN_SAFE_INTEGER:o=Number.MAX_SAFE_INTEGER);var u=n[a];return o<0&&(o+=u),o=kc(0,o,u-1),o}function ZS(r,e,t,n,a,i){var o=e[a],s=t[a]||1;(r&1<<a||i&1<<a||o==null)&&(s>0?o=Number.MAX_SAFE_INTEGER:o=Number.MIN_SAFE_INTEGER);var u=n[a];return o<0&&(o+=u),s>0?o=kc(0,o,u):o=kc(-1,o,u-1),o}function tq(r,e,t){for(var n=t.length,a=0;a<t.length;a++)if(t[a]>1){n=a;break}for(var a=n+1;a<t.length;a++)if(e[a]>0||t[a]!==r[a])return!1;return!0}function rq(r,e){for(var t=r.length>0?r[r.length-1]:1,n=0;n<r.length-1;n++)t+=r[n]*e[n];return t}function nq(r,e,t){var n,a=r.shape.length;typeof e=="number"?n=pt([e],ke(new Array(a-1).fill(0)),!1):e.length<a?n=e.concat(new Array(a-e.length).fill(0)):n=e.slice(),n.forEach(function(o){W(o!==-1,function(){return"slice() does not support negative begin indexing."})});var i;return t==null?i=new Array(a).fill(-1):typeof t=="number"?i=pt([t],ke(new Array(a-1).fill(-1)),!1):t.length<a?i=t.concat(new Array(a-t.length).fill(-1)):i=t,i=i.map(function(o,s){return o>=0?o:(W(o===-1,function(){return"Negative size values should be exactly -1 but got "+"".concat(o," for the slice() size at index ").concat(s,".")}),r.shape[s]-n[s])}),[n,i]}function aq(r,e,t,n,a,i,o,s,u){var c;if(n==null?(c=new Array(e.length),c.fill(1)):c=n,o!=null&&(o&o-1)!==0)throw new Error("Multiple ellipses in slice is not allowed.");for(var l=!1,f={dims:c.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:t.slice(),strides:c.slice(),beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u},h=0;h<f.dims;h++)l&&(1<<h&s)!==0&&f.numAddAxisAfterEllipsis++,1<<h&o&&(l=!0);l||(f.ellipsisMask|=1<<f.dims,f.dims++);var p={dims:r.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};iq(f,p);for(var d=!0,m=!0,v=!0,g=[],y=[],h=0;h<r.length;++h){if(p.strides[h]===0)throw Error("strides[".concat(h,"] must be non-zero"));var w=!!(p.shrinkAxisMask&1<<h),b=r[h];if(b===-1){g.push(w?1:-1);continue}var x=[p.beginMask&1<<h,p.endMask&1<<h],S=[p.strides[h]>0?0:-1,p.strides[h]>0?b:b-1];if(w&&p.strides[h]<=0)throw Error("only stride 1 allowed on non-range indexing.");v=v&&p.strides[h]===1;var T=!!(p.beginMask&1<<h&&p.endMask&1<<h);if(p.beginValid&&p.endValid){if(w){var N=p.begin[h]<0?b+p.begin[h]:p.begin[h];if(p.begin[h]=N,p.end[h]=p.begin[h]+1,N<0||N>=b)throw Error("slice index ".concat(p.begin[h]," of dimension ").concat(h," out of bounds."))}else p.begin[h]=Kw(p.begin[h],0,p.strides[h],b,x,S),p.end[h]=Kw(p.end[h],1,p.strides[h],b,x,S);var C=p.strides[h]===1&&p.begin[h]===0&&p.end[h]===b;d=d&&C,m=m&&(h===0&&p.strides[h]===1||C)}else d=d&&p.strides[h]===1&&T,m=m&&(h===0&&p.strides[h]===1||T);var R=void 0,_=!1;if(p.beginValid&&p.endValid?(R=p.end[h]-p.begin[h],_=!0):w?(R=1,_=!0):T&&b>=0&&(p.strides[h]<0?R=-b:R=b,_=!0),_){var P=void 0;R===0||R<0!=p.strides[h]<0?P=0:P=Math.trunc(R/p.strides[h])+(R%p.strides[h]!==0?1:0),g.push(P)}else g.push(-1)}for(var $=0;$<p.finalShapeGatherIndices.length;++$){var z=p.finalShapeGatherIndices[$];z>=0?y.push(g[z]):z===lv&&y.push(1)}var L=y.filter(function(B,G){return p.finalShapeGatherIndices[G]!==lv});return{finalShapeSparse:L,finalShape:y,isIdentity:d,sliceDim0:m,isSimpleSlice:v,begin:p.begin,end:p.end,strides:p.strides}}function iq(r,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;var t=0;e.beginValid=r.begin!=null,e.endValid=r.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(var n=0;n<r.dims;n++)if(1<<n&r.ellipsisMask)for(var a=Math.min(e.dims-(r.dims-n)+1+r.numAddAxisAfterEllipsis,e.dims);t<a;t++)e.begin[t]=0,e.end[t]=0,e.strides[t]=1,e.beginMask|=1<<t,e.endMask|=1<<t,e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[t]=n;else if(1<<n&r.newAxisMask)e.finalShapeGatherIndices.push(lv),e.finalShapeGatherIndicesSparse.push(-1);else{if(t===e.begin.length)throw Error("Index out of range using input dim ".concat(t,"; input ")+"has only ".concat(e.dims," dims, ").concat(e.begin.length,"."));r.begin!=null&&(e.begin[t]=r.begin[n]),r.end!=null&&(e.end[t]=r.end[n]),e.strides[t]=r.strides[n],r.beginMask&1<<n&&(e.beginMask|=1<<t),r.endMask&1<<n&&(e.endMask|=1<<t),r.shrinkAxisMask&1<<n?(e.finalShapeGatherIndices.push(YH),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<t):(e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(n)),e.inputShapeGatherIndicesSparse[t]=n,t++}}function Kw(r,e,t,n,a,i){if(a[e])return t>0?i[e]:i[e+1&1];var o=r<0?n+r:r;return o<i[0]?i[0]:o>i[1]?i[1]:o}var JS={__proto__:null,assertParamsValid:ZH,computeFlatOffset:rq,computeOutShape:QH,getNormalizedAxes:eq,isSliceContinous:tq,maskToAxes:JH,parseSliceParams:nq,sliceInfo:aq,startForAxis:YS,startIndicesWithElidedDims:KS,stopForAxis:ZS,stopIndicesWithElidedDims:jS,stridesForAxis:XS,stridesWithElidedDims:US};var oq="4.22.0";var QS=(function(){function r(){}return r.sgd=function(e){return new ih(e)},r.momentum=function(e,t,n){return n===void 0&&(n=!1),new Kv(e,t,n)},r.rmsprop=function(e,t,n,a,i){return t===void 0&&(t=.9),n===void 0&&(n=0),a===void 0&&(a=null),i===void 0&&(i=!1),new jv(e,t,n,a,i)},r.adam=function(e,t,n,a){return e===void 0&&(e=.001),t===void 0&&(t=.9),n===void 0&&(n=.999),a===void 0&&(a=null),new Hv(e,t,n,a)},r.adadelta=function(e,t,n){return e===void 0&&(e=.001),t===void 0&&(t=.95),n===void 0&&(n=null),new Vv(e,t,n)},r.adamax=function(e,t,n,a,i){return e===void 0&&(e=.002),t===void 0&&(t=.9),n===void 0&&(n=.999),a===void 0&&(a=null),i===void 0&&(i=0),new qv(e,t,n,a,i)},r.adagrad=function(e,t){return t===void 0&&(t=.1),new Uv(e,t)},r})();var sq=QS;var uq=(function(){return typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:function(r){return r()}})();function cq(){return new Promise(function(r){return uq(function(){return r()})})}function lq(r,e){var t=r[0].length;r.forEach(function(a,i){W(a.length===t,function(){return"Error in concat".concat(t,"D: rank of tensors[").concat(i,"] must be the same ")+"as the rank of the rest (".concat(t,")")})}),W(e>=0&&e<t,function(){return"Error in concat".concat(t,"D: axis must be between 0 and ").concat(t-1,".")});var n=r[0];r.forEach(function(a,i){for(var o=0;o<t;o++)W(o===e||a[o]===n[o],function(){return"Error in concat".concat(t,"D: Shape of tensors[").concat(i,"] (").concat(a,") ")+"does not match the shape of the rest (".concat(n,") ")+"along the non-concatenated axis ".concat(i,".")})})}function fq(r,e){for(var t=r[0].slice(),n=1;n<r.length;n++)t[e]+=r[n][e];return t}var ii;(function(r){r[r.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",r[r.VALUE_ROWIDS=1]="VALUE_ROWIDS",r[r.ROW_LENGTHS=2]="ROW_LENGTHS",r[r.ROW_SPLITS=3]="ROW_SPLITS",r[r.ROW_LIMITS=4]="ROW_LIMITS",r[r.ROW_STARTS=5]="ROW_STARTS"})(ii||(ii={}));function hq(r,e,t){var n=new Array;if(t==null&&e==null)return n;if(e==null)for(;n.length<r+t.length;)n.push(-1);else n=e.slice();if(t==null)return n;if(r+t.length!==n.length)throw new Error("rt input.shape and shape=".concat(e," are incompatible: rt input.rank = ").concat(r+t.length,", but shape.rank = ").concat(n.length));for(var a=1;a<t.length;++a){var i=t[a],o=n[n.length-t.length+a],s=n[o];if(i>=0)if(s>=0){if(s!==i)throw new Error("rt input.shape and shape=".concat(e," are incompatible: rt input.shape[").concat(a+r,"] = ").concat(i," but shape[").concat(a+r,"] = ").concat(s))}else n[o]=i}return n}function pq(r){var e,t,n={FIRST_DIM_SIZE:ii.FIRST_DIM_SIZE,VALUE_ROWIDS:ii.VALUE_ROWIDS,ROW_LENGTHS:ii.ROW_LENGTHS,ROW_SPLITS:ii.ROW_SPLITS,ROW_LIMITS:ii.ROW_LIMITS,ROW_STARTS:ii.ROW_STARTS},a=[];try{for(var i=Ur(r),o=i.next();!o.done;o=i.next()){var s=o.value;if(s in n)a.push(n[s]);else break}}catch(u){e={error:u}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return a}function dq(r){return r.length===0?0:r[0]===ii.FIRST_DIM_SIZE?r.length-1:r.length}function vq(r,e){if(!(r==null||e==null)){var t=r.length,n=e.length;if(t>=n)throw new Error("defaultValue.shape=".concat(r," and ragged tensor flatValues.shape=").concat(e,", are incompatible: defaultValue.rank = ").concat(t," must be less than ragged tensor input flatValues.rank = ").concat(n,")"));for(var a=0;a<Math.min(t,n-1);++a){var i=r[a],o=e[a+1];if(i>=0&&o>=0&&i!==1&&i!==o)throw new Error("defaultValue.shape=".concat(r,", and ragged tensor input flatValues.shape=").concat(e," are incompatible: defaultValue.shape[").concat(a-r.length,"] = ").concat(i," but ragged tensor input.flatValues.shape[").concat(a-r.length,"] = ").concat(o))}}}var Zv=30;function mq(r){return r<=Zv?r:Ff(r,Math.floor(Math.sqrt(r)))}function gq(r,e,t){var n=t*(typeof r=="number"?r:r[0]),a=e*(typeof r=="number"?r:r[1]);return[n,a]}function yq(r,e,t,n){n===void 0&&(n=!0);var a=[];if(n)a=a.concat(e.slice(0)),a.push(r[0]/t),a=a.concat(r.slice(1));else{a=a.concat(r[0]);for(var i=e.length,o=0;o<i;++o)a=a.concat([r[o+1]/e[o],e[o]]);a=a.concat(r.slice(i+1))}return a}function bq(r,e,t){t===void 0&&(t=!0);var n=[];if(t){n.push(e);for(var a=e+1;a<r;++a)a<=2*e?(n.push(a),n.push(a-(e+1))):n.push(a)}else{for(var i=[],o=[],a=1;a<r;++a)a>=e*2+1||a%2===1?o.push(a):i.push(a);n.push.apply(n,pt([],ke(i),!1)),n.push(0),n.push.apply(n,pt([],ke(o),!1))}return n}function wq(r,e,t,n){n===void 0&&(n=!0);var a=[];n?a.push(r[0]/t):a.push(r[0]*t);for(var i=1;i<r.length;++i)i<=e.length?n?a.push(e[i-1]*r[i]):a.push(r[i]/e[i-1]):a.push(r[i]);return a}function xq(r,e){for(var t=[0],n=0;n<e;++n)t.push(r[n][0]);return t}function kq(r,e,t){for(var n=r.slice(0,1),a=0;a<t;++a)n.push(r[a+1]-e[a][0]-e[a][1]);return n}var Sq=1.7580993408473768,Eq=1.0507009873554805;var Tq=.3275911,Nq=.254829592,Iq=-.284496736,Cq=1.421413741,Aq=-1.453152027,Dq=1.061405429;function _q(r,e){if(r.length!==e.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+"".concat(r.length,", imag: ").concat(e.length,"."));for(var t=new Float32Array(r.length*2),n=0;n<t.length;n+=2)t[n]=r[n/2],t[n+1]=e[n/2];return t}function Fq(r){for(var e=new Float32Array(r.length/2),t=new Float32Array(r.length/2),n=0;n<r.length;n+=2)e[n/2]=r[n],t[n/2]=r[n+1];return{real:e,imag:t}}function Rq(r){for(var e=Math.ceil(r.length/4),t=new Float32Array(e),n=new Float32Array(e),a=0;a<r.length;a+=4)t[Math.floor(a/4)]=r[a],n[Math.floor(a/4)]=r[a+1];return{real:t,imag:n}}function Oq(r){for(var e=Math.floor(r.length/4),t=new Float32Array(e),n=new Float32Array(e),a=2;a<r.length;a+=4)t[Math.floor(a/4)]=r[a],n[Math.floor(a/4)]=r[a+1];return{real:t,imag:n}}function Pq(r,e){var t=r[e*2],n=r[e*2+1];return{real:t,imag:n}}function Mq(r,e,t,n){r[n*2]=e,r[n*2+1]=t}function Bq(r,e){for(var t=new Float32Array(r/2),n=new Float32Array(r/2),a=0;a<Math.ceil(r/2);a++){var i=(e?2:-2)*Math.PI*(a/r);t[a]=Math.cos(i),n[a]=Math.sin(i)}return{real:t,imag:n}}function Lq(r,e,t){var n=(t?2:-2)*Math.PI*(r/e),a=Math.cos(n),i=Math.sin(n);return{real:a,imag:i}}var Ld="->",zq=/->/g,jw=",",Xw="...";function $q(r,e){r=r.replace(/\s/g,"");var t=(r.length-r.replace(zq,"").length)/Ld.length;if(t<1)throw new Error("Equations without an arrow are not supported.");if(t>1)throw new Error('Equation must contain exactly one arrow ("'.concat(Ld,'").'));var n=ke(r.split(Ld),2),a=n[0],i=n[1];W(a.indexOf(Xw)===-1,function(){return'The ellipsis notation ("'.concat(Xw,'") is not supported yet.')});var o=a.split(jw),s=o.length;if(e!==s)throw new Error("Expected ".concat(s," input tensors, received ").concat(e));if(s>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");for(var u=[],c=function(g){var y=i[g];if(!o.some(function(w){return w.indexOf(y)!==-1}))throw new Error("Output subscripts contain the label ".concat(y," ")+"not present in the input subscripts.");u.indexOf(y)===-1&&u.push(y)},l=0;l<i.length;++l)c(l);for(var l=0;l<a.length;++l){var f=a[l];u.indexOf(f)===-1&&f!==jw&&u.push(f)}for(var h=new Array(o.length),l=0;l<s;++l){if(new Set(o[l].split("")).size!==o[l].length)throw new Error("Found duplicate axes in input component ".concat(o[l],". ")+"Support for duplicate axes in input is not implemented yet.");h[l]=[];for(var p=0;p<o[l].length;++p)h[l].push(u.indexOf(o[l][p]))}for(var d=u.length,m=i.length,v=[],l=m;l<d;++l)v.push(l);return{allDims:u,summedDims:v,idDims:h}}function Wq(r,e){var t=new Array(r);t.fill(-1);for(var n=0;n<e.length;++n)t[e[n]]=n;for(var a=[],n=0;n<r;++n)t[n]===-1&&a.push(n);return t=t.filter(function(i){return i!==-1}),{permutationIndices:t,expandDims:a}}function Gq(r,e,t){for(var n=new Array(r),a=function(o){for(var s=t[o].shape,u=function(l){n[e[o][l]]===void 0?n[e[o][l]]=s[l]:W(n[e[o][l]]===s[l],function(){return"Expected dimension ".concat(n[e[o][l]]," at axis ").concat(l," ")+"of input shaped ".concat(JSON.stringify(s),", ")+"but got dimension ".concat(s[l])})},c=0;c<e[o].length;++c)u(c)},i=0;i<t.length;++i)a(i)}function Vq(r,e){var t,n,a=r,i=[],o=0;r.length===0&&a.push(-1),o=r.length+1;for(var s=0;s<o;++s)i.push([]);for(var u=[],s=0;s<a.length;++s){var c=a[s],l=Hq(e,c);try{for(var f=(t=void 0,Ur(l)),h=f.next();!h.done;h=f.next()){var p=h.value;u.indexOf(p)===-1&&(i[s].push(p),u.push(p))}}catch(m){t={error:m}}finally{try{h&&!h.done&&(n=f.return)&&n.call(f)}finally{if(t)throw t.error}}}return{path:a,steps:i}}function Uq(r){return r.every(function(e,t){return e===t})}function Hq(r,e){for(var t=[],n=0;n<r.length;++n)(r[n].length===0||r[n].indexOf(e)!==-1||e===-1)&&t.push(n);return t}function qq(r,e,t){t===void 0&&(t=0);var n=[];if(typeof e=="number")W(r.shape[t]%e===0,function(){return"Number of splits must evenly divide the axis."}),n=new Array(e).fill(r.shape[t]/e);else{var a=e.reduce(function(s,u){return u===-1&&(s+=1),s},0);W(a<=1,function(){return"There should be only one negative value in split array."});var i=e.indexOf(-1);if(i!==-1){var o=e.reduce(function(s,u){return u>0?s+u:s});e[i]=r.shape[t]-o}W(r.shape[t]===e.reduce(function(s,u){return s+u}),function(){return"The sum of sizes must match the size of the axis dimension."}),n=e}return n}function Kq(r){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = `.concat(r)}function jq(r,e){return"indices(".concat(r,", 0) is invalid: ").concat(e," < 0")}function Xq(r,e,t){return"indices(".concat(r,", 0) is invalid: ").concat(e," >= ").concat(t)}function Yq(r,e){return"only one output dimension may be -1, not both ".concat(r," and ").concat(e)}function Zq(r,e){return"size ".concat(r," must be non-negative, not ").concat(e)}function Jq(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function Qq(r,e){var t=Dt(r),n=Dt(e);return"Input to reshape is a SparseTensor with ".concat(t,`
  dense values, but the requested shape requires a multiple of `).concat(n,". inputShape=").concat(r," outputShape= ").concat(e)}function eK(r,e){var t=Dt(r),n=Dt(e);return"Input to reshape is a tensor with ".concat(t," dense values, but the requested shape has ").concat(n,". inputShape=").concat(r," outputShape=").concat(e)}function tK(){return"segment ids must be >= 0"}function rK(){return"segment ids are not increasing"}function nK(r,e){return"Segment id ".concat(r," out of range [0, ").concat(e,"), possibly because segmentIds input is not sorted.")}function aK(r,e,t){return"Bad: indices[".concat(r,"] == ").concat(e," out of range [0, ").concat(t,")")}function iK(r,e){var t=!1,n;for(r<=Zv?(n=r,t=!0):n=Ff(r,Math.floor(Math.sqrt(r)));!t;)n>e||n===r?t=!0:n=Ff(r,n+1);return n}function oK(r,e,t){for(var n=[],a=r.length,i=0;i<a;i++)i!==e?n.push(r[i]):n.push(t);return n}function sK(r,e,t,n){var a=e.shape.length,i=r.shape.length;if(n!==0&&(n<-a||n>a))throw new Error("Expect batchDims in the range of [-".concat(a,", ").concat(a,"], but got ").concat(n));if(n<0&&(n+=a),n>i)throw new Error("batchDims (".concat(n,`) must be less than rank(x) (
    `).concat(i,")."));if(t<n)throw new Error("batchDims (".concat(n,") must be less than or equal to axis (").concat(t,")."));for(var o=0;o<n;++o)if(r.shape[o]!==e.shape[o])throw new Error("x.shape[".concat(o,"]: ").concat(r.shape[o]," should be equal to indices.shape[").concat(o,"]: ").concat(e.shape[o],"."));for(var s=r.shape[t],u=[],c=1,l=1,f=1,o=0;o<n;++o)u.push(r.shape[o]),c*=r.shape[o];for(var o=n;o<t;o++)u.push(r.shape[o]),l*=r.shape[o];for(var o=n;o<a;o++)u.push(e.shape[o]);for(var o=t+1;o<i;o++)u.push(r.shape[o]),f*=r.shape[o];return{batchSize:c,sliceSize:f,outerSize:l,dimSize:s,outputShape:u}}var uK={__proto__:null,collectGatherOpShapeInfo:sK,computeOutShape:oK,segOpComputeOptimalWindowSize:iK};function cK(r){try{return r.map(function(e){return Pf(e)})}catch(e){throw new Error("Failed to decode encoded string bytes into utf-8, error: ".concat(e))}}function lK(r){return r.map(function(e){return $c(e)})}var fK={__proto__:null,ERF_A1:Nq,ERF_A2:Iq,ERF_A3:Cq,ERF_A4:Aq,ERF_A5:Dq,ERF_P:Tq,PARALLELIZE_THRESHOLD:Zv,get RowPartitionType(){return ii},SELU_SCALE:Eq,SELU_SCALEALPHA:Sq,applyActivation:nh,assertAndGetBroadcastShape:Tr,assertAxesAreInnerMostDims:o$,assertParamsConsistent:lq,assignToTypedArray:Mq,axesAreInnerMostDims:Cv,calculateShapes:ES,checkEinsumDimSizes:Gq,checkPadOnDimRoundingMode:da,combineLocations:U2,combineRaggedTensorToTensorShapes:hq,complexWithEvenIndex:Rq,complexWithOddIndex:Oq,computeConv2DInfo:Gc,computeConv3DInfo:P2,computeDefaultPad:Tv,computeDilation2DInfo:N4,computeOptimalWindowSize:mq,computeOutAndReduceShapes:i$,computeOutShape:fq,computePool2DInfo:O2,computePool3DInfo:I4,convertConv2DDataFormat:M2,decodeEinsumEquation:$q,eitherStridesOrDilationsAreOne:Di,expandShapeToKeepDim:Uc,exponent:Lq,exponents:Bq,fromStringArrayToUint8:lK,fromUint8ToStringArray:cK,getAxesPermutation:s$,getBroadcastDims:W2,getComplexWithIndex:Pq,getEinsumComputePath:Vq,getEinsumPermutation:Wq,getFusedBiasGradient:rh,getFusedDyActivation:th,getImageCenter:gq,getInnerMostAxes:c$,getPermuted:bq,getRaggedRank:dq,getReductionAxes:Iv,getReshaped:yq,getReshapedPermuted:wq,getRowPartitionTypesHelper:pq,getSliceBeginCoords:xq,getSliceSize:kq,getSparseFillEmptyRowsIndicesDenseShapeMismatch:Kq,getSparseFillEmptyRowsNegativeIndexErrorMessage:jq,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:Xq,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:Jq,getSparseReshapeInputOutputMismatchErrorMessage:eK,getSparseReshapeInputOutputMultipleErrorMessage:Qq,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:Yq,getSparseReshapeNegativeOutputDimErrorMessage:Zq,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:aK,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:tK,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:rK,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:nK,getUndoAxesPermutation:u$,isIdentityPermutation:Uq,log:pB,mergeRealAndImagArrays:_q,prepareAndValidate:VS,prepareSplitSize:qq,segment_util:uK,shouldFuse:ah,slice_util:JS,splitRealAndImagArrays:Fq,stridesOrDilationsArePositive:Go,tupleValuesAreOne:Dc,upcastType:qf,validateDefaultValueShape:vq,validateInput:eh,validateUpdateShape:zv,warn:Ki};var hK={__proto__:null,nonMaxSuppressionV3Impl:DS,nonMaxSuppressionV4Impl:_S,nonMaxSuppressionV5Impl:FS,whereImpl:TS};gH();D.Abs=c1;D.Acos=l1;D.Acosh=f1;D.AdadeltaOptimizer=Vv;D.AdagradOptimizer=Uv;D.AdamOptimizer=Hv;D.AdamaxOptimizer=qv;D.Add=dv;D.AddN=h1;D.All=p1;D.Any=d1;D.ArgMax=v1;D.ArgMin=m1;D.Asin=g1;D.Asinh=y1;D.Atan=b1;D.Atan2=x1;D.Atanh=w1;D.AvgPool=k1;D.AvgPool3D=S1;D.AvgPool3DGrad=XM;D.AvgPoolGrad=jM;D.BatchMatMul=E1;D.BatchToSpaceND=T1;D.Bincount=N1;D.BitwiseAnd=I1;D.BroadcastArgs=C1;D.BroadcastTo=YM;D.Cast=vv;D.Ceil=A1;D.ClipByValue=D1;D.Complex=_1;D.ComplexAbs=F1;D.Concat=R1;D.Conv2D=O1;D.Conv2DBackpropFilter=P1;D.Conv2DBackpropInput=M1;D.Conv3D=B1;D.Conv3DBackpropFilterV2=ZM;D.Conv3DBackpropInputV2=L1;D.Cos=z1;D.Cosh=$1;D.CropAndResize=V1;D.Cumprod=W1;D.Cumsum=G1;D.DataStorage=NM;D.DenseBincount=U1;D.DepthToSpace=H1;D.DepthwiseConv2dNative=q1;D.DepthwiseConv2dNativeBackpropFilter=K1;D.DepthwiseConv2dNativeBackpropInput=j1;D.Diag=X1;D.Dilation2D=Y1;D.Dilation2DBackpropFilter=QM;D.Dilation2DBackpropInput=JM;D.Draw=mv;D.Einsum=J1;D.Elu=Q1;D.EluGrad=eB;D.Environment=s1;D.Equal=tx;D.Erf=ex;D.Exp=rx;D.ExpandDims=nx;D.Expm1=ax;D.FFT=ix;D.Fill=ox;D.FlipLeftRight=sx;D.Floor=ux;D.FloorDiv=cx;D.FromPixels=$d;D.FusedBatchNorm=lx;D.FusedConv2D=Gd;D.FusedDepthwiseConv2D=Vd;D.GatherNd=hx;D.GatherV2=fx;D.Greater=px;D.GreaterEqual=dx;D.IFFT=vx;D.Identity=gv;D.Imag=mx;D.IsFinite=gx;D.IsInf=yx;D.IsNan=bx;D.KernelBackend=Yw;D.LRN=Ax;D.LRNGrad=aB;D.LeakyRelu=wx;D.Less=xx;D.LessEqual=kx;D.LinSpace=Sx;D.Log=Ex;D.Log1p=Tx;D.LogSoftmax=rB;D.LogicalAnd=Nx;D.LogicalNot=Ix;D.LogicalOr=Cx;D.LogicalXor=tB;D.LowerBound=nB;D.MatrixBandPart=iB;D.Max=Dx;D.MaxPool=Fx;D.MaxPool3D=Rx;D.MaxPool3DGrad=sB;D.MaxPoolGrad=oB;D.MaxPoolWithArgmax=Ox;D.Maximum=_x;D.Mean=Px;D.Min=Mx;D.Minimum=Bx;D.MirrorPad=Lx;D.Mod=zx;D.MomentumOptimizer=Kv;D.Multinomial=$x;D.Multiply=Wx;D.Neg=Gx;D.NonMaxSuppressionV3=Ux;D.NonMaxSuppressionV4=Hx;D.NonMaxSuppressionV5=qx;D.NotEqual=Vx;D.OP_SCOPE_SUFFIX=g2;D.OneHot=jx;D.OnesLike=Kx;D.Optimizer=ao;D.OptimizerConstructors=QS;D.Pack=Xx;D.PadV2=Yx;D.Pool=uB;D.Pow=Zx;D.Prelu=Jx;D.Prod=Qx;D.RMSPropOptimizer=jv;D.RaggedGather=ek;D.RaggedRange=tk;D.RaggedTensorToTensor=rk;D.Range=nk;D.Real=ak;D.RealDiv=Z1;D.Reciprocal=ik;D.Relu=ok;D.Relu6=lk;D.Reshape=sk;D.ResizeBilinear=ck;D.ResizeBilinearGrad=lB;D.ResizeNearestNeighbor=uk;D.ResizeNearestNeighborGrad=cB;D.Reverse=fk;D.RotateWithOffset=Zk;D.Round=hk;D.Rsqrt=pk;D.SGDOptimizer=ih;D.ScatterNd=dk;D.SearchSorted=mk;D.Select=gk;D.Selu=yk;D.Sigmoid=Sk;D.Sign=kk;D.Sin=wk;D.Sinh=xk;D.Slice=bk;D.Softmax=Ak;D.Softplus=Ek;D.SpaceToBatchND=Ik;D.SparseFillEmptyRows=Dk;D.SparseReshape=_k;D.SparseSegmentMean=Fk;D.SparseSegmentSum=Rk;D.SparseToDense=Ok;D.SplitV=Ck;D.Sqrt=Tk;D.Square=fB;D.SquaredDifference=Pk;D.StaticRegexReplace=Mk;D.Step=Yk;D.StridedSlice=Bk;D.StringNGrams=Lk;D.StringSplit=zk;D.StringToHashBucketFast=$k;D.Sub=Wk;D.Sum=Nk;D.Tan=Gk;D.Tanh=Vk;D.Tensor=Sr;D.TensorBuffer=Mf;D.TensorScatterUpdate=vk;D.Tile=yv;D.TopK=Uk;D.Transform=Hk;D.Transpose=Nf;D.Unique=qk;D.Unpack=Kk;D.UnsortedSegmentSum=jk;D.UpperBound=hB;D.Variable=Nc;D.ZerosLike=Xk;D._FusedMatMul=Wd;D.abs=Yn;D.acos=n4;D.acosh=i4;D.add=at;D.addN=s4;D.all=c4;D.any=f4;D.argMax=p4;D.argMin=v4;D.asin=g4;D.asinh=b4;D.atan=x4;D.atan2=S4;D.atanh=T4;D.avgPool=B2;D.avgPool3d=P4;D.backend=w2;D.backend_util=fK;D.basicLSTMCell=G4;D.batchNorm=Kf;D.batchNorm2d=K4;D.batchNorm3d=X4;D.batchNorm4d=Z4;D.batchToSpaceND=L2;D.bincount=z2;D.bitwiseAnd=ez;D.booleanMaskAsync=tU;D.broadcastArgs=rz;D.broadcastTo=Af;D.broadcast_util=Hz;D.browser=jH;D.buffer=Ti;D.cast=Wt;D.ceil=iz;D.clipByValue=sz;D.clone=Lo;D.complex=eo;D.concat=An;D.concat1d=cz;D.concat2d=fz;D.concat3d=pz;D.concat4d=vz;D.conv1d=yz;D.conv2d=jf;D.conv2dTranspose=xz;D.conv3d=Sz;D.conv3dTranspose=Iz;D.copyRegisteredKernels=gB;D.cos=Az;D.cosh=_z;D.cosineWindow=Wv;D.cumprod=Rz;D.cumsum=Pz;D.customGrad=ui;D.denseBincount=Bz;D.deprecationWarn=tL;D.depthToSpace=zz;D.depthwiseConv2d=Nv;D.device_util=XB;D.diag=Gz;D.dilation2d=Uz;D.disableDeprecationWarnings=eL;D.dispose=dn;D.disposeVariables=rL;D.div=Lt;D.divNoNan=Yz;D.dot=Jz;D.dropout=dU;D.einsum=Ks;D.elu=V2;D.enableDebugMode=QB;D.enableProdMode=JB;D.enclosingPowerOfTwo=IS;D.engine=nL;D.ensureShape=r$;D.env=st;D.equal=G2;D.erf=a$;D.euclideanNorm=y$;D.exp=Vo;D.expandDims=qi;D.expm1=k$;D.eye=q2;D.fft=Mv;D.fill=Vc;D.findBackend=lL;D.findBackendFactory=fL;D.floor=K2;D.floorDiv=R2;D.fused=AU;D.gather=j2;D.gatherND=fU;D.gather_util=XH;D.getBackend=b2;D.getGradient=Ud;D.getKernel=Ec;D.getKernelsForBackend=Rf;D.grad=U$;D.grads=H$;D.greater=Yf;D.greaterEqual=X2;D.ifft=$f;D.imag=Zf;D.image=uH;D.inTopKAsync=mU;D.io=PH;D.irfft=wS;D.isFinite=_$;D.isInf=R$;D.isNaN=P$;D.keep=y2;D.kernel_impls=hK;D.leakyRelu=Y2;D.less=iv;D.lessEqual=Av;D.linalg=cH;D.linspace=z$;D.localResponseNormalization=W$;D.log=Fc;D.log1p=Z2;D.logSigmoid=Z$;D.logSoftmax=eW;D.logSumExp=eS;D.logicalAnd=Bf;D.logicalNot=tS;D.logicalOr=rS;D.logicalXor=oW;D.losses=lH;D.lowerBound=uW;D.matMul=Nt;D.math=LH;D.max=eu;D.maxPool=nS;D.maxPool3d=fW;D.maxPoolWithArgmax=pW;D.maximum=aS;D.mean=Lf;D.memory=aL;D.meshgrid=mW;D.min=av;D.minimum=zf;D.mirrorPad=bW;D.mod=xW;D.moments=SW;D.movingAverage=aU;D.mul=Pe;D.multiRNNCell=TW;D.multinomial=IW;D.neg=oi;D.nextFrame=cq;D.norm=Xf;D.notEqual=iS;D.oneHot=ov;D.ones=Bo;D.onesLike=_W;D.op=H;D.outerProduct=RW;D.pad=Hc;D.pad1d=MW;D.pad2d=LW;D.pad3d=$W;D.pad4d=GW;D.pool=KW;D.pow=_c;D.prelu=sS;D.print=F2;D.prod=YW;D.profile=iL;D.raggedGather=JW;D.raggedRange=eG;D.raggedTensorToTensor=rG;D.rand=aG;D.randomGamma=_G;D.randomNormal=gS;D.randomStandardNormal=OG;D.randomUniform=Pv;D.randomUniformInt=BG;D.range=Rc;D.ready=uL;D.real=Oc;D.reciprocal=$G;D.registerBackend=hL;D.registerGradient=dB;D.registerKernel=Jk;D.relu=Qf;D.relu6=yS;D.removeBackend=cL;D.reshape=ve;D.reverse=Uo;D.reverse1d=HG;D.reverse2d=KG;D.reverse3d=XG;D.reverse4d=ZG;D.rfft=Bv;D.round=bS;D.rsqrt=eV;D.scalar=Rt;D.scatterND=oU;D.scatter_util=zV;D.searchSorted=Dv;D.selu=rV;D.separableConv2d=aV;D.serialization=vH;D.setBackend=sL;D.setPlatform=pL;D.setdiff1dAsync=oV;D.sigmoid=Qs;D.sign=uV;D.signal=sH;D.sin=lV;D.sinh=hV;D.slice=Jt;D.slice1d=dV;D.slice2d=mV;D.slice3d=yV;D.slice4d=wV;D.slice_util=JS;D.softmax=kV;D.softplus=Q2;D.spaceToBatchND=oS;D.sparse=fH;D.sparseToDense=cU;D.spectral=oH;D.split=Pc;D.sqrt=Ni;D.square=za;D.squaredDifference=xS;D.squeeze=Lv;D.stack=Mc;D.step=kS;D.stridedSlice=RV;D.string=hH;D.sub=ht;D.sum=Bt;D.sumOutType=$B;D.tan=PV;D.tanh=nv;D.tensor=Ys;D.tensor1d=pa;D.tensor2d=xc;D.tensor3d=SS;D.tensor4d=MV;D.tensor5d=BV;D.tensor6d=LV;D.tensorScatterUpdate=WV;D.tensor_util=VB;D.test_util=IG;D.tidy=Er;D.tile=wc;D.time=oL;D.topk=VV;D.train=sq;D.transpose=Wf;D.truncatedNormal=HV;D.unique=KV;D.unregisterGradient=mB;D.unregisterKernel=vB;D.unsortedSegmentSum=XV;D.unstack=$v;D.upcastType=qf;D.upperBound=ZV;D.util=AB;D.valueAndGrad=q$;D.valueAndGrads=K$;D.variable=JV;D.variableGrads=J2;D.version_core=oq;D.where=Zi;D.whereAsync=NS;D.zeros=au;D.zerosLike=Zn});var lE=Vr((JLe,cE)=>{cE.exports=Gt;var va=null;try{va=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function Gt(r,e,t){this.low=r|0,this.high=e|0,this.unsigned=!!t}Gt.prototype.__isLong__;Object.defineProperty(Gt.prototype,"__isLong__",{value:!0});function Rn(r){return(r&&r.__isLong__)===!0}Gt.isLong=Rn;var eE={},tE={};function Zo(r,e){var t,n,a;return e?(r>>>=0,(a=0<=r&&r<256)&&(n=tE[r],n)?n:(t=Vt(r,(r|0)<0?-1:0,!0),a&&(tE[r]=t),t)):(r|=0,(a=-128<=r&&r<128)&&(n=eE[r],n)?n:(t=Vt(r,r<0?-1:0,!1),a&&(eE[r]=t),t))}Gt.fromInt=Zo;function ma(r,e){if(isNaN(r))return e?Yo:ga;if(e){if(r<0)return Yo;if(r>=iE)return uE}else{if(r<=-nE)return Fn;if(r+1>=nE)return sE}return r<0?ma(-r,e).neg():Vt(r%uu|0,r/uu|0,e)}Gt.fromNumber=ma;function Vt(r,e,t){return new Gt(r,e,t)}Gt.fromBits=Vt;var oh=Math.pow;function Qv(r,e,t){if(r.length===0)throw Error("empty string");if(r==="NaN"||r==="Infinity"||r==="+Infinity"||r==="-Infinity")return ga;if(typeof e=="number"?(t=e,e=!1):e=!!e,t=t||10,t<2||36<t)throw RangeError("radix");var n;if((n=r.indexOf("-"))>0)throw Error("interior hyphen");if(n===0)return Qv(r.substring(1),e,t).neg();for(var a=ma(oh(t,8)),i=ga,o=0;o<r.length;o+=8){var s=Math.min(8,r.length-o),u=parseInt(r.substring(o,o+s),t);if(s<8){var c=ma(oh(t,s));i=i.mul(c).add(ma(u))}else i=i.mul(a),i=i.add(ma(u))}return i.unsigned=e,i}Gt.fromString=Qv;function Wa(r,e){return typeof r=="number"?ma(r,e):typeof r=="string"?Qv(r,e):Vt(r.low,r.high,typeof e=="boolean"?e:r.unsigned)}Gt.fromValue=Wa;var rE=65536,pK=1<<24,uu=rE*rE,iE=uu*uu,nE=iE/2,aE=Zo(pK),ga=Zo(0);Gt.ZERO=ga;var Yo=Zo(0,!0);Gt.UZERO=Yo;var su=Zo(1);Gt.ONE=su;var oE=Zo(1,!0);Gt.UONE=oE;var Jv=Zo(-1);Gt.NEG_ONE=Jv;var sE=Vt(-1,2147483647,!1);Gt.MAX_VALUE=sE;var uE=Vt(-1,-1,!0);Gt.MAX_UNSIGNED_VALUE=uE;var Fn=Vt(0,-2147483648,!1);Gt.MIN_VALUE=Fn;var _e=Gt.prototype;_e.toInt=function(){return this.unsigned?this.low>>>0:this.low};_e.toNumber=function(){return this.unsigned?(this.high>>>0)*uu+(this.low>>>0):this.high*uu+(this.low>>>0)};_e.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Fn)){var t=ma(e),n=this.div(t),a=n.mul(t).sub(this);return n.toString(e)+a.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var i=ma(oh(e,6),this.unsigned),o=this,s="";;){var u=o.div(i),c=o.sub(u.mul(i)).toInt()>>>0,l=c.toString(e);if(o=u,o.isZero())return l+s;for(;l.length<6;)l="0"+l;s=""+l+s}};_e.getHighBits=function(){return this.high};_e.getHighBitsUnsigned=function(){return this.high>>>0};_e.getLowBits=function(){return this.low};_e.getLowBitsUnsigned=function(){return this.low>>>0};_e.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Fn)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return this.high!=0?t+33:t+1};_e.isZero=function(){return this.high===0&&this.low===0};_e.eqz=_e.isZero;_e.isNegative=function(){return!this.unsigned&&this.high<0};_e.isPositive=function(){return this.unsigned||this.high>=0};_e.isOdd=function(){return(this.low&1)===1};_e.isEven=function(){return(this.low&1)===0};_e.equals=function(e){return Rn(e)||(e=Wa(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};_e.eq=_e.equals;_e.notEquals=function(e){return!this.eq(e)};_e.neq=_e.notEquals;_e.ne=_e.notEquals;_e.lessThan=function(e){return this.comp(e)<0};_e.lt=_e.lessThan;_e.lessThanOrEqual=function(e){return this.comp(e)<=0};_e.lte=_e.lessThanOrEqual;_e.le=_e.lessThanOrEqual;_e.greaterThan=function(e){return this.comp(e)>0};_e.gt=_e.greaterThan;_e.greaterThanOrEqual=function(e){return this.comp(e)>=0};_e.gte=_e.greaterThanOrEqual;_e.ge=_e.greaterThanOrEqual;_e.compare=function(e){if(Rn(e)||(e=Wa(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};_e.comp=_e.compare;_e.negate=function(){return!this.unsigned&&this.eq(Fn)?Fn:this.not().add(su)};_e.neg=_e.negate;_e.add=function(e){Rn(e)||(e=Wa(e));var t=this.high>>>16,n=this.high&65535,a=this.low>>>16,i=this.low&65535,o=e.high>>>16,s=e.high&65535,u=e.low>>>16,c=e.low&65535,l=0,f=0,h=0,p=0;return p+=i+c,h+=p>>>16,p&=65535,h+=a+u,f+=h>>>16,h&=65535,f+=n+s,l+=f>>>16,f&=65535,l+=t+o,l&=65535,Vt(h<<16|p,l<<16|f,this.unsigned)};_e.subtract=function(e){return Rn(e)||(e=Wa(e)),this.add(e.neg())};_e.sub=_e.subtract;_e.multiply=function(e){if(this.isZero())return ga;if(Rn(e)||(e=Wa(e)),va){var t=va.mul(this.low,this.high,e.low,e.high);return Vt(t,va.get_high(),this.unsigned)}if(e.isZero())return ga;if(this.eq(Fn))return e.isOdd()?Fn:ga;if(e.eq(Fn))return this.isOdd()?Fn:ga;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(aE)&&e.lt(aE))return ma(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,a=this.high&65535,i=this.low>>>16,o=this.low&65535,s=e.high>>>16,u=e.high&65535,c=e.low>>>16,l=e.low&65535,f=0,h=0,p=0,d=0;return d+=o*l,p+=d>>>16,d&=65535,p+=i*l,h+=p>>>16,p&=65535,p+=o*c,h+=p>>>16,p&=65535,h+=a*l,f+=h>>>16,h&=65535,h+=i*c,f+=h>>>16,h&=65535,h+=o*u,f+=h>>>16,h&=65535,f+=n*l+a*c+i*u+o*s,f&=65535,Vt(p<<16|d,f<<16|h,this.unsigned)};_e.mul=_e.multiply;_e.divide=function(e){if(Rn(e)||(e=Wa(e)),e.isZero())throw Error("division by zero");if(va){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?va.div_u:va.div_s)(this.low,this.high,e.low,e.high);return Vt(t,va.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Yo:ga;var n,a,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Yo;if(e.gt(this.shru(1)))return oE;i=Yo}else{if(this.eq(Fn)){if(e.eq(su)||e.eq(Jv))return Fn;if(e.eq(Fn))return su;var o=this.shr(1);return n=o.div(e).shl(1),n.eq(ga)?e.isNegative()?su:Jv:(a=this.sub(e.mul(n)),i=n.add(a.div(e)),i)}else if(e.eq(Fn))return this.unsigned?Yo:ga;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=ga}for(a=this;a.gte(e);){n=Math.max(1,Math.floor(a.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(n)/Math.LN2),u=s<=48?1:oh(2,s-48),c=ma(n),l=c.mul(e);l.isNegative()||l.gt(a);)n-=u,c=ma(n,this.unsigned),l=c.mul(e);c.isZero()&&(c=su),i=i.add(c),a=a.sub(l)}return i};_e.div=_e.divide;_e.modulo=function(e){if(Rn(e)||(e=Wa(e)),va){var t=(this.unsigned?va.rem_u:va.rem_s)(this.low,this.high,e.low,e.high);return Vt(t,va.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};_e.mod=_e.modulo;_e.rem=_e.modulo;_e.not=function(){return Vt(~this.low,~this.high,this.unsigned)};_e.and=function(e){return Rn(e)||(e=Wa(e)),Vt(this.low&e.low,this.high&e.high,this.unsigned)};_e.or=function(e){return Rn(e)||(e=Wa(e)),Vt(this.low|e.low,this.high|e.high,this.unsigned)};_e.xor=function(e){return Rn(e)||(e=Wa(e)),Vt(this.low^e.low,this.high^e.high,this.unsigned)};_e.shiftLeft=function(e){return Rn(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Vt(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):Vt(0,this.low<<e-32,this.unsigned)};_e.shl=_e.shiftLeft;_e.shiftRight=function(e){return Rn(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Vt(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):Vt(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};_e.shr=_e.shiftRight;_e.shiftRightUnsigned=function(e){if(Rn(e)&&(e=e.toInt()),e&=63,e===0)return this;var t=this.high;if(e<32){var n=this.low;return Vt(n>>>e|t<<32-e,t>>>e,this.unsigned)}else return e===32?Vt(t,0,this.unsigned):Vt(t>>>e-32,0,this.unsigned)};_e.shru=_e.shiftRightUnsigned;_e.shr_u=_e.shiftRightUnsigned;_e.toSigned=function(){return this.unsigned?Vt(this.low,this.high,!1):this};_e.toUnsigned=function(){return this.unsigned?this:Vt(this.low,this.high,!0)};_e.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};_e.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};_e.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};Gt.fromBytes=function(e,t,n){return n?Gt.fromBytesLE(e,t):Gt.fromBytesBE(e,t)};Gt.fromBytesLE=function(e,t){return new Gt(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)};Gt.fromBytesBE=function(e,t){return new Gt(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)}});var rC=Vr(rr=>{"use strict";var F=Xo();function dK(r){var e=Object.create(null);return r&&Object.keys(r).forEach(function(t){if(t!=="default"){var n=Object.getOwnPropertyDescriptor(r,t);Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:function(){return r[t]}})}}),e.default=r,e}function vK(r,e){return e.forEach(function(t){t&&typeof t!="string"&&!Array.isArray(t)&&Object.keys(t).forEach(function(n){if(n!=="default"&&!(n in r)){var a=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(r,n,a.get?a:{enumerable:!0,get:function(){return t[n]}})}})}),r}var A=dK(F),fm=function(r,e){return fm=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},fm(r,e)};function ie(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");fm(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Ie(r,e,t,n){function a(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function s(l){try{c(n.next(l))}catch(f){o(f)}}function u(l){try{c(n.throw(l))}catch(f){o(f)}}function c(l){l.done?i(l.value):a(l.value).then(s,u)}c((n=n.apply(r,e||[])).next())})}function Te(r,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(c){return function(l){return u([c,l])}}function u(c){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,a&&(i=c[0]&2?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[c[0]&2,i.value]),c[0]){case 0:case 1:i=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,a=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){t.label=c[1];break}if(c[0]===6&&t.label<i[1]){t.label=i[1],i=c;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(c);break}i[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(r,t)}catch(l){c=[6,l],a=0}finally{n=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function le(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function ee(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=n.next()).done;)i.push(a.value)}catch(s){o={error:s}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return i}function Xe(r,e,t){if(t||arguments.length===2)for(var n=0,a=e.length,i;n<a;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return r.concat(i||Array.prototype.slice.call(e))}var so=(function(r){ie(e,r);function e(t){var n=r.call(this,t)||this;return Object.setPrototypeOf(n,e.prototype),n}return e})(Error),fi=(function(r){ie(e,r);function e(t){var n=r.call(this,t)||this;return Object.setPrototypeOf(n,e.prototype),n}return e})(Error),Y=(function(r){ie(e,r);function e(t){var n=r.call(this,t)||this;return Object.setPrototypeOf(n,e.prototype),n}return e})(Error),ct=(function(r){ie(e,r);function e(t){var n=r.call(this,t)||this;return Object.setPrototypeOf(n,e.prototype),n}return e})(Error),mK=(function(r){ie(e,r);function e(t){var n=r.call(this,t)||this;return Object.setPrototypeOf(n,e.prototype),n}return e})(Error);(function(r){ie(e,r);function e(t){var n=r.call(this,t)||this;return Object.setPrototypeOf(n,e.prototype),n}return e})(Error);var pT=(function(){function r(e){this.maxEntries=e||100,this.cache=new Map}return r.prototype.get=function(e){var t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t},r.prototype.put=function(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){var n=this.cache.keys().next().value;this.cache.delete(n)}this.cache.set(e,t)},r.prototype.getMaxEntries=function(){return this.maxEntries},r.prototype.setMaxEntries=function(e){if(e<0)throw new Error("The maxEntries of LRU caches must be at least 0, but got ".concat(e,"."));if(this.maxEntries>e)for(var t=0;t<this.maxEntries-e;t++){var n=this.cache.keys().next().value;this.cache.delete(n)}this.maxEntries=e},r})();function rs(r,e){if(Array.isArray(r)){for(var t=[],n=0;n<e;n++)t=t.concat(r);return t}else{var t=new Array(e);return t.fill(r),t}}function ci(r,e){if(!r)throw new mK(e)}function fE(r,e){var t,n,a=0;try{for(var i=le(r),o=i.next();!o.done;o=i.next()){var s=o.value;s===e&&a++}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return a}function mn(r){return r.length===1?r[0]:r}function It(r){return Array.isArray(r)?r:[r]}function Fi(r){var e=r.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2"),t=e.replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return t[0]!=="_"?t:"private"+t}function Jo(r){return r.length<=1||r.indexOf("_")===-1?r:r.replace(/[_]+(\w|$)/g,function(e,t){return t.toUpperCase()})}var ya={};function Am(r){if(r==null)return null;var e={};return e.className=r.getClassName(),e.config=r.getConfig(),e}function hm(r){var e,t;if(!(r==null||typeof r!="object"))if(Array.isArray(r))r.forEach(function(u){return hm(u)});else{var n=Object.keys(r);try{for(var a=le(n),i=a.next();!i.done;i=a.next()){var o=i.value,s=r[o];s!=null&&typeof s=="object"&&(!Array.isArray(s)&&s.type==="ndarray"&&typeof s.value=="number"?r[o]=s.value:hm(s))}}catch(u){e={error:u}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}}}function cl(r,e,t,n,a){var i,o,s,u,c,l,f,h,p,d,m;if(e===void 0&&(e={}),t===void 0&&(t={}),n===void 0&&(n="object"),a===void 0&&(a=!1),typeof r=="string"){var v=r,g=void 0;if(v in t)g=t[v];else if(v in ya)g=ya[v];else if(g=e[v],g==null)throw new Y("Unknown ".concat(n,": ").concat(r,". ")+`This may be due to one of the following reasons:
`+"1. The ".concat(n," is defined in Python, in which ")+`case it needs to be ported to TensorFlow.js or your JavaScript code.
`+"2. The custom ".concat(n," is defined in JavaScript, ")+"but is not registered properly with tf.serialization.registerClass().");return g}else{var y=r;if(y.className==null||y.config==null)throw new Y("".concat(n,": Improper config format: ")+"".concat(JSON.stringify(y),`.
`)+"'className' and 'config' must set.");var w=y.className,b=void 0,x=void 0;if(w in t?(i=ee(t[w],2),b=i[0],x=i[1]):w in ya?(o=ee(ya.className,2),b=o[0],x=o[1]):w in e&&(s=ee(e[w],2),b=s[0],x=s[1]),b==null)throw new Y("Unknown ".concat(n,": ").concat(w,". ")+`This may be due to one of the following reasons:
`+"1. The ".concat(n," is defined in Python, in which ")+`case it needs to be ported to TensorFlow.js or your JavaScript code.
`+"2. The custom ".concat(n," is defined in JavaScript, ")+"but is not registered properly with tf.serialization.registerClass().");if(x!=null){var S={};try{for(var T=le(Object.keys(ya)),N=T.next();!N.done;N=T.next()){var C=N.value;S[C]=ya[C]}}catch(Z){u={error:Z}}finally{try{N&&!N.done&&(c=T.return)&&c.call(T)}finally{if(u)throw u.error}}try{for(var R=le(Object.keys(t)),_=R.next();!_.done;_=R.next()){var C=_.value;S[C]=t[C]}}catch(Z){l={error:Z}}finally{try{_&&!_.done&&(f=R.return)&&f.call(R)}finally{if(l)throw l.error}}var P=y.config;P.customObjects=S;var $=Object.assign({},ya);try{for(var z=le(Object.keys(t)),L=z.next();!L.done;L=z.next()){var C=L.value;ya[C]=t[C]}}catch(Z){h={error:Z}}finally{try{L&&!L.done&&(p=z.return)&&p.call(z)}finally{if(h)throw h.error}}hm(y.config);var B=x(b,y.config,t,a);return ya=Object.assign({},$),B}else{var $=Object.assign({},ya);try{for(var G=le(Object.keys(t)),X=G.next();!X.done;X=G.next()){var C=X.value;ya[C]=t[C]}}catch(j){d={error:j}}finally{try{X&&!X.done&&(m=G.return)&&m.call(G)}finally{if(d)throw d.error}}var B=new b(y.config);return ya=Object.assign({},$),B}}}function gK(r,e){return r<e?-1:r>e?1:0}function sh(r,e){return-1*gK(r,e)}function uo(r){var e,t;if(r==null)return r;var n=[];try{for(var a=le(r),i=a.next();!i.done;i=a.next()){var o=i.value;n.indexOf(o)===-1&&n.push(o)}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return n}function yK(r){if(r==null)throw new Y("Invalid value in obj: ".concat(JSON.stringify(r)));for(var e in r)if(r.hasOwnProperty(e))return!1;return!0}function as(r,e,t){if(t!=null&&r.indexOf(t)<0)throw new Y("".concat(t," is not a valid ").concat(e,".  Valid values are ").concat(r," or null/undefined."))}function Dm(r,e,t,n){return t===void 0&&(t=0),n===void 0&&(n=1/0),ci(t>=0),ci(n>=t),Array.isArray(r)&&r.length>=t&&r.length<=n&&r.every(function(a){return typeof a===e})}function Mr(r,e){Array.isArray(r)?(F.util.assert(r.length>0,function(){return"".concat(e," is unexpectedly an empty array.")}),r.forEach(function(t,n){return Mr(t,"element ".concat(n+1," of ").concat(e))})):F.util.assert(Number.isInteger(r)&&r>0,function(){return"Expected ".concat(e," to be a positive integer, but got ")+"".concat(dT(r),".")})}function dT(r){return r===null?"null":Array.isArray(r)?"["+r.map(function(e){return dT(e)}).join(",")+"]":typeof r=="string"?'"'.concat(r,'"'):"".concat(r)}function bK(r,e,t){var n=t!=null?t():F.util.now(),a,i=function(){for(var o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];var u=t!=null?t():F.util.now();return u-n<e||(n=u,a=r.apply(void 0,Xe([],ee(o),!1))),a};return i}function vT(r){return r==="relu"?"relu":r==="linear"?"linear":r==="elu"?"elu":null}var wK=0;function mT(){return wK++}var uh={};function Oh(r){return r===void 0&&(r=""),r in uh||(uh[r]=0),uh[r]+=1,r+uh[r].toString()}var xK=["channelsFirst","channelsLast"],kK=["nearest","bilinear"],SK=["valid","same","causal"],EK=["max","avg"],TK=["sum","mul","concat","ave"];var cu=new Map;function gr(r){as(xK,"DataFormat",r)}function NK(r){as(kK,"InterpolationFormat",r)}function ea(r){as(SK,"PaddingMode",r)}function gT(r){as(EK,"PoolMode",r)}var nl=[],hE="/";function es(r,e){nl.push(r);try{var t=e();return nl.pop(),t}catch(n){throw nl.pop(),n}}function IK(){return nl.length===0?"":nl.join(hE)+hE}function yT(r){if(!wT(r))throw new Error("Not a valid tensor name: '"+r+"'");return IK()+r}function bT(r){if(!wT(r))throw new Error("Not a valid tensor name: '"+r+"'");cu.has(r)||cu.set(r,0);var e=cu.get(r);if(cu.set(r,cu.get(r)+1),e>0){var t="".concat(r,"_").concat(e);return cu.set(t,1),t}else return r}var CK=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function wT(r){return!!r.match(CK)}function AK(r){return r===parseInt(r.toString(),10)}function co(r,e,t){e==null&&(e=0),t==null&&(t=r.length);for(var n=1,a=e;a<t;++a)n*=r[a];return n}function mu(r){if(r.length===0)return Number.NaN;for(var e=Number.POSITIVE_INFINITY,t=0;t<r.length;t++){var n=r[t];n<e&&(e=n)}return e}function lo(r){if(r.length===0)return Number.NaN;for(var e=Number.NEGATIVE_INFINITY,t=0;t<r.length;t++){var n=r[t];n>e&&(e=n)}return e}function Ka(r,e){if(e<r)throw new Y("end (".concat(e,") < begin (").concat(r,") is forbidden."));for(var t=[],n=r;n<e;++n)t.push(n);return t}var em;function Cr(){return em==null&&(em=F.backend().epsilon()),em}function ja(){return"channelsLast"}function hi(r,e){return A.cast(r,e)}function ll(r,e){e===void 0&&(e=-1);var t=r.shape.slice();return e<0&&(e=t.length+e+1),t.splice(e,0,1),A.reshape(r,t)}function DK(r,e){return F.tidy(function(){if(r.shape.length!==2)throw new Y("repeat() expects a rank-2 tensor, but received a "+"rank-".concat(r.shape.length," tensor."));var t=ll(r,1);return pm(t,[1,e,1])})}function _K(r){var e=[co(r.shape)];return A.reshape(r,e)}function FK(r){if(r.rank<=1)throw new Y("batchFlatten requires a minimum rank of 2. Got rank: ".concat(r.rank,"."));var e=[r.shape[0],co(r.shape,1)];return A.reshape(r,e)}function ts(r,e,t){return F.tidy(function(){switch(r.rank){case 1:return A.slice1d(r,e,t);case 2:return A.slice2d(r,[e,0],[t,r.shape[1]]);case 3:return A.slice3d(r,[e,0,0],[t,r.shape[1],r.shape[2]]);case 4:return A.slice4d(r,[e,0,0,0],[t,r.shape[1],r.shape[2],r.shape[3]]);case 5:return A.slice(r,[e,0,0,0,0],[t,r.shape[1],r.shape[2],r.shape[3],r.shape[4]]);case 6:return A.slice(r,[e,0,0,0,0,0],[t,r.shape[1],r.shape[2],r.shape[3],r.shape[4],r.shape[5]]);default:throw new Y("sliceAlongFirstAxis() received an unsupported tensor rank: "+"".concat(r.rank))}})}function tm(r,e,t){return F.tidy(function(){switch(r.rank){case 1:return A.slice1d(r,e,t);case 2:return A.slice2d(r,[0,e],[r.shape[0],t]);case 3:return A.slice3d(r,[0,0,e],[r.shape[0],r.shape[1],t]);case 4:return A.slice4d(r,[0,0,0,e],[r.shape[0],r.shape[1],r.shape[2],t]);default:throw new Y("sliceAlongLastAxis() received an unsupported tensor rank: "+"".concat(r.rank))}})}function ch(r,e,t,n){return F.tidy(function(){switch(r.rank){case 1:return A.slice1d(r,e,t);case 2:switch(n){case 1:return ts(r,e,t);case 2:return tm(r,e,t);default:throw new Y("The axis is not within the rank of the tensor "+"".concat(n))}case 3:switch(n){case 1:return ts(r,e,t);case 2:return A.slice3d(r,[0,e,0],[r.shape[0],t,r.shape[2]]);case 3:return tm(r,e,t);default:throw new Y("The axis is not within the rank of the tensor "+"".concat(n))}case 4:switch(n){case 1:return ts(r,e,t);case 2:return A.slice4d(r,[0,e,0,0],[r.shape[0],t,r.shape[2],r.shape[3]]);case 3:return A.slice4d(r,[0,0,e,0],[r.shape[0],r.shape[1],t,r.shape[3]]);case 4:return tm(r,e,t);default:throw new Y("The axis is not within the rank of the tensor "+"".concat(n))}default:throw new Y("sliceAlongLastAxis() received an unsupported tensor rank: "+"".concat(r.rank))}})}function _m(r,e){e===void 0&&(e=-1);var t;return e<0&&(t=r[0].rank,t!==0?e=t:e=0),e===r[0].rank&&(e=-1),A.concat(r,e)}function pE(r,e){switch(r.rank){case 1:return A.concat1d([r,e]);case 2:return A.concat2d([r,e],0);case 3:return A.concat3d([r,e],0);case 4:return A.concat4d([r,e],0);default:throw new Y("concatAlongFirstAxis() received an unsupported "+"tensor rank: ".concat(r.rank))}}function pm(r,e){if(Array.isArray(e)||(e=[e]),r.rank!==e.length)throw new Y("The length of input n (".concat(e.length,") does not match ")+"the number of dimensions in input x (".concat(r.rank,")"));return A.tile(r,e)}function Ph(r,e,t,n,a){return e===void 0&&(e=0),t===void 0&&(t=1),A.randomNormal(r,e,t,n,a)}function pi(r,e,t,n){if(r.rank<2||e.rank<2)throw new ct("dot requires both inputs to be rank >= 2"+" but got x shape = ".concat(r.shape," and y shape = ").concat(e.shape));if(e.rank>=3){var a=r.shape.slice(-1)[0],i=e.shape.slice(-2)[0];if(a!==i)throw new ct("If rank y >= 3, then the second last dim"+" of y must equal the last dim of x but got x shape = ".concat(r.shape," and ")+" y shape = ".concat(e.shape))}if(r.rank===2&&e.rank===2){var o=!1,s=!1;return A.fused.matMul({a:r,b:e,transposeA:o,transposeB:s,bias:n?dm(r.rank,n,ja()):null,activation:t})}else{var u=r.shape.slice(),c=u.pop();r=A.reshape(r,[-1,c]);var l=e.shape.slice(),f=l.pop(),i=l.pop(),h=Xe(Xe([],ee(l),!1),[f],!1),p=Array.from({length:e.rank},function(y,w){return w===0?e.rank-2:w<=e.rank-2?w-1:w});e=A.reshape(A.transpose(e,p),[i,-1]);var d=Xe(Xe([],ee(u),!1),ee(h),!1),o=!1,s=!1;return A.reshape(A.fused.matMul({a:r,b:e,transposeA:o,transposeB:s,bias:n?dm(r.rank,n,ja()):null,activation:t}),d)}}function xT(r,e,t){return F.tidy(function(){return Array.isArray(e)?e=F.tensor1d(e,"int32"):e=A.cast(e,"int32"),A.gather(r,e,t)})}function fl(r){return A.mul(r,r)}function dm(r,e,t){var n=e.shape;if(e.rank!==1&&e.rank!==r)throw new Y("Unexpected bias dimensions: ".concat(e.rank)+"; expected it to be 1 or ".concat(r));if(r===5){if(t==="channelsFirst")return n.length===1?A.reshape(e,[1,n[0],1,1,1]):A.reshape(e,[1,n[3],n[0],n[1],n[2]]);if(t==="channelsLast")return n.length===1?A.reshape(e,[1,1,1,1,n[0]]):A.reshape(e,[1].concat(n))}else if(r===4){if(t==="channelsFirst")return n.length===1?A.reshape(e,[1,n[0],1,1]):A.reshape(e,[1,n[2],n[0],n[1]]);if(t==="channelsLast")return n.length===1?A.reshape(e,[1,1,1,n[0]]):A.reshape(e,[1].concat(n))}else if(r===3){if(t==="channelsFirst")return n.length===1?A.reshape(e,[1,n[0],1]):A.reshape(e,[1,n[1],n[0]]);if(t==="channelsLast")return n.length===1?A.reshape(e,[1,1,n[0]]):A.reshape(e,[1].concat(n))}else if(r<3)return e;throw new Y("Unsupported input rank by biasAdd: ".concat(e.rank))}function Za(r,e,t){return F.tidy(function(){return t==null&&(t=ja()),gr(t),A.add(r,dm(r.rank,e,t))})}function RK(r,e){if(e===void 0&&(e=1),e!==1)throw new ct("Support for alpha values other than 1 (".concat(e,") is not implemented ")+"yet.");return A.elu(r)}function OK(r){return F.tidy(function(){return A.div(r,A.add(A.abs(r),1))})}function kT(r,e,t,n){return F.tidy(function(){return A.dropout(r,e,t,n)})}function PK(r){return F.tidy(function(){var e=A.add(.5,A.mul(.2,r));return A.clipByValue(e,0,1)})}function hl(r,e,t){return t===void 0&&(t=!1),t?r():e()}var MK=["fanIn","fanOut","fanAvg"],BK=["normal","uniform","truncatedNormal"];function LK(r){as(MK,"FanMode",r)}function zK(r){as(BK,"Distribution",r)}var Sa=(function(r){ie(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.fromConfigUsesCustomObjects=function(){return!1},e.prototype.getConfig=function(){return{}},e})(F.serialization.Serializable),Fm=(function(r){ie(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t,n){return F.zeros(t,n)},e})(Sa);Fm.className="Zeros";F.serialization.registerClass(Fm);var Mh=(function(r){ie(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t,n){return F.ones(t,n)},e})(Sa);Mh.className="Ones";F.serialization.registerClass(Mh);var Rm=(function(r){ie(e,r);function e(t){var n=r.call(this)||this;if(typeof t!="object")throw new Y("Expected argument of type ConstantConfig but got ".concat(t));if(t.value===void 0)throw new Y("config must have value set but got ".concat(t));return n.value=t.value,n}return e.prototype.apply=function(t,n){var a=this;return F.tidy(function(){return F.mul(F.scalar(a.value),F.ones(t,n))})},e.prototype.getConfig=function(){return{value:this.value}},e})(Sa);Rm.className="Constant";F.serialization.registerClass(Rm);var Om=(function(r){ie(e,r);function e(t){var n=r.call(this)||this;return n.DEFAULT_MINVAL=-.05,n.DEFAULT_MAXVAL=.05,n.minval=t.minval||n.DEFAULT_MINVAL,n.maxval=t.maxval||n.DEFAULT_MAXVAL,n.seed=t.seed,n}return e.prototype.apply=function(t,n){return F.randomUniform(t,this.minval,this.maxval,n,this.seed)},e.prototype.getConfig=function(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}},e})(Sa);Om.className="RandomUniform";F.serialization.registerClass(Om);var Pm=(function(r){ie(e,r);function e(t){var n=r.call(this)||this;return n.DEFAULT_MEAN=0,n.DEFAULT_STDDEV=.05,n.mean=t.mean||n.DEFAULT_MEAN,n.stddev=t.stddev||n.DEFAULT_STDDEV,n.seed=t.seed,n}return e.prototype.apply=function(t,n){if(n=n||"float32",n!=="float32"&&n!=="int32")throw new ct("randomNormal does not support dType ".concat(n,"."));return Ph(t,this.mean,this.stddev,n,this.seed)},e.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},e})(Sa);Pm.className="RandomNormal";F.serialization.registerClass(Pm);var Mm=(function(r){ie(e,r);function e(t){var n=r.call(this)||this;return n.DEFAULT_MEAN=0,n.DEFAULT_STDDEV=.05,n.mean=t.mean||n.DEFAULT_MEAN,n.stddev=t.stddev||n.DEFAULT_STDDEV,n.seed=t.seed,n}return e.prototype.apply=function(t,n){if(n=n||"float32",n!=="float32"&&n!=="int32")throw new ct("truncatedNormal does not support dType ".concat(n,"."));return F.truncatedNormal(t,this.mean,this.stddev,n,this.seed)},e.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},e})(Sa);Mm.className="TruncatedNormal";F.serialization.registerClass(Mm);var Bm=(function(r){ie(e,r);function e(t){var n=r.call(this)||this;return n.gain=t.gain!=null?t.gain:1,n}return e.prototype.apply=function(t,n){var a=this;return F.tidy(function(){if(t.length!==2||t[0]!==t[1])throw new Y("Identity matrix initializer can only be used for 2D square matrices.");return F.mul(a.gain,F.eye(t[0]))})},e.prototype.getConfig=function(){return{gain:this.gain}},e})(Sa);Bm.className="Identity";F.serialization.registerClass(Bm);function $K(r,e){e===void 0&&(e="channelsLast");var t,n;if(gr(e),r.length===2)t=r[0],n=r[1];else if([3,4,5].indexOf(r.length)!==-1){if(e==="channelsFirst"){var a=co(r,2);t=r[1]*a,n=r[0]*a}else if(e==="channelsLast"){var a=co(r,0,r.length-2);t=r[r.length-2]*a,n=r[r.length-1]*a}}else{var i=co(r);t=Math.sqrt(i),n=Math.sqrt(i)}return[t,n]}var gn=(function(r){ie(e,r);function e(t){var n=r.call(this)||this;if(t.scale<0)throw new Y("scale must be a positive float. Got: ".concat(t.scale));return n.scale=t.scale==null?1:t.scale,n.mode=t.mode==null?"fanIn":t.mode,LK(n.mode),n.distribution=t.distribution==null?"normal":t.distribution,zK(n.distribution),n.seed=t.seed,n}return e.prototype.apply=function(t,n){var a=$K(t),i=a[0],o=a[1],s=this.scale;if(this.mode==="fanIn"?s/=Math.max(1,i):this.mode==="fanOut"?s/=Math.max(1,o):s/=Math.max(1,(i+o)/2),this.distribution==="normal"){var u=Math.sqrt(s);if(n=n||"float32",n!=="float32"&&n!=="int32")throw new ct("".concat(this.getClassName()," does not support dType ").concat(n,"."));return F.truncatedNormal(t,0,u,n,this.seed)}else{var c=Math.sqrt(3*s);return F.randomUniform(t,-c,c,n,this.seed)}},e.prototype.getConfig=function(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}},e})(Sa);gn.className="VarianceScaling";F.serialization.registerClass(gn);var Bh=(function(r){ie(e,r);function e(t){return r.call(this,{scale:1,mode:"fanAvg",distribution:"uniform",seed:t==null?null:t.seed})||this}return e.prototype.getClassName=function(){return gn.className},e})(gn);Bh.className="GlorotUniform";F.serialization.registerClass(Bh);var Lh=(function(r){ie(e,r);function e(t){return r.call(this,{scale:1,mode:"fanAvg",distribution:"normal",seed:t==null?null:t.seed})||this}return e.prototype.getClassName=function(){return gn.className},e})(gn);Lh.className="GlorotNormal";F.serialization.registerClass(Lh);var zh=(function(r){ie(e,r);function e(t){return r.call(this,{scale:2,mode:"fanIn",distribution:"normal",seed:t==null?null:t.seed})||this}return e.prototype.getClassName=function(){return gn.className},e})(gn);zh.className="HeNormal";F.serialization.registerClass(zh);var $h=(function(r){ie(e,r);function e(t){return r.call(this,{scale:2,mode:"fanIn",distribution:"uniform",seed:t==null?null:t.seed})||this}return e.prototype.getClassName=function(){return gn.className},e})(gn);$h.className="HeUniform";F.serialization.registerClass($h);var Wh=(function(r){ie(e,r);function e(t){return r.call(this,{scale:1,mode:"fanIn",distribution:"normal",seed:t==null?null:t.seed})||this}return e.prototype.getClassName=function(){return gn.className},e})(gn);Wh.className="LeCunNormal";F.serialization.registerClass(Wh);var Gh=(function(r){ie(e,r);function e(t){return r.call(this,{scale:1,mode:"fanIn",distribution:"uniform",seed:t==null?null:t.seed})||this}return e.prototype.getClassName=function(){return gn.className},e})(gn);Gh.className="LeCunUniform";F.serialization.registerClass(Gh);var Lm=(function(r){ie(e,r);function e(t){var n=r.call(this)||this;return n.DEFAULT_GAIN=1,n.ELEMENTS_WARN_SLOW=2e3,n.gain=t.gain==null?n.DEFAULT_GAIN:t.gain,n.seed=t.seed,n}return e.prototype.apply=function(t,n){var a=this;return F.tidy(function(){if(t.length<2)throw new ct("Shape must be at least 2D.");if(n!=="int32"&&n!=="float32"&&n!==void 0)throw new TypeError("Unsupported data type ".concat(n,"."));n=n;var i=F.util.sizeFromShape(t.slice(0,-1)),o=t[t.length-1],s=i*o;s>a.ELEMENTS_WARN_SLOW&&console.warn("Orthogonal initializer is being called on a matrix with more "+"than ".concat(a.ELEMENTS_WARN_SLOW," (").concat(s,") elements: ")+"Slowness may result.");var u=[Math.max(o,i),Math.min(o,i)],c=Ph(u,0,1,n,a.seed),l=F.linalg.qr(c,!1),f=l[0],h=l[1],p=h.flatten().stridedSlice([0],[Math.min(o,i)*Math.min(o,i)],[Math.min(o,i)+1]);return f=F.mul(f,p.sign()),i<o&&(f=f.transpose()),F.mul(F.scalar(a.gain),f.reshape(t))})},e.prototype.getConfig=function(){return{gain:this.gain,seed:this.seed}},e})(Sa);Lm.className="Orthogonal";F.serialization.registerClass(Lm);var dE={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function vE(r,e){return e===void 0&&(e={}),cl(r,F.serialization.SerializationMap.getMap().classNameMap,e,"initializer")}function sr(r){return Am(r)}function Qt(r){if(typeof r=="string"){var e=r in dE?dE[r]:r;if(e==="GlorotNormal")return new Lh;if(e==="GlorotUniform")return new Bh;if(e==="HeNormal")return new zh;if(e==="HeUniform")return new $h;if(e==="LeCunNormal")return new Wh;if(e==="LeCunUniform")return new Gh;var t={};return t.className=e,t.config={},vE(t)}else return r instanceof Sa?r:vE(r)}function vm(r){return Array.isArray(r)&&Array.isArray(r[0])}function mh(r){return r.length===0?[]:Array.isArray(r[0])?r:[r]}function tt(r){var e;if(Array.isArray(r)){if(r.length!==1)throw new Y("Expected Tensor length to be 1; got ".concat(r.length));e=r[0]}else e=r;return e}function wt(r){if(Array.isArray(r)&&Array.isArray(r[0])){if(r.length===1)return r=r,r[0];throw new Y("Expected exactly 1 Shape; got ".concat(r.length))}else return r}function gh(r){var e,t,n=0;try{for(var a=le(r),i=a.next();!i.done;i=a.next()){var o=i.value;o.shape.length===0?n+=1:n+=o.shape.reduce(function(s,u){return s*u})}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return n}var mE="Variable",ST=(function(){function r(e,t,n,a,i){t===void 0&&(t="float32"),n===void 0&&(n=mE),a===void 0&&(a=!0),i===void 0&&(i=null),this.dtype=t??"float32",this.shape=e.shape,this.id=mT(),n=n??mE,this.originalName=yT(n),this.name=bT(this.originalName),this.trainable_=a,this.constraint=i,this.val=A.variable(e,this.trainable_,this.name,this.dtype)}return r.prototype.read=function(){return this.assertNotDisposed(),this.val},r.prototype.write=function(e){return this.assertNotDisposed(),WK(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this},r.prototype.dispose=function(){this.assertNotDisposed(),this.val.dispose()},r.prototype.assertNotDisposed=function(){if(this.val.isDisposed)throw new Error("LayersVariable ".concat(this.name," is already disposed."))},Object.defineProperty(r.prototype,"trainable",{get:function(){return this.trainable_},set:function(e){this.trainable_=e,this.val.trainable=e},enumerable:!1,configurable:!0}),r})();function WK(r,e){if(r.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(r.shape)+" vs. "+JSON.stringify(e.shape))}function mm(r){return r.map(function(e){return e.read()})}function zm(r){r.forEach(function(e){var t=e[0];t.write(e[1])})}var Nr=(function(){function r(e){this.dtype=e.dtype,this.shape=e.shape,e.shape!=null?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}return r})(),Xa=(function(){function r(e,t,n,a,i,o,s){this.dtype=e,this.shape=t,this.sourceLayer=n,this.inputs=a,this.callArgs=i,this.outputTensorIndex=s,this.id=mT(),o!=null&&(this.originalName=yT(o),this.name=bT(this.originalName)),this.rank=t.length}return r})(),GK=0,Vh=(function(){function r(e,t){var n,a;this.callArgs=t,this.id=GK++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;try{for(var i=le(e.inboundLayers),o=i.next();!o.done;o=i.next()){var s=o.value;s?.outboundNodes.push(this)}}catch(u){n={error:u}}finally{try{o&&!o.done&&(a=i.return)&&a.call(i)}finally{if(n)throw n.error}}e.outboundLayer.inboundNodes.push(this)}return r.prototype.getConfig=function(){var e,t,n=[];try{for(var a=le(this.inboundLayers),i=a.next();!i.done;i=a.next()){var o=i.value;o!=null?n.push(o.name):n.push(null)}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:n,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}},r})(),VK=0,lt=(function(r){ie(e,r);function e(t){t===void 0&&(t={});var n=r.call(this)||this;n._callHook=null,n._addedWeightNames=[],n._stateful=!1,n.id=VK++,n.activityRegularizer=null,n.inputSpec=null,n.supportsMasking=!1,n._trainableWeights=[],n._nonTrainableWeights=[],n._losses=[],n._updates=[],n._built=!1,n.inboundNodes=[],n.outboundNodes=[];var a=t.name;if(!a){var i=n.getClassName();a=Fi(i)+"_"+Oh(i)}if(n.name=a,n.trainable_=t.trainable==null?!0:t.trainable,t.inputShape!=null||t.batchInputShape!=null){var o=void 0;if(t.batchInputShape!=null)o=t.batchInputShape;else if(t.inputShape!=null){var s=null;t.batchSize!=null&&(s=t.batchSize),o=[s].concat(t.inputShape)}n.batchInputShape=o;var u=t.dtype;u==null&&(u=t.inputDType),u==null&&(u="float32"),n.dtype=u}return t.weights!=null?n.initialWeights=t.weights:n.initialWeights=null,n._refCount=null,n.fastWeightInitDuringBuild=!1,n}return e.nodeKey=function(t,n){return t.name+"_ib-"+n.toString()},e.prototype.getNodeAtIndex=function(t,n){if(this.inboundNodes.length===0)throw new fi("The layer has never been called "+"and thus has no defined ".concat(n,"."));if(this.inboundNodes.length<=t)throw new Y("Asked to get ".concat(n," at node ").concat(t,", ")+"but the layer has only ".concat(this.inboundNodes.length," inbound nodes."));return this.inboundNodes[t]},e.prototype.getInputAt=function(t){return mn(this.getNodeAtIndex(t,"input").inputTensors)},e.prototype.getOutputAt=function(t){return mn(this.getNodeAtIndex(t,"output").outputTensors)},Object.defineProperty(e.prototype,"input",{get:function(){if(this.inboundNodes.length>1)throw new so("Layer ".concat(this.name)+' has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use `getInputAt(nodeIndex)` instead.');if(this.inboundNodes.length===0)throw new so("Layer ".concat(this.name)+" is not connected, no input to return.");return mn(this.getNodeAtIndex(0,"input").inputTensors)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"output",{get:function(){if(this.inboundNodes.length===0)throw new so("Layer ".concat(this.name)+" has no inbound nodes.");if(this.inboundNodes.length>1)throw new so("Layer ".concat(this.name)+' has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use `getOutputAt(nodeIndex)` instead.');return mn(this.getNodeAtIndex(0,"output").outputTensors)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"losses",{get:function(){return this._losses},enumerable:!1,configurable:!0}),e.prototype.calculateLosses=function(){return this.losses.map(function(t){return t()})},Object.defineProperty(e.prototype,"updates",{get:function(){return this._updates},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"built",{get:function(){return this._built},set:function(t){this._built=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"trainable",{get:function(){return this.trainable_},set:function(t){this._trainableWeights.forEach(function(n){return n.trainable=t}),this.trainable_=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.trainable_?this._trainableWeights.filter(function(t){return t.trainable}):[]},set:function(t){this._trainableWeights=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this._trainableWeights.filter(function(t){return!t.trainable}).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)},set:function(t){this._nonTrainableWeights=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stateful",{get:function(){return this._stateful},enumerable:!1,configurable:!0}),e.prototype.resetStates=function(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")},e.prototype.assertInputCompatibility=function(t){var n=It(t);if(!(this.inputSpec==null||this.inputSpec.length===0)){var a=It(this.inputSpec);if(n.length!==a.length)throw new Y("Layer ".concat(this.name," expects ").concat(a.length," inputs, ")+"but it received ".concat(n.length," input tensors. ")+"Input received: ".concat(t));for(var i=0;i<n.length;i++){var o=n[i],s=a[i];if(s!=null){var u=o.rank;if(s.ndim!=null&&u!==s.ndim)throw new Y("Input ".concat(i," is incompatible with layer ").concat(this.name,": ")+"expected ndim=".concat(s.ndim,", found ndim=").concat(u));if(s.maxNDim!=null&&u>s.maxNDim)throw new Y("Input ".concat(i," is incompatible with layer ").concat(this.name)+": expected max_ndim=".concat(s.maxNDim,", found ndim=").concat(u));if(s.minNDim!=null&&u<s.minNDim)throw new Y("Input ".concat(i," is incompatible with layer ").concat(this.name)+": expected min_ndim=".concat(s.minNDim,", found ndim=").concat(u,"."));if(s.dtype!=null&&o.dtype!==s.dtype)throw new Y("Input ".concat(i," is incompatible with layer ").concat(this.name," ")+": expected dtype=".concat(s.dtype,", found dtype=").concat(o.dtype,"."));if(s.axes){var c=o.shape;for(var l in s.axes){var f=Number(l),h=s.axes[l],p=f>=0?c[f]:c[c.length+f];if(h!=null&&[h,null].indexOf(p)===-1)throw new Y("Input ".concat(i," is incompatible with layer ")+"".concat(this.name,": expected axis ").concat(f," of input shape to ")+"have value ".concat(h," but got shape ").concat(c,"."))}}if(s.shape!=null)for(var d=0;d<s.shape.length;++d){var m=s.shape[d],v=o.shape[d];if(m!=null&&v!=null&&m!==v)throw new Y("Input ".concat(i," is incompatible with layer ")+"".concat(this.name,": expected shape=").concat(s.shape,", ")+"found shape=".concat(o.shape,"."))}}}}},e.prototype.call=function(t,n){return t},e.prototype.invokeCallHook=function(t,n){this._callHook!=null&&this._callHook(t,n)},e.prototype.setCallHook=function(t){this._callHook=t},e.prototype.clearCallHook=function(){this._callHook=null},e.prototype.apply=function(t,n){var a=this;n=n||{},this.assertNotDisposed();var i=It(t),o=qK(t),s=KK(t);if(o===s)throw new Y("Arguments to apply() must be all SymbolicTensors or all Tensors");return es(this.name,function(){var u,c,l,f;if(!a.built){a.assertInputCompatibility(t);var h=[];try{for(var p=le(It(t)),d=p.next();!d.done;d=p.next()){var m=d.value;h.push(m.shape)}}catch(C){u={error:C}}finally{try{d&&!d.done&&(c=p.return)&&c.call(p)}finally{if(u)throw u.error}}a.build(mn(h)),a.built=!0,a.initialWeights&&a.setWeights(a.initialWeights),a._refCount===null&&s&&(a._refCount=1)}if(a.assertInputCompatibility(t),s){var v=a.call(t,n);a.supportsMasking&&a.setMaskMetadata(t,v);var g=It(v),y=[];try{for(var w=le(g),b=w.next();!b.done;b=w.next()){var x=b.value;i.indexOf(x)!==-1&&(x=x.clone()),y.push(x)}}catch(C){l={error:C}}finally{try{b&&!b.done&&(f=w.return)&&f.call(w)}finally{if(l)throw l.error}}if(v=mn(y),a.activityRegularizer!=null)throw new ct("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return v}else{var S=UK(t),T=a.computeOutputShape(S),v=void 0,N=HK(t);if(a.warnOnIncompatibleInputShape(Array.isArray(t)?S[0]:S),T!=null&&T.length>0&&Array.isArray(T[0])?v=T.map(function(R,_){return new Xa(N,R,a,It(t),n,a.name,_)}):v=new Xa(N,T,a,It(t),n,a.name),a.addInboundNode(t,v,null,null,S,T,n),a._refCount++,a.activityRegularizer!=null)throw new ct("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return v}})},e.prototype.warnOnIncompatibleInputShape=function(t){if(this.batchInputShape!=null)if(t.length!==this.batchInputShape.length)console.warn("The rank of the input tensor provided (shape: "+"".concat(JSON.stringify(t),") does not match that of the ")+"batchInputShape (".concat(JSON.stringify(this.batchInputShape),") ")+"of the layer ".concat(this.name));else{var n=!1;this.batchInputShape.forEach(function(a,i){a!=null&&t[i]!=null&&t[i]!==a&&(n=!0)}),n&&console.warn("The shape of the input tensor "+"(".concat(JSON.stringify(t),") does not ")+"match the expectation of layer ".concat(this.name,": ")+"".concat(JSON.stringify(this.batchInputShape)))}},Object.defineProperty(e.prototype,"outputShape",{get:function(){var t,n;if(this.inboundNodes==null||this.inboundNodes.length===0)throw new so("The layer ".concat(this.name," has never been called and thus has no ")+"defined output shape.");var a=[];try{for(var i=le(this.inboundNodes),o=i.next();!o.done;o=i.next()){var s=o.value,u=JSON.stringify(s.outputShapes);a.indexOf(u)===-1&&a.push(u)}}catch(l){t={error:l}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}if(a.length===1){var c=this.inboundNodes[0].outputShapes;return Array.isArray(c)&&Array.isArray(c[0])&&c.length===1?c[0]:c}else throw new so("The layer ".concat(this.name," has multiple inbound nodes with different ")+'output shapes. Hence the notion of "output shape" is ill-defined for the layer.')},enumerable:!1,configurable:!0}),e.prototype.countParams=function(){if(!this.built)throw new fi("You tried to call countParams() on ".concat(this.name,", ")+"but the layer is not built yet. Build it first by calling build(batchInputShape).");return gh(this.weights)},e.prototype.build=function(t){this.built=!0},e.prototype.getWeights=function(t){return t===void 0&&(t=!1),mm(t?this.trainableWeights:this.weights)},e.prototype.setWeights=function(t){var n=this;F.tidy(function(){var a=n.weights;if(a.length!==t.length)throw new Y('You called setWeights(weights) on layer "'.concat(n.name,'" ')+"with a weight list of length ".concat(t.length,", ")+"but the layer was expecting ".concat(a.length," weights. ")+"Provided weights: ".concat(t,"..."));if(a.length!==0){for(var i=[],o=mm(a),s=0;s<o.length;++s){var u=o[s],c=a[s],l=t[s];if(!F.util.arraysEqual(u.shape,l.shape))throw new Y("Layer weight shape ".concat(u.shape," ")+"not compatible with provided weight shape ".concat(l.shape));i.push([c,l])}zm(i)}})},e.prototype.addWeight=function(t,n,a,i,o,s,u,c){if(this._addedWeightNames.indexOf(t)!==-1)throw new Y("Duplicate weight name ".concat(t," for layer ").concat(this.name));this._addedWeightNames.push(t),a==null&&(a="float32"),this.fastWeightInitDuringBuild&&(i=c!=null?c():Qt("zeros"));var l=i.apply(n,a),f=new ST(l,a,t,s,u);return l.dispose(),o!=null&&this.addLoss(function(){return o.apply(f.read())}),s==null&&(s=!0),s?this._trainableWeights.push(f):this._nonTrainableWeights.push(f),f},e.prototype.setFastWeightInitDuringBuild=function(t){this.fastWeightInitDuringBuild=t},e.prototype.addLoss=function(t){var n;t==null||Array.isArray(t)&&t.length===0||(t=It(t),this._losses!==void 0&&this._losses!==null&&(n=this.losses).push.apply(n,Xe([],ee(t),!1)))},e.prototype.computeOutputShape=function(t){return t},e.prototype.computeMask=function(t,n){var a=this;if(!this.supportsMasking){if(n!=null)if(Array.isArray(n))n.forEach(function(i){if(i!=null)throw new TypeError("Layer ".concat(a.name," does not support masking, ")+"but was passed an inputMask.")});else throw new TypeError("Layer ".concat(this.name," does not support masking, ")+"but was passed an inputMask.");return null}return n},e.prototype.setMaskMetadata=function(t,n,a){if(this.supportsMasking){var i=this.computeMask(t,a),o=It(n),s=It(i);if(o.length!==s.length)throw new Error("".concat(this.name," outputs ").concat(o.length," tensors ")+"but ".concat(o.length," masks for those tensors"));for(var u=0;u<o.length;u++)o[u].kerasMask=s[u]}},e.prototype.addInboundNode=function(t,n,a,i,o,s,u){var c,l;u===void 0&&(u=null);var f=It(t);n=It(n),a=It(a),i=It(i),o=mh(o),s=mh(s);var h=[],p=[],d=[];try{for(var m=le(f),v=m.next();!v.done;v=m.next()){var g=v.value;h.push(g.sourceLayer),p.push(g.nodeIndex),d.push(g.tensorIndex)}}catch(w){c={error:w}}finally{try{v&&!v.done&&(l=m.return)&&l.call(m)}finally{if(c)throw c.error}}new Vh({outboundLayer:this,inboundLayers:h,nodeIndices:p,tensorIndices:d,inputTensors:f,outputTensors:n,inputMasks:a,outputMasks:i,inputShapes:o,outputShapes:s},u);for(var y=0;y<n.length;y++)n[y].sourceLayer=this,n[y].nodeIndex=this.inboundNodes.length-1,n[y].tensorIndex=y},e.prototype.getConfig=function(){var t={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(t.batchInputShape=this.batchInputShape),this.dtype!=null&&(t.dtype=this.dtype),t},e.prototype.disposeWeights=function(){return this.weights.forEach(function(t){return t.dispose()}),this.weights.length},e.prototype.assertNotDisposed=function(){if(this._refCount===0)throw new Error("Layer '".concat(this.name,"' is already disposed."))},e.prototype.dispose=function(){if(!this.built)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been ")+"built yet.");if(this._refCount===null)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been used ")+"yet.");this.assertNotDisposed();var t=0;return--this._refCount===0&&(t=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:t}},e})(F.serialization.Serializable);function UK(r){var e,t;r=It(r);var n=[];try{for(var a=le(r),i=a.next();!i.done;i=a.next()){var o=i.value;n.push(o.shape)}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return mn(n)}function HK(r){return"float32"}function ET(r,e,t){var n,a;if((e==null||t!=null&&t>0)&&(e=r.sourceLayer,t=r.nodeIndex),e.inboundNodes.length===0)return[r];var i=e.inboundNodes[t];if(i.inboundLayers.length===0)return i.inputTensors;for(var o=[],s=0;s<i.inboundLayers.length;s++){var u=i.inputTensors[s],c=i.inboundLayers[s],l=i.nodeIndices[s],f=ET(u,c,l);try{for(var h=(n=void 0,le(f)),p=h.next();!p.done;p=h.next()){var d=p.value;o.indexOf(d)===-1&&o.push(d)}}catch(m){n={error:m}}finally{try{p&&!p.done&&(a=h.return)&&a.call(h)}finally{if(n)throw n.error}}}return o}function qK(r){var e,t,n=!0;try{for(var a=le(It(r)),i=a.next();!i.done;i=a.next()){var o=i.value;if(!(o instanceof Xa)){n=!1;break}}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return n}function KK(r){var e,t,n=!0;try{for(var a=le(It(r)),i=a.next();!i.done;i=a.next()){var o=i.value;if(o instanceof Xa){n=!1;break}}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return n}var wu=(function(r){ie(e,r);function e(t){var n=r.call(this,{dtype:t.dtype,name:t.name!=null?t.name:Oh("input").toString()})||this;if(t.batchSize==null&&(t.batchSize=null),t.sparse==null&&(t.sparse=!1),n.trainable=!1,n.built=!0,n.sparse=t.sparse,t.inputShape!=null&&t.batchInputShape!=null)throw new Y("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");var a=t.batchInputShape;if(a==null){if(t.inputShape==null)throw new Y("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");a=[t.batchSize].concat(t.inputShape)}else if(t.batchSize!=null)throw new Y("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");var i=t.dtype||"float32";n.batchInputShape=a,n.dtype=i,n.inputSpec=[{shape:a}];var o=new Xa(n.dtype,n.batchInputShape,n,[],{},n.name);return o.nodeIndex=0,o.tensorIndex=0,new Vh({outboundLayer:n,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[o],outputTensors:[o],inputMasks:[null],outputMasks:[null],inputShapes:[a],outputShapes:[a]}),n}return e.prototype.apply=function(t,n){throw new Y("Cannot pass any input to an "+"InputLayer's apply() method. InputLayer name: ".concat(this.name))},e.prototype.dispose=function(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}},e.prototype.getConfig=function(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}},e})(lt);wu.className="InputLayer";F.serialization.registerClass(wu);function TT(r){if(r.batchShape==null&&r.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(r.batchShape!=null&&r.shape!=null)throw new Y("Please provide either a `shape` or `batchShape` argument to Input, but not both.");var e=r.batchShape;r.shape!=null&&e==null&&(e=[null].concat(r.shape));var t=r.dtype;t==null&&(t="float32");var n=new wu({batchInputShape:e,name:r.name,dtype:t,sparse:r.sparse}),a=n.inboundNodes[0].outputTensors;return a[0]}function jK(r,e){if(r.dtype==null||r.dtype===e.dtype)return e;try{return F.cast(e,r.dtype)}catch{throw new Y("The dtype of the feed (".concat(e.dtype,") can not be cast to the dtype ")+"of the key '".concat(r.name,"' (").concat(r.dtype,")."))}}var hu=(function(){function r(e){var t,n;if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof r)for(var a in e.id2Value)this.id2Value[a]=e.id2Value[a],a in e.id2Mask&&(this.id2Mask[a]=e.id2Mask[a]);else{if(e==null)return;try{for(var i=le(e),o=i.next();!o.done;o=i.next()){var s=o.value;this.add(s.key,s.value)}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}}}return r.prototype.add=function(e,t,n){if(this.id2Value[e.id]==null)this.id2Value[e.id]=jK(e,t),this.name2Id[e.name]=e.id,n!=null&&(this.id2Mask[e.id]=n);else throw new Y("Duplicate key: name=".concat(e.name,", id=").concat(e.id));return this},r.prototype.addFeed=function(e){this.add(e.key,e.value)},r.prototype.hasKey=function(e){return this.id2Value[e.id]!=null},r.prototype.names=function(){return Object.keys(this.name2Id)},r.prototype.getValue=function(e){if(e instanceof Xa){if(this.id2Value[e.id]==null)throw new Y("Nonexistent key: ".concat(e.name));return this.id2Value[e.id]}else{var t=this.name2Id[e];if(t==null)throw new Y("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Value[t]}},r.prototype.getMask=function(e){if(e instanceof Xa){if(this.id2Value[e.id]==null)throw new Y("Nonexistent key: ".concat(e.name));return this.id2Mask[e.id]}else{var t=this.name2Id[e];if(t==null)throw new Y("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Mask[t]}},r.prototype.disposeMasks=function(){this.id2Mask!=null&&F.dispose(this.id2Mask)},r})(),yh=new pT,bh=new pT;function XK(r){yh?.setMaxEntries(r),bh?.setMaxEntries(r)}function Qc(r,e,t,n){var a,i,o,s,u=t==null?!1:t.training,c=Array.isArray(r),l=c?r:[r],f=l.map(function(ce){return ce.name}),h=[],p=e.names();try{for(var d=le(f),m=d.next();!m.done;m=d.next()){var v=m.value;p.indexOf(v)!==-1?h.push(e.getValue(v)):h.push(null)}}catch(ce){a={error:ce}}finally{try{m&&!m.done&&(i=d.return)&&i.call(d)}finally{if(a)throw a.error}}n!=null&&(n.maxNumTensors=-1/0,n.minNumTensors=1/0);var g=f.join(",")+"|"+e.names().sort().join(","),y=yh.get(g),w;if(y==null){var b=YK(l,e);y=b.sorted,w=b.recipientCounts,yh.put(g,y),bh.put(g,w)}w={},u||Object.assign(w,bh.get(g));for(var x=new hu(e),S=0;S<y.length;++S){if(n!=null){var T=F.memory().numTensors;T>n.maxNumTensors&&(n.maxNumTensors=T),T<n.minNumTensors&&(n.minNumTensors=T)}var N=y[S],C=N.sourceLayer;if(!(C instanceof wu)){var R=[],_=[],P=[],$=!1;try{for(var z=(o=void 0,le(N.inputs)),L=z.next();!L.done;L=z.next()){var B=L.value,G=x.getValue(B),X=x.getMask(B);R.push(G),_.push(X),X!=null&&($=!0),u||(w[B.name]--,w[B.name]===0&&!e.hasKey(B)&&f.indexOf(B.name)===-1&&!G.isDisposed&&B.sourceLayer.stateful!==!0&&P.push(G))}}catch(ce){o={error:ce}}finally{try{L&&!L.done&&(s=z.return)&&s.call(z)}finally{if(o)throw o.error}}$&&(t=t||{},t.mask=_[0]);var Z=It(C.apply(R,t)),V=null;C.supportsMasking&&(V=C.computeMask(R,_));for(var j=JK(N),re=Array.isArray(j)?j:[j],te=0;te<re.length;++te){x.hasKey(re[te])||x.add(re[te],Z[te],Array.isArray(V)?V[0]:V);var oe=f.indexOf(re[te].name);oe!==-1&&(h[oe]=Z[te])}u||F.dispose(P)}}return x.disposeMasks(),c?h:h[0]}function YK(r,e){var t,n,a,i;F.util.assert(r!=null&&r.length>0,function(){return"Expected at least one fetch, got none"});var o=[],s={};if(r.length===1){var u=gE(r[0],e);o=u.sorted,s=u.recipientMap}else{var c=new Set;try{for(var l=le(r),f=l.next();!f.done;f=l.next()){var h=f.value,p=gE(h,e),d=p.sorted,m=p.recipientMap;try{for(var v=(a=void 0,le(d)),g=v.next();!g.done;g=v.next()){var y=g.value;c.has(y.name)||(o.push(y),c.add(y.name))}}catch(x){a={error:x}}finally{try{g&&!g.done&&(i=v.return)&&i.call(v)}finally{if(a)throw a.error}}var w=function(x){s[x]==null&&(s[x]=new Set),m[x].forEach(function(S){return s[x].add(S)})};for(var b in m)w(b)}}catch(x){t={error:x}}finally{try{f&&!f.done&&(n=l.return)&&n.call(l)}finally{if(t)throw t.error}}}return{sorted:o,recipientCounts:ZK(s)}}function ZK(r){var e={};for(var t in r)e[t]=r[t].size;return e}function gE(r,e){var t,n,a,i,o=new Set,s=[],u={};try{for(var c=le(e.names()),l=c.next();!l.done;l=c.next()){var f=l.value;o.add(f)}}catch(w){t={error:w}}finally{try{l&&!l.done&&(n=c.return)&&n.call(c)}finally{if(t)throw t.error}}var h=[],p=[];for(h.push(r);h.length>0;){var d=h[h.length-1];if(o.has(d.name)){h.pop();continue}var m=p[p.length-1]===h.length-1;if(d.inputs.length===0||m)h.pop(),s.push(d),o.add(d.name),m&&p.pop();else{p.push(h.length-1);try{for(var v=(a=void 0,le(d.inputs)),g=v.next();!g.done;g=v.next()){var y=g.value;u[y.name]==null&&(u[y.name]=new Set),u[y.name].add(d.name),!o.has(y.name)&&h.push(y)}}catch(w){a={error:w}}finally{try{g&&!g.done&&(i=v.return)&&i.call(v)}finally{if(a)throw a.error}}}}return{sorted:s,recipientMap:u}}function JK(r){var e,t,n;if(r.sourceLayer.inboundNodes.length===1)n=r.sourceLayer.output;else{for(var a=null,i=0;i<r.sourceLayer.inboundNodes.length;++i)try{for(var o=(e=void 0,le(r.sourceLayer.inboundNodes[i].outputTensors)),s=o.next();!s.done;s=o.next()){var u=s.value;if(u.id===r.id){a=i;break}}}catch(c){e={error:c}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}n=r.sourceLayer.getOutputAt(a)}return n}var QK=F.env();QK.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",function(){return 100},XK);var NT="Abs",e5="Acos",t5="Acosh",$m="Add",r5="AddN",n5="ArgMax",a5="ArgMin",i5="Asin",o5="Asinh",s5="Atan",u5="Atanh",c5="Atan2",l5="AvgPool",f5="AvgPoolGrad",h5="AvgPool3D",p5="AvgPool3DGrad",IT="BatchMatMul",CT="BatchToSpaceND",d5="BroadcastTo",Wm="Cast",v5="Ceil",m5="ClipByValue",g5="Complex",AT="ComplexAbs",DT="Concat",_T="Conv2D",y5="Conv2DBackpropFilter",FT="Conv2DBackpropInput",b5="Conv3D",w5="Conv3DBackpropFilterV2",x5="Conv3DBackpropInputV2",RT="Cos",OT="Cosh",k5="Cumprod",PT="Cumsum",S5="DepthwiseConv2dNative",E5="DepthwiseConv2dNativeBackpropFilter",T5="DepthwiseConv2dNativeBackpropInput",N5="Dilation2D",I5="Dilation2DBackpropInput",C5="Dilation2DBackpropFilter",MT="RealDiv",A5="Elu",D5="EluGrad",_5="Erf",F5="Equal",BT="Exp",LT="ExpandDims",R5="Expm1",O5="Fill",zT="Floor",$T="FloorDiv",P5="FusedBatchNorm",WT="GatherV2",M5="Greater",GT="GreaterEqual",Gm="Identity",B5="Imag",L5="IsFinite",z5="IsInf",$5="IsNan",W5="LeakyRelu",G5="Less",V5="LessEqual",VT="Log",U5="Log1p",H5="LogicalAnd",q5="LogicalNot",K5="LogSoftmax",j5="LRN",X5="LRNGrad",Y5="Max",UT="Maximum",Z5="MaxPool",J5="MaxPoolGrad",Q5="MaxPool3D",ej="MaxPool3DGrad",tj="Mean",rj="Min",nj="Minimum",aj="MirrorPad",ij="Mod",HT="Multiply",qT="Neg",oj="OnesLike",sj="OneHot",KT="Pack",jT="PadV2",XT="Pow",uj="Prelu",cj="Prod",lj="Real",fj="Reciprocal",hj="Relu",YT="Reshape",pj="ResizeNearestNeighbor",dj="ResizeNearestNeighborGrad",vj="ResizeBilinear",mj="ResizeBilinearGrad",gj="Relu6",ZT="Reverse",yj="Round",JT="Rsqrt",bj="TensorScatterUpdate",QT="Select",wj="Selu",eN="Slice",tN="Sin",rN="Sinh",xj="Sign",nN="Sigmoid",kj="Softplus",aN="Sqrt",iN="Sum",oN="SpaceToBatchND",sN="SplitV",Sj="Softmax",Ej="SquaredDifference",Tj="Square",uN="Sub",Nj="Tan",Ij="Tanh",Vm="Tile",hh="Transpose",cN="Unpack",lN="UnsortedSegmentSum",fN="ZerosLike",hN="Step";var Cj=1e-7,Aj=1e-4,Dj=(function(){function r(){}return r.prototype.refCount=function(e){return On("refCount")},r.prototype.incRef=function(e){return On("incRef")},r.prototype.timerAvailable=function(){return!0},r.prototype.time=function(e){return On("time")},r.prototype.read=function(e){return On("read")},r.prototype.readSync=function(e){return On("readSync")},r.prototype.readToGPU=function(e,t){return On("readToGPU")},r.prototype.numDataIds=function(){return On("numDataIds")},r.prototype.disposeData=function(e,t){return On("disposeData")},r.prototype.write=function(e,t,n){return On("write")},r.prototype.move=function(e,t,n,a,i){return On("move")},r.prototype.createTensorFromGPUData=function(e,t,n){return On("createTensorFromGPUData")},r.prototype.memory=function(){return On("memory")},r.prototype.floatPrecision=function(){return On("floatPrecision")},r.prototype.epsilon=function(){return this.floatPrecision()===32?Cj:Aj},r.prototype.dispose=function(){return On("dispose")},r})();function On(r){throw new Error("'".concat(r,"' not yet implemented or not found in the registry. ")+"This kernel may not be supported by the tfjs backend you have chosen")}function Se(r,e){if(!r)throw new Error(typeof e=="string"?e:e())}function _j(r,e,t){t===void 0&&(t=""),Se(Um(r,e),function(){return t+" Shapes ".concat(r," and ").concat(e," must match")})}function di(r){if(r.length===0)return 1;for(var e=r[0],t=1;t<r.length;t++)e*=r[t];return e}function Um(r,e){if(r===e)return!0;if(r==null||e==null||r.length!==e.length)return!1;for(var t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}function wh(r){return r%1===0}function ph(r,e){return e<=r.length?r:r+" ".repeat(e-r.length)}function is(r,e){var t=e.length;return r=r==null?e.map(function(n,a){return a}):[].concat(r),Se(r.every(function(n){return n>=-t&&n<t}),function(){return"All values in axis param must be in range [-".concat(t,", ").concat(t,") but ")+"got axis ".concat(r)}),Se(r.every(function(n){return wh(n)}),function(){return"All values in axis param must be integers but "+"got axis ".concat(r)}),r.map(function(n){return n<0?t+n:n})}function Fj(r,e){var t=null;if(r==null||r==="float32")t=new Float32Array(e);else if(r==="int32")t=new Int32Array(e);else if(r==="bool")t=new Uint8Array(e);else if(r==="string")t=new Array(e);else throw new Error("Unknown data type ".concat(r));return t}function Rj(r,e){for(var t=0;t<r.length;t++){var n=r[t];if(isNaN(n)||!isFinite(n))throw Error("A tensor of type ".concat(e," being uploaded contains ").concat(n,"."))}}function Oj(r){return r==="bool"||r==="complex64"||r==="float32"||r==="int32"||r==="string"}function gm(r){if(r==="float32"||r==="int32")return 4;if(r==="complex64")return 8;if(r==="bool")return 1;throw new Error("Unknown dtype ".concat(r))}function Pj(r){if(r==null)return 0;var e=0;return r.forEach(function(t){return e+=t.length}),e}function Hm(r){return typeof r=="string"||r instanceof String}function Mj(r){return typeof r=="boolean"}function Bj(r){return typeof r=="number"}function Uh(r){return Array.isArray(r)?Uh(r[0]):r instanceof Float32Array?"float32":r instanceof Int32Array||r instanceof Uint8Array||r instanceof Uint8ClampedArray?"int32":Bj(r)?"float32":Hm(r)?"string":Mj(r)?"bool":"float32"}function ym(r){return!!(r&&r.constructor&&r.call&&r.apply)}function qm(r){var e=r.length;if(e<2)return[];var t=new Array(e-1);t[e-2]=r[e-1];for(var n=e-3;n>=0;--n)t[n]=t[n+1]*r[n+1];return t}function pN(r,e,t,n){n===void 0&&(n=!1);var a=new Array;if(e.length===1)for(var i=e[0]*(n?2:1),o=0;o<i;o++)a[o]=t[r+o];else for(var i=e[0],s=e.slice(1),u=s.reduce(function(l,f){return l*f})*(n?2:1),o=0;o<i;o++)a[o]=pN(r+o*u,s,t,n);return a}function yE(r,e,t){if(t===void 0&&(t=!1),r.length===0)return e[0];var n=r.reduce(function(a,i){return a*i})*(t?2:1);if(n===0)return[];if(n!==e.length)throw new Error("[".concat(r,"] does not match the input size ").concat(e.length).concat(t?" for a complex tensor":"","."));return pN(0,r,e,t)}function dN(r,e){for(var t=Km(r,e),n=0;n<t.length;n++)t[n]=1;return t}function Km(r,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool")return new Uint8Array(r);throw new Error("Unknown data type ".concat(e))}function pl(r){r.forEach(function(e){Se(Number.isInteger(e)&&e>=0,function(){return"Tensor must have a shape comprised of positive integers but got "+"shape [".concat(r,"].")})})}function jm(r){return r&&r.then&&typeof r.then=="function"}var bE="tfjsflags",Lj=(function(){function r(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=zj,this.populateURLFlags()}return r.prototype.setPlatform=function(e,t){this.platform!=null&&(er().getBool("IS_TEST")||er().getBool("PROD")||console.warn("Platform ".concat(this.platformName," has already been set. ")+"Overwriting the platform with ".concat(e,"."))),this.platformName=e,this.platform=t},r.prototype.registerFlag=function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},this.urlFlags[e]!=null){var a=this.urlFlags[e];er().getBool("IS_TEST")||er().getBool("PROD")||console.warn("Setting feature override from URL ".concat(e,": ").concat(a,".")),this.set(e,a)}},r.prototype.getAsync=function(e){return Ie(this,void 0,void 0,function(){var t,n;return Te(this,function(a){switch(a.label){case 0:return e in this.flags?[2,this.flags[e]]:(t=this.flags,n=e,[4,this.evaluateFlag(e)]);case 1:return t[n]=a.sent(),[2,this.flags[e]]}})})},r.prototype.get=function(e){if(e in this.flags)return this.flags[e];var t=this.evaluateFlag(e);if(jm(t))throw new Error("Flag ".concat(e," cannot be synchronously evaluated. ")+"Please use getAsync() instead.");return this.flags[e]=t,this.flags[e]},r.prototype.getNumber=function(e){return this.get(e)},r.prototype.getBool=function(e){return this.get(e)},r.prototype.getString=function(e){return this.get(e)},r.prototype.getFlags=function(){return this.flags},Object.defineProperty(r.prototype,"features",{get:function(){return this.flags},enumerable:!1,configurable:!0}),r.prototype.set=function(e,t){if(this.flagRegistry[e]==null)throw new Error("Cannot set flag ".concat(e," as it has not been registered."));this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)},r.prototype.evaluateFlag=function(e){if(this.flagRegistry[e]==null)throw new Error("Cannot evaluate flag '".concat(e,"': no evaluation function found."));return this.flagRegistry[e].evaluationFn()},r.prototype.setFlags=function(e){this.flags=Object.assign({},e)},r.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},r.prototype.populateURLFlags=function(){var e=this;if(!(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")){var t=this.getQueryParams(this.global.location.search);if(bE in t){var n=t[bE].split(",");n.forEach(function(a){var i=ee(a.split(":"),2),o=i[0],s=i[1];e.urlFlags[o]=Wj(o,s)})}}},r})();function zj(r){var e={};return r.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(t){for(var n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];return $j(e,n[0],n[1]),n.join("=")}),e}function $j(r,e,t){r[decodeURIComponent(e)]=decodeURIComponent(t||"")}function Wj(r,e){var t=e.toLowerCase();return t==="true"||t==="false"?t==="true":"".concat(+t)===t?+t:e}function er(){return vN}var vN=null;function Gj(r){vN=r}var rm;function mN(){if(rm==null){var r=void 0;if(typeof window<"u")r=window;else if(typeof global<"u")r=global;else if(typeof process<"u")r=process;else if(typeof self<"u")r=self;else throw new Error("Could not find a global object");rm=r}return rm}function Vj(){var r=mN();return r._tfGlobals==null&&(r._tfGlobals=new Map),r._tfGlobals}function Xm(r,e){var t=Vj();if(t.has(r))return t.get(r);var n=e();return t.set(r,n),t.get(r)}function fu(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];er().getBool("IS_TEST")||er().getBool("PROD")||console.warn.apply(console,Xe([],ee(r),!1))}var gN=Xm("kernelRegistry",function(){return new Map}),bm=Xm("gradRegistry",function(){return new Map});function wE(r,e){var t=Hj(r,e);return gN.get(t)}function xE(r){return bm.get(r)}function kE(r){for(var e=gN.entries(),t=[];;){var n=e.next(),a=n.done,i=n.value;if(a)break;var o=ee(i,2),s=o[0],u=o[1],c=ee(s.split("_"),1),l=c[0];l===r&&t.push(u)}return t}function Uj(r){var e=r.kernelName;bm.has(e)&&er().getBool("DEBUG")&&fu("Overriding the gradient for '".concat(e,"'")),bm.set(e,r)}function Hj(r,e){return"".concat(e,"_").concat(r)}function qj(r){return r instanceof Float32Array||r instanceof Int32Array||r instanceof Uint8Array||r instanceof Uint8ClampedArray}var os=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Kj(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function jj(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var t=function n(){if(this instanceof n){var a=[null];a.push.apply(a,arguments);var i=Function.bind.apply(e,a);return new i}return e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var a=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,a.get?a:{enumerable:!0,get:function(){return r[n]}})}),t}var yN=Ut,ba=null;try{ba=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function Ut(r,e,t){this.low=r|0,this.high=e|0,this.unsigned=!!t}Ut.prototype.__isLong__;Object.defineProperty(Ut.prototype,"__isLong__",{value:!0});function Mn(r){return(r&&r.__isLong__)===!0}Ut.isLong=Mn;var SE={},EE={};function ss(r,e){var t,n,a;return e?(r>>>=0,(a=0<=r&&r<256)&&(n=EE[r],n)?n:(t=Ht(r,(r|0)<0?-1:0,!0),a&&(EE[r]=t),t)):(r|=0,(a=-128<=r&&r<128)&&(n=SE[r],n)?n:(t=Ht(r,r<0?-1:0,!1),a&&(SE[r]=t),t))}Ut.fromInt=ss;function wa(r,e){if(isNaN(r))return e?Qo:xa;if(e){if(r<0)return Qo;if(r>=bN)return kN}else{if(r<=-NE)return Pn;if(r+1>=NE)return xN}return r<0?wa(-r,e).neg():Ht(r%gu|0,r/gu|0,e)}Ut.fromNumber=wa;function Ht(r,e,t){return new Ut(r,e,t)}Ut.fromBits=Ht;var xh=Math.pow;function Ym(r,e,t){if(r.length===0)throw Error("empty string");if(r==="NaN"||r==="Infinity"||r==="+Infinity"||r==="-Infinity")return xa;if(typeof e=="number"?(t=e,e=!1):e=!!e,t=t||10,t<2||36<t)throw RangeError("radix");var n;if((n=r.indexOf("-"))>0)throw Error("interior hyphen");if(n===0)return Ym(r.substring(1),e,t).neg();for(var a=wa(xh(t,8)),i=xa,o=0;o<r.length;o+=8){var s=Math.min(8,r.length-o),u=parseInt(r.substring(o,o+s),t);if(s<8){var c=wa(xh(t,s));i=i.mul(c).add(wa(u))}else i=i.mul(a),i=i.add(wa(u))}return i.unsigned=e,i}Ut.fromString=Ym;function Ja(r,e){return typeof r=="number"?wa(r,e):typeof r=="string"?Ym(r,e):Ht(r.low,r.high,typeof e=="boolean"?e:r.unsigned)}Ut.fromValue=Ja;var TE=65536,Xj=1<<24,gu=TE*TE,bN=gu*gu,NE=bN/2,IE=ss(Xj),xa=ss(0);Ut.ZERO=xa;var Qo=ss(0,!0);Ut.UZERO=Qo;var pu=ss(1);Ut.ONE=pu;var wN=ss(1,!0);Ut.UONE=wN;var wm=ss(-1);Ut.NEG_ONE=wm;var xN=Ht(-1,2147483647,!1);Ut.MAX_VALUE=xN;var kN=Ht(-1,-1,!0);Ut.MAX_UNSIGNED_VALUE=kN;var Pn=Ht(0,-2147483648,!1);Ut.MIN_VALUE=Pn;var Fe=Ut.prototype;Fe.toInt=function(){return this.unsigned?this.low>>>0:this.low};Fe.toNumber=function(){return this.unsigned?(this.high>>>0)*gu+(this.low>>>0):this.high*gu+(this.low>>>0)};Fe.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Pn)){var t=wa(e),n=this.div(t),a=n.mul(t).sub(this);return n.toString(e)+a.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var i=wa(xh(e,6),this.unsigned),o=this,s="";;){var u=o.div(i),c=o.sub(u.mul(i)).toInt()>>>0,l=c.toString(e);if(o=u,o.isZero())return l+s;for(;l.length<6;)l="0"+l;s=""+l+s}};Fe.getHighBits=function(){return this.high};Fe.getHighBitsUnsigned=function(){return this.high>>>0};Fe.getLowBits=function(){return this.low};Fe.getLowBitsUnsigned=function(){return this.low>>>0};Fe.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Pn)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return this.high!=0?t+33:t+1};Fe.isZero=function(){return this.high===0&&this.low===0};Fe.eqz=Fe.isZero;Fe.isNegative=function(){return!this.unsigned&&this.high<0};Fe.isPositive=function(){return this.unsigned||this.high>=0};Fe.isOdd=function(){return(this.low&1)===1};Fe.isEven=function(){return(this.low&1)===0};Fe.equals=function(e){return Mn(e)||(e=Ja(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};Fe.eq=Fe.equals;Fe.notEquals=function(e){return!this.eq(e)};Fe.neq=Fe.notEquals;Fe.ne=Fe.notEquals;Fe.lessThan=function(e){return this.comp(e)<0};Fe.lt=Fe.lessThan;Fe.lessThanOrEqual=function(e){return this.comp(e)<=0};Fe.lte=Fe.lessThanOrEqual;Fe.le=Fe.lessThanOrEqual;Fe.greaterThan=function(e){return this.comp(e)>0};Fe.gt=Fe.greaterThan;Fe.greaterThanOrEqual=function(e){return this.comp(e)>=0};Fe.gte=Fe.greaterThanOrEqual;Fe.ge=Fe.greaterThanOrEqual;Fe.compare=function(e){if(Mn(e)||(e=Ja(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};Fe.comp=Fe.compare;Fe.negate=function(){return!this.unsigned&&this.eq(Pn)?Pn:this.not().add(pu)};Fe.neg=Fe.negate;Fe.add=function(e){Mn(e)||(e=Ja(e));var t=this.high>>>16,n=this.high&65535,a=this.low>>>16,i=this.low&65535,o=e.high>>>16,s=e.high&65535,u=e.low>>>16,c=e.low&65535,l=0,f=0,h=0,p=0;return p+=i+c,h+=p>>>16,p&=65535,h+=a+u,f+=h>>>16,h&=65535,f+=n+s,l+=f>>>16,f&=65535,l+=t+o,l&=65535,Ht(h<<16|p,l<<16|f,this.unsigned)};Fe.subtract=function(e){return Mn(e)||(e=Ja(e)),this.add(e.neg())};Fe.sub=Fe.subtract;Fe.multiply=function(e){if(this.isZero())return xa;if(Mn(e)||(e=Ja(e)),ba){var t=ba.mul(this.low,this.high,e.low,e.high);return Ht(t,ba.get_high(),this.unsigned)}if(e.isZero())return xa;if(this.eq(Pn))return e.isOdd()?Pn:xa;if(e.eq(Pn))return this.isOdd()?Pn:xa;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(IE)&&e.lt(IE))return wa(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,a=this.high&65535,i=this.low>>>16,o=this.low&65535,s=e.high>>>16,u=e.high&65535,c=e.low>>>16,l=e.low&65535,f=0,h=0,p=0,d=0;return d+=o*l,p+=d>>>16,d&=65535,p+=i*l,h+=p>>>16,p&=65535,p+=o*c,h+=p>>>16,p&=65535,h+=a*l,f+=h>>>16,h&=65535,h+=i*c,f+=h>>>16,h&=65535,h+=o*u,f+=h>>>16,h&=65535,f+=n*l+a*c+i*u+o*s,f&=65535,Ht(p<<16|d,f<<16|h,this.unsigned)};Fe.mul=Fe.multiply;Fe.divide=function(e){if(Mn(e)||(e=Ja(e)),e.isZero())throw Error("division by zero");if(ba){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?ba.div_u:ba.div_s)(this.low,this.high,e.low,e.high);return Ht(t,ba.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Qo:xa;var n,a,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Qo;if(e.gt(this.shru(1)))return wN;i=Qo}else{if(this.eq(Pn)){if(e.eq(pu)||e.eq(wm))return Pn;if(e.eq(Pn))return pu;var o=this.shr(1);return n=o.div(e).shl(1),n.eq(xa)?e.isNegative()?pu:wm:(a=this.sub(e.mul(n)),i=n.add(a.div(e)),i)}else if(e.eq(Pn))return this.unsigned?Qo:xa;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=xa}for(a=this;a.gte(e);){n=Math.max(1,Math.floor(a.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(n)/Math.LN2),u=s<=48?1:xh(2,s-48),c=wa(n),l=c.mul(e);l.isNegative()||l.gt(a);)n-=u,c=wa(n,this.unsigned),l=c.mul(e);c.isZero()&&(c=pu),i=i.add(c),a=a.sub(l)}return i};Fe.div=Fe.divide;Fe.modulo=function(e){if(Mn(e)||(e=Ja(e)),ba){var t=(this.unsigned?ba.rem_u:ba.rem_s)(this.low,this.high,e.low,e.high);return Ht(t,ba.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};Fe.mod=Fe.modulo;Fe.rem=Fe.modulo;Fe.not=function(){return Ht(~this.low,~this.high,this.unsigned)};Fe.and=function(e){return Mn(e)||(e=Ja(e)),Ht(this.low&e.low,this.high&e.high,this.unsigned)};Fe.or=function(e){return Mn(e)||(e=Ja(e)),Ht(this.low|e.low,this.high|e.high,this.unsigned)};Fe.xor=function(e){return Mn(e)||(e=Ja(e)),Ht(this.low^e.low,this.high^e.high,this.unsigned)};Fe.shiftLeft=function(e){return Mn(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Ht(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):Ht(0,this.low<<e-32,this.unsigned)};Fe.shl=Fe.shiftLeft;Fe.shiftRight=function(e){return Mn(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Ht(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):Ht(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};Fe.shr=Fe.shiftRight;Fe.shiftRightUnsigned=function(e){if(Mn(e)&&(e=e.toInt()),e&=63,e===0)return this;var t=this.high;if(e<32){var n=this.low;return Ht(n>>>e|t<<32-e,t>>>e,this.unsigned)}else return e===32?Ht(t,0,this.unsigned):Ht(t>>>e-32,0,this.unsigned)};Fe.shru=Fe.shiftRightUnsigned;Fe.shr_u=Fe.shiftRightUnsigned;Fe.toSigned=function(){return this.unsigned?Ht(this.low,this.high,!1):this};Fe.toUnsigned=function(){return this.unsigned?this:Ht(this.low,this.high,!0)};Fe.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};Fe.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};Fe.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};Ut.fromBytes=function(e,t,n){return n?Ut.fromBytesLE(e,t):Ut.fromBytesBE(e,t)};Ut.fromBytesLE=function(e,t){return new Ut(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)};Ut.fromBytesBE=function(e,t){return new Ut(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};var SN=Kj(yN),Yj=vK({__proto__:null,default:SN},[yN]),Zj=SN||Yj;function Zm(r){return Zj.fromString(r,!0,16)}Zm("c3a5c85c97cb3127");Zm("b492b66fbe98f273");Zm("9ae16a3b2f90404f");function Jj(r,e){return r instanceof Float32Array&&e==="float32"||r instanceof Int32Array&&e==="int32"||r instanceof Uint8Array&&e==="bool"}function EN(r,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(r)&&(r=al(r)),er().getBool("DEBUG")&&Rj(r,e),Jj(r,e))return r;if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool"){for(var t=new Uint8Array(r.length),n=0;n<t.length;++n)Math.round(r[n])!==0&&(t[n]=1);return t}else throw new Error("Unknown data type ".concat(e))}function kh(){return er().platform.now()}function Qj(r,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",er().platform.encode(r,e)}function CE(r,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",er().platform.decode(r,e)}function ka(r){return er().platform.isTypedArray!=null?er().platform.isTypedArray(r):qj(r)}function al(r,e,t){var n,a;if(e===void 0&&(e=[]),t===void 0&&(t=!1),e==null&&(e=[]),typeof r=="boolean"||typeof r=="number"||typeof r=="string"||jm(r)||r==null||ka(r)&&t)e.push(r);else if(Array.isArray(r)||ka(r))for(var i=0;i<r.length;++i)al(r[i],e,t);else{var o=-1;try{for(var s=le(Object.keys(r)),u=s.next();!u.done;u=s.next()){var c=u.value;/^([1-9]+[0-9]*|0)$/.test(c)&&(o=Math.max(o,Number(c)))}}catch(l){n={error:l}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(n)throw n.error}}for(var i=0;i<=o;i++)al(r[i],e,t)}return e}var e8=(function(){function r(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new r8)}return r.prototype.profileKernel=function(e,t,n){var a,i,o,s=function(){o=n()},u,c=kh();if(this.backendTimer.timerAvailable())u=this.backendTimer.time(s);else{s();try{for(var l=le(o),f=l.next();!f.done;f=l.next()){var h=f.value;h.dataSync()}}catch(v){a={error:v}}finally{try{f&&!f.done&&(i=l.return)&&i.call(l)}finally{if(a)throw a.error}}u=Promise.resolve({kernelMs:kh()-c})}if(er().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(var p=function(v){var g=o[v];g.data().then(function(y){t8(y,g.dtype,e)})},d=0;d<o.length;d++)p(d);var m={kernelName:e,outputs:o,inputs:t,timeMs:u.then(function(v){return v.kernelMs}),extraInfo:u.then(function(v){return v.getExtraProfileInfo!=null?v.getExtraProfileInfo():""})};return m},r.prototype.logKernelProfile=function(e){var t=this,n=e.kernelName,a=e.outputs,i=e.timeMs,o=e.inputs,s=e.extraInfo;a.forEach(function(u){Promise.all([u.data(),i,s]).then(function(c){t.logger.logKernelProfile(n,u,c[0],c[1],o,c[2])})})},r})();function t8(r,e,t){if(e!=="float32")return!1;for(var n=0;n<r.length;n++){var a=r[n];if(isNaN(a)||!isFinite(a))return console.warn("Found ".concat(a," in the result of '").concat(t,"'")),!0}return!1}var r8=(function(){function r(){}return r.prototype.logKernelProfile=function(e,t,n,a,i,o){var s=typeof a=="number"?ph("".concat(a,"ms"),9):a.error,u=ph(e,25),c=t.rank,l=t.size,f=ph(t.shape.toString(),14),h="";for(var p in i){var d=i[p];if(d!=null){var m=d.shape||t.shape,v=m.length;h+="".concat(p,": ").concat(v,"D ").concat(v>0?m:""," ")}}console.log("%c".concat(u,"	%c").concat(s,"	%c").concat(c,"D ").concat(f,"	%c").concat(l,"	%c").concat(h,"	%c").concat(o),"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},r})();function n8(r,e,t){for(var n={},a={},i=0;i<e.length;i++)n[e[i].id]=!0;for(var i=0;i<r.length;i++){var o=r[i],s=o.inputs;for(var u in s){for(var c=s[u],l=!1,f=0;f<e.length;f++)if(n[c.id]){o.outputs.forEach(function(w){return n[w.id]=!0}),l=!0,a[o.id]=!0;break}if(l)break}}var h={};h[t.id]=!0;for(var p={},i=r.length-1;i>=0;i--)for(var o=r[i],s=o.inputs,f=0;f<o.outputs.length;f++)if(h[o.outputs[f].id]){for(var u in s)h[s[u].id]=!0,p[o.id]=!0;break}for(var d=[],i=0;i<r.length;i++){var o=r[i];if(a[o.id]&&p[o.id]){var m={};for(var u in o.inputs){var v=o.inputs[u];n[v.id]&&(m[u]=v)}var g=Object.assign({},o);g.inputs=m,g.outputs=o.outputs,d.push(g)}}return d}function a8(r,e,t,n){for(var a=function(o){var s=e[o],u=[];if(s.outputs.forEach(function(h){var p=r[h.id];p!=null?u.push(p):u.push(null)}),s.gradient==null)throw new Error("Cannot compute gradient: gradient function not found "+"for ".concat(s.kernelName,"."));var c=s.gradient(u),l=function(h){if(!(h in c))throw new Error("Cannot backprop through input ".concat(h,". ")+"Available gradients found: ".concat(Object.keys(c),"."));var p=t(function(){return c[h]()});if(p.dtype!=="float32")throw new Error("Error in gradient for op ".concat(s.kernelName,". The gradient of input ")+"".concat(h," must have 'float32' dtype, but has '").concat(p.dtype,"'"));var d=s.inputs[h];if(!Um(p.shape,d.shape))throw new Error("Error in gradient for op ".concat(s.kernelName,". The gradient of input ")+"'".concat(h,"' has shape '").concat(p.shape,"', which does not match ")+"the shape of the input '".concat(d.shape,"'"));if(r[d.id]==null)r[d.id]=p;else{var m=r[d.id];r[d.id]=n(m,p),m.dispose()}};for(var f in s.inputs)l(f)},i=e.length-1;i>=0;i--)a(i)}var AE=20,qc=3,nm=7;function i8(r,e,t,n){var a=qm(e),i=o8(r,e,t,a),o=e.length,s=dh(r,e,t,a,i),u=["Tensor"];return n&&(u.push("  dtype: ".concat(t)),u.push("  rank: ".concat(o)),u.push("  shape: [".concat(e,"]")),u.push("  values:")),u.push(s.map(function(c){return"    "+c}).join(`
`)),u.join(`
`)}function o8(r,e,t,n){var a=di(e),i=n[n.length-1],o=new Array(i).fill(0),s=e.length,u=t==="complex64"?tl(r):r;if(s>1)for(var c=0;c<a/i;c++)for(var l=c*i,f=0;f<i;f++)o[f]=Math.max(o[f],el(u[l+f],0,t).length);return o}function el(r,e,t){var n;return Array.isArray(r)?n="".concat(parseFloat(r[0].toFixed(nm))," + ")+"".concat(parseFloat(r[1].toFixed(nm)),"j"):Hm(r)?n="'".concat(r,"'"):t==="bool"?n=TN(r):n=parseFloat(r.toFixed(nm)).toString(),ph(n,e)}function TN(r){return r===0?"false":"true"}function dh(r,e,t,n,a,i){i===void 0&&(i=!0);var o=t==="complex64"?2:1,s=e[0],u=e.length;if(u===0){if(t==="complex64"){var c=tl(r);return[el(c[0],0,t)]}return t==="bool"?[TN(r[0])]:[r[0].toString()]}if(u===1){if(s>AE){var l=qc*o,f=Array.from(r.slice(0,l)),h=Array.from(r.slice((s-qc)*o,s*o));return t==="complex64"&&(f=tl(f),h=tl(h)),["["+f.map(function(T,N){return el(T,a[N],t)}).join(", ")+", ..., "+h.map(function(T,N){return el(T,a[s-qc+N],t)}).join(", ")+"]"]}var p=t==="complex64"?tl(r):Array.from(r);return["["+p.map(function(T,N){return el(T,a[N],t)}).join(", ")+"]"]}var d=e.slice(1),m=n.slice(1),v=n[0]*o,g=[];if(s>AE){for(var y=0;y<qc;y++){var w=y*v,b=w+v;g.push.apply(g,Xe([],ee(dh(r.slice(w,b),d,t,m,a,!1)),!1))}g.push("...");for(var y=s-qc;y<s;y++){var w=y*v,b=w+v;g.push.apply(g,Xe([],ee(dh(r.slice(w,b),d,t,m,a,y===s-1)),!1))}}else for(var y=0;y<s;y++){var w=y*v,b=w+v;g.push.apply(g,Xe([],ee(dh(r.slice(w,b),d,t,m,a,y===s-1)),!1))}var x=u===2?",":"";g[0]="["+(s>0?g[0]+x:"");for(var y=1;y<g.length-1;y++)g[y]=" "+g[y]+x;for(var S=`,
`,y=2;y<u;y++)S+=`
`;return g[g.length-1]=" "+g[g.length-1]+"]"+(i?"":S),g}function tl(r){for(var e=[],t=0;t<r.length;t+=2)e.push([r[t],r[t+1]]);return e}(function(){function r(e,t,n){var a=this;if(this.dtype=t,this.shape=e.slice(),this.size=di(e),n!=null){var i=n.length;Se(i===this.size,function(){return"Length of values '".concat(i,"' does not match the size ")+"inferred by the shape '".concat(a.size,"'.")})}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||Fj(t,this.size),this.strides=qm(e)}return r.prototype.set=function(e){for(var t=this,n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];n.length===0&&(n=[0]),Se(n.length===this.rank,function(){return"The number of provided coordinates (".concat(n.length,") must ")+"match the rank (".concat(t.rank,")")});var i=this.locToIndex(n);this.values[i]=e},r.prototype.get=function(){for(var e,t,n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];n.length===0&&(n=[0]);var i=0;try{for(var o=le(n),s=o.next();!s.done;s=o.next()){var u=s.value;if(u<0||u>=this.shape[i]){var c="Requested out of range element at ".concat(n,". ")+"  Buffer shape=".concat(this.shape);throw new Error(c)}i++}}catch(h){e={error:h}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}for(var l=n[n.length-1],f=0;f<n.length-1;++f)l+=this.strides[f]*n[f];return this.values[l]},r.prototype.locToIndex=function(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t},r.prototype.indexToLoc=function(e){if(this.rank===0)return[];if(this.rank===1)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t},Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!1,configurable:!0}),r.prototype.toTensor=function(){return Va().makeTensor(this.values,this.shape,this.dtype)},r})();var Va=null,Kc=null;function s8(r){Va=r}var Ua=(function(){function r(e,t,n,a){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=di(e),this.strides=qm(e),this.dataId=n,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}return Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!1,configurable:!0}),r.prototype.buffer=function(){return Ie(this,void 0,void 0,function(){var e;return Te(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,Kc.buffer(this.shape,this.dtype,e)]}})})},r.prototype.bufferSync=function(){return Kc.buffer(this.shape,this.dtype,this.dataSync())},r.prototype.array=function(){return Ie(this,void 0,void 0,function(){var e;return Te(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,yE(this.shape,e,this.dtype==="complex64")]}})})},r.prototype.arraySync=function(){return yE(this.shape,this.dataSync(),this.dtype==="complex64")},r.prototype.data=function(){return Ie(this,void 0,void 0,function(){var e,t;return Te(this,function(n){switch(n.label){case 0:return this.throwIfDisposed(),e=Va().read(this.dataId),this.dtype!=="string"?[3,2]:[4,e];case 1:t=n.sent();try{return[2,t.map(function(a){return CE(a)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}n.label=2;case 2:return[2,e]}})})},r.prototype.dataToGPU=function(e){return this.throwIfDisposed(),Va().readToGPU(this.dataId,e)},r.prototype.dataSync=function(){this.throwIfDisposed();var e=Va().readSync(this.dataId);if(this.dtype==="string")try{return e.map(function(t){return CE(t)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},r.prototype.bytes=function(){return Ie(this,void 0,void 0,function(){var e;return Te(this,function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,Va().read(this.dataId)];case 1:return e=t.sent(),this.dtype==="string"?[2,e]:[2,new Uint8Array(e.buffer)]}})})},r.prototype.dispose=function(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),Va().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(r.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!1,configurable:!0}),r.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},r.prototype.print=function(e){return e===void 0&&(e=!1),Kc.print(this,e)},r.prototype.clone=function(){return this.throwIfDisposed(),Kc.clone(this)},r.prototype.toString=function(e){e===void 0&&(e=!1);var t=this.dataSync();return i8(t,this.shape,this.dtype,e)},r.prototype.cast=function(e){return this.throwIfDisposed(),Kc.cast(this,e)},r.prototype.variable=function(e,t,n){return e===void 0&&(e=!0),this.throwIfDisposed(),Va().makeVariable(this,e,t,n)},r})();Object.defineProperty(Ua,Symbol.hasInstance,{value:function(r){return!!r&&r.data!=null&&r.dataSync!=null&&r.throwIfDisposed!=null}});function NN(){return Xm("Tensor",function(){return Ua})}NN();var Sh=(function(r){ie(e,r);function e(t,n,a,i){var o=r.call(this,t.shape,t.dtype,t.dataId,i)||this;return o.trainable=n,o.name=a,o}return e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value (".concat(t.dtype,") and ")+"previous value (".concat(this.dtype,") must match"));if(!Um(t.shape,this.shape))throw new Error("shape of the new value (".concat(t.shape,") and ")+"previous value (".concat(this.shape,") must match"));Va().disposeTensor(this),this.dataId=t.dataId,Va().incRef(this,null)},e.prototype.dispose=function(){Va().disposeVariable(this),this.isDisposedInternal=!0},e})(Ua);Object.defineProperty(Sh,Symbol.hasInstance,{value:function(r){return r instanceof Ua&&r.assign!=null&&r.assign instanceof Function}});var DE;(function(r){r.R0="R0",r.R1="R1",r.R2="R2",r.R3="R3",r.R4="R4",r.R5="R5",r.R6="R6"})(DE||(DE={}));var xm;(function(r){r.float32="float32",r.int32="int32",r.bool="int32",r.complex64="complex64"})(xm||(xm={}));var km;(function(r){r.float32="float32",r.int32="int32",r.bool="bool",r.complex64="complex64"})(km||(km={}));var Sm;(function(r){r.float32="float32",r.int32="float32",r.bool="float32",r.complex64="complex64"})(Sm||(Sm={}));var Em;(function(r){r.float32="complex64",r.int32="complex64",r.bool="complex64",r.complex64="complex64"})(Em||(Em={}));var u8={float32:Sm,int32:xm,bool:km,complex64:Em};function c8(r,e){if(r==="string"||e==="string"){if(r==="string"&&e==="string")return"string";throw new Error("Can not upcast ".concat(r," with ").concat(e))}return u8[r][e]}function IN(r){return r!=null&&typeof r=="object"&&"texture"in r&&r.texture instanceof WebGLTexture}function CN(r){return typeof GPUBuffer<"u"&&r!=null&&typeof r=="object"&&"buffer"in r&&r.buffer instanceof GPUBuffer}function ta(r,e){if(r.dtype===e.dtype)return[r,e];var t=c8(r.dtype,e.dtype);return[r.cast(t),e.cast(t)]}function AN(r){var e=[],t=new Set;return DN(r,e,t),e}function DN(r,e,t){if(r!=null){if(r instanceof Ua){e.push(r);return}if(l8(r)){var n=r;for(var a in n){var i=n[a];t.has(i)||(t.add(i),DN(i,e,t))}}}}function l8(r){return Array.isArray(r)||typeof r=="object"}function am(r){return r.kernelName!=null}var _E=(function(){function r(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(function(e){return e.name})))}}}return r.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},r})(),Jm=(function(){function r(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new _E}return r.prototype.ready=function(){return Ie(this,void 0,void 0,function(){var e,t,n,a;return Te(this,function(i){switch(i.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];e=this.getSortedBackends(),t=0,i.label=1;case 1:return t<e.length?(n=e[t],[4,this.initializeBackend(n).success]):[3,5];case 2:return a=i.sent(),a?[4,this.setBackend(n)]:[3,4];case 3:return i.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(r.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '".concat(this.backendName,"' has not yet been initialized. Make ")+"sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var e=this.initializeBackendsAndReturnBest(),t=e.name,n=e.asyncInit;if(n)throw new Error("The highest priority backend '".concat(t,"' has not yet been ")+"initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!1,configurable:!0}),r.prototype.backendNames=function(){return Object.keys(this.registryFactory)},r.prototype.findBackend=function(e){if(!(e in this.registry))if(e in this.registryFactory){var t=this.initializeBackend(e).asyncInit;if(t)return null}else return null;return this.registry[e]},r.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},r.prototype.registerBackend=function(e,t,n){return n===void 0&&(n=1),e in this.registryFactory?(fu("".concat(e," backend was already registered. ")+"Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)},r.prototype.setBackend=function(e){return Ie(this,void 0,void 0,function(){var t,n,a,i,o;return Te(this,function(s){switch(s.label){case 0:if(this.registryFactory[e]==null)throw new Error("Backend name '".concat(e,"' not found in registry"));return this.backendName=e,this.registry[e]!=null?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),n=t.success,a=t.asyncInit,a?[4,n]:[3,2]);case 1:return o=s.sent(),[3,3];case 2:o=n,s.label=3;case 3:if(i=o,!i)return[2,!1];s.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new e8(this.backendInstance),[2,!0]}})})},r.prototype.setupRegisteredKernels=function(){var e=this,t=kE(this.backendName);t.forEach(function(n){n.setupFunc!=null&&n.setupFunc(e.backendInstance)})},r.prototype.disposeRegisteredKernels=function(e){var t=this,n=kE(e);n.forEach(function(a){a.disposeFunc!=null&&a.disposeFunc(t.registry[e])})},r.prototype.initializeBackend=function(e){var t=this,n=this.registryFactory[e];if(n==null)throw new Error("Cannot initialize backend ".concat(e,", no registration found."));try{var a=n.factory();if(a&&!(a instanceof Dj)&&typeof a.then=="function"){var i=++this.pendingBackendInitId,o=a.then(function(s){return i<t.pendingBackendInitId?!1:(t.registry[e]=s,t.pendingBackendInit=null,!0)}).catch(function(s){return i<t.pendingBackendInitId||(t.pendingBackendInit=null,fu("Initialization of backend ".concat(e," failed")),fu(s.stack||s.message)),!1});return this.pendingBackendInit=o,{success:o,asyncInit:!0}}else return this.registry[e]=a,{success:!0,asyncInit:!1}}catch(s){return fu("Initialization of backend ".concat(e," failed")),fu(s.stack||s.message),{success:!1,asyncInit:!1}}},r.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error("".concat(e," backend not found in registry"));this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},r.prototype.getSortedBackends=function(){var e=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority})},r.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],a=this.initializeBackend(n),i=a.success,o=a.asyncInit;if(o||i)return{name:n,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")},r.prototype.moveData=function(e,t){var n=this.state.tensorInfo.get(t),a=n.backend,i=this.readSync(t),o=a.refCount(t);a.disposeData(t,!0),n.backend=e,e.move(t,i,n.shape,n.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},r.prototype.tidy=function(e,t){var n=this,a=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}var i;return this.scopedRun(function(){return n.startScope(a)},function(){return n.endScope(i)},function(){return i=t(),i instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),i})},r.prototype.scopedRun=function(e,t,n){e();try{var a=n();return t(),a}catch(i){throw t(),i}},r.prototype.nextTensorId=function(){return r.nextTensorId++},r.prototype.nextVariableId=function(){return r.nextVariableId++},r.prototype.clone=function(e){var t=de.runKernel(Gm,{x:e}),n={x:e},a=function(o){return{x:function(){var s="float32",u={x:o},c={dtype:s};return de.runKernel(Wm,u,c)}}},i=[];return this.addTapeNode(this.state.activeScope.name,n,[t],a,i,{}),t},r.prototype.runKernel=function(e,t,n){this.backendName==null&&this.backend;var a=wE(e,this.backendName)!=null;if(!a)throw new Error("Kernel '".concat(e,"' not registered for backend '").concat(this.backendName,"'"));return this.runKernelFunc({kernelName:e,inputs:t,attrs:n})},r.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},r.prototype.checkKernelForMemLeak=function(e,t,n){var a=this.backend.numDataIds(),i=0;n.forEach(function(u){i+=u.dtype==="complex64"?3:1});var o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=a-t-i-o;if(s>0)throw new Error("Backend '".concat(this.backendName,"' has an internal memory leak ")+"(".concat(s," data ids) after running '").concat(e,"'"))},r.prototype.runKernelFunc=function(e){var t=this,n,a=[],i=this.isTapeOn(),o=this.state.numBytes,s=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var u;this.backendName==null&&this.backend;var c,l=am(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(am(e)){var f=e.kernelName,h=e.inputs,p=e.attrs;this.backendName==null&&this.backend;var d=wE(f,this.backendName);Se(d!=null,function(){return"Cannot find registered kernel '".concat(f,"' for backend '").concat(t.backendName,"'")}),u=function(){var x=t.backend.numDataIds();c=d.kernelFunc({inputs:h,attrs:p,backend:t.backend});var S=Array.isArray(c)?c:[c];t.shouldCheckForMemLeaks()&&t.checkKernelForMemLeak(f,x,S);var T=S.map(function(C){return C.rank!=null?C:t.makeTensorFromTensorInfo(C)});if(i){var N=t.getTensorsForGradient(f,h,T);a=t.saveTensorsForBackwardMode(N)}return T}}else{var m=e.forwardFunc,v=function(x){i&&(a=x.map(function(S){return t.keep(t.clone(S))}))};u=function(){var x=t.backend.numDataIds();c=t.tidy(function(){return m(t.backend,v)});var S=Array.isArray(c)?c:[c];return t.shouldCheckForMemLeaks()&&t.checkKernelForMemLeak(l,x,S),S}}var g=e.inputs,y=e.attrs,w=am(e)?null:e.backwardsFunc,b;return this.scopedRun(function(){return t.state.kernelDepth++},function(){return t.state.kernelDepth--},function(){!t.ENV.getBool("DEBUG")&&!t.state.profiling?n=u():(b=t.profiler.profileKernel(l,g,function(){return u()}),t.ENV.getBool("DEBUG")&&t.profiler.logKernelProfile(b),n=b.outputs)}),i&&this.addTapeNode(l,g,n,w,a,y),this.state.profiling&&this.state.activeProfile.kernels.push({name:l,bytesAdded:this.state.numBytes-o,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-s,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(g).map(function(x){return g[x]!=null?g[x].shape:null}),outputShapes:n.map(function(x){return x.shape}),kernelTimeMs:b.timeMs,extraInfo:b.extraInfo}),Array.isArray(c)?n:n[0]},r.prototype.saveTensorsForBackwardMode=function(e){var t=this,n=e.map(function(a){return t.keep(t.clone(a))});return n},r.prototype.getTensorsForGradient=function(e,t,n){var a=xE(e);if(a!=null){var i=a.inputsToSave||[],o=a.outputsToSave||[],s=void 0;a.saveAllInputs?(Se(Array.isArray(t),function(){return"saveAllInputs is true, expected inputs to be an array."}),s=Object.keys(t).map(function(c){return t[c]})):s=i.map(function(c){return t[c]});var u=n.filter(function(c,l){return o[l]});return s.concat(u)}return[]},r.prototype.makeTensor=function(e,t,n,a){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",a=a||this.backend;var i=e;n==="string"&&Hm(e[0])&&(i=e.map(function(l){return Qj(l)}));var o=a.write(i,t,n),s=new Ua(t,n,o,this.nextTensorId());if(this.trackTensor(s,a),n==="string"){var u=this.state.tensorInfo.get(o),c=Pj(i);this.state.numBytes+=c-u.bytes,u.bytes=c}return s},r.prototype.makeTensorFromDataId=function(e,t,n,a){n=n||"float32";var i={dataId:e,shape:t,dtype:n};return this.makeTensorFromTensorInfo(i,a)},r.prototype.makeTensorFromTensorInfo=function(e,t){var n=e.dataId,a=e.shape,i=e.dtype,o=new Ua(a,i,n,this.nextTensorId());return this.trackTensor(o,t),o},r.prototype.makeVariable=function(e,t,n,a){t===void 0&&(t=!0),n=n||this.nextVariableId().toString(),a!=null&&a!==e.dtype&&(e=e.cast(a));var i=new Sh(e,t,n,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error("Variable with name ".concat(i.name," was already registered"));return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i},r.prototype.trackTensor=function(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;var n=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(n=e.size*gm(e.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n})),e instanceof Sh||this.track(e)},r.prototype.incRef=function(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)},r.prototype.removeDataId=function(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)},r.prototype.disposeTensor=function(e){if(this.state.tensorInfo.has(e.dataId)){var t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){var n=e.size*gm(e.dtype);this.state.numBytes-=n}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}},r.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},r.prototype.disposeVariable=function(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]},r.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},r.prototype.profile=function(e){return Ie(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l,f,h;return Te(this,function(p){switch(p.label){case 0:return this.state.profiling=!0,t=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],a=this.state.activeProfile,[4,e()];case 1:a.result=p.sent(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,Xe([],ee(this.state.activeProfile.kernels.map(function(d){return d.totalBytesSnapshot})),!1)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n,p.label=2;case 2:p.trys.push([2,8,9,10]),i=le(this.state.activeProfile.kernels),o=i.next(),p.label=3;case 3:return o.done?[3,7]:(s=o.value,u=s,[4,s.kernelTimeMs]);case 4:return u.kernelTimeMs=p.sent(),c=s,[4,s.extraInfo];case 5:c.extraInfo=p.sent(),p.label=6;case 6:return o=i.next(),[3,3];case 7:return[3,10];case 8:return l=p.sent(),f={error:l},[3,10];case 9:try{o&&!o.done&&(h=i.return)&&h.call(i)}finally{if(f)throw f.error}return[7];case 10:return[2,this.state.activeProfile]}})})},r.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},r.prototype.addTapeNode=function(e,t,n,a,i,o){var s=this,u={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:i},c=xE(e);c!=null&&(a=c.gradFunc),a!=null&&(u.gradient=function(l){return l=l.map(function(f,h){if(f==null){var p=n[h],d=Km(p.size,p.dtype);return s.makeTensor(d,p.shape,p.dtype)}return f}),a(l.length>1?l:l[0],i,o)}),this.state.activeTape.push(u)},r.prototype.keep=function(e){return e.kept=!0,e},r.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},r.prototype.endTape=function(){this.state.gradientDepth--},r.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},r.prototype.endScope=function(e){for(var t=this,n=AN(e),a=new Set(n.map(function(u){return u.id})),i=0;i<this.state.activeScope.track.length;i++){var o=this.state.activeScope.track[i];!o.kept&&!a.has(o.id)&&o.dispose()}var s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(function(u){!u.kept&&u.scopeId===s.id&&t.track(u)})},r.prototype.gradients=function(e,t,n,a){var i=this;if(a===void 0&&(a=!1),Se(t.length>0,function(){return"gradients() received an empty list of xs."}),n!=null&&n.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '".concat(n.dtype,"'"));var o=this.scopedRun(function(){return i.startTape()},function(){return i.endTape()},function(){return i.tidy("forward",e)});Se(o instanceof Ua,function(){return"The result y returned by f() must be a tensor."});var s=n8(this.state.activeTape,t,o);if(!a&&s.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u={};u[o.id]=n??f8(o.shape),a8(u,s,function(l){return i.tidy(l)},p8);var c=t.map(function(l){return u[l.id]});return i.state.gradientDepth===0&&(i.state.activeTape.forEach(function(l){var f,h;try{for(var p=le(l.saved),d=p.next();!d.done;d=p.next()){var m=d.value;m.dispose()}}catch(v){f={error:v}}finally{try{d&&!d.done&&(h=p.return)&&h.call(p)}finally{if(f)throw f.error}}}),i.state.activeTape=null),{value:o,grads:c}})},r.prototype.customGrad=function(e){var t=this;return Se(ym(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];Se(n.every(function(c){return c instanceof Ua}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var i,o={};n.forEach(function(c,l){o[l]=c});var s=function(c,l){return i=e.apply(void 0,Xe([],ee(Xe(Xe([],ee(n),!1),[l],!1)),!1)),Se(i.value instanceof Ua,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),Se(ym(i.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),i.value},u=function(c,l){var f=i.gradFunc(c,l),h=Array.isArray(f)?f:[f];Se(h.length===n.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),Se(h.every(function(d){return d instanceof Ua}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var p={};return h.forEach(function(d,m){p[m]=function(){return d}}),p};return t.runKernelFunc({forwardFunc:s,backwardsFunc:u,inputs:o})}},r.prototype.readSync=function(e){var t=this.state.tensorInfo.get(e);return t.backend.readSync(e)},r.prototype.read=function(e){var t=this.state.tensorInfo.get(e);return t.backend.read(e)},r.prototype.readToGPU=function(e,t){var n=this.state.tensorInfo.get(e);return n.backend.readToGPU(e,t)},r.prototype.time=function(e){return Ie(this,void 0,void 0,function(){var t,n;return Te(this,function(a){switch(a.label){case 0:return t=kh(),[4,this.backend.time(e)];case 1:return n=a.sent(),n.wallMs=kh()-t,[2,n]}})})},r.prototype.track=function(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(r.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!1,configurable:!0}),r.prototype.reset=function(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new _E;for(var e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},r})();Jm.nextTensorId=0;Jm.nextVariableId=0;function f8(r){var e=dN(di(r),"float32");return de.makeTensor(e,r,"float32")}function h8(){var r=mN();if(r._tfengine==null){var e=new Lj(r);r._tfengine=new Jm(e)}return Gj(r._tfengine.ENV),s8(function(){return r._tfengine}),r._tfengine}var de=h8();function p8(r,e){var t={a:r,b:e};return de.runKernel($m,t)}function d8(r,e){var t=r;if(ka(r))return e==="string"?[]:[r.length];if(IN(r)){var n=r.channels||"RGBA";return[r.height,r.width*n.length]}else if(CN(r))return[r.buffer.size/(e==null?4:gm(e))];if(!Array.isArray(r))return[];for(var a=[];Array.isArray(t)||ka(t)&&e!=="string";)a.push(t.length),t=t[0];return Array.isArray(r)&&er().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&_N(r,a,[]),a}function _N(r,e,t){if(t=t||[],!Array.isArray(r)&&!ka(r)){Se(e.length===0,function(){return"Element arr[".concat(t.join("]["),"] is a primitive, ")+"but should be an array/TypedArray of ".concat(e[0]," elements")});return}Se(e.length>0,function(){return"Element arr[".concat(t.join("]["),"] should be a primitive, ")+"but is an array of ".concat(r.length," elements")}),Se(r.length===e[0],function(){return"Element arr[".concat(t.join("]["),"] should have ").concat(e[0]," ")+"elements, but has ".concat(r.length," elements")});for(var n=e.slice(1),a=0;a<r.length;++a)_N(r[a],n,t.concat(a))}function FE(r,e,t,n){if(r!=="string_or_numeric"){if(r==null)throw new Error("Expected dtype cannot be null.");if(r!=="numeric"&&r!==e||r==="numeric"&&e==="string")throw new Error("Argument '".concat(t,"' passed to '").concat(n,"' must ")+"be ".concat(r," tensor, but got ").concat(e," tensor"))}}function Ne(r,e,t,n){if(n===void 0&&(n="numeric"),r instanceof NN())return FE(n,r.dtype,e,t),r;var a=Uh(r);if(a!=="string"&&["bool","int32","float32"].indexOf(n)>=0&&(a=n),FE(n,a,e,t),r==null||!ka(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string"){var i=r==null?"null":r.constructor.name;throw new Error("Argument '".concat(e,"' passed to '").concat(t,"' must be a ")+"Tensor or TensorLike, but got '".concat(i,"'"))}var o=d8(r,a);!ka(r)&&!Array.isArray(r)&&(r=[r]);var s=!0,u=a!=="string"?EN(r,a):al(r,[],s);return de.makeTensor(u,o,a)}function FN(r,e,t,n){if(n===void 0&&(n="numeric"),!Array.isArray(r))throw new Error("Argument ".concat(e," passed to ").concat(t," must be a ")+"`Tensor[]` or `TensorLike[]`");var a=r;return a.map(function(i,o){return Ne(i,"".concat(e,"[").concat(o,"]"),t,n)})}var v8="__op";function Ve(r){var e=Object.keys(r);if(e.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+"".concat(e.length," keys."));var t=e[0],n=r[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+v8;var a=function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];de.startScope(t);try{var s=n.apply(void 0,Xe([],ee(i),!1));return jm(s)&&console.error("Cannot return a Promise inside of tidy."),de.endScope(s),s}catch(u){throw de.endScope(null),u}};return Object.defineProperty(a,"name",{value:t,configurable:!0}),a}function m8(r,e){var t=Ne(r,"x","cast");if(!Oj(e))throw new Error("Failed to cast to unknown dtype ".concat(e));if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");var n={x:t},a={dtype:e};return de.runKernel(Wm,n,a)}var mt=Ve({cast_:m8});function g8(r,e){var t,n=Ne(r,"a","mul"),a=Ne(e,"b","mul");t=ee(ta(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return de.runKernel(HT,i)}var ye=Ve({mul_:g8});function y8(r,e){e===void 0&&(e=0);var t=Ne(r,"x","step"),n={x:t},a={alpha:e};return de.runKernel(hN,n,a)}var Qm=Ve({step_:y8}),RN={kernelName:NT,inputsToSave:["x"],gradFunc:function(r,e){var t=ee(e,1),n=t[0];return{x:function(){return ye(r,Qm(mt(n,"float32"),-1))}}}};function b8(r,e){var t,n=Ne(r,"a","floorDiv"),a=Ne(e,"b","floorDiv");t=ee(ta(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return de.runKernel($T,i)}var w8=Ve({floorDiv_:b8});function x8(r,e){var t,n=Ne(r,"a","div"),a=Ne(e,"b","div");if(t=ee(ta(n,a),2),n=t[0],a=t[1],n.dtype==="int32"&&a.dtype==="int32")return w8(n,a);var i={a:n,b:a},o={};return de.runKernel(MT,i,o)}var Ct=Ve({div_:x8});function k8(r){var e=Ne(r,"x","neg"),t={x:e};return de.runKernel(qT,t)}var Ea=Ve({neg_:k8});function S8(r,e,t,n){if(n==null)n=Uh(r);else if(n==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(CN(r)||IN(r)){if(n!=="float32"&&n!=="int32")throw new Error("Creating tensor from GPU data only supports "+"'float32'|'int32' dtype, while the dtype is ".concat(n,"."));return de.backend.createTensorFromGPUData(r,e||t,n)}if(!ka(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){pl(e);var a=di(e),i=di(t);Se(a===i,function(){return"Based on the provided shape, [".concat(e,"], the tensor should have ")+"".concat(a," values but has ").concat(i)});for(var o=0;o<t.length;++o){var s=t[o],u=o===t.length-1?s!==di(e.slice(o)):!0;Se(t[o]===e[o]||!u,function(){return"Error creating a new Tensor. Inferred shape "+"(".concat(t,") does not match the provided ")+"shape (".concat(e,"). ")})}}return!ka(r)&&!Array.isArray(r)&&(r=[r]),e=e||t,r=n!=="string"?EN(r,n):al(r,[],!0),de.makeTensor(r,e,n)}function hr(r,e){if((ka(r)&&e!=="string"||Array.isArray(r))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&ka(r)&&!(r instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");var t=[],n=[];return S8(r,t,n,e)}function E8(r){var e=Ne(r,"x","sqrt","float32"),t={x:e};return de.runKernel(aN,t)}var Ya=Ve({sqrt_:E8});function T8(r){var e=Ne(r,"x","square"),t={};return de.runKernel("Square",{x:e},t)}var pr=Ve({square_:T8});function N8(r,e){var t,n=Ne(r,"a","sub"),a=Ne(e,"b","sub");t=ee(ta(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return de.runKernel(uN,i)}var Hr=Ve({sub_:N8}),I8={kernelName:e5,inputsToSave:["x"],gradFunc:function(r,e){var t=ee(e,1),n=t[0];return{x:function(){var a=pr(mt(n,"float32")),i=Ya(Hr(hr(1),a));return Ea(Ct(r,i))}}}},C8={kernelName:t5,inputsToSave:["x"],gradFunc:function(r,e){var t=ee(e,1),n=t[0];return{x:function(){var a=Ya(Hr(pr(mt(n,"float32")),1));return Ct(r,a)}}}};function qr(r,e){for(var t=[],n=0;n<e.length;n++){var a=r[r.length-n-1],i=e.length-n-1,o=e[i];(a==null||a===1&&o>1)&&t.unshift(i)}return t}function Qr(r,e){for(var t=Math.max(r.length,e.length),n=new Array(t),a=0;a<t;a++){var i=r[r.length-a-1];i==null&&(i=1);var o=e[e.length-a-1];if(o==null&&(o=1),i===1)n[t-a-1]=o;else if(o===1)n[t-a-1]=i;else if(i!==o){var s="Operands could not be broadcast together with shapes "+"".concat(r," and ").concat(e,".");throw Error(s)}else n[t-a-1]=i}return n}function A8(r,e){var t=Ne(r,"x","reshape","string_or_numeric"),n={x:t},a={shape:e};return de.runKernel(YT,n,a)}var Ye=Ve({reshape_:A8});function D8(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=Ne(r,"x","sum");n.dtype==="bool"&&(n=mt(n,"int32"));var a={x:n},i={axis:e,keepDims:t};return de.runKernel(iN,a,i)}var ur=Ve({sum_:D8}),_8={kernelName:$m,inputsToSave:["a","b"],gradFunc:function(r,e){var t=ee(e,2),n=t[0],a=t[1],i=Qr(n.shape,a.shape),o=function(){var u=r,c=qr(n.shape,i);return c.length>0&&(u=ur(u,c)),Ye(u,n.shape)},s=function(){var u=r,c=qr(a.shape,i);return c.length>0&&(u=ur(u,c)),Ye(u,a.shape)};return{a:o,b:s}}};var F8={kernelName:r5,saveAllInputs:!0,gradFunc:function(r,e){var t={};return e.forEach(function(n,a){t[a]=function(){return r.clone()}}),t}};function R8(r){var e=Ne(r,"x","zerosLike"),t={x:e};return de.runKernel(fN,t)}var St=Ve({zerosLike_:R8}),O8={kernelName:n5,inputsToSave:["x"],gradFunc:function(r,e){var t=ee(e,1),n=t[0];return{x:function(){return St(n)}}}},P8={kernelName:a5,inputsToSave:["x"],gradFunc:function(r,e){var t=ee(e,1),n=t[0];return{x:function(){return St(n)}}}},M8={kernelName:i5,inputsToSave:["x"],gradFunc:function(r,e){var t=ee(e,1),n=t[0];return{x:function(){return Ct(r,Ya(Hr(hr(1),pr(mt(n,"float32")))))}}}};function B8(r,e){var t,n=Ne(r,"a","add"),a=Ne(e,"b","add");t=ee(ta(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return de.runKernel($m,i)}var dt=Ve({add_:B8}),L8={kernelName:o5,inputsToSave:["x"],gradFunc:function(r,e){var t=ee(e,1),n=t[0];return{x:function(){var a=Ya(dt(hr(1),pr(mt(n,"float32"))));return Ct(r,a)}}}},z8={kernelName:c5,inputsToSave:["a","b"],gradFunc:function(r,e){var t=ee(e,2),n=t[0],a=t[1],i=Qr(n.shape,a.shape),o=function(){var u=dt(pr(n),pr(a)),c=ye(r,Ct(a,u)),l=qr(n.shape,i);return l.length>0&&(c=ur(c,l)),Ye(c,n.shape)},s=function(){var u=dt(pr(n),pr(a)),c=Ea(ye(r,Ct(n,u))),l=qr(a.shape,i);return l.length>0&&(c=ur(c,l)),Ye(c,a.shape)};return{a:o,b:s}}},$8={kernelName:s5,inputsToSave:["x"],gradFunc:function(r,e){var t=ee(e,1),n=t[0];return{x:function(){return Ct(r,dt(pr(mt(n,"float32")),1))}}}},W8={kernelName:u5,inputsToSave:["x"],gradFunc:function(r,e){var t=ee(e,1),n=t[0];return{x:function(){return Ct(r,Hr(hr(1),pr(mt(n,"float32"))))}}}};function ON(r){return typeof r=="number"?[r,r,r]:r.length===2?[r[0],r[1],1]:r}function il(r){var e=ee(ON(r),3),t=e[0],n=e[1],a=e[2];return t===1&&n===1&&a===1}function PN(r,e){return il(r)||il(e)}function RE(r){return ON(r).every(function(e){return e>0})}function us(r,e,t){if(t!=null){if(typeof e=="string")throw Error("Error in ".concat(r,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(e,"."));if(typeof e=="number")Se(wh(e),function(){return"Error in ".concat(r,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(e,".")});else if(typeof e=="object")e.forEach(function(n){n.forEach(function(a){Se(wh(a),function(){return"Error in ".concat(r,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(a,".")})})});else throw Error("Error in ".concat(r,": Unknown padding parameter: ").concat(e))}}function G8(r,e,t,n,a,i){var o=Ne(r,"dy","avgPool3dGrad"),s=Ne(e,"input","avgPool3dGrad"),u=o,c=s,l=!1;s.rank===4&&(l=!0,u=Ye(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),c=Ye(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),Se(u.rank===5,function(){return"Error in avgPool3dGrad: dy must be rank 5 but got rank "+"".concat(u.rank,".")}),Se(c.rank===5,function(){return"Error in avgPool3dGrad: input must be rank 5 but got rank "+"".concat(c.rank,".")}),us("avgPool3dGrad",a,i);var f={dy:u,input:c},h={filterSize:t,strides:n,pad:a,dimRoundingMode:i},p=de.runKernel(p5,f,h);return l?Ye(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}var V8=Ve({avgPool3dGrad_:G8}),U8={kernelName:h5,inputsToSave:["x"],gradFunc:function(r,e,t){var n=ee(e,1),a=n[0],i=t.filterSize,o=t.strides,s=t.pad,u=t.dimRoundingMode;return{x:function(){return V8(r,a,i,o,s,u)}}}};function H8(r,e,t,n,a){var i=Ne(r,"dy","avgPoolGrad"),o=Ne(e,"input","avgPoolGrad");Se(o.rank===i.rank,function(){return"Rank of input (".concat(o.rank,") does not match rank of dy (").concat(i.rank,")")});var s=o,u=i,c=!1;o.rank===3&&(c=!0,s=Ye(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=Ye(i,[1,i.shape[0],i.shape[1],i.shape[2]])),Se(u.rank===4,function(){return"Error in avgPoolGrad: dy must be rank 4 but got rank "+"".concat(u.rank,".")}),Se(s.rank===4,function(){return"Error in avgPoolGrad: input must be rank 4 but got rank "+"".concat(s.rank,".")});var l={dy:u,input:s},f={filterSize:t,strides:n,pad:a},h=de.runKernel(f5,l,f);return c?Ye(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var q8=Ve({avgPoolGrad_:H8}),K8={kernelName:l5,inputsToSave:["x"],gradFunc:function(r,e,t){var n=ee(e,1),a=n[0],i=t.filterSize,o=t.strides,s=t.pad;return{x:function(){return q8(r,a,i,o,s)}}}};function j8(r,e,t,n){var a;t===void 0&&(t=!1),n===void 0&&(n=!1);var i=Ne(r,"a","matMul"),o=Ne(e,"b","matMul");a=ee(ta(i,o),2),i=a[0],o=a[1];var s={a:i,b:o},u={transposeA:t,transposeB:n};return de.runKernel(IT,s,u)}var io=Ve({matMul_:j8}),X8={kernelName:IT,inputsToSave:["a","b"],gradFunc:function(r,e,t){var n=ee(e,2),a=n[0],i=n[1],o=t.transposeA,s=t.transposeB;return!o&&!s?{a:function(){return io(r,i,!1,!0)},b:function(){return io(a,r,!0,!1)}}:!o&&s?{a:function(){return io(r,i,!1,!1)},b:function(){return io(r,a,!0,!1)}}:o&&!s?{a:function(){return io(i,r,!1,!0)},b:function(){return io(a,r,!1,!1)}}:{a:function(){return io(i,r,!0,!0)},b:function(){return io(r,a,!0,!0)}}}};function Y8(r,e,t){var n=Ne(r,"x","spaceToBatchND");Se(n.rank>=1+e.length,function(){return"input rank ".concat(n.rank," should be > than [blockShape] ").concat(e.length)}),Se(t.length===e.length,function(){return"paddings.shape[0] ".concat(t.length," must be equal to [blockShape] ").concat(e.length)}),Se(n.shape.reduce(function(o,s,u){return u>0&&u<=e.length?o&&(s+t[u-1][0]+t[u-1][1])%e[u-1]===0:o},!0),function(){return"input spatial dimensions ".concat(n.shape.slice(1)," with paddings ").concat(t.toString()," must be divisible by blockShapes ").concat(e.toString())});var a={x:n},i={blockShape:e,paddings:t};return de.runKernel(oN,a,i)}var Z8=Ve({spaceToBatchND_:Y8});var J8={kernelName:CT,gradFunc:function(r,e,t){var n=t.blockShape,a=t.crops;return{x:function(){return Z8(r,n,a)}}}};var Q8={kernelName:d5,gradFunc:function(r,e,t){for(var n=t,a=n.inputShape,i=n.shape,o=Array.from(i),s=a.length-1;s>=0;s--)if(a[s]===i[s])o[s]=1;else if(a[s]!==1)throw new Error("broadcastTo(): [".concat(a,"] cannot be broadcast to [").concat(i,"]."));for(var u=[],s=0;s<o.length;s++)o[s]>1&&u.push(s);return{x:function(){return ur(r,u,!0)}}}};var e7={kernelName:Wm,gradFunc:function(r){return{x:function(){return r.clone()}}}};var t7={kernelName:v5,gradFunc:function(r){return{x:function(){return St(r)}}}};function r7(r,e){var t,n=Ne(r,"a","greaterEqual","string_or_numeric"),a=Ne(e,"b","greaterEqual","string_or_numeric");t=ee(ta(n,a),2),n=t[0],a=t[1],Qr(n.shape,a.shape);var i={a:n,b:a};return de.runKernel(GT,i)}var eg=Ve({greaterEqual_:r7});function n7(r,e){var t,n=Ne(r,"a","lessEqual","string_or_numeric"),a=Ne(e,"b","lessEqual","string_or_numeric");t=ee(ta(n,a),2),n=t[0],a=t[1],Qr(n.shape,a.shape);var i={a:n,b:a};return de.runKernel(V5,i)}var tg=Ve({lessEqual_:n7});function a7(r,e){var t=Ne(r,"a","logicalAnd","bool"),n=Ne(e,"b","logicalAnd","bool");Qr(t.shape,n.shape);var a={a:t,b:n};return de.runKernel(H5,a)}var MN=Ve({logicalAnd_:a7});function i7(r){var e=Ne(r,"x","clone","string_or_numeric"),t={x:e};return de.runKernel(Gm,t)}var BN=Ve({clone_:i7});function o7(r,e){var t=Ne(r,"broadcastTo","x"),n=t.shape;if(pl(e),e.length<t.rank)throw new Error("broadcastTo(): shape.length=".concat(e.length," < input.rank=").concat(t.rank,"."));if(e.length>t.rank){for(var a=t.shape.slice();a.length<e.length;)a.unshift(1);t=Ye(t,a)}for(var i=t.shape,o=Array.from(e),s=e.length-1;s>=0;s--)if(i[s]===e[s])o[s]=1;else if(t.shape[s]!==1)throw new Error("broadcastTo(): [".concat(n,"] cannot be broadcast to [").concat(e,"]."));var u=o.map(function(f,h){return f>1?h:-1}).filter(function(f){return f>=0});if(u.length===0)return BN(t);var c={x:t},l={reps:o};return de.runKernel(Vm,c,l)}var im=Ve({broadcastTo_:o7});function s7(r,e,t){var n=Ne(e,"a","where"),a=Ne(t,"b","where"),i=Ne(r,"condition","where","bool"),o=Qr(Qr(i.shape,n.shape),a.shape),s=im(i,o),u=im(n,o),c=im(a,o),l={condition:s,t:u,e:c};return de.runKernel(QT,l)}var ns=Ve({where_:s7}),u7={kernelName:m5,inputsToSave:["x"],gradFunc:function(r,e,t){var n=ee(e,1),a=n[0],i=t.clipValueMin,o=t.clipValueMax;return{x:function(){return ns(MN(eg(a,i),tg(a,o)),r,St(r))}}}};var c7={kernelName:AT,inputsToSave:["x"],gradFunc:RN.gradFunc};function l7(r,e,t){t===void 0&&(t=0);var n=Ne(r,"x","split"),a={x:n},i={numOrSizeSplits:e,axis:t};return de.runKernel(sN,a,i)}var f7=Ve({split_:l7});var h7={kernelName:DT,saveAllInputs:!0,gradFunc:function(r,e,t){var n=e.map(function(u){return u.shape}),a=t.axis,i=is(a,e[0].shape)[0],o=n.map(function(u){return u[i]}),s=f7(r,o,i);return s.map(function(u){return function(){return u}})}};function p7(r,e,t,n,a,i,o){i===void 0&&(i="NHWC");var s=r;r.rank===3&&(s=Ye(r,[1,r.shape[0],r.shape[1],r.shape[2]]));var u=e;u.rank===3&&(u=Ye(e,[1,e.shape[0],e.shape[1],e.shape[2]])),Se(s.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+"".concat(s.shape,".")}),Se(u.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+"".concat(u.shape,".")}),Se(t.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+"".concat(t,".")});var c=i==="NHWC"?s.shape[3]:s.shape[1],l=i==="NHWC"?u.shape[3]:u.shape[1];Se(c===t[2],function(){return"Error in conv2dDerFilter: depth of input ".concat(c,") must ")+"match input depth in filter (".concat(t[2],".")}),Se(l===t[3],function(){return"Error in conv2dDerFilter: depth of dy (".concat(l,") must ")+"match output depth for filter (".concat(t[3],").")}),us("conv2dDerFilter",a,o);var f={x:s,dy:u},h={strides:n,pad:a,dataFormat:i,dimRoundingMode:o,filterShape:t};return de.runKernel(y5,f,h)}var LN=Ve({conv2DBackpropFilter_:p7});function d7(r,e,t,n,a,i,o){i===void 0&&(i="NHWC"),Se(r.length===e.rank,function(){return"Length of inShape "+"(".concat(r.length,") and rank of dy (").concat(e.rank,") must match")});var s=r,u=e,c=!1;e.rank===3&&(c=!0,u=Ye(e,[1,e.shape[0],e.shape[1],e.shape[2]]),s=[1,r[0],r[1],r[2]]),Se(s.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+"".concat(s.length,".")}),Se(u.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got "+"rank ".concat(u.rank)}),Se(t.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got "+"rank ".concat(t.rank)});var l=i==="NHWC"?s[3]:s[1],f=i==="NHWC"?u.shape[3]:u.shape[1];Se(l===t.shape[2],function(){return"Error in conv2dDerInput: depth of input (".concat(l,") must ")+"match input depth for filter ".concat(t.shape[2],".")}),Se(f===t.shape[3],function(){return"Error in conv2dDerInput: depth of output (".concat(f,") must ")+"match output depth for filter ".concat(t.shape[3],".")}),us("conv2dDerInput",a,o);var h={dy:u,filter:t},p={strides:n,pad:a,dataFormat:i,dimRoundingMode:o,inputShape:s},d=de.runKernel(FT,h,p);return c?Ye(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var v7=Ve({conv2DBackpropInput_:d7}),m7={kernelName:_T,inputsToSave:["x","filter"],gradFunc:function(r,e,t){var n=ee(e,2),a=n[0],i=n[1],o=t.dilations,s=t.strides,u=t.pad,c=t.dataFormat;return Se(il(o),function(){return"Error in gradient of conv2D: dilation rates greater than 1 "+"are not yet supported in gradients. Got dilations '".concat(o,"'")}),{x:function(){return v7(a.shape,r,i,s,u,c)},filter:function(){return LN(a,r,i.shape,s,u,c)}}}};function g7(r,e,t,n,a,i,o){a===void 0&&(a="NHWC"),i===void 0&&(i=[1,1]);var s=Ne(r,"x","conv2d","float32"),u=Ne(e,"filter","conv2d","float32"),c=s,l=!1;s.rank===3&&(l=!0,c=Ye(s,[1,s.shape[0],s.shape[1],s.shape[2]])),Se(c.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank ".concat(c.rank,".")}),Se(u.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+"".concat(u.rank,".")}),us("conv2d",n,o);var f=a==="NHWC"?c.shape[3]:c.shape[1];Se(f===u.shape[2],function(){return"Error in conv2d: depth of input (".concat(f,") must match ")+"input depth for filter ".concat(u.shape[2],".")}),Se(PN(t,i),function(){return"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(i,"'")}),Se(RE(i),function(){return"Error in conv2D: Dilated rates should be larger than 0."}),Se(RE(t),function(){return"Error in conv2D: Strides should be larger than 0."});var h={x:c,filter:u},p={strides:t,pad:n,dataFormat:a,dilations:i,dimRoundingMode:o},d=de.runKernel(_T,h,p);return l?Ye(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var y7=Ve({conv2d_:g7}),b7={kernelName:FT,inputsToSave:["dy","filter"],gradFunc:function(r,e,t){var n=ee(e,2),a=n[0],i=n[1],o=t.strides,s=t.pad,u=t.dataFormat,c=t.dimRoundingMode;return{dy:function(){return y7(r,i,o,s,u,1,c)},filter:function(){return LN(r,a,i.shape,o,s,u,c)}}}};function w7(r,e,t,n,a){var i=r;r.rank===4&&(i=Ye(r,[1,r.shape[0],r.shape[1],r.shape[2],r.shape[3]]));var o=e;o.rank===4&&(o=Ye(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),Se(i.rank===5,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+"".concat(i.shape,".")}),Se(o.rank===5,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+"".concat(o.shape,".")}),Se(t.length===5,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+"".concat(t,".")}),Se(i.shape[4]===t[3],function(){return"Error in conv3dDerFilter: depth of input ".concat(i.shape[4],") must ")+"match input depth in filter (".concat(t[3],".")}),Se(o.shape[4]===t[4],function(){return"Error in conv3dDerFilter: depth of dy (".concat(o.shape[4],") must ")+"match output depth for filter (".concat(t[4],").")});var s={x:i,dy:o},u={strides:n,pad:a,filterShape:t};return de.runKernel(w5,s,u)}var x7=Ve({conv3DBackpropFilter_:w7});function k7(r,e,t,n,a){Se(r.length===e.rank,function(){return"Length of inShape "+"(".concat(r.length,") and rank of dy (").concat(e.rank,") must match")});var i=r,o=e,s=!1;e.rank===4&&(s=!0,o=Ye(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),i=[1,r[0],r[1],r[2],r[3]]);var u=i[4],c=o.shape[4];Se(i.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+"".concat(i.length,".")}),Se(o.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got "+"rank ".concat(o.rank)}),Se(t.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got "+"rank ".concat(t.rank)}),Se(u===t.shape[3],function(){return"Error in conv3dDerInput: depth of input (".concat(u,") must ")+"match input depth for filter ".concat(t.shape[3],".")}),Se(c===t.shape[4],function(){return"Error in conv3dDerInput: depth of output (".concat(c,") must ")+"match output depth for filter ".concat(t.shape[4],".")});var l={dy:o,filter:t},f={pad:a,strides:n,inputShape:i},h=de.runKernel(x5,l,f);return s?Ye(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var S7=Ve({conv3DBackpropInput_:k7}),E7={kernelName:b5,inputsToSave:["x","filter"],gradFunc:function(r,e,t){var n=t.dilations,a=t.strides,i=t.pad;Se(il(n),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are "+"not yet supported in gradients. Got dilations '".concat(n,"'")});var o=ee(e,2),s=o[0],u=o[1];return{x:function(){return S7(s.shape,r,u,a,i)},filter:function(){return x7(s,r,u.shape,a,i)}}}};function T7(r){var e=Ne(r,"x","sin","float32"),t={x:e};return de.runKernel(tN,t)}var N7=Ve({sin_:T7}),I7={kernelName:RT,inputsToSave:["x"],gradFunc:function(r,e){var t=ee(e,1),n=t[0];return{x:function(){return ye(Ea(N7(mt(n,"float32"))),r)}}}};function C7(r){var e=Ne(r,"x","sinh"),t={x:e};return de.runKernel(rN,t)}var A7=Ve({sinh_:C7}),D7={kernelName:OT,inputsToSave:["x"],gradFunc:function(r,e){var t=ee(e,1),n=t[0];return{x:function(){return ye(A7(mt(n,"float32")),r)}}}};function _7(r,e){for(var t=0;t<r.length;++t)if(r[r.length-t-1]!==e-1-t)return!1;return!0}function F7(r,e,t){for(var n=r.length+e.length,a=[],i=0,o=0,s=0;s<n;s++)t.indexOf(s)===-1?a.push(r[i++]):a.push(e[o++]);return a}function R7(r,e){for(var t=[],n=r.length,a=0;a<n;a++)e.indexOf(a)===-1&&t.push(r[a]);var i=e.map(function(o){return r[o]});return[t,i]}function OE(r,e){var t=e.map(function(n){return 1});return F7(r,t,e)}function zN(r,e){if(_7(r,e))return null;for(var t=[],n=0;n<e;++n)r.indexOf(n)===-1&&t.push(n);return r.forEach(function(a){return t.push(a)}),t}function rg(r){return r.map(function(e,t){return[t,e]}).sort(function(e,t){return e[1]-t[1]}).map(function(e){return e[0]})}function O7(r,e,t,n){e===void 0&&(e=0),t===void 0&&(t=!1),n===void 0&&(n=!1);var a=Ne(r,"x","cumsum"),i={x:a},o={axis:e,exclusive:t,reverse:n};return de.runKernel(PT,i,o)}var P7=Ve({cumsum_:O7});function Ir(r,e){return de.tidy(r,e)}function Qn(r){var e=AN(r);e.forEach(function(t){return t.dispose()})}function M7(r){return de.keep(r)}function B7(r,e){var t=Ne(r,"real","complex"),n=Ne(e,"imag","complex");_j(t.shape,n.shape,"real and imag shapes, ".concat(t.shape," and ").concat(n.shape,", ")+"must match in call to tf.complex().");var a={real:t,imag:n};return de.runKernel(g5,a)}var ng=Ve({complex_:B7});function L7(r){var e=Ne(r,"input","imag"),t={input:e};return de.runKernel(B5,t)}var z7=Ve({imag_:L7});function $7(r){var e=Ne(r,"input","real"),t={input:e};return de.runKernel(lj,t)}var W7=Ve({real_:$7});function G7(r,e,t){var n=Ne(r,"x","transpose");if(e==null&&(e=n.shape.map(function(o,s){return s}).reverse()),Se(n.rank===e.length,function(){return"Error in transpose: rank of input ".concat(n.rank," ")+"must match length of perm ".concat(e,".")}),e.forEach(function(o){Se(o>=0&&o<n.rank,function(){return"All entries in 'perm' must be between 0 and ".concat(n.rank-1)+" but got ".concat(e)})}),n.rank<=1)return n.clone();var a={x:n},i={perm:e};return n.dtype==="complex64"?Ir(function(){var o=W7(n),s=z7(n);return o=de.runKernel(hh,{x:o},i),s=de.runKernel(hh,{x:s},i),t&&(s=Ea(s)),ng(o,s)}):de.runKernel(hh,a,i)}var yu=Ve({transpose_:G7}),V7={kernelName:PT,inputsToSave:["x"],gradFunc:function(r,e,t){var n=ee(e,1),a=n[0],i=t.axis,o=t.exclusive,s=t.reverse;return{x:function(){var u=zN([i],a.rank),c=P7(r,i,o,!s);return u!=null&&(c=yu(c,u)),c}}}};function U7(r,e,t,n,a,i,o){i===void 0&&(i=[1,1]);var s=r;r.rank===3&&(s=Ye(r,[1,r.shape[0],r.shape[1],r.shape[2]]));var u=e;u.rank===3&&(u=Ye(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var c={x:s,dy:u},l={strides:n,pad:a,dimRoundingMode:o,dilations:i,filterShape:t};return de.runKernel(E5,c,l)}var H7=Ve({depthwiseConv2dNativeBackpropFilter_:U7});function q7(r,e,t,n,a,i,o){i===void 0&&(i=[1,1]);var s=e,u=!1;e.rank===3&&(u=!0,s=Ye(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var c={dy:s,filter:t},l={strides:n,pad:a,dimRoundingMode:o,dilations:i,inputShape:r},f=de.runKernel(T5,c,l);return u?Ye(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var K7=Ve({depthwiseConv2dNativeBackpropInput_:q7}),j7={kernelName:S5,inputsToSave:["x","filter"],gradFunc:function(r,e,t){var n=t.dilations,a=t.strides,i=t.pad,o=t.dimRoundingMode,s=n??[1,1];Se(il(s),function(){return"Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations "+"'".concat(s,"'")});var u=ee(e,2),c=u[0],l=u[1];return Se(c.rank===4,function(){return"Error in gradient of depthwiseConv2dNative: input must be "+"rank 4, but got rank ".concat(c.rank,".")}),Se(l.rank===4,function(){return"Error in gradient of depthwiseConv2dNative: filter must be "+"rank 4, but got rank ".concat(l.rank,".")}),Se(c.shape[3]===l.shape[2],function(){return"Error in gradient of depthwiseConv2d: number of input "+"channels (".concat(c.shape[3],") must match the inChannels dimension ")+"in filter ".concat(l.shape[2],".")}),Se(PN(a,s),function(){return"Error in gradient of depthwiseConv2d: Either strides or "+"dilations must be  1. Got strides ".concat(a," and dilations ")+"'".concat(s,"'.")}),us("depthwiseConv2d",i,o),{x:function(){return K7(c.shape,r,l,a,i,s,o)},filter:function(){return H7(c,r,l.shape,a,i,s,o)}}}},X7={kernelName:N5,inputsToSave:["x","filter"],gradFunc:function(r,e,t){var n=ee(e,2),a=n[0],i=n[1],o={x:a,filter:i,dy:r},s={x:a,filter:i,dy:r};return{x:function(){return de.runKernel(I5,o,t)},filter:function(){return de.runKernel(C5,s,t)}}}},Y7={kernelName:A5,outputsToSave:[!0],gradFunc:function(r,e){var t=ee(e,1),n=t[0],a={dy:r,y:n};return{x:function(){return de.runKernel(D5,a)}}}};function Z7(r){var e=Ne(r,"x","exp"),t={x:e};return de.runKernel(BT,t)}var Hh=Ve({exp_:Z7}),J7={kernelName:_5,inputsToSave:["x"],gradFunc:function(r,e){var t=ee(e,1),n=t[0],a=ye(Hh(Ea(pr(n))),2/Math.sqrt(Math.PI));return{x:function(){return ye(r,a)}}}},Q7={kernelName:BT,outputsToSave:[!0],gradFunc:function(r,e){var t=ee(e,1),n=t[0];return{x:function(){return ye(r,n)}}}},eX={kernelName:LT,inputsToSave:["input"],gradFunc:function(r,e){var t=ee(e,1),n=t[0];return{input:function(){return Ye(r,n.shape)}}}},tX={kernelName:R5,inputsToSave:["x"],gradFunc:function(r,e){var t=ee(e,1),n=t[0];return{x:function(){return ye(r,Hh(n))}}}};var rX={kernelName:zT,gradFunc:function(r){return{x:function(){return St(r)}}}},nX={kernelName:$T,inputsToSave:["a","b"],gradFunc:function(r,e){var t=ee(e,2),n=t[0],a=t[1],i=Qr(n.shape,a.shape),o=function(){var u=Ct(r,mt(a,"float32")),c=qr(n.shape,i);return c.length>0?Ye(ur(u,c),n.shape):u},s=function(){var u=ye(r,mt(n,"float32")),c=qr(a.shape,i);c.length>0&&(u=Ye(ur(u,c),a.shape));var l=pr(a);return Ea(Ct(u,mt(l,"float32")))};return{a:o,b:s}}};function aX(r){var e=Ne(r,"x","rsqrt","float32"),t={x:e};return de.runKernel(JT,t)}var iX=Ve({rsqrt_:aX});function oX(r,e){var t=Ne(r,"x","tile","string_or_numeric");Se(t.rank===e.length,function(){return"Error in transpose: rank of input ".concat(t.rank," ")+"must match length of reps ".concat(e,".")});var n={x:t},a={reps:e};return de.runKernel(Vm,n,a)}var sX=Ve({tile_:oX}),uX={kernelName:P5,inputsToSave:["x","mean","variance","scale"],gradFunc:function(r,e,t){var n=t.varianceEpsilon,a=ee(e,4),i=a[0],o=a[1],s=a[2],u=a[3],c=u??hr(1),l=qr(o.shape,i.shape),f=[];if(o.rank===1){for(var h=0;h<i.shape.length-1;++h)f.push(i.shape[h]);f.push(1)}var p=Hr(i,o),d=ye(r,c),m=iX(dt(s,hr(n))),v=ye(ye(ye(m,m),m),hr(-.5)),g=function(){return o.rank===1?Ye(ye(ye(r,sX(Ye(m,[1,1,1,o.shape[0]]),f)),c),i.shape):Ye(ye(ye(r,m),c),i.shape)},y=function(){var S=ye(ye(m,hr(-1)),d);return o.rank===1&&(S=ur(S,l)),Ye(S,o.shape)},w=function(){var S=ye(ye(v,p),d);return o.rank===1&&(S=ur(S,l)),Ye(S,o.shape)},b=function(){var S=ye(p,m),T=ye(r,S);return o.rank===1&&(T=ur(T,l)),Ye(T,o.shape)},x=function(){var S=r;return o.rank===1&&(S=ur(S,l)),Ye(S,o.shape)};return{x:g,mean:y,variance:w,scale:b,offset:x}}};function cX(r,e){e===void 0&&(e=0);var t=FN(r,"tensors","stack","string_or_numeric");Se(t.length>=1,function(){return"Pass at least one tensor to tf.stack"}),t.length>0&&Se(e<=t[0].rank,function(){return"Axis must be <= rank of the tensor"});var n=t,a={axis:e};return de.runKernel(KT,n,a)}var $N=Ve({stack_:cX});function lX(r,e,t){var n=Ne(r,"x","unsortedSegmentSum"),a=Ne(e,"segmentIds","unsortedSegmentSum","int32");Se(wh(t),function(){return"numSegments must be of dtype int"});var i={x:n,segmentIds:a},o={numSegments:t};return de.runKernel(lN,i,o)}var fX=Ve({unsortedSegmentSum_:lX}),hX={kernelName:WT,inputsToSave:["x","indices"],gradFunc:function(r,e,t){var n=ee(e,2),a=n[0],i=n[1],o=t.axis,s=t.batchDims,u=is(o,a.shape)[0],c=function(p,d,m){return function(){var v=p.shape,g=d.size,y=v.slice(0,u),w=y.length,b=v.slice(o,v.length).slice(1),x=b.length,S=PE(0,w),T=PE(w+1,w+1+x),N=ME([y,[g],b]),C=Ye(m,N),R=Ye(d,[g]),_=ME([[w],S,T]),P=yu(C,_),$=fX(P,R,p.shape[u]),z=rg(_);return $=yu($,z),$}};if(s===1){var l=a.shape[0],f=a.split(l,0),h=function(){var p=$N(f.map(function(d,m){return c(d,i.slice(m,1),r.slice(m,1))()}));return p.reshape(a.shape)};return{x:h,indices:function(){return i}}}else return{x:c(a,i,r),indices:function(){return i}}}};function PE(r,e){for(var t=[],n=r;n<e;++n)t.push(n);return t}function ME(r){for(var e=[],t=0;t<r.length;++t)for(var n=0;n<r[t].length;++n)e.push(r[t][n]);return e}var pX={kernelName:GT,inputsToSave:["a","b"],gradFunc:function(r,e){var t=ee(e,2),n=t[0],a=t[1];return{a:function(){return St(n)},b:function(){return St(a)}}}};var dX={kernelName:Gm,gradFunc:function(r){return{x:function(){return mt(r,"float32")}}}};var vX={kernelName:L5,gradFunc:function(r){return{x:function(){return St(r)}}}};var mX={kernelName:z5,gradFunc:function(r){return{x:function(){return St(r)}}}};var gX={kernelName:$5,gradFunc:function(r){return{x:function(){return St(r)}}}};function yX(r,e){var t,n=Ne(r,"a","greater","string_or_numeric"),a=Ne(e,"b","greater","string_or_numeric");t=ee(ta(n,a),2),n=t[0],a=t[1],Qr(n.shape,a.shape);var i={a:n,b:a};return de.runKernel(M5,i)}var dl=Ve({greater_:yX}),bX={kernelName:W5,inputsToSave:["x"],gradFunc:function(r,e,t){var n=ee(e,1),a=n[0],i=t.alpha,o=dl(a,0);return{x:function(){return ns(o,r,ye(r,i))}}}},wX={kernelName:U5,inputsToSave:["x"],gradFunc:function(r,e){var t=ee(e,1),n=t[0];return{x:function(){return Ct(r,dt(n,1))}}}},xX={kernelName:VT,inputsToSave:["x"],gradFunc:function(r,e){var t=ee(e,1),n=t[0];return{x:function(){return Ct(r,mt(n,"float32"))}}}},kX={kernelName:K5,inputsToSave:[],outputsToSave:[!0],gradFunc:function(r,e,t){var n=ee(e,1),a=n[0],i=t.axis;return{logits:function(){var o=!0,s=Hh(a);return Hr(r,ye(ur(r,i,o),s))}}}};function SX(r,e,t,n,a,i,o){n===void 0&&(n=5),a===void 0&&(a=1),i===void 0&&(i=1),o===void 0&&(o=.5);var s={x:r,y:e,dy:t},u={depthRadius:n,bias:a,alpha:i,beta:o};return de.runKernel(X5,s,u)}var EX=Ve({localResponseNormalizationBackprop_:SX}),TX={kernelName:j5,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(r,e,t){var n=ee(e,2),a=n[0],i=n[1],o=t.depthRadius,s=t.bias,u=t.alpha,c=t.beta;return{x:function(){return EX(a,i,r,o,s,u,c)}}}};function NX(r,e){var t,n=Ne(r,"a","equal","string_or_numeric"),a=Ne(e,"b","equal","string_or_numeric");t=ee(ta(n,a),2),n=t[0],a=t[1],Qr(n.shape,a.shape);var i={a:n,b:a};return de.runKernel(F5,i)}var IX=Ve({equal_:NX});function WN(r,e,t,n){return e.rank<t.rank&&(e=Ye(e,OE(e.shape,n))),r.rank<t.rank&&(r=Ye(r,OE(r.shape,n))),{x:function(){var a=ye(r,mt(IX(t,e),r.dtype));return a}}}var BE={kernelName:Y5,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(r,e,t){var n=t,a=n.reductionIndices,i=e[0],o=e[1],s=is(a,i.shape),u=WN(r,o,i,s);return{x:function(){return u.x()}}}};function CX(r,e){var t,n=Ne(r,"a","less","string_or_numeric"),a=Ne(e,"b","less","string_or_numeric");t=ee(ta(n,a),2),n=t[0],a=t[1],Qr(n.shape,a.shape);var i={a:n,b:a};return de.runKernel(G5,i)}var AX=Ve({less_:CX}),DX={kernelName:UT,inputsToSave:["a","b"],gradFunc:function(r,e){var t=ee(e,2),n=t[0],a=t[1],i=function(){return ye(r,mt(eg(n,a),"float32"))},o=function(){return ye(r,mt(AX(n,a),"float32"))};return{a:i,b:o}}};function _X(r,e,t,n,a,i,o){var s=Ne(r,"dy","maxPool3dGrad"),u=Ne(e,"input","maxPool3dGrad"),c=Ne(t,"output","maxPool3dGrad"),l=s,f=u,h=c,p=!1;u.rank===4&&(p=!0,l=Ye(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]]),f=Ye(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),h=Ye(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),Se(l.rank===5,function(){return"Error in maxPool3dGrad: dy must be rank 5 but got rank "+"".concat(l.rank,".")}),Se(f.rank===5,function(){return"Error in maxPool3dGrad: input must be rank 5 but got rank "+"".concat(f.rank,".")}),Se(h.rank===5,function(){return"Error in maxPool3dGrad: output must be rank 5 but got rank "+"".concat(h.rank,".")}),us("maxPool3dGrad",i,o);var d={dy:l,input:f,output:h},m={filterSize:n,strides:a,pad:i,dimRoundingMode:o},v=de.runKernel(ej,d,m);return p?Ye(v,[v.shape[1],v.shape[2],v.shape[3],v.shape[4]]):v}var FX=Ve({maxPool3dGrad_:_X}),RX={kernelName:Q5,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(r,e,t){var n=ee(e,2),a=n[0],i=n[1],o=t.filterSize,s=t.strides,u=t.pad,c=t.dimRoundingMode;return{x:function(){return FX(r,a,i,o,s,u,c)}}}};function OX(r,e,t,n,a,i,o){var s=Ne(r,"dy","maxPoolGrad"),u=Ne(e,"input","maxPoolGrad"),c=Ne(t,"output","maxPoolGrad");Se(u.rank===s.rank,function(){return"Rank of input (".concat(u.rank,") does not match rank of dy ")+"(".concat(s.rank,")")}),Se(s.rank===4,function(){return"Error in maxPoolGrad: dy must be rank 4 but got rank "+"".concat(s.rank,".")}),Se(u.rank===4,function(){return"Error in maxPoolGrad: input must be rank 4 but got rank "+"".concat(u.rank,".")}),us("maxPoolGrad",i,o);var l={dy:s,input:u,output:c},f={filterSize:n,strides:a,pad:i,dimRoundingMode:o};return de.runKernel(J5,l,f)}var PX=Ve({maxPoolGrad_:OX}),MX={kernelName:Z5,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(r,e,t){var n=ee(e,2),a=n[0],i=n[1],o=t.filterSize,s=t.strides,u=t.pad;return{x:function(){return PX(r,a,i,o,s,u)}}}};function Eh(r,e){if(e===void 0&&(e="float32"),pl(r),e==="complex64"){var t=Eh(r,"float32"),n=Eh(r,"float32");return ng(t,n)}var a=Km(di(r),e);return de.makeTensor(a,r,e)}function qh(r,e){if(e===void 0&&(e="float32"),pl(r),e==="complex64"){var t=qh(r,"float32"),n=Eh(r,"float32");return ng(t,n)}var a=dN(di(r),e);return de.makeTensor(a,r,e)}var BX={kernelName:tj,inputsToSave:["x"],gradFunc:function(r,e,t){var n=ee(e,1),a=n[0],i=t.axis,o=is(i,a.shape),s=R7(a.shape,o),u=s[1],c=di(u),l=function(){var f=a.shape.slice();o.forEach(function(d){f[d]=1});var h=Ye(r,f),p=Ct(ye(h,qh(a.shape,"float32")),c);return p};return{x:l}}},LX={kernelName:rj,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(r,e,t){var n=t,a=n.axis,i=ee(e,2),o=i[0],s=i[1],u=is(a,o.shape),c=WN(r,s,o,u);return{x:function(){return c.x()}}}},zX={kernelName:nj,inputsToSave:["a","b"],gradFunc:function(r,e){var t=ee(e,2),n=t[0],a=t[1],i=function(){return ye(r,mt(tg(n,a),"float32"))},o=function(){return ye(r,mt(dl(n,a),"float32"))};return{a:i,b:o}}};function $X(r,e,t){var n=Ne(r,"x","slice","string_or_numeric");if(n.rank===0)throw new Error("Slicing scalar is not possible");var a={x:n},i={begin:e,size:t};return de.runKernel(eN,a,i)}var du=Ve({slice_:$X});var WX={kernelName:aj,inputsToSave:["x"],gradFunc:function(r,e,t){var n=e[0],a=t.paddings,i=a.map(function(o){return o[0]});return{x:function(){return du(r,i,n.shape)}}}};function GX(r){var e=Ne(r,"x","floor","float32"),t={x:e};return de.runKernel(zT,t)}var VX=Ve({floor_:GX}),UX={kernelName:ij,inputsToSave:["a","b"],gradFunc:function(r,e){var t=ee(e,2),n=t[0],a=t[1],i=Qr(n.shape,a.shape),o=function(){var u=qr(n.shape,i);return u.length>0?Ye(ur(r,u),n.shape):r},s=function(){var u=ye(r,Ea(VX(Ct(n,a)))),c=qr(a.shape,i);return c.length>0?Ye(ur(u,c),a.shape):u};return{a:o,b:s}}},HX={kernelName:HT,inputsToSave:["a","b"],gradFunc:function(r,e){var t=ee(e,2),n=t[0],a=t[1],i=Qr(n.shape,a.shape),o=function(){var u=ye(r,mt(a,"float32")),c=qr(n.shape,i);return c.length>0?Ye(ur(u,c),n.shape):u},s=function(){var u=ye(r,mt(n,"float32")),c=qr(a.shape,i);return c.length>0?Ye(ur(u,c),a.shape):u};return{a:o,b:s}}};var qX={kernelName:qT,gradFunc:function(r){return{x:function(){return Ea(r)}}}};var KX={kernelName:sj,inputsToSave:["indices"],gradFunc:function(r,e){var t=e[0];return{indices:function(){return Eh(t.shape,"float32")}}}};var jX={kernelName:oj,gradFunc:function(r){return{x:function(){return St(r)}}}};function XX(r,e){e===void 0&&(e=0);var t=Ne(r,"x","unstack","string_or_numeric");Se(e>=-t.shape.length&&e<t.shape.length,function(){return"Axis = ".concat(e," is not in [-").concat(t.shape.length,", ").concat(t.shape.length,")")});var n={value:t},a={axis:e};return de.runKernel(cN,n,a)}var YX=Ve({unstack_:XX});var ZX={kernelName:KT,saveAllInputs:!0,gradFunc:function(r,e,t){var n=t.axis,a=YX(r,n);return a.map(function(i){return function(){return i}})}};var LE={kernelName:jT,inputsToSave:["x"],gradFunc:function(r,e,t){var n=e[0],a=t.paddings,i=a.map(function(o){return o[0]});return{x:function(){return du(r,i,n.shape)}}}};function JX(r){var e=Ne(r,"x","log","float32"),t={x:e};return de.runKernel(VT,t)}var QX=Ve({log_:JX});function e9(r,e){var t,n=Ne(r,"base","pow"),a=Ne(e,"exp","pow");t=ee(ta(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return de.runKernel(XT,i)}var Th=Ve({pow_:e9}),t9={kernelName:XT,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:function(r,e){var t=ee(e,3),n=t[0],a=t[1],i=t[2],o=n,s=a,u=Qr(o.shape,s.shape),c=function(){var f=mt(s,"float32"),h=ye(r,ye(f,Th(o,Hr(f,hr(1))))),p=qr(o.shape,u);return p.length>0&&(h=ur(h,p)),Ye(h,o.shape)},l=function(){var f=dl(o,0),h=ns(f,QX(o),St(o)),p=ye(r,ye(i,h)),d=qr(s.shape,u);return d.length>0&&(p=ur(p,d)),Ye(p,s.shape)};return{a:c,b:l}}},r9={kernelName:uj,inputsToSave:["x","alpha"],gradFunc:function(r,e){var t=ee(e,2),n=t[0],a=t[1],i=dl(n,0);return{x:function(){return ns(i,r,ye(r,a))},alpha:function(){var o=ns(i,St(r),ye(r,n)),s=qr(a.shape,r.shape);return s.length>0&&(o=ur(o,s)),Ye(o,a.shape)}}}};function n9(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var yn=er();yn.registerFlag("DEBUG",function(){return!1},function(r){r&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});yn.registerFlag("IS_BROWSER",function(){return n9()});yn.registerFlag("IS_NODE",function(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"});yn.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)});yn.registerFlag("IS_SAFARI",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor)});yn.registerFlag("PROD",function(){return!1});yn.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return yn.getBool("DEBUG")});yn.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0});yn.registerFlag("IS_TEST",function(){return!1});yn.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",function(){return yn.getBool("DEBUG")});yn.registerFlag("WRAP_TO_IMAGEBITMAP",function(){return!1});yn.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",function(){return!1});yn.registerFlag("USE_SETTIMEOUTCUSTOM",function(){return!1});var vl=(function(){function r(e){if(this.shards=[],this.previousShardIndex=0,e!=null&&(e instanceof Array||(e=[e]),e=e.map(function(o){return ka(o)?o.buffer:o}),e.length!==0)){this.bufferUniformSize=e[0].byteLength;for(var t=0,n=0;n<e.length;n++){var a=e[n];n!==e.length-1&&a.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);var i=t+a.byteLength;this.shards.push({buffer:a,start:t,end:i}),t=i}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}}return r.join=function(e){return new r(e).slice()},r.prototype.slice=function(e,t){if(e===void 0&&(e=0),t===void 0&&(t=this.byteLength),this.shards.length===0)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,t=isNaN(Number(t))?0:t,e=Math.max(0,e),t=Math.min(this.byteLength,t),t<=e)return new ArrayBuffer(0);var n=this.findShardForByte(e);if(n===-1)throw new Error("Could not find start shard for byte ".concat(e));for(var a=t-e,i=new ArrayBuffer(a),o=new Uint8Array(i),s=0,u=n;u<this.shards.length;u++){var c=this.shards[u],l=e+s,f=l-c.start,h=s,p=Math.min(t,c.end),d=p-c.start,m=new Uint8Array(c.buffer,f,d-f);if(o.set(m,h),s+=m.length,t<c.end)break}return i},r.prototype.findShardForByte=function(e){if(this.shards.length===0||e<0||e>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function t(a){return e<a.start?-1:e>=a.end?1:0}if(t(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;var n=a9(this.shards,t);return n===-1?-1:(this.previousShardIndex=n,this.previousShardIndex)},r})();function a9(r,e){for(var t=0,n=r.length;t<=n;){var a=Math.floor((n-t)/2)+t,i=e(r[a]);if(i===0)return a;i<0?n=a:t=a+1}return-1}var ag=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function zE(r){return ag?Buffer.byteLength(r,"utf8"):new Blob([r]).size}function i9(r){if(ag)return Buffer.from(r).toString("base64");for(var e=new Uint8Array(r),t="",n=0,a=e.length;n<a;n++)t+=String.fromCharCode(e[n]);return btoa(t)}function o9(r){if(ag){var e=Buffer.from(r,"base64");return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}for(var t=atob(r),n=new Uint8Array(t.length),a=0;a<t.length;++a)n.set([t.charCodeAt(a)],a);return n.buffer}function GN(r,e){var t={modelTopology:r.modelTopology,format:r.format,generatedBy:r.generatedBy,convertedBy:r.convertedBy,weightsManifest:e};return r.signature!=null&&(t.signature=r.signature),r.userDefinedMetadata!=null&&(t.userDefinedMetadata=r.userDefinedMetadata),r.modelInitializer!=null&&(t.modelInitializer=r.modelInitializer),r.initializerSignature!=null&&(t.initializerSignature=r.initializerSignature),r.trainingConfig!=null&&(t.trainingConfig=r.trainingConfig),t}function s9(r,e,t){var n={modelTopology:r.modelTopology,format:r.format,generatedBy:r.generatedBy,convertedBy:r.convertedBy};if(r.trainingConfig!=null&&(n.trainingConfig=r.trainingConfig),r.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!t)throw new Error("modelJSON has weightsManifest but weightData is null");n.weightSpecs=e,n.weightData=t}return r.signature!=null&&(n.signature=r.signature),r.userDefinedMetadata!=null&&(n.userDefinedMetadata=r.userDefinedMetadata),r.modelInitializer!=null&&(n.modelInitializer=r.modelInitializer),r.initializerSignature!=null&&(n.initializerSignature=r.initializerSignature),n}function u9(r,e){return Ie(this,void 0,void 0,function(){var t,n,a;return Te(this,function(i){switch(i.label){case 0:return r.weightsManifest==null?[3,2]:[4,e(r.weightsManifest)];case 1:a=ee.apply(void 0,[i.sent(),2]),t=a[0],n=a[1],i.label=2;case 2:return[2,s9(r,t,n)]}})})}function Kh(r){if(r.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:r.modelTopology==null?0:zE(JSON.stringify(r.modelTopology)),weightSpecsBytes:r.weightSpecs==null?0:zE(JSON.stringify(r.weightSpecs)),weightDataBytes:r.weightData==null?0:new vl(r.weightData).byteLength}}function $E(r){var e,t,n=[];try{for(var a=le(r),i=a.next();!i.done;i=a.next()){var o=i.value;n.push.apply(n,Xe([],ee(o.weights),!1))}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return n}var cs=(function(){function r(){this.saveRouters=[],this.loadRouters=[]}return r.getInstance=function(){return r.instance==null&&(r.instance=new r),r.instance},r.registerSaveRouter=function(e){r.getInstance().saveRouters.push(e)},r.registerLoadRouter=function(e){r.getInstance().loadRouters.push(e)},r.getSaveHandlers=function(e){return r.getHandlers(e,"save")},r.getLoadHandlers=function(e,t){return r.getHandlers(e,"load",t)},r.getHandlers=function(e,t,n){var a=[],i=t==="load"?r.getInstance().loadRouters:r.getInstance().saveRouters;return i.forEach(function(o){var s=o(e,n);s!==null&&a.push(s)}),a},r})(),c9="tensorflowjs",l9=1,rl="models_store",vh="model_info_store";function f9(){if(!er().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var r=typeof window>"u"?self:window,e=r.indexedDB||r.mozIndexedDB||r.webkitIndexedDB||r.msIndexedDB||r.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function h9(r){var e=r.result;e.createObjectStore(rl,{keyPath:"modelPath"}),e.createObjectStore(vh,{keyPath:"modelPath"})}var Nh=(function(){function r(e){if(this.indexedDB=f9(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return r.prototype.save=function(e){return Ie(this,void 0,void 0,function(){return Te(this,function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]})})},r.prototype.load=function(){return Ie(this,void 0,void 0,function(){return Te(this,function(e){return[2,this.databaseAction(this.modelPath)]})})},r.prototype.databaseAction=function(e,t){var n=this;return new Promise(function(a,i){var o=n.indexedDB.open(c9,l9);o.onupgradeneeded=function(){return h9(o)},o.onsuccess=function(){var s=o.result;if(t==null){var u=s.transaction(rl,"readonly"),c=u.objectStore(rl),l=c.get(n.modelPath);l.onsuccess=function(){if(l.result==null)return s.close(),i(new Error("Cannot find model with path '".concat(n.modelPath,"' ")+"in IndexedDB."));a(l.result.modelArtifacts)},l.onerror=function(v){return s.close(),i(l.error)},u.oncomplete=function(){return s.close()}}else{t.weightData=vl.join(t.weightData);var f=Kh(t),h=s.transaction(vh,"readwrite"),p=h.objectStore(vh),d;try{d=p.put({modelPath:n.modelPath,modelArtifactsInfo:f})}catch(v){return i(v)}var m;d.onsuccess=function(){m=s.transaction(rl,"readwrite");var v=m.objectStore(rl),g;try{g=v.put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:f})}catch(y){return i(y)}g.onsuccess=function(){return a({modelArtifactsInfo:f})},g.onerror=function(y){p=h.objectStore(vh);var w=p.delete(n.modelPath);w.onsuccess=function(){return s.close(),i(g.error)},w.onerror=function(b){return s.close(),i(g.error)}}},d.onerror=function(v){return s.close(),i(d.error)},h.oncomplete=function(){m==null?s.close():m.oncomplete=function(){return s.close()}}}},o.onerror=function(s){return i(o.error)}})},r})();Nh.URL_SCHEME="indexeddb://";var VN=function(r){return er().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(Nh.URL_SCHEME)?p9(r.slice(Nh.URL_SCHEME.length)):null};cs.registerSaveRouter(VN);cs.registerLoadRouter(VN);function p9(r){return new Nh(r)}var jc="/",Xc="tensorflowjs_models",d9="info",v9="model_topology",m9="weight_specs",g9="weight_data",y9="model_metadata";function b9(r){return{info:[Xc,r,d9].join(jc),topology:[Xc,r,v9].join(jc),weightSpecs:[Xc,r,m9].join(jc),weightData:[Xc,r,g9].join(jc),modelMetadata:[Xc,r,y9].join(jc)}}function w9(r){var e,t;try{for(var n=le(Object.values(r)),a=n.next();!a.done;a=n.next()){var i=a.value;window.localStorage.removeItem(i)}}catch(o){e={error:o}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}}var Ih=(function(){function r(e){if(!er().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=b9(this.modelPath)}return r.prototype.save=function(e){return Ie(this,void 0,void 0,function(){var t,n,a,i,o;return Te(this,function(s){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),a=Kh(e),i=vl.join(e.weightData);try{return this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,i9(i)),o={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0},this.LS.setItem(this.keys.modelMetadata,JSON.stringify(o)),[2,{modelArtifactsInfo:a}]}catch{throw w9(this.keys),new Error("Failed to save model '".concat(this.modelPath,"' to local storage: ")+"size quota being exceeded is a possible cause of this failure: "+"modelTopologyBytes=".concat(a.modelTopologyBytes,", ")+"weightSpecsBytes=".concat(a.weightSpecsBytes,", ")+"weightDataBytes=".concat(a.weightDataBytes,"."))}return[2]})})},r.prototype.load=function(){return Ie(this,void 0,void 0,function(){var e,t,n,a,i,o,s;return Te(this,function(u){if(e=JSON.parse(this.LS.getItem(this.keys.info)),e==null)throw new Error("In local storage, there is no model with name '".concat(this.modelPath,"'"));if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},n=JSON.parse(this.LS.getItem(this.keys.topology)),n==null)throw new Error("In local storage, the topology of model '".concat(this.modelPath,"' ")+"is missing.");if(t.modelTopology=n,a=JSON.parse(this.LS.getItem(this.keys.weightSpecs)),a==null)throw new Error("In local storage, the weight specs of model '".concat(this.modelPath,"' ")+"are missing.");if(t.weightSpecs=a,i=this.LS.getItem(this.keys.modelMetadata),i!=null&&(o=JSON.parse(i),t.format=o.format,t.generatedBy=o.generatedBy,t.convertedBy=o.convertedBy,o.signature!=null&&(t.signature=o.signature),o.userDefinedMetadata!=null&&(t.userDefinedMetadata=o.userDefinedMetadata),o.modelInitializer!=null&&(t.modelInitializer=o.modelInitializer),o.initializerSignature!=null&&(t.initializerSignature=o.initializerSignature),o.trainingConfig!=null&&(t.trainingConfig=o.trainingConfig)),s=this.LS.getItem(this.keys.weightData),s==null)throw new Error("In local storage, the binary weight values of model "+"'".concat(this.modelPath,"' are missing."));return t.weightData=o9(s),[2,t]})})},r})();Ih.URL_SCHEME="localstorage://";var UN=function(r){return er().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(Ih.URL_SCHEME)?x9(r.slice(Ih.URL_SCHEME.length)):null};cs.registerSaveRouter(UN);cs.registerLoadRouter(UN);function x9(r){return new Ih(r)}var k9="model",S9=".json",E9=".weights.bin";function WE(r){return new Promise(function(e){return setTimeout(e)}).then(r)}var Ch=(function(){function r(e){if(!er().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(r.URL_SCHEME)&&(e=e.slice(r.URL_SCHEME.length)),(e==null||e.length===0)&&(e=k9),this.modelJsonFileName=e+S9,this.weightDataFileName=e+E9}return r.prototype.save=function(e){return Ie(this,void 0,void 0,function(){var t,n,a,i,o,s,u;return Te(this,function(c){switch(c.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=vl.join(e.weightData),n=window.URL.createObjectURL(new Blob([t],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return a=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],i=GN(e,a),o=window.URL.createObjectURL(new Blob([JSON.stringify(i)],{type:"application/json"})),s=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor,s.download=this.modelJsonFileName,s.href=o,[4,WE(function(){return s.dispatchEvent(new MouseEvent("click"))})];case 2:return c.sent(),e.weightData==null?[3,4]:(u=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor,u.download=this.weightDataFileName,u.href=n,[4,WE(function(){return u.dispatchEvent(new MouseEvent("click"))})]);case 3:c.sent(),c.label=4;case 4:return[2,{modelArtifactsInfo:Kh(e)}]}})})},r})();Ch.URL_SCHEME="downloads://";var T9=function(r){return er().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(Ch.URL_SCHEME)?N9(r.slice(Ch.URL_SCHEME.length)):null};cs.registerSaveRouter(T9);function N9(r){return r===void 0&&(r="model"),new Ch(r)}function GE(r,e,t,n){o(r),t=t??0,n=n??1,s(t,n);var a=0,i=function(u){return u.then(function(c){var l=t+ ++a/r.length*(n-t);return e(l),c}),u};function o(u){Se(u!=null&&Array.isArray(u)&&u.length>0,function(){return"promises must be a none empty array"})}function s(u,c){Se(u>=0&&u<=1,function(){return"Progress fraction must be in range [0, 1], but "+"got startFraction ".concat(u)}),Se(c>=0&&c<=1,function(){return"Progress fraction must be in range [0, 1], but "+"got endFraction ".concat(c)}),Se(c>=u,function(){return"startFraction must be no more than endFraction, but "+"got startFraction ".concat(u," and endFraction ")+"".concat(c)})}return Promise.all(r.map(i))}function I9(r,e){return Ie(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l,f,h;return Te(this,function(p){switch(p.label){case 0:return e==null&&(e={}),t=e.fetchFunc==null?er().platform.fetch:e.fetchFunc,n=r.map(function(d){return t(d,e.requestInit,{isBinary:!0})}),a=0,i=.5,e.onProgress!=null?[3,2]:[4,Promise.all(n)];case 1:return s=p.sent(),[3,4];case 2:return[4,GE(n,e.onProgress,a,i)];case 3:s=p.sent(),p.label=4;case 4:return o=s,u=o.map(function(d){return d.arrayBuffer()}),c=.5,l=1,e.onProgress!=null?[3,6]:[4,Promise.all(u)];case 5:return h=p.sent(),[3,8];case 6:return[4,GE(u,e.onProgress,c,l)];case 7:h=p.sent(),p.label=8;case 8:return f=h,[2,f]}})})}function C9(r,e){var t=this,n,a=e.fetchFunc==null?er().platform.fetch:e.fetchFunc,i=0,o;return(n=e.onProgress)===null||n===void 0||n.call(e,0),new ReadableStream({pull:function(s){return Ie(t,void 0,void 0,function(){var u,c,l,f,h;return Te(this,function(p){switch(p.label){case 0:return i<r.length?o?[3,2]:[4,a(r[i],e.requestInit,{isBinary:!0})]:[3,4];case 1:c=p.sent().body,o=c.getReader(),p.label=2;case 2:return[4,o.read()];case 3:return l=p.sent(),f=l.done,h=l.value,f?(i++,o=void 0,(u=e.onProgress)===null||u===void 0||u.call(e,i/r.length),[3,0]):(s.enqueue(h),[2]);case 4:return s.close(),[2]}})})}})}var A9="application/octet-stream",D9="application/json",ig=(function(){function r(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.weightUrlConverter=t.weightUrlConverter,t.fetchFunc!=null?(Se(typeof t.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=t.fetchFunc):this.fetch=er().platform.fetch,Se(e!=null&&e.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(e)&&Se(e.length===2,function(){return"URL paths for http must have a length of 2, "+"(actual length is ".concat(e.length,").")}),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{},this.loadOptions=t}return r.prototype.save=function(e){return Ie(this,void 0,void 0,function(){var t,n,a,i,o;return Te(this,function(s){switch(s.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit),t.body=new FormData,n=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],a=GN(e,n),t.body.append("model.json",new Blob([JSON.stringify(a)],{type:D9}),"model.json"),e.weightData!=null&&(i=vl.join(e.weightData),t.body.append("model.weights.bin",new Blob([i],{type:A9}),"model.weights.bin")),[4,this.fetch(this.path,t)];case 1:if(o=s.sent(),o.ok)return[2,{modelArtifactsInfo:Kh(e),responses:[o]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+"".concat(o.status,"."))}})})},r.prototype.loadModelJSON=function(){return Ie(this,void 0,void 0,function(){var e,t,n,a,i;return Te(this,function(o){switch(o.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(e=o.sent(),!e.ok)throw new Error("Request to ".concat(this.path," failed with status code ")+"".concat(e.status,". Please verify this URL points to ")+"the model JSON of the model to load.");o.label=2;case 2:return o.trys.push([2,4,,5]),[4,e.json()];case 3:return t=o.sent(),[3,5];case 4:throw o.sent(),n="Failed to parse model JSON of response from ".concat(this.path,"."),this.path.endsWith(".pb")?n+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":n+=" Please make sure the server is serving valid JSON for this request.",new Error(n);case 5:if(a=t.modelTopology,i=t.weightsManifest,a==null&&i==null)throw new Error("The JSON from HTTP path ".concat(this.path," contains neither model ")+"topology or manifest for weights.");return[2,t]}})})},r.prototype.load=function(){return Ie(this,void 0,void 0,function(){var e,t=this;return Te(this,function(n){switch(n.label){case 0:return this.loadOptions.streamWeights?[2,this.loadStream()]:[4,this.loadModelJSON()];case 1:return e=n.sent(),[2,u9(e,function(a){return t.loadWeights(a)})]}})})},r.prototype.loadStream=function(){return Ie(this,void 0,void 0,function(){var e,t,n,a,i=this;return Te(this,function(o){switch(o.label){case 0:return[4,this.loadModelJSON()];case 1:return e=o.sent(),[4,this.getWeightUrls(e.weightsManifest)];case 2:return t=o.sent(),n=$E(e.weightsManifest),a=function(){return C9(t,i.loadOptions)},[2,Object.assign(Object.assign({},e),{weightSpecs:n,getWeightStream:a})]}})})},r.prototype.getWeightUrls=function(e){return Ie(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l,f,h,p,d,m,v,g,y,w,b,x,S;return Te(this,function(T){switch(T.label){case 0:t=Array.isArray(this.path)?this.path[1]:this.path,n=ee(_9(t),2),a=n[0],i=n[1],o=this.weightPathPrefix||a,s=[],u=[];try{for(c=le(e),l=c.next();!l.done;l=c.next()){f=l.value;try{for(h=(x=void 0,le(f.paths)),p=h.next();!p.done;p=h.next())d=p.value,this.weightUrlConverter!=null?u.push(this.weightUrlConverter(d)):s.push(o+d+i)}catch(N){x={error:N}}finally{try{p&&!p.done&&(S=h.return)&&S.call(h)}finally{if(x)throw x.error}}}}catch(N){w={error:N}}finally{try{l&&!l.done&&(b=c.return)&&b.call(c)}finally{if(w)throw w.error}}return this.weightUrlConverter?(v=(m=s.push).apply,g=[s],y=[[]],[4,Promise.all(u)]):[3,2];case 1:v.apply(m,g.concat([Xe.apply(void 0,y.concat([ee.apply(void 0,[T.sent()]),!1]))])),T.label=2;case 2:return[2,s]}})})},r.prototype.loadWeights=function(e){return Ie(this,void 0,void 0,function(){var t,n,a;return Te(this,function(i){switch(i.label){case 0:return[4,this.getWeightUrls(e)];case 1:return t=i.sent(),n=$E(e),[4,I9(t,this.loadOptions)];case 2:return a=i.sent(),[2,[n,a]]}})})},r})();ig.URL_SCHEME_REGEX=/^https?:\/\//;function _9(r){var e=r.lastIndexOf("/"),t=r.lastIndexOf("?"),n=r.substring(0,e),a=t>e?r.substring(t):"";return[n+"/",a]}function VE(r){return r.match(ig.URL_SCHEME_REGEX)!=null}var HN=function(r,e){if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;var t=!0;return Array.isArray(r)?t=r.every(function(n){return VE(n)}):t=VE(r),t?F9(r,e):null};cs.registerSaveRouter(HN);cs.registerLoadRouter(HN);function F9(r,e){return new ig(r,e)}function R9(r,e,t){var n=e.rank>1?e.shape[e.rank-1]:1,a=e.rank>1?e.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + "+"shape[sliceDim:], got updates.shape: ".concat(t.shape)+", indices.shape: ".concat(e.shape,", shape: ").concat(r)+", sliceDim: ".concat(n,", and batchDim: ").concat(a,".");if(t.rank<a)throw new Error(i+" update.rank < ".concat(a,". "));if(r.length<n+(t.rank-a))throw new Error(i+" Output shape length < ".concat(n+(t.rank-a)));if(t.rank!==a+r.length-n)throw new Error(i+" update.rank != ".concat(a+r.length-n));for(var o=0;o<a;++o)if(t.shape[o]!==e.shape[o])throw new Error(i+" updates.shape[".concat(o,"] (").concat(t.shape[o],") != indices.shape[").concat(o,"] (").concat(e.shape[o],")."));for(var o=0;o<t.rank-a;++o)if(t.shape[o+a]!==r[o+n])throw new Error(i+" updates.shape[".concat(o+a,"] (").concat(t.shape[o+a],") != shape[").concat(o+a,"] (").concat(r[o+a],")"))}function O9(r,e,t){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher,"+" but the rank was ".concat(e.rank,"."));if(r.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher,"+" but the rank was ".concat(r.rank,"."));if(e.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: ".concat(e.dtype));if(t.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: ".concat(t));if(t.length===0){if(e.size===0)throw new Error("Indices specified for empty output. indices shape: ".concat(e.shape));if(r.size===0)throw new Error("Updates specified for empty output. updates shape: ".concat(r.shape))}R9(t,e,r)}function P9(r,e,t){var n,a=r.shape.length;typeof e=="number"?n=Xe([e],ee(new Array(a-1).fill(0)),!1):e.length<a?n=e.concat(new Array(a-e.length).fill(0)):n=e.slice(),n.forEach(function(o){Se(o!==-1,function(){return"slice() does not support negative begin indexing."})});var i;return t==null?i=new Array(a).fill(-1):typeof t=="number"?i=Xe([t],ee(new Array(a-1).fill(-1)),!1):t.length<a?i=t.concat(new Array(a-t.length).fill(-1)):i=t,i=i.map(function(o,s){return o>=0?o:(Se(o===-1,function(){return"Negative size values should be exactly -1 but got "+"".concat(o," for the slice() size at index ").concat(s,".")}),r.shape[s]-n[s])}),[n,i]}var M9=(function(){function r(){}return r.prototype.getClassName=function(){return this.constructor.className},r.fromConfig=function(e,t){return new e(t)},r})();function B9(r){var e=Ne(r,"x","abs");if(e.dtype==="complex64"){var t={x:e};return de.runKernel(AT,t)}else{var t={x:e};return de.runKernel(NT,t)}}var L9=Ve({abs_:B9});function z9(r,e){e===void 0&&(e=0),Se(r.length>=1,function(){return"Pass at least one tensor to concat"});var t=FN(r,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(function(i){if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `.concat(i.dtype,". "))}),t.length===1)return BN(t[0]);var n=t,a={axis:e};return de.runKernel(DT,n,a)}var $9=Ve({concat_:z9});function W9(r){var e=Ne(r,"x","sigmoid","float32"),t={x:e};return de.runKernel(nN,t)}var G9=Ve({sigmoid_:W9});function V9(r,e,t){var n=Ne(r,"x","batchToSpaceND"),a=e.reduce(function(s,u){return s*u});Se(n.rank>=1+e.length,function(){return"input rank is ".concat(n.rank," but should be > than blockShape.length ").concat(e.length)}),Se(t.length===e.length,function(){return"crops.length is ".concat(t.length," but should be equal to blockShape.length  ").concat(e.length)}),Se(n.shape[0]%a===0,function(){return"input tensor batch is ".concat(n.shape[0]," but is not divisible by the product of ")+"the elements of blockShape ".concat(e.join(" * ")," === ").concat(a)});var i={x:n},o={blockShape:e,crops:t};return de.runKernel(CT,i,o)}var U9=Ve({batchToSpaceND_:V9});function H9(r,e,t){pl(r),t=t||Uh(e);var n={shape:r,value:e,dtype:t};return de.runKernel(O5,{},n)}function q9(r){var e=Ne(r,"x","cos","float32"),t={x:e};return de.runKernel(RT,t)}var qN=Ve({cos_:q9});function K9(r){var e=Ne(r,"x","cosh","float32"),t={x:e};return de.runKernel(OT,t)}var j9=Ve({cosh_:K9});function X9(r,e,t,n){e===void 0&&(e=0),t===void 0&&(t=!1),n===void 0&&(n=!1);var a=Ne(r,"x","cumprod"),i={x:a},o={axis:e,exclusive:t,reverse:n};return de.runKernel(k5,i,o)}var UE=Ve({cumprod_:X9});function Y9(r,e){e===void 0&&(e=0);var t=Ne(r,"x","expandDims","string_or_numeric");Se(e<=t.rank,function(){return"Axis must be <= rank of the tensor"});var n={input:t},a={dim:e};return de.runKernel(LT,n,a)}var Z9=Ve({expandDims_:Y9});function J9(r,e,t,n){t===void 0&&(t=0),n===void 0&&(n=0);var a=Ne(r,"x","gather"),i=Ne(e,"indices","gather","int32"),o={x:a,indices:i},s={axis:t,batchDims:n};return de.runKernel(WT,o,s)}var Q9=Ve({gather_:J9});function eY(r,e){Se(ym(r),function(){return"The f passed in variableGrads(f) must be a function"}),Se(e==null||Array.isArray(e)&&e.every(function(f){return f instanceof Sh}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var t=e!=null;if(!t){e=[];for(var n in de.registeredVariables)e.push(de.registeredVariables[n])}var a=t?e.filter(function(f){return!f.trainable}):null,i=e.length;e=e.filter(function(f){return f.trainable}),Se(e.length>0,function(){return"variableGrads() expects at least one of the input variables to "+"be trainable, but none of the ".concat(i," variables is ")+"trainable."});var o=!0,s=de.gradients(r,e,null,o),u=s.value,c=s.grads;Se(c.some(function(f){return f!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),Se(u.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it "+"returned a rank-".concat(u.rank," tensor")});var l={};return e.forEach(function(f,h){c[h]!=null&&(l[f.name]=c[h])}),a?.forEach(function(f){return l[f.name]=null}),{value:u,grads:l}}function tY(r){var e=Ne(r,"x","logicalNot","bool"),t={x:e};return de.runKernel(q5,t)}var rY=Ve({logicalNot_:tY});function nY(r,e){var t,n=Ne(r,"a","maximum"),a=Ne(e,"b","maximum");t=ee(ta(n,a),2),n=t[0],a=t[1],n.dtype==="bool"&&(n=mt(n,"int32"),a=mt(a,"int32")),Qr(n.shape,a.shape);var i={a:n,b:a};return de.runKernel(UT,i)}var KN=Ve({maximum_:nY});function aY(r,e,t){t===void 0&&(t=0);var n=Ne(r,"x","pad");if(n.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var a={paddings:e,constantValue:t},i={x:n};return de.runKernel(jT,i,a)}var iY=Ve({pad_:aY}),jN={exports:{}};(function(r){(function(e,t,n){function a(u){var c=this,l=s();c.next=function(){var f=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=f-(c.c=f|0)},c.c=1,c.s0=l(" "),c.s1=l(" "),c.s2=l(" "),c.s0-=l(u),c.s0<0&&(c.s0+=1),c.s1-=l(u),c.s1<0&&(c.s1+=1),c.s2-=l(u),c.s2<0&&(c.s2+=1),l=null}function i(u,c){return c.c=u.c,c.s0=u.s0,c.s1=u.s1,c.s2=u.s2,c}function o(u,c){var l=new a(u),f=c&&c.state,h=l.next;return h.int32=function(){return l.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,f&&(typeof f=="object"&&i(f,l),h.state=function(){return i(l,{})}),h}function s(){var u=4022871197,c=function(l){l=String(l);for(var f=0;f<l.length;f++){u+=l.charCodeAt(f);var h=.02519603282416938*u;u=h>>>0,h-=u,h*=u,u=h>>>0,h-=u,u+=h*4294967296}return(u>>>0)*23283064365386963e-26};return c}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.alea=o})(os,r,!1)})(jN);var oY=jN.exports,XN={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this,c="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var f=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^f^f>>>8},s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor128=o})(os,r,!1)})(XN);var sY=XN.exports,YN={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this,c="";u.next=function(){var f=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^(f^f<<1))|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,l==c.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorwow=o})(os,r,!1)})(YN);var uY=YN.exports,ZN={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var l=u.x,f=u.i,h,p;return h=l[f],h^=h>>>7,p=h^h<<24,h=l[f+1&7],p^=h^h>>>10,h=l[f+3&7],p^=h^h>>>3,h=l[f+4&7],p^=h^h<<7,h=l[f+7&7],h=h^h<<13,p^=h^h<<9,l[f]=p,u.i=f+1&7,p};function c(l,f){var h,p=[];if(f===(f|0))p[0]=f;else for(f=""+f,h=0;h<f.length;++h)p[h&7]=p[h&7]<<15^f.charCodeAt(h)+p[h+1&7]<<13;for(;p.length<8;)p.push(0);for(h=0;h<8&&p[h]===0;++h);for(h==8?p[7]=-1:p[h],l.x=p,l.i=0,h=256;h>0;--h)l.next()}c(u,s)}function i(s,u){return u.x=s.x.slice(),u.i=s.i,u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(l.x&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorshift7=o})(os,r,!1)})(ZN);var cY=ZN.exports,JN={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var l=u.w,f=u.X,h=u.i,p,d;return u.w=l=l+1640531527|0,d=f[h+34&127],p=f[h=h+1&127],d^=d<<13,p^=p<<17,d^=d>>>15,p^=p>>>12,d=f[h]=d^p,u.i=h,d+(l^l>>>16)|0};function c(l,f){var h,p,d,m,v,g=[],y=128;for(f===(f|0)?(p=f,f=null):(f=f+"\0",p=0,y=Math.max(y,f.length)),d=0,m=-32;m<y;++m)f&&(p^=f.charCodeAt((m+32)%f.length)),m===0&&(v=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,m>=0&&(v=v+1640531527|0,h=g[m&127]^=p+v,d=h==0?d+1:0);for(d>=128&&(g[(f&&f.length||0)&127]=-1),d=127,m=512;m>0;--m)p=g[d+34&127],h=g[d=d+1&127],p^=p<<13,h^=h<<17,p^=p>>>15,h^=h>>>12,g[d]=p^h;l.w=v,l.X=g,l.i=d}c(u,s)}function i(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(l.X&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor4096=o})(os,r,!1)})(JN);var lY=JN.exports,QN={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this,c="";u.next=function(){var f=u.b,h=u.c,p=u.d,d=u.a;return f=f<<25^f>>>7^h,h=h-p|0,p=p<<24^p>>>8^d,d=d-f|0,u.b=f=f<<20^f>>>12^h,u.c=h=h-p|0,u.d=p<<16^h>>>16^d,u.a=d-f|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=s|0):c+=s;for(var l=0;l<c.length+20;l++)u.b^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.tychei=o})(os,r,!1)})(QN);var fY=QN.exports,eI={exports:{}},hY={},pY={__proto__:null,default:hY},dY=jj(pY);(function(r){(function(e,t,n){var a=256,i=6,o=52,s="random",u=n.pow(a,i),c=n.pow(2,o),l=c*2,f=a-1,h;function p(b,x,S){var T=[];x=x==!0?{entropy:!0}:x||{};var N=g(v(x.entropy?[b,w(t)]:b??y(),3),T),C=new d(T),R=function(){for(var _=C.g(i),P=u,$=0;_<c;)_=(_+$)*a,P*=a,$=C.g(1);for(;_>=l;)_/=2,P/=2,$>>>=1;return(_+$)/P};return R.int32=function(){return C.g(4)|0},R.quick=function(){return C.g(4)/4294967296},R.double=R,g(w(C.S),t),(x.pass||S||function(_,P,$,z){return z&&(z.S&&m(z,C),_.state=function(){return m(C,{})}),$?(n[s]=_,P):_})(R,N,"global"in x?x.global:this==n,x.state)}function d(b){var x,S=b.length,T=this,N=0,C=T.i=T.j=0,R=T.S=[];for(S||(b=[S++]);N<a;)R[N]=N++;for(N=0;N<a;N++)R[N]=R[C=f&C+b[N%S]+(x=R[N])],R[C]=x;(T.g=function(_){for(var P,$=0,z=T.i,L=T.j,B=T.S;_--;)P=B[z=f&z+1],$=$*a+B[f&(B[z]=B[L=f&L+P])+(B[L]=P)];return T.i=z,T.j=L,$})(a)}function m(b,x){return x.i=b.i,x.j=b.j,x.S=b.S.slice(),x}function v(b,x){var S=[],T=typeof b,N;if(x&&T=="object")for(N in b)try{S.push(v(b[N],x-1))}catch{}return S.length?S:T=="string"?b:b+"\0"}function g(b,x){for(var S=b+"",T,N=0;N<S.length;)x[f&N]=f&(T^=x[f&N]*19)+S.charCodeAt(N++);return w(x)}function y(){try{var b;return h&&(b=h.randomBytes)?b=b(a):(b=new Uint8Array(a),(e.crypto||e.msCrypto).getRandomValues(b)),w(b)}catch{var x=e.navigator,S=x&&x.plugins;return[+new Date,e,S,e.screen,w(t)]}}function w(b){return String.fromCharCode.apply(0,b)}if(g(n.random(),t),r.exports){r.exports=p;try{h=dY}catch{}}else n["seed"+s]=p})(typeof self<"u"?self:os,[],Math)})(eI);var vY=eI.exports,mY=oY,gY=sY,yY=uY,bY=cY,wY=lY,xY=fY,xu=vY;xu.alea=mY;xu.xor128=gY;xu.xorwow=yY;xu.xorshift7=bY;xu.xor4096=wY;xu.tychei=xY;function kY(r,e){var t=Ne(r,"x","reverse"),n={x:t},a={dims:e};return de.runKernel(ZT,n,a)}var SY=Ve({reverse_:kY});function EY(r,e,t){var n=Ne(r,"tensor","tensorScatterupdate"),a=Ne(e,"indices","tensorScatterupdate","int32"),i=Ne(t,"updates","tensorScatterupdate");if(O9(i,a,n.shape),n.dtype!==i.dtype)throw new Error("tensor and updates must have the same dtype, instead they are ".concat(n.dtype," and ").concat(i.dtype,"."));var o={tensor:n,indices:a,updates:i},s={};return de.runKernel(bj,o,s)}Ve({tensorScatterUpdate_:EY});var HE;(function(r){r[r.NONE=0]="NONE",r[r.MEAN=1]="MEAN",r[r.SUM=2]="SUM",r[r.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(HE||(HE={}));var ls=(function(r){ie(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.minimize=function(t,n,a){n===void 0&&(n=!1);var i=this.computeGradients(t,a),o=i.value,s=i.grads;if(a!=null){var u=a.map(function(c){return{name:c.name,tensor:s[c.name]}});this.applyGradients(u)}else this.applyGradients(s);return Qn(s),n?o:(o.dispose(),null)},Object.defineProperty(e.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!1,configurable:!0}),e.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},e.prototype.computeGradients=function(t,n){return eY(t,n)},e.prototype.dispose=function(){this.iterations_!=null&&Qn(this.iterations_)},e.prototype.saveIterations=function(){return Ie(this,void 0,void 0,function(){return Te(this,function(t){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:hr(this.iterations_,"int32")}]})})},e.prototype.getWeights=function(){return Ie(this,void 0,void 0,function(){return Te(this,function(t){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},e.prototype.setWeights=function(t){return Ie(this,void 0,void 0,function(){return Te(this,function(n){throw new Error("setWeights() is not implemented for this optimizer class "+"".concat(this.getClassName()))})})},e.prototype.extractIterations=function(t){return Ie(this,void 0,void 0,function(){var n;return Te(this,function(a){switch(a.label){case 0:return n=this,[4,t[0].tensor.data()];case 1:return n.iterations_=a.sent()[0],[2,t.slice(1)]}})})},e})(M9);Object.defineProperty(ls,Symbol.hasInstance,{value:function(r){return r.minimize!=null&&r.computeGradients!=null&&r.applyGradients!=null}});(function(r){ie(e,r);function e(t,n,a){a===void 0&&(a=null);var i=r.call(this)||this;return i.learningRate=t,i.rho=n,i.epsilon=a,i.accumulatedGrads=[],i.accumulatedUpdates=[],a==null&&(i.epsilon=de.backend.epsilon()),i}return Object.defineProperty(e,"className",{get:function(){return"Adadelta"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=de.registeredVariables[i],u=!1;n.accumulatedGrads[o]==null&&(n.accumulatedGrads[o]={originalName:"".concat(i,"/accum_grad"),variable:Ir(function(){return St(s).variable(u)})}),n.accumulatedUpdates[o]==null&&(n.accumulatedUpdates[o]={originalName:"".concat(i,"/accum_var"),variable:Ir(function(){return St(s).variable(u)})});var c=Array.isArray(t)?t[o].tensor:t[i];if(c!=null){var l=n.accumulatedGrads[o].variable,f=n.accumulatedUpdates[o].variable;Ir(function(){var h=dt(ye(l,n.rho),ye(pr(c),1-n.rho)),p=ye(Ct(Ya(dt(f,n.epsilon)),Ya(dt(l,n.epsilon))),c),d=dt(ye(f,n.rho),ye(pr(p),1-n.rho));l.assign(h),f.assign(d);var m=dt(ye(p,-n.learningRate),s);s.assign(m)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedUpdates!=null&&(Qn(this.accumulatedGrads.map(function(t){return t.variable})),Qn(this.accumulatedUpdates.map(function(t){return t.variable})))},e.prototype.getWeights=function(){return Ie(this,void 0,void 0,function(){var t;return Te(this,function(n){switch(n.label){case 0:return t=Xe(Xe([],ee(this.accumulatedGrads),!1),ee(this.accumulatedUpdates),!1),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(t.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},e.prototype.setWeights=function(t){return Ie(this,void 0,void 0,function(){var n,a;return Te(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),n=t.length/2,a=!1,this.accumulatedGrads=t.slice(0,n).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),this.accumulatedUpdates=t.slice(n,n*2).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(t,n){return new t(n.learningRate,n.rho,n.epsilon)},e})(ls);(function(r){ie(e,r);function e(t,n){n===void 0&&(n=.1);var a=r.call(this)||this;return a.learningRate=t,a.initialAccumulatorValue=n,a.accumulatedGrads=[],a}return Object.defineProperty(e,"className",{get:function(){return"Adagrad"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=de.registeredVariables[i];if(n.accumulatedGrads[o]==null){var u=!1;n.accumulatedGrads[o]={originalName:"".concat(i,"/accumulator"),variable:Ir(function(){return H9(s.shape,n.initialAccumulatorValue).variable(u)})}}var c=Array.isArray(t)?t[o].tensor:t[i];if(c!=null){var l=n.accumulatedGrads[o].variable;Ir(function(){var f=dt(l,pr(c));l.assign(f);var h=dt(ye(Ct(c,Ya(dt(f,de.backend.epsilon()))),-n.learningRate),s);s.assign(h)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedGrads!=null&&Qn(this.accumulatedGrads.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Ie(this,void 0,void 0,function(){return Te(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulatedGrads.map(function(n){return{name:n.originalName,tensor:n.variable}}))]}})})},e.prototype.setWeights=function(t){return Ie(this,void 0,void 0,function(){var n;return Te(this,function(a){switch(a.label){case 0:return[4,this.extractIterations(t)];case 1:return t=a.sent(),n=!1,this.accumulatedGrads=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(n)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(t,n){return new t(n.learningRate,n.initialAccumulatorValue)},e})(ls);(function(r){ie(e,r);function e(t,n,a,i){i===void 0&&(i=null);var o=r.call(this)||this;return o.learningRate=t,o.beta1=n,o.beta2=a,o.epsilon=i,o.accumulatedFirstMoment=[],o.accumulatedSecondMoment=[],Ir(function(){o.accBeta1=hr(n).variable(),o.accBeta2=hr(a).variable()}),i==null&&(o.epsilon=de.backend.epsilon()),o}return Object.defineProperty(e,"className",{get:function(){return"Adam"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);Ir(function(){var i=Hr(1,n.accBeta1),o=Hr(1,n.accBeta2);a.forEach(function(s,u){var c=de.registeredVariables[s],l=!1;n.accumulatedFirstMoment[u]==null&&(n.accumulatedFirstMoment[u]={originalName:"".concat(s,"/m"),variable:Ir(function(){return St(c).variable(l)})}),n.accumulatedSecondMoment[u]==null&&(n.accumulatedSecondMoment[u]={originalName:"".concat(s,"/v"),variable:Ir(function(){return St(c).variable(l)})});var f=Array.isArray(t)?t[u].tensor:t[s];if(f!=null){var h=n.accumulatedFirstMoment[u].variable,p=n.accumulatedSecondMoment[u].variable,d=dt(ye(h,n.beta1),ye(f,1-n.beta1)),m=dt(ye(p,n.beta2),ye(pr(f),1-n.beta2)),v=Ct(d,i),g=Ct(m,o);h.assign(d),p.assign(m);var y=dt(ye(Ct(v,dt(Ya(g),n.epsilon)),-n.learningRate),c);c.assign(y)}}),n.accBeta1.assign(ye(n.accBeta1,n.beta1)),n.accBeta2.assign(ye(n.accBeta2,n.beta2))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Qn(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedSecondMoment!=null&&Qn(this.accumulatedSecondMoment.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Ie(this,void 0,void 0,function(){var t;return Te(this,function(n){switch(n.label){case 0:return t=Xe(Xe([],ee(this.accumulatedFirstMoment),!1),ee(this.accumulatedSecondMoment),!1),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(t.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},e.prototype.setWeights=function(t){return Ie(this,void 0,void 0,function(){var n,a,i=this;return Te(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(t)];case 1:return t=o.sent(),Ir(function(){i.accBeta1.assign(Th(i.beta1,i.iterations_+1)),i.accBeta2.assign(Th(i.beta2,i.iterations_+1))}),n=t.length/2,a=!1,this.accumulatedFirstMoment=t.slice(0,n).map(function(s){return{originalName:s.name,variable:s.tensor.variable(a)}}),this.accumulatedSecondMoment=t.slice(n,n*2).map(function(s){return{originalName:s.name,variable:s.tensor.variable(a)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(t,n){return new t(n.learningRate,n.beta1,n.beta2,n.epsilon)},e})(ls);(function(r){ie(e,r);function e(t,n,a,i,o){i===void 0&&(i=null),o===void 0&&(o=0);var s=r.call(this)||this;return s.learningRate=t,s.beta1=n,s.beta2=a,s.epsilon=i,s.decay=o,s.accumulatedFirstMoment=[],s.accumulatedWeightedInfNorm=[],Ir(function(){s.iteration=hr(0).variable(),s.accBeta1=hr(n).variable()}),i==null&&(s.epsilon=de.backend.epsilon()),s}return Object.defineProperty(e,"className",{get:function(){return"Adamax"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);Ir(function(){var i=Hr(1,n.accBeta1),o=Ct(-n.learningRate,dt(ye(n.iteration,n.decay),1));a.forEach(function(s,u){var c=de.registeredVariables[s],l=!1;n.accumulatedFirstMoment[u]==null&&(n.accumulatedFirstMoment[u]={originalName:"".concat(s,"/m"),variable:St(c).variable(l)}),n.accumulatedWeightedInfNorm[u]==null&&(n.accumulatedWeightedInfNorm[u]={originalName:"".concat(s,"/v"),variable:St(c).variable(l)});var f=Array.isArray(t)?t[u].tensor:t[s];if(f!=null){var h=n.accumulatedFirstMoment[u].variable,p=n.accumulatedWeightedInfNorm[u].variable,d=dt(ye(h,n.beta1),ye(f,1-n.beta1)),m=ye(p,n.beta2),v=L9(f),g=KN(m,v);h.assign(d),p.assign(g);var y=dt(ye(Ct(o,i),Ct(d,dt(g,n.epsilon))),c);c.assign(y)}}),n.iteration.assign(dt(n.iteration,1)),n.accBeta1.assign(ye(n.accBeta1,n.beta1))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Qn(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedWeightedInfNorm!=null&&Qn(this.accumulatedWeightedInfNorm.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Ie(this,void 0,void 0,function(){return Te(this,function(t){throw new Error("getWeights() is not implemented for Adamax yet.")})})},e.prototype.setWeights=function(t){return Ie(this,void 0,void 0,function(){return Te(this,function(n){throw new Error("setWeights() is not implemented for Adamax yet.")})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(t,n){return new t(n.learningRate,n.beta1,n.beta2,n.epsilon,n.decay)},e})(ls);var TY=(function(r){ie(e,r);function e(t){var n=r.call(this)||this;return n.learningRate=t,n.setLearningRate(t),n}return Object.defineProperty(e,"className",{get:function(){return"SGD"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=Array.isArray(t)?t[o].tensor:t[i];if(s!=null){var u=de.registeredVariables[i];Ir(function(){var c=dt(ye(n.c,s),u);u.assign(c)})}}),this.incrementIterations()},e.prototype.setLearningRate=function(t){this.learningRate=t,this.c!=null&&this.c.dispose(),this.c=M7(hr(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getWeights=function(){return Ie(this,void 0,void 0,function(){return Te(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()]]}})})},e.prototype.setWeights=function(t){return Ie(this,void 0,void 0,function(){return Te(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(t)];case 1:if(t=n.sent(),t.length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(t,n){return new t(n.learningRate)},e})(ls);(function(r){ie(e,r);function e(t,n,a){a===void 0&&(a=!1);var i=r.call(this,t)||this;return i.learningRate=t,i.momentum=n,i.useNesterov=a,i.accumulations=[],i.m=hr(i.momentum),i}return Object.defineProperty(e,"className",{get:function(){return"Momentum"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=de.registeredVariables[i];if(n.accumulations[o]==null){var u=!1;n.accumulations[o]={originalName:"".concat(i,"/momentum"),variable:Ir(function(){return St(s).variable(u)})}}var c=n.accumulations[o].variable,l=Array.isArray(t)?t[o].tensor:t[i];l!=null&&Ir(function(){var f,h=dt(ye(n.m,c),l);n.useNesterov?f=dt(ye(n.c,dt(l,ye(h,n.m))),s):f=dt(ye(n.c,h),s),c.assign(h),s.assign(f)})}),this.incrementIterations()},e.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&Qn(this.accumulations.map(function(t){return t.variable}))},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getWeights=function(){return Ie(this,void 0,void 0,function(){return Te(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulations.map(function(n){return{name:n.originalName,tensor:n.variable}}))]}})})},e.prototype.setWeights=function(t){return Ie(this,void 0,void 0,function(){var n;return Te(this,function(a){switch(a.label){case 0:return[4,this.extractIterations(t)];case 1:return t=a.sent(),n=!1,this.accumulations=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(n)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(t,n){return new t(n.learningRate,n.momentum,n.useNesterov)},e})(TY);(function(r){ie(e,r);function e(t,n,a,i,o){n===void 0&&(n=.9),a===void 0&&(a=0),i===void 0&&(i=null),o===void 0&&(o=!1);var s=r.call(this)||this;if(s.learningRate=t,s.decay=n,s.momentum=a,s.epsilon=i,s.accumulatedMeanSquares=[],s.accumulatedMoments=[],s.accumulatedMeanGrads=[],s.centered=o,i==null&&(s.epsilon=de.backend.epsilon()),t==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return s}return Object.defineProperty(e,"className",{get:function(){return"RMSProp"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=de.registeredVariables[i],u=!1;n.accumulatedMeanSquares[o]==null&&(n.accumulatedMeanSquares[o]={originalName:"".concat(i,"/rms"),variable:Ir(function(){return St(s).variable(u)})}),n.accumulatedMoments[o]==null&&(n.accumulatedMoments[o]={originalName:"".concat(i,"/momentum"),variable:Ir(function(){return St(s).variable(u)})}),n.accumulatedMeanGrads[o]==null&&n.centered&&(n.accumulatedMeanGrads[o]={originalName:"".concat(i,"/mg"),variable:Ir(function(){return St(s).variable(u)})});var c=Array.isArray(t)?t[o].tensor:t[i];if(c!=null){var l=n.accumulatedMeanSquares[o].variable,f=n.accumulatedMoments[o].variable;Ir(function(){var h=dt(ye(l,n.decay),ye(pr(c),1-n.decay));if(n.centered){var p=n.accumulatedMeanGrads[o].variable,d=dt(ye(p,n.decay),ye(c,1-n.decay)),m=Ct(ye(c,n.learningRate),Ya(Hr(h,dt(pr(d),n.epsilon)))),v=dt(ye(f,n.momentum),m);l.assign(h),p.assign(d),f.assign(v);var g=Hr(s,v);s.assign(g)}else{var y=dt(ye(l,n.decay),ye(pr(c),1-n.decay)),v=dt(ye(f,n.momentum),Ct(ye(c,n.learningRate),Ya(dt(y,n.epsilon))));l.assign(y),f.assign(v);var g=Hr(s,v);s.assign(g)}})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&Qn(this.accumulatedMeanSquares.map(function(t){return t.variable})),this.accumulatedMeanGrads!=null&&this.centered&&Qn(this.accumulatedMeanGrads.map(function(t){return t.variable})),this.accumulatedMoments!=null&&Qn(this.accumulatedMoments.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Ie(this,void 0,void 0,function(){var t;return Te(this,function(n){switch(n.label){case 0:return t=Xe(Xe([],ee(this.accumulatedMeanSquares),!1),ee(this.accumulatedMoments),!1),this.centered&&t.push.apply(t,Xe([],ee(this.accumulatedMeanGrads),!1)),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(t.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},e.prototype.setWeights=function(t){return Ie(this,void 0,void 0,function(){var n,a;return Te(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),n=this.centered?t.length/3:t.length/2,a=!1,this.accumulatedMeanSquares=t.slice(0,n).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),this.accumulatedMoments=t.slice(n,n*2).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),this.centered&&(this.accumulatedMeanGrads=t.slice(n*2,n*3).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}})),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(t,n){return new t(n.learningRate,n.decay,n.momentum,n.epsilon,n.centered)},e})(ls);var qE;(function(r){r[r.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",r[r.VALUE_ROWIDS=1]="VALUE_ROWIDS",r[r.ROW_LENGTHS=2]="ROW_LENGTHS",r[r.ROW_SPLITS=3]="ROW_SPLITS",r[r.ROW_LIMITS=4]="ROW_LIMITS",r[r.ROW_STARTS=5]="ROW_STARTS"})(qE||(qE={}));var NY=1.7580993408473768,IY=1.0507009873554805;function CY(r,e,t){var n=r.shape.slice();n[t]=1;var a=Ye(e,n),i=UE(r,t,!0,!1),o=UE(r,t,!0,!0),s=ye(i,o);return ye(a,s)}function AY(r,e,t){var n=r.shape.length,a=n-t.length,i=zN(t,n),o=r;i!=null&&(o=yu(r,i));var s=o.shape.slice(),u=s.splice(n-t.length,t.length),c=u.reduce(function(p,d){return p*d},1);s.push(c);var l=o.reshape(s),f=CY(l,e,a);if(f=f.reshape(o.shape),i!=null){var h=rg(i);f=yu(f,h)}return f}var DY={kernelName:cj,inputsToSave:["x"],gradFunc:function(r,e,t){var n=ee(e,1),a=n[0],i=t.axis,o=[];return i==null?o=a.shape.map(function(s,u){return u}):typeof i=="number"?o=[i]:o=i,{x:function(){return AY(a,r,o)}}}},_Y={kernelName:MT,inputsToSave:["a","b"],gradFunc:function(r,e){var t=ee(e,2),n=t[0],a=t[1],i=Qr(n.shape,a.shape),o=function(){var u=Ct(r,mt(a,"float32")),c=qr(n.shape,i);return c.length>0?Ye(ur(u,c),n.shape):u},s=function(){var u=ye(r,mt(n,"float32")),c=qr(a.shape,i);c.length>0&&(u=Ye(ur(u,c),a.shape));var l=pr(a);return Ea(Ct(u,mt(l,"float32")))};return{a:o,b:s}}},FY={kernelName:fj,inputsToSave:["x"],gradFunc:function(r,e){var t=ee(e,1),n=t[0];return{x:function(){return Ct(r,Ea(pr(n)))}}}},RY={kernelName:gj,inputsToSave:["x"],gradFunc:function(r,e){var t=ee(e,1),n=t[0],a=ye(tg(n,6),Qm(n));return{x:function(){return ye(r,mt(a,"float32"))}}}},OY={kernelName:hj,inputsToSave:["x"],gradFunc:function(r,e){var t=ee(e,1),n=t[0];return{x:function(){return ye(r,mt(Qm(n),"float32"))}}}},PY={kernelName:YT,inputsToSave:["x"],gradFunc:function(r,e){var t=ee(e,1),n=t[0];return{x:function(){return Ye(r,n.shape)}}}},MY={kernelName:vj,inputsToSave:["images"],gradFunc:function(r,e,t){var n=ee(e,1),a=n[0],i={dy:r,images:a},o=function(){return de.runKernel(mj,i,t)};return{images:o}}},BY={kernelName:pj,inputsToSave:["images"],gradFunc:function(r,e,t){var n=ee(e,1),a=n[0],i={dy:r,images:a},o=function(){return de.runKernel(dj,i,t)};return{images:o}}};var LY={kernelName:ZT,gradFunc:function(r,e,t){var n=t.dims,a=is(n,r.shape);return{x:function(){return SY(r,a)}}}};var zY={kernelName:yj,gradFunc:function(r){return{x:function(){return St(r)}}}},$Y={kernelName:JT,inputsToSave:["x"],gradFunc:function(r,e){var t=ee(e,1),n=t[0];return{x:function(){return Ea(Ct(r,ye(Th(n,1.5),2)))}}}},WY={kernelName:QT,inputsToSave:["condition"],gradFunc:function(r,e){var t=ee(e,1),n=t[0];return{condition:function(){return mt(St(n),"float32")},t:function(){return ye(r,mt(n,r.dtype))},e:function(){return ye(r,mt(rY(n),r.dtype))}}}},GY={kernelName:wj,inputsToSave:["x"],gradFunc:function(r,e){var t=ee(e,1),n=t[0];return{x:function(){var a=dl(n,hr(0)),i=hr(NY),o=hr(IY),s=ye(r,o),u=ye(ye(r,i),Hh(mt(n,"float32")));return ns(a,s,u)}}}},VY={kernelName:nN,outputsToSave:[!0],gradFunc:function(r,e){var t=ee(e,1),n=t[0];return{x:function(){return ye(r,ye(n,Hr(hr(1),n)))}}}};var UY={kernelName:xj,gradFunc:function(r){return{x:function(){return St(r)}}}},HY={kernelName:tN,inputsToSave:["x"],gradFunc:function(r,e){var t=ee(e,1),n=t[0];return{x:function(){return ye(qN(mt(n,"float32")),r)}}}},qY={kernelName:rN,inputsToSave:["x"],gradFunc:function(r,e){var t=ee(e,1),n=t[0];return{x:function(){return ye(j9(mt(n,"float32")),r)}}}},KY={kernelName:eN,inputsToSave:["x"],gradFunc:function(r,e,t){for(var n=ee(e,1),a=n[0],i=t.begin,o=t.size,s=a.shape,u=ee(P9(a,i,o),2),c=u[0],l=u[1],f=[],h=0;h<r.rank;h++)f.push([c[h],s[h]-c[h]-l[h]]);return{x:function(){return iY(r,f)}}}},jY={kernelName:Sj,outputsToSave:[!0],gradFunc:function(r,e,t){var n=ee(e,1),a=n[0],i=t.dim,o=!0,s=ye(r,a);return{logits:function(){return Hr(s,ye(ur(s,[i],o),a))}}}},XY={kernelName:kj,inputsToSave:["x"],gradFunc:function(r,e){var t=ee(e,1),n=t[0];return{x:function(){return ye(r,G9(n))}}}};var KE={kernelName:oN,gradFunc:function(r,e,t){var n=t.blockShape,a=t.paddings;return{x:function(){return U9(r,n,a)}}}};var jE={kernelName:sN,gradFunc:function(r,e,t){var n=t.axis;return{x:function(){return $9(r,n)}}}},YY={kernelName:aN,inputsToSave:["x"],gradFunc:function(r,e){var t=ee(e,1),n=t[0];return{x:function(){return Ct(r,ye(Ya(mt(n,"float32")),2))}}}},ZY={kernelName:Tj,inputsToSave:["x"],gradFunc:function(r,e){var t=ee(e,1),n=t[0];return{x:function(){return ye(r,ye(mt(n,"float32"),2))}}}},JY={kernelName:Ej,inputsToSave:["a","b"],gradFunc:function(r,e){var t=ee(e,2),n=t[0],a=t[1],i=hr(2),o=function(){return ye(r,ye(i,Hr(n,a)))},s=function(){return ye(r,ye(i,Hr(a,n)))};return{a:o,b:s}}};var QY={kernelName:hN,gradFunc:function(r){return{x:function(){return St(r)}}}},eZ={kernelName:uN,inputsToSave:["a","b"],gradFunc:function(r,e){var t=ee(e,2),n=t[0],a=t[1],i=Qr(n.shape,a.shape),o=function(){var u=r,c=qr(n.shape,i);return c.length>0&&(u=ur(u,c)),Ye(u,n.shape)},s=function(){var u=r,c=qr(a.shape,i);return c.length>0&&(u=ur(u,c)),Ye(Ea(u),a.shape)};return{a:o,b:s}}},tZ={kernelName:iN,inputsToSave:["x"],gradFunc:function(r,e,t){var n=ee(e,1),a=n[0],i=a.shape.slice(),o=t.axis,s=is(o,a.shape);s.forEach(function(l){i[l]=1});var u=Ye(r,i),c=ye(u,qh(a.shape,"float32"));return{x:function(){return c}}}},rZ={kernelName:Nj,inputsToSave:["x"],gradFunc:function(r,e){var t=ee(e,1),n=t[0];return{x:function(){return Ct(r,pr(qN(n)))}}}},nZ={kernelName:Ij,outputsToSave:[!0],gradFunc:function(r,e){var t=ee(e,1),n=t[0];return{x:function(){return ye(Hr(hr(1),pr(n)),r)}}}},aZ={kernelName:Vm,inputsToSave:["x"],gradFunc:function(r,e,t){var n=ee(e,1),a=n[0],i=t.reps,o=function(){var s=St(a);if(a.rank===1)for(var u=0;u<i[0];++u)s=dt(s,du(r,[u*a.shape[0]],[a.shape[0]]));else if(a.rank===2)for(var u=0;u<i[0];++u)for(var c=0;c<i[1];++c)s=dt(s,du(r,[u*a.shape[0],c*a.shape[1]],[a.shape[0],a.shape[1]]));else if(a.rank===3)for(var u=0;u<i[0];++u)for(var c=0;c<i[1];++c)for(var l=0;l<i[2];++l)s=dt(s,du(r,[u*a.shape[0],c*a.shape[1],l*a.shape[2]],[a.shape[0],a.shape[1],a.shape[2]]));else if(a.rank===4)for(var u=0;u<i[0];++u)for(var c=0;c<i[1];++c)for(var l=0;l<i[2];++l)for(var f=0;f<i[3];++f)s=dt(s,du(r,[u*a.shape[0],c*a.shape[1],l*a.shape[2],f*a.shape[3]],[a.shape[0],a.shape[1],a.shape[2],a.shape[3]]));else throw new Error("Gradient for tile operation is not implemented for rank-"+"".concat(a.rank," tensors yet."));return s};return{x:o}}};var iZ={kernelName:hh,gradFunc:function(r,e,t){var n=t,a=n.perm,i=rg(a);return{x:function(){return yu(r,i)}}}};var oZ={kernelName:cN,gradFunc:function(r,e,t){var n=t,a=n.axis;return{value:function(){return $N(r,a)}}}},sZ={kernelName:lN,inputsToSave:["segmentIds"],gradFunc:function(r,e){var t=ee(e,1),n=t[0],a=function(){return uZ(r,n)};return{x:a}}};function uZ(r,e){for(var t=KN(e,St(e)),n=Q9(r,t),a=eg(e,hr(0,"int32")),i=n.rank-a.rank,o=0;o<i;++o)a=Z9(a,o+1);a=MN(a,qh(n.shape,"bool"));var s=St(n);return ns(a,n,s)}var cZ={kernelName:fN,gradFunc:function(r){return{x:function(){return St(r)}}}},om,XE,lZ=[RN,I8,C8,_8,F8,O8,P8,M8,L8,z8,$8,W8,U8,K8,X8,J8,Q8,e7,t7,u7,c7,h7,b7,m7,E7,I7,D7,V7,j7,X7,_Y,Y7,J7,Q7,eX,tX,nX,rX,uX,hX,pX,dX,vX,mX,gX,bX,wX,xX,kX,TX,BE,BE,DX,RX,MX,BX,LX,zX,WX,UX,HX,qX,KX,jX,ZX,LE,LE,t9,r9,DY,FY,RY,OY,PY,MY,BY,LY,zY,$Y,WY,GY,VY,UY,HY,qY,KY,jY,XY,KE,KE,jE,jE,YY,JY,ZY,QY,eZ,tZ,rZ,nZ,aZ,iZ,oZ,sZ,cZ];try{for(Yc=le(lZ),lu=Yc.next();!lu.done;lu=Yc.next())YE=lu.value,Uj(YE)}catch(r){om={error:r}}finally{try{lu&&!lu.done&&(XE=Yc.return)&&XE.call(Yc)}finally{if(om)throw om.error}}var YE,Yc,lu;function og(r,e){return F.tidy(function(){return A.sqrt(A.sum(A.mul(r,r),e,!0))})}var ml=(function(r){ie(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getConfig=function(){return{}},e})(F.serialization.Serializable),sg=(function(r){ie(e,r);function e(t){var n=r.call(this)||this;return n.defaultMaxValue=2,n.defaultAxis=0,n.maxValue=t.maxValue!=null?t.maxValue:n.defaultMaxValue,n.axis=t.axis!=null?t.axis:n.defaultAxis,n}return e.prototype.apply=function(t){var n=this;return F.tidy(function(){var a=og(t,n.axis),i=A.clipByValue(a,0,n.maxValue);return A.mul(t,A.div(i,A.add(Cr(),a)))})},e.prototype.getConfig=function(){return{maxValue:this.maxValue,axis:this.axis}},e})(ml);sg.className="MaxNorm";F.serialization.registerClass(sg);var ug=(function(r){ie(e,r);function e(t){var n=r.call(this)||this;return n.defaultAxis=0,n.axis=t.axis!=null?t.axis:n.defaultAxis,n}return e.prototype.apply=function(t){var n=this;return F.tidy(function(){return A.div(t,A.add(Cr(),og(t,n.axis)))})},e.prototype.getConfig=function(){return{axis:this.axis}},e})(ml);ug.className="UnitNorm";F.serialization.registerClass(ug);var cg=(function(r){ie(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return A.relu(t)},e})(ml);cg.className="NonNeg";F.serialization.registerClass(cg);var lg=(function(r){ie(e,r);function e(t){var n=r.call(this)||this;return n.defaultMinValue=0,n.defaultMaxValue=1,n.defaultRate=1,n.defaultAxis=0,n.minValue=t.minValue!=null?t.minValue:n.defaultMinValue,n.maxValue=t.maxValue!=null?t.maxValue:n.defaultMaxValue,n.rate=t.rate!=null?t.rate:n.defaultRate,n.axis=t.axis!=null?t.axis:n.defaultAxis,n}return e.prototype.apply=function(t){var n=this;return F.tidy(function(){var a=og(t,n.axis),i=A.add(A.mul(n.rate,A.clipByValue(a,n.minValue,n.maxValue)),A.mul(1-n.rate,a));return A.mul(t,A.div(i,A.add(Cr(),a)))})},e.prototype.getConfig=function(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}},e})(ml);lg.className="MinMaxNorm";F.serialization.registerClass(lg);var ZE={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Ar(r){return Am(r)}function JE(r,e){return e===void 0&&(e={}),cl(r,F.serialization.SerializationMap.getMap().classNameMap,e,"constraint")}function Dr(r){if(r==null)return null;if(typeof r=="string"){var e=r in ZE?ZE[r]:r,t={className:e,config:{}};return JE(t)}else return r instanceof ml?r:JE(r)}function fZ(r){return new sg(r)}function hZ(r){return new ug(r)}function pZ(){return new cg}function dZ(r){return new lg(r)}var vZ={__proto__:null,maxNorm:fZ,minMaxNorm:dZ,nonNeg:pZ,unitNorm:hZ};function mZ(){return new Fm}function gZ(){return new Mh}function yZ(r){return new Rm(r)}function bZ(r){return new Om(r)}function wZ(r){return new Pm(r)}function xZ(r){return new Mm(r)}function kZ(r){return new Bm(r)}function SZ(r){return new gn(r)}function EZ(r){return new Bh(r)}function TZ(r){return new Lh(r)}function NZ(r){return new zh(r)}function IZ(r){return new $h(r)}function CZ(r){return new Wh(r)}function AZ(r){return new Gh(r)}function DZ(r){return new Lm(r)}var _Z={__proto__:null,constant:yZ,glorotNormal:TZ,glorotUniform:EZ,heNormal:NZ,heUniform:IZ,identity:kZ,leCunNormal:CZ,leCunUniform:AZ,ones:gZ,orthogonal:DZ,randomNormal:wZ,randomUniform:bZ,truncatedNormal:xZ,varianceScaling:SZ,zeros:mZ};function oo(r){return Ie(this,void 0,void 0,function(){var e,t,n,a,i,o,s,u;return Te(this,function(c){switch(c.label){case 0:if(r==null)return[2];e=[],t=[],n=[];for(a in r)i=r[a],typeof i!="number"&&(o=i,e.push(o.data()),t.push(a),n.push(o));return e.length>0?[4,Promise.all(e)]:[3,2];case 1:for(s=c.sent(),u=0;u<s.length;++u)r[t[u]]=s[u][0];F.dispose(n),c.label=2;case 2:return[2]}})})}function tI(r){if(r!=null)for(var e in r){var t=r[e];typeof t!="number"&&t.dispose()}}var QE;(function(r){r[r.SILENT=0]="SILENT",r[r.VERBOSE=1]="VERBOSE"})(QE||(QE={}));var FZ=125,bu=(function(){function r(){this.validationData=null}return r.prototype.setParams=function(e){this.params=e},r.prototype.onEpochBegin=function(e,t){return Ie(this,void 0,void 0,function(){return Te(this,function(n){return[2]})})},r.prototype.onEpochEnd=function(e,t){return Ie(this,void 0,void 0,function(){return Te(this,function(n){return[2]})})},r.prototype.onBatchBegin=function(e,t){return Ie(this,void 0,void 0,function(){return Te(this,function(n){return[2]})})},r.prototype.onBatchEnd=function(e,t){return Ie(this,void 0,void 0,function(){return Te(this,function(n){return[2]})})},r.prototype.onTrainBegin=function(e){return Ie(this,void 0,void 0,function(){return Te(this,function(t){return[2]})})},r.prototype.onTrainEnd=function(e){return Ie(this,void 0,void 0,function(){return Te(this,function(t){return[2]})})},r.prototype.setModel=function(e){},r})(),rI=(function(){function r(e,t){t===void 0&&(t=10),e==null&&(e=[]),this.callbacks=e,this.queueLength=t}return r.prototype.append=function(e){this.callbacks.push(e)},r.prototype.setParams=function(e){var t,n;try{for(var a=le(this.callbacks),i=a.next();!i.done;i=a.next()){var o=i.value;o.setParams(e)}}catch(s){t={error:s}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}},r.prototype.setModel=function(e){var t,n;try{for(var a=le(this.callbacks),i=a.next();!i.done;i=a.next()){var o=i.value;o.setModel(e)}}catch(s){t={error:s}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}},r.prototype.onEpochBegin=function(e,t){return Ie(this,void 0,void 0,function(){var n,a,i,o,s,u;return Te(this,function(c){switch(c.label){case 0:t==null&&(t={}),c.label=1;case 1:c.trys.push([1,6,7,8]),n=le(this.callbacks),a=n.next(),c.label=2;case 2:return a.done?[3,5]:(i=a.value,[4,i.onEpochBegin(e,t)]);case 3:c.sent(),c.label=4;case 4:return a=n.next(),[3,2];case 5:return[3,8];case 6:return o=c.sent(),s={error:o},[3,8];case 7:try{a&&!a.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 8:return[2]}})})},r.prototype.onEpochEnd=function(e,t){return Ie(this,void 0,void 0,function(){var n,a,i,o,s,u;return Te(this,function(c){switch(c.label){case 0:t==null&&(t={}),c.label=1;case 1:c.trys.push([1,6,7,8]),n=le(this.callbacks),a=n.next(),c.label=2;case 2:return a.done?[3,5]:(i=a.value,[4,i.onEpochEnd(e,t)]);case 3:c.sent(),c.label=4;case 4:return a=n.next(),[3,2];case 5:return[3,8];case 6:return o=c.sent(),s={error:o},[3,8];case 7:try{a&&!a.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 8:return[2]}})})},r.prototype.onBatchBegin=function(e,t){return Ie(this,void 0,void 0,function(){var n,a,i,o,s,u;return Te(this,function(c){switch(c.label){case 0:t==null&&(t={}),c.label=1;case 1:c.trys.push([1,6,7,8]),n=le(this.callbacks),a=n.next(),c.label=2;case 2:return a.done?[3,5]:(i=a.value,[4,i.onBatchBegin(e,t)]);case 3:c.sent(),c.label=4;case 4:return a=n.next(),[3,2];case 5:return[3,8];case 6:return o=c.sent(),s={error:o},[3,8];case 7:try{a&&!a.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 8:return[2]}})})},r.prototype.onBatchEnd=function(e,t){return Ie(this,void 0,void 0,function(){var n,a,i,o,s,u;return Te(this,function(c){switch(c.label){case 0:t==null&&(t={}),c.label=1;case 1:c.trys.push([1,6,7,8]),n=le(this.callbacks),a=n.next(),c.label=2;case 2:return a.done?[3,5]:(i=a.value,[4,i.onBatchEnd(e,t)]);case 3:c.sent(),c.label=4;case 4:return a=n.next(),[3,2];case 5:return[3,8];case 6:return o=c.sent(),s={error:o},[3,8];case 7:try{a&&!a.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 8:return[2]}})})},r.prototype.onTrainBegin=function(e){return Ie(this,void 0,void 0,function(){var t,n,a,i,o,s;return Te(this,function(u){switch(u.label){case 0:e==null&&(e={}),u.label=1;case 1:u.trys.push([1,6,7,8]),t=le(this.callbacks),n=t.next(),u.label=2;case 2:return n.done?[3,5]:(a=n.value,[4,a.onTrainBegin(e)]);case 3:u.sent(),u.label=4;case 4:return n=t.next(),[3,2];case 5:return[3,8];case 6:return i=u.sent(),o={error:i},[3,8];case 7:try{n&&!n.done&&(s=t.return)&&s.call(t)}finally{if(o)throw o.error}return[7];case 8:return[2]}})})},r.prototype.onTrainEnd=function(e){return Ie(this,void 0,void 0,function(){var t,n,a,i,o,s;return Te(this,function(u){switch(u.label){case 0:e==null&&(e={}),u.label=1;case 1:u.trys.push([1,6,7,8]),t=le(this.callbacks),n=t.next(),u.label=2;case 2:return n.done?[3,5]:(a=n.value,[4,a.onTrainEnd(e)]);case 3:u.sent(),u.label=4;case 4:return n=t.next(),[3,2];case 5:return[3,8];case 6:return i=u.sent(),o={error:i},[3,8];case 7:try{n&&!n.done&&(s=t.return)&&s.call(t)}finally{if(o)throw o.error}return[7];case 8:return[2]}})})},r})(),RZ=(function(r){ie(e,r);function e(){return r.call(this)||this}return e.prototype.onEpochBegin=function(t){return Ie(this,void 0,void 0,function(){return Te(this,function(n){return this.seen=0,this.totals={},[2]})})},e.prototype.onBatchEnd=function(t,n){return Ie(this,void 0,void 0,function(){var a,i,o,s,u=this;return Te(this,function(c){n==null&&(n={}),a=n.size==null?0:n.size,this.seen+=a,i=function(l){var f=n[l];if(typeof f=="number")o.totals.hasOwnProperty(l)||(o.totals[l]=0),o.totals[l]=o.totals[l]+f*a;else{var h=void 0;l in o.totals?h=o.totals[l]:o.totals[l]=0;var p=F.tidy(function(){return F.add(u.totals[l],F.mul(f,a))});o.totals[l]=p,h?.dispose()}},o=this;for(s in n)i(s);return[2]})})},e.prototype.onEpochEnd=function(t,n){return Ie(this,void 0,void 0,function(){var a,i,o,s,u,c,l,f=this;return Te(this,function(h){if(n!=null){a=function(p){if(i.totals[p]==null)return"continue";typeof i.totals[p]=="number"?n[p]=i.totals[p]/i.seen:F.tidy(function(){var d=F.mul(F.div(1,f.seen),f.totals[p]);n[p]=d,f.totals[p].dispose(),F.keep(n[p])})},i=this;try{for(o=le(this.params.metrics),s=o.next();!s.done;s=o.next())u=s.value,a(u)}catch(p){c={error:p}}finally{try{s&&!s.done&&(l=o.return)&&l.call(o)}finally{if(c)throw c.error}}}return[2]})})},e})(bu),nI=(function(r){ie(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.onTrainBegin=function(t){return Ie(this,void 0,void 0,function(){return Te(this,function(n){return this.epoch=[],this.history={},[2]})})},e.prototype.onEpochEnd=function(t,n){return Ie(this,void 0,void 0,function(){var a;return Te(this,function(i){n==null&&(n={}),this.epoch.push(t);for(a in n)this.history[a]==null&&(this.history[a]=[]),this.history[a].push(n[a]);return[2]})})},e.prototype.syncData=function(){return Ie(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l,f;return Te(this,function(h){switch(h.label){case 0:t=[],n=[],a=[];for(i in this.history)for(o=this.history[i],s=0;s<o.length;++s)typeof o[s]!="number"&&(u=o[s],t.push(u.data()),n.push(i),a.push(s));return[4,Promise.all(t)];case 1:for(c=h.sent(),l=0;l<c.length;++l)f=this.history[n[l]][a[l]],f.dispose(),this.history[n[l]][a[l]]=c[l][0];return[2]}})})},e})(bu),aI=(function(r){ie(e,r);function e(t,n){var a=r.call(this)||this;if(a.currentEpoch=0,a.nowFunc=t.nowFunc,a.nextFrameFunc=t.nextFrameFunc||F.nextFrame,a.yieldEvery=n||"auto",a.yieldEvery==="auto"&&(a.yieldEvery=FZ),a.yieldEvery==="never"&&t.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");return F.util.isNumber(a.yieldEvery)&&(a.maybeWait=bK(a.maybeWait.bind(a),a.yieldEvery,a.nowFunc)),a.trainBegin=t.onTrainBegin,a.trainEnd=t.onTrainEnd,a.epochBegin=t.onEpochBegin,a.epochEnd=t.onEpochEnd,a.batchBegin=t.onBatchBegin,a.batchEnd=t.onBatchEnd,a.yield=t.onYield,a}return e.prototype.maybeWait=function(t,n,a){return Ie(this,void 0,void 0,function(){var i;return Te(this,function(o){switch(o.label){case 0:return i=[],this.yield==null?[3,2]:[4,oo(a)];case 1:o.sent(),i.push(this.yield(t,n,a)),o.label=2;case 2:return i.push(this.nextFrameFunc()),[4,Promise.all(i)];case 3:return o.sent(),[2]}})})},e.prototype.onEpochBegin=function(t,n){return Ie(this,void 0,void 0,function(){return Te(this,function(a){switch(a.label){case 0:return this.currentEpoch=t,this.epochBegin==null?[3,3]:[4,oo(n)];case 1:return a.sent(),[4,this.epochBegin(t,n)];case 2:a.sent(),a.label=3;case 3:return[2]}})})},e.prototype.onEpochEnd=function(t,n){return Ie(this,void 0,void 0,function(){var a;return Te(this,function(i){switch(i.label){case 0:return a=[],this.epochEnd==null?[3,2]:[4,oo(n)];case 1:i.sent(),a.push(this.epochEnd(t,n)),i.label=2;case 2:return this.yieldEvery==="epoch"&&a.push(this.nextFrameFunc()),[4,Promise.all(a)];case 3:return i.sent(),[2]}})})},e.prototype.onBatchBegin=function(t,n){return Ie(this,void 0,void 0,function(){return Te(this,function(a){switch(a.label){case 0:return this.batchBegin==null?[3,3]:[4,oo(n)];case 1:return a.sent(),[4,this.batchBegin(t,n)];case 2:a.sent(),a.label=3;case 3:return[2]}})})},e.prototype.onBatchEnd=function(t,n){return Ie(this,void 0,void 0,function(){var a;return Te(this,function(i){switch(i.label){case 0:return a=[],this.batchEnd==null?[3,2]:[4,oo(n)];case 1:i.sent(),a.push(this.batchEnd(t,n)),i.label=2;case 2:return this.yieldEvery==="batch"?a.push(this.nextFrameFunc()):F.util.isNumber(this.yieldEvery)&&a.push(this.maybeWait(this.currentEpoch,t,n)),[4,Promise.all(a)];case 3:return i.sent(),[2]}})})},e.prototype.onTrainBegin=function(t){return Ie(this,void 0,void 0,function(){return Te(this,function(n){switch(n.label){case 0:return this.trainBegin==null?[3,3]:[4,oo(t)];case 1:return n.sent(),[4,this.trainBegin(t)];case 2:n.sent(),n.label=3;case 3:return[2]}})})},e.prototype.onTrainEnd=function(t){return Ie(this,void 0,void 0,function(){return Te(this,function(n){switch(n.label){case 0:return this.trainEnd==null?[3,3]:[4,oo(t)];case 1:return n.sent(),[4,this.trainEnd(t)];case 2:n.sent(),n.label=3;case 3:return[2]}})})},e})(bu);function iI(r,e){if(r==null&&(r={}),r instanceof bu)return[r];if(Array.isArray(r)&&r[0]instanceof bu)return r;var t=It(r);return t.map(function(n){return new aI(n,e)})}var fg=(function(){function r(){}return r.registerCallbackConstructor=function(e,t){F.util.assert(e>=0&&Number.isInteger(e),function(){return"Verbosity level is expected to be an integer >= 0, "+"but got ".concat(e)}),r.checkForDuplicate(t),r.constructors[e]==null&&(r.constructors[e]=[]),r.constructors[e].push(t)},r.checkForDuplicate=function(e){for(var t in r.constructors){var n=r.constructors[+t];n.forEach(function(a){if(a===e)throw new Y("Duplicate callback constructor.")})}},r.clear=function(){r.constructors={}},r.createCallbacks=function(e){var t=[];for(var n in r.constructors){var a=+n;e>=a&&t.push.apply(t,Xe([],ee(r.constructors[a]),!1))}return t.map(function(i){return new i})},r})();fg.constructors={};function oI(r,e,t,n,a,i,o,s,u){var c=new nI,l=Xe([new RZ],ee(fg.createCallbacks(e)),!1);r!=null&&l.push.apply(l,Xe([],ee(r),!1)),l.push(c);var f=new rI(l);return f.setParams({epochs:t,initialEpoch:n,samples:a,steps:i,batchSize:o,verbose:e,doValidation:s,metrics:u}),{callbackList:f,history:c}}function Ha(r,e,t){return e===void 0&&(e={}),t===void 0&&(t=!1),cl(r,F.serialization.SerializationMap.getMap().classNameMap,e,"layer",t)}function Ah(r,e){return F.tidy(function(){r.dtype!=="float32"&&(r=A.cast(r,"float32"));var t=A.sum(fl(r),e,!0),n=A.fill(t.shape,Cr()),a=A.sqrt(A.maximum(t,n));return A.div(r,a)})}function fs(r,e){return F.tidy(function(){return A.mean(fl(A.sub(e,r)),-1)})}function jh(r,e){return F.tidy(function(){return A.mean(A.abs(A.sub(e,r)),-1)})}function ku(r,e){return F.tidy(function(){var t=A.sub(r,e),n=A.clipByValue(A.abs(r),Cr(),Number.MAX_VALUE),a=A.abs(A.div(t,n));return A.mul(100,A.mean(a,-1))})}function OZ(r,e){return F.tidy(function(){var t=A.clipByValue(e,Cr(),Number.MAX_VALUE),n=A.log(A.add(1,t)),a=A.clipByValue(r,Cr(),Number.MAX_VALUE),i=A.log(A.add(1,a));return A.mean(fl(A.sub(n,i)),-1)})}function PZ(r,e){return F.tidy(function(){var t=A.maximum(0,A.sub(1,A.mul(r,e)));return A.mean(fl(t),-1)})}function MZ(r,e){return F.tidy(function(){var t=A.maximum(0,A.sub(1,A.mul(r,e)));return A.mean(t,-1)})}function BZ(r,e){return F.tidy(function(){var t=A.sum(A.mul(r,e),-1),n=A.max(A.mul(A.sub(1,r),e),-1);return A.maximum(0,A.add(1,A.sub(n,t)))})}function LZ(r,e){return F.tidy(function(){var t=Math.log(2),n=A.sub(e,r),a=A.sub(A.add(n,A.softplus(A.mul(-2,n))),t);return A.mean(a,-1)})}function ol(r,e,t){return t===void 0&&(t=!1),F.tidy(function(){if(t)e=A.softmax(e);else{var n=A.sum(e,e.shape.length-1,!0);e=A.div(e,n)}return e=A.clipByValue(e,Cr(),1-Cr()),A.neg(A.sum(A.mul(A.cast(r,"float32"),A.log(e)),e.shape.length-1))})}function Dh(r,e,t){return t===void 0&&(t=!1),F.tidy(function(){var n=A.cast(A.floor(_K(r)),"int32");e=A.clipByValue(e,Cr(),1-Cr());var a=e.shape,i=A.reshape(A.oneHot(n,a[a.length-1]),a);return ol(i,e,t)})}function zZ(r,e){if(!F.util.arraysEqual(r.shape,e.shape))throw new Y("logits and labels must have the same shape, but got shapes "+"".concat(JSON.stringify(r.shape)," and ").concat(JSON.stringify(e.shape)));return F.tidy(function(){var t=A.relu(e),n=A.neg(A.abs(e));return A.add(A.sub(t,A.mul(e,r)),A.log1p(A.exp(n)))})}function Xh(r,e){return F.tidy(function(){var t;return t=A.clipByValue(e,Cr(),1-Cr()),t=A.log(A.div(t,A.sub(1,t))),A.mean(zZ(r,t),-1)})}function $Z(r,e){return F.tidy(function(){var t=A.clipByValue(r,Cr(),1),n=A.clipByValue(e,Cr(),1);return A.sum(A.mul(r,A.log(A.div(t,n))),-1)})}function WZ(r,e){return F.tidy(function(){var t=A.log(A.add(Cr(),e));return A.mean(A.sub(e,A.mul(r,t)),-1)})}function hg(r,e){return F.tidy(function(){var t=Ah(r,-1),n=Ah(e,-1),a=A.mul(t,n);return A.neg(A.sum(a,-1))})}var _h={meanSquaredError:fs,meanAbsoluteError:jh,meanAbsolutePercentageError:ku,meanSquaredLogarithmicError:OZ,squaredHinge:PZ,hinge:MZ,categoricalHinge:BZ,logcosh:LZ,categoricalCrossentropy:ol,sparseCategoricalCrossentropy:Dh,binaryCrossentropy:Xh,kullbackLeiblerDivergence:$Z,poisson:WZ,cosineProximity:hg};function sm(r){if(typeof r=="string"){if(r in _h)return _h[r];var e="Unknown loss ".concat(r);throw r.toLowerCase().includes("softmaxcrossentropy")&&(e="Unknown loss ".concat(r,". ")+'Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy'),new Y(e)}else return r}function pg(r,e){return F.tidy(function(){var t=A.mul(.5,A.onesLike(e)),n=hi(A.greater(e,t),r.dtype);return A.mean(A.equal(r,n),-1)})}function dg(r,e){return F.tidy(function(){return hi(A.equal(A.argMax(r,-1),A.argMax(e,-1)),"float32")})}function sI(r,e){return F.tidy(function(){return A.cast(A.sum(A.logicalAnd(A.equal(r,1),A.equal(e,1))),"float32")})}function GZ(r,e){return F.tidy(function(){return A.cast(A.sum(A.logicalAnd(A.equal(r,1),A.equal(e,0))),"float32")})}function VZ(r,e){return F.tidy(function(){return A.cast(A.sum(A.logicalAnd(A.equal(r,0),A.equal(e,1))),"float32")})}function uI(r,e){return F.tidy(function(){var t=sI(r,e),n=VZ(r,e),a=A.add(t,n);return A.cast(A.where(A.greater(a,0),A.div(t,a),0),"float32")})}function UZ(r,e){return F.tidy(function(){var t=sI(r,e),n=GZ(r,e),a=A.add(t,n);return A.cast(A.where(A.greater(a,0),A.div(t,a),0),"float32")})}function cI(r,e){return Xh(r,e)}function lI(r,e){return r.rank===e.rank&&(r=A.squeeze(r,[r.rank-1])),e=A.argMax(e,-1),e.dtype!==r.dtype&&(e=A.cast(e,r.dtype)),A.cast(A.equal(r,e),"float32")}function HZ(r,e){return F.tidy(function(){var t=r.sub(e).square().sum(),n=r.sub(r.mean()).square().sum();return A.scalar(1).sub(t.div(n))})}var qZ=fs,KZ=fs,jZ=jh,XZ=jh,YZ=ku,ZZ=ku,vg=ol,JZ=hg,fI=Dh,Fh={binaryAccuracy:pg,categoricalAccuracy:dg,precision:uI,categoricalCrossentropy:vg,sparseCategoricalCrossentropy:fI,mse:qZ,MSE:KZ,mae:jZ,MAE:XZ,mape:YZ,MAPE:ZZ,cosine:JZ};function QZ(r){if(typeof r=="string"&&r in Fh)return Fh[r];if(typeof r!="string"&&r!=null)return r;throw new Y("Unknown metric ".concat(r))}function lh(r){var e,t,n,a;if(ci(r!==null,"Unknown LossOrMetricFn ".concat(r)),typeof r=="string")return r;var i=void 0;try{for(var o=le(Object.keys(_h)),s=o.next();!s.done;s=o.next()){var u=s.value;if(_h[u]===r){i=u;break}}}catch(f){e={error:f}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}if(i!==void 0)return i;try{for(var c=le(Object.keys(Fh)),l=c.next();!l.done;l=c.next()){var u=l.value;if(Fh[u]===r){i=u;break}}}catch(f){n={error:f}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(n)throw n.error}}return i!==void 0?i:r.name}function eJ(r){var e={Adagrad:function(){return F.train.adagrad(.01)},Adadelta:function(){return F.train.adadelta(1,.95,Cr())},Adam:function(){return F.train.adam(.001,.9,.999,Cr())},Adamax:function(){return F.train.adamax(.002,.9,.999,Cr(),0)},RMSProp:function(){return F.train.rmsprop(.001,.9,0,Cr())},SGD:function(){return F.train.sgd(.01)}};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,r in e)return e[r]();throw new Y("Unknown Optimizer ".concat(r))}var eT=1*1024*1024;function tT(r,e,t){if(t===void 0&&(t=!1),r==null||typeof r!="object"||Object.getPrototypeOf(r)!==Object.prototype||!Tm(r))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(t){var n=JSON.stringify(r);n.length>eT&&console.warn('User-defined metadata of model "'.concat(e,'" is too large in ')+"size (length=".concat(n.length," when serialized). It is not ")+"recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= "+"".concat(eT,"."))}}function Tm(r){var e,t,n,a;if(r===null)return!0;if(typeof r=="object")if(Object.getPrototypeOf(r)===Object.prototype){var i=Object.keys(r);try{for(var o=le(i),s=o.next();!s.done;s=o.next()){var u=s.value;if(typeof u!="string"||!Tm(r[u]))return!1}}catch(p){e={error:p}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}return!0}else if(Array.isArray(r)){try{for(var c=le(r),l=c.next();!l.done;l=c.next()){var f=l.value;if(!Tm(f))return!1}}catch(p){n={error:p}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(n)throw n.error}}return!0}else return!1;else{var h=typeof r;return h==="string"||h==="number"||h==="boolean"}}function tJ(r,e,t,n){n===void 0&&(n=console.log);var a=nJ(r),i=["Layer (type)","Input Shape","Output shape","Param #"];a?(e=e||90,t=t||[.32,.61,.89,1]):(e=e||115,t=t||[.24,.48,.7,.8,1]),t[t.length-1]<=1&&(t=t.map(function(h){return Math.floor(e*h)}));var o;if(!a){i.push("Receives inputs"),o=[];for(var s in r.nodesByDepth)o.push.apply(o,Xe([],ee(r.nodesByDepth[s]),!1))}n("_".repeat(e)),Rh(i,t,n),n("=".repeat(e));for(var u=r.layers,c=0;c<u.length;++c)a?aJ(u[c],t,n):iJ(u[c],t,o,n),n((c===u.length-1?"=":"_").repeat(e));r.checkTrainableWeightsConsistency();var l=rJ(r),f=gh(r.nonTrainableWeights);n("Total params: ".concat(l+f)),n("Trainable params: ".concat(l)),n("Non-trainable params: ".concat(f)),n("_".repeat(e))}function rJ(r){var e;return r.collectedTrainableWeights!=null?e=gh(r.collectedTrainableWeights):e=gh(r.trainableWeights),e}function nJ(r){var e,t,n,a,i,o,s=!0,u=[],c=[];for(var l in r.nodesByDepth)u.push(r.nodesByDepth[l]);try{for(var f=le(u),h=f.next();!h.done;h=f.next()){var p=h.value;if(p.length>1||p.length===1&&p[0].inboundLayers.length>1){s=!1;break}c.push.apply(c,Xe([],ee(p),!1))}}catch(x){e={error:x}}finally{try{h&&!h.done&&(t=f.return)&&t.call(f)}finally{if(e)throw e.error}}if(s)try{for(var d=le(r.layers),m=d.next();!m.done;m=d.next()){var v=m.value,g=!1;try{for(var y=(i=void 0,le(v.inboundNodes)),w=y.next();!w.done;w=y.next()){var b=w.value;if(c.indexOf(b)!==-1)if(g){s=!1;break}else g=!0}}catch(x){i={error:x}}finally{try{w&&!w.done&&(o=y.return)&&o.call(y)}finally{if(i)throw i.error}}if(!s)break}}catch(x){n={error:x}}finally{try{m&&!m.done&&(a=d.return)&&a.call(d)}finally{if(n)throw n.error}}return s}function Rh(r,e,t){t===void 0&&(t=console.log);for(var n="",a=0;a<r.length;++a)a>0&&(n=n.slice(0,n.length-1)+" "),n+=r[a],n=n.slice(0,e[a]),n+=" ".repeat(e[a]-n.length);t(n)}function aJ(r,e,t){var n,a;try{a=r.inboundNodes.map(function(u){return JSON.stringify(u.inputShapes)}).join(",")}catch{a="multiple"}try{n=JSON.stringify(r.outputShape)}catch{n="multiple"}var i=r.name,o=r.getClassName(),s=["".concat(i," (").concat(o,")"),a,n,r.countParams().toString()];Rh(s,e,t)}function iJ(r,e,t,n){var a,i,o,s;try{s=r.inboundNodes.map(function(b){return JSON.stringify(b.inputShapes)}).join(",")}catch{s="multiple"}try{o=JSON.stringify(r.outputShape)}catch{o="multiple"}var u=[];try{for(var c=le(r.inboundNodes),l=c.next();!l.done;l=c.next()){var f=l.value;if(!(t!=null&&t.length>0&&t.indexOf(f)===-1))for(var h=0;h<f.inboundLayers.length;++h){var p=f.inboundLayers[h].name,d=f.nodeIndices[h],m=f.tensorIndices[h];u.push("".concat(p,"[").concat(d,"][").concat(m,"]"))}}}catch(b){a={error:b}}finally{try{l&&!l.done&&(i=c.return)&&i.call(c)}finally{if(a)throw a.error}}var v=r.name,g=r.getClassName(),y=u.length===0?"":u[0],w=["".concat(v," (").concat(g,")"),s,o,r.countParams().toString(),y];Rh(w,e,n);for(var h=1;h<u.length;++h)Rh(["","","","",u[h]],e,n)}function hI(r,e,t){return(r==="inboundNodes"||r==="outputLayers"||r==="inputLayers")&&e===0&&typeof t=="string"}function sl(r,e){var t,n;if(r===null)return null;if(typeof r=="string")return Jo(r);if(typeof r=="number"||typeof r=="boolean")return r;if(r instanceof Array){for(var a=[],i=r.length,o=0;o<i;++o){var s=r[o];hI(e,o,s)?a.push(s):a.push(sl(s,e))}return a}else{var u={};try{for(var c=le(Object.keys(r)),l=c.next();!l.done;l=c.next()){var f=l.value,h=r[f];if(f==="name"&&typeof h=="string")u[f]=h;else{var p=Jo(f);u[p]=sl(h,p)}}}catch(d){t={error:d}}finally{try{l&&!l.done&&(n=c.return)&&n.call(c)}finally{if(t)throw t.error}}return u}}function Nm(r,e){var t,n;if(r==null)return null;if(typeof r=="string")return Fi(r);if(typeof r=="number"||typeof r=="boolean")return r;if(r instanceof Array){for(var a=[],i=r.length,o=0;o<i;++o){var s=r[o];hI(e,o,s)?a.push(s):a.push(Nm(s,e))}return a}else{var u={};try{for(var c=le(Object.keys(r)),l=c.next();!l.done;l=c.next()){var f=l.value,h=r[f],p=Fi(f);(f==="name"||f==="className")&&typeof h=="string"?u[p]=h:u[p]=Nm(h,f)}}catch(d){t={error:d}}finally{try{l&&!l.done&&(n=c.return)&&n.call(c)}finally{if(t)throw t.error}}return u}}var mg="4.22.0",oJ=function(r){var e=Object.keys(r);if(e.length===0)return!1;var t=e[0].split("/");return!isNaN(parseInt(t[t.length-1],10))},sJ=(function(r){ie(e,r);function e(t){var n,a,i,o,s,u,c,l,f,h,p,d,m,v,g,y,w,b,x,S,T,N,C,R,_=r.call(this,{})||this;if(_.containerNodes=new Set,_.name=t.name,_.name==null){var P=_.getClassName().toLowerCase();_.name=Oh(P)}if(_.supportsMasking=!1,_.trainable_=!0,Array.isArray(t.inputs)?_.inputs=t.inputs.slice():_.inputs=[t.inputs],Array.isArray(t.outputs)?_.outputs=t.outputs.slice():_.outputs=[t.outputs],uo(_.inputs).length!==_.inputs.length)throw new Y("The list of inputs passed to the model is redundant. All inputs should only appear once. Found: "+"".concat(_.inputs.map(function(ut){return ut.name})));uo(_.outputs).length!==_.outputs.length&&console.warn("The list of outputs passed to the model is redundant. All outputs should only appear once. Found: "+"".concat(_.outputs.map(function(ut){return ut.name}))),_.inputLayers=[],_.inputLayersNodeIndices=[],_.inputLayersTensorIndices=[],_.outputLayers=[],_.outputLayersNodeIndices=[],_.outputLayersTensorIndices=[],_.layers=[],_.internalContainerRefs=[];try{for(var $=le(_.outputs),z=$.next();!z.done;z=$.next()){var L=z.value,B=L.sourceLayer,G=L.nodeIndex,X=L.tensorIndex;_.outputLayers.push(B),_.outputLayersNodeIndices.push(G),_.outputLayersTensorIndices.push(X)}}catch(ut){n={error:ut}}finally{try{z&&!z.done&&(a=$.return)&&a.call($)}finally{if(n)throw n.error}}try{for(var Z=le(_.inputs),V=Z.next();!V.done;V=Z.next()){var L=V.value,B=L.sourceLayer,G=L.nodeIndex,X=L.tensorIndex;ci(G===0,"input layer has >1 nodes"),ci(X===0,"input layer has >1 tensors"),_.inputLayers.push(B),_.inputLayersNodeIndices.push(G),_.inputLayersTensorIndices.push(X)}}catch(ut){i={error:ut}}finally{try{V&&!V.done&&(o=Z.return)&&o.call(Z)}finally{if(i)throw i.error}}_.inputNames=[],_.outputNames=[],_.feedInputShapes=[],_.feedInputNames=[],_.feedOutputNames=[];for(var j=0;j<_.inputLayers.length;j++){var B=_.inputLayers[j];if(!(B instanceof wu))throw new TypeError("Input layers to a LayersModel must be InputLayer objects. "+"Received inputs: ".concat(t.inputs,". ")+"Input ".concat(j," (0-based) originates ")+"from layer type ".concat(B.getClassName(),"."));_.inputNames.push(B.name),_.feedInputShapes.push(B.batchInputShape),_.feedInputNames.push(B.name)}try{for(var re=le(_.outputLayers),te=re.next();!te.done;te=re.next()){var B=te.value;_.outputNames.push(B.name)}}catch(ut){s={error:ut}}finally{try{te&&!te.done&&(u=re.return)&&u.call(re)}finally{if(s)throw s.error}}_.internalInputShapes=_.inputs.map(function(ut){return ut.shape}),_.internalOutputShapes=_.outputs.map(function(ut){return ut.shape});var oe={},ce={},pe={},xe={},fe={},ge=[],we=function(ut,ca,Ba,Nn,_o,Iw){(Nn==null||_o==null||Iw==null)&&(Nn=ut.sourceLayer,_o=ut.nodeIndex,Iw=ut.tensorIndex);var Xn=Nn.inboundNodes[_o];if(Ba.indexOf(Xn)!==-1)throw new fi("The tensor ".concat(ut.name,' at layer "').concat(Nn.name,'" ')+"is part of a cycle.");if(ca.indexOf(Xn)===-1){_.containerNodes.add(e.nodeKey(Nn,_o)),Nn.id in fe||(fe[Nn.id]=Object.keys(fe).length),Ba.indexOf(Xn)===-1&&Ba.push(Xn);for(var yM=Xn.inboundLayers.length,Us=0;Us<yM;Us++){var bM=Xn.inputTensors[Us],wM=Xn.inboundLayers[Us],xM=Xn.nodeIndices[Us],kM=Xn.tensorIndices[Us];we(bM,ca,Ba,wM,xM,kM)}for(ca.push(Xn);Ba.indexOf(Xn)>=0;)Ba.splice(Ba.indexOf(Xn),1);ge.push(Xn)}},Ae=[],Ke=[];try{for(var ot=le(_.outputs),et=ot.next();!et.done;et=ot.next()){var L=et.value;we(L,Ae,Ke)}}catch(ut){c={error:ut}}finally{try{et&&!et.done&&(l=ot.return)&&l.call(ot)}finally{if(c)throw c.error}}var Qe=ge.slice().reverse();try{for(var it=le(Qe),nt=it.next();!nt.done;nt=it.next()){var je=nt.value;ce[je.id]=je,je.id in oe||(oe[je.id]=0);var Je=oe[je.id],Ze=pe[je.outboundLayer.id]==null?0:pe[je.outboundLayer.id];Je=Math.max(Je,Ze),pe[je.outboundLayer.id]=Je,xe[je.outboundLayer.id]=je.outboundLayer,oe[je.id]=Je;for(var j=0;j<je.inboundLayers.length;j++){var Yt=je.inboundLayers[j],G=je.nodeIndices[j],qe=Yt.inboundNodes[G],vt=oe[qe.id]==null?0:oe[qe.id];oe[qe.id]=Math.max(Je+1,vt),ce[qe.id]=qe}}}catch(ut){f={error:ut}}finally{try{nt&&!nt.done&&(h=it.return)&&h.call(it)}finally{if(f)throw f.error}}var vr={};for(var nn in oe){var Je=oe[nn];Je in vr||(vr[Je]=[]),vr[Je].push(ce[nn])}var kr={};for(var mr in pe){var Je=pe[mr];Je in kr||(kr[Je]=[]),kr[Je].push(xe[mr])}var Zt=Object.keys(kr).map(function(ut){return parseInt(ut,10)}).sort(sh);_.layers=[];try{for(var En=le(Zt),an=En.next();!an.done;an=En.next()){var Je=an.value,Tn=kr[Je];Tn.sort(function(ca,Ba){var Nn=fe[ca.id],_o=fe[Ba.id];return Nn<_o?-1:Nn>_o?1:0});try{for(var fr=(m=void 0,le(Tn)),ki=fr.next();!ki.done;ki=fr.next()){var B=ki.value;B instanceof e&&_.internalContainerRefs.push(B),_.layers.push(B)}}catch(ca){m={error:ca}}finally{try{ki&&!ki.done&&(v=fr.return)&&v.call(fr)}finally{if(m)throw m.error}}}}catch(ut){p={error:ut}}finally{try{an&&!an.done&&(d=En.return)&&d.call(En)}finally{if(p)throw p.error}}_.layersByDepth=kr,Zt=Object.keys(vr).map(function(ut){return parseInt(ut,10)}).sort(sh);var Gs=_.inputs.slice(),wf=[];try{for(var Si=le(Zt),Do=Si.next();!Do.done;Do=Si.next()){var Je=Do.value;try{for(var Vs=(w=void 0,le(vr[Je])),fc=Vs.next();!fc.done;fc=Vs.next()){var je=fc.value,B=je.outboundLayer;if(B!=null){try{for(var xf=(x=void 0,le(je.inputTensors)),hc=xf.next();!hc.done;hc=xf.next()){var L=hc.value;if(Gs.indexOf(L)===-1)throw new fi("Graph disconnected: cannot obtain value for tensor ".concat(L)+' at layer "'.concat(B.name,'". ')+"The following previous layers were accessed without "+"issue: ".concat(wf))}}catch(Nn){x={error:Nn}}finally{try{hc&&!hc.done&&(S=xf.return)&&S.call(xf)}finally{if(x)throw x.error}}try{for(var kf=(T=void 0,le(je.outputTensors)),pc=kf.next();!pc.done;pc=kf.next()){var L=pc.value;Gs.push(L)}}catch(Nn){T={error:Nn}}finally{try{pc&&!pc.done&&(N=kf.return)&&N.call(kf)}finally{if(T)throw T.error}}wf.push(B.name)}}}catch(ca){w={error:ca}}finally{try{fc&&!fc.done&&(b=Vs.return)&&b.call(Vs)}finally{if(w)throw w.error}}}}catch(ut){g={error:ut}}finally{try{Do&&!Do.done&&(y=Si.return)&&y.call(Si)}finally{if(g)throw g.error}}_.nodesByDepth=vr;var Fd=_.layers.map(function(ut){return ut.name}),mM=function(ut){var ca=Fd.filter(function(Ba){return Ba===ut}).length;if(ca!==1)throw new fi('The name "'.concat(ut,'" is used ').concat(ca," times ")+"in the model. All layer names should be unique. Layer names: "+JSON.stringify(Fd))};try{for(var Sf=le(Fd),dc=Sf.next();!dc.done;dc=Sf.next()){var gM=dc.value;mM(gM)}}catch(ut){C={error:ut}}finally{try{dc&&!dc.done&&(R=Sf.return)&&R.call(Sf)}finally{if(C)throw C.error}}return _.outboundNodes=[],_.inboundNodes=[],new Vh({outboundLayer:_,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:_.inputs,outputTensors:_.outputs,inputMasks:_.inputs.map(function(ut){return null}),outputMasks:_.outputs.map(function(ut){return null}),inputShapes:_.inputs.map(function(ut){return ut.shape}),outputShapes:_.outputs.map(function(ut){return ut.shape})}),_.built=!0,_._refCount=1,_}return e.prototype.assertNotDisposed=function(){if(this._refCount===0)throw new Error("Container '".concat(this.name,"' is already disposed."))},e.prototype.dispose=function(){var t,n,a,i;this.assertNotDisposed();var o={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){try{for(var s=le(this.layers),u=s.next();!u.done;u=s.next()){var c=u.value;o.numDisposedVariables+=c.dispose().numDisposedVariables}}catch(p){t={error:p}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}try{for(var l=le(this.internalContainerRefs),f=l.next();!f.done;f=l.next()){var h=f.value;o.numDisposedVariables+=h.dispose().numDisposedVariables}}catch(p){a={error:p}}finally{try{f&&!f.done&&(i=l.return)&&i.call(l)}finally{if(a)throw a.error}}}return o.refCountAfterDispose=this._refCount,o},Object.defineProperty(e.prototype,"trainable",{get:function(){return this.trainable_},set:function(t){this.layers.forEach(function(n){n._trainableWeights.forEach(function(a){return a.trainable=t})}),this.trainable_=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"trainableWeights",{get:function(){var t,n;if(this._trainableWeights.length>0)throw new Y("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];var a=[];try{for(var i=le(this.layers),o=i.next();!o.done;o=i.next()){var s=o.value;a=a.concat(s.trainableWeights)}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return a},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){var t,n,a,i,o=[];try{for(var s=le(this.layers),u=s.next();!u.done;u=s.next()){var c=u.value;o.push.apply(o,Xe([],ee(c.nonTrainableWeights),!1))}}catch(p){t={error:p}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}if(!this.trainable){var l=[];try{for(var f=le(this.layers),h=f.next();!h.done;h=f.next()){var c=h.value;l.push.apply(l,Xe([],ee(c.trainableWeights),!1))}}catch(p){a={error:p}}finally{try{h&&!h.done&&(i=f.return)&&i.call(f)}finally{if(a)throw a.error}}return l.concat(o)}return o},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!1,configurable:!0}),e.prototype.loadWeights=function(t,n){var a,i,o,s;n===void 0&&(n=!0);var u={},c=0,l=oJ(t);l&&this.parseWeights(t);try{for(var f=le(this.layers),h=f.next();!h.done;h=f.next()){var p=h.value;try{for(var d=(o=void 0,le(p.weights.entries())),m=d.next();!m.done;m=d.next()){var v=ee(m.value,2),g=v[0],y=v[1],w=l?"".concat(y.name.split("/").slice(0,-1).join("/")+"/").concat(g):y.originalName;if(u[w]!=null)throw new Y("Duplicate weight name: ".concat(w));u[w]=y,c++}}catch(R){o={error:R}}finally{try{m&&!m.done&&(s=d.return)&&s.call(d)}finally{if(o)throw o.error}}}}catch(R){a={error:R}}finally{try{h&&!h.done&&(i=f.return)&&i.call(f)}finally{if(a)throw a.error}}var b=[];for(var x in t){var S=x;if(u[x]==null){var T=x.split("/"),N=T.slice(0,-2).concat([T[T.length-1]]);S=N.join("/")}if(u[S]!=null)b.push([u[S],t[x]]);else if(n)throw new Y("Provided weight data has no target variable: ".concat(x));delete u[S]}if(n){var C=[];for(var x in u)C.push(x);if(C.length>0)throw new Y("".concat(C.length," of ").concat(c," weights are not set: ")+"".concat(C))}zm(b)},e.prototype.parseWeights=function(t){var n=function(i){var o=i.split("/"),s=["vars","layer_checkpoint_dependencies"],u=o.map(function(c){return c.startsWith("_")?c.slice(1):c}).filter(function(c){return!s.includes(c)}).join("/");u!==i&&(t[u]=t[i],delete t[i])};for(var a in Object.keys(t))n(a)},e.prototype.updatedConfig=function(){var t=this.getConfig(),n={};return n.className=this.getClassName(),n.config=t,n.kerasVersion="tfjs-layers ".concat(mg),n.backend="TensorFlow.js",n},e.prototype.toJSON=function(t,n){n===void 0&&(n=!0);var a=Nm(this.updatedConfig());return n?JSON.stringify(a):a},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){t=It(t);for(var i=new hu,o=0;o<a.inputs.length;++o)i.add(a.inputs[o],t[o]);return Qc(a.outputs,i,n)})},e.prototype.computeMask=function(t,n){var a=this;return F.tidy(function(){t=It(t);var i;return n==null?i=rs(null,t.length):i=It(n),a.runInternalGraph(t,i)[1]})},e.prototype.computeOutputShape=function(t){var n,a,i,o,s=mh(t);if(s.length!==this.inputLayers.length)throw new Y("Invalid inputShape argument ".concat(t,": ")+"model has ".concat(this.inputLayers.length," tensor inputs."));for(var u={},c=0;c<s.length;c++){var l=this.inputLayers[c],f=s[c],h=l.name+"_0_0";u[h]=f}var p=Object.keys(this.nodesByDepth).map(function(G){return parseInt(G,10)}).sort(sh);if(p.length>1)try{for(var d=le(p),m=d.next();!m.done;m=d.next()){var v=m.value,g=this.nodesByDepth[v];try{for(var y=(i=void 0,le(g)),w=y.next();!w.done;w=y.next()){var b=w.value,l=b.outboundLayer;if(this.inputLayers.map(function(X){return X.id}).indexOf(l.id)===-1){for(var x=[],S=0;S<b.inboundLayers.length;S++){var T=b.inboundLayers[S],N=b.nodeIndices[S],C=b.tensorIndices[S],h="".concat(T.name,"_").concat(N,"_").concat(C),R=u[h];x.push(R)}for(var _=l.computeOutputShape(mn(x)),P=mh(_),$=l.inboundNodes.indexOf(b),S=0;S<P.length;S++){var h="".concat(l.name,"_").concat($,"_").concat(S);u[h]=P[S]}}}}catch(G){i={error:G}}finally{try{w&&!w.done&&(o=y.return)&&o.call(y)}finally{if(i)throw i.error}}}}catch(G){n={error:G}}finally{try{m&&!m.done&&(a=d.return)&&a.call(d)}finally{if(n)throw n.error}}for(var z=[],L=[],c=0;c<this.outputLayers.length;c++){var l=this.outputLayers[c],$=this.outputLayersNodeIndices[c],C=this.outputLayersTensorIndices[c],h="".concat(l.name,"_").concat($,"_").concat(C);L.push(h)}for(var c=0;c<L.length;c++){var B=L[c];ci(B in u),z.push(u[B])}return mn(z)},e.prototype.runInternalGraph=function(t,n){var a,i,o,s,u,c,l,f;n==null&&(n=rs(null,t.length));for(var h={},p=0;p<this.inputs.length;++p){var d=this.inputs[p],m=t[p],v=n[p];h[d.id]=[m,v]}var g=Object.keys(this.nodesByDepth).map(function(we){return parseInt(we,10)}).sort(sh);try{for(var y=le(g),w=y.next();!w.done;w=y.next()){var b=w.value,x=this.nodesByDepth[b];try{for(var S=(o=void 0,le(x)),T=S.next();!T.done;T=S.next()){var N=T.value,C=N.outboundLayer,R=N.inputTensors,_=N.outputTensors,P=new Array;try{for(var $=(u=void 0,le(R)),z=$.next();!z.done;z=$.next()){var d=z.value;d.id in h&&P.push(h[d.id])}}catch(we){u={error:we}}finally{try{z&&!z.done&&(c=$.return)&&c.call($)}finally{if(u)throw u.error}}if(P.length===R.length){var L={},B=void 0,G=void 0,X=void 0,Z=void 0;if(N.callArgs!=null&&(L=N.callArgs),P.length===1){var V=ee(P[0],2),j=V[0],re=V[1];L.mask==null&&(L.mask=re),X=It(C.call(j,L)),Z=It(C.computeMask(j,re)),B=[j],G=[re]}else B=P.map(function(we){return we[0]}),G=P.map(function(we){return we[1]}),L.mask==null&&(L.mask=G),X=It(C.call(B,L)),Z=It(C.computeMask(B,G));if(C.activityRegularizer)throw new ct("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(var p=0;p<_.length;++p){var d=_[p],m=X[p],v=Z[p];h[d.id]=[m,v]}}}}catch(we){o={error:we}}finally{try{T&&!T.done&&(s=S.return)&&s.call(S)}finally{if(o)throw o.error}}}}catch(we){a={error:we}}finally{try{w&&!w.done&&(i=y.return)&&i.call(y)}finally{if(a)throw a.error}}var te=[],oe=[],ce=[];try{for(var pe=le(this.outputs),xe=pe.next();!xe.done;xe=pe.next()){var d=xe.value;ci(d.id in h,"Could not compute output ".concat(d.name," : ").concat(d.id));var fe=ee(h[d.id],2),ge=fe[0],v=fe[1];ce.push(ge.shape),te.push(ge),oe.push(v)}}catch(we){l={error:we}}finally{try{xe&&!xe.done&&(f=pe.return)&&f.call(pe)}finally{if(l)throw l.error}}return[te,oe,ce]},e.prototype.buildNodeConversionMap=function(t){var n,a,i={},o;try{for(var s=le(this.layers),u=s.next();!u.done;u=s.next()){var c=u.value;o=c instanceof e?1:0;for(var l=0;l<c.inboundNodes.length;l++){var f=e.nodeKey(c,l);this.containerNodes.has(f)&&(i[f]=o,o+=1)}}}catch(h){n={error:h}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(n)throw n.error}}return i},e.prototype.getLayer=function(t,n){var a,i;if(n!=null)return this.findLayer(n);if(t==null)throw new Y("Provide either a layer name or layer index");if(typeof t=="number")return this.findLayer(t);try{for(var o=le(this.layers),s=o.next();!s.done;s=o.next()){var u=s.value;if(u.name===t)return u}}catch(c){a={error:c}}finally{try{s&&!s.done&&(i=o.return)&&i.call(o)}finally{if(a)throw a.error}}throw new Y("No such layer: ".concat(t))},e.prototype.findLayer=function(t){if(this.layers.length<=t)throw new Y("Was asked to retrieve layer at index ".concat(t,", but model only ")+"has ".concat(this.layers.length," layer(s)."));return this.layers[t]},e.prototype.calculateLosses=function(){var t=this;return F.tidy(function(){var n,a,i=[];try{for(var o=le(t.layers),s=o.next();!s.done;s=o.next())for(var u=s.value,c=0;c<u.inboundNodes.length;++c){var l=e.nodeKey(u,c);t.containerNodes.has(l)&&i.push.apply(i,Xe([],ee(u.calculateLosses()),!1))}}catch(f){n={error:f}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}return i})},e.prototype.getConfig=function(){var t,n,a={name:this.name},i=this.buildNodeConversionMap(this.layers),o=[];try{for(var s=le(this.layers),u=s.next();!u.done;u=s.next()){for(var c=u.value,l=c.getClassName(),f=c.getConfig(),h=[],p=0;p<c.inboundNodes.length;p++){var d=c.inboundNodes[p],m=e.nodeKey(c,p),v={};if(this.containerNodes.has(m)){if(d.callArgs)try{JSON.stringify(d.callArgs),v=d.callArgs}catch{console.warn("Layer ".concat(c.name," was passed ")+"non-serializable keyword arguments: "+"".concat(d.callArgs,". They will not be included ")+"in the serialized model (and thus will be missing at deserialization time)."),v={}}if(d.inboundLayers.length>0){for(var g=[],y=0;y<d.inboundLayers.length;y++){var w=d.inboundLayers[y],b=d.nodeIndices[y],x=d.tensorIndices[y],S=e.nodeKey(w,b),T=i[S];T==null&&(T=0),g.push([w.name,T,x,v])}h.push(g)}}}var N={};N.name=c.name,N.className=l,N.config=f,N.inboundNodes=h,o.push(N)}}catch(_){t={error:_}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}a.layers=o;for(var C=[],y=0;y<this.inputLayers.length;y++){var c=this.inputLayers[y],b=this.inputLayersNodeIndices[y],m=e.nodeKey(c,b);if(this.containerNodes.has(m)){var T=i[m];T==null&&(T=0);var x=this.inputLayersTensorIndices[y];C.push([c.name,T,x])}}a.inputLayers=C;for(var R=[],y=0;y<this.outputLayers.length;y++){var c=this.outputLayers[y],b=this.outputLayersNodeIndices[y],m=e.nodeKey(c,b);if(this.containerNodes.has(m)){var T=i[m];T==null&&(T=0);var x=this.outputLayersTensorIndices[y];R.push([c.name,T,x])}}return a.outputLayers=R,a},e.fromConfig=function(t,n,a,i){var o,s,u,c,l,f,h,p,d,m;i===void 0&&(i=!1);var v={},g={};function y(ge,we){ge.name in g?g[ge.name].push(we):g[ge.name]=[we]}function w(ge,we){var Ae,Ke,ot=[],et;try{for(var Qe=le(we),it=Qe.next();!it.done;it=Qe.next()){var nt=it.value,je=nt[0],Je=nt[1],Ze=nt[2];if(et=nt[3]==null?{}:nt[3],!(je in v)){y(ge,we);return}var Yt=v[je];if(Yt.inboundNodes.length<=Je){y(ge,we);return}var qe=Yt.inboundNodes[Je];ot.push(qe.outputTensors[Ze])}}catch(vt){Ae={error:vt}}finally{try{it&&!it.done&&(Ke=Qe.return)&&Ke.call(Qe)}finally{if(Ae)throw Ae.error}}ot.length>0&&ge.apply(mn(ot),et)}function b(ge){var we=ge.name,Ae=Ha(ge,n.customObjects!=null?n.customObjects:{});Ae.setFastWeightInitDuringBuild(i),v[we]=Ae;var Ke=ge.inboundNodes;Ke.forEach(function(ot){if(!(ot instanceof Array))throw new Y("Corrupted configuration, expected array for nodeData: ".concat(ot));y(Ae,ot)})}var x=n.name,S=n.layers;try{for(var T=le(S),N=T.next();!N.done;N=T.next()){var C=N.value;b(C)}}catch(ge){o={error:ge}}finally{try{N&&!N.done&&(s=T.return)&&s.call(T)}finally{if(o)throw o.error}}for(;!yK(g);)try{for(var R=(u=void 0,le(S)),_=R.next();!_.done;_=R.next()){var C=_.value,P=v[C.name];if(P.name in g){var $=g[P.name];delete g[P.name];try{for(var z=(l=void 0,le($)),L=z.next();!L.done;L=z.next()){var B=L.value;w(P,B)}}catch(we){l={error:we}}finally{try{L&&!L.done&&(f=z.return)&&f.call(z)}finally{if(l)throw l.error}}}}}catch(ge){u={error:ge}}finally{try{_&&!_.done&&(c=R.return)&&c.call(R)}finally{if(u)throw u.error}}var G=[],X=[],Z=n.inputLayers;try{for(var V=le(Z),j=V.next();!j.done;j=V.next()){var C=j.value,re=C[0],te=C[1],oe=C[2];ci(re in v);var P=v[re],ce=P.inboundNodes[te].outputTensors;G.push(ce[oe])}}catch(ge){h={error:ge}}finally{try{j&&!j.done&&(p=V.return)&&p.call(V)}finally{if(h)throw h.error}}var pe=n.outputLayers;try{for(var xe=le(pe),fe=xe.next();!fe.done;fe=xe.next()){var C=fe.value,re=C[0],te=C[1],oe=C[2];ci(re in v);var P=v[re],ce=P.inboundNodes[te].outputTensors;X.push(ce[oe])}}catch(ge){d={error:ge}}finally{try{fe&&!fe.done&&(m=xe.return)&&m.call(xe)}finally{if(d)throw d.error}}return new t({inputs:G,outputs:X,name:x})},Object.defineProperty(e.prototype,"stateful",{get:function(){var t,n;if(this._stateful)throw new Y("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");try{for(var a=le(this.layers),i=a.next();!i.done;i=a.next()){var o=i.value;if(o.stateful)return!0}}catch(s){t={error:s}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return!1},enumerable:!1,configurable:!0}),e.prototype.resetStates=function(){var t=this;F.tidy(function(){t.layers.forEach(function(n){n.stateful&&n.resetStates()})})},e})(lt);function uJ(r,e,t){var n=e.length;if(r==null||Array.isArray(r)&&r.length===0)return e.map(function(i){return null});if(n===1)return Array.isArray(r)&&r.length===1?r:typeof r=="object"&&e[0]in r?[r[e[0]]]:[r];if(Array.isArray(r)){if(r.length!==n)throw new Error("Provided ".concat(t," is an array of ").concat(r.length," ")+"element(s), but the model has ".concat(n," outputs. ")+"Make sure a set of weights is provided for each model output.");return r}else if(typeof r=="object"&&Object.keys(r).length>0&&typeof r[Object.keys(r)[0]]=="object"){var a=[];return e.forEach(function(i){i in r?a.push(r[i]):a.push(null)}),a}else throw new Error("The model has multiple (".concat(n,") outputs, ")+"so ".concat(t," must be either an array with ")+"".concat(n," elements or an object with ").concat(e," keys. ")+"Provided ".concat(t," not understood: ").concat(JSON.stringify(r)))}function pI(r,e){return uJ(r,e,"classWeight")}function dI(r,e,t,n){return Ie(this,void 0,void 0,function(){var a,i,o,s,u;return Te(this,function(c){switch(c.label){case 0:if(e!=null||n!=null)throw new Error("Support sampleWeight is not implemented yet");return t==null?[3,2]:(a=F.tidy(function(){if(r.shape.length===1)return F.clone(r);if(r.shape.length===2)if(r.shape[1]>1){var l=1;return F.argMax(r,l)}else{if(r.shape[1]===1)return F.reshape(r,[r.shape[0]]);throw new Error("Encountered unexpected last-dimension size (".concat(r.shape[1],") ")+"during handling of class weights. The size is expected to be >= 1.")}else throw new Error("Unexpected rank of target (y) tensor (".concat(r.rank,") during ")+"handling of class weights. The rank is expected to be 1 or 2.")}),s=(o=Array).from,[4,a.data()]);case 1:return i=s.apply(o,[c.sent()]),F.dispose(a),u=[],i.forEach(function(l){if(t[l]==null)throw new Error("classWeight must contain all classes in the training data. "+"The class ".concat(l," exists in the data but not in ")+"classWeight");u.push(t[l])}),[2,F.tensor1d(u,"float32")];case 2:return[2,null]}})})}function cJ(r,e){return F.mul(r,e)}var lJ=32;function vI(r,e){var t,n,a=e;t=a.xs,n=a.ys,A.util.assert(t!=null&&n!=null,function(){return"A Dataset iterator for fitDataset() is expected to generate objects of the form `{xs: xVal, ys: yVal}`, where the two values may be `tf.Tensor`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates "+"".concat(e)});var i=rT("input",r.inputNames,t),o=rT("output",r.outputNames,n),s=i[0].shape[0];A.util.assert(i.length===r.inputs.length,function(){return"LayersModel has ".concat(r.inputs.length," inputs, but the dataset ")+"provides ".concat(i.length," inputs.  (Expected input keys: ")+"".concat(JSON.stringify(r.inputNames),")")}),A.util.assert(o.length===r.outputs.length,function(){return"LayersModel has ".concat(r.outputs.length," outputs, but the dataset ")+"provides ".concat(o.length," outputs.  (Expected output keys: ")+"".concat(JSON.stringify(r.outputNames),")")});for(var u=function(h){A.util.assert(i[h].shape[0]===s,function(){return"Batch size mismatch: input "+"".concat(r.inputNames[h]," has ").concat(i[h].shape[0],"; ")+"expected  ".concat(s," based on input ").concat(r.inputNames[0],".")})},c=0;c<i.length;c++)u(c);for(var l=function(h){A.util.assert(o[h].shape[0]===s,function(){return"Batch size mismatch: output "+"".concat(r.outputNames[h]," has ").concat(o[h].shape[0],"; ")+"expected  ".concat(s," based on input ").concat(r.inputNames[0],".")})},f=0;f<o.length;f++)l(f);return{xs:i,ys:o}}function rT(r,e,t){var n,a;if(t instanceof A.Tensor)return[t];if(Array.isArray(t))return A.util.assert(t.length===e.length,function(){return"Received an array of ".concat(t.length," Tensors, but expected ").concat(e.length," to match the ").concat(r," keys ").concat(e,".")}),t;var i=[];try{for(var o=le(e),s=o.next();!s.done;s=o.next()){var u=s.value;if(t[u]==null)throw new Y("The feature data generated by the dataset lacks the required "+"".concat(r," key '").concat(u,"'."));i.push(t[u])}}catch(c){n={error:c}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}return i}function fJ(r){if(r.length===3)throw new ct("Validation with sample weights is not implemented yet.");return{xs:r[0],ys:r[1]}}function hJ(r,e,t){return Ie(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f,h,p,d,m,v,g,y,w,b,x,S,T,N,C,R,_,V,P,$,z,L,V,B,G,X,Z,V;return Te(this,function(j){switch(j.label){case 0:if(n=t.batchesPerEpoch!=null,A.util.assert(r.optimizer!=null,function(){return"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."}),A.util.assert(t!=null,function(){return"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."}),A.util.assert(t.epochs!=null&&t.epochs>0&&Number.isInteger(t.epochs),function(){return"For fitDataset(), config.epochs is expected to be a positive "+"integer, but got ".concat(t.epochs)}),A.util.assert(!n||t.batchesPerEpoch>0&&Number.isInteger(t.batchesPerEpoch),function(){return"For fitDataset(), config.batchesPerEpoch is expected to be a "+"positive integer if specified, but got ".concat(t.batchesPerEpoch)}),A.util.assert(t.validationSplit==null,function(){return"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."}),r.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");r.isTraining=!0,j.label=1;case 1:return j.trys.push([1,,26,27]),a=t.validationData!=null,i=void 0,o=void 0,a&&(nT(t.validationData)?A.util.assert(t.validationBatches==null||t.validationBatches>0&&Number.isInteger(t.validationBatches),function(){return"For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, "+"but got ".concat(t.validationBatches)}):(s=fJ(t.validationData),i=s.xs,o=s.ys)),u=r.makeTrainFunction(),c=r.getDedupedMetricsNames(),l=void 0,a?l=c.slice().concat(c.map(function(re){return"val_"+re})):l=c.slice(),f=iI(t.callbacks,t.yieldEvery),h=t.verbose==null?1:t.verbose,p=oI(f,h,t.epochs,null,null,pJ(e,t),null,a,l),d=p.callbackList,m=p.history,d.setModel(r),r.history=m,[4,d.onTrainBegin()];case 2:return j.sent(),r.stopTraining_=!1,v=t.initialEpoch==null?0:t.initialEpoch,[4,e.iterator()];case 3:g=j.sent(),j.label=4;case 4:return v<t.epochs?(y={},[4,d.onEpochBegin(v)]):[3,23];case 5:return j.sent(),w=0,b=0,n?[3,7]:[4,e.iterator()];case 6:g=j.sent(),j.label=7;case 7:return!n||w<t.batchesPerEpoch?[4,g.next()]:[3,21];case 8:return x=j.sent(),n&&x.done?(console.warn("You provided `batchesPerEpoch` as "+"".concat(t.batchesPerEpoch,", ")+"but your dataset iterator ran out of data after "+"".concat(w," batches; ")+"interrupting training. Make sure that your dataset can generate at least `batchesPerEpoch * epochs` batches (in this case, "+"".concat(t.batchesPerEpoch*t.epochs," batches). ")+"You may need to use the repeat() function when building your dataset."),[3,21]):x.value==null?[3,15]:(S=vI(r,x.value),T=S.xs,N=S.ys,C={},C.batch=b,C.size=T[0].shape[0],[4,d.onBatchBegin(b,C)]);case 9:if(j.sent(),R=[],t.classWeight==null)return[3,13];_=pI(t.classWeight,r.outputNames),V=0,j.label=10;case 10:return V<_.length?($=(P=R).push,[4,dI(N[V],null,_[V])]):[3,13];case 11:$.apply(P,[j.sent()]),j.label=12;case 12:return++V,[3,10];case 13:for(z=T.concat(N).concat(R),L=u(z),A.dispose(z),V=0;V<c.length;++V)B=c[V],G=L[V],C[B]=G,A.keep(G);return[4,d.onBatchEnd(b,C)];case 14:j.sent(),tI(C),b++,w++,j.label=15;case 15:return(n?w>=t.batchesPerEpoch:x.done)?a?(X=void 0,nT(t.validationData)?(Z=It,[4,r.evaluateDataset(t.validationData,{batches:t.validationBatches})]):[3,17]):[3,19]:[3,20];case 16:return X=Z.apply(void 0,[j.sent()]),[3,18];case 17:X=It(r.evaluate(i,o,{batchSize:t.validationBatchSize==null?lJ:t.validationBatchSize,verbose:0})),j.label=18;case 18:for(V=0;V<r.metricsNames.length;++V)y["val_".concat(r.metricsNames[V])]=X[V];j.label=19;case 19:return[3,21];case 20:return r.stopTraining_?[3,21]:[3,7];case 21:return[4,d.onEpochEnd(v,y)];case 22:return j.sent(),v++,r.stopTraining_?[3,23]:[3,4];case 23:return[4,d.onTrainEnd()];case 24:return j.sent(),[4,r.history.syncData()];case 25:return j.sent(),[2,r.history];case 26:return r.isTraining=!1,[7];case 27:return[2]}})})}function pJ(r,e){var t=null;return e.batchesPerEpoch!=null?t=e.batchesPerEpoch:Number.isFinite(r.size)&&(t=r.size),t}function nT(r){return typeof r.iterator=="function"}function dJ(r){return typeof r.next=="function"}function vJ(r,e,t){return Ie(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f,h,p;return Te(this,function(d){switch(d.label){case 0:if(t=t||{},n=t.batches!=null,a=r.testFunction,i=[],t.verbose>0)throw new ct("Verbose mode is not implemented yet.");return A.util.assert(!n||t.batches>0&&Number.isInteger(t.batches),function(){return"Test loop expects `batches` to be a positive integer, but "+"received ".concat(JSON.stringify(t.batches))}),dJ(e)?(s=e,[3,3]):[3,1];case 1:return[4,e.iterator()];case 2:s=d.sent(),d.label=3;case 3:o=s,u=0,c=0,l=function(){var m;return Te(this,function(v){switch(v.label){case 0:return[4,o.next()];case 1:return m=v.sent(),i=A.tidy(function(){if(m.value){var g=vI(r,m.value),y=g.xs,w=g.ys,b=y.concat(w),x=A.tidy(function(){return a(b)});if(A.dispose(b),c===0)for(var S=0;S<x.length;++S)i.push(F.scalar(0));for(var T=b[0].shape[0],N=function(C){var R=x[C],_=i[C];i[C]=A.tidy(function(){return A.add(i[C],A.mul(T,R))}),c>0&&A.dispose(_)},S=0;S<x.length;++S)N(S);A.dispose(x),u+=T,++c}return i}),m.done?(n&&console.warn("Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least `batches` "+"batches (in this case, ".concat(t.batches," batches). ")+"You may need to use the repeat() function when building your dataset."),[2,"break"]):[2]}})},d.label=4;case 4:return!n||c<t.batches?[5,l()]:[3,6];case 5:return f=d.sent(),f==="break"?[3,6]:[3,4];case 6:for(h=0;h<i.length;++h)p=i[h],i[h]=A.div(i[h],u),A.dispose(p);return[2,mn(i)]}})})}function um(r){A.util.assert(r>0&&Number.isInteger(r),function(){return"batchSize is required to be a positive integer, but got ".concat(r)})}function Zc(r,e,t){return r==null?[null]:Array.isArray(r)?r.map(function(n){return ts(n,e,t-e)}):ts(r,e,t-e)}function Im(r,e){return A.tidy(function(){return r==null?null:Array.isArray(r)?r.map(function(t){return Im(t,e)}):xT(r,e.dtype==="int32"?e:A.cast(e,"int32"))})}function cm(r,e){for(var t=[],n=0,a=null;n<r;)a=n+e,a>=r&&(a=r),t.push([n,a]),n=a;return t}function mI(r){var e=[];r instanceof F.Tensor&&(r=[r]);for(var t=0;t<r.length;++t){var n=r[t];if(n.rank===1)e.push(ll(n,1));else{if(n.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(n)}}return e}function Ga(r,e){if(r!=null){var t=[];if(e instanceof F.Tensor)t.push(e.id);else if(Array.isArray(e))e.forEach(function(s){return t.push(s.id)});else if(e!=null)for(var n in e){var a=e[n];t.push(a.id)}var i=[];if(r instanceof F.Tensor)t.indexOf(r.id)===-1&&i.push(r);else if(Array.isArray(r))r.forEach(function(s){t.indexOf(s.id)===-1&&i.push(s)});else if(r!=null)for(var n in r){var o=r[n];t.indexOf(o.id)===-1&&i.push(o)}i.forEach(function(s){s.isDisposed||s.dispose()})}}function mJ(r){return r instanceof F.Tensor}function Cm(r){return Array.isArray(r)}function aT(r){return!mJ(r)&&!Cm(r)}function iT(r,e,t,n,a){var i,o;if(n===void 0&&(n=!0),a===void 0&&(a=""),e==null||e.length===0){if(r!=null){var s=!1;if(Cm(r)&&r.length>0)s=!0;else if(aT(r)){for(var u in r)if(r.hasOwnProperty(u)){s=!0;break}}else s=!0;if(s)throw new Y("Error when checking model ".concat(a," expected no data, ")+"but got ".concat(r))}return[]}if(r==null)return e.map(function(y){return null});var c;if(aT(r)){r=r,c=[];try{for(var l=le(e),f=l.next();!f.done;f=l.next()){var h=f.value;if(r[h]==null)throw new Y('No data provided for "'.concat(h,'". Need data for each key in: ')+"".concat(e));c.push(r[h])}}catch(y){i={error:y}}finally{try{f&&!f.done&&(o=l.return)&&o.call(l)}finally{if(i)throw i.error}}}else if(Cm(r)){if(r=r,r.length!==e.length)throw new Y("Error when checking model ".concat(a,": the Array of ")+"Tensors that you are passing to your model is not the size the "+"model expected. Expected to see ".concat(e.length," Tensor(s), but ")+"instead got the following list of Tensor(s): ".concat(r));c=r}else{if(r=r,e.length>1)throw new Y("The model ".concat(a," expects ").concat(e.length," Tensor(s), ")+"but only received one Tensor. Found: Tensor with shape ".concat(r.shape));c=[r]}if(c=mI(c),t!=null){for(var p=0;p<e.length;++p)if(t[p]!=null){var d=c[p];if(d.shape.length!==t[p].length)throw new Y("Error when checking ".concat(a,": expected ").concat(e[p]," ")+"to have ".concat(t[p].length," dimension(s). but got array with ")+"shape ".concat(d.shape));for(var m=0;m<t[p].length;++m)if(!(m===0&&!n)){var v=d.shape[m],g=t[p][m];if(g!=null&&g>=0&&v!==g)throw new Y("".concat(a," expected a batch of elements where each ")+"example has shape [".concat(t[p].slice(1,t[p].length),"] ")+"(i.e.,tensor shape [*,".concat(t[p].slice(1,t[p].length),"])")+" but the ".concat(a," received an input with ").concat(d.shape[0])+" examples, each with shape [".concat(d.shape.slice(1,d.shape.length),"]")+" (tensor shape [".concat(d.shape,"])"))}}}return c}function gJ(r,e,t){var n=uo(r.map(function(i){return i.shape[0]}));n.sort();var a=uo(e.map(function(i){return i.shape[0]}));if(a.sort(),n.length>1)throw new Y("All input Tensors (x) should have the same number of samples. Got array shapes: "+"".concat(JSON.stringify(r.map(function(i){return i.shape}))));if(a.length>1)throw new Y("All target Tensors (y) should have the same number of samples. Got array shapes: "+"".concat(JSON.stringify(e.map(function(i){return i.shape}))));if(n.length>0&&a.length>0&&!F.util.arraysEqual(n,a))throw new Y("Input Tensors should have the same number of samples as target "+"Tensors. Found ".concat(n[0]," input sample(s) and ").concat(a[0]," target ")+"sample(s).")}function yJ(r,e,t){for(var n=[fs,Xh,ol],a=0;a<r.length;++a){var i=r[a],o=e[a],s=t[a];if(o!=null){if(o===ol&&i.shape[i.shape.length-1]===1)throw new Y("You are passing a target array of shape ".concat(i.shape," while using ")+"a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].");if(n.indexOf(o)!==-1)for(var u=i.shape.slice(1),c=s.slice(1),l=0;l<u.length;++l){var f=u[l],h=c[l];if(h!=null&&f!==h)throw new Y("A target Tensor with shape ".concat(i.shape," was passed for an ")+"output of shape ".concat(s,", while using a loss function that ")+"expects targets to have the same shape as the output.")}}}}function oT(r,e,t,n,a){n===void 0&&(n=!0),a===void 0&&(a="");var i;if(Array.isArray(r)){if(r.length!==e.length)throw new Y("Error when checking model ".concat(a,": the Array of ")+"Tensors that you are passing to your model is not the size the "+"the model expected. Expected to see ".concat(e.length," Tensor(s),")+" but instead got ".concat(r.length," Tensors(s)."));i=r}else{if(e.length>1)throw new Y("The model expects ".concat(e.length," ").concat(a," Tensors, ")+"but only received one Tensor. Found: array with shape "+"".concat(JSON.stringify(r.shape),"."));i=[r]}if(t!=null){for(var o=0;o<e.length;++o)if(t[o]!=null){var s=i[o];if(s.shape.length!==t[o].length)throw new Y("Error when checking ".concat(a,": expected ").concat(e[o]," ")+"to have ".concat(t[o].length," dimension(s), but got array with ")+"shape ".concat(JSON.stringify(s.shape)));for(var u=0;u<t[o].length;++u)if(!(u===0&&!n)){var c=s.shape[u],l=t[o][u];if(l!=null&&l!==c)throw new Y("Error when checking ".concat(a,": expected ")+"".concat(e[o]," to have shape ").concat(JSON.stringify(t[o])," but ")+"got array with shape ".concat(JSON.stringify(s.shape),"."))}}}}function bJ(r,e){var t,n;if(r==null||Array.isArray(r)&&r.length===0)return e.map(function(l){return[]});var a;if(typeof r=="string"||typeof r=="function")a=[r];else if(Array.isArray(r)||typeof r=="object")a=r;else throw new TypeError("Type of metrics argument not understood. Expected an string,"+"function, Array, or Object, found: ".concat(r));if(Array.isArray(a))return e.map(function(l){return a});var i=[];try{for(var o=le(e),s=o.next();!s.done;s=o.next()){var u=s.value,c=a.hasOwnProperty(u)?a[u]:[];Array.isArray(c)||(c=[c]),i.push(c)}}catch(l){t={error:l}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return i}var wJ="layers-model",Ri=(function(r){ie(e,r);function e(t){var n=r.call(this,t)||this;return n.isTraining=!1,n}return e.prototype.summary=function(t,n,a){if(a===void 0&&(a=console.log),!this.built)throw new Y("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");tJ(this,t,n,a)},e.prototype.compile=function(t){var n,a,i=this;if(t.loss==null&&(t.loss=[]),this.loss=t.loss,typeof t.optimizer=="string")this.optimizer_=eJ(t.optimizer),this.isOptimizerOwned=!0;else{if(!(t.optimizer instanceof F.Optimizer))throw new Y("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=t.optimizer,this.isOptimizerOwned=!1}var o=[];if(!Array.isArray(t.loss)&&typeof t.loss!="string"&&typeof t.loss!="function"){t.loss=t.loss;for(var s in t.loss)if(this.outputNames.indexOf(s)===-1)throw new Y('Unknown entry in loss dictionary: "'.concat(s,'". ')+"Only expected the following keys: ".concat(this.outputNames));try{for(var u=le(this.outputNames),c=u.next();!c.done;c=u.next()){var s=c.value;t.loss[s]==null&&console.warn('Output "'.concat(s,'" is missing from loss dictionary. We assume ')+"this was done on purpose, and we will not be expecting data "+"to be passed to ".concat(s," during training")),o.push(sm(t.loss[s]))}}catch(g){n={error:g}}finally{try{c&&!c.done&&(a=u.return)&&a.call(u)}finally{if(n)throw n.error}}}else if(Array.isArray(t.loss)){if(t.loss.length!==this.outputs.length)throw new Y("When passing an Array as loss, it should have one entry per "+"model output. The model has ".concat(this.outputs.length," output(s), ")+"but you passed loss=".concat(t.loss,"."));var l=t.loss;o=l.map(function(g){return sm(g)})}else{var f=sm(t.loss);this.outputs.forEach(function(g){o.push(f)})}this.lossFunctions=o,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(var h=0;h<this.outputs.length;++h){var p=this.internalOutputShapes[h],s=this.outputNames[h];this.feedOutputNames.push(s),this.feedOutputShapes.push(p),this.feedLossFns.push(this.lossFunctions[h])}var d=[];this.metrics=t.metrics,this.metricsNames=["loss"],this.metricsTensors=[],es("loss",function(){for(var g=0;g<i.outputs.length;++g)if(d.indexOf(g)===-1){var y=i.lossFunctions[g];i.outputs.length>1&&(i.metricsTensors.push([y,g]),i.metricsNames.push(i.outputNames[g]+"_loss"))}});var m=bJ(t.metrics,this.outputNames),v=function(g,y,w){i.outputNames.length>1&&(y=i.outputNames[g]+"_"+y),i.metricsNames.push(y),i.metricsTensors.push([w,g])};es("metric",function(){for(var g=function(w){if(d.indexOf(w)!==-1)return"continue";var b=m[w],x=function(S){var T,N,C="",R,_,P,$=function(G){if(typeof G=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(G)!==-1){var X=i.internalOutputShapes[w];X[X.length-1]===1||i.lossFunctions[w]===Xh?["accuracy","acc"].indexOf(G)!==-1?_=pg:["crossentropy","ce"].indexOf(G)!==-1&&(_=cI):i.lossFunctions[w]===Dh?["accuracy","acc"].indexOf(G)!==-1?_=lI:["crossentropy","ce"].indexOf(G)!==-1&&(_=fI):["accuracy","acc"].indexOf(G)!==-1?_=dg:["crossentropy","ce"].indexOf(G)!==-1&&(_=vg);var Z=void 0;["accuracy","acc"].indexOf(G)!==-1?Z="acc":["crossentropy","ce"].indexOf(G)!==-1&&(Z="ce"),P=_,R=C+Z}else{var V=QZ(G);P=V,R=C+lh(G)}var j;es(R,function(){j=P}),v(w,R,j)};try{for(var z=(T=void 0,le(S)),L=z.next();!L.done;L=z.next()){var B=L.value;$(B)}}catch(G){T={error:G}}finally{try{L&&!L.done&&(N=z.return)&&N.call(z)}finally{if(T)throw T.error}}};x(b)},y=0;y<i.outputs.length;++y)g(y)}),this.collectedTrainableWeights=this.trainableWeights},e.prototype.checkTrainableWeightsConsistency=function(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")},e.prototype.evaluate=function(t,n,a){a===void 0&&(a={});var i=a.batchSize==null?32:a.batchSize;um(i);var o=!0,s=this.standardizeUserDataXY(t,n,o,i);try{var u=s[0].concat(s[1]);this.makeTestFunction();var c=this.testFunction,l=this.testLoop(c,u,i,a.verbose,a.steps);return mn(l)}finally{Ga(s[0],t),Ga(s[1],n)}},e.prototype.evaluateDataset=function(t,n){return Ie(this,void 0,void 0,function(){return Te(this,function(a){return this.makeTestFunction(),[2,vJ(this,t,n)]})})},e.prototype.checkNumSamples=function(t,n,a,i){i===void 0&&(i="steps");var o;if(a!=null){if(o=null,n!=null)throw new Y("If ".concat(i," is set, batchSize must be null or undefined.")+"Got batchSize = ".concat(n))}else if(t!=null)Array.isArray(t)?o=t[0].shape[0]:o=t.shape[0];else throw new Y("Either the input data should have a defined shape, or "+"".concat(i," shoud be specified."));return o},e.prototype.execute=function(t,n){var a,i;if(Array.isArray(n)&&n.length===0)throw new Y("`outputs` is an empty Array, which is not allowed.");var o=Array.isArray(n),s=o?n:[n],u=this.retrieveSymbolicTensors(s),c=new hu;if(t instanceof F.Tensor&&(t=[t]),Array.isArray(t)){if(t.length!==this.inputs.length)throw new Y("The number of inputs provided (".concat(t.length,") ")+"does not match the number of inputs of this model "+"(".concat(this.inputs.length,")."));for(var l=0;l<this.inputs.length;++l)c.add(this.inputs[l],t[l])}else try{for(var f=le(this.inputs),h=f.next();!h.done;h=f.next()){var p=h.value,d=t[p.name];if(d==null)throw new Y("No value is provided for the model's input ".concat(p.name));c.add(p,d)}}catch(v){a={error:v}}finally{try{h&&!h.done&&(i=f.return)&&i.call(f)}finally{if(a)throw a.error}}var m=Qc(u,c);return o?m:m[0]},e.prototype.retrieveSymbolicTensors=function(t){var n,a,i=rs(null,t.length),o=t.length;try{for(var s=le(this.layers),u=s.next();!u.done;u=s.next()){for(var c=u.value,l=Array.isArray(c.output)?c.output:[c.output],f=l.map(function(m){return m.name}),h=0;h<t.length;++h){var p=f.indexOf(t[h]);if(p!==-1&&(i[h]=l[p],o--),o===0)break}if(o===0)break}}catch(m){n={error:m}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(n)throw n.error}}if(o>0){var d=[];throw i.forEach(function(m,v){m==null&&d.push(t[v])}),new Y("Cannot find SymbolicTensors for output name(s): "+"".concat(JSON.stringify(d)))}return i},e.prototype.predictLoop=function(t,n,a){var i=this;return n===void 0&&(n=32),a===void 0&&(a=!1),A.tidy(function(){var o=i.checkNumSamples(t);if(a)throw new ct("Verbose predictLoop() is not implemented yet.");for(var s=cm(o,n),u=i.outputs.map(function(f){return[]}),c=function(f){var h=A.tidy(function(){var p=s[f][0],d=s[f][1],m=Zc(t,p,d),v=[];if(Array.isArray(m))for(var g=0;g<m.length;++g)v.push({key:i.inputs[g],value:m[g]});else v.push({key:i.inputs[0],value:m});var y=new hu(v);return Qc(i.outputs,y)});h.forEach(function(p,d){return u[d].push(p)})},l=0;l<s.length;++l)c(l);return mn(u.map(function(f){return A.concat(f,0)}))})},e.prototype.predict=function(t,n){n===void 0&&(n={});var a=mI(t);oT(a,this.inputNames,this.feedInputShapes,!1);try{var i=n.batchSize==null?32:n.batchSize;return um(i),this.predictLoop(a,i)}finally{Ga(a,t)}},e.prototype.predictOnBatch=function(t){oT(t,this.inputNames,this.feedInputShapes,!0);var n=(Array.isArray(t)?t[0]:t).shape[0];return this.predictLoop(t,n)},e.prototype.standardizeUserDataXY=function(t,n,a,i){if(this.optimizer_==null)throw new fi("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");for(var o=[],s=0;s<this.feedOutputShapes.length;++s){var u=this.feedOutputShapes[s],c=this.feedLossFns[s];c===Dh?o.push(u.slice(0,u.length-1).concat([1])):o.push(u)}if(t=iT(t,this.feedInputNames,this.feedInputShapes,!1,"input"),n=iT(n,this.feedOutputNames,o,!1,"target"),gJ(t,n),yJ(n,this.feedLossFns,this.feedOutputShapes),this.stateful&&i!=null&&i>0&&t[0].shape[0]%i!==0)throw new Y("In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size "+"".concat(i,". Found: ").concat(t[0].shape[0]," sample(s)."));return[t,n]},e.prototype.standardizeUserData=function(t,n,a,i,o,s){return o===void 0&&(o=!0),Ie(this,void 0,void 0,function(){var u,c,l,f,h,p,d,m;return Te(this,function(v){switch(v.label){case 0:if(u=ee(this.standardizeUserDataXY(t,n,o,s),2),c=u[0],l=u[1],a!=null)throw new Error("sample weight is not supported yet.");if(f=null,i==null)return[3,4];h=pI(i,this.outputNames),f=[],p=0,v.label=1;case 1:return p<h.length?(m=(d=f).push,[4,dI(l[p],null,h[p])]):[3,4];case 2:m.apply(d,[v.sent()]),v.label=3;case 3:return++p,[3,1];case 4:return[2,[c,l,f]]}})})},e.prototype.testLoop=function(t,n,a,i,o){var s=this;return i===void 0&&(i=0),A.tidy(function(){var u=s.checkNumSamples(n,a,o,"steps"),c=[];if(i>0)throw new ct("Verbose mode is not implemented yet.");if(o!=null)throw new ct("steps mode in testLoop() is not implemented yet");for(var l=cm(u,a),f=F.tensor1d(Ka(0,u)),h=0;h<l.length;++h){var p=l[h][0],d=l[h][1],m=ts(f,p,d-p),v=Im(n,m),g=t(v);if(h===0)for(var y=0;y<g.length;++y)c.push(F.scalar(0));for(var y=0;y<g.length;++y){var w=g[y];c[y]=A.add(c[y],A.mul(d-p,w))}}for(var y=0;y<c.length;++y)c[y]=A.div(c[y],u);return c})},e.prototype.getDedupedMetricsNames=function(){for(var t=this.metricsNames,n=[],a=0;a<t.length;++a){var i=t[a],o=i;if(fE(t,i)>1){var s=fE(t.slice(0,a),i);o+="_".concat(s)}n.push(o)}return n},e.prototype.makeTrainFunction=function(){var t=this;return function(n){var a=[],i=n.slice(0,t.inputs.length),o=n.slice(t.inputs.length,t.inputs.length+t.outputs.length),s=n.slice(t.inputs.length+t.outputs.length,t.inputs.length+t.outputs.length*2),u=[],c=function(){for(var p=[],d=0;d<t.inputs.length;++d)p.push({key:t.inputs[d],value:i[d]});for(var m=new hu(p),v=Qc(t.outputs,m,{training:!0}),g,d=0;d<t.lossFunctions.length;++d){var y=t.lossFunctions[d],w=y(o[d],v[d]);s[d]!=null&&(w=cJ(w,s[d]));var b=A.mean(w);a.push(b),d===0?g=w:g=A.add(g,w)}for(var d=0;d<t.metricsTensors.length;++d){var x=void 0;if(t.outputs.length>1&&d<t.outputs.length)x=a[d];else{var S=t.metricsTensors[d][0],T=t.metricsTensors[d][1];x=A.mean(S(o[T],v[T]))}A.keep(x),u.push(x)}return g=A.mean(g),t.calculateLosses().forEach(function(N){g=A.add(g,N)}),g},l=t.collectedTrainableWeights.map(function(p){return p.read()}),f=!0,h=t.optimizer_.minimize(c,f,l);return[h].concat(u)}},e.prototype.makeTestFunction=function(){var t=this;this.testFunction=function(n){return A.tidy(function(){for(var a=[],i,o=n.slice(0,t.inputs.length),s=n.slice(t.inputs.length,t.inputs.length+t.outputs.length),u=[],c=0;c<t.inputs.length;++c)u.push({key:t.inputs[c],value:o[c]});for(var l=new hu(u),f=Qc(t.outputs,l),c=0;c<t.lossFunctions.length;++c){var h=t.lossFunctions[c],p=A.mean(h(s[c],f[c]));c===0?i=p:i=A.add(i,p),a.push(i)}for(var c=0;c<t.metricsTensors.length;++c){var d=t.metricsTensors[c][0],m=t.metricsTensors[c][1],v=A.mean(d(s[m],f[m]));a.push(v)}return a})}},e.prototype.fit=function(t,n,a){return a===void 0&&(a={}),Ie(this,void 0,void 0,function(){var i,o,s,u,c,l,f,h,p,d,m,v,g,y,w,b,x,S,T,N,C,R,_,P,$;return Te(this,function(z){switch(z.label){case 0:if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0,z.label=1;case 1:return z.trys.push([1,,7,8]),d=a.batchSize==null?32:a.batchSize,um(d),m=!1,[4,this.standardizeUserData(t,n,a.sampleWeight,a.classWeight,m,d)];case 2:if(v=z.sent(),i=v[0],o=v[1],p=v[2],g=!1,y=void 0,!(a.validationData!=null&&a.validationData.length>0))return[3,4];if(g=!0,a.validationData.length===2)c=a.validationData[0],l=a.validationData[1];else throw a.validationData.length===3?new ct("validationData including sample weights is not supported yet."):new Y("When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; "+"".concat(a.validationData," is invalid."));return w=!0,[4,this.standardizeUserData(c,l,null,null,w,d)];case 3:return b=z.sent(),f=b[0],h=b[1],y=f.concat(h),[3,5];case 4:a.validationSplit!=null&&a.validationSplit>0&&a.validationSplit<1?(g=!0,x=Math.floor(i[0].shape[0]*(1-a.validationSplit)),S=i[0].shape[0],f=Zc(i,x,S),s=i,i=Zc(i,0,x),h=Zc(o,x,S),u=o,o=Zc(o,0,x),y=f.concat(h)):a.validationSteps!=null&&(g=!0),z.label=5;case 5:return T=i.concat(o).concat(p),this.checkTrainableWeightsConsistency(),N=this.makeTrainFunction(),C=this.getDedupedMetricsNames(),R=void 0,_=void 0,g?(this.makeTestFunction(),R=this.testFunction,_=C.slice().concat(C.map(function(L){return"val_"+L}))):(R=null,y=[],_=C.slice()),P=iI(a.callbacks,a.yieldEvery),[4,this.fitLoop(N,T,C,d,a.epochs,a.verbose,P,R,y,a.shuffle,_,a.initialEpoch,null,null)];case 6:return $=z.sent(),[2,$];case 7:return this.isTraining=!1,Ga(i,t),Ga(o,n),Ga(s,t),Ga(u,n),Ga(f,c),Ga(h,l),p!=null&&A.dispose(p),[7];case 8:return[2]}})})},e.prototype.fitLoop=function(t,n,a,i,o,s,u,c,l,f,h,p,d,m){return Ie(this,void 0,void 0,function(){var v,g,y,w,b,x,S,T,N,C,R=this;return Te(this,function(_){switch(_.label){case 0:if(i==null&&(i=32),o==null&&(o=1),f==null&&(f=!0),p==null&&(p=0),v=!1,c!=null&&l!=null&&(v=!0),m!=null&&(v=!0,d==null))throw new Y("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");return g=this.checkNumSamples(n,i,d,"steps_per_epoch"),g!=null&&(y=Ka(0,g)),s==null&&(s=1),w=oI(u,s,o,p,g,d,i,v,h),b=w.callbackList,x=w.history,b.setModel(this),this.history=x,[4,b.onTrainBegin()];case 1:_.sent(),this.stopTraining_=!1,S=function(P){var $,z,L,B,G,X;return Te(this,function(Z){switch(Z.label){case 0:return[4,b.onEpochBegin(P)];case 1:if(Z.sent(),$={},d==null)return[3,2];throw new ct("stepsPerEpoch mode is not implemented yet.");case 2:if(f==="batch")throw new ct("batch shuffling is not implemneted yet");f&&F.util.shuffle(y),z=F.tensor1d(y),L=cm(g,i),B=function(V){var j;return Te(this,function(re){switch(re.label){case 0:return j={},[4,b.onBatchBegin(V,j)];case 1:return re.sent(),A.tidy(function(){var te=L[V][0],oe=L[V][1],ce=ts(z,te,oe-te);j.batch=V,j.size=oe-te;for(var pe=Im(n,ce),xe=t(pe),fe=0;fe<a.length;++fe){var ge=a[fe],we=xe[fe];j[ge]=we,A.keep(we)}if(V===L.length-1&&v)for(var Ae=R.testLoop(c,l,i),fe=0;fe<a.length;++fe){var ge=a[fe],we=Ae[fe];A.keep(we),$["val_"+ge]=we}}),[4,b.onBatchEnd(V,j)];case 2:return re.sent(),tI(j),T.stopTraining_?[2,"break"]:[2]}})},G=0,Z.label=3;case 3:return G<L.length?[5,B(G)]:[3,6];case 4:if(X=Z.sent(),X==="break")return[3,6];Z.label=5;case 5:return++G,[3,3];case 6:z.dispose(),Z.label=7;case 7:return[4,b.onEpochEnd(P,$)];case 8:return Z.sent(),T.stopTraining_?[2,"break"]:[2]}})},T=this,N=p,_.label=2;case 2:return N<o?[5,S(N)]:[3,5];case 3:if(C=_.sent(),C==="break")return[3,5];_.label=4;case 4:return++N,[3,2];case 5:return[4,b.onTrainEnd()];case 6:return _.sent(),[4,this.history.syncData()];case 7:return _.sent(),[2,this.history]}})})},e.prototype.fitDataset=function(t,n){return Ie(this,void 0,void 0,function(){return Te(this,function(a){return[2,hJ(this,t,n)]})})},e.prototype.trainOnBatch=function(t,n){return Ie(this,void 0,void 0,function(){var a,i,o,s,u,c,l,f,h,p,d,m,v;return Te(this,function(g){switch(g.label){case 0:return[4,this.standardizeUserData(t,n)];case 1:a=g.sent(),i=a[0],o=a[1],s=this.makeTrainFunction(),u=s(i.concat(o)),c=[],g.label=2;case 2:g.trys.push([2,7,8,9]),l=le(u),f=l.next(),g.label=3;case 3:return f.done?[3,6]:(h=f.value,[4,h.data()]);case 4:p=g.sent(),c.push(p[0]),g.label=5;case 5:return f=l.next(),[3,3];case 6:return[3,9];case 7:return d=g.sent(),m={error:d},[3,9];case 8:try{f&&!f.done&&(v=l.return)&&v.call(l)}finally{if(m)throw m.error}return[7];case 9:return A.dispose(u),Ga(a[0],t),Ga(a[1],n),[2,mn(c)]}})})},e.prototype.getNamedWeights=function(t){for(var n=[],a=t!=null&&t.trainableOnly,i=a?this.trainableWeights:this.weights,o=this.getWeights(a),s=0;s<i.length;++s)a&&!i[s].trainable||n.push({name:i[s].originalName,tensor:o[s]});return n},Object.defineProperty(e.prototype,"stopTraining",{get:function(){return this.stopTraining_},set:function(t){this.stopTraining_=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"optimizer",{get:function(){return this.optimizer_},set:function(t){this.optimizer_!==t&&(this.optimizer_=t,this.isOptimizerOwned=!1)},enumerable:!1,configurable:!0}),e.prototype.dispose=function(){var t=r.prototype.dispose.call(this);if(t.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){var n=A.memory().numTensors;this.optimizer_.dispose(),t.numDisposedVariables+=n-A.memory().numTensors}return t},e.prototype.getLossIdentifiers=function(){var t,n,a,i,o;if(typeof this.loss=="string")o=Fi(this.loss);else if(Array.isArray(this.loss)){try{for(var s=le(this.loss),u=s.next();!u.done;u=s.next()){var c=u.value;if(typeof c!="string")throw new Error("Serialization of non-string loss is not supported.")}}catch(m){t={error:m}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}o=this.loss.map(function(m){return Fi(m)})}else{var l=Object.keys(this.loss);o={};var f=this.loss;try{for(var h=le(l),p=h.next();!p.done;p=h.next()){var d=p.value;if(typeof f[d]=="string")o[d]=Fi(f[d]);else throw new Error("Serialization of non-string loss is not supported.")}}catch(m){a={error:m}}finally{try{p&&!p.done&&(i=h.return)&&i.call(h)}finally{if(a)throw a.error}}}return o},e.prototype.getMetricIdentifiers=function(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[Fi(lh(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(function(a){return Fi(lh(a))});var t={};for(var n in this.metrics)t[n]=Fi(lh(this.metrics[n]));return t},e.prototype.getTrainingConfig=function(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}},e.prototype.loadTrainingConfig=function(t){if(t.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(t.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(t.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");var n=sl(t.optimizer_config),a=Ha(n),i;if(typeof t.loss=="string")i=Jo(t.loss);else if(Array.isArray(t.loss))i=t.loss.map(function(u){return Jo(u)});else if(t.loss!=null){i={};for(var o in t.loss)i[o]=Jo(t.loss[o])}var s;if(Array.isArray(t.metrics))s=t.metrics.map(function(u){return Jo(u)});else if(t.metrics!=null){s={};for(var o in t.metrics)s[o]=Jo(t.metrics[o])}this.compile({loss:i,metrics:s,optimizer:a})},e.prototype.save=function(t,n){return Ie(this,void 0,void 0,function(){var a,i,o,s,u,c,l,f,h,p,d,m,v,g,y;return Te(this,function(w){switch(w.label){case 0:if(typeof t=="string"){if(a=F.io.getSaveHandlers(t),a.length===0)throw new Y("Cannot find any save handlers for URL '".concat(t,"'"));if(a.length>1)throw new Y("Found more than one (".concat(a.length,") save handlers for ")+"URL '".concat(t,"'"));t=a[0]}if(t.save==null)throw new Y("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return[4,F.io.encodeWeights(this.getNamedWeights(n))];case 1:return i=w.sent(),o=!1,s=null,u=this.toJSON(s,o),c={modelTopology:u,format:wJ,generatedBy:"TensorFlow.js tfjs-layers v".concat(mg),convertedBy:null},l=n==null?!1:n.includeOptimizer,l&&this.optimizer!=null?(c.trainingConfig=this.getTrainingConfig(),f="optimizer",v=(m=F.io).encodeWeights,[4,this.optimizer.getWeights()]):[3,4];case 2:return[4,v.apply(m,[w.sent(),f])];case 3:h=w.sent(),p=h.data,d=h.specs,(y=i.specs).push.apply(y,Xe([],ee(d),!1)),i.data=F.io.concatenateArrayBuffers([i.data,p]),w.label=4;case 4:return this.userDefinedMetadata!=null&&(g=!0,tT(this.userDefinedMetadata,this.name,g),c.userDefinedMetadata=this.userDefinedMetadata),c.weightData=i.data,c.weightSpecs=i.specs,[2,t.save(c)]}})})},e.prototype.setUserDefinedMetadata=function(t){tT(t,this.name),this.userDefinedMetadata=t},e.prototype.getUserDefinedMetadata=function(){return this.userDefinedMetadata},e})(sJ);Ri.className="Model";F.serialization.registerClass(Ri);var gI=(function(r){ie(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e})(Ri);gI.className="Functional";F.serialization.registerClass(gI);function xJ(r,e){return Ie(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l,f;return Te(this,function(h){switch(h.label){case 0:return"modelTopology"in r||(r={modelTopology:r}),r=r,t=r.modelTopology,t.model_config!=null&&(t=t.model_config),n=sl(t),a=Ha(n,e),r.weightsManifest==null?[3,2]:[4,F.io.loadWeights(r.weightsManifest,r.pathPrefix,a.weights.map(function(p){return p.originalName}))];case 1:i=h.sent(),o={};try{for(s=le(a.weights),u=s.next();!u.done;u=s.next())c=u.value,o[c.originalName]=i[c.originalName]}catch(p){l={error:p}}finally{try{u&&!u.done&&(f=s.return)&&f.call(s)}finally{if(l)throw l.error}}a.loadWeights(o),F.dispose(i),h.label=2;case 2:return[2,a]}})})}function kJ(r,e){return Ie(this,void 0,void 0,function(){var t;return Te(this,function(n){if(e==null&&(e={}),typeof r=="string"){if(t=F.io.getLoadHandlers(r,e),t.length===0)t.push(F.io.browserHTTPRequest(r,e));else if(t.length>1)throw new Y("Found more than one (".concat(t.length,") load handlers for ")+"URL '".concat(r,"'"));r=t[0]}return[2,SJ(r,void 0,e)]})})}function SJ(r,e,t){return Ie(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f;return Te(this,function(h){switch(h.label){case 0:if(t==null&&(t={}),r.load==null)throw new Y("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");return[4,r.load()];case 1:if(n=h.sent(),a=n.modelTopology,a.model_config!=null&&(a=a.model_config),i=t.strict==null?!0:t.strict,o=n.weightData!=null&&n.weightSpecs!=null&&i,s=Ha(sl(a),e,o),u=n.trainingConfig,u!=null&&s.loadTrainingConfig(u),n.userDefinedMetadata!=null&&s.setUserDefinedMetadata(n.userDefinedMetadata),n.weightData==null)return[3,4];if(n.weightSpecs==null)throw new Y("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");return c=EJ(n.weightData,n.weightSpecs),l=c.modelWeights,f=c.optimizerWeights,s.loadWeights(l,i),s.optimizer!=null&&f.length>0?[4,s.optimizer.setWeights(f)]:[3,3];case 2:h.sent(),h.label=3;case 3:F.dispose(l),F.dispose(f.map(function(p){return p.tensor})),h.label=4;case 4:return[2,s]}})})}function EJ(r,e){var t=F.io.decodeWeights(r,e),n={},a=[];return e.forEach(function(i){i.group==="optimizer"?a.push({name:i.name,tensor:t[i.name]}):n[i.name]=t[i.name]}),{modelWeights:n,optimizerWeights:a}}var Yh=(function(r){ie(e,r);function e(t){var n,a,i=r.call(this,{inputs:[],outputs:[]})||this;if(t=t||{},i.trainable=!0,i.built=!1,i.name=t.name!=null?t.name:Oh("sequential_"),t.layers!=null)try{for(var o=le(t.layers),s=o.next();!s.done;s=o.next()){var u=s.value;i.add(u)}}catch(c){n={error:c}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}return i}return e.prototype.checkShape=function(t){var n=t.inboundNodes[0].outputTensors[0].shape;if(n.some(function(a){return a<0}))throw new Y("Negative dimension size caused by adding layer "+"".concat(t.name," with input shape [")+"".concat(t.inboundNodes[0].inputTensors[0].shape,"]"))},e.prototype.add=function(t){var n=t instanceof e||t instanceof Ri,a;if(n){if(a=t,a.outputs.length!==1)throw new Y("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(a.inputs.length!==1)throw new Y("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(t.inboundNodes.length===0){if(t.batchInputShape==null)throw new Y("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");var i=TT({batchShape:t.batchInputShape,dtype:t.dtype,name:t.name+"_input"});t.apply(i)}if(n)this.outputs=a.outputs,this.inputs=a.inputs;else{if(t.inboundNodes.length!==1)throw new Y("A layer added to a Sequential model must not already be "+"connected somewhere else. LayersModel received layer ".concat(t.name," ")+"which has ".concat(t.inboundNodes.length," pre-existing inbound ")+"connections.");if(t.inboundNodes[0].outputTensors.length!==1)throw new Y("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[t.inboundNodes[0].outputTensors[0]],this.inputs=ET(this.outputs[0])}this.inboundNodes=[],new Vh({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:rs(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(function(s){return s.shape}),outputShapes:this.outputs[0].shape})}else{var o=t.apply(this.outputs[0]);if(Array.isArray(o))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[o],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(t),this.built=!1},e.prototype.pop=function(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{var t=this.layers.length-1;this.layers[t].outboundNodes=[],this.outputs=[this.layers[t].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}},e.prototype.call=function(t,n){return this.model==null&&this.build(),this.model.call(t,n)},e.prototype.build=function(t){if(wt(t),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new Ri({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0},e.prototype.countParams=function(){return this.built||this.build(),r.prototype.countParams.call(this)},e.prototype.summary=function(t,n,a){a===void 0&&(a=console.log),this.built||this.build(),r.prototype.summary.call(this,t,n,a)},e.prototype.setWeights=function(t){this.model==null&&this.build(),this.model.setWeights(t)},e.prototype.evaluate=function(t,n,a){if(a===void 0&&(a={}),!this.built)throw new fi("The model needs to be compiled before being used.");return this.model.evaluate(t,n,a)},e.prototype.evaluateDataset=function(t,n){return Ie(this,void 0,void 0,function(){return Te(this,function(a){if(!this.built)throw new fi("The model needs to be compiled before being used.");return[2,this.model.evaluateDataset(t,n)]})})},e.prototype.predict=function(t,n){return n===void 0&&(n={}),this.model==null&&this.build(),this.model.predict(t,n)},e.prototype.predictOnBatch=function(t){return this.model==null&&this.build(),this.model.predictOnBatch(t)},e.prototype.compile=function(t){this.build(),this.model.compile(t),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames},Object.defineProperty(e.prototype,"optimizer",{get:function(){return this.model==null?void 0:this.model.optimizer},set:function(t){this.model.optimizer=t},enumerable:!1,configurable:!0}),e.prototype.fit=function(t,n,a){return a===void 0&&(a={}),Ie(this,void 0,void 0,function(){return Te(this,function(i){if(!this.built)throw new fi("The model needs to be compiled before being used.");return[2,this.model.fit(t,n,a)]})})},e.prototype.fitDataset=function(t,n){return Ie(this,void 0,void 0,function(){return Te(this,function(a){if(!this.built)throw new fi("The model needs to be compiled before being used.");return[2,this.model.fitDataset(t,n)]})})},e.prototype.trainOnBatch=function(t,n){return Ie(this,void 0,void 0,function(){return Te(this,function(a){return[2,this.model.trainOnBatch(t,n)]})})},e.fromConfig=function(t,n,a,i){var o,s;i===void 0&&(i=!1);var u,c={};if(n instanceof Array){if(n[0].className==null||n[0].className==="Merge")throw new Y("Legacy serialization format not supported yet.");u=n}else F.util.assert(n.layers!=null,function(){return"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."}),u=n.layers,delete n.layers,c=n;var l=new t(c);if(!(l instanceof e))throw new ct("Sequential.fromConfig called on non-Sequential input: ".concat(l));try{for(var f=le(u),h=f.next();!h.done;h=f.next()){var p=h.value,d=void 0,m=Ha(p,d,i);i&&m.setFastWeightInitDuringBuild(!0),l.add(m)}}catch(v){o={error:v}}finally{try{h&&!h.done&&(s=f.return)&&s.call(f)}finally{if(o)throw o.error}}return l},Object.defineProperty(e.prototype,"stopTraining",{get:function(){if(this.model==null)throw new Y("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining},set:function(t){if(this.model==null)throw new Y("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=t},enumerable:!1,configurable:!0}),e.prototype.getConfig=function(){var t,n,a=[];try{for(var i=le(this.layers),o=i.next();!o.done;o=i.next()){var s=o.value,u={};u.className=s.getClassName(),u.config=s.getConfig(),a.push(u)}}catch(c){t={error:c}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return{name:this.name,layers:a}},e})(Ri);Yh.className="Sequential";F.serialization.registerClass(Yh);function TJ(r){return new Ri(r)}function NJ(r){return new Yh(r)}function yI(r){return TT(r)}function IJ(r,e){fg.registerCallbackConstructor(r,e)}var en=(function(r){ie(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getConfig=function(){return{}},e})(F.serialization.Serializable),bI=(function(r){ie(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t,n){return n===void 0&&(n=1),RK(t,n)},e})(en);bI.className="elu";F.serialization.registerClass(bI);var wI=(function(r){ie(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return A.selu(t)},e})(en);wI.className="selu";F.serialization.registerClass(wI);var xI=(function(r){ie(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return A.relu(t)},e})(en);xI.className="relu";F.serialization.registerClass(xI);var kI=(function(r){ie(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return F.tidy(function(){return A.minimum(6,A.relu(t))})},e})(en);kI.className="relu6";F.serialization.registerClass(kI);var SI=(function(r){ie(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return t},e})(en);SI.className="linear";F.serialization.registerClass(SI);var EI=(function(r){ie(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return A.sigmoid(t)},e})(en);EI.className="sigmoid";F.serialization.registerClass(EI);var TI=(function(r){ie(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return PK(t)},e})(en);TI.className="hardSigmoid";F.serialization.registerClass(TI);var NI=(function(r){ie(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return A.softplus(t)},e})(en);NI.className="softplus";F.serialization.registerClass(NI);var II=(function(r){ie(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return OK(t)},e})(en);II.className="softsign";F.serialization.registerClass(II);var CI=(function(r){ie(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return A.tanh(t)},e})(en);CI.className="tanh";F.serialization.registerClass(CI);var gg=(function(r){ie(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t,n){return n===void 0&&(n=-1),A.softmax(t,n)},e})(en);gg.className="softmax";F.serialization.registerClass(gg);var AI=(function(r){ie(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t,n){return n===void 0&&(n=-1),A.logSoftmax(t,n)},e})(en);AI.className="logSoftmax";F.serialization.registerClass(AI);var DI=(function(r){ie(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return F.tidy(function(){return A.tidy(function(){var n=Math.sqrt(2),a=A.mul(.5,A.add(1,A.erf(A.div(t,n))));return A.mul(t,a)})})},e})(en);DI.className="gelu";F.serialization.registerClass(DI);var _I=(function(r){ie(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return F.tidy(function(){return A.mul(.5,A.mul(t,A.add(1,A.tanh(A.mul(A.sqrt(A.div(2,Math.PI)),A.add(t,A.mul(.044715,A.pow(t,3))))))))})},e})(en);_I.className="gelu_new";F.serialization.registerClass(_I);var FI=(function(r){ie(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return F.tidy(function(){return A.mul(t,A.tanh(A.softplus(t)))})},e})(en);FI.className="mish";F.serialization.registerClass(FI);var RI=(function(r){ie(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t,n){return n===void 0&&(n=1),F.tidy(function(){return A.mul(A.sigmoid(A.mul(t,n)),t)})},e})(en);RI.className="swish";F.serialization.registerClass(RI);function fo(r){return r.getClassName()}function lm(r,e){return e===void 0&&(e={}),cl(r,F.serialization.SerializationMap.getMap().classNameMap,e,"activation")}function ho(r){if(r==null){var e={};return e.className="linear",e.config={},lm(e)}if(typeof r=="string"){var e={};return e.className=r,e.config={},lm(e)}else return r instanceof en?r:lm(r)}function yg(r){if(r!=null&&typeof r!="object")throw new Error("Argument to L1L2 regularizer's constructor is expected to be an "+"object, but received: ".concat(r))}var OI=(function(r){ie(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e})(F.serialization.Serializable),gl=(function(r){ie(e,r);function e(t){var n=r.call(this)||this;return yg(t),n.l1=t==null||t.l1==null?.01:t.l1,n.l2=t==null||t.l2==null?.01:t.l2,n.hasL1=n.l1!==0,n.hasL2=n.l2!==0,n}return e.prototype.apply=function(t){var n=this;return F.tidy(function(){var a=F.zeros([1]);return n.hasL1&&(a=F.add(a,F.sum(A.mul(n.l1,F.abs(t))))),n.hasL2&&(a=F.add(a,F.sum(A.mul(n.l2,fl(t))))),A.reshape(a,[])})},e.prototype.getConfig=function(){return{l1:this.l1,l2:this.l2}},e.fromConfig=function(t,n){return new t({l1:n.l1,l2:n.l2})},e})(OI);gl.className="L1L2";F.serialization.registerClass(gl);function CJ(r){return yg(r),new gl({l1:r!=null?r.l1:null,l2:0})}function AJ(r){return yg(r),new gl({l2:r!=null?r.l2:null,l1:0})}var sT={l1l2:"L1L2"};function Ot(r){return Am(r)}function uT(r,e){return e===void 0&&(e={}),cl(r,F.serialization.SerializationMap.getMap().classNameMap,e,"regularizer")}function tr(r){if(r==null)return null;if(typeof r=="string"){var e=r in sT?sT[r]:r,t={className:e,config:{}};return uT(t)}else return r instanceof OI?r:uT(r)}var bg=(function(r){ie(e,r);function e(t){var n=r.call(this,t??{})||this;return n.supportsMasking=!0,t!=null&&(n.maxValue=t.maxValue),n}return e.prototype.call=function(t,n){t=tt(t);var a=F.relu(t);return this.maxValue!=null&&(a=F.clipByValue(a,0,this.maxValue)),a},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t={maxValue:this.maxValue},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e})(lt);bg.className="ReLU";F.serialization.registerClass(bg);var wg=(function(r){ie(e,r);function e(t){var n=r.call(this,t??{})||this;return n.DEFAULT_ALPHA=.3,t==null&&(t={}),n.alpha=t.alpha==null?n.DEFAULT_ALPHA:t.alpha,n}return e.prototype.call=function(t,n){var a=tt(t);return F.leakyRelu(a,this.alpha)},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t={alpha:this.alpha},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e})(lt);wg.className="LeakyReLU";F.serialization.registerClass(wg);var xg=(function(r){ie(e,r);function e(t){var n=r.call(this,t??{})||this;if(n.DEFAULT_ALPHA_INITIALIZER="zeros",t==null&&(t={}),n.supportsMasking=!0,n.alphaInitializer=Qt(t.alphaInitializer||n.DEFAULT_ALPHA_INITIALIZER),n.alphaRegularizer=tr(t.alphaRegularizer),n.alphaConstraint=Dr(t.alphaConstraint),t.sharedAxes==null)n.sharedAxes=null;else if(Array.isArray(t.sharedAxes))n.sharedAxes=t.sharedAxes;else if(typeof t.sharedAxes=="number")n.sharedAxes=[t.sharedAxes];else throw new Y("Expected sharedAxes to be a number or an array of numbers, "+"but got ".concat(t.sharedAxes));return n}return e.prototype.build=function(t){var n,a;t=wt(t);var i=t.slice(1);if(this.sharedAxes!=null)try{for(var o=le(this.sharedAxes),s=o.next();!s.done;s=o.next()){var u=s.value;i[u-1]=1}}catch(l){n={error:l}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}this.alpha=this.addWeight("alpha",i,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);var c={};if(this.sharedAxes!=null)for(var u=1;u<t.length;++u)c[u]=t[u];this.inputSpec=[new Nr({ndim:t.length,axes:c})],this.built=!0},e.prototype.call=function(t,n){return t=tt(t),F.prelu(t,this.alpha.read())},e.prototype.getConfig=function(){var t={alphaInitializer:sr(this.alphaInitializer),alphaRegularizer:Ot(this.alphaRegularizer),alphaConstraint:Ar(this.alphaConstraint),sharedAxes:this.sharedAxes},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e})(lt);xg.className="PReLU";F.serialization.registerClass(xg);var kg=(function(r){ie(e,r);function e(t){var n=r.call(this,t??{})||this;if(n.DEFAULT_ALPHA=1,t==null&&(t={}),t.alpha!=null&&t.alpha!==n.DEFAULT_ALPHA)throw new ct("Non-default alpha value (".concat(t.alpha,") is not supported by the ")+"ELU layer yet.");return n.alpha=t.alpha==null?n.DEFAULT_ALPHA:t.alpha,n}return e.prototype.call=function(t,n){var a=tt(t);return F.elu(a)},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t={alpha:this.alpha},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e})(lt);kg.className="ELU";F.serialization.registerClass(kg);var Sg=(function(r){ie(e,r);function e(t){var n=r.call(this,t??{})||this;return n.DEFAULT_THETA=1,t==null&&(t={}),n.theta=t.theta==null?n.DEFAULT_THETA:t.theta,n}return e.prototype.call=function(t,n){var a=tt(t);return F.mul(a,F.cast(F.greater(a,this.theta),"float32"))},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t={theta:this.theta},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e})(lt);Sg.className="ThresholdedReLU";F.serialization.registerClass(Sg);var Eg=(function(r){ie(e,r);function e(t){var n=r.call(this,t??{})||this;return n.DEFAULT_AXIS=1,t==null&&(t={}),n.softmax=new gg().apply,n.axis=t.axis==null?n.DEFAULT_AXIS:t.axis,n}return e.prototype.call=function(t,n){var a=this;return F.tidy(function(){var i=tt(t),o=n.mask;if(o!=null){var s=F.mul(F.sub(F.ones(i.shape),F.cast(o,i.dtype)),F.scalar(-1e9));i=F.add(i,s)}return a.axis instanceof Array?a.axis.length>1?F.exp(F.sub(i,F.logSumExp(i,a.axis,!0))):a.softmax(i,a.axis[0]):a.softmax(i,a.axis)})},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t={axis:this.axis},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e})(lt);Eg.className="Softmax";F.serialization.registerClass(Eg);function vu(r,e,t){if(typeof r=="number")return rs(r,e);if(r.length!==e)throw new Y("The ".concat(t," argument must be an integer or tuple of ").concat(e," integers.")+" Received: ".concat(r.length," elements."));for(var n=0;n<e;++n){var a=r[n];if(!AK(a))throw new Y("The ".concat(t," argument must be an integer or tuple of ").concat(e)+" integers. Received: ".concat(JSON.stringify(r)," including a")+" non-integer number ".concat(a))}return r}function qa(r,e,t,n,a){if(a===void 0&&(a=1),r==null)return r;var i=e+(e-1)*(a-1),o;return t==="same"?o=r:o=r-i+1,Math.floor((o+n-1)/n)}function li(r,e,t,n){if(r==null)return null;if(n==="valid")r=r*e+lo([t-e,0]);else if(n==="same")r=r*e;else throw new Y("Unsupport padding mode: ".concat(n,"."));return r}function Tg(r,e){return F.tidy(function(){return gr(e),e==="channelsFirst"?A.transpose(r,[0,2,3,1]):r})}function PI(r,e){return F.tidy(function(){return gr(e),e==="channelsFirst"?A.transpose(r,[0,2,3,4,1]):r})}function DJ(r,e,t,n,a,i,o){return n===void 0&&(n=1),a===void 0&&(a="valid"),o===void 0&&(o=1),F.tidy(function(){if(i==null&&(i=ja()),gr(i),r.shape.length!==3)throw new Y("The input of a conv1dWithBias operation should be 3, but is "+"".concat(r.shape.length," instead."));if(e.shape.length!==3)throw new Y("The kernel for a conv1dWithBias operation should be 3, but is "+"".concat(e.shape.length," instead"));if(t!=null&&t.shape.length!==1)throw new Y("The bias for a conv1dWithBias operation should be 1, but is "+"".concat(t.shape.length," instead"));if(i==="channelsFirst"&&(r=A.transpose(r,[0,2,1])),a==="causal")throw new ct("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");var s=A.conv1d(r,e,n,a==="same"?"same":"valid","NWC",o);return t!=null&&(s=Za(s,t)),s})}function cT(r,e,t,n,a,i,o,s){return n===void 0&&(n=[1,1]),a===void 0&&(a="valid"),s===void 0&&(s=null),F.tidy(function(){if(i==null&&(i=ja()),gr(i),r.rank!==3&&r.rank!==4)throw new Y("conv2dWithBiasActivation expects input to be of rank 3 or 4, "+"but received ".concat(r.rank,"."));if(e.rank!==3&&e.rank!==4)throw new Y("conv2dWithBiasActivation expects kernel to be of rank 3 or 4, "+"but received ".concat(r.rank,"."));var u=Tg(r,i);if(a==="causal")throw new ct("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return u=A.fused.conv2d({x:u,filter:e,strides:n,pad:a==="same"?"same":"valid",dilations:o,dataFormat:"NHWC",bias:t,activation:s}),i==="channelsFirst"&&(u=A.transpose(u,[0,3,1,2])),u})}function _J(r,e,t,n,a,i,o){return n===void 0&&(n=[1,1,1]),a===void 0&&(a="valid"),F.tidy(function(){if(i==null&&(i=ja()),gr(i),r.rank!==4&&r.rank!==5)throw new Y("conv3dWithBias expects input to be of rank 4 or 5, but received "+"".concat(r.rank,"."));if(e.rank!==4&&e.rank!==5)throw new Y("conv3dWithBias expects kernel to be of rank 4 or 5, but received "+"".concat(r.rank,"."));var s=PI(r,i);if(a==="causal")throw new ct("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return s=A.conv3d(s,e,n,a==="same"?"same":"valid","NDHWC",o),t!=null&&(s=Za(s,t)),i==="channelsFirst"&&(s=A.transpose(s,[0,4,1,2,3])),s})}var MI=(function(r){ie(e,r);function e(t,n){var a=r.call(this,n)||this;if(a.bias=null,a.DEFAULT_KERNEL_INITIALIZER="glorotNormal",a.DEFAULT_BIAS_INITIALIZER="zeros",e.verifyArgs(n),a.rank=t,Mr(a.rank,"rank"),a.rank!==1&&a.rank!==2&&a.rank!==3)throw new ct("Convolution layer for rank other than 1, 2, or 3 (".concat(a.rank,") is ")+"not implemented yet.");if(a.kernelSize=vu(n.kernelSize,t,"kernelSize"),a.strides=vu(n.strides==null?1:n.strides,t,"strides"),a.padding=n.padding==null?"valid":n.padding,ea(a.padding),a.dataFormat=n.dataFormat==null?"channelsLast":n.dataFormat,gr(a.dataFormat),a.activation=ho(n.activation),a.useBias=n.useBias==null?!0:n.useBias,a.biasInitializer=Qt(n.biasInitializer||a.DEFAULT_BIAS_INITIALIZER),a.biasConstraint=Dr(n.biasConstraint),a.biasRegularizer=tr(n.biasRegularizer),a.activityRegularizer=tr(n.activityRegularizer),a.dilationRate=vu(n.dilationRate==null?1:n.dilationRate,t,"dilationRate"),a.rank===1&&Array.isArray(a.dilationRate)&&a.dilationRate.length!==1)throw new Y("dilationRate must be a number or an array of a single number for 1D convolution, but received "+"".concat(JSON.stringify(a.dilationRate)));if(a.rank===2){if(typeof a.dilationRate=="number")a.dilationRate=[a.dilationRate,a.dilationRate];else if(a.dilationRate.length!==2)throw new Y("dilationRate must be a number or array of two numbers for 2D "+"convolution, but received ".concat(JSON.stringify(a.dilationRate)))}else if(a.rank===3){if(typeof a.dilationRate=="number")a.dilationRate=[a.dilationRate,a.dilationRate,a.dilationRate];else if(a.dilationRate.length!==3)throw new Y("dilationRate must be a number or array of three numbers for 3D "+"convolution, but received ".concat(JSON.stringify(a.dilationRate)))}return a}return e.verifyArgs=function(t){if(ci("kernelSize"in t,"required key 'kernelSize' not in config"),typeof t.kernelSize!="number"&&!Dm(t.kernelSize,"number",1,3))throw new Y("BaseConv expects config.kernelSize to be number or number[] with "+"length 1, 2, or 3, but received ".concat(JSON.stringify(t.kernelSize),"."))},e.prototype.getConfig=function(){var t={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:fo(this.activation),useBias:this.useBias,biasInitializer:sr(this.biasInitializer),biasRegularizer:Ot(this.biasRegularizer),activityRegularizer:Ot(this.activityRegularizer),biasConstraint:Ar(this.biasConstraint)},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e})(lt),Zh=(function(r){ie(e,r);function e(t,n){var a=r.call(this,t,n)||this;return a.kernel=null,e.verifyArgs(n),a.filters=n.filters,Mr(a.filters,"filters"),a.kernelInitializer=Qt(n.kernelInitializer||a.DEFAULT_KERNEL_INITIALIZER),a.kernelConstraint=Dr(n.kernelConstraint),a.kernelRegularizer=tr(n.kernelRegularizer),a}return e.prototype.build=function(t){var n;t=wt(t);var a=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[a]==null)throw new Y("The channel dimension of the input should be defined. "+"Found ".concat(t[a]));var i=t[a],o=this.kernelSize.concat([i,this.filters]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:(n={},n[a]=i,n)}],this.built=!0},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){t=tt(t);var i,o=a.bias==null?null:a.bias.read(),s=vT(a.activation.getClassName());if(s!=null&&a.rank===2)i=cT(t,a.kernel.read(),o,a.strides,a.padding,a.dataFormat,a.dilationRate,s);else{if(a.rank===1)i=DJ(t,a.kernel.read(),o,a.strides[0],a.padding,a.dataFormat,a.dilationRate[0]);else if(a.rank===2)i=cT(t,a.kernel.read(),o,a.strides,a.padding,a.dataFormat,a.dilationRate);else if(a.rank===3)i=_J(t,a.kernel.read(),o,a.strides,a.padding,a.dataFormat,a.dilationRate);else throw new ct("convolutions greater than 3D are not implemented yet.");a.activation!=null&&(i=a.activation.apply(i))}return i})},e.prototype.computeOutputShape=function(t){t=wt(t);for(var n=[],a=this.dataFormat==="channelsLast"?t.slice(1,t.length-1):t.slice(2),i=0;i<a.length;++i){var o=qa(a[i],this.kernelSize[i],this.padding,this.strides[i],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[i]);n.push(o)}var s=[t[0]];return this.dataFormat==="channelsLast"?(s=s.concat(n),s.push(this.filters)):(s.push(this.filters),s=s.concat(n)),s},e.prototype.getConfig=function(){var t={filters:this.filters,kernelInitializer:sr(this.kernelInitializer),kernelRegularizer:Ot(this.kernelRegularizer),kernelConstraint:Ar(this.kernelConstraint)},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.verifyArgs=function(t){if(!("filters"in t)||typeof t.filters!="number"||t.filters<1)throw new Y("Convolution layer expected config.filters to be a 'number' > 0 "+"but got ".concat(JSON.stringify(t.filters)))},e})(MI),Jh=(function(r){ie(e,r);function e(t){var n=r.call(this,2,t)||this;return e.verifyArgs(t),n}return e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this);return delete t.rank,t},e.verifyArgs=function(t){if(typeof t.kernelSize!="number"&&!Dm(t.kernelSize,"number",1,2))throw new Y("Conv2D expects config.kernelSize to be number or number[] with "+"length 1 or 2, but received ".concat(JSON.stringify(t.kernelSize),"."))},e})(Zh);Jh.className="Conv2D";F.serialization.registerClass(Jh);var Qh=(function(r){ie(e,r);function e(t){var n=r.call(this,3,t)||this;return e.verifyArgs(t),n}return e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this);return delete t.rank,t},e.verifyArgs=function(t){if(typeof t.kernelSize!="number"&&!(Array.isArray(t.kernelSize)&&(t.kernelSize.length===1||t.kernelSize.length===3)))throw new Y("Conv3D expects config.kernelSize to be number or"+" [number, number, number], but received ".concat(JSON.stringify(t.kernelSize),"."))},e})(Zh);Qh.className="Conv3D";F.serialization.registerClass(Qh);var Ng=(function(r){ie(e,r);function e(t){var n=r.call(this,t)||this;if(n.inputSpec=[new Nr({ndim:4})],n.padding!=="same"&&n.padding!=="valid")throw new Y("Conv2DTranspose currently supports only padding modes 'same' "+"and 'valid', but received padding mode ".concat(n.padding));return n}return e.prototype.build=function(t){var n;if(t=wt(t),t.length!==4)throw new Y("Input should have rank 4; Received input shape: "+JSON.stringify(t));var a=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[a]==null)throw new Y("The channel dimension of the inputs should be defined. Found `None`.");var i=t[a],o=this.kernelSize.concat([this.filters,i]);this.kernel=this.addWeight("kernel",o,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Nr({ndim:4,axes:(n={},n[a]=i,n)})],this.built=!0},e.prototype.call=function(t,n){var a=this;return A.tidy(function(){var i=tt(t);if(i.shape.length!==4)throw new Y("Conv2DTranspose.call() expects input tensor to be rank-4, but "+"received a tensor of rank-".concat(i.shape.length));var o=i.shape,s=o[0],u,c;a.dataFormat==="channelsFirst"?(u=2,c=3):(u=1,c=2);var l=o[u],f=o[c],h=a.kernelSize[0],p=a.kernelSize[1],d=a.strides[0],m=a.strides[1],v=li(l,d,h,a.padding),g=li(f,m,p,a.padding),y=[s,v,g,a.filters];a.dataFormat!=="channelsLast"&&(i=A.transpose(i,[0,2,3,1]));var w=A.conv2dTranspose(i,a.kernel.read(),y,a.strides,a.padding);return a.dataFormat!=="channelsLast"&&(w=A.transpose(w,[0,3,1,2])),a.bias!=null&&(w=Za(w,a.bias.read(),a.dataFormat)),a.activation!=null&&(w=a.activation.apply(w)),w})},e.prototype.computeOutputShape=function(t){t=wt(t);var n=t.slice(),a,i,o;this.dataFormat==="channelsFirst"?(a=1,i=2,o=3):(a=3,i=1,o=2);var s=this.kernelSize[0],u=this.kernelSize[1],c=this.strides[0],l=this.strides[1];return n[a]=this.filters,n[i]=li(n[i],c,s,this.padding),n[o]=li(n[o],l,u,this.padding),n},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this);return delete t.dilationRate,t},e})(Jh);Ng.className="Conv2DTranspose";F.serialization.registerClass(Ng);var Ig=(function(r){ie(e,r);function e(t){var n=r.call(this,t)||this;if(n.inputSpec=[new Nr({ndim:5})],n.padding!=="same"&&n.padding!=="valid")throw new Y("Conv3DTranspose currently supports only padding modes 'same' "+"and 'valid', but received padding mode ".concat(n.padding));return n}return e.prototype.build=function(t){var n;if(t=wt(t),t.length!==5)throw new Y("Input should have rank 5; Received input shape: "+JSON.stringify(t));var a=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[a]==null)throw new Y("The channel dimension of the inputs should be defined. Found `None`.");var i=t[a],o=this.kernelSize.concat([this.filters,i]);this.kernel=this.addWeight("kernel",o,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Nr({ndim:5,axes:(n={},n[a]=i,n)})],this.built=!0},e.prototype.call=function(t,n){var a=this;return A.tidy(function(){var i=tt(t);if(i.shape.length!==5)throw new Y("Conv3DTranspose.call() expects input tensor to be rank-4, but "+"received a tensor of rank-".concat(i.shape.length));var o=i.shape,s=o[0],u,c,l;a.dataFormat==="channelsFirst"?(l=2,u=3,c=4):(l=1,u=2,c=3);var f=o[l],h=o[u],p=o[c],d=a.kernelSize[0],m=a.kernelSize[1],v=a.kernelSize[2],g=a.strides[0],y=a.strides[1],w=a.strides[2],b=li(f,g,d,a.padding),x=li(h,y,m,a.padding),S=li(p,w,v,a.padding),T=[s,b,x,S,a.filters];a.dataFormat!=="channelsLast"&&(i=A.transpose(i,[0,2,3,4,1]));var N=A.conv3dTranspose(i,a.kernel.read(),T,a.strides,a.padding);return a.dataFormat!=="channelsLast"&&(N=A.transpose(N,[0,4,1,2,3])),a.bias!==null&&(N=Za(N,a.bias.read(),a.dataFormat)),a.activation!==null&&(N=a.activation.apply(N)),N})},e.prototype.computeOutputShape=function(t){t=wt(t);var n=t.slice(),a,i,o,s;this.dataFormat==="channelsFirst"?(a=1,i=2,o=3,s=4):(a=4,i=1,o=2,s=3);var u=this.kernelSize[0],c=this.kernelSize[1],l=this.kernelSize[2],f=this.strides[0],h=this.strides[1],p=this.strides[2];return n[a]=this.filters,n[i]=li(n[i],f,u,this.padding),n[o]=li(n[o],h,c,this.padding),n[s]=li(n[s],p,l,this.padding),n},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this);return delete t.dilationRate,t},e})(Qh);Ig.className="Conv3DTranspose";F.serialization.registerClass(Ig);var BI=(function(r){ie(e,r);function e(t,n){var a=r.call(this,t,n)||this;if(a.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",a.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",a.depthwiseKernel=null,a.pointwiseKernel=null,n.filters==null)throw new Y("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(n.kernelInitializer!=null||n.kernelRegularizer!=null||n.kernelConstraint!=null)throw new Y("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(n.padding!=null&&n.padding!=="same"&&n.padding!=="valid")throw new Y("SeparableConv".concat(a.rank,"D supports only padding modes: ")+"'same' and 'valid', but received ".concat(JSON.stringify(n.padding)));return a.depthMultiplier=n.depthMultiplier==null?1:n.depthMultiplier,a.depthwiseInitializer=Qt(n.depthwiseInitializer||a.DEFAULT_DEPTHWISE_INITIALIZER),a.depthwiseRegularizer=tr(n.depthwiseRegularizer),a.depthwiseConstraint=Dr(n.depthwiseConstraint),a.pointwiseInitializer=Qt(n.depthwiseInitializer||a.DEFAULT_POINTWISE_INITIALIZER),a.pointwiseRegularizer=tr(n.pointwiseRegularizer),a.pointwiseConstraint=Dr(n.pointwiseConstraint),a}return e.prototype.build=function(t){var n;if(t=wt(t),t.length<this.rank+2)throw new Y("Inputs to SeparableConv".concat(this.rank,"D should have rank ")+"".concat(this.rank+2,", but received input shape: ")+"".concat(JSON.stringify(t)));var a=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[a]==null||t[a]<0)throw new Y("The channel dimension of the inputs should be defined, "+"but found ".concat(JSON.stringify(t[a])));for(var i=t[a],o=this.kernelSize.concat([i,this.depthMultiplier]),s=[],u=0;u<this.rank;++u)s.push(1);s.push(i*this.depthMultiplier,this.filters);var c=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",o,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,c,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",s,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,c,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,c,this.biasConstraint):this.bias=null,this.inputSpec=[new Nr({ndim:this.rank+2,axes:(n={},n[a]=i,n)})],this.built=!0},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){t=tt(t);var i;if(a.rank===1)throw new ct("1D separable convolution is not implemented yet.");return a.rank===2&&(a.dataFormat==="channelsFirst"&&(t=A.transpose(t,[0,2,3,1])),i=A.separableConv2d(t,a.depthwiseKernel.read(),a.pointwiseKernel.read(),a.strides,a.padding,a.dilationRate,"NHWC")),a.useBias&&(i=Za(i,a.bias.read(),a.dataFormat)),a.activation!=null&&(i=a.activation.apply(i)),a.dataFormat==="channelsFirst"&&(i=A.transpose(i,[0,3,1,2])),i})},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this);return delete t.rank,delete t.kernelInitializer,delete t.kernelRegularizer,delete t.kernelConstraint,t.depthwiseInitializer=sr(this.depthwiseInitializer),t.pointwiseInitializer=sr(this.pointwiseInitializer),t.depthwiseRegularizer=Ot(this.depthwiseRegularizer),t.pointwiseRegularizer=Ot(this.pointwiseRegularizer),t.depthwiseConstraint=Ar(this.depthwiseConstraint),t.pointwiseConstraint=Ar(this.pointwiseConstraint),t},e})(Zh);BI.className="SeparableConv";var Cg=(function(r){ie(e,r);function e(t){return r.call(this,2,t)||this}return e})(BI);Cg.className="SeparableConv2D";F.serialization.registerClass(Cg);var Ag=(function(r){ie(e,r);function e(t){var n=r.call(this,1,t)||this;return e.verifyArgs(t),n.inputSpec=[{ndim:3}],n}return e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this);return delete t.rank,delete t.dataFormat,t},e.verifyArgs=function(t){if(typeof t.kernelSize!="number"&&!Dm(t.kernelSize,"number",1,1))throw new Y("Conv1D expects config.kernelSize to be number or number[] with "+"length 1, but received ".concat(JSON.stringify(t.kernelSize),"."))},e})(Zh);Ag.className="Conv1D";F.serialization.registerClass(Ag);var Dg=(function(r){ie(e,r);function e(t){var n=r.call(this,t)||this;return typeof t.cropping=="number"?n.cropping=[[t.cropping,t.cropping],[t.cropping,t.cropping]]:typeof t.cropping[0]=="number"?n.cropping=[[t.cropping[0],t.cropping[0]],[t.cropping[1],t.cropping[1]]]:n.cropping=t.cropping,n.dataFormat=t.dataFormat===void 0?"channelsLast":t.dataFormat,n.inputSpec=[{ndim:4}],n}return e.prototype.computeOutputShape=function(t){return this.dataFormat==="channelsFirst"?[t[0],t[1],t[2]-this.cropping[0][0]-this.cropping[0][1],t[3]-this.cropping[1][0]-this.cropping[1][1]]:[t[0],t[1]-this.cropping[0][0]-this.cropping[0][1],t[2]-this.cropping[1][0]-this.cropping[1][1],t[3]]},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){if(t=tt(t),a.dataFormat==="channelsLast"){var i=ch(t,a.cropping[0][0],t.shape[1]-a.cropping[0][0]-a.cropping[0][1],2);return ch(i,a.cropping[1][0],t.shape[2]-a.cropping[1][1]-a.cropping[1][0],3)}else{var i=ch(t,a.cropping[0][0],t.shape[2]-a.cropping[0][0]-a.cropping[0][1],3);return ch(i,a.cropping[1][0],t.shape[3]-a.cropping[1][1]-a.cropping[1][0],4)}})},e.prototype.getConfig=function(){var t={cropping:this.cropping,dataFormat:this.dataFormat},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e})(lt);Dg.className="Cropping2D";F.serialization.registerClass(Dg);var _g=(function(r){ie(e,r);function e(t){var n=r.call(this,t)||this;return n.DEFAULT_SIZE=[2,2],n.inputSpec=[{ndim:4}],n.size=t.size==null?n.DEFAULT_SIZE:t.size,n.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,gr(n.dataFormat),n.interpolation=t.interpolation==null?"nearest":t.interpolation,NK(n.interpolation),n}return e.prototype.computeOutputShape=function(t){if(this.dataFormat==="channelsFirst"){var n=t[2]==null?null:this.size[0]*t[2],a=t[3]==null?null:this.size[1]*t[3];return[t[0],t[1],n,a]}else{var n=t[1]==null?null:this.size[0]*t[1],a=t[2]==null?null:this.size[1]*t[2];return[t[0],n,a,t[3]]}},e.prototype.call=function(t,n){var a=this;return A.tidy(function(){var i=tt(t),o=i.shape;if(a.dataFormat==="channelsFirst"){i=A.transpose(i,[0,2,3,1]);var s=a.size[0]*o[2],u=a.size[1]*o[3],c=a.interpolation==="nearest"?A.image.resizeNearestNeighbor(i,[s,u]):A.image.resizeBilinear(i,[s,u]);return A.transpose(c,[0,3,1,2])}else{var s=a.size[0]*o[1],u=a.size[1]*o[2];return a.interpolation==="nearest"?A.image.resizeNearestNeighbor(i,[s,u]):A.image.resizeBilinear(i,[s,u])}})},e.prototype.getConfig=function(){var t={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e})(lt);_g.className="UpSampling2D";F.serialization.registerClass(_g);function FJ(r,e,t,n,a,i){return t===void 0&&(t=[1,1]),n===void 0&&(n="valid"),F.tidy(function(){a==null&&(a=ja()),gr(a);var o=Tg(r,a);if(r.rank!==4)throw new Y("Input for depthwiseConv2d is required to be 4-D, but is instead "+"".concat(r.rank,"-D"));if(e.rank!==4)throw new Y("depthwiseKernel is required to be 4-D, but is instead "+"".concat(e.rank,"-D"));return o=A.depthwiseConv2d(o,e,t,n==="same"?"same":"valid","NHWC",i),a==="channelsFirst"&&(o=A.transpose(o,[0,3,1,2])),o})}var Fg=(function(r){ie(e,r);function e(t){var n=r.call(this,2,t)||this;return n.depthwiseKernel=null,n.depthMultiplier=t.depthMultiplier==null?1:t.depthMultiplier,n.depthwiseInitializer=Qt(t.depthwiseInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.depthwiseConstraint=Dr(t.depthwiseConstraint),n.depthwiseRegularizer=tr(t.depthwiseRegularizer),n}return e.prototype.build=function(t){if(t=wt(t),t.length<4)throw new Y("Inputs to DepthwiseConv2D should have rank 4. "+"Received input shape: ".concat(JSON.stringify(t),"."));var n=this.dataFormat==="channelsFirst"?1:3;if(t[n]==null||t[n]<0)throw new Y("The channel dimension of the inputs to DepthwiseConv2D should "+"be defined, but is not (".concat(t[n],")."));var a=t[n],i=[this.kernelSize[0],this.kernelSize[1],a,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",i,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[a*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){t=tt(t);var i=FJ(t,a.depthwiseKernel.read(),a.strides,a.padding,a.dataFormat,null);return a.useBias&&(i=Za(i,a.bias.read(),a.dataFormat)),a.activation!=null&&(i=a.activation.apply(i)),i})},e.prototype.computeOutputShape=function(t){t=wt(t);var n=this.dataFormat==="channelsFirst"?t[2]:t[1],a=this.dataFormat==="channelsFirst"?t[3]:t[2],i=this.dataFormat==="channelsFirst"?t[1]*this.depthMultiplier:t[3]*this.depthMultiplier,o=qa(n,this.kernelSize[0],this.padding,this.strides[0]),s=qa(a,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[t[0],i,o,s]:[t[0],o,s,i]},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this);return t.depthMultiplier=this.depthMultiplier,t.depthwiseInitializer=sr(this.depthwiseInitializer),t.depthwiseRegularizer=Ot(this.depthwiseRegularizer),t.depthwiseConstraint=Ar(this.depthwiseRegularizer),t},e})(MI);Fg.className="DepthwiseConv2D";F.serialization.registerClass(Fg);function LI(r,e,t,n){if(Array.isArray(r)){if(e!=null||t!=null)throw new Y("When inputs is an array, neither initialState or constants should be provided");n!=null&&(t=r.slice(r.length-n,r.length),r=r.slice(0,r.length-n)),r.length>1&&(e=r.slice(1,r.length)),r=r[0]}function a(i){return i==null||Array.isArray(i)?i:[i]}return e=a(e),t=a(t),{inputs:r,initialState:e,constants:t}}function zI(r,e,t,n,a,i,o,s){return n===void 0&&(n=!1),o===void 0&&(o=!1),s===void 0&&(s=!1),A.tidy(function(){var u=e.shape.length;if(u<3)throw new Y("Input should be at least 3D, but is ".concat(u,"D."));var c=[1,0].concat(Ka(2,u));if(e=A.transpose(e,c),i!=null)throw new ct("The rnn() functoin of the deeplearn.js backend does not support constants yet.");o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),a!=null&&(a=A.cast(A.cast(a,"bool"),"float32"),a.rank===u-1&&(a=A.expandDims(a,-1)),a=A.transpose(a,c)),n&&(e=A.reverse(e,0),a!=null&&(a=A.reverse(a,0)));var l=[],f,h=t,p=e.shape[0],d=A.unstack(e),m;a!=null&&(m=A.unstack(a));for(var v=function(b){var x=d[b],S=A.tidy(function(){return r(x,h)});if(a==null)f=S[0],h=S[1];else{var T=A.tidy(function(){var N=m[b],C=A.sub(A.onesLike(N),N),R=A.add(A.mul(S[0],N),A.mul(h[0],C)),_=h.map(function(P,$){return A.add(A.mul(S[1][$],N),A.mul(P,C))});return{output:R,newStates:_}});f=T.output,h=T.newStates}s&&l.push(f)},g=0;g<p;++g)v(g);var y;if(s){var w=1;y=A.stack(l,w)}return[f,y,h]})}var Oi=(function(r){ie(e,r);function e(t){var n=r.call(this,t)||this,a;if(t.cell==null)throw new Y("cell property is missing for the constructor of RNN.");if(Array.isArray(t.cell)?a=new rp({cells:t.cell}):a=t.cell,a.stateSize==null)throw new Y("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");return n.cell=a,n.returnSequences=t.returnSequences==null?!1:t.returnSequences,n.returnState=t.returnState==null?!1:t.returnState,n.goBackwards=t.goBackwards==null?!1:t.goBackwards,n._stateful=t.stateful==null?!1:t.stateful,n.unroll=t.unroll==null?!1:t.unroll,n.supportsMasking=!0,n.inputSpec=[new Nr({ndim:3})],n.stateSpec=null,n.states_=null,n.numConstants=null,n.keptStates=[],n}return e.prototype.getStates=function(){if(this.states_==null){var t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return Ka(0,t).map(function(n){return null})}else return this.states_},e.prototype.setStates=function(t){this.states_=t},e.prototype.computeOutputShape=function(t){var n,a;vm(t)&&(t=t[0]),t=t;var i=this.cell.stateSize;Array.isArray(i)||(i=[i]);var o=i[0],s;if(this.returnSequences?s=[t[0],t[1],o]:s=[t[0],o],this.returnState){var u=[];try{for(var c=le(i),l=c.next();!l.done;l=c.next()){var f=l.value;u.push([t[0],f])}}catch(h){n={error:h}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(n)throw n.error}}return[s].concat(u)}else return s},e.prototype.computeMask=function(t,n){var a=this;return A.tidy(function(){Array.isArray(n)&&(n=n[0]);var i=a.returnSequences?n:null;if(a.returnState){var o=a.states.map(function(s){return null});return[i].concat(o)}else return i})},Object.defineProperty(e.prototype,"states",{get:function(){if(this.states_==null){for(var t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,n=[],a=0;a<t;++a)n.push(null);return n}else return this.states_},set:function(t){this.states_=t},enumerable:!1,configurable:!0}),e.prototype.build=function(t){if(this.numConstants!=null)throw new ct("Constants support is not implemented in RNN yet.");vm(t)&&(t=t[0]),t=t;var n=this.stateful?t[0]:null,a=t.slice(2);this.inputSpec[0]=new Nr({shape:Xe([n,null],ee(a),!1)});var i=[t[0]].concat(t.slice(2));this.cell.build(i);var o;if(Array.isArray(this.cell.stateSize)?o=this.cell.stateSize:o=[this.cell.stateSize],this.stateSpec!=null){if(!F.util.arraysEqual(this.stateSpec.map(function(s){return s.shape[s.shape.length-1]}),o))throw new Y("An initialState was passed that is not compatible with "+"cell.stateSize. Received stateSpec=".concat(this.stateSpec,"; ")+"However cell.stateSize is ".concat(this.cell.stateSize))}else this.stateSpec=o.map(function(s){return new Nr({shape:[null,s]})});this.stateful&&this.resetStates()},e.prototype.resetStates=function(t,n){var a=this;n===void 0&&(n=!1),F.tidy(function(){if(!a.stateful)throw new so("Cannot call resetStates() on an RNN Layer that is not stateful.");var i=a.inputSpec[0].shape[0];if(i==null)throw new Y("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(a.states_==null)Array.isArray(a.cell.stateSize)?a.states_=a.cell.stateSize.map(function(l){return A.zeros([i,l])}):a.states_=[A.zeros([i,a.cell.stateSize])];else if(t==null)A.dispose(a.states_),a.keptStates!=null&&(A.dispose(a.keptStates),a.keptStates=[]),Array.isArray(a.cell.stateSize)?a.states_=a.cell.stateSize.map(function(l){return A.zeros([i,l])}):a.states_[0]=A.zeros([i,a.cell.stateSize]);else{if(Array.isArray(t)||(t=[t]),t.length!==a.states_.length)throw new Y("Layer ".concat(a.name," expects ").concat(a.states_.length," state(s), ")+"but it received ".concat(t.length," state value(s). Input ")+"received: ".concat(t));n===!0?a.keptStates.push(a.states_.slice()):A.dispose(a.states_);for(var o=0;o<a.states_.length;++o){var s=t[o],u=Array.isArray(a.cell.stateSize)?a.cell.stateSize[o]:a.cell.stateSize,c=[i,u];if(!F.util.arraysEqual(s.shape,c))throw new Y("State ".concat(o," is incompatible with layer ").concat(a.name,": ")+"expected shape=".concat(c,", received shape=").concat(s.shape));a.states_[o]=s}}a.states_=a.states_.map(function(l){return A.keep(l.clone())})})},e.prototype.apply=function(t,n){var a,i,o=n==null?null:n.initialState,s=n==null?null:n.constants;n==null&&(n={});var u=LI(t,o,s,this.numConstants);t=u.inputs,o=u.initialState,s=u.constants;var c=[],l=[];if(o!=null){n.initialState=o,c=c.concat(o),this.stateSpec=[];try{for(var f=le(o),h=f.next();!h.done;h=f.next()){var p=h.value;this.stateSpec.push(new Nr({shape:p.shape}))}}catch(w){a={error:w}}finally{try{h&&!h.done&&(i=f.return)&&i.call(f)}finally{if(a)throw a.error}}l=l.concat(this.stateSpec)}s!=null&&(n.constants=s,c=c.concat(s),this.numConstants=s.length);var d=c[0]instanceof Xa;if(d){var m=[t].concat(c),v=this.inputSpec.concat(l),g=this.inputSpec;this.inputSpec=v;var y=r.prototype.apply.call(this,m,n);return this.inputSpec=g,y}else return r.prototype.apply.call(this,t,n)},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){var i=n==null?null:n.mask,o=n==null?null:n.training,s=n==null?null:n.initialState;t=tt(t),s==null&&(a.stateful?s=a.states_:s=a.getInitialState(t));var u=Array.isArray(a.cell.stateSize)?a.cell.stateSize.length:1;if(s.length!==u)throw new Y("RNN Layer has ".concat(u," state(s) but was passed ")+"".concat(s.length," initial state(s)."));a.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");var c={training:o},l=function(v,g){var y=a.cell.call([v].concat(g),c);return[y[0],y.slice(1)]},f=zI(l,t,s,a.goBackwards,i,null,a.unroll,a.returnSequences),h=f[0],p=f[1],d=f[2];a.stateful&&a.resetStates(d,o);var m=a.returnSequences?p:h;return a.returnState?[m].concat(d):m})},e.prototype.getInitialState=function(t){var n=this;return F.tidy(function(){var a=A.zeros(t.shape);return a=A.sum(a,[1,2]),a=ll(a),Array.isArray(n.cell.stateSize)?n.cell.stateSize.map(function(i){return i>1?pm(a,[1,i]):a}):n.cell.stateSize>1?[pm(a,[1,n.cell.stateSize])]:[a]})},Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.trainable?this.cell.trainableWeights:[]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights},enumerable:!1,configurable:!0}),e.prototype.setFastWeightInitDuringBuild=function(t){r.prototype.setFastWeightInitDuringBuild.call(this,t),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(t)},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this),n={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(n.numConstants=this.numConstants);var a=this.cell.getConfig();return this.getClassName()===e.className&&(n.cell={className:this.cell.getClassName(),config:a}),Object.assign(Object.assign(Object.assign({},a),t),n)},e.fromConfig=function(t,n,a){a===void 0&&(a={});var i=n.cell,o=Ha(i,a);return new t(Object.assign(n,{cell:o}))},e})(lt);Oi.className="RNN";F.serialization.registerClass(Oi);var Su=(function(r){ie(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e})(lt),ep=(function(r){ie(e,r);function e(t){var n=r.call(this,t)||this;return n.DEFAULT_ACTIVATION="tanh",n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_RECURRENT_INITIALIZER="orthogonal",n.DEFAULT_BIAS_INITIALIZER="zeros",n.units=t.units,Mr(n.units,"units"),n.activation=ho(t.activation==null?n.DEFAULT_ACTIVATION:t.activation),n.useBias=t.useBias==null?!0:t.useBias,n.kernelInitializer=Qt(t.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.recurrentInitializer=Qt(t.recurrentInitializer||n.DEFAULT_RECURRENT_INITIALIZER),n.biasInitializer=Qt(t.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.kernelRegularizer=tr(t.kernelRegularizer),n.recurrentRegularizer=tr(t.recurrentRegularizer),n.biasRegularizer=tr(t.biasRegularizer),n.kernelConstraint=Dr(t.kernelConstraint),n.recurrentConstraint=Dr(t.recurrentConstraint),n.biasConstraint=Dr(t.biasConstraint),n.dropout=mu([1,lo([0,t.dropout==null?0:t.dropout])]),n.recurrentDropout=mu([1,lo([0,t.recurrentDropout==null?0:t.recurrentDropout])]),n.dropoutFunc=t.dropoutFunc,n.stateSize=n.units,n.dropoutMask=null,n.recurrentDropoutMask=null,n}return e.prototype.build=function(t){t=wt(t),this.kernel=this.addWeight("kernel",[t[t.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){if(t=t,t.length!==2)throw new Y("SimpleRNNCell expects 2 input Tensors, got ".concat(t.length,"."));var i=t[1];t=t[0];var o=n.training==null?!1:n.training;0<a.dropout&&a.dropout<1&&a.dropoutMask==null&&(a.dropoutMask=po({ones:function(){return A.onesLike(t)},rate:a.dropout,training:o,dropoutFunc:a.dropoutFunc})),0<a.recurrentDropout&&a.recurrentDropout<1&&a.recurrentDropoutMask==null&&(a.recurrentDropoutMask=po({ones:function(){return A.onesLike(i)},rate:a.recurrentDropout,training:o,dropoutFunc:a.dropoutFunc}));var s,u=a.dropoutMask,c=a.recurrentDropoutMask;u!=null?s=pi(A.mul(t,u),a.kernel.read()):s=pi(t,a.kernel.read()),a.bias!=null&&(s=Za(s,a.bias.read())),c!=null&&(i=A.mul(i,c));var l=A.add(s,pi(i,a.recurrentKernel.read()));return a.activation!=null&&(l=a.activation.apply(l)),[l,l]})},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this),n={units:this.units,activation:fo(this.activation),useBias:this.useBias,kernelInitializer:sr(this.kernelInitializer),recurrentInitializer:sr(this.recurrentInitializer),biasInitializer:sr(this.biasInitializer),kernelRegularizer:Ot(this.kernelRegularizer),recurrentRegularizer:Ot(this.recurrentRegularizer),biasRegularizer:Ot(this.biasRegularizer),activityRegularizer:Ot(this.activityRegularizer),kernelConstraint:Ar(this.kernelConstraint),recurrentConstraint:Ar(this.recurrentConstraint),biasConstraint:Ar(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},t),n)},e})(Su);ep.className="SimpleRNNCell";F.serialization.registerClass(ep);var Rg=(function(r){ie(e,r);function e(t){return t.cell=new ep(t),r.call(this,t)||this}return e.prototype.call=function(t,n){var a=this;return F.tidy(function(){a.cell.dropoutMask!=null&&(A.dispose(a.cell.dropoutMask),a.cell.dropoutMask=null),a.cell.recurrentDropoutMask!=null&&(A.dispose(a.cell.recurrentDropoutMask),a.cell.recurrentDropoutMask=null);var i=n==null?null:n.mask,o=n==null?null:n.training,s=n==null?null:n.initialState;return r.prototype.call.call(a,t,{mask:i,training:o,initialState:s})})},e.fromConfig=function(t,n){return new t(n)},e})(Oi);Rg.className="SimpleRNN";F.serialization.registerClass(Rg);var tp=(function(r){ie(e,r);function e(t){var n=r.call(this,t)||this;if(n.DEFAULT_ACTIVATION="tanh",n.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_RECURRENT_INITIALIZER="orthogonal",n.DEFAULT_BIAS_INITIALIZER="zeros",t.resetAfter)throw new Y("GRUCell does not support reset_after parameter set to true.");return n.units=t.units,Mr(n.units,"units"),n.activation=ho(t.activation===void 0?n.DEFAULT_ACTIVATION:t.activation),n.recurrentActivation=ho(t.recurrentActivation===void 0?n.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),n.useBias=t.useBias==null?!0:t.useBias,n.kernelInitializer=Qt(t.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.recurrentInitializer=Qt(t.recurrentInitializer||n.DEFAULT_RECURRENT_INITIALIZER),n.biasInitializer=Qt(t.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.kernelRegularizer=tr(t.kernelRegularizer),n.recurrentRegularizer=tr(t.recurrentRegularizer),n.biasRegularizer=tr(t.biasRegularizer),n.kernelConstraint=Dr(t.kernelConstraint),n.recurrentConstraint=Dr(t.recurrentConstraint),n.biasConstraint=Dr(t.biasConstraint),n.dropout=mu([1,lo([0,t.dropout==null?0:t.dropout])]),n.recurrentDropout=mu([1,lo([0,t.recurrentDropout==null?0:t.recurrentDropout])]),n.dropoutFunc=t.dropoutFunc,n.implementation=t.implementation,n.stateSize=n.units,n.dropoutMask=null,n.recurrentDropoutMask=null,n}return e.prototype.build=function(t){t=wt(t);var n=t[t.length-1];this.kernel=this.addWeight("kernel",[n,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){if(t=t,t.length!==2)throw new Y("GRUCell expects 2 input Tensors (inputs, h, c), got "+"".concat(t.length,"."));var i=n.training==null?!1:n.training,o=t[1];t=t[0],0<a.dropout&&a.dropout<1&&a.dropoutMask==null&&(a.dropoutMask=po({ones:function(){return A.onesLike(t)},rate:a.dropout,training:i,count:3,dropoutFunc:a.dropoutFunc})),0<a.recurrentDropout&&a.recurrentDropout<1&&a.recurrentDropoutMask==null&&(a.recurrentDropoutMask=po({ones:function(){return A.onesLike(o)},rate:a.recurrentDropout,training:i,count:3,dropoutFunc:a.dropoutFunc}));var s=a.dropoutMask,u=a.recurrentDropoutMask,c,l,f;0<a.dropout&&a.dropout<1&&(t=A.mul(t,s[0]));var h=pi(t,a.kernel.read());a.useBias&&(h=Za(h,a.bias.read())),0<a.recurrentDropout&&a.recurrentDropout<1&&(o=A.mul(o,u[0]));var p=a.recurrentKernel.read(),d=ee(A.split(p,[2*a.units,a.units],p.rank-1),2),m=d[0],v=d[1],g=pi(o,m),y=ee(A.split(h,3,h.rank-1),3),w=y[0],b=y[1],x=y[2],S=ee(A.split(g,2,g.rank-1),2),T=S[0],N=S[1];c=a.recurrentActivation.apply(A.add(w,T)),l=a.recurrentActivation.apply(A.add(b,N));var C=pi(A.mul(l,o),v);f=a.activation.apply(A.add(x,C));var R=A.add(A.mul(c,o),A.mul(A.add(1,A.neg(c)),f));return[R,R]})},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this),n={units:this.units,activation:fo(this.activation),recurrentActivation:fo(this.recurrentActivation),useBias:this.useBias,kernelInitializer:sr(this.kernelInitializer),recurrentInitializer:sr(this.recurrentInitializer),biasInitializer:sr(this.biasInitializer),kernelRegularizer:Ot(this.kernelRegularizer),recurrentRegularizer:Ot(this.recurrentRegularizer),biasRegularizer:Ot(this.biasRegularizer),activityRegularizer:Ot(this.activityRegularizer),kernelConstraint:Ar(this.kernelConstraint),recurrentConstraint:Ar(this.recurrentConstraint),biasConstraint:Ar(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},t),n)},e})(Su);tp.className="GRUCell";F.serialization.registerClass(tp);var Og=(function(r){ie(e,r);function e(t){return t.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new tp(t),r.call(this,t)||this}return e.prototype.call=function(t,n){var a=this;return F.tidy(function(){a.cell.dropoutMask!=null&&(A.dispose(a.cell.dropoutMask),a.cell.dropoutMask=null),a.cell.recurrentDropoutMask!=null&&(A.dispose(a.cell.recurrentDropoutMask),a.cell.recurrentDropoutMask=null);var i=n==null?null:n.mask,o=n==null?null:n.training,s=n==null?null:n.initialState;return r.prototype.call.call(a,t,{mask:i,training:o,initialState:s})})},e.fromConfig=function(t,n){return n.implmentation===0&&(n.implementation=1),new t(n)},e})(Oi);Og.className="GRU";F.serialization.registerClass(Og);var yl=(function(r){ie(e,r);function e(t){var n=r.call(this,t)||this;return n.DEFAULT_ACTIVATION="tanh",n.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_RECURRENT_INITIALIZER="orthogonal",n.DEFAULT_BIAS_INITIALIZER="zeros",n.units=t.units,Mr(n.units,"units"),n.activation=ho(t.activation===void 0?n.DEFAULT_ACTIVATION:t.activation),n.recurrentActivation=ho(t.recurrentActivation===void 0?n.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),n.useBias=t.useBias==null?!0:t.useBias,n.kernelInitializer=Qt(t.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.recurrentInitializer=Qt(t.recurrentInitializer||n.DEFAULT_RECURRENT_INITIALIZER),n.biasInitializer=Qt(t.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.unitForgetBias=t.unitForgetBias,n.kernelRegularizer=tr(t.kernelRegularizer),n.recurrentRegularizer=tr(t.recurrentRegularizer),n.biasRegularizer=tr(t.biasRegularizer),n.kernelConstraint=Dr(t.kernelConstraint),n.recurrentConstraint=Dr(t.recurrentConstraint),n.biasConstraint=Dr(t.biasConstraint),n.dropout=mu([1,lo([0,t.dropout==null?0:t.dropout])]),n.recurrentDropout=mu([1,lo([0,t.recurrentDropout==null?0:t.recurrentDropout])]),n.dropoutFunc=t.dropoutFunc,n.implementation=t.implementation,n.stateSize=[n.units,n.units],n.dropoutMask=null,n.recurrentDropoutMask=null,n}return e.prototype.build=function(t){var n;t=wt(t);var a=t[t.length-1];this.kernel=this.addWeight("kernel",[a,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);var i;if(this.useBias){if(this.unitForgetBias){var o=this.biasInitializer,s=this.units;i=new(n=(function(u){ie(c,u);function c(){return u!==null&&u.apply(this,arguments)||this}return c.prototype.apply=function(l,f){var h=o.apply([s]),p=new Mh().apply([s]),d=o.apply([s*2]);return pE(pE(h,p),d)},c})(Sa),n.className="CustomInit",n)}else i=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,i,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){var i=n.training==null?!1:n.training;if(t=t,t.length!==3)throw new Y("LSTMCell expects 3 input Tensors (inputs, h, c), got "+"".concat(t.length,"."));var o=t[1],s=t[2];t=t[0],0<a.dropout&&a.dropout<1&&a.dropoutMask==null&&(a.dropoutMask=po({ones:function(){return A.onesLike(t)},rate:a.dropout,training:i,count:4,dropoutFunc:a.dropoutFunc})),0<a.recurrentDropout&&a.recurrentDropout<1&&a.recurrentDropoutMask==null&&(a.recurrentDropoutMask=po({ones:function(){return A.onesLike(o)},rate:a.recurrentDropout,training:i,count:4,dropoutFunc:a.dropoutFunc}));var u=a.dropoutMask,c=a.recurrentDropoutMask,l,f,h,p;0<a.dropout&&a.dropout<1&&(t=A.mul(t,u[0]));var d=pi(t,a.kernel.read());0<a.recurrentDropout&&a.recurrentDropout<1&&(o=A.mul(o,c[0])),d=A.add(d,pi(o,a.recurrentKernel.read())),a.useBias&&(d=Za(d,a.bias.read()));var m=ee(A.split(d,4,d.rank-1),4),v=m[0],g=m[1],y=m[2],w=m[3];l=a.recurrentActivation.apply(v),f=a.recurrentActivation.apply(g),h=A.add(A.mul(f,s),A.mul(l,a.activation.apply(y))),p=a.recurrentActivation.apply(w);var b=A.mul(p,a.activation.apply(h));return[b,b,h]})},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this),n={units:this.units,activation:fo(this.activation),recurrentActivation:fo(this.recurrentActivation),useBias:this.useBias,kernelInitializer:sr(this.kernelInitializer),recurrentInitializer:sr(this.recurrentInitializer),biasInitializer:sr(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:Ot(this.kernelRegularizer),recurrentRegularizer:Ot(this.recurrentRegularizer),biasRegularizer:Ot(this.biasRegularizer),activityRegularizer:Ot(this.activityRegularizer),kernelConstraint:Ar(this.kernelConstraint),recurrentConstraint:Ar(this.recurrentConstraint),biasConstraint:Ar(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},t),n)},e})(Su);yl.className="LSTMCell";F.serialization.registerClass(yl);var Pg=(function(r){ie(e,r);function e(t){return t.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new yl(t),r.call(this,t)||this}return e.prototype.call=function(t,n){var a=this;return F.tidy(function(){a.cell.dropoutMask!=null&&(A.dispose(a.cell.dropoutMask),a.cell.dropoutMask=null),a.cell.recurrentDropoutMask!=null&&(A.dispose(a.cell.recurrentDropoutMask),a.cell.recurrentDropoutMask=null);var i=n==null?null:n.mask,o=n==null?null:n.training,s=n==null?null:n.initialState;return r.prototype.call.call(a,t,{mask:i,training:o,initialState:s})})},e.fromConfig=function(t,n){return n.implmentation===0&&(n.implementation=1),new t(n)},e})(Oi);Pg.className="LSTM";F.serialization.registerClass(Pg);var rp=(function(r){ie(e,r);function e(t){var n=r.call(this,t)||this;return n.cells=t.cells,n}return Object.defineProperty(e.prototype,"stateSize",{get:function(){var t,n,a=[];try{for(var i=le(this.cells.slice().reverse()),o=i.next();!o.done;o=i.next()){var s=o.value;Array.isArray(s.stateSize)?a.push.apply(a,Xe([],ee(s.stateSize),!1)):a.push(s.stateSize)}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return a},enumerable:!1,configurable:!0}),e.prototype.call=function(t,n){var a=this;return F.tidy(function(){var i,o,s,u;t=t;var c=t.slice(1),l=[];try{for(var f=le(a.cells.slice().reverse()),h=f.next();!h.done;h=f.next()){var p=h.value;Array.isArray(p.stateSize)?l.push(c.splice(0,p.stateSize.length)):l.push(c.splice(0,1))}}catch(b){i={error:b}}finally{try{h&&!h.done&&(o=f.return)&&o.call(f)}finally{if(i)throw i.error}}l.reverse();for(var d=[],m,v=0;v<a.cells.length;++v){var p=a.cells[v];c=l[v],v===0?m=[t[0]].concat(c):m=[m[0]].concat(c),m=p.call(m,n),d.push(m.slice(1))}c=[];try{for(var g=le(d.slice().reverse()),y=g.next();!y.done;y=g.next()){var w=y.value;c.push.apply(c,Xe([],ee(w),!1))}}catch(b){s={error:b}}finally{try{y&&!y.done&&(u=g.return)&&u.call(g)}finally{if(s)throw s.error}}return[m[0]].concat(c)})},e.prototype.build=function(t){vm(t)&&(t=t[0]),t=t;var n;this.cells.forEach(function(a,i){es("RNNCell_".concat(i),function(){a.build(t),Array.isArray(a.stateSize)?n=a.stateSize[0]:n=a.stateSize,t=[t[0],n]})}),this.built=!0},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this),n=function(o){return{className:o.getClassName(),config:o.getConfig()}},a=this.cells.map(n),i={cells:a};return Object.assign(Object.assign({},t),i)},e.fromConfig=function(t,n,a){var i,o;a===void 0&&(a={});var s=[];try{for(var u=le(n.cells),c=u.next();!c.done;c=u.next()){var l=c.value;s.push(Ha(l,a))}}catch(f){i={error:f}}finally{try{c&&!c.done&&(o=u.return)&&o.call(u)}finally{if(i)throw i.error}}return new t({cells:s})},Object.defineProperty(e.prototype,"trainableWeights",{get:function(){var t,n;if(!this.trainable)return[];var a=[];try{for(var i=le(this.cells),o=i.next();!o.done;o=i.next()){var s=o.value;a.push.apply(a,Xe([],ee(s.trainableWeights),!1))}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return a},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){var t,n,a,i,o=[];try{for(var s=le(this.cells),u=s.next();!u.done;u=s.next()){var c=u.value;o.push.apply(o,Xe([],ee(c.nonTrainableWeights),!1))}}catch(p){t={error:p}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}if(!this.trainable){var l=[];try{for(var f=le(this.cells),h=f.next();!h.done;h=f.next()){var c=h.value;l.push.apply(l,Xe([],ee(c.trainableWeights),!1))}}catch(p){a={error:p}}finally{try{h&&!h.done&&(i=f.return)&&i.call(f)}finally{if(a)throw a.error}}return l.concat(o)}return o},enumerable:!1,configurable:!0}),e.prototype.getWeights=function(){var t,n,a=[];try{for(var i=le(this.cells),o=i.next();!o.done;o=i.next()){var s=o.value;a.push.apply(a,Xe([],ee(s.weights),!1))}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return mm(a)},e.prototype.setWeights=function(t){var n,a,i=[];try{for(var o=le(this.cells),s=o.next();!s.done;s=o.next())for(var u=s.value,c=u.weights.length,l=t.splice(c),f=0;f<u.weights.length;++f)i.push([u.weights[f],l[f]])}catch(h){n={error:h}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}zm(i)},e})(Su);rp.className="StackedRNNCells";F.serialization.registerClass(rp);function po(r){var e=r.ones,t=r.rate,n=r.training,a=n===void 0?!1:n,i=r.count,o=i===void 0?1:i,s=r.dropoutFunc,u=function(){return s!=null?s(e(),t):kT(e(),t)},c=function(){return hl(u,e,a)};if(!o||o<=1)return A.keep(c().clone());var l=Array(o).fill(void 0).map(c);return l.map(function(f){return A.keep(f.clone())})}var RJ=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(r);a<n.length;a++)e.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(r,n[a])&&(t[n[a]]=r[n[a]]);return t};(function(r){ie(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e})(Su);var $I=(function(r){ie(e,r);function e(t){var n=this;if(t.unroll)throw new ct("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(t.cell))throw new ct("It is not possible at the moment to stack convolutional cells.");return n=r.call(this,t)||this,n.inputSpec=[new Nr({ndim:5})],n}return e.prototype.call=function(t,n){var a=this;return A.tidy(function(){if(a.cell.dropoutMask!=null&&(A.dispose(a.cell.dropoutMask),a.cell.dropoutMask=null),a.cell.recurrentDropoutMask!=null&&(A.dispose(a.cell.recurrentDropoutMask),a.cell.recurrentDropoutMask=null),n&&n.constants)throw new Y("ConvRNN2D cell does not support constants");var i=n==null?null:n.mask,o=n==null?null:n.training,s=n==null?null:n.initialState;return r.prototype.call.call(a,t,{mask:i,training:o,initialState:s})})},e.prototype.computeOutputShape=function(t){var n=this.computeSingleOutputShape(t);return this.returnSequences||(n=Xe([n[0]],ee(n.slice(2)),!1)),this.returnState&&(n=Xe([n],ee(Array(2).fill(Xe([t[0]],ee(n.slice(-3)),!1))),!1)),n},e.prototype.getInitialState=function(t){var n=this;return A.tidy(function(){var a=n.cell.stateSize,i=t.shape,o=n.computeSingleOutputShape(i),s=Xe([o[0]],ee(o.slice(2)),!1),u=A.zeros(s);return Array.isArray(a)?Array(a.length).fill(u):[u]})},e.prototype.resetStates=function(t,n){var a=this;n===void 0&&(n=!1),A.tidy(function(){if(!a.stateful)throw new so("Cannot call resetStates() on an RNN Layer that is not stateful.");var i=a.inputSpec[0].shape,o=a.computeSingleOutputShape(i),s=Xe([o[0]],ee(o.slice(2)),!1),u=i[0];if(u==null)throw new Y("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(a.getStates()==null)Array.isArray(a.cell.stateSize)?a.states_=a.cell.stateSize.map(function(){return A.zeros(s)}):a.states_=[A.zeros(s)];else if(t==null)A.dispose(a.states_),a.keptStates!=null&&(A.dispose(a.keptStates),a.keptStates=[]),Array.isArray(a.cell.stateSize)?a.states_=a.cell.stateSize.map(function(){return A.zeros(s)}):a.states_[0]=A.zeros(s);else{if(Array.isArray(t)||(t=[t]),t.length!==a.states_.length)throw new Y("Layer ".concat(a.name," expects ").concat(a.states_.length," state(s), ")+"but it received ".concat(t.length," state value(s). Input ")+"received: ".concat(t));n?a.keptStates.push(a.states_.slice()):A.dispose(a.states_);for(var c=0;c<a.states_.length;++c){var l=t[c],f=s;if(!F.util.arraysEqual(l.shape,f))throw new Y("State ".concat(c," is incompatible with layer ").concat(a.name,": ")+"expected shape=".concat(f,", received shape=").concat(l.shape));a.states_[c]=l}}a.states_=a.states_.map(function(h){return A.keep(h.clone())})})},e.prototype.computeSingleOutputShape=function(t){var n=this.cell,a=n.dataFormat,i=n.filters,o=n.kernelSize,s=n.padding,u=n.strides,c=n.dilationRate,l=a==="channelsFirst",f=t[l?3:2],h=t[l?4:3],p=qa(f,o[0],s,u[0],c[0]),d=qa(h,o[1],s,u[1],c[1]),m=Xe(Xe([],ee(t.slice(0,2)),!1),ee(l?[i,p,d]:[p,d,i]),!1);return m},e})(Oi);$I.className="ConvRNN2D";var np=(function(r){ie(e,r);function e(t){var n=this,a=t.filters,i=t.kernelSize,o=t.strides,s=t.padding,u=t.dataFormat,c=t.dilationRate;return n=r.call(this,Object.assign(Object.assign({},t),{units:a}))||this,n.filters=a,Mr(n.filters,"filters"),n.kernelSize=vu(i,2,"kernelSize"),n.kernelSize.forEach(function(l){return Mr(l,"kernelSize")}),n.strides=vu(o||1,2,"strides"),n.strides.forEach(function(l){return Mr(l,"strides")}),n.padding=s||"valid",ea(n.padding),n.dataFormat=u||"channelsLast",gr(n.dataFormat),n.dilationRate=vu(c||1,2,"dilationRate"),n.dilationRate.forEach(function(l){return Mr(l,"dilationRate")}),n}return e.prototype.build=function(t){var n;t=wt(t);var a=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[a]==null)throw new Y("The channel dimension of the input should be defined. "+"Found ".concat(t[a]));var i=t[a],o=4,s=this.kernelSize.concat([i,this.filters*o]);this.kernel=this.addWeight("kernel",s,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);var u=this.kernelSize.concat([this.filters,this.filters*o]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",u,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){var c=void 0;if(this.unitForgetBias){var l=this.biasInitializer,f=this.filters;c=new(n=(function(h){ie(p,h);function p(){return h!==null&&h.apply(this,arguments)||this}return p.prototype.apply=function(d,m){var v=l.apply([f]),g=A.ones([f]),y=l.apply([f*2]);return _m([v,g,y])},p})(Sa),n.className="CustomInit",n)}else c=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*o],null,c,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0},e.prototype.call=function(t,n){var a=this;return A.tidy(function(){if(t.length!==3)throw new Y("ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got "+"".concat(t.length,"."));var i=n.training||!1,o=t[0],s=t[1],u=t[2],c=4;0<a.dropout&&a.dropout<1&&a.dropoutMask==null&&(a.dropoutMask=po({ones:function(){return A.onesLike(o)},rate:a.dropout,training:i,count:c,dropoutFunc:a.dropoutFunc}));var l=a.dropoutMask,f=function(ce,pe,xe){return!pe||!pe[xe]?ce:A.mul(pe[xe],ce)},h=f(o,l,0),p=f(o,l,1),d=f(o,l,2),m=f(o,l,3);0<a.recurrentDropout&&a.recurrentDropout<1&&a.recurrentDropoutMask==null&&(a.recurrentDropoutMask=po({ones:function(){return A.onesLike(s)},rate:a.recurrentDropout,training:i,count:c,dropoutFunc:a.dropoutFunc}));var v=a.recurrentDropoutMask,g=f(s,v,0),y=f(s,v,1),w=f(s,v,2),b=f(s,v,3),x=3,S=ee(A.split(a.kernel.read(),c,x),4),T=S[0],N=S[1],C=S[2],R=S[3],_=ee(a.useBias?A.split(a.bias.read(),c):[null,null,null,null],4),P=_[0],$=_[1],z=_[2],L=_[3];h=a.inputConv(h,T,P,a.padding),p=a.inputConv(p,N,$,a.padding),d=a.inputConv(d,C,z,a.padding),m=a.inputConv(m,R,L,a.padding);var B=ee(A.split(a.recurrentKernel.read(),c,x),4),G=B[0],X=B[1],Z=B[2],V=B[3];g=a.recurrentConv(g,G),y=a.recurrentConv(y,X),w=a.recurrentConv(w,Z),b=a.recurrentConv(b,V);var j=a.recurrentActivation.apply(A.add(h,g)),re=a.recurrentActivation.apply(A.add(p,y)),te=A.add(A.mul(re,u),A.mul(j,a.activation.apply(A.add(d,w)))),oe=A.mul(a.recurrentActivation.apply(A.add(m,b)),a.activation.apply(te));return[oe,oe,te]})},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this);t.units;var n=RJ(t,["units"]),a={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},n),a)},e.prototype.inputConv=function(t,n,a,i){var o=A.conv2d(t,n,this.strides,i||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return a?Za(o,a,this.dataFormat):o},e.prototype.recurrentConv=function(t,n){var a=1;return A.conv2d(t,n,a,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")},e})(yl);np.className="ConvLSTM2DCell";A.serialization.registerClass(np);var Mg=(function(r){ie(e,r);function e(t){var n=new np(t);return r.call(this,Object.assign(Object.assign({},t),{cell:n}))||this}return e.fromConfig=function(t,n){return new t(n)},e})($I);Mg.className="ConvLSTM2D";A.serialization.registerClass(Mg);var ap=(function(r){ie(e,r);function e(t){var n=r.call(this,t)||this;return n.rate=Math.max(Math.min(t.rate,1),0),n.noiseShape=t.noiseShape,n.seed=t.seed,n.supportsMasking=!0,n}return e.prototype.getNoiseShape=function(t){if(this.noiseShape==null)return this.noiseShape;for(var n=t.shape,a=[],i=0;i<this.noiseShape.length;++i)a.push(this.noiseShape[i]==null?n[i]:this.noiseShape[i]);return a},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){a.invokeCallHook(t,n);var i=tt(t);if(0<a.rate&&a.rate<1){var o=n.training==null?!1:n.training,s=a.getNoiseShape(i),u=hl(function(){return kT(i,a.rate,s,a.seed)},function(){return i},o);return u}return t})},e.prototype.getConfig=function(){var t={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.prototype.dispose=function(){return r.prototype.dispose.call(this)},e})(lt);ap.className="Dropout";F.serialization.registerClass(ap);var Bg=(function(r){ie(e,r);function e(t){var n=r.call(this,t)||this;return n.inputSpec=[{ndim:3}],n}return e.prototype.getNoiseShape=function(t){var n=t.shape;return[n[0],1,n[2]]},e})(ap);Bg.className="SpatialDropout1D";F.serialization.registerClass(Bg);var Lg=(function(r){ie(e,r);function e(t){var n=r.call(this,t)||this;if(n.activation=null,n.useBias=!0,n.kernel=null,n.bias=null,n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_BIAS_INITIALIZER="zeros",t.batchInputShape==null&&t.inputShape==null&&t.inputDim!=null){var a=null;t.batchSize!=null&&(a=t.batchSize),n.batchInputShape=[a,t.inputDim]}return n.units=t.units,Mr(n.units,"units"),n.activation=ho(t.activation),t.useBias!=null&&(n.useBias=t.useBias),n.kernelInitializer=Qt(t.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.biasInitializer=Qt(t.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.kernelConstraint=Dr(t.kernelConstraint),n.biasConstraint=Dr(t.biasConstraint),n.kernelRegularizer=tr(t.kernelRegularizer),n.biasRegularizer=tr(t.biasRegularizer),n.activityRegularizer=tr(t.activityRegularizer),n.supportsMasking=!0,n.inputSpec=[{minNDim:2}],n}return e.prototype.build=function(t){var n;t=wt(t);var a=t[t.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[a,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:(n={},n[-1]=a,n)}],this.built=!0},e.prototype.computeOutputShape=function(t){t=wt(t);var n=t.slice();return n[n.length-1]=this.units,n},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){a.invokeCallHook(t,n);var i=tt(t),o=vT(a.activation.getClassName()),s;return o!=null?s=pi(i,a.kernel.read(),o,a.bias?a.bias.read():null):(s=pi(i,a.kernel.read()),a.bias!=null&&(s=Za(s,a.bias.read())),a.activation!=null&&(s=a.activation.apply(s))),s})},e.prototype.getConfig=function(){var t={units:this.units,activation:fo(this.activation),useBias:this.useBias,kernelInitializer:sr(this.kernelInitializer),biasInitializer:sr(this.biasInitializer),kernelRegularizer:Ot(this.kernelRegularizer),biasRegularizer:Ot(this.biasRegularizer),activityRegularizer:Ot(this.activityRegularizer),kernelConstraint:Ar(this.kernelConstraint),biasConstraint:Ar(this.biasConstraint)},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e})(lt);Lg.className="Dense";F.serialization.registerClass(Lg);var zg=(function(r){ie(e,r);function e(t){var n=this;return t=t||{},n=r.call(this,t)||this,n.inputSpec=[{minNDim:3}],n.dataFormat=t.dataFormat,n}return e.prototype.computeOutputShape=function(t){var n,a;t=wt(t);try{for(var i=le(t.slice(1)),o=i.next();!o.done;o=i.next()){var s=o.value;if(s==null)throw new Y('The shape of the input to "Flatten" is not fully defined '+"(got ".concat(t.slice(1),"). Make sure to pass a complete ")+'"input_shape" or "batch_input_shape" argument to the first layer in your model.')}}catch(u){n={error:u}}finally{try{o&&!o.done&&(a=i.return)&&a.call(i)}finally{if(n)throw n.error}}return[t[0],co(t,1)]},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){a.invokeCallHook(t,n);var i=tt(t);if(a.dataFormat==="channelsFirst"&&i.rank>1){for(var o=[0],s=2;s<i.rank;++s)o.push(s);o.push(1),i=F.transpose(i,o)}return FK(i)})},e.prototype.getConfig=function(){var t={};this.dataFormat!=null&&(t.dataFormat=this.dataFormat);var n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e})(lt);zg.className="Flatten";F.serialization.registerClass(zg);var $g=(function(r){ie(e,r);function e(t){var n=r.call(this,t)||this;return n.supportsMasking=!0,n.activation=ho(t.activation),n}return e.prototype.call=function(t,n){var a=this;return F.tidy(function(){a.invokeCallHook(t,n);var i=tt(t);return a.activation.apply(i)})},e.prototype.getConfig=function(){var t={activation:fo(this.activation)},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e})(lt);$g.className="Activation";F.serialization.registerClass($g);var Wg=(function(r){ie(e,r);function e(t){var n=r.call(this,t)||this;return n.n=t.n,n.inputSpec=[{ndim:2}],n}return e.prototype.computeOutputShape=function(t){return[t[0],this.n,t[1]]},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){return t=tt(t),DK(t,a.n)})},e.prototype.getConfig=function(){var t={n:this.n},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e})(lt);Wg.className="RepeatVector";F.serialization.registerClass(Wg);var Gg=(function(r){ie(e,r);function e(t){var n=r.call(this,t)||this;n.targetShape=t.targetShape;for(var a=0;a<n.targetShape.length;++a)n.isUnknown(n.targetShape[a])&&(n.targetShape[a]=null);return n}return e.prototype.isUnknown=function(t){return t<0||t==null},e.prototype.fixUnknownDimension=function(t,n){for(var a="Total size of new array must be unchanged.",i=n.slice(),o=1,s=null,u=0;u<i.length;++u){var c=i[u];if(this.isUnknown(c))if(s===null)s=u;else throw new Y("Can only specifiy one unknown dimension.");else o*=c}var l=co(t);if(s!==null){if(o===0||l%o!==0)throw new Y(a);i[s]=l/o}else if(l!==o)throw new Y(a);return i},e.prototype.computeOutputShape=function(t){for(var n=!1,a=0;a<t.length;++a)if(this.isUnknown(t[a])){n=!0;break}return n?t.slice(0,1).concat(this.targetShape):t.slice(0,1).concat(this.fixUnknownDimension(t.slice(1),this.targetShape))},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){a.invokeCallHook(t,n);var i=tt(t),o=i.shape,s=o.slice(0,1).concat(a.fixUnknownDimension(o.slice(1),a.targetShape));return F.reshape(i,s)})},e.prototype.getConfig=function(){var t={targetShape:this.targetShape},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e})(lt);Gg.className="Reshape";F.serialization.registerClass(Gg);var Vg=(function(r){ie(e,r);function e(t){var n=r.call(this,t)||this;if(t.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(t.dims))throw new Error("Permute constructor requires `dims` to be an Array, but received "+"".concat(t.dims," instead."));var a=Ka(1,t.dims.length+1);if(!F.util.arraysEqual(t.dims.slice().sort(),a))throw new Error("Invalid permutation `dims`: "+JSON.stringify(t.dims)+" `dims` must contain consecutive integers starting from 1.");return n.dims=t.dims,n.dimsIncludingBatch=[0].concat(n.dims),n.inputSpec=[new Nr({ndim:n.dims.length+1})],n}return e.prototype.computeOutputShape=function(t){t=wt(t);var n=t.slice();return this.dims.forEach(function(a,i){n[i+1]=t[a]}),n},e.prototype.call=function(t,n){return F.transpose(tt(t),this.dimsIncludingBatch)},e.prototype.getConfig=function(){var t={dims:this.dims},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e})(lt);Vg.className="Permute";F.serialization.registerClass(Vg);var Ug=(function(r){ie(e,r);function e(t){var n=r.call(this,t??{})||this;return n.supportsMasking=!0,t!=null?n.maskValue=t.maskValue==null?0:t.maskValue:n.maskValue=0,n}return e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this),n={maskValue:this.maskValue};return Object.assign(n,t),n},e.prototype.computeMask=function(t,n){var a=tt(t),i=-1;return F.any(F.notEqual(a,this.maskValue),i)},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){a.invokeCallHook(t,n);var i=tt(t),o=-1,s=!0,u=F.any(F.notEqual(i,a.maskValue),o,s),c=F.mul(i,F.cast(u,i.dtype));return c})},e})(lt);Ug.className="Masking";F.serialization.registerClass(Ug);var Hg=(function(r){ie(e,r);function e(t){var n=r.call(this,t)||this;if(n.embeddings=null,n.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",t.batchInputShape==null&&t.inputShape==null){var a=null;t.batchSize!=null&&(a=t.batchSize),t.inputLength==null?n.batchInputShape=[a,null]:n.batchInputShape=[a].concat(It(t.inputLength))}return n.inputDim=t.inputDim,Mr(n.inputDim,"inputDim"),n.outputDim=t.outputDim,Mr(n.outputDim,"outputDim"),n.embeddingsInitializer=Qt(t.embeddingsInitializer||n.DEFAULT_EMBEDDINGS_INITIALIZER),n.embeddingsRegularizer=tr(t.embeddingsRegularizer),n.activityRegularizer=tr(t.activityRegularizer),n.embeddingsConstraint=Dr(t.embeddingsConstraint),n.maskZero=t.maskZero,n.supportsMasking=t.maskZero,n.inputLength=t.inputLength,n}return e.prototype.build=function(t){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0},e.prototype.warnOnIncompatibleInputShape=function(t){},e.prototype.computeMask=function(t,n){var a=this;return F.tidy(function(){return a.maskZero?(t=tt(t),F.notEqual(t,F.zerosLike(t))):null})},e.prototype.computeOutputShape=function(t){if(t=wt(t),this.inputLength==null)return Xe(Xe([],ee(t),!1),[this.outputDim],!1);var n=It(this.inputLength);if(n.length!==t.length-1)throw new Y('"inputLength" is '.concat(this.inputLength,", but received ")+"input shape has shape ".concat(t));for(var a=0,i=0;i<n.length;++i){var o=n[i],s=t[i+1];if(o!=null&&s!=null&&o!==s)throw new Y('"inputLength" is '.concat(this.inputLength,", but received ")+"input shape has shape ".concat(t));o==null&&(n[a]=s),a++}return Xe(Xe([t[0]],ee(n),!1),[this.outputDim],!1)},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){a.invokeCallHook(t,n);var i=tt(t);i.dtype!=="int32"&&(i=hi(i,"int32"));var o=xT(a.embeddings.read(),F.reshape(i,[i.size]));return F.reshape(o,wt(a.computeOutputShape(i.shape)))})},e.prototype.getConfig=function(){var t={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:sr(this.embeddingsInitializer),embeddingsRegularizer:Ot(this.embeddingsRegularizer),activityRegularizer:Ot(this.activityRegularizer),embeddingsConstraint:Ar(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e})(lt);Hg.className="Embedding";F.serialization.registerClass(Hg);var hs=(function(r){ie(e,r);function e(t){var n=r.call(this,t||{})||this;return n.supportsMasking=!0,n}return e.prototype.mergeFunction=function(t){throw new ct},e.prototype.computeElementwiseOpOutputShape=function(t,n){if(t==null||n==null)return null;if(t.length<n.length)return this.computeElementwiseOpOutputShape(n,t);if(n.length===0)return t;for(var a=t.slice(0,t.length-n.length),i=0;i<n.length;++i){var o=t[t.length-n.length+i],s=n[i];if(o==null||s==null||o<0||s<0)a.push(null);else if(o===1)a.push(s);else if(s===1)a.push(o);else{if(o!==s)throw new Y("Operands could not be broadcast together with shapes "+JSON.stringify(t)+" "+JSON.stringify(n));a.push(o)}}return a},e.prototype.build=function(t){var n,a;if(Array.isArray(t)&&!Array.isArray(t[0])&&(t=[wt(t)]),t=t,t.length<2)throw new Y("A merge layer should be called on an Array of at least 2 inputs."+" Got ".concat(t.length," input(s)."));var i=[];try{for(var o=le(t),s=o.next();!s.done;s=o.next()){var u=s.value;u!=null&&u[0]!==null&&i.push(u[0])}}catch(h){n={error:h}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}if(i=uo(i),i.length>1)throw new Y("Can not merge tensors with different batch sizes. "+"Got tensors with shapes: ".concat(JSON.stringify(t),"."));for(var c=t[0]==null?null:t[0].slice(1),l=1;l<t.length;++l){var u=t[l]==null?null:t[l].slice(1);c=this.computeElementwiseOpOutputShape(c,u)}var f=t.map(function(h){return h.length});t.indexOf(null)===-1&&uo(f).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){var i,o,s,u;if(t=t,a.reshapeRequired){var c=[],l=t.map(function($){return $.rank});if(l.indexOf(null)===-1){var f=lo(l);try{for(var h=le(t),p=h.next();!p.done;p=h.next()){for(var d=p.value,m=d.rank,v=0;v<f-m;++v)d=ll(d,1);c.push(d)}}catch($){i={error:$}}finally{try{p&&!p.done&&(o=h.return)&&o.call(h)}finally{if(i)throw i.error}}return a.mergeFunction(c)}else{var g=!1;try{for(var y=le(t),w=y.next();!w.done;w=y.next()){var d=w.value,m=d.rank;if(m==null){var b=d.shape,x=b[0],S=b.slice(1).concat([x]),T=A.reshape(d,[x].concat(co(b.slice(1))));T=A.transpose(T,[1,0]),T=A.reshape(T,S),c.push(T),g=!0}else if(m>1){var N=Ka(1,m).concat([0]);c.push(A.transpose(d,N)),g=!0}else c.push(d)}}catch($){s={error:$}}finally{try{w&&!w.done&&(u=y.return)&&u.call(y)}finally{if(s)throw s.error}}var C=a.mergeFunction(c),R=C.rank;if(g){if(R==null){var _=C.shape,P=_.length,x=_[P-1],S=[x].concat(_.slice(0,_.length-1));C=A.reshape(A.transpose(A.reshape(C,[-1,x]),[1,0]),S)}else if(R>1){var N=[R-1].concat(Ka(0,R-1));C=A.transpose(C,N)}}return C}}else return a.mergeFunction(t)})},e.prototype.computeOutputShape=function(t){var n,a;t=t;var i;t[0]==null?i=null:i=t[0].slice(1);for(var o=1;o<t.length;++o){var s=t[o]==null?null:t[o].slice(1);i=this.computeElementwiseOpOutputShape(i,s)}var u=[];try{for(var c=le(t),l=c.next();!l.done;l=c.next()){var s=l.value;s!=null&&s[0]!==null&&u.push(s[0])}}catch(f){n={error:f}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(n)throw n.error}}return u=uo(u),u.length===1?i=u.concat(i):i=[null].concat(i),i},e.prototype.computeMask=function(t,n){return A.tidy(function(){if(n==null)return null;if(!Array.isArray(n))throw new Y("`mask` should be an Array");if(!Array.isArray(t))throw new Y("`inputs` should be an Array");if(n.length!==t.length)throw new Y("The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths "+"(".concat(t.length," vs ").concat(n.length,")"));if(n.every(function(o){return o==null}))return null;n=n.map(function(o){return o==null?o:A.expandDims(o,0)});for(var a=n[0],i=1;i<n.length-1;++i)a=A.logicalAnd(a,n[i]);return a})},e})(lt),qg=(function(r){ie(e,r);function e(t){return r.call(this,t)||this}return e.prototype.mergeFunction=function(t){return F.tidy(function(){for(var n=t[0].clone(),a=1;a<t.length;++a)n=A.add(n,t[a]);return n})},e})(hs);qg.className="Add";F.serialization.registerClass(qg);var Kg=(function(r){ie(e,r);function e(t){return r.call(this,t)||this}return e.prototype.mergeFunction=function(t){return F.tidy(function(){for(var n=t[0].clone(),a=1;a<t.length;++a)n=A.mul(n,t[a]);return n})},e})(hs);Kg.className="Multiply";F.serialization.registerClass(Kg);var jg=(function(r){ie(e,r);function e(t){return r.call(this,t)||this}return e.prototype.mergeFunction=function(t){return F.tidy(function(){for(var n=t[0].clone(),a=1;a<t.length;++a)n=A.add(n,t[a]);return A.mul(1/t.length,n)})},e})(hs);jg.className="Average";F.serialization.registerClass(jg);var Xg=(function(r){ie(e,r);function e(t){return r.call(this,t)||this}return e.prototype.mergeFunction=function(t){return F.tidy(function(){for(var n=t[0],a=1;a<t.length;++a)n=A.maximum(n,t[a]);return n})},e})(hs);Xg.className="Maximum";F.serialization.registerClass(Xg);var Yg=(function(r){ie(e,r);function e(t){return r.call(this,t)||this}return e.prototype.mergeFunction=function(t){return F.tidy(function(){for(var n=t[0],a=1;a<t.length;++a)n=A.minimum(n,t[a]);return n})},e})(hs);Yg.className="Minimum";F.serialization.registerClass(Yg);var Zg=(function(r){ie(e,r);function e(t){var n=r.call(this,t)||this;return n.DEFAULT_AXIS=-1,t==null&&(t={}),n.axis=t.axis==null?n.DEFAULT_AXIS:t.axis,n.supportsMasking=!0,n.reshapeRequired=!1,n}return e.prototype.build=function(t){var n,a,i,o;if(!(Array.isArray(t)&&Array.isArray(t[0]))||t.length===1)throw new Y("A `Concatenate` layer should be called on a list of at least 2 inputs");t=t;var s=!0;try{for(var u=le(t),c=u.next();!c.done;c=u.next()){var l=c.value;if(l!=null){s=!1;break}}}catch(g){n={error:g}}finally{try{c&&!c.done&&(a=u.return)&&a.call(u)}finally{if(n)throw n.error}}if(!s){for(var f=[],h=0;h<t.length;++h){var p=t[h].slice();p.splice(this.axis,1);var d=!1;try{for(var m=(i=void 0,le(f)),v=m.next();!v.done;v=m.next()){var l=v.value;if(F.util.arraysEqual(l,p)){d=!0;break}}}catch(g){i={error:g}}finally{try{v&&!v.done&&(o=m.return)&&o.call(m)}finally{if(i)throw i.error}}d||f.push(p)}if(f.length>1)throw new Y("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(t))}},e.prototype.mergeFunction=function(t){var n=this;return F.tidy(function(){return _m(t,n.axis)})},e.prototype.computeOutputShape=function(t){var n,a;if(!(Array.isArray(t)&&Array.isArray(t[0])))throw new Y("A `Concatenate` layer should be called on a list of inputs.");var i=t,o=i[0].slice(),s=this.axis<0?o.length+this.axis:this.axis;try{for(var u=le(i.slice(1)),c=u.next();!c.done;c=u.next()){var l=c.value;if(o[s]==null||l[s]==null){o[s]=null;break}o[s]+=l[s]}}catch(f){n={error:f}}finally{try{c&&!c.done&&(a=u.return)&&a.call(u)}finally{if(n)throw n.error}}return o},e.prototype.computeMask=function(t,n){var a=this;if(n==null)return null;if(!Array.isArray(n))throw new Y("`mask` should be an array for Concatenate");if(!Array.isArray(t))throw new Y("`inputs` should be an array for Concatenate");if(n.length!==t.length)throw new Y("Mismatch in the length of mask (".concat(n.length,") ")+"and the legnth of inputs (".concat(t.length,")"));return A.tidy(function(){var i=!0;if(n.forEach(function(c){if(c!=null){i=!1;return}}),i)return null;for(var o=[],s=0;s<t.length;++s)n[s]==null?o.push(A.cast(A.onesLike(t[s]),"bool")):n[s].rank<t[s].rank?o.push(A.expandDims(n[s],-1)):o.push(n[s]);var u=A.concat(o,a.axis);return A.all(u,-1,!1)})},e.prototype.getConfig=function(){var t={axis:this.axis},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e})(hs);Zg.className="Concatenate";F.serialization.registerClass(Zg);function Jc(r,e){for(;r<0;)r+=e;return r}function OJ(r,e,t){if(r.shape.length>3||e.shape.length>3)throw new ct("batchDot is not implemented for tensors of 4D or higher rank yet");if(A.util.assert(r.shape.length>=2,function(){return"batchDot requires the rank of x to be >= 2, "+"but got ".concat(r.shape.length)}),A.util.assert(r.shape.length>=2,function(){return"batchDot requires the rank of y to be >= 2, "+"but got ".concat(e.shape.length)}),typeof t=="number"&&(t=[t,t]),r.dtype==="complex64"||e.dtype==="complex64")throw new ct("batchDot is not implemented for complex64-type Tensors yet.");var n=r.shape.length,a=e.shape.length;t==null&&(t=[n-1,a-2]);var i=t;return A.tidy(function(){var o;if(n>a){o=n-a;for(var s=[],u=0;u<o;++u)s.push(1);e=A.reshape(e,e.shape.concat(s))}else if(a>n){o=a-n;for(var s=[],u=0;u<o;++u)s.push(1);r=A.reshape(r,r.shape.concat(s))}else o=0;var c;if(r.shape.length===2&&e.shape.length===2)i[0]===i[1]?c=A.sum(A.mul(r,e),i[0]):c=A.sum(A.mul(A.transpose(r,[1,0]),e),i[1]);else{var l=i[0]!==r.shape.length-1,f=i[1]===e.shape.length-1;c=A.matMul(r,e,l,f)}if(o>0){var h=void 0;n>a?h=n+a-3:h=n-1;for(var p=[],u=h;u<h+o;++u)p.push(u);c=A.squeeze(c,p)}return c.shape.length===1&&(c=A.expandDims(c,1)),c})}var Jg=(function(r){ie(e,r);function e(t){var n=r.call(this,t)||this;return n.axes=t.axes,n.normalize=t.normalize==null?!1:t.normalize,n.supportsMasking=!0,n.reshapeRequired=!1,n}return e.prototype.build=function(t){A.util.assert(Array.isArray(t)&&t.length===2&&Array.isArray(t[0])&&Array.isArray(t[1]),function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."});var n=t[0],a=t[1];if(n.length>3||a.length>3)throw new ct("Dot layer does not support tensors of 4D or higher rank yet.");var i=this.interpretAxes(n,a);if(n[i[0]]!==a[i[1]])throw new Y("Dimension incompatibility: "+"".concat(n[i[0]]," !== ").concat(a[i[1]]))},e.prototype.mergeFunction=function(t){if(t.length!==2)throw new Y("A `Dot` layer must be called on exactly 2 inputs, "+"but received ".concat(t.length," input(s)."));var n=t[0],a=t[1],i;return Array.isArray(this.axes)?i=this.axes.map(function(o,s){return Jc(o,t[s].shape.length)}):i=[Jc(this.axes,n.shape.length),Jc(this.axes,a.shape.length)],this.normalize&&(n=Ah(n,i[0]),a=Ah(a,i[1])),OJ(n,a,i)},e.prototype.interpretAxes=function(t,n){var a;return Array.isArray(this.axes)?a=this.axes:a=[Jc(this.axes,t.length),Jc(this.axes,n.length)],a},e.prototype.computeOutputShape=function(t){A.util.assert(Array.isArray(t)&&t.length===2&&Array.isArray(t[0])&&Array.isArray(t[1]),function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."});var n=t[0].slice(),a=t[1].slice();if(n.length>3||a.length>3)throw new ct("Dot layer does not support tensors of 4D or higher rank yet.");var i=this.interpretAxes(n,a);n.splice(i[0],1),a.splice(i[1],1),a.splice(0,1);var o=n.concat(a);return o.length===1&&o.push(1),o},e.prototype.computeMask=function(t,n){return null},e.prototype.getConfig=function(){var t={axes:this.axes,normalize:this.normalize},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e})(hs);Jg.className="Dot";F.serialization.registerClass(Jg);var Qg=(function(r){ie(e,r);function e(t){var n=r.call(this,t)||this;return n.supportsMasking=!0,n.stddev=t.stddev,n}return e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this),n={stddev:this.stddev};return Object.assign(n,t),n},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){a.invokeCallHook(t,n);var i=tt(t),o=function(){return F.add(Ph(i.shape,0,a.stddev),i)},s=hl(o,function(){return i},n.training||!1);return s})},e})(lt);Qg.className="GaussianNoise";F.serialization.registerClass(Qg);var ey=(function(r){ie(e,r);function e(t){var n=r.call(this,t)||this;return n.supportsMasking=!0,n.rate=t.rate,n}return e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this),n={rate:this.rate};return Object.assign(n,t),n},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){a.invokeCallHook(t,n);var i=tt(t);if(a.rate>0&&a.rate<1){var o=function(){var s=Math.sqrt(a.rate/(1-a.rate));return F.mul(i,Ph(i.shape,1,s))};return hl(o,function(){return i},n.training||!1)}return i})},e})(lt);ey.className="GaussianDropout";F.serialization.registerClass(ey);var ty=(function(r){ie(e,r);function e(t){var n=r.call(this,t)||this;return n.supportsMasking=!0,n.rate=t.rate,n.noiseShape=t.noiseShape,n}return e.prototype._getNoiseShape=function(t){return this.noiseShape||tt(t).shape},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this),n={rate:this.rate};return Object.assign(n,t),n},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){if(a.rate<1&&a.rate>0){var i=a._getNoiseShape(t),o=function(){var s=tt(t),u=1.6732632423543772,c=1.0507009873554805,l=-u*c,f=F.greaterEqual(F.randomUniform(i),a.rate);f=hi(f,"float32");var h=Math.pow((1-a.rate)*(1+a.rate*Math.pow(l,2)),-.5),p=-h*l*a.rate,d=F.add(F.mul(s,f),F.mul(F.add(f,-1),l));return F.add(F.mul(d,h),p)};return hl(o,function(){return tt(t)},n.training||!1)}return t})},e})(lt);ty.className="AlphaDropout";F.serialization.registerClass(ty);function ul(r,e,t,n,a,i){i===void 0&&(i=.001);var o;if(r.rank===2)o=A.batchNorm2d(r,e,t,n,a,i);else if(r.rank===3)o=A.batchNorm3d(r,e,t,n,a,i);else if(r.rank===4)o=A.batchNorm4d(r,e,t,n,a,i);else throw new ct("batchNormalization is not implemented for array of rank ".concat(r.rank," ")+"yet");return o}function PJ(r,e,t,n,a){return a===void 0&&(a=.001),F.tidy(function(){var i=A.moments(r,n),o=i.mean,s=i.variance,u=ul(r,o,s,t,e,a);return[u,o,s]})}function MJ(r,e,t,n,a){return a===void 0&&(a=.001),F.tidy(function(){var i,o,s=A.moments(r,n),u=s.mean,c=s.variance,l=[];try{for(var f=le(Ka(0,r.rank)),h=f.next();!h.done;h=f.next()){var p=h.value;n.indexOf(p)!==-1?l.push(1):l.push(r.shape[p])}}catch(w){i={error:w}}finally{try{h&&!h.done&&(o=f.return)&&o.call(f)}finally{if(i)throw i.error}}var d=F.reshape(u,l),m=F.reshape(c,l),v=e==null?null:F.reshape(e,l),g=t==null?null:F.reshape(t,l),y=ul(r,d,m,g,v,a);return[y,u,c]})}function BJ(r,e,t,n,a){return a===void 0&&(a=.001),F.util.arraysEqual(n.slice().sort(),Ka(0,r.rank-1))?PJ(r,e,t,n,a):MJ(r,e,t,n,a)}var ry=(function(r){ie(e,r);function e(t){var n=this;return t==null&&(t={}),n=r.call(this,t)||this,n.supportsMasking=!0,n.axis=t.axis==null?-1:t.axis,n.momentum=t.momentum==null?.99:t.momentum,n.epsilon=t.epsilon==null?.001:t.epsilon,n.center=t.center==null?!0:t.center,n.scale=t.scale==null?!0:t.scale,n.betaInitializer=Qt(t.betaInitializer||"zeros"),n.gammaInitializer=Qt(t.gammaInitializer||"ones"),n.movingMeanInitializer=Qt(t.movingMeanInitializer||"zeros"),n.movingVarianceInitializer=Qt(t.movingVarianceInitializer||"ones"),n.betaConstraint=Dr(t.betaConstraint),n.gammaConstraint=Dr(t.gammaConstraint),n.betaRegularizer=tr(t.betaRegularizer),n.gammaRegularizer=tr(t.gammaRegularizer),n}return e.prototype.build=function(t){var n;t=wt(t);var a=this.axis>=0?this.axis:this.axis+t.length,i=t[a];if(i==null)throw new Y("Axis ".concat(a," of input tensor should have a defined dimension but ")+"the layer received an input with shape "+"".concat(JSON.stringify(t),"."));this.inputSpec=[new Nr({ndim:t.length,axes:(n={},n[a]=i,n)})];var o=[i];this.scale&&(this.gamma=this.addWeight("gamma",o,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",o,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",o,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",o,null,this.movingVarianceInitializer,null,!1),this.built=!0},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){var i=n.training==null?!1:n.training,o=tt(t),s=o.shape,u=s.length,c=Ka(0,u),l=a.axis>=0?a.axis:a.axis+u;c.splice(l,1);var f=rs(1,u);f[l]=s[l];var h=c.slice();h.sort();var p=!F.util.arraysEqual(h,Ka(0,u).slice(0,u-1)),d=function(){if(p){var x=F.reshape(a.movingMean.read(),f),S=F.reshape(a.movingVariance.read(),f),T=a.center?F.reshape(a.beta.read(),f):null,N=a.scale?F.reshape(a.gamma.read(),f):null;return ul(o,x,S,T,N,a.epsilon)}else return ul(o,a.movingMean.read(),a.movingVariance.read(),a.beta==null?null:a.beta.read(),a.gamma==null?null:a.gamma.read(),a.epsilon)};if(!i)return d();var m=ee(BJ(o,a.gamma.read(),a.beta.read(),c,a.epsilon),3),v=m[0],g=m[1],y=m[2],w=function(x,S,T){A.tidy(function(){var N=1-T,C=x.read(),R=A.mul(A.sub(C,S),N);x.write(A.sub(C,R))})},b=function(){w(a.movingMean,g,a.momentum),w(a.movingVariance,y,a.momentum)};return b(),v})},e.prototype.getConfig=function(){var t={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:sr(this.betaInitializer),gammaInitializer:sr(this.gammaInitializer),movingMeanInitializer:sr(this.movingMeanInitializer),movingVarianceInitializer:sr(this.movingVarianceInitializer),betaRegularizer:Ot(this.betaRegularizer),gammaRegularizer:Ot(this.gammaRegularizer),betaConstraint:Ar(this.betaConstraint),gammaConstraint:Ar(this.gammaConstraint)},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e})(lt);ry.className="BatchNormalization";F.serialization.registerClass(ry);var ny=(function(r){ie(e,r);function e(t){var n,a,i=this;if(t==null&&(t={}),i=r.call(this,t)||this,i.axis=t.axis==null?-1:t.axis,typeof i.axis=="number"){if(!Number.isInteger(i.axis))throw new Error("Expected axis to be an integer, but received ".concat(i.axis))}else if(Array.isArray(i.axis))try{for(var o=le(i.axis),s=o.next();!s.done;s=o.next()){var u=s.value;if(!Number.isInteger(u))throw new Error("Expected axis to be an array of integers, "+"but received ".concat(JSON.stringify(i.axis)))}}catch(c){n={error:c}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}else throw new Error("Expected axis to be an integer or an array of integers, "+"but received ".concat(JSON.stringify(i.axis)));return i.epsilon=t.epsilon==null?.001:t.epsilon,i.center=t.center==null?!0:t.center,i.scale=t.scale==null?!0:t.scale,i.betaInitializer=Qt(t.betaInitializer||"zeros"),i.gammaInitializer=Qt(t.gammaInitializer||"ones"),i.betaRegularizer=tr(t.betaRegularizer),i.gammaRegularizer=tr(t.gammaRegularizer),i.supportsMasking=!0,i}return e.prototype.build=function(t){var n,a;t=wt(t);var i=t.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(var o=0;o<this.axis.length;++o)this.axis[o]<0&&(this.axis[o]+=i);try{for(var s=le(this.axis),u=s.next();!u.done;u=s.next()){var c=u.value;if(c<0||c>=i)throw new Error("Invalid axis: ".concat(c))}}catch(h){n={error:h}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(n)throw n.error}}if(this.axis.length!==uo(this.axis).length)throw new Error("Found duplicate axes in: ".concat(this.axis));var l=this.axis.map(function(h){return t[h]}),f=!0;this.scale?this.gamma=this.addWeight("gamma",l,"float32",this.gammaInitializer,this.gammaRegularizer,f):this.gamma=null,this.center?this.beta=this.addWeight("beta",l,"float32",this.betaInitializer,this.betaRegularizer,f):this.beta=null,this.built=!0},e.prototype.call=function(t,n){var a=this,i=tt(t),o=i.shape,s=o.length;return F.tidy(function(){var u,c,l=!0,f=F.moments(i,a.axis,l),h=f.mean,p=f.variance,d=rs(1,s);try{for(var m=le(a.axis),v=m.next();!v.done;v=m.next()){var g=v.value;d[g]=o[g]}}catch(N){u={error:N}}finally{try{v&&!v.done&&(c=m.return)&&c.call(m)}finally{if(u)throw u.error}}for(var y=function(N){return N!=null&&N.shape.length!==s?A.reshape(N,d):N},w=a.scale?y(a.gamma.read()):null,b=a.center?y(a.beta.read()):null,x=[],S=[],T=0;T<s;++T)a.axis.indexOf(T)!==-1?(x.push(o[T]),S.push(1)):(x.push(1),S.push(o[T]));return h=A.tile(h,x),p=A.tile(p,x),w!=null&&(w=A.tile(w,S)),b!=null&&(b=A.tile(b,S)),ul(i,h,p,b,w,a.epsilon)})},e.prototype.getConfig=function(){var t={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:sr(this.betaInitializer),gammaInitializer:sr(this.gammaInitializer),betaRegularizer:Ot(this.betaRegularizer),gammaRegularizer:Ot(this.gammaRegularizer)},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e})(lt);ny.className="LayerNormalization";F.serialization.registerClass(ny);function LJ(r,e,t){return F.tidy(function(){if(r.rank!==4)throw new Y("temporalPadding expects input tensor to be 4-D, but received a "+"".concat(r.rank,"-D tensor."));if(e==null&&(e=[[1,1],[1,1]]),e.length!==2||e[0].length!==2||e[1].length!==2)throw new Y("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(t==null&&(t=ja()),t!=="channelsLast"&&t!=="channelsFirst")throw new Y("Unknown data format: ".concat(t,". ")+"Supported data formats are 'channelsLast' and 'channelsFirst.");var n;return t==="channelsFirst"?n=[[0,0],[0,0],e[0],e[1]]:n=[[0,0],e[0],e[1],[0,0]],A.pad(r,n)})}var ay=(function(r){ie(e,r);function e(t){var n=this;if(t==null&&(t={}),n=r.call(this,t)||this,n.dataFormat=t.dataFormat==null?ja():t.dataFormat,t.padding==null)n.padding=[[1,1],[1,1]];else if(typeof t.padding=="number")n.padding=[[t.padding,t.padding],[t.padding,t.padding]];else{if(t.padding=t.padding,t.padding.length!==2)throw new Y("ZeroPadding2D expects padding to be a length-2 array, but "+"received a length-".concat(t.padding.length," array."));var a=void 0,i=void 0;if(typeof t.padding[0]=="number")a=[t.padding[0],t.padding[0]],i=[t.padding[1],t.padding[1]];else{if(t.padding=t.padding,t.padding[0].length!==2)throw new Y("ZeroPadding2D expects height padding to be a length-2 array, "+"but received a length-".concat(t.padding[0].length," array."));if(a=t.padding[0],t.padding[1].length!==2)throw new Y("ZeroPadding2D expects width padding to be a length-2 array, "+"but received a length-".concat(t.padding[1].length," array."));i=t.padding[1]}n.padding=[a,i]}return n.inputSpec=[new Nr({ndim:4})],n}return e.prototype.computeOutputShape=function(t){t=wt(t);var n,a;return this.dataFormat==="channelsFirst"?(t[2]!=null&&t[2]>=0?n=t[2]+this.padding[0][0]+this.padding[0][1]:n=null,t[3]!=null&&t[3]>=0?a=t[3]+this.padding[1][0]+this.padding[1][1]:a=null,[t[0],t[1],n,a]):(t[1]!=null&&t[1]>=0?n=t[1]+this.padding[0][0]+this.padding[0][1]:n=null,t[2]!=null&&t[2]>=0?a=t[2]+this.padding[1][0]+this.padding[1][1]:a=null,[t[0],n,a,t[3]])},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){return LJ(tt(t),a.padding,a.dataFormat)})},e.prototype.getConfig=function(){var t={padding:this.padding,dataFormat:this.dataFormat},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e})(lt);ay.className="ZeroPadding2D";F.serialization.registerClass(ay);function ip(r,e,t,n,a,i){return F.tidy(function(){gr(a),gT(i),ea(n),t==null&&(t=[1,1]),n==null&&(n="valid"),a==null&&(a=ja()),i==null&&(i="max"),r=Tg(r,a);var o,s=n==="same"?"same":"valid";return i==="max"?o=A.maxPool(r,e,t,s):o=A.avgPool(r,e,t,s),a==="channelsFirst"&&(o=A.transpose(o,[0,3,1,2])),o})}function WI(r,e,t,n,a,i){return F.tidy(function(){gr(a),gT(i),ea(n),t==null&&(t=[1,1,1]),n==null&&(n="valid"),a==null&&(a=ja()),i==null&&(i="max"),r=PI(r,a);var o,s=n==="same"?"same":"valid";return i==="max"?o=A.maxPool3d(r,e,t,s):o=A.avgPool3d(r,e,t,s),a==="channelsFirst"&&(o=A.transpose(o,[0,4,1,2,3])),o})}var GI=(function(r){ie(e,r);function e(t){var n=this;if(t.poolSize==null&&(t.poolSize=2),n=r.call(this,t)||this,typeof t.poolSize=="number")n.poolSize=[t.poolSize];else if(Array.isArray(t.poolSize)&&t.poolSize.length===1&&typeof t.poolSize[0]=="number")n.poolSize=t.poolSize;else throw new Y("poolSize for 1D convolutional layer must be a number or an Array of a single number, but received "+"".concat(JSON.stringify(t.poolSize)));if(Mr(n.poolSize,"poolSize"),t.strides==null)n.strides=n.poolSize;else if(typeof t.strides=="number")n.strides=[t.strides];else if(Array.isArray(t.strides)&&t.strides.length===1&&typeof t.strides[0]=="number")n.strides=t.strides;else throw new Y("strides for 1D convolutional layer must be a number or an Array of a single number, but received "+"".concat(JSON.stringify(t.strides)));return Mr(n.strides,"strides"),n.padding=t.padding==null?"valid":t.padding,ea(n.padding),n.inputSpec=[new Nr({ndim:3})],n}return e.prototype.computeOutputShape=function(t){t=wt(t);var n=qa(t[1],this.poolSize[0],this.padding,this.strides[0]);return[t[0],n,t[2]]},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){a.invokeCallHook(t,n),t=ll(tt(t),2);var i=a.poolingFunction(tt(t),[a.poolSize[0],1],[a.strides[0],1],a.padding,"channelsLast");return A.squeeze(i,[2])})},e.prototype.getConfig=function(){var t={poolSize:this.poolSize,padding:this.padding,strides:this.strides},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e})(lt),iy=(function(r){ie(e,r);function e(t){return r.call(this,t)||this}return e.prototype.poolingFunction=function(t,n,a,i,o){return gr(o),ea(i),ip(t,n,a,i,o,"max")},e})(GI);iy.className="MaxPooling1D";F.serialization.registerClass(iy);var oy=(function(r){ie(e,r);function e(t){return r.call(this,t)||this}return e.prototype.poolingFunction=function(t,n,a,i,o){return gr(o),ea(i),ip(t,n,a,i,o,"avg")},e})(GI);oy.className="AveragePooling1D";F.serialization.registerClass(oy);var VI=(function(r){ie(e,r);function e(t){var n=this;if(t.poolSize==null&&(t.poolSize=[2,2]),n=r.call(this,t)||this,n.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize],t.strides==null)n.strides=n.poolSize;else if(Array.isArray(t.strides)){if(t.strides.length!==2)throw new Y("If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length "+"".concat(t.strides.length,"."));n.strides=t.strides}else n.strides=[t.strides,t.strides];return Mr(n.poolSize,"poolSize"),Mr(n.strides,"strides"),n.padding=t.padding==null?"valid":t.padding,n.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,gr(n.dataFormat),ea(n.padding),n.inputSpec=[new Nr({ndim:4})],n}return e.prototype.computeOutputShape=function(t){t=wt(t);var n=this.dataFormat==="channelsFirst"?t[2]:t[1],a=this.dataFormat==="channelsFirst"?t[3]:t[2];return n=qa(n,this.poolSize[0],this.padding,this.strides[0]),a=qa(a,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[t[0],t[1],n,a]:[t[0],n,a,t[3]]},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){return a.invokeCallHook(t,n),a.poolingFunction(tt(t),a.poolSize,a.strides,a.padding,a.dataFormat)})},e.prototype.getConfig=function(){var t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e})(lt),sy=(function(r){ie(e,r);function e(t){return r.call(this,t)||this}return e.prototype.poolingFunction=function(t,n,a,i,o){return gr(o),ea(i),ip(t,n,a,i,o,"max")},e})(VI);sy.className="MaxPooling2D";F.serialization.registerClass(sy);var uy=(function(r){ie(e,r);function e(t){return r.call(this,t)||this}return e.prototype.poolingFunction=function(t,n,a,i,o){return gr(o),ea(i),ip(t,n,a,i,o,"avg")},e})(VI);uy.className="AveragePooling2D";F.serialization.registerClass(uy);var UI=(function(r){ie(e,r);function e(t){var n=this;if(t.poolSize==null&&(t.poolSize=[2,2,2]),n=r.call(this,t)||this,n.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize,t.poolSize],t.strides==null)n.strides=n.poolSize;else if(Array.isArray(t.strides)){if(t.strides.length!==3)throw new Y("If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length "+"".concat(t.strides.length,"."));n.strides=t.strides}else n.strides=[t.strides,t.strides,t.strides];return Mr(n.poolSize,"poolSize"),Mr(n.strides,"strides"),n.padding=t.padding==null?"valid":t.padding,n.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,gr(n.dataFormat),ea(n.padding),n.inputSpec=[new Nr({ndim:5})],n}return e.prototype.computeOutputShape=function(t){t=wt(t);var n=this.dataFormat==="channelsFirst"?t[2]:t[1],a=this.dataFormat==="channelsFirst"?t[3]:t[2],i=this.dataFormat==="channelsFirst"?t[4]:t[3];return n=qa(n,this.poolSize[0],this.padding,this.strides[0]),a=qa(a,this.poolSize[1],this.padding,this.strides[1]),i=qa(i,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[t[0],t[1],n,a,i]:[t[0],n,a,i,t[4]]},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){return a.invokeCallHook(t,n),a.poolingFunction(tt(t),a.poolSize,a.strides,a.padding,a.dataFormat)})},e.prototype.getConfig=function(){var t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e})(lt),cy=(function(r){ie(e,r);function e(t){return r.call(this,t)||this}return e.prototype.poolingFunction=function(t,n,a,i,o){return gr(o),ea(i),WI(t,n,a,i,o,"max")},e})(UI);cy.className="MaxPooling3D";F.serialization.registerClass(cy);var ly=(function(r){ie(e,r);function e(t){return r.call(this,t)||this}return e.prototype.poolingFunction=function(t,n,a,i,o){return gr(o),ea(i),WI(t,n,a,i,o,"avg")},e})(UI);ly.className="AveragePooling3D";F.serialization.registerClass(ly);var HI=(function(r){ie(e,r);function e(t){var n=r.call(this,t)||this;return n.inputSpec=[new Nr({ndim:3})],n}return e.prototype.computeOutputShape=function(t){return[t[0],t[2]]},e.prototype.call=function(t,n){throw new ct},e})(lt),fy=(function(r){ie(e,r);function e(t){return r.call(this,t||{})||this}return e.prototype.call=function(t,n){return F.tidy(function(){var a=tt(t);return A.mean(a,1)})},e})(HI);fy.className="GlobalAveragePooling1D";F.serialization.registerClass(fy);var hy=(function(r){ie(e,r);function e(t){return r.call(this,t||{})||this}return e.prototype.call=function(t,n){return F.tidy(function(){var a=tt(t);return A.max(a,1)})},e})(HI);hy.className="GlobalMaxPooling1D";F.serialization.registerClass(hy);var qI=(function(r){ie(e,r);function e(t){var n=r.call(this,t)||this;return n.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,gr(n.dataFormat),n.inputSpec=[new Nr({ndim:4})],n}return e.prototype.computeOutputShape=function(t){return t=t,this.dataFormat==="channelsLast"?[t[0],t[3]]:[t[0],t[1]]},e.prototype.call=function(t,n){throw new ct},e.prototype.getConfig=function(){var t={dataFormat:this.dataFormat},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e})(lt),py=(function(r){ie(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.call=function(t,n){var a=this;return F.tidy(function(){var i=tt(t);return a.dataFormat==="channelsLast"?A.mean(i,[1,2]):A.mean(i,[2,3])})},e})(qI);py.className="GlobalAveragePooling2D";F.serialization.registerClass(py);var dy=(function(r){ie(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.call=function(t,n){var a=this;return F.tidy(function(){var i=tt(t);return a.dataFormat==="channelsLast"?A.max(i,[1,2]):A.max(i,[2,3])})},e})(qI);dy.className="GlobalMaxPooling2D";F.serialization.registerClass(dy);var KI=(function(r){ie(e,r);function e(t){var n=r.call(this,t)||this;return n.layer=t.layer,n}return e.prototype.build=function(t){this.built=!0},Object.defineProperty(e.prototype,"trainable",{get:function(){return this.layer!=null?this.layer.trainable:!1},set:function(t){this.layer!=null&&(this.layer.trainable=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.layer.trainableWeights},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.layer.nonTrainableWeights},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"updates",{get:function(){return this.layer._updates},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"losses",{get:function(){return this.layer.losses},enumerable:!1,configurable:!0}),e.prototype.getWeights=function(){return this.layer.getWeights()},e.prototype.setWeights=function(t){this.layer.setWeights(t)},e.prototype.getConfig=function(){var t={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.prototype.setFastWeightInitDuringBuild=function(t){r.prototype.setFastWeightInitDuringBuild.call(this,t),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(t)},e.fromConfig=function(t,n,a){a===void 0&&(a={});var i=n.layer,o=Ha(i,a);delete n.layer;var s={layer:o};return Object.assign(s,n),new t(s)},e})(lt),vy=(function(r){ie(e,r);function e(t){var n=r.call(this,t)||this;return n.supportsMasking=!0,n}return e.prototype.build=function(t){if(t=wt(t),t.length<3)throw new Y("TimeDistributed layer expects an input shape >= 3D, but received "+"input shape ".concat(JSON.stringify(t)));this.inputSpec=[{shape:t}];var n=[t[0]].concat(t.slice(2));this.layer.built||(this.layer.build(n),this.layer.built=!0),r.prototype.build.call(this,t)},e.prototype.computeOutputShape=function(t){t=wt(t);var n=[t[0]].concat(t.slice(2)),a=this.layer.computeOutputShape(n),i=t[1];return[a[0],i].concat(a.slice(1))},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){t=tt(t);var i=function(u,c){var l=tt(a.layer.call(u,n));return[l,[]]},o=zI(i,t,[],!1,null,null,!1,!0),s=o[1];return s})},e})(KI);vy.className="TimeDistributed";F.serialization.registerClass(vy);function zJ(r){as(TK,"BidirectionalMergeMode",r)}var $J="concat",my=(function(r){ie(e,r);function e(t){var n=r.call(this,t)||this,a=t.layer.getConfig(),i={};i.className=t.layer.getClassName(),i.config=a,n.forwardLayer=Ha(i),a.goBackwards=a.goBackwards!==!0;var o={};if(o.className=t.layer.getClassName(),o.config=a,n.backwardLayer=Ha(o),n.forwardLayer.name="forward_"+n.forwardLayer.name,n.backwardLayer.name="backward_"+n.backwardLayer.name,n.mergeMode=t.mergeMode===void 0?$J:t.mergeMode,zJ(n.mergeMode),t.weights)throw new ct("weights support is not implemented for Bidirectional layer yet.");return n._stateful=t.layer.stateful,n.returnSequences=t.layer.returnSequences,n.returnState=t.layer.returnState,n.supportsMasking=!0,n._trainable=!0,n.inputSpec=t.layer.inputSpec,n.numConstants=null,n}return Object.defineProperty(e.prototype,"trainable",{get:function(){return this._trainable},set:function(t){this._trainable=t,this.forwardLayer!=null&&(this.forwardLayer.trainable=t),this.backwardLayer!=null&&(this.backwardLayer.trainable=t)},enumerable:!1,configurable:!0}),e.prototype.getWeights=function(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())},e.prototype.setWeights=function(t){var n=t.length,a=Math.floor(n/2);this.forwardLayer.setWeights(t.slice(0,a)),this.backwardLayer.setWeights(t.slice(a))},e.prototype.computeOutputShape=function(t){var n=this.forwardLayer.computeOutputShape(t);Array.isArray(n)&&Array.isArray(n[0])||(n=[n]),n=n;var a,i,o;return this.returnState&&(o=n.slice(1)),a=n[0],a=a,this.mergeMode==="concat"?(a[a.length-1]*=2,i=[a]):this.mergeMode==null?i=[a,a.slice()]:i=[a],this.returnState?this.mergeMode==null?i.concat(o).concat(o.slice()):[a].concat(o).concat(o.slice()):mn(i)},e.prototype.apply=function(t,n){var a,i,o=n==null?null:n.initialState,s=n==null?null:n.constants;n==null&&(n={});var u=LI(t,o,s,this.numConstants);if(t=u.inputs,o=u.initialState,s=u.constants,Array.isArray(t)&&(o=t.slice(1),t=t[0]),(o==null||o.length===0)&&s==null)return r.prototype.apply.call(this,t,n);var c=[],l=[];if(o!=null){var f=o.length;if(f%2>0)throw new Y("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");n.initialState=o,c.push.apply(c,Xe([],ee(o),!1));var h=o.map(function(x){return new Nr({shape:x.shape})});this.forwardLayer.stateSpec=h.slice(0,f/2),this.backwardLayer.stateSpec=h.slice(f/2),l.push.apply(l,Xe([],ee(h),!1))}if(s!=null)throw new ct("Support for constants in Bidirectional layers is not implemented yet.");var p=c[0]instanceof Xa;try{for(var d=le(c),m=d.next();!m.done;m=d.next()){var v=m.value;if(v instanceof Xa!==p)throw new Y("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors")}}catch(x){a={error:x}}finally{try{m&&!m.done&&(i=d.return)&&i.call(d)}finally{if(a)throw a.error}}if(p){var g=[t].concat(c),y=this.inputSpec.concat(l),w=this.inputSpec;this.inputSpec=y;var b=r.prototype.apply.call(this,g,n);return this.inputSpec=w,b}else return r.prototype.apply.call(this,t,n)},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){var i=n.initialState,o,s;if(i==null)o=a.forwardLayer.call(t,n),s=a.backwardLayer.call(t,n);else{var u=i.slice(0,i.length/2),c=i.slice(i.length/2);o=a.forwardLayer.call(t,Object.assign(n,{initialState:u})),s=a.backwardLayer.call(t,Object.assign(n,{initialState:c}))}var l;a.returnState&&(Array.isArray(o)&&(l=o.slice(1).concat(s.slice(1))),o=o[0],s=s[0]),a.returnSequences&&(s=A.reverse(s,1));var f;return a.mergeMode==="concat"?f=_m([o,s]):a.mergeMode==="sum"?f=A.add(o,s):a.mergeMode==="ave"?f=A.mul(.5,A.add(o,s)):a.mergeMode==="mul"?f=A.mul(o,s):a.mergeMode==null&&(f=[o,s]),a.returnState?a.mergeMode==null?f.concat(l):[f].concat(l):f})},e.prototype.resetStates=function(t){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()},e.prototype.build=function(t){var n=this;es(this.forwardLayer.name,function(){n.forwardLayer.build(t)}),es(this.backwardLayer.name,function(){n.backwardLayer.build(t)}),this.built=!0},e.prototype.computeMask=function(t,n){Array.isArray(n)&&(n=n[0]);var a;if(this.returnSequences?this.mergeMode==null?a=[n,n]:a=n:this.mergeMode==null?a=[null,null]:a=null,this.returnState){var i=this.forwardLayer.states,o=i.map(function(s){return null});return Array.isArray(a)?a.concat(o).concat(o):[a].concat(o).concat(o)}else return a},Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)},enumerable:!1,configurable:!0}),e.prototype.setFastWeightInitDuringBuild=function(t){r.prototype.setFastWeightInitDuringBuild.call(this,t),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(t),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(t)},e.prototype.getConfig=function(){var t={mergeMode:this.mergeMode},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.fromConfig=function(t,n){var a=Ha(n.layer);if(delete n.layer,n.numConstants!=null)throw new ct("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");var i=n;return i.layer=a,new t(i)},e})(KI);my.className="Bidirectional";F.serialization.registerClass(my);var gy=(function(r){ie(e,r);function e(t){var n=r.call(this,t)||this;return n.scale=t.scale,t.offset?n.offset=t.offset:n.offset=0,n}return e.prototype.getConfig=function(){var t={scale:this.scale,offset:this.offset},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){return t=tt(t),t.dtype!=="float32"&&(t=hi(t,"float32")),F.add(F.mul(t,a.scale),a.offset)})},e})(lt);gy.className="Rescaling";F.serialization.registerClass(gy);var WJ=F.image.resizeBilinear,GJ=F.image.cropAndResize,yy=(function(r){ie(e,r);function e(t){var n=r.call(this,t)||this;return n.height=t.height,n.width=t.width,n}return e.prototype.centerCrop=function(t,n,a,i,o,s,u,c){return F.tidy(function(){var l,f=!1,h=n/s,p=a/u,d=(i+n)/s,m=(o+a)/u,v=[h,p,d,m],g=[];t.rank===3?(f=!0,l=F.stack([t])):l=t;for(var y=0;y<l.shape[0];y++)g.push(v);var w=F.tensor(g,[g.length,4]),b=F.range(0,g.length,1,"int32"),x=[i,o],S=GJ(l,w,b,x,"nearest");return hi(f?tt(F.unstack(S)):S,c)})},e.prototype.upsize=function(t,n,a,i){return F.tidy(function(){var o=WJ(t,[n,a]);return hi(o,i)})},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){var i=tt(t),o=i.dtype,s=i.shape,u=s[s.length-3],c=s[s.length-2],l=0;u!==a.height&&(l=Math.floor((u-a.height)/2));var f=0;return c!==a.width&&(f=Math.floor((c-a.width)/2),f===0&&(f=1)),l>=0&&f>=0?a.centerCrop(i,l,f,a.height,a.width,u,c,o):a.upsize(t,a.height,a.width,o)})},e.prototype.getConfig=function(){var t={height:this.height,width:this.width},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.prototype.computeOutputShape=function(t){t=wt(t);var n=t.length-3,a=t.length-2;return t[n]=this.height,t[a]=this.width,t},e})(lt);yy.className="CenterCrop";F.serialization.registerClass(yy);function VJ(r,e,t,n){var a=tt(r);if(a.dtype!=="int32"&&(a=hi(a,"int32")),e==="int")return a;var i=a.shape;if(a.rank===0&&(a=F.expandDims(a,-1)),e==="oneHot"&&a.shape[a.shape.length-1]!==1&&(a=F.expandDims(a,-1)),a.rank>2)throw new Y("When outputMode is not int, maximum output rank is 2"+" Received outputMode ".concat(e," and input shape ").concat(i)+" which would result in output rank ".concat(a.rank,"."));var o=["multiHot","oneHot"].includes(e),s=a,u;if(typeof n<"u"&&e==="count"?u=F.denseBincount(s,n,t,o):u=F.denseBincount(s,[],t,o),e!=="tfIdf")return u;if(n)return F.mul(u,n);throw new Y("When outputMode is 'tfIdf', weights must be provided.")}var by=(function(r){ie(e,r);function e(t){var n=r.call(this,t)||this;return n.numTokens=t.numTokens,t.outputMode?n.outputMode=t.outputMode:n.outputMode="multiHot",n}return e.prototype.getConfig=function(){var t={numTokens:this.numTokens,outputMode:this.outputMode},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.prototype.computeOutputShape=function(t){return t=wt(t),t==null?[this.numTokens]:this.outputMode==="oneHot"&&t[t.length-1]!==1?(t.push(this.numTokens),t):(t[t.length-1]=this.numTokens,t)},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){t=tt(t),t.dtype!=="int32"&&(t=hi(t,"int32"));var i;if(typeof n.countWeights<"u"){if(a.outputMode!=="count")throw new Y(`countWeights is not used when outputMode !== count.
              Received countWeights=`.concat(n.countWeights));i=tt(n.countWeights)}var o=F.max(t),s=F.min(t),u=F.greater(a.numTokens,o).bufferSync().get(0),c=F.greaterEqual(s,0).bufferSync().get(0);if(!(u&&c))throw new Y("Input values must be between 0 < values <="+" numTokens with numTokens=".concat(a.numTokens));return VJ(t,a.outputMode,a.numTokens,i)})},e})(lt);by.className="CategoryEncoding";F.serialization.registerClass(by);var UJ=["bilinear","nearest"],lT=new Set(UJ),wy=(function(r){ie(e,r);function e(t){var n=r.call(this,t)||this;if(n.height=t.height,n.width=t.width,t.interpolation)if(lT.has(t.interpolation))n.interpolation=t.interpolation;else throw new Y("Invalid interpolation parameter: ".concat(t.interpolation," is not implemented"));else n.interpolation="bilinear";return n.cropToAspectRatio=!!t.cropToAspectRatio,n}return e.prototype.computeOutputShape=function(t){t=wt(t);var n=t[2];return[this.height,this.width,n]},e.prototype.getConfig=function(){var t={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){var i=[a.height,a.width];if(a.interpolation==="bilinear")return F.image.resizeBilinear(t,i,!a.cropToAspectRatio);if(a.interpolation==="nearest")return F.image.resizeNearestNeighbor(t,i,!a.cropToAspectRatio);throw new Error("Interpolation is ".concat(a.interpolation," but only ").concat(Xe([],ee(lT),!1)," are supported"))})},e})(lt);wy.className="Resizing";F.serialization.registerClass(wy);var jI=(function(){function r(e){this.seed=e}return r.prototype.next=function(){if(this.seed!==void 0)return this.seed++},r})();jI.className="RandomSeed";var XI=(function(r){ie(e,r);function e(t){var n=r.call(this,t)||this;return n.randomGenerator=new jI(t.seed),n}return e.prototype.getConfig=function(){var t={seed:this.randomGenerator.seed},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e})(lt);XI.className="BaseRandomLayer";var HJ=["bilinear","nearest"],fT=new Set(HJ),xy=(function(r){ie(e,r);function e(t){var n=r.call(this,t)||this,a=t.factor,i=t.interpolation,o=i===void 0?"bilinear":i;if(n.factor=a,Array.isArray(n.factor)&&n.factor.length===2)n.widthLower=n.factor[0],n.widthUpper=n.factor[1];else if(!Array.isArray(n.factor)&&n.factor>0)n.widthLower=-n.factor,n.widthUpper=n.factor;else throw new Y("Invalid factor: ".concat(n.factor,". Must be positive number or tuple of 2 numbers"));if(n.widthLower<-1||n.widthUpper<-1)throw new Y("factor must have values larger than -1. Got: ".concat(n.factor));if(n.widthUpper<n.widthLower)throw new Y(`factor cannot have upper bound less than lower bound.
        Got upper bound: `.concat(n.widthUpper,`.
        Got lower bound: `).concat(n.widthLower,`
      `));if(o)if(fT.has(o))n.interpolation=o;else throw new Y("Invalid interpolation parameter: ".concat(o," is not implemented"));return n}return e.prototype.getConfig=function(){var t={factor:this.factor,interpolation:this.interpolation},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.prototype.computeOutputShape=function(t){t=wt(t);var n=t[2];return[this.imgHeight,-1,n]},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){var i=tt(t);a.imgHeight=i.shape[i.shape.length-3];var o=i.shape[i.shape.length-2];a.widthFactor=F.randomUniform([1],1+a.widthLower,1+a.widthUpper,"float32",a.randomGenerator.next());var s=a.widthFactor.dataSync()[0]*o;s=Math.round(s);var u=[a.imgHeight,s];switch(a.interpolation){case"bilinear":return F.image.resizeBilinear(t,u);case"nearest":return F.image.resizeNearestNeighbor(t,u);default:throw new Error("Interpolation is ".concat(a.interpolation,`
          but only `).concat(Xe([],ee(fT),!1)," are supported"))}})},e})(XI);xy.className="RandomWidth";F.serialization.registerClass(xy);function qJ(r){return new wu(r)}function KJ(r){return new kg(r)}function jJ(r){return new bg(r)}function XJ(r){return new wg(r)}function YJ(r){return new xg(r)}function ZJ(r){return new Eg(r)}function JJ(r){return new Sg(r)}function QJ(r){return new Ag(r)}function eQ(r){return new Jh(r)}function tQ(r){return new Ng(r)}function rQ(r){return new Qh(r)}function nQ(r){return new Ig(r)}function aQ(r){return new Cg(r)}function iQ(r){return new Dg(r)}function oQ(r){return new _g(r)}function sQ(r){return new Fg(r)}function uQ(r){return new $g(r)}function cQ(r){return new Lg(r)}function lQ(r){return new ap(r)}function fQ(r){return new Bg(r)}function hQ(r){return new zg(r)}function pQ(r){return new Wg(r)}function dQ(r){return new Gg(r)}function vQ(r){return new Vg(r)}function mQ(r){return new Hg(r)}function gQ(r){return new qg(r)}function yQ(r){return new jg(r)}function bQ(r){return new Zg(r)}function wQ(r){return new Xg(r)}function xQ(r){return new Yg(r)}function kQ(r){return new Kg(r)}function SQ(r){return new Jg(r)}function EQ(r){return new ry(r)}function TQ(r){return new ny(r)}function NQ(r){return new ay(r)}function ky(r){return new oy(r)}function IQ(r){return ky(r)}function CQ(r){return ky(r)}function Sy(r){return new uy(r)}function AQ(r){return Sy(r)}function DQ(r){return Sy(r)}function Ey(r){return new ly(r)}function _Q(r){return Ey(r)}function FQ(r){return Ey(r)}function RQ(r){return new fy(r)}function OQ(r){return new py(r)}function YI(r){return new hy(r)}function ZI(r){return new dy(r)}function JI(r){return new iy(r)}function QI(r){return new sy(r)}function PQ(r){return new cy(r)}function MQ(r){return new Og(r)}function BQ(r){return new tp(r)}function LQ(r){return new Pg(r)}function zQ(r){return new yl(r)}function $Q(r){return new Rg(r)}function WQ(r){return new ep(r)}function GQ(r){return new Mg(r)}function VQ(r){return new np(r)}function UQ(r){return new Oi(r)}function HQ(r){return new rp(r)}function qQ(r){return new my(r)}function KQ(r){return new vy(r)}var jQ=YI,XQ=ZI,YQ=JI,ZQ=QI;function JQ(r){return new Qg(r)}function QQ(r){return new ey(r)}function eee(r){return new ty(r)}function tee(r){return new Ug(r)}function ree(r){return new gy(r)}function nee(r){return new yy(r)}function aee(r){return new wy(r)}function iee(r){return new by(r)}function oee(r){return new xy(r)}var see={__proto__:null,Layer:lt,RNN:Oi,RNNCell:Su,activation:uQ,add:gQ,alphaDropout:eee,average:yQ,averagePooling1d:ky,averagePooling2d:Sy,averagePooling3d:Ey,avgPool1d:IQ,avgPool2d:AQ,avgPool3d:_Q,avgPooling1d:CQ,avgPooling2d:DQ,avgPooling3d:FQ,batchNormalization:EQ,bidirectional:qQ,categoryEncoding:iee,centerCrop:nee,concatenate:bQ,conv1d:QJ,conv2d:eQ,conv2dTranspose:tQ,conv3d:rQ,conv3dTranspose:nQ,convLstm2d:GQ,convLstm2dCell:VQ,cropping2D:iQ,dense:cQ,depthwiseConv2d:sQ,dot:SQ,dropout:lQ,elu:KJ,embedding:mQ,flatten:hQ,gaussianDropout:QQ,gaussianNoise:JQ,globalAveragePooling1d:RQ,globalAveragePooling2d:OQ,globalMaxPool1d:jQ,globalMaxPool2d:XQ,globalMaxPooling1d:YI,globalMaxPooling2d:ZI,gru:MQ,gruCell:BQ,input:yI,inputLayer:qJ,layerNormalization:TQ,leakyReLU:XJ,lstm:LQ,lstmCell:zQ,masking:tee,maxPool1d:YQ,maxPool2d:ZQ,maxPooling1d:JI,maxPooling2d:QI,maxPooling3d:PQ,maximum:wQ,minimum:xQ,multiply:kQ,permute:vQ,prelu:YJ,randomWidth:oee,reLU:jJ,repeatVector:pQ,rescaling:ree,reshape:dQ,resizing:aee,rnn:UQ,separableConv2d:aQ,simpleRNN:$Q,simpleRNNCell:WQ,softmax:ZJ,spatialDropout1d:fQ,stackedRNNCells:HQ,thresholdedReLU:JJ,timeDistributed:KQ,upSampling2d:oQ,zeroPadding2d:NQ};function uee(r,e){return pg(r,e)}function cee(r,e){return cI(r,e)}function lee(r,e){return lI(r,e)}function fee(r,e){return dg(r,e)}function hee(r,e){return vg(r,e)}function pee(r,e){return uI(r,e)}function dee(r,e){return UZ(r,e)}function vee(r,e){return hg(r,e)}function mee(r,e){return jh(r,e)}function gee(r,e){return ku(r,e)}function yee(r,e){return ku(r,e)}function bee(r,e){return ku(r,e)}function wee(r,e){return fs(r,e)}function xee(r,e){return fs(r,e)}function kee(r,e){return fs(r,e)}function See(r,e){return HZ(r,e)}var Eee={__proto__:null,MAPE:yee,MSE:xee,binaryAccuracy:uee,binaryCrossentropy:cee,categoricalAccuracy:fee,categoricalCrossentropy:hee,cosineProximity:vee,mape:bee,meanAbsoluteError:mee,meanAbsolutePercentageError:gee,meanSquaredError:wee,mse:kee,precision:pee,r2Score:See,recall:dee,sparseCategoricalAccuracy:lee};var Tee={__proto__:null,modelFromJSON:xJ};function Nee(r){return new gl(r)}function Iee(r){return CJ(r)}function Cee(r){return AJ(r)}var Aee={__proto__:null,l1:Iee,l1l2:Nee,l2:Cee},eC=(function(r){ie(e,r);function e(){var t=r.apply(this,Xe([],ee(arguments),!1))||this;return t.model=null,t}return e.prototype.setModel=function(t){if(!(t instanceof Ri))throw new Error("model must be a LayersModel, not some other Container");this.model=t},e})(bu);function fh(r,e){return r<e}function hT(r,e){return r>e}var tC=(function(r){ie(e,r);function e(t){var n=r.call(this)||this;if(t==null&&(t={}),t.restoreBestWeights)throw new ct("restoreBestWeights = True is not implemented in EarlyStopping yet.");return n.monitor=t.monitor||"val_loss",n.minDelta=Math.abs(t.minDelta||0),n.patience=t.patience||0,n.verbose=t.verbose||0,n.mode=t.mode||"auto",n.baseline=t.baseline,["auto","min","max"].indexOf(n.mode)===-1&&(console.warn("EarlyStopping mode '".concat(n.mode,"' is invalid. ")+"Falling back to mode 'auto'."),n.mode="auto"),n.mode==="min"?n.monitorFunc=fh:n.mode==="max"||n.monitor.indexOf("acc")!==-1?n.monitorFunc=hT:n.monitorFunc=fh,n.monitorFunc===fh&&(n.minDelta*=-1),n}return e.prototype.onTrainBegin=function(t){return Ie(this,void 0,void 0,function(){return Te(this,function(n){return this.wait=0,this.stoppedEpoch=0,this.baseline!=null?this.best=this.baseline:this.best=this.monitorFunc===fh?1/0:-1/0,[2]})})},e.prototype.onEpochEnd=function(t,n){return Ie(this,void 0,void 0,function(){var a;return Te(this,function(i){switch(i.label){case 0:return[4,oo(n)];case 1:return i.sent(),a=this.getMonitorValue(n),a==null?[2]:(this.monitorFunc(a-this.minDelta,this.best)?(this.best=a,this.wait=0):(this.wait++,this.wait>=this.patience&&(this.stoppedEpoch=t,this.model.stopTraining=!0)),[2])}})})},e.prototype.onTrainEnd=function(t){return Ie(this,void 0,void 0,function(){return Te(this,function(n){return this.stoppedEpoch>0&&this.verbose&&console.log("Epoch ".concat(this.stoppedEpoch,": early stopping.")),[2]})})},e.prototype.getMonitorValue=function(t){t==null&&(t={});var n=t[this.monitor];return n==null&&console.warn("Metric for EarlyStopping ".concat(this.monitor," is not available. ")+"Available metrics are: ".concat(Object.keys(t))),n},e})(eC);function Dee(r){return new tC(r)}var _ee={earlyStopping:Dee};rr.Callback=eC;rr.CallbackList=rI;rr.CustomCallback=aI;rr.EarlyStopping=tC;rr.History=nI;rr.InputSpec=Nr;rr.LayerVariable=ST;rr.LayersModel=Ri;rr.RNN=Oi;rr.Sequential=Yh;rr.SymbolicTensor=Xa;rr.callbacks=_ee;rr.constraints=vZ;rr.initializers=_Z;rr.input=yI;rr.layers=see;rr.loadLayersModel=kJ;rr.metrics=Eee;rr.model=TJ;rr.models=Tee;rr.registerCallbackConstructor=IJ;rr.regularizers=Aee;rr.sequential=NJ;rr.version_layers=mg});var ZA=Vr(ks=>{"use strict";var Me=Xo();function Fee(r){var e=Object.create(null);return r&&Object.keys(r).forEach(function(t){if(t!=="default"){var n=Object.getOwnPropertyDescriptor(r,t);Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:function(){return r[t]}})}}),e.default=r,e}function Ree(r,e){return e.forEach(function(t){t&&typeof t!="string"&&!Array.isArray(t)&&Object.keys(t).forEach(function(n){if(n!=="default"&&!(n in r)){var a=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(r,n,a.get?a:{enumerable:!0,get:function(){return t[n]}})}})}),r}var nC=Fee(Me);var Oee=Me.env();Oee.registerFlag("KEEP_INTERMEDIATE_TENSORS",function(){return!1},function(r){r&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});var Dy=function(r,e){return Dy=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},Dy(r,e)};function MC(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Dy(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function yt(r,e,t,n){function a(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function s(l){try{c(n.next(l))}catch(f){o(f)}}function u(l){try{c(n.throw(l))}catch(f){o(f)}}function c(l){l.done?i(l.value):a(l.value).then(s,u)}c((n=n.apply(r,e||[])).next())})}function gt(r,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(c){return function(l){return u([c,l])}}function u(c){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,a&&(i=c[0]&2?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[c[0]&2,i.value]),c[0]){case 0:case 1:i=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,a=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){t.label=c[1];break}if(c[0]===6&&t.label<i[1]){t.label=i[1],i=c;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(c);break}i[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(r,t)}catch(l){c=[6,l],a=0}finally{n=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function _r(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function be(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=n.next()).done;)i.push(a.value)}catch(s){o={error:s}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return i}function Et(r,e,t){if(t||arguments.length===2)for(var n=0,a=e.length,i;n<a;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return r.concat(i||Array.prototype.slice.call(e))}var Ln;(function(r){r[r.DT_INVALID=0]="DT_INVALID",r[r.DT_FLOAT=1]="DT_FLOAT",r[r.DT_DOUBLE=2]="DT_DOUBLE",r[r.DT_INT32=3]="DT_INT32",r[r.DT_UINT8=4]="DT_UINT8",r[r.DT_INT16=5]="DT_INT16",r[r.DT_INT8=6]="DT_INT8",r[r.DT_STRING=7]="DT_STRING",r[r.DT_COMPLEX64=8]="DT_COMPLEX64",r[r.DT_INT64=9]="DT_INT64",r[r.DT_BOOL=10]="DT_BOOL",r[r.DT_QINT8=11]="DT_QINT8",r[r.DT_QUINT8=12]="DT_QUINT8",r[r.DT_QINT32=13]="DT_QINT32",r[r.DT_BFLOAT16=14]="DT_BFLOAT16",r[r.DT_QINT16=15]="DT_QINT16",r[r.DT_QUINT16=16]="DT_QUINT16",r[r.DT_UINT16=17]="DT_UINT16",r[r.DT_COMPLEX128=18]="DT_COMPLEX128",r[r.DT_HALF=19]="DT_HALF",r[r.DT_RESOURCE=20]="DT_RESOURCE",r[r.DT_VARIANT=21]="DT_VARIANT",r[r.DT_UINT32=22]="DT_UINT32",r[r.DT_UINT64=23]="DT_UINT64",r[r.DT_FLOAT_REF=101]="DT_FLOAT_REF",r[r.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",r[r.DT_INT32_REF=103]="DT_INT32_REF",r[r.DT_UINT8_REF=104]="DT_UINT8_REF",r[r.DT_INT16_REF=105]="DT_INT16_REF",r[r.DT_INT8_REF=106]="DT_INT8_REF",r[r.DT_STRING_REF=107]="DT_STRING_REF",r[r.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",r[r.DT_INT64_REF=109]="DT_INT64_REF",r[r.DT_BOOL_REF=110]="DT_BOOL_REF",r[r.DT_QINT8_REF=111]="DT_QINT8_REF",r[r.DT_QUINT8_REF=112]="DT_QUINT8_REF",r[r.DT_QINT32_REF=113]="DT_QINT32_REF",r[r.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",r[r.DT_QINT16_REF=115]="DT_QINT16_REF",r[r.DT_QUINT16_REF=116]="DT_QUINT16_REF",r[r.DT_UINT16_REF=117]="DT_UINT16_REF",r[r.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",r[r.DT_HALF_REF=119]="DT_HALF_REF",r[r.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",r[r.DT_VARIANT_REF=121]="DT_VARIANT_REF",r[r.DT_UINT32_REF=122]="DT_UINT32_REF",r[r.DT_UINT64_REF=123]="DT_UINT64_REF"})(Ln||(Ln={}));var aC;(function(r){(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(r.CheckpointFormatVersion||(r.CheckpointFormatVersion={}))})(aC||(aC={}));var r0={};function Pee(r,e){var t={tfOpName:r,category:"custom",inputs:[],attrs:[],customExecutor:e};r0[r]=t}function BC(r){return r0[r]}function Mee(r){delete r0[r]}function I(r,e,t,n,a){var i=e.inputParams[r];if(i&&i.inputIndexStart!==void 0){var o=i.inputIndexStart,s=i.inputIndexEnd===0?void 0:i.inputIndexEnd===void 0?o+1:i.inputIndexEnd,u=o<0?e.inputNames.length+o:o;if(i.type==="tensor")return Kr(e.inputNames[u],t,n,a);if(i.type==="tensors"){var c=e.inputs.slice(o,s),l=e.inputNames.slice(o,s).filter(function(d,m){var v;return((v=c[m])===null||v===void 0?void 0:v.op)!=="NoOp"});return l.map(function(d){return Kr(d,t,n,a)})}var f=Kr(e.inputNames[u],t,n,a),h=f.dataSync();return i.type==="number"?h[0]:Me.util.toNestedArray(f.shape,h)}var p=e.attrParams[r];return p&&p.value}function Kr(r,e,t,n){var a=be(zn(r,t),2),i=a[0],o=a[1];if(n!=null){var s=n.getHashTableHandleByName(i);if(s!=null)return s}var u=t.currentContextIds.find(function(c){return!!e[hp(i,c)]});return u!==void 0?e[hp(i,u)][o]:void 0}function iC(r,e,t){return e[hp(r,t.currentContextId)]}function Pi(r,e){var t=be(zn(r,e),3),n=t[0],a=t[1],i=t[2];return[hp(n,e&&e.currentContextId),a,i]}function hp(r,e){return e?"".concat(r,"-").concat(e):r}function zn(r,e){if(r==="")return["",0,void 0];var t=e!=null&&e.parseNodeNameCache!=null;if(t){var n=e.parseNodeNameCache.get(r);if(n!=null)return n}var a=r.split(":"),i;if(a.length===1)i=[r,0,void 0];else{var o=a[0],s=a.length===3?a[1]:void 0,u=Number(a[a.length-1]);i=[o,u,s]}return t&&e.parseNodeNameCache.set(r,i),i}function up(r,e,t){var n=I("pad",r,e,t);if(n==="explicit"){n=I("explicitPaddings",r,e,t);for(var a=[[0,0],[0,0],[0,0],[0,0]],i=0;i<4;i++)a[i][0]=n[i*2],a[i][1]=n[i*2+1];return a}return n}function Mi(r){return r.kept?r:Me.clone(r)}var Bee=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],Lee={__proto__:null,json:Bee};var zee=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsFinite",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsInf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],$ee={__proto__:null,json:zee};var Wee=[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}],Gee={__proto__:null,json:Wee};var Vee=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}],Uee={__proto__:null,json:Vee};var Hee=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomStandardNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniformInt",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number"},{tfName:"maxval",name:"maxval",type:"number"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}],qee={__proto__:null,json:Hee};var Kee=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],jee={__proto__:null,json:Kee};var Xee=[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}],Yee={__proto__:null,json:Xee};var Zee=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}],Jee={__proto__:null,json:Zee};var Qee=[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"InitializeTable",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]},{tfOpName:"InitializeTableV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],ete={__proto__:null,json:Qee};var tte=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}],rte={__proto__:null,json:tte};var nte=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BitwiseAnd",category:"logical",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}]}],ate={__proto__:null,json:nte};var ite=[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"MatrixBandPart",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"numLower",type:"tensor"},{start:1,name:"numUpper",type:"tensor"}]}],ote={__proto__:null,json:ite};var ste=[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]}],ute={__proto__:null,json:ste};var cte=[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}],lte={__proto__:null,json:cte};var fte=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]},{tfOpName:"TensorScatterUpdate",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],hte={__proto__:null,json:fte};var pte=[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}],dte={__proto__:null,json:pte};var vte=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}],mte={__proto__:null,json:vte};var gte=[{tfOpName:"StaticRegexReplace",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"pattern",name:"pattern",type:"string"},{tfName:"rewrite",name:"rewrite",type:"string"},{tfName:"replace_global",name:"replaceGlobal",type:"bool"}]},{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}],yte={__proto__:null,json:gte};var bte=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"EnsureShape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}],wte={__proto__:null,json:bte},oC=(function(){function r(){var e=[Lee,$ee,Gee,Uee,qee,jee,Yee,Jee,ete,rte,ate,ote,ute,lte,hte,dte,mte,yte,wte],t=[].concat.apply([],Et([],be(e.map(function(n){return n.json})),!1));this.opMappers=t.reduce(function(n,a){return n[a.tfOpName]=a,n},{})}return Object.defineProperty(r,"Instance",{get:function(){return this._instance||(this._instance=new this)},enumerable:!1,configurable:!0}),r.prototype.transformGraph=function(e,t){var n=this;t===void 0&&(t={});var a=e.node,i=[],o=[],s=[],u=a.reduce(function(v,g){return v[g.name]=n.mapNode(g),g.op.startsWith("Placeholder")?i.push(v[g.name]):g.op==="Const"?o.push(v[g.name]):(g.input==null||g.input.length===0)&&s.push(v[g.name]),v},{}),c=[],l=[],f={},h={};t!=null&&(f=this.mapSignatureEntries(t.inputs),h=this.mapSignatureEntries(t.outputs));var p=Object.keys(u);p.forEach(function(v){var g=u[v];g.inputNames.forEach(function(y,w){var b=be(Pi(y),3),x=b[0],S=b[2],T=u[x];if(T.outputs!=null){var N=T.outputs.indexOf(S);if(N!==-1){var C="".concat(x,":").concat(N);g.inputNames[w]=C}}g.inputs.push(T),T.children.push(g)})}),Object.keys(h).length===0?p.forEach(function(v){var g=u[v];g.children.length===0&&l.push(g)}):Object.keys(h).forEach(function(v){var g=be(Pi(v),1),y=g[0],w=u[y];w!=null&&(w.signatureKey=h[v],l.push(w))}),Object.keys(f).length>0?Object.keys(f).forEach(function(v){var g=be(Pi(v),1),y=g[0],w=u[y];w&&(w.signatureKey=f[v],c.push(w))}):c=i;var d={};e.library!=null&&e.library.function!=null&&(d=e.library.function.reduce(function(v,g){return v[g.signature.name]=n.mapFunction(g),v},{}));var m={nodes:u,inputs:c,outputs:l,weights:o,placeholders:i,signature:t,functions:d};return s.length>0&&(m.initNodes=s),m},r.prototype.mapSignatureEntries=function(e){return Object.keys(e||{}).reduce(function(t,n){return t[e[n].name]=n,t},{})},r.prototype.mapNode=function(e){var t=BC(e.op)||this.opMappers[e.op]||{};e.attr==null&&(e.attr={});var n={name:e.name,op:e.op,category:t.category,inputNames:(e.input||[]).map(function(a){return a.startsWith("^")?a.slice(1):a}),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr,outputs:t.outputs};return t.inputs!=null&&(n.inputParams=t.inputs.reduce(function(a,i){return a[i.name]={type:i.type,inputIndexStart:i.start,inputIndexEnd:i.end},a},{})),t.attrs!=null&&(n.attrParams=t.attrs.reduce(function(a,i){var o=i.type,s=void 0;switch(i.type){case"string":s=_y(e.attr,i.tfName,i.defaultValue),s===void 0&&i.tfDeprecatedName&&(s=_y(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"string[]":s=Ly(e.attr,i.tfName,i.defaultValue),s===void 0&&i.tfDeprecatedName&&(s=Ly(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"number":s=Ry(e.attr,i.tfName,i.defaultValue||0),s===void 0&&i.tfDeprecatedName&&(s=Ry(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"number[]":s=By(e.attr,i.tfName,i.defaultValue),s===void 0&&i.tfDeprecatedName&&(s=By(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"bool":s=Fy(e.attr,i.tfName,i.defaultValue),s===void 0&&i.tfDeprecatedName&&(s=Fy(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"bool[]":s=$y(e.attr,i.tfName,i.defaultValue),s===void 0&&i.tfDeprecatedName&&(s=$y(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"shape":s=My(e.attr,i.tfName,i.defaultValue),s===void 0&&i.tfDeprecatedName&&(s=My(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"shape[]":s=zy(e.attr,i.tfName,i.defaultValue),s===void 0&&i.tfDeprecatedName&&(s=zy(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"dtype":s=Oy(e.attr,i.tfName,i.defaultValue),s===void 0&&i.tfDeprecatedName&&(s=Oy(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"dtype[]":s=Py(e.attr,i.tfName,i.defaultValue),s===void 0&&i.tfDeprecatedName&&(s=Py(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"func":s=sC(e.attr,i.tfName,i.defaultValue),s===void 0&&i.tfDeprecatedName&&(s=sC(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error("Unsupported param type: ".concat(i.type," for op: ").concat(e.op))}return a[i.name]={value:s,type:o},a},{})),n},r.prototype.mapFunction=function(e){var t=this,n=e.nodeDef,a=[],i=[],o={};n!=null&&(o=n.reduce(function(h,p){return h[p.name]=t.mapNode(p),p.op==="Const"&&i.push(h[p.name]),h},{}));var s=[],u=[];e.signature.inputArg.forEach(function(h){var p=be(Pi(h.name),1),d=p[0],m={name:d,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:n0(h.type),type:"dtype"}},children:[]};m.signatureKey=h.name,s.push(m),o[d]=m});var c=Object.keys(o);c.forEach(function(h){var p=o[h];p.inputNames.forEach(function(d,m){var v=be(Pi(d),3),g=v[0],y=v[2],w=o[g];if(w.outputs!=null){var b=w.outputs.indexOf(y);if(b!==-1){var x="".concat(g,":").concat(b);p.inputNames[m]=x}}p.inputs.push(w),w.children.push(p)})});var l=e.ret;e.signature.outputArg.forEach(function(h){var p=be(Pi(l[h.name]),2),d=p[0],m=p[1],v=o[d];v!=null&&(v.defaultOutput=m,u.push(v))});var f=this.mapArgsToSignature(e);return{nodes:o,inputs:s,outputs:u,weights:i,placeholders:a,signature:f}},r.prototype.mapArgsToSignature=function(e){var t=this;return{methodName:e.signature.name,inputs:e.signature.inputArg.reduce(function(n,a){return n[a.name]=t.mapArgToTensorInfo(a),n},{}),outputs:e.signature.outputArg.reduce(function(n,a){return n[a.name]=t.mapArgToTensorInfo(a,e.ret),n},{})}},r.prototype.mapArgToTensorInfo=function(e,t){var n=e.name;return t!=null&&(n=t[n]),{name:n,dtype:e.type}},r})();function xte(r){var e=Me.env().global;if(typeof e.atob<"u")return e.atob(r);if(typeof Buffer<"u")return new Buffer(r,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}function LC(r,e){var t=Array.isArray(r)?String.fromCharCode.apply(null,r):xte(r);return e?t:t.toLowerCase()}function _y(r,e,t,n){n===void 0&&(n=!1);var a=r[e];return a!=null?LC(a.s,n):t}function Fy(r,e,t){var n=r[e];return n?n.b:t}function Ry(r,e,t){var n=r[e]||{},a=n.i!=null?n.i:n.f!=null?n.f:t;return typeof a=="number"?a:parseInt(a,10)}function n0(r){switch(typeof r=="string"&&(r=Ln[r]),r){case Ln.DT_FLOAT:case Ln.DT_HALF:return"float32";case Ln.DT_INT32:case Ln.DT_INT64:case Ln.DT_INT8:case Ln.DT_UINT8:return"int32";case Ln.DT_BOOL:return"bool";case Ln.DT_DOUBLE:return"float32";case Ln.DT_STRING:return"string";case Ln.DT_COMPLEX64:case Ln.DT_COMPLEX128:return"complex64";default:return null}}function sC(r,e,t){var n=r[e];return n&&n.func?n.func.name:t}function Oy(r,e,t){var n=r[e];return n&&n.type?n0(n.type):t}function Py(r,e,t){var n=r[e];return n&&n.list&&n.list.type?n.list.type.map(function(a){return n0(a)}):t}function zC(r){if(!r.unknownRank)return r.dim!=null?r.dim.map(function(e){return typeof e.size=="number"?e.size:parseInt(e.size,10)}):[]}function My(r,e,t){var n=r[e];return n&&n.shape?zC(n.shape):t}function By(r,e,t){var n=r[e];return n?((n.list.f&&n.list.f.length?n.list.f:n.list.i)||[]).map(function(a){return typeof a=="number"?a:parseInt(a,10)}):t}function Ly(r,e,t,n){n===void 0&&(n=!1);var a=r[e];return a&&a.list&&a.list.s?a.list.s.map(function(i){return LC(i,n)}):t}function zy(r,e,t){var n=r[e];return n&&n.list&&n.list.shape?n.list.shape.map(function(a){return zC(a)}):t}function $y(r,e,t){var n=r[e];return n&&n.list&&n.list.b?n.list.b:t}var kte=(function(){function r(e,t,n){var a=this;this.node=e,this.tensorMap=t,this.context=n,this.inputs=[],this.attrs={},this.inputs=e.inputNames.map(function(i){return a.getInput(i)}),e.rawAttrs!=null&&(this.attrs=Object.keys(e.rawAttrs).reduce(function(i,o){return i[o]=a.getAttr(o),i},{}))}return r.prototype.getInput=function(e){return Kr(e,this.tensorMap,this.context)},r.prototype.getAttr=function(e,t){var n=this.node.rawAttrs[e];if(n.tensor!=null)return Kr(e,this.tensorMap,this.context);if(n.i!=null||n.f!=null)return Ry(this.node.rawAttrs,e,t);if(n.s!=null)return _y(this.node.rawAttrs,e,t);if(n.b!=null)return Fy(this.node.rawAttrs,e,t);if(n.shape!=null)return My(this.node.rawAttrs,e,t);if(n.type!=null)return Oy(this.node.rawAttrs,e,t);if(n.list!=null){if(n.list.i!=null||n.list.f!=null)return By(this.node.rawAttrs,e,t);if(n.list.s!=null)return Ly(this.node.rawAttrs,e,t);if(n.list.shape!=null)return zy(this.node.rawAttrs,e,t);if(n.list.b!=null)return $y(this.node.rawAttrs,e,t);if(n.list.type!=null)return Py(this.node.rawAttrs,e,t)}return t},r})();var Ste=1e-7,Ete=1e-4,Tte=(function(){function r(){}return r.prototype.refCount=function(e){return Bn("refCount")},r.prototype.incRef=function(e){return Bn("incRef")},r.prototype.timerAvailable=function(){return!0},r.prototype.time=function(e){return Bn("time")},r.prototype.read=function(e){return Bn("read")},r.prototype.readSync=function(e){return Bn("readSync")},r.prototype.readToGPU=function(e,t){return Bn("readToGPU")},r.prototype.numDataIds=function(){return Bn("numDataIds")},r.prototype.disposeData=function(e,t){return Bn("disposeData")},r.prototype.write=function(e,t,n){return Bn("write")},r.prototype.move=function(e,t,n,a,i){return Bn("move")},r.prototype.createTensorFromGPUData=function(e,t,n){return Bn("createTensorFromGPUData")},r.prototype.memory=function(){return Bn("memory")},r.prototype.floatPrecision=function(){return Bn("floatPrecision")},r.prototype.epsilon=function(){return this.floatPrecision()===32?Ste:Ete},r.prototype.dispose=function(){return Bn("dispose")},r})();function Bn(r){throw new Error("'".concat(r,"' not yet implemented or not found in the registry. ")+"This kernel may not be supported by the tfjs backend you have chosen")}function U(r,e){if(!r)throw new Error(typeof e=="string"?e:e())}function _a(r,e,t){t===void 0&&(t=""),U(ys(r,e),function(){return t+" Shapes ".concat(r," and ").concat(e," must match")})}function Ru(r){U(r!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function Br(r){if(r.length===0)return 1;for(var e=r[0],t=1;t<r.length;t++)e*=r[t];return e}function Nte(r,e){if(r===e)return!0;if(r==null||e==null||r.length!==e.length)return!1;for(var t=0;t<r.length;t++)if(r[t]!==null&&e[t]!==null&&r[t]!==e[t])return!1;return!0}function ys(r,e){if(r===e)return!0;if(r==null||e==null||r.length!==e.length)return!1;for(var t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}function Il(r){return r%1===0}function cp(r,e){return e<=r.length?r:r+" ".repeat(e-r.length)}function Ep(r,e){var t=e.length;return r=r==null?e.map(function(n,a){return a}):[].concat(r),U(r.every(function(n){return n>=-t&&n<t}),function(){return"All values in axis param must be in range [-".concat(t,", ").concat(t,") but ")+"got axis ".concat(r)}),U(r.every(function(n){return Il(n)}),function(){return"All values in axis param must be integers but "+"got axis ".concat(r)}),r.map(function(n){return n<0?t+n:n})}function Ite(r,e){for(var t=[],n=[],a=e!=null&&Array.isArray(e)&&e.length===0,i=e==null||a?null:Ep(e,r).sort(),o=0,s=0;s<r.length;++s){if(i!=null){if(i[o]===s&&r[s]!==1)throw new Error("Can't squeeze axis ".concat(s," since its dim '").concat(r[s],"' is not 1"));(i[o]==null||i[o]>s)&&r[s]===1&&(t.push(r[s]),n.push(s)),i[o]<=s&&o++}r[s]!==1&&(t.push(r[s]),n.push(s))}return{newShape:t,keptDims:n}}function Cte(r,e){return $C(r,e)}function $C(r,e){var t=null;if(r==null||r==="float32")t=new Float32Array(e);else if(r==="int32")t=new Int32Array(e);else if(r==="bool")t=new Uint8Array(e);else if(r==="string")t=new Array(e);else throw new Error("Unknown data type ".concat(r));return t}function Ate(r,e){for(var t=0;t<r.length;t++){var n=r[t];if(isNaN(n)||!isFinite(n))throw Error("A tensor of type ".concat(e," being uploaded contains ").concat(n,"."))}}function Dte(r){return r==="bool"||r==="complex64"||r==="float32"||r==="int32"||r==="string"}function Wy(r){if(r==="float32"||r==="int32")return 4;if(r==="complex64")return 8;if(r==="bool")return 1;throw new Error("Unknown dtype ".concat(r))}function _te(r){if(r==null)return 0;var e=0;return r.forEach(function(t){return e+=t.length}),e}function a0(r){return typeof r=="string"||r instanceof String}function Fte(r){return typeof r=="boolean"}function Rte(r){return typeof r=="number"}function Tp(r){return Array.isArray(r)?Tp(r[0]):r instanceof Float32Array?"float32":r instanceof Int32Array||r instanceof Uint8Array||r instanceof Uint8ClampedArray?"int32":Rte(r)?"float32":a0(r)?"string":Fte(r)?"bool":"float32"}function uC(r){return!!(r&&r.constructor&&r.call&&r.apply)}function i0(r){var e=r.length;if(e<2)return[];var t=new Array(e-1);t[e-2]=r[e-1];for(var n=e-3;n>=0;--n)t[n]=t[n+1]*r[n+1];return t}function WC(r,e,t,n){n===void 0&&(n=!1);var a=new Array;if(e.length===1)for(var i=e[0]*(n?2:1),o=0;o<i;o++)a[o]=t[r+o];else for(var i=e[0],s=e.slice(1),u=s.reduce(function(l,f){return l*f})*(n?2:1),o=0;o<i;o++)a[o]=WC(r+o*u,s,t,n);return a}function cC(r,e,t){if(t===void 0&&(t=!1),r.length===0)return e[0];var n=r.reduce(function(a,i){return a*i})*(t?2:1);if(n===0)return[];if(n!==e.length)throw new Error("[".concat(r,"] does not match the input size ").concat(e.length).concat(t?" for a complex tensor":"","."));return WC(0,r,e,t)}function GC(r,e){for(var t=o0(r,e),n=0;n<t.length;n++)t[n]=1;return t}function o0(r,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool")return new Uint8Array(r);throw new Error("Unknown data type ".concat(e))}function ra(r){r.forEach(function(e){U(Number.isInteger(e)&&e>=0,function(){return"Tensor must have a shape comprised of positive integers but got "+"shape [".concat(r,"].")})})}function s0(r){return r&&r.then&&typeof r.then=="function"}var lC="tfjsflags",Ote=(function(){function r(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=Pte,this.populateURLFlags()}return r.prototype.setPlatform=function(e,t){this.platform!=null&&(wn().getBool("IS_TEST")||wn().getBool("PROD")||console.warn("Platform ".concat(this.platformName," has already been set. ")+"Overwriting the platform with ".concat(e,"."))),this.platformName=e,this.platform=t},r.prototype.registerFlag=function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},this.urlFlags[e]!=null){var a=this.urlFlags[e];wn().getBool("IS_TEST")||wn().getBool("PROD")||console.warn("Setting feature override from URL ".concat(e,": ").concat(a,".")),this.set(e,a)}},r.prototype.getAsync=function(e){return yt(this,void 0,void 0,function(){var t,n;return gt(this,function(a){switch(a.label){case 0:return e in this.flags?[2,this.flags[e]]:(t=this.flags,n=e,[4,this.evaluateFlag(e)]);case 1:return t[n]=a.sent(),[2,this.flags[e]]}})})},r.prototype.get=function(e){if(e in this.flags)return this.flags[e];var t=this.evaluateFlag(e);if(s0(t))throw new Error("Flag ".concat(e," cannot be synchronously evaluated. ")+"Please use getAsync() instead.");return this.flags[e]=t,this.flags[e]},r.prototype.getNumber=function(e){return this.get(e)},r.prototype.getBool=function(e){return this.get(e)},r.prototype.getString=function(e){return this.get(e)},r.prototype.getFlags=function(){return this.flags},Object.defineProperty(r.prototype,"features",{get:function(){return this.flags},enumerable:!1,configurable:!0}),r.prototype.set=function(e,t){if(this.flagRegistry[e]==null)throw new Error("Cannot set flag ".concat(e," as it has not been registered."));this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)},r.prototype.evaluateFlag=function(e){if(this.flagRegistry[e]==null)throw new Error("Cannot evaluate flag '".concat(e,"': no evaluation function found."));return this.flagRegistry[e].evaluationFn()},r.prototype.setFlags=function(e){this.flags=Object.assign({},e)},r.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},r.prototype.populateURLFlags=function(){var e=this;if(!(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")){var t=this.getQueryParams(this.global.location.search);if(lC in t){var n=t[lC].split(",");n.forEach(function(a){var i=be(a.split(":"),2),o=i[0],s=i[1];e.urlFlags[o]=Bte(o,s)})}}},r})();function Pte(r){var e={};return r.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(t){for(var n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];return Mte(e,n[0],n[1]),n.join("=")}),e}function Mte(r,e,t){r[decodeURIComponent(e)]=decodeURIComponent(t||"")}function Bte(r,e){var t=e.toLowerCase();return t==="true"||t==="false"?t==="true":"".concat(+t)===t?+t:e}function wn(){return VC}var VC=null;function Lte(r){VC=r}var Ty;function UC(){if(Ty==null){var r=void 0;if(typeof window<"u")r=window;else if(typeof global<"u")r=global;else if(typeof process<"u")r=process;else if(typeof self<"u")r=self;else throw new Error("Could not find a global object");Ty=r}return Ty}function zte(){var r=UC();return r._tfGlobals==null&&(r._tfGlobals=new Map),r._tfGlobals}function u0(r,e){var t=zte();if(t.has(r))return t.get(r);var n=e();return t.set(r,n),t.get(r)}var $te="Abs",Wte="Acos",Gte="Acosh",HC="Add",Vte="AddN",Ute="All",Hte="Any",qte="ArgMax",Kte="ArgMin",jte="Asin",Xte="Asinh",Yte="Atan",Zte="Atanh",Jte="Atan2",Qte="AvgPool",ere="AvgPool3D",tre="BatchMatMul",rre="BatchToSpaceND",nre="Bincount",are="BitwiseAnd",ire="BroadcastArgs",qC="Cast",ore="Ceil",sre="ClipByValue",ure="Complex",cre="ComplexAbs",lre="Concat",fre="Conv2D",hre="Conv2DBackpropFilter",pre="Conv2DBackpropInput",dre="Conv3D",vre="Conv3DBackpropInputV2",mre="Cos",gre="Cosh",yre="Cumprod",bre="Cumsum",wre="CropAndResize",xre="DenseBincount",kre="DepthToSpace",Sre="DepthwiseConv2dNative",Ere="DepthwiseConv2dNativeBackpropFilter",Tre="DepthwiseConv2dNativeBackpropInput",Nre="Diag",Ire="Dilation2D",Cre="RealDiv",Are="Einsum",Dre="Elu",_re="Erf",Fre="Equal",Rre="Exp",Ore="ExpandDims",Pre="Expm1",Mre="FFT",Bre="Fill",Lre="FlipLeftRight",zre="Floor",$re="FloorDiv",Wre="FusedBatchNorm",Gre="GatherV2",Vre="GatherNd",Ure="Greater",Hre="GreaterEqual",KC="Identity",qre="IFFT",Kre="Imag",jre="IsFinite",Xre="IsInf",Yre="IsNan",Zre="LeakyRelu",Jre="Less",Qre="LessEqual",ene="LinSpace",tne="Log",rne="Log1p",nne="LogicalAnd",ane="LogicalNot",ine="LogicalOr",one="LRN",sne="Max",une="Maximum",cne="MaxPool",lne="MaxPool3D",fne="MaxPoolWithArgmax",hne="Mean",pne="Min",dne="Minimum",vne="MirrorPad",mne="Mod",gne="Multinomial",yne="Multiply",bne="Neg",wne="NotEqual",xne="NonMaxSuppressionV3",kne="NonMaxSuppressionV4",Sne="NonMaxSuppressionV5",Ene="OnesLike",Tne="OneHot",Nne="Pack",Ine="PadV2",Cne="Pow",Ane="Prelu",Dne="Prod",_ne="RaggedGather",Fne="RaggedRange",Rne="RaggedTensorToTensor",One="Range",Pne="Real",Mne="Reciprocal",Bne="Relu",Lne="Reshape",zne="ResizeNearestNeighbor",$ne="ResizeBilinear",Wne="Relu6",Gne="Reverse",Vne="Round",Une="Rsqrt",Hne="ScatterNd",qne="TensorScatterUpdate",Kne="SearchSorted",jne="Select",Xne="Selu",Yne="Slice",Zne="Sin",Jne="Sinh",Qne="Sign",eae="Sigmoid",tae="Softplus",rae="Sqrt",nae="Sum",aae="SpaceToBatchND",iae="SplitV",oae="Softmax",sae="SparseFillEmptyRows",uae="SparseReshape",cae="SparseSegmentMean",lae="SparseSegmentSum",fae="SparseToDense",hae="SquaredDifference",pae="StaticRegexReplace",dae="StridedSlice",vae="StringNGrams",mae="StringSplit",gae="StringToHashBucketFast",yae="Sub",bae="Tan",wae="Tanh",jC="Tile",xae="TopK",kae="Transform",Ny="Transpose",Sae="Unique",Eae="Unpack",Tae="UnsortedSegmentSum",Nae="ZerosLike",Iae="Step",Cae="RotateWithOffset",fC="_FusedMatMul",hC="FusedConv2D",pC="FusedDepthwiseConv2D";function bl(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];wn().getBool("IS_TEST")||wn().getBool("PROD")||console.warn.apply(console,Et([],be(r),!1))}var XC=u0("kernelRegistry",function(){return new Map}),Aae=u0("gradRegistry",function(){return new Map});function dC(r,e){var t=Dae(r,e);return XC.get(t)}function vC(r){return Aae.get(r)}function mC(r){for(var e=XC.entries(),t=[];;){var n=e.next(),a=n.done,i=n.value;if(a)break;var o=be(i,2),s=o[0],u=o[1],c=be(s.split("_"),1),l=c[0];l===r&&t.push(u)}return t}function Dae(r,e){return"".concat(e,"_").concat(r)}function _ae(r){return r instanceof Float32Array||r instanceof Int32Array||r instanceof Uint8Array||r instanceof Uint8ClampedArray}var bs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Fae(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function Rae(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var t=function n(){if(this instanceof n){var a=[null];a.push.apply(a,arguments);var i=Function.bind.apply(e,a);return new i}return e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var a=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,a.get?a:{enumerable:!0,get:function(){return r[n]}})}),t}var YC=Kt,Ia=null;try{Ia=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function Kt(r,e,t){this.low=r|0,this.high=e|0,this.unsigned=!!t}Kt.prototype.__isLong__;Object.defineProperty(Kt.prototype,"__isLong__",{value:!0});function Vn(r){return(r&&r.__isLong__)===!0}Kt.isLong=Vn;var gC={},yC={};function ws(r,e){var t,n,a;return e?(r>>>=0,(a=0<=r&&r<256)&&(n=yC[r],n)?n:(t=jt(r,(r|0)<0?-1:0,!0),a&&(yC[r]=t),t)):(r|=0,(a=-128<=r&&r<128)&&(n=gC[r],n)?n:(t=jt(r,r<0?-1:0,!1),a&&(gC[r]=t),t))}Kt.fromInt=ws;function Ca(r,e){if(isNaN(r))return e?ds:Aa;if(e){if(r<0)return ds;if(r>=ZC)return eA}else{if(r<=-wC)return Wn;if(r+1>=wC)return QC}return r<0?Ca(-r,e).neg():jt(r%Du|0,r/Du|0,e)}Kt.fromNumber=Ca;function jt(r,e,t){return new Kt(r,e,t)}Kt.fromBits=jt;var pp=Math.pow;function c0(r,e,t){if(r.length===0)throw Error("empty string");if(r==="NaN"||r==="Infinity"||r==="+Infinity"||r==="-Infinity")return Aa;if(typeof e=="number"?(t=e,e=!1):e=!!e,t=t||10,t<2||36<t)throw RangeError("radix");var n;if((n=r.indexOf("-"))>0)throw Error("interior hyphen");if(n===0)return c0(r.substring(1),e,t).neg();for(var a=Ca(pp(t,8)),i=Aa,o=0;o<r.length;o+=8){var s=Math.min(8,r.length-o),u=parseInt(r.substring(o,o+s),t);if(s<8){var c=Ca(pp(t,s));i=i.mul(c).add(Ca(u))}else i=i.mul(a),i=i.add(Ca(u))}return i.unsigned=e,i}Kt.fromString=c0;function ti(r,e){return typeof r=="number"?Ca(r,e):typeof r=="string"?c0(r,e):jt(r.low,r.high,typeof e=="boolean"?e:r.unsigned)}Kt.fromValue=ti;var bC=65536,Oae=1<<24,Du=bC*bC,ZC=Du*Du,wC=ZC/2,xC=ws(Oae),Aa=ws(0);Kt.ZERO=Aa;var ds=ws(0,!0);Kt.UZERO=ds;var Tu=ws(1);Kt.ONE=Tu;var JC=ws(1,!0);Kt.UONE=JC;var Gy=ws(-1);Kt.NEG_ONE=Gy;var QC=jt(-1,2147483647,!1);Kt.MAX_VALUE=QC;var eA=jt(-1,-1,!0);Kt.MAX_UNSIGNED_VALUE=eA;var Wn=jt(0,-2147483648,!1);Kt.MIN_VALUE=Wn;var Re=Kt.prototype;Re.toInt=function(){return this.unsigned?this.low>>>0:this.low};Re.toNumber=function(){return this.unsigned?(this.high>>>0)*Du+(this.low>>>0):this.high*Du+(this.low>>>0)};Re.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Wn)){var t=Ca(e),n=this.div(t),a=n.mul(t).sub(this);return n.toString(e)+a.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var i=Ca(pp(e,6),this.unsigned),o=this,s="";;){var u=o.div(i),c=o.sub(u.mul(i)).toInt()>>>0,l=c.toString(e);if(o=u,o.isZero())return l+s;for(;l.length<6;)l="0"+l;s=""+l+s}};Re.getHighBits=function(){return this.high};Re.getHighBitsUnsigned=function(){return this.high>>>0};Re.getLowBits=function(){return this.low};Re.getLowBitsUnsigned=function(){return this.low>>>0};Re.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Wn)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return this.high!=0?t+33:t+1};Re.isZero=function(){return this.high===0&&this.low===0};Re.eqz=Re.isZero;Re.isNegative=function(){return!this.unsigned&&this.high<0};Re.isPositive=function(){return this.unsigned||this.high>=0};Re.isOdd=function(){return(this.low&1)===1};Re.isEven=function(){return(this.low&1)===0};Re.equals=function(e){return Vn(e)||(e=ti(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};Re.eq=Re.equals;Re.notEquals=function(e){return!this.eq(e)};Re.neq=Re.notEquals;Re.ne=Re.notEquals;Re.lessThan=function(e){return this.comp(e)<0};Re.lt=Re.lessThan;Re.lessThanOrEqual=function(e){return this.comp(e)<=0};Re.lte=Re.lessThanOrEqual;Re.le=Re.lessThanOrEqual;Re.greaterThan=function(e){return this.comp(e)>0};Re.gt=Re.greaterThan;Re.greaterThanOrEqual=function(e){return this.comp(e)>=0};Re.gte=Re.greaterThanOrEqual;Re.ge=Re.greaterThanOrEqual;Re.compare=function(e){if(Vn(e)||(e=ti(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};Re.comp=Re.compare;Re.negate=function(){return!this.unsigned&&this.eq(Wn)?Wn:this.not().add(Tu)};Re.neg=Re.negate;Re.add=function(e){Vn(e)||(e=ti(e));var t=this.high>>>16,n=this.high&65535,a=this.low>>>16,i=this.low&65535,o=e.high>>>16,s=e.high&65535,u=e.low>>>16,c=e.low&65535,l=0,f=0,h=0,p=0;return p+=i+c,h+=p>>>16,p&=65535,h+=a+u,f+=h>>>16,h&=65535,f+=n+s,l+=f>>>16,f&=65535,l+=t+o,l&=65535,jt(h<<16|p,l<<16|f,this.unsigned)};Re.subtract=function(e){return Vn(e)||(e=ti(e)),this.add(e.neg())};Re.sub=Re.subtract;Re.multiply=function(e){if(this.isZero())return Aa;if(Vn(e)||(e=ti(e)),Ia){var t=Ia.mul(this.low,this.high,e.low,e.high);return jt(t,Ia.get_high(),this.unsigned)}if(e.isZero())return Aa;if(this.eq(Wn))return e.isOdd()?Wn:Aa;if(e.eq(Wn))return this.isOdd()?Wn:Aa;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(xC)&&e.lt(xC))return Ca(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,a=this.high&65535,i=this.low>>>16,o=this.low&65535,s=e.high>>>16,u=e.high&65535,c=e.low>>>16,l=e.low&65535,f=0,h=0,p=0,d=0;return d+=o*l,p+=d>>>16,d&=65535,p+=i*l,h+=p>>>16,p&=65535,p+=o*c,h+=p>>>16,p&=65535,h+=a*l,f+=h>>>16,h&=65535,h+=i*c,f+=h>>>16,h&=65535,h+=o*u,f+=h>>>16,h&=65535,f+=n*l+a*c+i*u+o*s,f&=65535,jt(p<<16|d,f<<16|h,this.unsigned)};Re.mul=Re.multiply;Re.divide=function(e){if(Vn(e)||(e=ti(e)),e.isZero())throw Error("division by zero");if(Ia){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?Ia.div_u:Ia.div_s)(this.low,this.high,e.low,e.high);return jt(t,Ia.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?ds:Aa;var n,a,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return ds;if(e.gt(this.shru(1)))return JC;i=ds}else{if(this.eq(Wn)){if(e.eq(Tu)||e.eq(Gy))return Wn;if(e.eq(Wn))return Tu;var o=this.shr(1);return n=o.div(e).shl(1),n.eq(Aa)?e.isNegative()?Tu:Gy:(a=this.sub(e.mul(n)),i=n.add(a.div(e)),i)}else if(e.eq(Wn))return this.unsigned?ds:Aa;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=Aa}for(a=this;a.gte(e);){n=Math.max(1,Math.floor(a.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(n)/Math.LN2),u=s<=48?1:pp(2,s-48),c=Ca(n),l=c.mul(e);l.isNegative()||l.gt(a);)n-=u,c=Ca(n,this.unsigned),l=c.mul(e);c.isZero()&&(c=Tu),i=i.add(c),a=a.sub(l)}return i};Re.div=Re.divide;Re.modulo=function(e){if(Vn(e)||(e=ti(e)),Ia){var t=(this.unsigned?Ia.rem_u:Ia.rem_s)(this.low,this.high,e.low,e.high);return jt(t,Ia.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};Re.mod=Re.modulo;Re.rem=Re.modulo;Re.not=function(){return jt(~this.low,~this.high,this.unsigned)};Re.and=function(e){return Vn(e)||(e=ti(e)),jt(this.low&e.low,this.high&e.high,this.unsigned)};Re.or=function(e){return Vn(e)||(e=ti(e)),jt(this.low|e.low,this.high|e.high,this.unsigned)};Re.xor=function(e){return Vn(e)||(e=ti(e)),jt(this.low^e.low,this.high^e.high,this.unsigned)};Re.shiftLeft=function(e){return Vn(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?jt(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):jt(0,this.low<<e-32,this.unsigned)};Re.shl=Re.shiftLeft;Re.shiftRight=function(e){return Vn(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?jt(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):jt(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};Re.shr=Re.shiftRight;Re.shiftRightUnsigned=function(e){if(Vn(e)&&(e=e.toInt()),e&=63,e===0)return this;var t=this.high;if(e<32){var n=this.low;return jt(n>>>e|t<<32-e,t>>>e,this.unsigned)}else return e===32?jt(t,0,this.unsigned):jt(t>>>e-32,0,this.unsigned)};Re.shru=Re.shiftRightUnsigned;Re.shr_u=Re.shiftRightUnsigned;Re.toSigned=function(){return this.unsigned?jt(this.low,this.high,!1):this};Re.toUnsigned=function(){return this.unsigned?this:jt(this.low,this.high,!0)};Re.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};Re.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};Re.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};Kt.fromBytes=function(e,t,n){return n?Kt.fromBytesLE(e,t):Kt.fromBytesBE(e,t)};Kt.fromBytesLE=function(e,t){return new Kt(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)};Kt.fromBytesBE=function(e,t){return new Kt(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};var tA=Fae(YC),Pae=Ree({__proto__:null,default:tA},[YC]),Mae=tA||Pae;function l0(r){return Mae.fromString(r,!0,16)}l0("c3a5c85c97cb3127");l0("b492b66fbe98f273");l0("9ae16a3b2f90404f");function Bae(r,e){return r instanceof Float32Array&&e==="float32"||r instanceof Int32Array&&e==="int32"||r instanceof Uint8Array&&e==="bool"}function rA(r,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(r)&&(r=Cl(r)),wn().getBool("DEBUG")&&Ate(r,e),Bae(r,e))return r;if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool"){for(var t=new Uint8Array(r.length),n=0;n<t.length;++n)Math.round(r[n])!==0&&(t[n]=1);return t}else throw new Error("Unknown data type ".concat(e))}function dp(){return wn().platform.now()}function Lae(r,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",wn().platform.encode(r,e)}function kC(r,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",wn().platform.decode(r,e)}function ei(r){return wn().platform.isTypedArray!=null?wn().platform.isTypedArray(r):_ae(r)}function Cl(r,e,t){var n,a;if(e===void 0&&(e=[]),t===void 0&&(t=!1),e==null&&(e=[]),typeof r=="boolean"||typeof r=="number"||typeof r=="string"||s0(r)||r==null||ei(r)&&t)e.push(r);else if(Array.isArray(r)||ei(r))for(var i=0;i<r.length;++i)Cl(r[i],e,t);else{var o=-1;try{for(var s=_r(Object.keys(r)),u=s.next();!u.done;u=s.next()){var c=u.value;/^([1-9]+[0-9]*|0)$/.test(c)&&(o=Math.max(o,Number(c)))}}catch(l){n={error:l}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(n)throw n.error}}for(var i=0;i<=o;i++)Cl(r[i],e,t)}return e}var zae=(function(){function r(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new Wae)}return r.prototype.profileKernel=function(e,t,n){var a,i,o,s=function(){o=n()},u,c=dp();if(this.backendTimer.timerAvailable())u=this.backendTimer.time(s);else{s();try{for(var l=_r(o),f=l.next();!f.done;f=l.next()){var h=f.value;h.dataSync()}}catch(v){a={error:v}}finally{try{f&&!f.done&&(i=l.return)&&i.call(l)}finally{if(a)throw a.error}}u=Promise.resolve({kernelMs:dp()-c})}if(wn().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(var p=function(v){var g=o[v];g.data().then(function(y){$ae(y,g.dtype,e)})},d=0;d<o.length;d++)p(d);var m={kernelName:e,outputs:o,inputs:t,timeMs:u.then(function(v){return v.kernelMs}),extraInfo:u.then(function(v){return v.getExtraProfileInfo!=null?v.getExtraProfileInfo():""})};return m},r.prototype.logKernelProfile=function(e){var t=this,n=e.kernelName,a=e.outputs,i=e.timeMs,o=e.inputs,s=e.extraInfo;a.forEach(function(u){Promise.all([u.data(),i,s]).then(function(c){t.logger.logKernelProfile(n,u,c[0],c[1],o,c[2])})})},r})();function $ae(r,e,t){if(e!=="float32")return!1;for(var n=0;n<r.length;n++){var a=r[n];if(isNaN(a)||!isFinite(a))return console.warn("Found ".concat(a," in the result of '").concat(t,"'")),!0}return!1}var Wae=(function(){function r(){}return r.prototype.logKernelProfile=function(e,t,n,a,i,o){var s=typeof a=="number"?cp("".concat(a,"ms"),9):a.error,u=cp(e,25),c=t.rank,l=t.size,f=cp(t.shape.toString(),14),h="";for(var p in i){var d=i[p];if(d!=null){var m=d.shape||t.shape,v=m.length;h+="".concat(p,": ").concat(v,"D ").concat(v>0?m:""," ")}}console.log("%c".concat(u,"	%c").concat(s,"	%c").concat(c,"D ").concat(f,"	%c").concat(l,"	%c").concat(h,"	%c").concat(o),"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},r})();function Gae(r,e,t){for(var n={},a={},i=0;i<e.length;i++)n[e[i].id]=!0;for(var i=0;i<r.length;i++){var o=r[i],s=o.inputs;for(var u in s){for(var c=s[u],l=!1,f=0;f<e.length;f++)if(n[c.id]){o.outputs.forEach(function(w){return n[w.id]=!0}),l=!0,a[o.id]=!0;break}if(l)break}}var h={};h[t.id]=!0;for(var p={},i=r.length-1;i>=0;i--)for(var o=r[i],s=o.inputs,f=0;f<o.outputs.length;f++)if(h[o.outputs[f].id]){for(var u in s)h[s[u].id]=!0,p[o.id]=!0;break}for(var d=[],i=0;i<r.length;i++){var o=r[i];if(a[o.id]&&p[o.id]){var m={};for(var u in o.inputs){var v=o.inputs[u];n[v.id]&&(m[u]=v)}var g=Object.assign({},o);g.inputs=m,g.outputs=o.outputs,d.push(g)}}return d}function Vae(r,e,t,n){for(var a=function(o){var s=e[o],u=[];if(s.outputs.forEach(function(h){var p=r[h.id];p!=null?u.push(p):u.push(null)}),s.gradient==null)throw new Error("Cannot compute gradient: gradient function not found "+"for ".concat(s.kernelName,"."));var c=s.gradient(u),l=function(h){if(!(h in c))throw new Error("Cannot backprop through input ".concat(h,". ")+"Available gradients found: ".concat(Object.keys(c),"."));var p=t(function(){return c[h]()});if(p.dtype!=="float32")throw new Error("Error in gradient for op ".concat(s.kernelName,". The gradient of input ")+"".concat(h," must have 'float32' dtype, but has '").concat(p.dtype,"'"));var d=s.inputs[h];if(!ys(p.shape,d.shape))throw new Error("Error in gradient for op ".concat(s.kernelName,". The gradient of input ")+"'".concat(h,"' has shape '").concat(p.shape,"', which does not match ")+"the shape of the input '".concat(d.shape,"'"));if(r[d.id]==null)r[d.id]=p;else{var m=r[d.id];r[d.id]=n(m,p),m.dispose()}};for(var f in s.inputs)l(f)},i=e.length-1;i>=0;i--)a(i)}var SC=20,wl=3,Iy=7;function Uae(r,e,t,n){var a=i0(e),i=Hae(r,e,t,a),o=e.length,s=lp(r,e,t,a,i),u=["Tensor"];return n&&(u.push("  dtype: ".concat(t)),u.push("  rank: ".concat(o)),u.push("  shape: [".concat(e,"]")),u.push("  values:")),u.push(s.map(function(c){return"    "+c}).join(`
`)),u.join(`
`)}function Hae(r,e,t,n){var a=Br(e),i=n[n.length-1],o=new Array(i).fill(0),s=e.length,u=t==="complex64"?El(r):r;if(s>1)for(var c=0;c<a/i;c++)for(var l=c*i,f=0;f<i;f++)o[f]=Math.max(o[f],Sl(u[l+f],0,t).length);return o}function Sl(r,e,t){var n;return Array.isArray(r)?n="".concat(parseFloat(r[0].toFixed(Iy))," + ")+"".concat(parseFloat(r[1].toFixed(Iy)),"j"):a0(r)?n="'".concat(r,"'"):t==="bool"?n=nA(r):n=parseFloat(r.toFixed(Iy)).toString(),cp(n,e)}function nA(r){return r===0?"false":"true"}function lp(r,e,t,n,a,i){i===void 0&&(i=!0);var o=t==="complex64"?2:1,s=e[0],u=e.length;if(u===0){if(t==="complex64"){var c=El(r);return[Sl(c[0],0,t)]}return t==="bool"?[nA(r[0])]:[r[0].toString()]}if(u===1){if(s>SC){var l=wl*o,f=Array.from(r.slice(0,l)),h=Array.from(r.slice((s-wl)*o,s*o));return t==="complex64"&&(f=El(f),h=El(h)),["["+f.map(function(T,N){return Sl(T,a[N],t)}).join(", ")+", ..., "+h.map(function(T,N){return Sl(T,a[s-wl+N],t)}).join(", ")+"]"]}var p=t==="complex64"?El(r):Array.from(r);return["["+p.map(function(T,N){return Sl(T,a[N],t)}).join(", ")+"]"]}var d=e.slice(1),m=n.slice(1),v=n[0]*o,g=[];if(s>SC){for(var y=0;y<wl;y++){var w=y*v,b=w+v;g.push.apply(g,Et([],be(lp(r.slice(w,b),d,t,m,a,!1)),!1))}g.push("...");for(var y=s-wl;y<s;y++){var w=y*v,b=w+v;g.push.apply(g,Et([],be(lp(r.slice(w,b),d,t,m,a,y===s-1)),!1))}}else for(var y=0;y<s;y++){var w=y*v,b=w+v;g.push.apply(g,Et([],be(lp(r.slice(w,b),d,t,m,a,y===s-1)),!1))}var x=u===2?",":"";g[0]="["+(s>0?g[0]+x:"");for(var y=1;y<g.length-1;y++)g[y]=" "+g[y]+x;for(var S=`,
`,y=2;y<u;y++)S+=`
`;return g[g.length-1]=" "+g[g.length-1]+"]"+(i?"":S),g}function El(r){for(var e=[],t=0;t<r.length;t+=2)e.push([r[t],r[t+1]]);return e}var Vy=(function(){function r(e,t,n){var a=this;if(this.dtype=t,this.shape=e.slice(),this.size=Br(e),n!=null){var i=n.length;U(i===this.size,function(){return"Length of values '".concat(i,"' does not match the size ")+"inferred by the shape '".concat(a.size,"'.")})}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||$C(t,this.size),this.strides=i0(e)}return r.prototype.set=function(e){for(var t=this,n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];n.length===0&&(n=[0]),U(n.length===this.rank,function(){return"The number of provided coordinates (".concat(n.length,") must ")+"match the rank (".concat(t.rank,")")});var i=this.locToIndex(n);this.values[i]=e},r.prototype.get=function(){for(var e,t,n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];n.length===0&&(n=[0]);var i=0;try{for(var o=_r(n),s=o.next();!s.done;s=o.next()){var u=s.value;if(u<0||u>=this.shape[i]){var c="Requested out of range element at ".concat(n,". ")+"  Buffer shape=".concat(this.shape);throw new Error(c)}i++}}catch(h){e={error:h}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}for(var l=n[n.length-1],f=0;f<n.length-1;++f)l+=this.strides[f]*n[f];return this.values[l]},r.prototype.locToIndex=function(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t},r.prototype.indexToLoc=function(e){if(this.rank===0)return[];if(this.rank===1)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t},Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!1,configurable:!0}),r.prototype.toTensor=function(){return Qa().makeTensor(this.values,this.shape,this.dtype)},r})(),Qa=null,xl=null;function qae(r){Qa=r}var $n=(function(){function r(e,t,n,a){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=Br(e),this.strides=i0(e),this.dataId=n,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}return Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!1,configurable:!0}),r.prototype.buffer=function(){return yt(this,void 0,void 0,function(){var e;return gt(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,xl.buffer(this.shape,this.dtype,e)]}})})},r.prototype.bufferSync=function(){return xl.buffer(this.shape,this.dtype,this.dataSync())},r.prototype.array=function(){return yt(this,void 0,void 0,function(){var e;return gt(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,cC(this.shape,e,this.dtype==="complex64")]}})})},r.prototype.arraySync=function(){return cC(this.shape,this.dataSync(),this.dtype==="complex64")},r.prototype.data=function(){return yt(this,void 0,void 0,function(){var e,t;return gt(this,function(n){switch(n.label){case 0:return this.throwIfDisposed(),e=Qa().read(this.dataId),this.dtype!=="string"?[3,2]:[4,e];case 1:t=n.sent();try{return[2,t.map(function(a){return kC(a)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}n.label=2;case 2:return[2,e]}})})},r.prototype.dataToGPU=function(e){return this.throwIfDisposed(),Qa().readToGPU(this.dataId,e)},r.prototype.dataSync=function(){this.throwIfDisposed();var e=Qa().readSync(this.dataId);if(this.dtype==="string")try{return e.map(function(t){return kC(t)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},r.prototype.bytes=function(){return yt(this,void 0,void 0,function(){var e;return gt(this,function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,Qa().read(this.dataId)];case 1:return e=t.sent(),this.dtype==="string"?[2,e]:[2,new Uint8Array(e.buffer)]}})})},r.prototype.dispose=function(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),Qa().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(r.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!1,configurable:!0}),r.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},r.prototype.print=function(e){return e===void 0&&(e=!1),xl.print(this,e)},r.prototype.clone=function(){return this.throwIfDisposed(),xl.clone(this)},r.prototype.toString=function(e){e===void 0&&(e=!1);var t=this.dataSync();return Uae(t,this.shape,this.dtype,e)},r.prototype.cast=function(e){return this.throwIfDisposed(),xl.cast(this,e)},r.prototype.variable=function(e,t,n){return e===void 0&&(e=!0),this.throwIfDisposed(),Qa().makeVariable(this,e,t,n)},r})();Object.defineProperty($n,Symbol.hasInstance,{value:function(r){return!!r&&r.data!=null&&r.dataSync!=null&&r.throwIfDisposed!=null}});function aA(){return u0("Tensor",function(){return $n})}aA();var Uy=(function(r){MC(e,r);function e(t,n,a,i){var o=r.call(this,t.shape,t.dtype,t.dataId,i)||this;return o.trainable=n,o.name=a,o}return e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value (".concat(t.dtype,") and ")+"previous value (".concat(this.dtype,") must match"));if(!ys(t.shape,this.shape))throw new Error("shape of the new value (".concat(t.shape,") and ")+"previous value (".concat(this.shape,") must match"));Qa().disposeTensor(this),this.dataId=t.dataId,Qa().incRef(this,null)},e.prototype.dispose=function(){Qa().disposeVariable(this),this.isDisposedInternal=!0},e})($n);Object.defineProperty(Uy,Symbol.hasInstance,{value:function(r){return r instanceof $n&&r.assign!=null&&r.assign instanceof Function}});var EC;(function(r){r.R0="R0",r.R1="R1",r.R2="R2",r.R3="R3",r.R4="R4",r.R5="R5",r.R6="R6"})(EC||(EC={}));var Hy;(function(r){r.float32="float32",r.int32="int32",r.bool="int32",r.complex64="complex64"})(Hy||(Hy={}));var qy;(function(r){r.float32="float32",r.int32="int32",r.bool="bool",r.complex64="complex64"})(qy||(qy={}));var Ky;(function(r){r.float32="float32",r.int32="float32",r.bool="float32",r.complex64="complex64"})(Ky||(Ky={}));var jy;(function(r){r.float32="complex64",r.int32="complex64",r.bool="complex64",r.complex64="complex64"})(jy||(jy={}));var Kae={float32:Ky,int32:Hy,bool:qy,complex64:jy};function jae(r,e){if(r==="string"||e==="string"){if(r==="string"&&e==="string")return"string";throw new Error("Can not upcast ".concat(r," with ").concat(e))}return Kae[r][e]}function iA(r){return r!=null&&typeof r=="object"&&"texture"in r&&r.texture instanceof WebGLTexture}function oA(r){return typeof GPUBuffer<"u"&&r!=null&&typeof r=="object"&&"buffer"in r&&r.buffer instanceof GPUBuffer}function dr(r,e){if(r.dtype===e.dtype)return[r,e];var t=jae(r.dtype,e.dtype);return[r.cast(t),e.cast(t)]}function Xae(r,e){U(r.dtype===e.dtype,function(){return"The dtypes of the first(".concat(r.dtype,") and")+" second(".concat(e.dtype,") input must match")})}function sA(r){var e=[],t=new Set;return uA(r,e,t),e}function uA(r,e,t){if(r!=null){if(r instanceof $n){e.push(r);return}if(Yae(r)){var n=r;for(var a in n){var i=n[a];t.has(i)||(t.add(i),uA(i,e,t))}}}}function Yae(r){return Array.isArray(r)||typeof r=="object"}function Cy(r){return r.kernelName!=null}var TC=(function(){function r(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(function(e){return e.name})))}}}return r.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},r})(),f0=(function(){function r(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new TC}return r.prototype.ready=function(){return yt(this,void 0,void 0,function(){var e,t,n,a;return gt(this,function(i){switch(i.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];e=this.getSortedBackends(),t=0,i.label=1;case 1:return t<e.length?(n=e[t],[4,this.initializeBackend(n).success]):[3,5];case 2:return a=i.sent(),a?[4,this.setBackend(n)]:[3,4];case 3:return i.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(r.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '".concat(this.backendName,"' has not yet been initialized. Make ")+"sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var e=this.initializeBackendsAndReturnBest(),t=e.name,n=e.asyncInit;if(n)throw new Error("The highest priority backend '".concat(t,"' has not yet been ")+"initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!1,configurable:!0}),r.prototype.backendNames=function(){return Object.keys(this.registryFactory)},r.prototype.findBackend=function(e){if(!(e in this.registry))if(e in this.registryFactory){var t=this.initializeBackend(e).asyncInit;if(t)return null}else return null;return this.registry[e]},r.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},r.prototype.registerBackend=function(e,t,n){return n===void 0&&(n=1),e in this.registryFactory?(bl("".concat(e," backend was already registered. ")+"Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)},r.prototype.setBackend=function(e){return yt(this,void 0,void 0,function(){var t,n,a,i,o;return gt(this,function(s){switch(s.label){case 0:if(this.registryFactory[e]==null)throw new Error("Backend name '".concat(e,"' not found in registry"));return this.backendName=e,this.registry[e]!=null?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),n=t.success,a=t.asyncInit,a?[4,n]:[3,2]);case 1:return o=s.sent(),[3,3];case 2:o=n,s.label=3;case 3:if(i=o,!i)return[2,!1];s.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new zae(this.backendInstance),[2,!0]}})})},r.prototype.setupRegisteredKernels=function(){var e=this,t=mC(this.backendName);t.forEach(function(n){n.setupFunc!=null&&n.setupFunc(e.backendInstance)})},r.prototype.disposeRegisteredKernels=function(e){var t=this,n=mC(e);n.forEach(function(a){a.disposeFunc!=null&&a.disposeFunc(t.registry[e])})},r.prototype.initializeBackend=function(e){var t=this,n=this.registryFactory[e];if(n==null)throw new Error("Cannot initialize backend ".concat(e,", no registration found."));try{var a=n.factory();if(a&&!(a instanceof Tte)&&typeof a.then=="function"){var i=++this.pendingBackendInitId,o=a.then(function(s){return i<t.pendingBackendInitId?!1:(t.registry[e]=s,t.pendingBackendInit=null,!0)}).catch(function(s){return i<t.pendingBackendInitId||(t.pendingBackendInit=null,bl("Initialization of backend ".concat(e," failed")),bl(s.stack||s.message)),!1});return this.pendingBackendInit=o,{success:o,asyncInit:!0}}else return this.registry[e]=a,{success:!0,asyncInit:!1}}catch(s){return bl("Initialization of backend ".concat(e," failed")),bl(s.stack||s.message),{success:!1,asyncInit:!1}}},r.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error("".concat(e," backend not found in registry"));this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},r.prototype.getSortedBackends=function(){var e=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority})},r.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],a=this.initializeBackend(n),i=a.success,o=a.asyncInit;if(o||i)return{name:n,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")},r.prototype.moveData=function(e,t){var n=this.state.tensorInfo.get(t),a=n.backend,i=this.readSync(t),o=a.refCount(t);a.disposeData(t,!0),n.backend=e,e.move(t,i,n.shape,n.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},r.prototype.tidy=function(e,t){var n=this,a=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}var i;return this.scopedRun(function(){return n.startScope(a)},function(){return n.endScope(i)},function(){return i=t(),i instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),i})},r.prototype.scopedRun=function(e,t,n){e();try{var a=n();return t(),a}catch(i){throw t(),i}},r.prototype.nextTensorId=function(){return r.nextTensorId++},r.prototype.nextVariableId=function(){return r.nextVariableId++},r.prototype.clone=function(e){var t=J.runKernel(KC,{x:e}),n={x:e},a=function(o){return{x:function(){var s="float32",u={x:o},c={dtype:s};return J.runKernel(qC,u,c)}}},i=[];return this.addTapeNode(this.state.activeScope.name,n,[t],a,i,{}),t},r.prototype.runKernel=function(e,t,n){this.backendName==null&&this.backend;var a=dC(e,this.backendName)!=null;if(!a)throw new Error("Kernel '".concat(e,"' not registered for backend '").concat(this.backendName,"'"));return this.runKernelFunc({kernelName:e,inputs:t,attrs:n})},r.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},r.prototype.checkKernelForMemLeak=function(e,t,n){var a=this.backend.numDataIds(),i=0;n.forEach(function(u){i+=u.dtype==="complex64"?3:1});var o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=a-t-i-o;if(s>0)throw new Error("Backend '".concat(this.backendName,"' has an internal memory leak ")+"(".concat(s," data ids) after running '").concat(e,"'"))},r.prototype.runKernelFunc=function(e){var t=this,n,a=[],i=this.isTapeOn(),o=this.state.numBytes,s=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var u;this.backendName==null&&this.backend;var c,l=Cy(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(Cy(e)){var f=e.kernelName,h=e.inputs,p=e.attrs;this.backendName==null&&this.backend;var d=dC(f,this.backendName);U(d!=null,function(){return"Cannot find registered kernel '".concat(f,"' for backend '").concat(t.backendName,"'")}),u=function(){var x=t.backend.numDataIds();c=d.kernelFunc({inputs:h,attrs:p,backend:t.backend});var S=Array.isArray(c)?c:[c];t.shouldCheckForMemLeaks()&&t.checkKernelForMemLeak(f,x,S);var T=S.map(function(C){return C.rank!=null?C:t.makeTensorFromTensorInfo(C)});if(i){var N=t.getTensorsForGradient(f,h,T);a=t.saveTensorsForBackwardMode(N)}return T}}else{var m=e.forwardFunc,v=function(x){i&&(a=x.map(function(S){return t.keep(t.clone(S))}))};u=function(){var x=t.backend.numDataIds();c=t.tidy(function(){return m(t.backend,v)});var S=Array.isArray(c)?c:[c];return t.shouldCheckForMemLeaks()&&t.checkKernelForMemLeak(l,x,S),S}}var g=e.inputs,y=e.attrs,w=Cy(e)?null:e.backwardsFunc,b;return this.scopedRun(function(){return t.state.kernelDepth++},function(){return t.state.kernelDepth--},function(){!t.ENV.getBool("DEBUG")&&!t.state.profiling?n=u():(b=t.profiler.profileKernel(l,g,function(){return u()}),t.ENV.getBool("DEBUG")&&t.profiler.logKernelProfile(b),n=b.outputs)}),i&&this.addTapeNode(l,g,n,w,a,y),this.state.profiling&&this.state.activeProfile.kernels.push({name:l,bytesAdded:this.state.numBytes-o,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-s,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(g).map(function(x){return g[x]!=null?g[x].shape:null}),outputShapes:n.map(function(x){return x.shape}),kernelTimeMs:b.timeMs,extraInfo:b.extraInfo}),Array.isArray(c)?n:n[0]},r.prototype.saveTensorsForBackwardMode=function(e){var t=this,n=e.map(function(a){return t.keep(t.clone(a))});return n},r.prototype.getTensorsForGradient=function(e,t,n){var a=vC(e);if(a!=null){var i=a.inputsToSave||[],o=a.outputsToSave||[],s=void 0;a.saveAllInputs?(U(Array.isArray(t),function(){return"saveAllInputs is true, expected inputs to be an array."}),s=Object.keys(t).map(function(c){return t[c]})):s=i.map(function(c){return t[c]});var u=n.filter(function(c,l){return o[l]});return s.concat(u)}return[]},r.prototype.makeTensor=function(e,t,n,a){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",a=a||this.backend;var i=e;n==="string"&&a0(e[0])&&(i=e.map(function(l){return Lae(l)}));var o=a.write(i,t,n),s=new $n(t,n,o,this.nextTensorId());if(this.trackTensor(s,a),n==="string"){var u=this.state.tensorInfo.get(o),c=_te(i);this.state.numBytes+=c-u.bytes,u.bytes=c}return s},r.prototype.makeTensorFromDataId=function(e,t,n,a){n=n||"float32";var i={dataId:e,shape:t,dtype:n};return this.makeTensorFromTensorInfo(i,a)},r.prototype.makeTensorFromTensorInfo=function(e,t){var n=e.dataId,a=e.shape,i=e.dtype,o=new $n(a,i,n,this.nextTensorId());return this.trackTensor(o,t),o},r.prototype.makeVariable=function(e,t,n,a){t===void 0&&(t=!0),n=n||this.nextVariableId().toString(),a!=null&&a!==e.dtype&&(e=e.cast(a));var i=new Uy(e,t,n,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error("Variable with name ".concat(i.name," was already registered"));return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i},r.prototype.trackTensor=function(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;var n=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(n=e.size*Wy(e.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n})),e instanceof Uy||this.track(e)},r.prototype.incRef=function(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)},r.prototype.removeDataId=function(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)},r.prototype.disposeTensor=function(e){if(this.state.tensorInfo.has(e.dataId)){var t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){var n=e.size*Wy(e.dtype);this.state.numBytes-=n}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}},r.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},r.prototype.disposeVariable=function(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]},r.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},r.prototype.profile=function(e){return yt(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l,f,h;return gt(this,function(p){switch(p.label){case 0:return this.state.profiling=!0,t=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],a=this.state.activeProfile,[4,e()];case 1:a.result=p.sent(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,Et([],be(this.state.activeProfile.kernels.map(function(d){return d.totalBytesSnapshot})),!1)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n,p.label=2;case 2:p.trys.push([2,8,9,10]),i=_r(this.state.activeProfile.kernels),o=i.next(),p.label=3;case 3:return o.done?[3,7]:(s=o.value,u=s,[4,s.kernelTimeMs]);case 4:return u.kernelTimeMs=p.sent(),c=s,[4,s.extraInfo];case 5:c.extraInfo=p.sent(),p.label=6;case 6:return o=i.next(),[3,3];case 7:return[3,10];case 8:return l=p.sent(),f={error:l},[3,10];case 9:try{o&&!o.done&&(h=i.return)&&h.call(i)}finally{if(f)throw f.error}return[7];case 10:return[2,this.state.activeProfile]}})})},r.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},r.prototype.addTapeNode=function(e,t,n,a,i,o){var s=this,u={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:i},c=vC(e);c!=null&&(a=c.gradFunc),a!=null&&(u.gradient=function(l){return l=l.map(function(f,h){if(f==null){var p=n[h],d=o0(p.size,p.dtype);return s.makeTensor(d,p.shape,p.dtype)}return f}),a(l.length>1?l:l[0],i,o)}),this.state.activeTape.push(u)},r.prototype.keep=function(e){return e.kept=!0,e},r.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},r.prototype.endTape=function(){this.state.gradientDepth--},r.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},r.prototype.endScope=function(e){for(var t=this,n=sA(e),a=new Set(n.map(function(u){return u.id})),i=0;i<this.state.activeScope.track.length;i++){var o=this.state.activeScope.track[i];!o.kept&&!a.has(o.id)&&o.dispose()}var s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(function(u){!u.kept&&u.scopeId===s.id&&t.track(u)})},r.prototype.gradients=function(e,t,n,a){var i=this;if(a===void 0&&(a=!1),U(t.length>0,function(){return"gradients() received an empty list of xs."}),n!=null&&n.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '".concat(n.dtype,"'"));var o=this.scopedRun(function(){return i.startTape()},function(){return i.endTape()},function(){return i.tidy("forward",e)});U(o instanceof $n,function(){return"The result y returned by f() must be a tensor."});var s=Gae(this.state.activeTape,t,o);if(!a&&s.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u={};u[o.id]=n??Zae(o.shape),Vae(u,s,function(l){return i.tidy(l)},Qae);var c=t.map(function(l){return u[l.id]});return i.state.gradientDepth===0&&(i.state.activeTape.forEach(function(l){var f,h;try{for(var p=_r(l.saved),d=p.next();!d.done;d=p.next()){var m=d.value;m.dispose()}}catch(v){f={error:v}}finally{try{d&&!d.done&&(h=p.return)&&h.call(p)}finally{if(f)throw f.error}}}),i.state.activeTape=null),{value:o,grads:c}})},r.prototype.customGrad=function(e){var t=this;return U(uC(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];U(n.every(function(c){return c instanceof $n}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var i,o={};n.forEach(function(c,l){o[l]=c});var s=function(c,l){return i=e.apply(void 0,Et([],be(Et(Et([],be(n),!1),[l],!1)),!1)),U(i.value instanceof $n,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),U(uC(i.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),i.value},u=function(c,l){var f=i.gradFunc(c,l),h=Array.isArray(f)?f:[f];U(h.length===n.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),U(h.every(function(d){return d instanceof $n}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var p={};return h.forEach(function(d,m){p[m]=function(){return d}}),p};return t.runKernelFunc({forwardFunc:s,backwardsFunc:u,inputs:o})}},r.prototype.readSync=function(e){var t=this.state.tensorInfo.get(e);return t.backend.readSync(e)},r.prototype.read=function(e){var t=this.state.tensorInfo.get(e);return t.backend.read(e)},r.prototype.readToGPU=function(e,t){var n=this.state.tensorInfo.get(e);return n.backend.readToGPU(e,t)},r.prototype.time=function(e){return yt(this,void 0,void 0,function(){var t,n;return gt(this,function(a){switch(a.label){case 0:return t=dp(),[4,this.backend.time(e)];case 1:return n=a.sent(),n.wallMs=dp()-t,[2,n]}})})},r.prototype.track=function(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(r.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!1,configurable:!0}),r.prototype.reset=function(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new TC;for(var e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},r})();f0.nextTensorId=0;f0.nextVariableId=0;function Zae(r){var e=GC(Br(r),"float32");return J.makeTensor(e,r,"float32")}function Jae(){var r=UC();if(r._tfengine==null){var e=new Ote(r);r._tfengine=new f0(e)}return Lte(r._tfengine.ENV),qae(function(){return r._tfengine}),r._tfengine}var J=Jae();function Qae(r,e){var t={a:r,b:e};return J.runKernel(HC,t)}function bo(r,e){var t=r;if(ei(r))return e==="string"?[]:[r.length];if(iA(r)){var n=r.channels||"RGBA";return[r.height,r.width*n.length]}else if(oA(r))return[r.buffer.size/(e==null?4:Wy(e))];if(!Array.isArray(r))return[];for(var a=[];Array.isArray(t)||ei(t)&&e!=="string";)a.push(t.length),t=t[0];return Array.isArray(r)&&wn().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&cA(r,a,[]),a}function cA(r,e,t){if(t=t||[],!Array.isArray(r)&&!ei(r)){U(e.length===0,function(){return"Element arr[".concat(t.join("]["),"] is a primitive, ")+"but should be an array/TypedArray of ".concat(e[0]," elements")});return}U(e.length>0,function(){return"Element arr[".concat(t.join("]["),"] should be a primitive, ")+"but is an array of ".concat(r.length," elements")}),U(r.length===e[0],function(){return"Element arr[".concat(t.join("]["),"] should have ").concat(e[0]," ")+"elements, but has ".concat(r.length," elements")});for(var n=e.slice(1),a=0;a<r.length;++a)cA(r[a],n,t.concat(a))}function NC(r,e,t,n){if(r!=="string_or_numeric"){if(r==null)throw new Error("Expected dtype cannot be null.");if(r!=="numeric"&&r!==e||r==="numeric"&&e==="string")throw new Error("Argument '".concat(t,"' passed to '").concat(n,"' must ")+"be ".concat(r," tensor, but got ").concat(e," tensor"))}}function M(r,e,t,n){if(n===void 0&&(n="numeric"),r instanceof aA())return NC(n,r.dtype,e,t),r;var a=Tp(r);if(a!=="string"&&["bool","int32","float32"].indexOf(n)>=0&&(a=n),NC(n,a,e,t),r==null||!ei(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string"){var i=r==null?"null":r.constructor.name;throw new Error("Argument '".concat(e,"' passed to '").concat(t,"' must be a ")+"Tensor or TensorLike, but got '".concat(i,"'"))}var o=bo(r,a);!ei(r)&&!Array.isArray(r)&&(r=[r]);var s=!0,u=a!=="string"?rA(r,a):Cl(r,[],s);return J.makeTensor(u,o,a)}function vp(r,e,t,n){if(n===void 0&&(n="numeric"),!Array.isArray(r))throw new Error("Argument ".concat(e," passed to ").concat(t," must be a ")+"`Tensor[]` or `TensorLike[]`");var a=r;return a.map(function(i,o){return M(i,"".concat(e,"[").concat(o,"]"),t,n)})}var lA="__op";function K(r){var e=Object.keys(r);if(e.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+"".concat(e.length," keys."));var t=e[0],n=r[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+lA;var a=function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];J.startScope(t);try{var s=n.apply(void 0,Et([],be(i),!1));return s0(s)&&console.error("Cannot return a Promise inside of tidy."),J.endScope(s),s}catch(u){throw J.endScope(null),u}};return Object.defineProperty(a,"name",{value:t,configurable:!0}),a}function eie(r){var e=M(r,"x","abs");if(e.dtype==="complex64"){var t={x:e};return J.runKernel(cre,t)}else{var t={x:e};return J.runKernel($te,t)}}var Ta=K({abs_:eie});function tie(r){var e=M(r,"x","acos"),t={x:e};return J.runKernel(Wte,t)}var rie=K({acos_:tie});function nie(r){var e=M(r,"x","acosh"),t={x:e};return J.runKernel(Gte,t)}var aie=K({acosh_:nie});function iie(r,e){var t,n=M(r,"a","add"),a=M(e,"b","add");t=be(dr(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return J.runKernel(HC,i)}var Lr=K({add_:iie});function oie(r){U(Array.isArray(r),function(){return"The argument passed to tf.addN() must be a list of tensors"}),U(r.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+"".concat(r.length)});var e=r.map(function(a,i){return M(a,"tensors".concat(i),"addN")}),t=e[0];e.forEach(function(a){if(a.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(function(a){if(!ys(a.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var n=e;return J.runKernel(Vte,n)}var sie=K({addN_:oie});function uie(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=M(r,"x","all","bool"),a={x:n},i={axis:e,keepDims:t};return J.runKernel(Ute,a,i)}var cie=K({all_:uie});function lie(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=M(r,"x","any","bool"),a={x:n},i={axis:e,keepDims:t};return J.runKernel(Hte,a,i)}var fie=K({any_:lie});function hie(r,e){e===void 0&&(e=0);var t=M(r,"x","argMax"),n={x:t},a={axis:e};return J.runKernel(qte,n,a)}var pie=K({argMax_:hie});function die(r,e){e===void 0&&(e=0);var t=M(r,"x","argMin"),n={x:t},a={axis:e};return J.runKernel(Kte,n,a)}var vie=K({argMin_:die});function mie(r){var e=M(r,"x","asin"),t={x:e};return J.runKernel(jte,t)}var gie=K({asin_:mie});function yie(r){var e=M(r,"x","asinh"),t={x:e};return J.runKernel(Xte,t)}var bie=K({asinh_:yie});function wie(r){var e=M(r,"x","atan"),t={x:e};return J.runKernel(Yte,t)}var xie=K({atan_:wie});function kie(r,e){var t,n=M(r,"a","atan2"),a=M(e,"b","atan2");t=be(dr(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return J.runKernel(Jte,i)}var Sie=K({atan2_:kie});function Eie(r){var e=M(r,"x","atanh"),t={x:e};return J.runKernel(Zte,t)}var Tie=K({atanh_:Eie});function Nie(r,e){var t=M(r,"x","cast");if(!Dte(e))throw new Error("Failed to cast to unknown dtype ".concat(e));if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");var n={x:t},a={dtype:e};return J.runKernel(qC,n,a)}var Fr=K({cast_:Nie});function Iie(r,e,t,n,a,i,o){o===void 0&&(o="channelsLast");var s=be(Al(e),2),u=s[0],c=s[1],l;if(o==="channelsLast")l=[u,c,r[3],r[3]];else if(o==="channelsFirst")l=[u,c,r[1],r[1]];else throw new Error("Unknown dataFormat ".concat(o));return h0(r,l,t,n,a,i,!1,o)}function h0(r,e,t,n,a,i,o,s){var u,c;o===void 0&&(o=!1),s===void 0&&(s="channelsLast");var l=be([-1,-1,-1,-1],4),f=l[0],h=l[1],p=l[2],d=l[3];if(s==="channelsLast")u=be(r,4),f=u[0],h=u[1],p=u[2],d=u[3];else if(s==="channelsFirst")c=be(r,4),f=c[0],d=c[1],h=c[2],p=c[3];else throw new Error("Unknown dataFormat ".concat(s));var m=be(e,4),v=m[0],g=m[1],y=m[3],w=be(Al(t),2),b=w[0],x=w[1],S=be(Al(n),2),T=S[0],N=S[1],C=Xy(v,T),R=Xy(g,N),_=Die(a,h,p,b,x,C,R,i,s),P=_.padInfo,$=_.outHeight,z=_.outWidth,L=o?y*d:y,B;return s==="channelsFirst"?B=[f,L,$,z]:s==="channelsLast"&&(B=[f,$,z,L]),{batchSize:f,dataFormat:s,inHeight:h,inWidth:p,inChannels:d,outHeight:$,outWidth:z,outChannels:L,padInfo:P,strideHeight:b,strideWidth:x,filterHeight:v,filterWidth:g,effectiveFilterHeight:C,effectiveFilterWidth:R,dilationHeight:T,dilationWidth:N,inShape:r,outShape:B,filterShape:e}}function Cie(r,e,t,n,a){n==null&&(n=Aie(r,e,t));var i=r[0],o=r[1],s=mp((i-e+2*n)/t+1,a),u=mp((o-e+2*n)/t+1,a);return[s,u]}function Aie(r,e,t,n){n===void 0&&(n=1);var a=Xy(e,n);return Math.floor((r[0]*(t-1)-t+a)/2)}function Al(r){return typeof r=="number"?[r,r,r]:r.length===2?[r[0],r[1],1]:r}function Xy(r,e){return e<=1?r:r+(r-1)*(e-1)}function Die(r,e,t,n,a,i,o,s,u){var c,l,f;if(typeof r=="number"){var h=r===0?"VALID":"NUMBER";c={top:r,bottom:r,left:r,right:r,type:h};var p=Cie([e,t],i,n,r,s);l=p[0],f=p[1]}else if(r==="same"){l=Math.ceil(e/n),f=Math.ceil(t/a);var d=Math.max(0,(l-1)*n+i-e),m=Math.max(0,(f-1)*a+o-t),v=Math.floor(d/2),g=d-v,y=Math.floor(m/2),w=m-y;c={top:v,bottom:g,left:y,right:w,type:"SAME"}}else if(r==="valid")c={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((e-i+1)/n),f=Math.ceil((t-o+1)/a);else if(typeof r=="object"){var v=u==="channelsLast"?r[1][0]:r[2][0],g=u==="channelsLast"?r[1][1]:r[2][1],y=u==="channelsLast"?r[2][0]:r[3][0],w=u==="channelsLast"?r[2][1]:r[3][1],h=v===0&&g===0&&y===0&&w===0?"VALID":"EXPLICIT";c={top:v,bottom:g,left:y,right:w,type:h},l=mp((e-i+v+g)/n+1,s),f=mp((t-o+y+w)/a+1,s)}else throw Error("Unknown padding parameter: ".concat(r));return{padInfo:c,outHeight:l,outWidth:f}}function mp(r,e){if(!e)return Math.trunc(r);switch(e){case"round":return Math.round(r);case"ceil":return Math.ceil(r);case"floor":return Math.floor(r);default:throw new Error("Unknown roundingMode ".concat(e))}}function gp(r){var e=be(Al(r),3),t=e[0],n=e[1],a=e[2];return t===1&&n===1&&a===1}function wo(r,e){return gp(r)||gp(e)}function _u(r){return Al(r).every(function(e){return e>0})}function ri(r,e,t){if(t!=null){if(typeof e=="string")throw Error("Error in ".concat(r,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(e,"."));if(typeof e=="number")U(Il(e),function(){return"Error in ".concat(r,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(e,".")});else if(typeof e=="object")e.forEach(function(n){n.forEach(function(a){U(Il(a),function(){return"Error in ".concat(r,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(a,".")})})});else throw Error("Error in ".concat(r,": Unknown padding parameter: ").concat(e))}}function _ie(r,e){var t=M(r,"x","reshape","string_or_numeric"),n={x:t},a={shape:e};return J.runKernel(Lne,n,a)}var me=K({reshape_:_ie});function Fie(r,e,t,n,a){var i=M(r,"x","avgPool","float32"),o=1;U(wo(t,o),function(){return"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(o,"'")});var s=i,u=!1;i.rank===3&&(u=!0,s=me(i,[1,i.shape[0],i.shape[1],i.shape[2]])),U(s.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank ".concat(s.rank,".")}),ri("avgPool",n,a);var c={x:s},l={filterSize:e,strides:t,pad:n,dimRoundingMode:a},f=J.runKernel(Qte,c,l);return f=Fr(f,i.dtype),u?me(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var fA=K({avgPool_:Fie});function Rie(r,e,t,n,a,i){i===void 0&&(i="NDHWC");var o=M(r,"x","avgPool3d","float32"),s=o,u=!1;o.rank===4&&(u=!0,s=me(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),U(s.rank===5,function(){return"Error in avgPool3d: x must be rank 5 but got rank ".concat(s.rank,".")}),U(i==="NDHWC",function(){return"Error in avgPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(i)}),U(typeof t=="number"&&t>0||Array.isArray(t)&&t[0]>0&&t[1]>0&&t[2]>0,function(){return"Error in avgPool3d: Stride must be > 0, but got '".concat(t,"'")}),ri("avgPool3d",n,a);var c={x:s},l={filterSize:e,strides:t,pad:n,dimRoundingMode:a,dataFormat:i},f=J.runKernel(ere,c,l);return f=Fr(f,s.dtype),u?me(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}var Oie=K({avgPool3d_:Rie});function Pie(r){var e=M(r,"x","clone","string_or_numeric"),t={x:e};return J.runKernel(KC,t)}var Nu=K({clone_:Pie});function Mie(r,e){e===void 0&&(e=0),U(r.length>=1,function(){return"Pass at least one tensor to concat"});var t=vp(r,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(function(i){if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `.concat(i.dtype,". "))}),t.length===1)return Nu(t[0]);var n=t,a={axis:e};return J.runKernel(lre,n,a)}var Gn=K({concat_:Mie});function Bie(r,e,t,n){var a;t===void 0&&(t=!1),n===void 0&&(n=!1);var i=M(r,"a","matMul"),o=M(e,"b","matMul");a=be(dr(i,o),2),i=a[0],o=a[1];var s={a:i,b:o},u={transposeA:t,transposeB:n};return J.runKernel(tre,s,u)}var _t=K({matMul_:Bie});function Lie(r,e){var t,n=M(r,"a","mul"),a=M(e,"b","mul");t=be(dr(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return J.runKernel(yne,i)}var ft=K({mul_:Lie});function zie(r){var e=M(r,"x","sigmoid","float32"),t={x:e};return J.runKernel(eae,t)}var Iu=K({sigmoid_:zie});function $ie(r,e,t){var n=M(r,"x","slice","string_or_numeric");if(n.rank===0)throw new Error("Slicing scalar is not possible");var a={x:n},i={begin:e,size:t};return J.runKernel(Yne,a,i)}var nr=K({slice_:$ie});function Wie(r){var e=M(r,"x","tanh","float32"),t={x:e};return J.runKernel(wae,t)}var Yy=K({tanh_:Wie});function Gie(r,e,t,n,a,i){var o=M(r,"forgetBias","basicLSTMCell"),s=M(e,"lstmKernel","basicLSTMCell"),u=M(t,"lstmBias","basicLSTMCell"),c=M(n,"data","basicLSTMCell"),l=M(a,"c","basicLSTMCell"),f=M(i,"h","basicLSTMCell"),h=Gn([c,f],1),p=_t(h,s),d=Lr(p,u),m=d.shape[0],v=d.shape[1]/4,g=[m,v],y=nr(d,[0,0],g),w=nr(d,[0,v],g),b=nr(d,[0,v*2],g),x=nr(d,[0,v*3],g),S=Lr(ft(Iu(y),Yy(w)),ft(l,Iu(Lr(o,b)))),T=ft(Yy(S),Iu(x));return[S,T]}var Vie=K({basicLSTMCell_:Gie});function Uie(r,e,t){var n=M(r,"x","batchToSpaceND"),a=e.reduce(function(s,u){return s*u});U(n.rank>=1+e.length,function(){return"input rank is ".concat(n.rank," but should be > than blockShape.length ").concat(e.length)}),U(t.length===e.length,function(){return"crops.length is ".concat(t.length," but should be equal to blockShape.length  ").concat(e.length)}),U(n.shape[0]%a===0,function(){return"input tensor batch is ".concat(n.shape[0]," but is not divisible by the product of ")+"the elements of blockShape ".concat(e.join(" * ")," === ").concat(a)});var i={x:n},o={blockShape:e,crops:t};return J.runKernel(rre,i,o)}var hA=K({batchToSpaceND_:Uie});function Hie(r){var e;return r.rank===0||r.rank===1?e=me(r,[1,1,1,r.size]):r.rank===2?e=me(r,[1,1,r.shape[0],r.shape[1]]):r.rank===3?e=me(r,[1,r.shape[0],r.shape[1],r.shape[2]]):e=r,e}function qie(r,e,t,n,a,i){i==null&&(i=.001);var o=M(r,"x","batchNorm"),s=M(e,"mean","batchNorm"),u=M(t,"variance","batchNorm"),c;a!=null&&(c=M(a,"scale","batchNorm"));var l;n!=null&&(l=M(n,"offset","batchNorm")),U(s.rank===u.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),U(l==null||s.rank===l.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),U(c==null||s.rank===c.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."});var f=Hie(o),h={x:f,scale:c,offset:l,mean:s,variance:u},p={varianceEpsilon:i},d=J.runKernel(Wre,h,p);return me(d,o.shape)}var Np=K({batchNorm_:qie});function Kie(r,e,t,n,a,i){var o=M(r,"x","batchNorm"),s=M(e,"mean","batchNorm"),u=M(t,"variance","batchNorm"),c;a!=null&&(c=M(a,"scale","batchNorm"));var l;return n!=null&&(l=M(n,"offset","batchNorm")),U(o.rank===2,function(){return"Error in batchNorm2D: x must be rank 2 but got rank "+"".concat(o.rank,".")}),U(s.rank===2||s.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but "+"got rank ".concat(s.rank,".")}),U(u.rank===2||u.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 "+"but got rank ".concat(u.rank,".")}),c!=null&&U(c.rank===2||c.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 "+"but got rank ".concat(c.rank,".")}),l!=null&&U(l.rank===2||l.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 "+"but got rank ".concat(l.rank,".")}),Np(o,s,u,l,c,i)}var jie=K({batchNorm2d_:Kie});function Xie(r,e,t,n,a,i){var o=M(r,"x","batchNorm"),s=M(e,"mean","batchNorm"),u=M(t,"variance","batchNorm"),c;a!=null&&(c=M(a,"scale","batchNorm"));var l;return n!=null&&(l=M(n,"offset","batchNorm")),U(o.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+"".concat(o.rank,".")}),U(s.rank===3||s.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but "+"got rank ".concat(s.rank,".")}),U(u.rank===3||u.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 "+"but got rank ".concat(u.rank,".")}),c!=null&&U(c.rank===3||c.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 "+"but got rank ".concat(c.rank,".")}),l!=null&&U(l.rank===3||l.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 "+"but got rank ".concat(l.rank,".")}),Np(o,s,u,l,c,i)}var Yie=K({batchNorm3d_:Xie});function Zie(r,e,t,n,a,i){var o=M(r,"x","batchNorm"),s=M(e,"mean","batchNorm"),u=M(t,"variance","batchNorm"),c;a!=null&&(c=M(a,"scale","batchNorm"));var l;return n!=null&&(l=M(n,"offset","batchNorm")),U(o.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+"".concat(o.rank,".")}),U(s.rank===4||s.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but "+"got rank ".concat(s.rank,".")}),U(u.rank===4||u.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 "+"but got rank ".concat(u.rank,".")}),c!=null&&U(c.rank===4||c.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 "+"but got rank ".concat(c.rank,".")}),l!=null&&U(l.rank===4||l.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 "+"but got rank ".concat(l.rank,".")}),Np(o,s,u,l,c,i)}var Jie=K({batchNorm4d_:Zie});function Qie(r,e,t){var n=M(r,"x","bincount"),a=M(e,"weights","bincount");U(n.dtype==="int32",function(){return"Error in bincount: input "+"dtype must be int32, but got ".concat(n.dtype)}),U(t>=0,function(){return"size must be non-negative, but got ".concat(t,".")}),U(a.size===n.size||a.size===0,function(){return"Error in bincount: weights must have the same size as input or"+"0-length, but got input shape: ".concat(n.shape,", weights shape: ")+"".concat(a.shape,".")});var i={x:n,weights:a},o={size:t};return J.runKernel(nre,i,o)}var pA=K({bincount_:Qie});function eoe(r,e){var t=M(r,"x","bitwiseAnd"),n=M(e,"y","bitwiseAnd");if(!ys(t.shape,n.shape))throw new Error("BitwiseAnd: Tensors must have the same shape. x: ".concat(t.shape,", y: ").concat(n.shape));if(t.dtype!=="int32"||n.dtype!=="int32")throw new Error("BitwiseAnd: Only supports 'int32' values in tensor, found type of x: ".concat(t.dtype," and type of y: ").concat(n.dtype));var a={a:t,b:n};return J.runKernel(are,a)}var toe=K({bitwiseAnd_:eoe});function roe(r,e){var t=M(r,"s0","broadcastArgs","int32"),n=M(e,"s1","broadcastArgs","int32");if(t.rank!==1)throw new Error("broadcastArgs(): first input must be a vector (rank=1). "+"Has rank ".concat(t.rank));if(n.rank!==1)throw new Error("broadcastArgs(): second input must be a vector (rank=1). "+"Has rank ".concat(n.rank));var a={s0:t,s1:n};return J.runKernel(ire,a)}var noe=K({broadcastArgs_:roe});function aoe(r,e){var t=M(r,"broadcastTo","x"),n=t.shape;if(ra(e),e.length<t.rank)throw new Error("broadcastTo(): shape.length=".concat(e.length," < input.rank=").concat(t.rank,"."));if(e.length>t.rank){for(var a=t.shape.slice();a.length<e.length;)a.unshift(1);t=me(t,a)}for(var i=t.shape,o=Array.from(e),s=e.length-1;s>=0;s--)if(i[s]===e[s])o[s]=1;else if(t.shape[s]!==1)throw new Error("broadcastTo(): [".concat(n,"] cannot be broadcast to [").concat(e,"]."));var u=o.map(function(f,h){return f>1?h:-1}).filter(function(f){return f>=0});if(u.length===0)return Nu(t);var c={x:t},l={reps:o};return J.runKernel(jC,c,l)}var fp=K({broadcastTo_:aoe});function go(r,e,t){return e===void 0&&(e="float32"),e=e||"float32",ra(r),new Vy(r,e,t)}function ioe(r){var e=M(r,"x","ceil","float32"),t={x:e};return J.runKernel(ore,t)}var ooe=K({ceil_:ioe});function Ip(r,e,t){ra(r),t=t||Tp(e);var n={shape:r,value:e,dtype:t};return J.runKernel(Bre,{},n)}function soe(r,e,t){var n=M(r,"x","clipByValue");if(U(e<=t,function(){return"Error in clip: min (".concat(e,") must be ")+"less than or equal to max (".concat(t,").")}),e===t)return Ip(n.shape,e,n.dtype);var a={x:n},i={clipValueMin:e,clipValueMax:t};return J.runKernel(sre,a,i)}var uoe=K({clipByValue_:soe});function coe(r,e){var t=M(r,"real","complex"),n=M(e,"imag","complex");_a(t.shape,n.shape,"real and imag shapes, ".concat(t.shape," and ").concat(n.shape,", ")+"must match in call to tf.complex().");var a={real:t,imag:n};return J.runKernel(ure,a)}var yo=K({complex_:coe});function loe(r){return Gn(r,0)}var foe=K({concat1d_:loe});function hoe(r,e){return Gn(r,e)}var poe=K({concat2d_:hoe});function doe(r,e){return Gn(r,e)}var voe=K({concat3d_:doe});function moe(r,e){return Gn(r,e)}var goe=K({concat4d_:moe});function yoe(r,e,t,n,a,i,o){a===void 0&&(a="NHWC"),i===void 0&&(i=[1,1]);var s=M(r,"x","conv2d","float32"),u=M(e,"filter","conv2d","float32"),c=s,l=!1;s.rank===3&&(l=!0,c=me(s,[1,s.shape[0],s.shape[1],s.shape[2]])),U(c.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank ".concat(c.rank,".")}),U(u.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+"".concat(u.rank,".")}),ri("conv2d",n,o);var f=a==="NHWC"?c.shape[3]:c.shape[1];U(f===u.shape[2],function(){return"Error in conv2d: depth of input (".concat(f,") must match ")+"input depth for filter ".concat(u.shape[2],".")}),U(wo(t,i),function(){return"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(i,"'")}),U(_u(i),function(){return"Error in conv2D: Dilated rates should be larger than 0."}),U(_u(t),function(){return"Error in conv2D: Strides should be larger than 0."});var h={x:c,filter:u},p={strides:t,pad:n,dataFormat:a,dilations:i,dimRoundingMode:o},d=J.runKernel(fre,h,p);return l?me(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var Cp=K({conv2d_:yoe});function boe(r,e,t,n,a,i,o){a===void 0&&(a="NWC"),i===void 0&&(i=1);var s=M(r,"x","conv1d"),u=M(e,"filter","conv1d"),c=s,l=!1;s.rank===2&&(l=!0,c=me(s,[1,s.shape[0],s.shape[1]])),U(c.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank ".concat(c.rank,".")}),U(u.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+"".concat(u.rank,".")}),ri("conv1d",n,o),U(c.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input (".concat(c.shape[2],") must match ")+"input depth for filter ".concat(u.shape[1],".")}),U(wo(t,i),function(){return"Error in conv1D: Either stride or dilation must be 1. "+"Got stride ".concat(t," and dilation '").concat(i,"'")}),U(_u(i),function(){return"Error in conv1D: Dilated rates should be larger than 0."}),U(_u(t),function(){return"Error in conv1D: Stride should be larger than 0."}),U(a==="NWC",function(){return"Error in conv1d: got dataFormat of ".concat(a," but only NWC is currently supported.")});var f=me(u,[1,u.shape[0],u.shape[1],u.shape[2]]),h=me(c,[c.shape[0],1,c.shape[1],c.shape[2]]),p=[1,t],d=[1,i],m="NHWC",v=Cp(h,f,p,n,m,d,o);return l?me(v,[v.shape[2],v.shape[3]]):me(v,[v.shape[0],v.shape[2],v.shape[3]])}var woe=K({conv1d_:boe});function xoe(r,e,t,n,a,i,o){i===void 0&&(i="NHWC"),U(r.length===e.rank,function(){return"Length of inShape "+"(".concat(r.length,") and rank of dy (").concat(e.rank,") must match")});var s=r,u=e,c=!1;e.rank===3&&(c=!0,u=me(e,[1,e.shape[0],e.shape[1],e.shape[2]]),s=[1,r[0],r[1],r[2]]),U(s.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+"".concat(s.length,".")}),U(u.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got "+"rank ".concat(u.rank)}),U(t.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got "+"rank ".concat(t.rank)});var l=i==="NHWC"?s[3]:s[1],f=i==="NHWC"?u.shape[3]:u.shape[1];U(l===t.shape[2],function(){return"Error in conv2dDerInput: depth of input (".concat(l,") must ")+"match input depth for filter ".concat(t.shape[2],".")}),U(f===t.shape[3],function(){return"Error in conv2dDerInput: depth of output (".concat(f,") must ")+"match output depth for filter ".concat(t.shape[3],".")}),ri("conv2dDerInput",a,o);var h={dy:u,filter:t},p={strides:n,pad:a,dataFormat:i,dimRoundingMode:o,inputShape:s},d=J.runKernel(pre,h,p);return c?me(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var dA=K({conv2DBackpropInput_:xoe});function koe(r,e,t,n,a,i){var o=M(r,"x","conv2dTranspose"),s=M(e,"filter","conv2dTranspose");return dA(t,o,s,n,a,"NHWC",i)}var Soe=K({conv2dTranspose_:koe});function Eoe(r,e,t,n,a,i){a===void 0&&(a="NDHWC"),i===void 0&&(i=[1,1,1]);var o=M(r,"x","conv3d"),s=M(e,"filter","conv3d"),u=o,c=!1;o.rank===4&&(c=!0,u=me(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),U(u.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank ".concat(u.rank,".")}),U(s.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+"".concat(s.rank,".")}),U(u.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input (".concat(u.shape[4],") must match ")+"input depth for filter ".concat(s.shape[3],".")}),U(wo(t,i),function(){return"Error in conv3D: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(i,"'")}),U(a==="NDHWC",function(){return"Error in conv3d: got dataFormat of ".concat(a," but only NDHWC is currently supported.")}),U(_u(i),function(){return"Error in conv3D: Dilated rates should be larger than 0."}),U(_u(t),function(){return"Error in conv3D: Strides should be larger than 0."});var l={x:u,filter:s},f={strides:t,pad:n,dataFormat:a,dilations:i},h=J.runKernel(dre,l,f);return c?me(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var Toe=K({conv3d_:Eoe});function Noe(r,e,t,n,a){U(r.length===e.rank,function(){return"Length of inShape "+"(".concat(r.length,") and rank of dy (").concat(e.rank,") must match")});var i=r,o=e,s=!1;e.rank===4&&(s=!0,o=me(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),i=[1,r[0],r[1],r[2],r[3]]);var u=i[4],c=o.shape[4];U(i.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+"".concat(i.length,".")}),U(o.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got "+"rank ".concat(o.rank)}),U(t.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got "+"rank ".concat(t.rank)}),U(u===t.shape[3],function(){return"Error in conv3dDerInput: depth of input (".concat(u,") must ")+"match input depth for filter ".concat(t.shape[3],".")}),U(c===t.shape[4],function(){return"Error in conv3dDerInput: depth of output (".concat(c,") must ")+"match output depth for filter ".concat(t.shape[4],".")});var l={dy:o,filter:t},f={pad:a,strides:n,inputShape:i},h=J.runKernel(vre,l,f);return s?me(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var Ioe=K({conv3DBackpropInput_:Noe});function Coe(r,e,t,n,a){var i=M(r,"x","conv3dTranspose"),o=M(e,"filter","conv3dTranspose");return Ioe(t,i,o,n,a)}var Aoe=K({conv3dTranspose_:Coe});function Doe(r){var e=M(r,"x","cos","float32"),t={x:e};return J.runKernel(mre,t)}var _oe=K({cos_:Doe});function Foe(r){var e=M(r,"x","cosh","float32"),t={x:e};return J.runKernel(gre,t)}var Roe=K({cosh_:Foe});function Ooe(r,e,t,n){e===void 0&&(e=0),t===void 0&&(t=!1),n===void 0&&(n=!1);var a=M(r,"x","cumprod"),i={x:a},o={axis:e,exclusive:t,reverse:n};return J.runKernel(yre,i,o)}var Poe=K({cumprod_:Ooe});function Moe(r,e,t,n){e===void 0&&(e=0),t===void 0&&(t=!1),n===void 0&&(n=!1);var a=M(r,"x","cumsum"),i={x:a},o={axis:e,exclusive:t,reverse:n};return J.runKernel(bre,i,o)}var Boe=K({cumsum_:Moe});function Loe(r,e,t,n){n===void 0&&(n=!1);var a=M(r,"x","denseBincount"),i=M(e,"weights","denseBincount");U(a.dtype==="int32",function(){return"Error in denseBincount: input "+"dtype must be int32, but got ".concat(a.dtype)}),U(a.rank<=2,function(){return"Error in denseBincount: input must be at most rank 2, but got "+"rank ".concat(a.rank,".")}),U(t>=0,function(){return"size must be non-negative, but got ".concat(t,".")}),U(i.size===a.size||i.size===0,function(){return"Error in denseBincount: weights must have the same shape as x or "+"0-length, but got x shape: ".concat(a.shape,", weights shape: ")+"".concat(i.shape,".")});var o={x:a,weights:i},s={size:t,binaryOutput:n};return J.runKernel(xre,o,s)}var zoe=K({denseBincount_:Loe});function $oe(r,e,t){t===void 0&&(t="NHWC");var n=M(r,"x","depthToSpace","float32"),a=t==="NHWC"?n.shape[1]:n.shape[2],i=t==="NHWC"?n.shape[2]:n.shape[3],o=t==="NHWC"?n.shape[3]:n.shape[1];U(e>1,function(){return"blockSize should be > 1 for depthToSpace, but was: ".concat(e)}),U(a*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
    `.concat(a," and ").concat(e,`  for depthToSpace with input shape
    `).concat(n.shape)}),U(i*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
    `.concat(i," and ").concat(e,` for depthToSpace with input shape
        `).concat(n.shape)}),U(o%(e*e)===0,function(){return"Dimension size must be evenly divisible by ".concat(e*e," but is ").concat(o," for depthToSpace with input shape ").concat(n.shape)});var s={x:n},u={blockSize:e,dataFormat:t};return J.runKernel(kre,s,u)}var Woe=K({depthToSpace_:$oe});function Goe(r,e,t,n,a,i,o){a===void 0&&(a="NHWC"),i===void 0&&(i=[1,1]);var s=M(r,"x","depthwiseConv2d","float32"),u=M(e,"filter","depthwiseConv2d","float32"),c=s,l=!1;s.rank===3&&(l=!0,c=me(s,[1,s.shape[0],s.shape[1],s.shape[2]])),U(c.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got "+"rank ".concat(c.rank,".")}),U(u.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+"".concat(u.rank,".")});var f=a==="NHWC"?c.shape[3]:c.shape[1];U(f===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels "+"(".concat(f,") must match the inChannels dimension in ")+"filter ".concat(u.shape[2],".")}),ri("depthwiseConv2d",n,o);var h={x:c,filter:u},p={strides:t,pad:n,dataFormat:a,dilations:i,dimRoundingMode:o},d=J.runKernel(Sre,h,p);return l?me(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var p0=K({depthwiseConv2d_:Goe});function Voe(r){var e=M(r,"x","diag"),t={x:e};return J.runKernel(Nre,t)}var Uoe=K({diag_:Voe});function Hoe(r,e,t,n,a,i){a===void 0&&(a=[1,1]),i===void 0&&(i="NHWC");var o=M(r,"x","dilation2d"),s=M(e,"filter","dilation2d");U(o.rank===3||o.rank===4,function(){return"Error in dilation2d: input must be rank 3 or 4, but got rank "+"".concat(o.rank,".")}),U(s.rank===3,function(){return"Error in dilation2d: filter must be rank 3, but got rank "+"".concat(s.rank,".")}),U(i==="NHWC",function(){return"Error in dilation2d: Only NHWC is currently supported, "+"but got dataFormat of ".concat(i)});var u=o,c=!1;o.rank===3&&(u=me(o,[1,o.shape[0],o.shape[1],o.shape[2]]),c=!0),U(u.shape[3]===s.shape[2],function(){return"Error in dilation2d:  input and filter must have the same depth: ".concat(u.shape[3]," vs ").concat(s.shape[2])});var l={x:u,filter:s},f={strides:t,pad:n,dilations:a},h=J.runKernel(Ire,l,f);return c?me(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var qoe=K({dilation2d_:Hoe});function Koe(r,e){var t,n=M(r,"a","floorDiv"),a=M(e,"b","floorDiv");t=be(dr(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return J.runKernel($re,i)}var vA=K({floorDiv_:Koe});function joe(r,e){var t,n=M(r,"a","div"),a=M(e,"b","div");if(t=be(dr(n,a),2),n=t[0],a=t[1],n.dtype==="int32"&&a.dtype==="int32")return vA(n,a);var i={a:n,b:a},o={};return J.runKernel(Cre,i,o)}var un=K({div_:joe});function Xoe(r,e){for(var t=[],n=0;n<e.length;n++){var a=r[r.length-n-1],i=e.length-n-1,o=e[i];(a==null||a===1&&o>1)&&t.unshift(i)}return t}function zr(r,e){for(var t=Math.max(r.length,e.length),n=new Array(t),a=0;a<t;a++){var i=r[r.length-a-1];i==null&&(i=1);var o=e[e.length-a-1];if(o==null&&(o=1),i===1)n[t-a-1]=o;else if(o===1)n[t-a-1]=i;else if(i!==o){var s="Operands could not be broadcast together with shapes "+"".concat(r," and ").concat(e,".");throw Error(s)}else n[t-a-1]=i}return n}function Yoe(r,e){var t,n=M(r,"a","equal","string_or_numeric"),a=M(e,"b","equal","string_or_numeric");t=be(dr(n,a),2),n=t[0],a=t[1],zr(n.shape,a.shape);var i={a:n,b:a};return J.runKernel(Fre,i)}var mA=K({equal_:Yoe});function Zoe(r,e,t){var n=M(e,"a","where"),a=M(t,"b","where"),i=M(r,"condition","where","bool"),o=zr(zr(i.shape,n.shape),a.shape),s=fp(i,o),u=fp(n,o),c=fp(a,o),l={condition:s,t:u,e:c};return J.runKernel(jne,l)}var mo=K({where_:Zoe});function Joe(r){var e=M(r,"x","zerosLike"),t={x:e};return J.runKernel(Nae,t)}var d0=K({zerosLike_:Joe});function Qoe(r,e){var t,n=M(r,"a","div"),a=M(e,"b","div");t=be(dr(n,a),2),n=t[0],a=t[1];var i=un(n,a),o=d0(i),s=mA(a,o);return mo(s,o,i)}var ese=K({divNoNan_:Qoe});function tse(r,e){var t=M(r,"t1","dot"),n=M(e,"t2","dot");U((t.rank===1||t.rank===2)&&(n.rank===1||n.rank===2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+"".concat(t.rank," and ").concat(n.rank,".")});var a=t.rank===1?t.size:t.shape[1],i=n.rank===1?n.size:n.shape[0];if(U(a===i,function(){return"Error in dot: inner dimensions of inputs must match, but got "+"".concat(a," and ").concat(i,".")}),t.rank===1&&n.rank===1){var o=me(t,[1,-1]),s=me(n,[-1,1]),u=_t(o,s);return me(u,[])}else if(t.rank===1&&n.rank===2){var o=me(t,[1,-1]),s=me(n,[n.shape[0],n.shape[1]]),u=_t(o,s);return me(u,[u.size])}else if(t.rank===2&&n.rank===1){var s=me(n,[-1,1]),u=_t(t,s);return me(u,[u.size])}else{var s=me(n,[n.shape[0],n.shape[1]]),u=_t(t,s);return u}}var rse=K({dot_:tse});function nse(r){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];var n=e.map(function(i,o){return M(i,"tensors".concat(o),"einsum")}),a={equation:r};return J.runKernel(Are,n,a)}var Eu=K({einsum_:nse});function ase(r){var e=M(r,"x","elu","float32"),t={x:e};return J.runKernel(Dre,t)}var gA=K({elu_:ase});function ise(r,e){var t=M(r,"x","ensureShape","string_or_numeric");if(!Nte(t.shape,e))throw new Error("EnsureShape: Shape of tensor ".concat(t.shape," is not compatible with expected shape ").concat(e));return r}var ose=K({ensureShape_:ise});function sse(r){var e=M(r,"x","erf");U(e.dtype==="int32"||e.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),e.dtype==="int32"&&(e=Fr(e,"float32"));var t={x:e};return J.runKernel(_re,t)}var use=K({erf_:sse});function cse(r,e,t){for(var n=r.length+e.length,a=[],i=0,o=0,s=0;s<n;s++)t.indexOf(s)===-1?a.push(r[i++]):a.push(e[o++]);return a}function Ap(r,e){var t=e.map(function(n){return 1});return cse(r,t,e)}function lse(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=M(r,"x","max"),a={x:n},i={reductionIndices:e,keepDims:t};return J.runKernel(sne,a,i)}var Cu=K({max_:lse});function fse(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=M(r,"x","min"),a={x:n},i={axis:e,keepDims:t};return J.runKernel(pne,a,i)}var Zy=K({min_:fse});function hse(r,e){var t,n=M(r,"base","pow"),a=M(e,"exp","pow");t=be(dr(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return J.runKernel(Cne,i)}var v0=K({pow_:hse});function xo(r,e,t,n){if(n==null)n=Tp(r);else if(n==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(oA(r)||iA(r)){if(n!=="float32"&&n!=="int32")throw new Error("Creating tensor from GPU data only supports "+"'float32'|'int32' dtype, while the dtype is ".concat(n,"."));return J.backend.createTensorFromGPUData(r,e||t,n)}if(!ei(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){ra(e);var a=Br(e),i=Br(t);U(a===i,function(){return"Based on the provided shape, [".concat(e,"], the tensor should have ")+"".concat(a," values but has ").concat(i)});for(var o=0;o<t.length;++o){var s=t[o],u=o===t.length-1?s!==Br(e.slice(o)):!0;U(t[o]===e[o]||!u,function(){return"Error creating a new Tensor. Inferred shape "+"(".concat(t,") does not match the provided ")+"shape (".concat(e,"). ")})}}return!ei(r)&&!Array.isArray(r)&&(r=[r]),e=e||t,r=n!=="string"?rA(r,n):Cl(r,[],!0),J.makeTensor(r,e,n)}function yr(r,e){if((ei(r)&&e!=="string"||Array.isArray(r))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&ei(r)&&!(r instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");var t=[],n=[];return xo(r,t,n,e)}function pse(r){var e=M(r,"x","sqrt","float32"),t={x:e};return J.runKernel(rae,t)}var Jy=K({sqrt_:pse});function dse(r){var e=M(r,"x","square"),t={};return J.runKernel("Square",{x:e},t)}var Dp=K({square_:dse});function vse(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=M(r,"x","sum");n.dtype==="bool"&&(n=Fr(n,"int32"));var a={x:n},i={axis:e,keepDims:t};return J.runKernel(nae,a,i)}var qt=K({sum_:vse});function mse(r,e,t,n){e===void 0&&(e="euclidean"),t===void 0&&(t=null),n===void 0&&(n=!1),r=M(r,"x","norm");var a=yA(r,e,t),i=a.shape;if(n){var o=Ep(t,r.shape);i=Ap(a.shape,o)}return me(a,i)}function yA(r,e,t){if(t===void 0&&(t=null),r.rank===0)return Ta(r);if(r.rank!==1&&t===null)return yA(me(r,[-1]),e,t);if(r.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return qt(Ta(r),t);if(e===1/0)return Cu(Ta(r),t);if(e===-1/0)return Zy(Ta(r),t);if(e==="euclidean"||e===2)return Jy(qt(v0(Ta(r),yr(2,"int32")),t));throw new Error("Error in norm: invalid ord value: ".concat(e))}if(Array.isArray(t)&&t.length===2){if(e===1)return Cu(qt(Ta(r),t[0]),t[1]-1);if(e===1/0)return Cu(qt(Ta(r),t[1]),t[0]);if(e===-1/0)return Zy(qt(Ta(r),t[1]),t[0]);if(e==="fro"||e==="euclidean")return Jy(qt(Dp(r),t));throw new Error("Error in norm: invalid ord value: ".concat(e))}throw new Error("Error in norm: invalid axis: ".concat(t))}var _p=K({norm_:mse});function gse(r,e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),_p(r,"euclidean",e,t)}var yse=K({euclideanNorm_:gse});function bse(r){var e=M(r,"x","exp"),t={x:e};return J.runKernel(Rre,t)}var ms=K({exp_:bse});function wse(r,e){e===void 0&&(e=0);var t=M(r,"x","expandDims","string_or_numeric");U(e<=t.rank,function(){return"Axis must be <= rank of the tensor"});var n={input:t},a={dim:e};return J.runKernel(Ore,n,a)}var vo=K({expandDims_:wse});function xse(r){var e=M(r,"x","expm1"),t={x:e};return J.runKernel(Pre,t)}var kse=K({expm1_:xse});function Sse(r,e){var t=M(r,"x","tile","string_or_numeric");U(t.rank===e.length,function(){return"Error in transpose: rank of input ".concat(t.rank," ")+"must match length of reps ".concat(e,".")});var n={x:t},a={reps:e};return J.runKernel(jC,n,a)}var Tl=K({tile_:Sse});function Ese(r,e,t,n){n===void 0&&(n="float32"),e==null&&(e=r);for(var a=go([r,e],n),i=r<=e?r:e,o=0;o<i;++o)a.set(1,o,o);var s=me(a.toTensor(),[r,e]);if(t==null)return s;if(t.length===1)return Tl(vo(s,0),[t[0],1,1]);if(t.length===2)return Tl(vo(vo(s,0),0),[t[0],t[1],1,1]);if(t.length===3)return Tl(vo(vo(vo(s,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error("eye() currently supports only 1D and 2D "+"batchShapes, but received ".concat(t.length,"D."))}var bA=K({eye_:Ese});function Tse(r){var e=M(r,"x","floor","float32"),t={x:e};return J.runKernel(zre,t)}var wA=K({floor_:Tse});function Nse(r,e,t,n){t===void 0&&(t=0),n===void 0&&(n=0);var a=M(r,"x","gather"),i=M(e,"indices","gather","int32"),o={x:a,indices:i},s={axis:t,batchDims:n};return J.runKernel(Gre,o,s)}var xA=K({gather_:Nse});function Ise(r,e){var t,n=M(r,"a","greater","string_or_numeric"),a=M(e,"b","greater","string_or_numeric");t=be(dr(n,a),2),n=t[0],a=t[1],zr(n.shape,a.shape);var i={a:n,b:a};return J.runKernel(Ure,i)}var Fp=K({greater_:Ise});function Cse(r,e){var t,n=M(r,"a","greaterEqual","string_or_numeric"),a=M(e,"b","greaterEqual","string_or_numeric");t=be(dr(n,a),2),n=t[0],a=t[1],zr(n.shape,a.shape);var i={a:n,b:a};return J.runKernel(Hre,i)}var kA=K({greaterEqual_:Cse});function Ase(r){var e=M(r,"input","imag"),t={input:e};return J.runKernel(Kre,t)}var Rp=K({imag_:Ase});function Dse(r){var e=M(r,"x","isFinite"),t={x:e};return J.runKernel(jre,t)}var _se=K({isFinite_:Dse});function Fse(r){var e=M(r,"x","isInf"),t={x:e};return J.runKernel(Xre,t)}var Rse=K({isInf_:Fse});function Ose(r){var e=M(r,"x","isNaN"),t={x:e};return J.runKernel(Yre,t)}var Pse=K({isNaN_:Ose});function Mse(r,e){e===void 0&&(e=.2);var t=M(r,"x","leakyRelu"),n={x:t},a={alpha:e};return J.runKernel(Zre,n,a)}var SA=K({leakyRelu_:Mse});function Bse(r,e){var t,n=M(r,"a","less","string_or_numeric"),a=M(e,"b","less","string_or_numeric");t=be(dr(n,a),2),n=t[0],a=t[1],zr(n.shape,a.shape);var i={a:n,b:a};return J.runKernel(Jre,i)}var Qy=K({less_:Bse});function Lse(r,e){var t,n=M(r,"a","lessEqual","string_or_numeric"),a=M(e,"b","lessEqual","string_or_numeric");t=be(dr(n,a),2),n=t[0],a=t[1],zr(n.shape,a.shape);var i={a:n,b:a};return J.runKernel(Qre,i)}var m0=K({lessEqual_:Lse});function zse(r,e,t){if(t<=0)throw new Error("The number of values should be positive.");var n={start:r,stop:e,num:t};return J.runKernel(ene,{},n)}function $se(r,e,t,n,a){e===void 0&&(e=5),t===void 0&&(t=1),n===void 0&&(n=1),a===void 0&&(a=.5);var i=M(r,"x","localResponseNormalization");U(i.rank===4||i.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `.concat(i.rank,".")}),U(Il(e),function(){return"Error in localResponseNormalization: depthRadius must be an "+"integer but got depthRadius ".concat(e,".")});var o=i,s=!1;i.rank===3&&(s=!0,o=me(i,[1,i.shape[0],i.shape[1],i.shape[2]]));var u={x:o},c={depthRadius:e,bias:t,alpha:n,beta:a},l=J.runKernel(one,u,c);return s?me(l,[l.shape[1],l.shape[2],l.shape[3]]):l}var Wse=K({localResponseNormalization_:$se});function Gse(r){var e=M(r,"x","log","float32"),t={x:e};return J.runKernel(tne,t)}var Dl=K({log_:Gse});function Vse(r){var e=M(r,"x","log1p"),t={x:e};return J.runKernel(rne,t)}var EA=K({log1p_:Vse});function Bi(r){return J.customGrad(r)}function Use(r){var e=M(r,"x","neg"),t={x:e};return J.runKernel(bne,t)}var vi=K({neg_:Use});function Hse(r){var e=M(r,"x","softplus"),t={x:e};return J.runKernel(tae,t)}var TA=K({softplus_:Hse});function qse(r){var e=M(r,"x","logSigmoid"),t=Bi(function(n){var a=vi(TA(vi(n))),i=function(o){var s=ft(o,Iu(vi(n)));return s};return{value:a,gradFunc:i}});return t(e)}var Kse=K({logSigmoid_:qse});function jse(r,e){var t,n=M(r,"a","sub"),a=M(e,"b","sub");t=be(dr(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return J.runKernel(yae,i)}var kt=K({sub_:jse});function Xse(r,e){e===void 0&&(e=-1);var t=M(r,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(t.rank," and axis was ").concat(e));var n=Bi(function(a,i){var o=!0,s=Cu(a,e,!0),u=kt(a,s),c=kt(Fr(u,"float32"),Dl(qt(ms(u),e,o)));i([c]);var l=function(f,h){var p=be(h,1),d=p[0],m=!0,v=ms(d);return kt(f,ft(qt(f,e,m),v))};return{value:c,gradFunc:l}});return n(t)}var Yse=K({logSoftmax_:Xse});function Zse(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=M(r,"x","logSumExp"),a=Ep(e,n.shape),i=Cu(n,a,!0),o=kt(n,i),s=ms(o),u=qt(s,a),c=Dl(u),l=Lr(me(i,c.shape),c);if(t){var f=Ap(l.shape,a);return me(l,f)}return l}var NA=K({logSumExp_:Zse});function Jse(r,e){var t=M(r,"a","logicalAnd","bool"),n=M(e,"b","logicalAnd","bool");zr(t.shape,n.shape);var a={a:t,b:n};return J.runKernel(nne,a)}var yp=K({logicalAnd_:Jse});function Qse(r){var e=M(r,"x","logicalNot","bool"),t={x:e};return J.runKernel(ane,t)}var IA=K({logicalNot_:Qse});function eue(r,e){var t=M(r,"a","logicalOr","bool"),n=M(e,"b","logicalOr","bool");zr(t.shape,n.shape);var a={a:t,b:n};return J.runKernel(ine,a)}var CA=K({logicalOr_:eue});function tue(r,e){var t=M(r,"a","logicalXor","bool"),n=M(e,"b","logicalXor","bool");return zr(t.shape,n.shape),yp(CA(r,e),IA(yp(r,e)))}var rue=K({logicalXor_:tue});var op=2147483648;function nue(r,e,t){t===void 0&&(t="left");var n=M(r,"sortedSequence","searchSorted"),a=M(e,"values","searchSorted"),i=n.shape[n.shape.length-1],o=a.shape[a.shape.length-1],s=me(n,[-1,i]),u=me(a,[-1,o]);if(s.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(s.shape[0]!==u.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(Br(u.shape)>=op)throw new Error("values tensor size must less than ".concat(op));if(s.shape[1]>=op)throw new Error("trailing dim_size must less than ".concat(op," for int32 output type, was ").concat(s.shape[1]));var c={sortedSequence:s,values:u},l={side:t};return J.runKernel(Kne,c,l)}var g0=K({searchSorted_:nue});function aue(r,e){return g0(r,e,"left")}function iue(r,e,t,n,a){var i=M(r,"x","maxPool"),o=1,s=i,u=!1;i.rank===3&&(u=!0,s=me(i,[1,i.shape[0],i.shape[1],i.shape[2]])),U(s.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(s.rank,".")}),U(wo(t,o),function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(o,"'")}),ri("maxPool",n,a);var c={x:s},l={filterSize:e,strides:t,pad:n,dimRoundingMode:a},f=J.runKernel(cne,c,l);return u?me(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var AA=K({maxPool_:iue});function oue(r,e,t,n,a,i){e===void 0&&(e=[1,1,1]),i===void 0&&(i="NDHWC");var o=M(r,"x","maxPool3d"),s=o,u=!1;o.rank===4&&(u=!0,s=me(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),U(s.rank===5,function(){return"Error in maxPool3d: x must be rank 5 but got rank ".concat(s.rank,".")}),U(i==="NDHWC",function(){return"Error in maxPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(i)}),ri("maxPool3d",n,a);var c={x:s},l={filterSize:e,strides:t,pad:n,dimRoundingMode:a,dataFormat:i},f=J.runKernel(lne,c,l);return u?me(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}var sue=K({maxPool3d_:oue});function uue(r,e,t,n,a){a===void 0&&(a=!1);var i=M(r,"x","maxPoolWithArgmax"),o={x:i},s={filterSize:e,strides:t,pad:n,includeBatchInIndex:a},u=J.runKernel(fne,o,s);return{result:u[0],indexes:u[1]}}var cue=K({maxPoolWithArgmax_:uue});function lue(r,e){var t,n=M(r,"a","maximum"),a=M(e,"b","maximum");t=be(dr(n,a),2),n=t[0],a=t[1],n.dtype==="bool"&&(n=Fr(n,"int32"),a=Fr(a,"int32")),zr(n.shape,a.shape);var i={a:n,b:a};return J.runKernel(une,i)}var fue=K({maximum_:lue});function hue(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=M(r,"x","mean"),a={x:n},i={axis:e,keepDims:t};return J.runKernel(hne,a,i)}var bp=K({mean_:hue});function Fu(r,e){if(e===void 0&&(e="float32"),ra(r),e==="complex64"){var t=Fu(r,"float32"),n=Fu(r,"float32");return yo(t,n)}var a=o0(Br(r),e);return J.makeTensor(a,r,e)}function vs(r,e){if(e===void 0&&(e="float32"),ra(r),e==="complex64"){var t=vs(r,"float32"),n=Fu(r,"float32");return yo(t,n)}var a=GC(Br(r),e);return J.makeTensor(a,r,e)}function pue(r,e,t){var n=t===void 0?{}:t,a=n.indexing,i=a===void 0?"xy":a;if(i!=="xy"&&i!=="ij")throw new TypeError("".concat(i," is not a valid third argument to meshgrid"));if(r===void 0)return[];var o=M(r,"x","meshgrid",r instanceof $n?r.dtype:"float32");if(e===void 0)return[o];var s=M(e,"y","meshgrid",e instanceof $n?e.dtype:"float32"),u=Br(o.shape),c=Br(s.shape);return i==="xy"?(o=me(o,[1,-1]),s=me(s,[-1,1]),[_t(vs([c,1],o.dtype),o),_t(s,vs([1,u],s.dtype))]):(o=me(o,[-1,1]),s=me(s,[1,-1]),[_t(o,vs([1,c],o.dtype)),_t(vs([u,1],s.dtype),s)])}function due(r,e){var t,n=M(r,"a","minimum"),a=M(e,"b","minimum");t=be(dr(n,a),2),n=t[0],a=t[1],n.dtype==="bool"&&(n=Fr(n,"int32"),a=Fr(a,"int32")),zr(n.shape,a.shape);var i={a:n,b:a};return J.runKernel(dne,i)}var wp=K({minimum_:due});function vue(r,e,t){U(t==="reflect"||t==="symmetric",function(){return"Invalid mode. Mode must be either reflect or symmetric. "+"Got ".concat(t,".")});var n=M(r,"x","mirrorPad");if(n.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");U(e.length===n.rank,function(){return"Padding doesn't match input. Must be ".concat(n.rank,". ")+"Got ".concat(e.length,".")});for(var a=t==="reflect"?1:0,i=function(c){U(e[c].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),U(e[c][0]>=0&&e[c][0]<=n.shape[c]-a&&e[c][1]>=0&&e[c][1]<=n.shape[c]-a,function(){return"Padding in dimension ".concat(c," cannot be greater than or equal ")+"to ".concat(n.shape[c]-a," or less than 0 for input of ")+"shape ".concat(n.shape)})},o=0;o<n.rank;o++)i(o);var s={paddings:e,mode:t},u={x:n};return J.runKernel(vne,u,s)}var mue=K({mirrorPad_:vue});function gue(r,e){var t,n=M(r,"a","mod"),a=M(e,"b","mod");t=be(dr(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return J.runKernel(mne,i)}var yue=K({mod_:gue});function bue(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1),r=M(r,"x","moments");var n=Ep(e,r.shape),a=bp(r,n,t),i=a.shape;t||(i=Ap(a.shape,n));var o=Dp(kt(Fr(r,"float32"),me(a,i))),s=bp(o,n,t);return{mean:a,variance:s}}var wue=K({moments_:bue});function xue(r,e,t,n){for(var a=M(e,"data","multiRNNCell"),i=vp(t,"c","multiRNNCell"),o=vp(n,"h","multiRNNCell"),s=a,u=[],c=0;c<r.length;c++){var l=r[c](s,i[c],o[c]);u.push(l[0]),u.push(l[1]),s=l[1]}for(var f=[],h=[],c=0;c<u.length;c+=2)f.push(u[c]),h.push(u[c+1]);return[f,h]}var kue=K({multiRNNCell_:xue});function Sue(r,e,t,n){n===void 0&&(n=!1);var a=M(r,"logits","multinomial"),i=a.size,o=a.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+"".concat(i,"."));if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is ".concat(o));t=t||Math.random();var s=o===1?me(a,[1,-1]):a,u={logits:s},c={numSamples:e,seed:t,normalized:n},l=J.runKernel(gne,u,c);return o===1?me(l,[l.size]):l}var Eue=K({multinomial_:Sue});function Tue(r,e){var t,n=M(r,"a","notEqual","string_or_numeric"),a=M(e,"b","notEqual","string_or_numeric");t=be(dr(n,a),2),n=t[0],a=t[1],zr(n.shape,a.shape);var i={a:n,b:a};return J.runKernel(wne,i)}var DA=K({notEqual_:Tue});function Nue(r,e,t,n,a){if(t===void 0&&(t=1),n===void 0&&(n=0),a===void 0&&(a="int32"),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is ".concat(e));var i=M(r,"indices","oneHot","int32"),o={indices:i},s={dtype:a,depth:e,onValue:t,offValue:n};return J.runKernel(Tne,o,s)}var Iue=K({oneHot_:Nue});function Cue(r){var e=M(r,"x","onesLike"),t={x:e};return J.runKernel(Ene,t)}var Aue=K({onesLike_:Cue});function Due(r,e){var t=M(r,"v1","outerProduct"),n=M(e,"v2","outerProduct");U(t.rank===1&&n.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+"".concat(t.rank," and ").concat(n.rank,".")});var a=me(t,[-1,1]),i=me(n,[1,-1]);return _t(a,i)}var _ue=K({outerProduct_:Due});function Fue(r,e,t){t===void 0&&(t=0);var n=M(r,"x","pad");if(n.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var a={paddings:e,constantValue:t},i={x:n};return J.runKernel(Ine,i,a)}var Pl=K({pad_:Fue});function Rue(r,e,t){return t===void 0&&(t=0),U(e.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),Pl(r,[e],t)}var Oue=K({pad1d_:Rue});function Pue(r,e,t){return t===void 0&&(t=0),U(e.length===2&&e[0].length===2&&e[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Pl(r,e,t)}var Mue=K({pad2d_:Pue});function Bue(r,e,t){return t===void 0&&(t=0),U(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Pl(r,e,t)}var Lue=K({pad3d_:Bue});function zue(r,e,t){return t===void 0&&(t=0),U(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Pl(r,e,t)}var $ue=K({pad4d_:zue});function Wue(r,e,t){var n=M(r,"x","spaceToBatchND");U(n.rank>=1+e.length,function(){return"input rank ".concat(n.rank," should be > than [blockShape] ").concat(e.length)}),U(t.length===e.length,function(){return"paddings.shape[0] ".concat(t.length," must be equal to [blockShape] ").concat(e.length)}),U(n.shape.reduce(function(o,s,u){return u>0&&u<=e.length?o&&(s+t[u-1][0]+t[u-1][1])%e[u-1]===0:o},!0),function(){return"input spatial dimensions ".concat(n.shape.slice(1)," with paddings ").concat(t.toString()," must be divisible by blockShapes ").concat(e.toString())});var a={x:n},i={blockShape:e,paddings:t};return J.runKernel(aae,a,i)}var _A=K({spaceToBatchND_:Wue});function Gue(r,e,t,n,a,i,o){a==null&&(a=[1,1]),i==null&&(i=1),n===0&&(n="valid");var s=M(r,"x","maxPool"),u=s,c=!1;s.rank===3&&(c=!0,u=me(s,[1,s.shape[0],s.shape[1],s.shape[2]])),U(wo(i,a),function(){return"Error in pool: Either strides or dilations must be 1. "+"Got strides ".concat(i," and dilations '").concat(a,"'")});var l=Iie(u.shape,e,i,a,n),f=[l.dilationHeight,l.dilationWidth],h;n==="same"?h=Uue([l.filterHeight,l.filterWidth],f):h=[[0,0],[0,0]];var p=f[0]===1&&f[1]===1,d=be(Vue([l.inHeight,l.inWidth],f,h),2),m=d[0],v=d[1],g=p?n:"valid",y=p?u:_A(u,f,m),w=t==="avg"?function(){return fA(y,e,i,g,o)}:function(){return AA(y,e,i,g,o)},b=w(),x=p?b:hA(b,f,v);return c?me(x,[x.shape[1],x.shape[2],x.shape[3]]):x}function Vue(r,e,t){var n=t.map(function(l){return l[0]}),a=t.map(function(l){return l[1]}),i=r.concat(n,a),o=e.map(function(l,f){return(l-i[f]%l)%l}),s=a.map(function(l,f){return l+o[f]}),u=e.map(function(l,f){return[n[f],s[f]]}),c=e.map(function(l,f){return[0,o[f]]});return[u,c]}function Uue(r,e){var t=r.map(function(o,s){return o+(o-1)*(e[s]-1)}),n=t.map(function(o){return o-1}),a=n.map(function(o){return Math.floor(o/2)}),i=n.map(function(o,s){return o-a[s]});return n.map(function(o,s){return[a[s],i[s]]})}var Hue=K({pool_:Gue});function que(r,e){var t=M(r,"x","prelu"),n=M(e,"alpha","prelu"),a={x:t,alpha:n};return J.runKernel(Ane,a)}var FA=K({prelu_:que});function Kue(r,e){e===void 0&&(e=!1),console.log(r.toString(e))}function jue(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=M(r,"x","prod");n.dtype==="bool"&&(n=Fr(n,"int32"));var a={x:n},i={axis:e,keepDims:t};return J.runKernel(Dne,a,i)}var Xue=K({prod_:jue});function Yue(r,e,t,n){var a=r.map(function(l,f){return M(l,"tensors".concat(f),"raggedGather","int32")}),i=M(e,"paramsDenseValues","raggedGather"),o=M(t,"indices","raggedGather","int32"),s={paramsNestedSplits:a,paramsDenseValues:i,indices:o},u={outputRaggedRank:n},c=J.runKernel(_ne,s,u);return{outputNestedSplits:c.slice(0,c.length-1),outputDenseValues:c[c.length-1]}}var Zue=K({raggedGather_:Yue});function Jue(r,e,t){var n=M(r,"starts","raggedRange"),a=M(e,"limits","raggedRange",n.dtype),i=M(t,"deltas","raggedRange",n.dtype),o={starts:n,limits:a,deltas:i},s=J.runKernel(Fne,o);return{rtNestedSplits:s[0],rtDenseValues:s[1]}}var Que=K({raggedRange_:Jue});function ece(r,e,t,n,a){var i=M(r,"shape","raggedTensorToTensor","int32"),o=M(e,"values","raggedTensorToTensor"),s=M(t,"defaultValue","raggedTensorToTensor",o.dtype),u=n.map(function(f,h){return M(f,"tensors".concat(h),"raggedTensorToTensor","int32")}),c={shape:i,values:o,defaultValue:s,rowPartitionTensors:u},l={rowPartitionTypes:a};return J.runKernel(Rne,c,l)}var tce=K({raggedTensorToTensor_:ece});function rce(r,e,t){ra(r);var n=Br(r),a=null;if(t==null||t==="float32")a=new Float32Array(n);else if(t==="int32")a=new Int32Array(n);else if(t==="bool")a=new Uint8Array(n);else throw new Error("Unknown data type ".concat(t));for(var i=0;i<n;i++)a[i]=e();return J.makeTensor(a,r,t)}var nce=K({rand_:rce}),RA={exports:{}};(function(r){(function(e,t,n){function a(u){var c=this,l=s();c.next=function(){var f=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=f-(c.c=f|0)},c.c=1,c.s0=l(" "),c.s1=l(" "),c.s2=l(" "),c.s0-=l(u),c.s0<0&&(c.s0+=1),c.s1-=l(u),c.s1<0&&(c.s1+=1),c.s2-=l(u),c.s2<0&&(c.s2+=1),l=null}function i(u,c){return c.c=u.c,c.s0=u.s0,c.s1=u.s1,c.s2=u.s2,c}function o(u,c){var l=new a(u),f=c&&c.state,h=l.next;return h.int32=function(){return l.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,f&&(typeof f=="object"&&i(f,l),h.state=function(){return i(l,{})}),h}function s(){var u=4022871197,c=function(l){l=String(l);for(var f=0;f<l.length;f++){u+=l.charCodeAt(f);var h=.02519603282416938*u;u=h>>>0,h-=u,h*=u,u=h>>>0,h-=u,u+=h*4294967296}return(u>>>0)*23283064365386963e-26};return c}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.alea=o})(bs,r,!1)})(RA);var ace=RA.exports,OA={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this,c="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var f=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^f^f>>>8},s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor128=o})(bs,r,!1)})(OA);var ice=OA.exports,PA={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this,c="";u.next=function(){var f=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^(f^f<<1))|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,l==c.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorwow=o})(bs,r,!1)})(PA);var oce=PA.exports,MA={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var l=u.x,f=u.i,h,p;return h=l[f],h^=h>>>7,p=h^h<<24,h=l[f+1&7],p^=h^h>>>10,h=l[f+3&7],p^=h^h>>>3,h=l[f+4&7],p^=h^h<<7,h=l[f+7&7],h=h^h<<13,p^=h^h<<9,l[f]=p,u.i=f+1&7,p};function c(l,f){var h,p=[];if(f===(f|0))p[0]=f;else for(f=""+f,h=0;h<f.length;++h)p[h&7]=p[h&7]<<15^f.charCodeAt(h)+p[h+1&7]<<13;for(;p.length<8;)p.push(0);for(h=0;h<8&&p[h]===0;++h);for(h==8?p[7]=-1:p[h],l.x=p,l.i=0,h=256;h>0;--h)l.next()}c(u,s)}function i(s,u){return u.x=s.x.slice(),u.i=s.i,u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(l.x&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorshift7=o})(bs,r,!1)})(MA);var sce=MA.exports,BA={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var l=u.w,f=u.X,h=u.i,p,d;return u.w=l=l+1640531527|0,d=f[h+34&127],p=f[h=h+1&127],d^=d<<13,p^=p<<17,d^=d>>>15,p^=p>>>12,d=f[h]=d^p,u.i=h,d+(l^l>>>16)|0};function c(l,f){var h,p,d,m,v,g=[],y=128;for(f===(f|0)?(p=f,f=null):(f=f+"\0",p=0,y=Math.max(y,f.length)),d=0,m=-32;m<y;++m)f&&(p^=f.charCodeAt((m+32)%f.length)),m===0&&(v=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,m>=0&&(v=v+1640531527|0,h=g[m&127]^=p+v,d=h==0?d+1:0);for(d>=128&&(g[(f&&f.length||0)&127]=-1),d=127,m=512;m>0;--m)p=g[d+34&127],h=g[d=d+1&127],p^=p<<13,h^=h<<17,p^=p>>>15,h^=h>>>12,g[d]=p^h;l.w=v,l.X=g,l.i=d}c(u,s)}function i(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(l.X&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor4096=o})(bs,r,!1)})(BA);var uce=BA.exports,LA={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this,c="";u.next=function(){var f=u.b,h=u.c,p=u.d,d=u.a;return f=f<<25^f>>>7^h,h=h-p|0,p=p<<24^p>>>8^d,d=d-f|0,u.b=f=f<<20^f>>>12^h,u.c=h=h-p|0,u.d=p<<16^h>>>16^d,u.a=d-f|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=s|0):c+=s;for(var l=0;l<c.length+20;l++)u.b^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.tychei=o})(bs,r,!1)})(LA);var cce=LA.exports,zA={exports:{}},lce={},fce={__proto__:null,default:lce},hce=Rae(fce);(function(r){(function(e,t,n){var a=256,i=6,o=52,s="random",u=n.pow(a,i),c=n.pow(2,o),l=c*2,f=a-1,h;function p(b,x,S){var T=[];x=x==!0?{entropy:!0}:x||{};var N=g(v(x.entropy?[b,w(t)]:b??y(),3),T),C=new d(T),R=function(){for(var _=C.g(i),P=u,$=0;_<c;)_=(_+$)*a,P*=a,$=C.g(1);for(;_>=l;)_/=2,P/=2,$>>>=1;return(_+$)/P};return R.int32=function(){return C.g(4)|0},R.quick=function(){return C.g(4)/4294967296},R.double=R,g(w(C.S),t),(x.pass||S||function(_,P,$,z){return z&&(z.S&&m(z,C),_.state=function(){return m(C,{})}),$?(n[s]=_,P):_})(R,N,"global"in x?x.global:this==n,x.state)}function d(b){var x,S=b.length,T=this,N=0,C=T.i=T.j=0,R=T.S=[];for(S||(b=[S++]);N<a;)R[N]=N++;for(N=0;N<a;N++)R[N]=R[C=f&C+b[N%S]+(x=R[N])],R[C]=x;(T.g=function(_){for(var P,$=0,z=T.i,L=T.j,B=T.S;_--;)P=B[z=f&z+1],$=$*a+B[f&(B[z]=B[L=f&L+P])+(B[L]=P)];return T.i=z,T.j=L,$})(a)}function m(b,x){return x.i=b.i,x.j=b.j,x.S=b.S.slice(),x}function v(b,x){var S=[],T=typeof b,N;if(x&&T=="object")for(N in b)try{S.push(v(b[N],x-1))}catch{}return S.length?S:T=="string"?b:b+"\0"}function g(b,x){for(var S=b+"",T,N=0;N<S.length;)x[f&N]=f&(T^=x[f&N]*19)+S.charCodeAt(N++);return w(x)}function y(){try{var b;return h&&(b=h.randomBytes)?b=b(a):(b=new Uint8Array(a),(e.crypto||e.msCrypto).getRandomValues(b)),w(b)}catch{var x=e.navigator,S=x&&x.plugins;return[+new Date,e,S,e.screen,w(t)]}}function w(b){return String.fromCharCode.apply(0,b)}if(g(n.random(),t),r.exports){r.exports=p;try{h=hce}catch{}}else n["seed"+s]=p})(typeof self<"u"?self:bs,[],Math)})(zA);var pce=zA.exports,dce=ace,vce=ice,mce=oce,gce=sce,yce=uce,bce=cce,xs=pce;xs.alea=dce;xs.xor128=vce;xs.xorwow=mce;xs.xorshift7=gce;xs.xor4096=yce;xs.tychei=bce;var y0=xs;var b0=(function(){function r(e,t,n,a,i){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=a,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);var o=i||Math.random();this.random=y0.alea(o.toString())}return r.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,a=!1;!a;){var i=void 0,o=void 0,s=void 0;do i=2*this.random()-1,o=2*this.random()-1,s=i*i+o*o;while(s>=1||s===0);var u=Math.sqrt(-2*Math.log(s)/s);t=this.mean+this.stdDev*i*u,n=this.mean+this.stdDev*o*u,(!this.truncated||this.isValidTruncated(t))&&(a=!0)}return(!this.truncated||this.isValidTruncated(n))&&(this.nextVal=this.convertValue(n)),this.convertValue(t)},r.prototype.convertValue=function(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)},r.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},r})(),wce=(function(){function r(e,t,n,a){this.alpha=e,this.beta=1/t,this.dtype=n;var i=a||Math.random();this.randu=y0.alea(i.toString()),this.randn=new b0(0,1,n,!1,this.randu()),e<1?this.d=e+2/3:this.d=e-1/3,this.c=1/Math.sqrt(9*this.d)}return r.prototype.nextValue=function(){for(var e,t,n,a,i,o;;){do a=this.randn.nextValue(),o=1+this.c*a;while(o<=0);if(o*=o*o,e=a*a,t=1-.331*e*e,n=.5*e+this.d*(1-o+Math.log(o)),i=this.randu(),i<t||Math.log(i)<n)break}return o=1/this.beta*this.d*o,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)},r.prototype.convertValue=function(e){return this.dtype==="float32"?e:Math.round(e)},r})(),xce=(function(){function r(e,t,n,a){e===void 0&&(e=0),t===void 0&&(t=1);var i=this;if(this.canReturnFloat=function(){return i.dtype==null||i.dtype==="float32"},this.min=e,this.range=t-e,this.dtype=n,a==null&&(a=Math.random()),typeof a=="number"&&(a=a.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between ".concat(e," - ").concat(t," <= 1 and dtype is not float"));this.random=y0.alea(a)}return r.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},r.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},r})();function kce(r,e,t,n,a){if(t===void 0&&(t=1),n===void 0&&(n="float32"),ra(r),t==null&&(t=1),n==null&&(n="float32"),n!=="float32"&&n!=="int32")throw new Error("Unsupported data type ".concat(n));for(var i=new wce(e,t,n,a),o=go(r,n),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var Sce=K({randomGamma_:kce});function Ece(r,e,t,n,a){if(e===void 0&&(e=0),t===void 0&&(t=1),ra(r),n!=null&&n==="bool")throw new Error("Unsupported data type ".concat(n));for(var i=new b0(e,t,n,!1,a),o=go(r,n),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var $A=K({randomNormal_:Ece});function Tce(r,e,t){if(e!=null&&e==="bool")throw new Error("Unsupported data type ".concat(e));return $A(r,0,1,e,t)}var Nce=K({randomStandardNormal_:Tce});function Ice(r,e,t,n,a){e===void 0&&(e=0),t===void 0&&(t=1),n===void 0&&(n="float32"),ra(r);for(var i=go(r,n),o=new xce(e,t,null,a),s=0;s<i.values.length;s++)i.values[s]=o.nextValue();return i.toTensor()}var w0=K({randomUniform_:Ice});function Cce(r,e,t,n){return w0(r,e,t,"int32",n)}var Ace=K({randomUniformInt_:Cce});function _l(r,e,t,n){if(t===void 0&&(t=1),n===void 0&&(n="float32"),t===0)throw new Error("Cannot have a step of zero");var a={start:r,stop:e,step:t,dtype:n};return J.runKernel(One,{},a)}function Dce(r){var e=M(r,"input","real"),t={input:e};return J.runKernel(Pne,t)}var Fl=K({real_:Dce});function _ce(r){var e=M(r,"x","reciprocal"),t={x:e};return J.runKernel(Mne,t)}var Fce=K({reciprocal_:_ce});function Rce(r){var e=M(r,"x","relu"),t={x:e};return J.runKernel(Bne,t)}var Op=K({relu_:Rce});function Oce(r){var e=M(r,"x","relu6"),t={x:e};return J.runKernel(Wne,t)}var WA=K({relu6_:Oce});function Pce(r,e){var t=M(r,"x","reverse"),n={x:t},a={dims:e};return J.runKernel(Gne,n,a)}var gs=K({reverse_:Pce});function Mce(r){var e=M(r,"x","reverse");return U(e.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank ".concat(e.rank,".")}),gs(e,0)}var Bce=K({reverse1d_:Mce});function Lce(r,e){var t=M(r,"x","reverse");return U(t.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank ".concat(t.rank,".")}),gs(t,e)}var zce=K({reverse2d_:Lce});function $ce(r,e){var t=M(r,"x","reverse");return U(t.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank ".concat(t.rank,".")}),gs(t,e)}var Wce=K({reverse3d_:$ce});function Gce(r,e){var t=M(r,"x","reverse");return U(t.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank ".concat(t.rank,".")}),gs(t,e)}var Vce=K({reverse4d_:Gce});function Uce(r){var e=M(r,"x","round"),t={x:e};return J.runKernel(Vne,t)}var GA=K({round_:Uce});function Hce(r){var e=M(r,"x","rsqrt","float32"),t={x:e};return J.runKernel(Une,t)}var qce=K({rsqrt_:Hce});function Kce(r){var e=M(r,"x","selu"),t={x:e};return J.runKernel(Xne,t)}var jce=K({selu_:Kce});function Xce(r,e,t,n,a,i,o){i===void 0&&(i=[1,1]),o===void 0&&(o="NHWC");var s=M(r,"x","separableConv2d"),u=M(e,"depthwiseFilter","separableConv2d"),c=M(t,"pointwiseFilter","separableConv2d"),l=s,f=!1;if(s.rank===3&&(f=!0,l=me(s,[1,s.shape[0],s.shape[1],s.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");U(l.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got "+"rank ".concat(l.rank,".")}),U(u.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but "+"got rank ".concat(u.rank,".")}),U(c.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but "+"got rank ".concat(u.rank,".")}),U(c.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter "+" must be 1, but got ".concat(c.shape[0],".")}),U(c.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise "+"filter must be 1, but got ".concat(c.shape[1],".")});var h=u.shape[2],p=u.shape[3];U(c.shape[2]===h*p,function(){return"Error in separableConv2d: the third dimension of pointwise filter "+"must be ".concat(h*p,", ")+"but got ".concat(c.shape[2],".")});var d=p0(l,u,n,a,o,i),m=1,v=Cp(d,c,m,"valid",o);return f?me(v,[v.shape[1],v.shape[2],v.shape[3]]):v}var Yce=K({separableConv2d_:Xce});function Zce(r,e){return yt(this,void 0,void 0,function(){var t,n,a,i,o,s,l,u,c,l,f;return gt(this,function(h){switch(h.label){case 0:return t=M(r,"x","setdiff1d"),n=M(e,"y","setdiff1d"),U(t.dtype===n.dtype,function(){return"x and y should have the same dtype, but got x (".concat(t.dtype,") and y (").concat(n.dtype,").")}),U(t.rank===1,function(){return"x should be 1D tensor, but got x (".concat(t.shape,").")}),U(n.rank===1,function(){return"y should be 1D tensor, but got y (".concat(n.shape,").")}),[4,t.data()];case 1:return a=h.sent(),[4,n.data()];case 2:for(i=h.sent(),o=new Set(i),s=0,l=0;l<a.length;l++)o.has(a[l])||s++;for(u=new Vy([s],t.dtype),c=new Vy([s],"int32"),l=0,f=0;l<a.length;l++)o.has(a[l])||(u.values[f]=a[l],c.values[f]=l,f++);return[2,[u.toTensor(),c.toTensor()]]}})})}var Jce=Zce;function Qce(r){var e=M(r,"x","sign"),t={x:e};return J.runKernel(Qne,t)}var ele=K({sign_:Qce});function tle(r){var e=M(r,"x","sin","float32"),t={x:e};return J.runKernel(Zne,t)}var rle=K({sin_:tle});function nle(r){var e=M(r,"x","sinh"),t={x:e};return J.runKernel(Jne,t)}var ale=K({sinh_:nle});function ile(r,e,t){var n=M(r,"x","slice1d");return U(n.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-".concat(n.rank," tensor")}),nr(n,[e],[t])}var ole=K({slice1d_:ile});function sle(r,e,t){var n=M(r,"x","slice2d");return U(n.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-".concat(n.rank," tensor")}),nr(n,e,t)}var ule=K({slice2d_:sle});function cle(r,e,t){var n=M(r,"x","slice3d");return U(n.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-".concat(n.rank," tensor")}),nr(n,e,t)}var lle=K({slice3d_:cle});function fle(r,e,t){var n=M(r,"x","slice4d");return U(n.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-".concat(n.rank," tensor")}),nr(n,e,t)}var hle=K({slice4d_:fle});function ple(r,e){e===void 0&&(e=-1);var t=M(r,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(t.rank," and dim was ").concat(e));var n={logits:t},a={dim:e};return J.runKernel(oae,n,a)}var dle=K({softmax_:ple});function vle(r){U(r.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 "+"but got ".concat(r.dtype,".")});var e={input:r};return J.runKernel(Mre,e)}var x0=K({fft_:vle});function mle(r){U(r.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 "+"but got ".concat(r.dtype,".")});var e={input:r};return J.runKernel(qre,e)}var xp=K({ifft_:mle});function gle(r){var e=r.shape[r.shape.length-1],t=r.size/e,n;if(e<=2){var a=me(r,[t,e]);n=xp(a)}else{var i=[t,2*(e-1)],o=me(Fl(r),[t,e]),s=me(Rp(r),[t,e]),u=gs(nr(o,[0,1],[t,e-2]),1),c=ft(gs(nr(s,[0,1],[t,e-2]),1),yr(-1)),l=Gn([o,u],1),f=Gn([s,c],1),a=me(yo(l,f),[i[0],i[1]]);n=xp(a)}if(n=Fl(n),r.rank===3&&r.shape[0]!==0){var h=n,p=r.shape[0];n=me(n,[p,n.shape[0]/p,n.shape[1]]),h.dispose()}return n}var VA=K({irfft_:gle});function yle(r,e,t){t===void 0&&(t=0);var n=M(r,"x","split"),a={x:n},i={numOrSizeSplits:e,axis:t};return J.runKernel(iae,a,i)}var Rl=K({split_:yle});function ble(r,e){U(r.dtype==="float32",function(){return"The dtype for rfft() must be real value but got ".concat(r.dtype)});var t=r.shape[r.shape.length-1],n=r.size/t,a;if(e!=null&&e<t){var i=r.shape.map(function(g){return 0}),o=r.shape.map(function(g){return g});o[r.shape.length-1]=e,a=nr(r,i,o),t=e}else if(e!=null&&e>t){var s=r.shape.map(function(g){return g});s[r.shape.length-1]=e-t,a=Gn([r,Fu(s)],r.shape.length-1),t=e}else a=r;var u=d0(a),c=me(yo(a,u),[n,t]),l=x0(c),f=Math.floor(t/2)+1,h=Fl(l),p=Rp(l),d=Rl(h,[f,t-f],h.shape.length-1),m=Rl(p,[f,t-f],p.shape.length-1),v=a.shape.slice();return v[a.shape.length-1]=f,me(yo(d[0],m[0]),v)}var k0=K({rfft_:ble});function wle(r,e){var t,n=M(r,"a","squaredDifference"),a=M(e,"b","squaredDifference");t=be(dr(n,a),2),n=t[0],a=t[1],zr(n.shape,a.shape);var i={a:n,b:a},o={};return J.runKernel(hae,i,o)}var UA=K({squaredDifference_:wle});function xle(r,e){var t=M(r,"x","squeeze","string_or_numeric");return me(t,Ite(t.shape,e).newShape)}var S0=K({squeeze_:xle});function kle(r,e){e===void 0&&(e=0);var t=vp(r,"tensors","stack","string_or_numeric");U(t.length>=1,function(){return"Pass at least one tensor to tf.stack"}),t.length>0&&U(e<=t[0].rank,function(){return"Axis must be <= rank of the tensor"});var n=t,a={axis:e};return J.runKernel(Nne,n,a)}var Ol=K({stack_:kle});function Sle(r,e){e===void 0&&(e=0);var t=M(r,"x","step"),n={x:t},a={alpha:e};return J.runKernel(Iae,n,a)}var HA=K({step_:Sle});function Ele(r,e,t,n,a,i,o,s,u){a===void 0&&(a=0),i===void 0&&(i=0),o===void 0&&(o=0),s===void 0&&(s=0),u===void 0&&(u=0);var c=M(r,"x","stridedSlice","string_or_numeric"),l={x:c},f={begin:e,end:t,strides:n,beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u};return J.runKernel(dae,l,f)}var Tle=K({stridedSlice_:Ele});function Nle(r){var e=M(r,"x","tan","float32"),t={x:e};return J.runKernel(bae,t)}var Ile=K({tan_:Nle});function Au(r,e,t){var n=bo(r,t);return xo(r,e,n,t)}function Da(r,e){Ru(r);var t=bo(r,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");var n=null;return xo(r,n,t,e)}function Nl(r,e,t){if(Ru(r),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var n=bo(r,t);if(n.length!==2&&n.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return xo(r,e,n,t)}function Cle(r,e,t){if(Ru(r),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var n=bo(r,t);if(n.length!==3&&n.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return xo(r,e,n,t)}function Ale(r,e,t){if(Ru(r),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var n=bo(r,t);if(n.length!==4&&n.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return xo(r,e,n,t)}function Dle(r,e,t){if(Ru(r),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var n=bo(r,t);if(n.length!==5&&n.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return xo(r,e,n,t)}function _le(r,e,t){if(Ru(r),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var n=bo(r,t);if(n.length!==6&&n.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return e=e||n,xo(r,e,n,t)}function Fle(r,e,t){var n=e.rank>1?e.shape[e.rank-1]:1,a=e.rank>1?e.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + "+"shape[sliceDim:], got updates.shape: ".concat(t.shape)+", indices.shape: ".concat(e.shape,", shape: ").concat(r)+", sliceDim: ".concat(n,", and batchDim: ").concat(a,".");if(t.rank<a)throw new Error(i+" update.rank < ".concat(a,". "));if(r.length<n+(t.rank-a))throw new Error(i+" Output shape length < ".concat(n+(t.rank-a)));if(t.rank!==a+r.length-n)throw new Error(i+" update.rank != ".concat(a+r.length-n));for(var o=0;o<a;++o)if(t.shape[o]!==e.shape[o])throw new Error(i+" updates.shape[".concat(o,"] (").concat(t.shape[o],") != indices.shape[").concat(o,"] (").concat(e.shape[o],")."));for(var o=0;o<t.rank-a;++o)if(t.shape[o+a]!==r[o+n])throw new Error(i+" updates.shape[".concat(o+a,"] (").concat(t.shape[o+a],") != shape[").concat(o+a,"] (").concat(r[o+a],")"))}function qA(r,e,t){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher,"+" but the rank was ".concat(e.rank,"."));if(r.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher,"+" but the rank was ".concat(r.rank,"."));if(e.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: ".concat(e.dtype));if(t.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: ".concat(t));if(t.length===0){if(e.size===0)throw new Error("Indices specified for empty output. indices shape: ".concat(e.shape));if(r.size===0)throw new Error("Updates specified for empty output. updates shape: ".concat(r.shape))}Fle(t,e,r)}function Rle(r,e,t){var n=M(r,"tensor","tensorScatterupdate"),a=M(e,"indices","tensorScatterupdate","int32"),i=M(t,"updates","tensorScatterupdate");if(qA(i,a,n.shape),n.dtype!==i.dtype)throw new Error("tensor and updates must have the same dtype, instead they are ".concat(n.dtype," and ").concat(i.dtype,"."));var o={tensor:n,indices:a,updates:i},s={};return J.runKernel(qne,o,s)}var Ole=K({tensorScatterUpdate_:Rle});function Ple(r,e,t){e===void 0&&(e=1),t===void 0&&(t=!0);var n=M(r,"x","topk");if(n.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var a=n.shape[n.shape.length-1];if(e<0)throw new Error("'k' passed to topk() must be >= 0 but got ".concat(e));if(e>a)throw new Error("'k' passed to topk() must be <= the last dimension (".concat(a,") ")+"but got ".concat(e));var i={x:n},o={k:e,sorted:t},s=be(J.runKernel(xae,i,o),2),u=s[0],c=s[1];return{values:u,indices:c}}var Mle=K({topk_:Ple});function Ble(r,e,t,n,a){if(e===void 0&&(e=0),t===void 0&&(t=1),ra(r),n!=null&&n==="bool")throw new Error("Unsupported data type $ { dtype }");for(var i=new b0(e,t,n,!0,a),o=go(r,n),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var Lle=K({truncatedNormal_:Ble});function zle(r,e){e===void 0&&(e=0);var t=M(r,"x","unique","string_or_numeric");U(t.rank>0,function(){return"The input tensor must be at least 1D"});var n={x:t},a={axis:e},i=be(J.runKernel(Sae,n,a),2),o=i[0],s=i[1];return{values:o,indices:s}}var $le=K({unique_:zle});function Wle(r,e,t){var n=M(r,"x","unsortedSegmentSum"),a=M(e,"segmentIds","unsortedSegmentSum","int32");U(Il(t),function(){return"numSegments must be of dtype int"});var i={x:n,segmentIds:a},o={numSegments:t};return J.runKernel(Tae,i,o)}var Gle=K({unsortedSegmentSum_:Wle});function Vle(r,e){e===void 0&&(e=0);var t=M(r,"x","unstack","string_or_numeric");U(e>=-t.shape.length&&e<t.shape.length,function(){return"Axis = ".concat(e," is not in [-").concat(t.shape.length,", ").concat(t.shape.length,")")});var n={value:t},a={axis:e};return J.runKernel(Eae,n,a)}var E0=K({unstack_:Vle});function Ule(r,e){return g0(r,e,"right")}function Hle(r,e,t,n){return e===void 0&&(e=!0),J.makeVariable(r,e,t,n)}function qle(r,e){for(var t=[],n=0;n<e.length;n++)e[n]&&t.push(n);for(var a=go(r,"int32"),i=go([t.length,r.length],"int32"),n=0;n<t.length;n++){var o=a.indexToLoc(t[n]),s=n*r.length;i.values.set(o,s)}return i.toTensor()}function Kle(r){return yt(this,void 0,void 0,function(){var e,t,n;return gt(this,function(a){switch(a.label){case 0:return e=M(r,"condition","whereAsync","bool"),[4,e.data()];case 1:return t=a.sent(),n=qle(e.shape,t),r!==e&&e.dispose(),[2,n]}})})}var KA=Kle;function jle(r,e,t){return yt(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f,h,p,d,m;return gt(this,function(v){switch(v.label){case 0:for(n=M(r,"tensor","boolMask"),a=M(e,"mask","boolMask","bool"),i=t??0,o=a.rank,s=n.shape,U(o>0,function(){return"mask cannot be scalar"}),_a(s.slice(i,i+o),a.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,c=i;c<i+o;c++)u*=s[c];return l=s.slice(0,i).concat([u],s.slice(i+o)),f=me(n,l),h=me(a,[-1]),[4,KA(h)];case 1:return p=v.sent(),d=S0(p,[1]),m=xA(f,d,i),r!==n&&n.dispose(),e!==a&&a.dispose(),d.dispose(),f.dispose(),h.dispose(),p.dispose(),[2,m]}})})}var Xle=jle;function Yle(r,e){return J.tidy(r,e)}function Zle(r){var e=sA(r);e.forEach(function(t){return t.dispose()})}function Jle(){return J.backendName}function Qle(){return J.backend}function efe(r,e,t){var n=M(r,"x","transpose");if(e==null&&(e=n.shape.map(function(o,s){return s}).reverse()),U(n.rank===e.length,function(){return"Error in transpose: rank of input ".concat(n.rank," ")+"must match length of perm ".concat(e,".")}),e.forEach(function(o){U(o>=0&&o<n.rank,function(){return"All entries in 'perm' must be between 0 and ".concat(n.rank-1)+" but got ".concat(e)})}),n.rank<=1)return n.clone();var a={x:n},i={perm:e};return n.dtype==="complex64"?Yle(function(){var o=Fl(n),s=Rp(n);return o=J.runKernel(Ny,{x:o},i),s=J.runKernel(Ny,{x:s},i),t&&(s=vi(s)),yo(o,s)}):J.runKernel(Ny,a,i)}var e0=K({transpose_:efe});function tfe(r,e,t,n,a){a===void 0&&(a=!0);var i=M(r,"v","movingAverage"),o=M(e,"x","movingAverage"),s=M(t,"decay","movingAverage");Xae(i,o),U(ys(i.shape,o.shape),function(){return"Shape mismatch in v and x"});var u=yr(1),c=kt(u,s),l=ft(kt(o,i),c);if(a){U(n!=null,function(){return"When using zeroDebias: true, step is required."});var f=M(n,"step","movingAverage");l=un(l,kt(u,v0(s,f)))}return Lr(i,l)}var rfe=K({movingAverage_:tfe});function nfe(r,e,t){ra(t);var n=M(r,"indices","scatterND","int32"),a=M(e,"updates","scatterND");qA(a,n,t);var i={indices:n,updates:a},o={shape:t};return J.runKernel(Hne,i,o)}var afe=K({scatterND_:nfe});function ife(r,e,t,n){if(r.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type,"+" but the dtype was ".concat(r.dtype,"."));if(r.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix,"+" but got shape ".concat(r.shape,"."));var a=r.rank>0?r.shape[0]:1,i=r.rank>1?r.shape[1]:1;if(t.length!==i)throw new Error("outputShape has incorrect number of elements:,"+" ".concat(t.length,", should be: ").concat(i,"."));var o=e.size;if(!(e.rank===0||e.rank===1&&o===a))throw new Error("sparseValues has incorrect shape "+"".concat(e.shape,", should be [] or [").concat(a,"]"));if(e.dtype!==n.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}function ofe(r,e,t,n){n===void 0&&(n=0),ra(t);var a=M(r,"sparseIndices","sparseToDense","int32"),i=M(e,"sparseValues","sparseToDense","string_or_numeric"),o=M(n,"defaultValue","sparseToDense",i.dtype);ife(a,i,t,o);var s={sparseIndices:a,sparseValues:i,defaultValue:o},u={outputShape:t};return J.runKernel(fae,s,u)}var sfe=K({sparseToDense_:ofe});function ufe(r,e){var t=M(e,"indices","gatherND","int32"),n=M(r,"x","gatherND","string_or_numeric"),a={params:n,indices:t};return J.runKernel(Vre,a)}var cfe=K({gatherND_:ufe});function lfe(r,e){if(e==null)return r.shape.slice();if(ys(r.shape,e))return e;if(r.shape.length===e.length){for(var t=[],n=0;n<r.shape.length;n++)e[n]==null&&r.shape[n]!=null?t.push(r.shape[n]):t.push(e[n]);return t}return e}function ffe(r,e,t,n){var a=M(r,"x","dropout");if(U(a.dtype==="float32",function(){return"x has to be a floating point tensor since it's going to be "+"scaled, but got a ".concat(a.dtype," tensor instead.")}),U(e>=0&&e<1,function(){return"rate must be a float in the range [0, 1), but got ".concat(e,".")}),e===0)return r instanceof $n?a.clone():a;var i=lfe(a,t),o=1-e,s=un(wA(Lr(w0(i,0,1,"float32",n),o)),o);return ft(a,s)}var hfe=K({dropout_:ffe});function jA(r){return Math.floor(Math.pow(2,Math.ceil(Math.log(r)/Math.log(2))))}function T0(r,e,t){for(var n=1-r%2,a=new Float32Array(r),i=0;i<r;++i){var o=2*Math.PI*i/(r+n-1);a[i]=e-t*Math.cos(o)}return Da(a,"float32")}function pfe(r,e,t){return t===void 0&&(t=1),yt(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f,h,p,d,m,v,v;return gt(this,function(g){switch(g.label){case 0:return n=M(r,"predictions","inTopK"),a=M(e,"targets","inTopK"),U(n.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, "+"but got ".concat(n.rank)}),U(n.rank-1===a.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+"".concat(n.rank," and targets rank ").concat(a.rank)}),_a(n.shape.slice(0,n.shape.length-1),a.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),i=n.shape[n.shape.length-1],U(t>0&&t<=i,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last "+"dimension (".concat(i,"), but got ").concat(t)}),[4,n.data()];case 1:return o=g.sent(),[4,a.data()];case 2:for(s=g.sent(),u=be([o.length/i,i],2),c=u[0],l=u[1],f=Cte("bool",c),h=0;h<c;h++){for(p=h*l,d=o.subarray(p,p+l),m=[],v=0;v<d.length;v++)m.push({value:d[v],index:v});for(m.sort(function(y,w){return w.value-y.value}),f[h]=0,v=0;v<t;v++)if(m[v].index===s[h]){f[h]=1;break}}return r!==n&&n.dispose(),e!==a&&a.dispose(),[2,Au(f,a.shape,"bool")]}})})}var dfe=pfe;function vfe(r,e,t,n,a,i,o){i===void 0&&(i="NHWC");var s=r;r.rank===3&&(s=me(r,[1,r.shape[0],r.shape[1],r.shape[2]]));var u=e;u.rank===3&&(u=me(e,[1,e.shape[0],e.shape[1],e.shape[2]])),U(s.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+"".concat(s.shape,".")}),U(u.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+"".concat(u.shape,".")}),U(t.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+"".concat(t,".")});var c=i==="NHWC"?s.shape[3]:s.shape[1],l=i==="NHWC"?u.shape[3]:u.shape[1];U(c===t[2],function(){return"Error in conv2dDerFilter: depth of input ".concat(c,") must ")+"match input depth in filter (".concat(t[2],".")}),U(l===t[3],function(){return"Error in conv2dDerFilter: depth of dy (".concat(l,") must ")+"match output depth for filter (".concat(t[3],").")}),ri("conv2dDerFilter",a,o);var f={x:s,dy:u},h={strides:n,pad:a,dataFormat:i,dimRoundingMode:o,filterShape:t};return J.runKernel(hre,f,h)}var mfe=K({conv2DBackpropFilter_:vfe});function N0(r,e,t){if(t==null||t==="linear")return r;if(t==="relu")return ft(r,HA(e));throw new Error("Cannot compute gradient for fused activation ".concat(t,"."))}function I0(r,e){var t=e,n=Xoe(r.shape,e.shape);return n.length>0&&(t=qt(t,n)),me(t,r.shape)}function C0(r,e,t,n){if(e==="linear")return r;if(e==="relu")return Op(r);if(e==="elu")return gA(r);if(e==="relu6")return WA(r);if(e==="prelu")return FA(r,t);if(e==="leakyrelu")return SA(r,n);if(e==="sigmoid")return Iu(r);throw new Error("Unknown fused activation ".concat(e,"."))}var A0=function(r,e){var t=r>0;return!t||e==="linear"};function gfe(r){var e,t=r.x,n=r.filter,a=r.strides,i=r.pad,o=r.dataFormat,s=o===void 0?"NHWC":o,u=r.dilations,c=u===void 0?[1,1]:u,l=r.dimRoundingMode,f=r.bias,h=r.activation,p=h===void 0?"linear":h,d=r.preluActivationWeights,m=r.leakyreluAlpha;if(p=p||"linear",A0(J.state.gradientDepth,p)===!1){U(s==="NHWC",function(){return"Error in fused conv2d: got dataFormat of ".concat(s," but ")+"only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear."});var v=Cp(t,n,a,i,s,c,l);return f!=null&&(v=Lr(v,f)),C0(v,p,d,m)}var g=M(t,"x","conv2d","float32"),y=M(n,"filter","conv2d","float32"),w=g,b=!1;g.rank===3&&(b=!0,w=me(g,[1,g.shape[0],g.shape[1],g.shape[2]])),U(w.rank===4,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+"".concat(w.rank,".")}),U(y.rank===4,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+"".concat(y.rank,".")}),ri("fused conv2d",i,l);var x=s==="NHWC"?w.shape[3]:w.shape[1];U(y.shape[2]===x,function(){return"Error in conv2d: depth of input (".concat(x,") must match ")+"input depth for filter ".concat(y.shape[2],".")}),U(wo(a,c),function(){return"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(a," and dilations '").concat(c,"'")});var S=h0(w.shape,y.shape,a,c,i,l),T;f!=null&&(T=M(f,"bias","fused conv2d"),e=be(dr(T,g),1),T=e[0],s==="NHWC"?zr(S.outShape,T.shape):(U(T.shape.length<=1,function(){return"Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of "+"rank-".concat(T.shape.length,".")}),U(T.shape.length===0||T.shape[0]===S.outChannels||T.shape[0]===1,function(){return"Error in fused conv2d: bias shape (".concat(T.shape,") is not ")+"compatible with the number of output channels "+"(".concat(S.outChannels,")")})));var N;if(d!=null){var C=d.shape;if(U(C.length<=1||C.length===3,function(){return"Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of "+"rank-".concat(C.length,".")}),C.length===1)U(C[0]===1||C[0]===S.outChannels,function(){return"Error in fused conv2d: PReLU activation weights "+"(".concat(C,") is not compatible with the number of output ")+"channels (".concat(S.outChannels,").")});else if(C.length===3)try{zr(C,S.outShape)}catch{var R="Error in fused conv2d: PReLU activation weights (".concat(C,") ")+"is not compatible with the output shape of the conv2d "+"(".concat(S.outShape,").");throw Error(R)}N=M(d,"prelu weights","fused conv2d")}var _=function(B,G){U(s==="NHWC",function(){return"Error in gradient of fused conv2D: got dataFormat of ".concat(s," but only NHWC is currently supported.")});var X=be(G,4),Z=X[0],V=X[1],j=X[2],re=X[3],te=N0(B,j,p);U(gp(c),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 "+"are not yet supported in gradients. Got dilations '".concat(c,"'")});var oe=dA(V.shape,te,Z,a,i),ce=mfe(V,te,Z.shape,a,i),pe=[oe,ce];if(re!=null){var xe=I0(re,te);pe.push(xe)}return pe},P={x:w,filter:y,bias:T,preluActivationWeights:N},$={strides:a,pad:i,dataFormat:s,dilations:c,dimRoundingMode:l,activation:p,leakyreluAlpha:m};if(f==null){var z=Bi(function(B,G,X){var Z=J.runKernel(hC,P,$);return X([G,B,Z]),b&&(Z=me(Z,[Z.shape[1],Z.shape[2],Z.shape[3]])),{value:Z,gradFunc:_}});return z(w,y)}else{var L=Bi(function(B,G,X,Z){var V=J.runKernel(hC,P,$);return Z([G,B,V,X]),b&&(V=me(V,[V.shape[1],V.shape[2],V.shape[3]])),{value:V,gradFunc:_}});return L(w,y,T)}}var yfe=K({fusedConv2d_:gfe});function bfe(r,e,t,n,a,i,o){i===void 0&&(i=[1,1]);var s=r;r.rank===3&&(s=me(r,[1,r.shape[0],r.shape[1],r.shape[2]]));var u=e;u.rank===3&&(u=me(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var c={x:s,dy:u},l={strides:n,pad:a,dimRoundingMode:o,dilations:i,filterShape:t};return J.runKernel(Ere,c,l)}var wfe=K({depthwiseConv2dNativeBackpropFilter_:bfe});function xfe(r,e,t,n,a,i,o){i===void 0&&(i=[1,1]);var s=e,u=!1;e.rank===3&&(u=!0,s=me(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var c={dy:s,filter:t},l={strides:n,pad:a,dimRoundingMode:o,dilations:i,inputShape:r},f=J.runKernel(Tre,c,l);return u?me(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var kfe=K({depthwiseConv2dNativeBackpropInput_:xfe});function Sfe(r){var e,t=r.x,n=r.filter,a=r.strides,i=r.pad,o=r.dataFormat,s=o===void 0?"NHWC":o,u=r.dilations,c=u===void 0?[1,1]:u,l=r.dimRoundingMode,f=r.bias,h=r.activation,p=h===void 0?"linear":h,d=r.preluActivationWeights,m=r.leakyreluAlpha;if(A0(J.state.gradientDepth,p)===!1){var v=p0(t,n,a,i,s,c,l);return f!=null&&(v=Lr(v,f)),C0(v,p,d,m)}var g=M(t,"x","depthwiseConv2d","float32"),y=M(n,"filter","depthwiseConv2d","float32"),w=g,b=!1;g.rank===3&&(b=!0,w=me(g,[1,g.shape[0],g.shape[1],g.shape[2]])),U(w.rank===4,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got "+"rank ".concat(w.rank,".")}),U(y.rank===4,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, "+"but got rank ".concat(y.rank,".")}),U(w.shape[3]===y.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels "+"(".concat(w.shape[3],") must match the inChannels dimension in ")+"filter ".concat(y.shape[2],".")}),c==null&&(c=[1,1]),U(wo(a,c),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must "+"be 1. Got strides ".concat(a," and dilations '").concat(c,"'")}),ri("fused depthwiseConv2d",i,l);var x=h0(w.shape,y.shape,a,c,i,l,!0),S;f!=null&&(S=M(f,"bias","fused conv2d"),e=be(dr(S,g),1),S=e[0],zr(x.outShape,S.shape));var T;d!=null&&(T=M(d,"prelu weights","fused depthwiseConv2d"));var N=function($,z){U(gp(c),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations "+"'".concat(c,"'")});var L=be(z,4),B=L[0],G=L[1],X=L[2],Z=L[3],V=N0($,X,p),j=kfe(G.shape,V,B,a,i,c,l),re=wfe(G,V,B.shape,a,i,c,l);if(Z!=null){var te=I0(S,V);return[j,re,te]}return[j,re]},C={x:w,filter:y,bias:S,preluActivationWeights:T},R={strides:a,pad:i,dataFormat:s,dilations:c,dimRoundingMode:l,activation:p,leakyreluAlpha:m};if(f==null){var _=Bi(function($,z,L){var B=J.runKernel(pC,C,R);return L([z,$,B]),b&&(B=me(B,[B.shape[1],B.shape[2],B.shape[3]])),{value:B,gradFunc:N}});return _(w,y)}else{var P=Bi(function($,z,L,B){var G=J.runKernel(pC,C,R);return B([z,$,G,L]),b&&(G=me(G,[G.shape[1],G.shape[2],G.shape[3]])),{value:G,gradFunc:N}});return P(w,y,S)}}var Efe=K({fusedDepthwiseConv2d_:Sfe});function Tfe(r){var e,t,n=r.a,a=r.b,i=r.transposeA,o=i===void 0?!1:i,s=r.transposeB,u=s===void 0?!1:s,c=r.bias,l=r.activation,f=l===void 0?"linear":l,h=r.preluActivationWeights,p=r.leakyreluAlpha,d=p===void 0?.2:p;if(A0(J.state.gradientDepth,f)===!1){var m=_t(n,a,o,u);return c!=null&&(m=Lr(m,c)),C0(m,f,h,d)}var v=M(n,"a","fused matMul"),g=M(a,"b","fused matMul");e=be(dr(v,g),2),v=e[0],g=e[1];var y=o?v.shape[v.rank-2]:v.shape[v.rank-1],w=u?g.shape[g.rank-1]:g.shape[g.rank-2],b=o?v.shape[v.rank-1]:v.shape[v.rank-2],x=u?g.shape[g.rank-2]:g.shape[g.rank-1],S=v.shape.slice(0,-2),T=g.shape.slice(0,-2),N=Br(S),C=Br(T);U(y===w,function(){return"Error in fused matMul: inner shapes (".concat(y,") and (")+"".concat(w,") of Tensors with shapes ").concat(v.shape," and ")+"".concat(g.shape," and transposeA=").concat(o)+" and transposeB=".concat(u," must match.")});var R=zr(v.shape.slice(0,-2),g.shape.slice(0,-2)),_=R.concat([b,x]),P=o?me(v,[N,y,b]):me(v,[N,b,y]),$=u?me(g,[C,x,w]):me(g,[C,w,x]),z;c!=null&&(z=M(c,"bias","fused matMul"),t=be(dr(z,v),1),z=t[0],zr(_,z.shape));var L;h!=null&&(L=M(h,"prelu weights","fused matMul"));var B=function(j,re){var te=be(re,4),oe=te[0],ce=te[1],pe=te[2],xe=te[3],fe=N0(me(j,pe.shape),pe,f),ge,we;if(!o&&!u?(ge=_t(fe,ce,!1,!0),we=_t(oe,fe,!0,!1)):!o&&u?(ge=_t(fe,ce,!1,!1),we=_t(fe,oe,!0,!1)):o&&!u?(ge=_t(ce,fe,!1,!0),we=_t(oe,fe,!1,!1)):(ge=_t(ce,fe,!0,!0),we=_t(fe,oe,!0,!0)),c!=null){var Ae=I0(xe,fe);return[ge,we,Ae]}else return[ge,we]},G={a:P,b:$,bias:z,preluActivationWeights:L},X={transposeA:o,transposeB:u,activation:f,leakyreluAlpha:d};if(c==null){var Z=Bi(function(j,re,te){var oe=J.runKernel(fC,G,X);return te([j,re,oe]),{value:me(oe,_),gradFunc:B}});return Z(P,$)}else{var V=Bi(function(j,re,te,oe){var ce=J.runKernel(fC,G,X);return oe([j,re,ce,te]),{value:me(ce,_),gradFunc:B}});return V(P,$,z)}}var Nfe=K({fusedMatMul_:Tfe});var Ife={__proto__:null,conv2d:yfe,depthwiseConv2d:Efe,matMul:Nfe};function Cfe(r){return T0(r,.54,.46)}var Afe=K({hammingWindow_:Cfe});function Dfe(r){return T0(r,.5,.5)}var XA=K({hannWindow_:Dfe});function _fe(r,e,t,n,a){n===void 0&&(n=!1),a===void 0&&(a=0);for(var i=0,o=[];i+e<=r.size;)o.push(nr(r,i,e)),i+=t;if(n)for(;i<r.size;){var s=i+e-r.size,u=Gn([nr(r,i,e-s),Ip([s],a)]);o.push(u),i+=t}return o.length===0?Nl([],[0,e]):me(Gn(o),[o.length,e])}var YA=K({frame_:_fe});function Ffe(r,e,t,n,a){a===void 0&&(a=XA),n==null&&(n=jA(e));var i=YA(r,e,t),o=ft(i,a(e));return k0(o,n)}var Rfe=K({stft_:Ffe});function Ofe(r,e,t,n,a,i){a===void 0&&(a="bilinear"),i===void 0&&(i=0);var o=M(r,"image","cropAndResize"),s=M(e,"boxes","cropAndResize","float32"),u=M(t,"boxInd","cropAndResize","int32"),c=s.shape[0];U(o.rank===4,function(){return"Error in cropAndResize: image must be rank 4,"+"but got rank ".concat(o.rank,".")}),U(s.rank===2&&s.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size [".concat(c,",4] ")+"but had shape ".concat(s.shape,".")}),U(u.rank===1&&u.shape[0]===c,function(){return"Error in cropAndResize: boxInd must be have size [".concat(c,"] ")+"but had shape ".concat(s.shape,".")}),U(n.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got "+"length ".concat(n.length,".")}),U(n[0]>=1&&n[1]>=1,function(){return"cropSize must be atleast [1,1], but was ".concat(n)}),U(a==="bilinear"||a==="nearest",function(){return"method must be bilinear or nearest, but was ".concat(a)});var l={image:o,boxes:s,boxInd:u},f={method:a,extrapolationValue:i,cropSize:n},h=J.runKernel(wre,l,f);return h}var Pfe=K({cropAndResize_:Ofe});function Mfe(r){var e=M(r,"image","flipLeftRight","float32");U(e.rank===4,function(){return"Error in flipLeftRight: image must be rank 4,"+"but got rank ".concat(e.rank,".")});var t={image:e},n=J.runKernel(Lre,t,{});return n}var Bfe=K({flipLeftRight_:Mfe});function Lfe(r){var e=M(r,"image","grayscaleToRGB"),t=e.rank-1,n=e.shape[t];U(e.rank>=2,function(){return"Error in grayscaleToRGB: images must be at least rank 2, "+"but got rank ".concat(e.rank,".")}),U(n===1,function(){return"Error in grayscaleToRGB: last dimension of a grayscale image "+"should be size 1, but got size ".concat(n,".")});var a=new Array(e.rank);return a.fill(1,0,t),a[t]=3,Tl(e,a)}var zfe=K({grayscaleToRGB_:Lfe});function $fe(r){var e=M(r,"image","RGBToGrayscale"),t=e.rank-1,n=e.shape[t];U(e.rank>=2,function(){return"Error in RGBToGrayscale: images must be at least rank 2, "+"but got rank ".concat(e.rank,".")}),U(n===3,function(){return"Error in RGBToGrayscale: last dimension of an RGB image "+"should be size 3, but got size ".concat(n,".")});var a=e.dtype,i=Fr(e,"float32"),o=Da([.2989,.587,.114]),s;switch(e.rank){case 2:s=Eu("ij,j->i",i,o);break;case 3:s=Eu("ijk,k->ij",i,o);break;case 4:s=Eu("ijkl,l->ijk",i,o);break;case 5:s=Eu("ijklm,m->ijkl",i,o);break;case 6:s=Eu("ijklmn,n->ijklm",i,o);break;default:throw new Error("Not a valid tensor rank.")}return s=vo(s,-1),Fr(s,a)}var Wfe=K({rgbToGrayscale_:$fe});function Gfe(r,e,t,n){t===void 0&&(t=0),n===void 0&&(n=.5);var a=M(r,"image","rotateWithOffset","float32");U(a.rank===4,function(){return"Error in rotateWithOffset: image must be rank 4,"+"but got rank ".concat(a.rank,".")});var i={image:a},o={radians:e,fillValue:t,center:n},s=J.runKernel(Cae,i,o);return s}var Vfe=K({rotateWithOffset_:Gfe});function Ou(r,e,t,n,a,i){n==null&&(n=.5),a==null&&(a=Number.NEGATIVE_INFINITY),i==null&&(i=0);var o=r.shape[0];return t=Math.min(t,o),U(0<=n&&n<=1,function(){return"iouThreshold must be in [0, 1], but was '".concat(n,"'")}),U(r.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '".concat(r.rank,"'")}),U(r.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was ".concat(r.shape[1])}),U(e.rank===1,function(){return"scores must be a 1D tensor"}),U(e.shape[0]===o,function(){return"scores has incompatible shape with boxes. Expected ".concat(o,", ")+"but was ".concat(e.shape[0])}),U(0<=i&&i<=1,function(){return"softNmsSigma must be in [0, 1], but was '".concat(i,"'")}),{maxOutputSize:t,iouThreshold:n,scoreThreshold:a,softNmsSigma:i}}function Ufe(r,e,t,n,a){n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY);var i=M(r,"boxes","nonMaxSuppression","float32"),o=M(e,"scores","nonMaxSuppression","float32"),s=Ou(i,o,t,n,a);t=s.maxOutputSize,n=s.iouThreshold,a=s.scoreThreshold;var u={maxOutputSize:t,iouThreshold:n,scoreThreshold:a};return J.runKernel(xne,{boxes:i,scores:o},u)}var Hfe=K({nonMaxSuppression_:Ufe});function qfe(r,e,t){var n=Kfe(r,e,t),a=n<0?-(n+1):n;r.splice(a,0,e)}function Kfe(r,e,t){return Xfe(r,e,t||jfe)}function jfe(r,e){return r>e?1:r<e?-1:0}function Xfe(r,e,t){for(var n=0,a=r.length,i=0,o=!1;n<a;){i=n+(a-n>>>1);var s=t(e,r[i]);s>0?n=i+1:(a=i,o=!s)}return o?n:-n-1}function Yfe(r,e,t,n,a){return D0(r,e,t,n,a,0)}function Zfe(r,e,t,n,a,i){return D0(r,e,t,n,a,0,!1,i,!0)}function Jfe(r,e,t,n,a,i){return D0(r,e,t,n,a,i,!0)}function D0(r,e,t,n,a,i,o,s,u){o===void 0&&(o=!1),s===void 0&&(s=!1),u===void 0&&(u=!1);for(var c=[],l=0;l<e.length;l++)e[l]>a&&c.push({score:e[l],boxIndex:l,suppressBeginIndex:0});c.sort(IC);for(var f=i>0?-.5/i:0,h=[],p=[];h.length<t&&c.length>0;){var d=c.pop(),m=d.score,v=d.boxIndex,g=d.suppressBeginIndex;if(m<a)break;for(var y=!1,w=h.length-1;w>=g;--w){var b=Qfe(r,v,h[w]);if(b>=n){y=!0;break}if(d.score=d.score*ehe(n,f,b),d.score<=a)break}d.suppressBeginIndex=h.length,y||(d.score===m?(h.push(v),p.push(d.score)):d.score>a&&qfe(c,d,IC))}var x=h.length,S=t-x;s&&S>0&&(h.push.apply(h,Et([],be(new Array(S).fill(0)),!1)),p.push.apply(p,Et([],be(new Array(S).fill(0)),!1)));var T={selectedIndices:h};return o&&(T.selectedScores=p),u&&(T.validOutputs=x),T}function Qfe(r,e,t){var n=r.subarray(e*4,e*4+4),a=r.subarray(t*4,t*4+4),i=Math.min(n[0],n[2]),o=Math.min(n[1],n[3]),s=Math.max(n[0],n[2]),u=Math.max(n[1],n[3]),c=Math.min(a[0],a[2]),l=Math.min(a[1],a[3]),f=Math.max(a[0],a[2]),h=Math.max(a[1],a[3]),p=(s-i)*(u-o),d=(f-c)*(h-l);if(p<=0||d<=0)return 0;var m=Math.max(i,c),v=Math.max(o,l),g=Math.min(s,f),y=Math.min(u,h),w=Math.max(g-m,0)*Math.max(y-v,0);return w/(p+d-w)}function ehe(r,e,t){var n=Math.exp(e*t*t);return t<=r?n:0}function IC(r,e){return r.score-e.score||r.score===e.score&&e.boxIndex-r.boxIndex}function the(r,e,t,n,a){return n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),yt(this,void 0,void 0,function(){var i,o,s,u,c,l,f;return gt(this,function(h){switch(h.label){case 0:return i=M(r,"boxes","nonMaxSuppressionAsync"),o=M(e,"scores","nonMaxSuppressionAsync"),s=Ou(i,o,t,n,a),t=s.maxOutputSize,n=s.iouThreshold,a=s.scoreThreshold,[4,Promise.all([i.data(),o.data()])];case 1:return u=h.sent(),c=u[0],l=u[1],f=Yfe(c,l,t,n,a).selectedIndices,i!==r&&i.dispose(),o!==e&&o.dispose(),[2,Da(f,"int32")]}})})}var rhe=the;function nhe(r,e,t,n,a,i){n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=0);var o=M(r,"boxes","nonMaxSuppression"),s=M(e,"scores","nonMaxSuppression"),u=Ou(o,s,t,n,a,i);t=u.maxOutputSize,n=u.iouThreshold,a=u.scoreThreshold,i=u.softNmsSigma;var c={boxes:o,scores:s},l={maxOutputSize:t,iouThreshold:n,scoreThreshold:a,softNmsSigma:i},f=J.runKernel(Sne,c,l);return{selectedIndices:f[0],selectedScores:f[1]}}var ahe=K({nonMaxSuppressionWithScore_:nhe});function ihe(r,e,t,n,a,i){return n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=0),yt(this,void 0,void 0,function(){var o,s,u,c,l,f,h,p,d;return gt(this,function(m){switch(m.label){case 0:return o=M(r,"boxes","nonMaxSuppressionAsync"),s=M(e,"scores","nonMaxSuppressionAsync"),u=Ou(o,s,t,n,a,i),t=u.maxOutputSize,n=u.iouThreshold,a=u.scoreThreshold,i=u.softNmsSigma,[4,Promise.all([o.data(),s.data()])];case 1:return c=m.sent(),l=c[0],f=c[1],h=Jfe(l,f,t,n,a,i),p=h.selectedIndices,d=h.selectedScores,o!==r&&o.dispose(),s!==e&&s.dispose(),[2,{selectedIndices:Da(p,"int32"),selectedScores:Da(d)}]}})})}var ohe=ihe;function she(r,e,t,n,a,i){n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=!1);var o=M(r,"boxes","nonMaxSuppression"),s=M(e,"scores","nonMaxSuppression"),u=Ou(o,s,t,n,a,null),c=u.maxOutputSize,l=u.iouThreshold,f=u.scoreThreshold,h={boxes:o,scores:s},p={maxOutputSize:c,iouThreshold:l,scoreThreshold:f,padToMaxOutputSize:i},d=J.runKernel(kne,h,p);return{selectedIndices:d[0],validOutputs:d[1]}}var uhe=K({nonMaxSuppressionPadded_:she});function che(r,e,t,n,a,i){return n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=!1),yt(this,void 0,void 0,function(){var o,s,u,c,l,f,h,p,d,m,v,g;return gt(this,function(y){switch(y.label){case 0:return o=M(r,"boxes","nonMaxSuppressionAsync"),s=M(e,"scores","nonMaxSuppressionAsync"),u=Ou(o,s,t,n,a,null),c=u.maxOutputSize,l=u.iouThreshold,f=u.scoreThreshold,[4,Promise.all([o.data(),s.data()])];case 1:return h=be.apply(void 0,[y.sent(),2]),p=h[0],d=h[1],m=Zfe(p,d,c,l,f,i),v=m.selectedIndices,g=m.validOutputs,o!==r&&o.dispose(),s!==e&&s.dispose(),[2,{selectedIndices:Da(v,"int32"),validOutputs:yr(g,"int32")}]}})})}var lhe=che;function fhe(r,e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!1);var a=M(r,"images","resizeBilinear");U(a.rank===3||a.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got "+"rank ".concat(a.rank,".")}),U(e.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+"".concat(e,".")}),U(n===!1||t===!1,function(){return"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."});var i=a,o=!1;a.rank===3&&(o=!0,i=me(a,[1,a.shape[0],a.shape[1],a.shape[2]])),be(e,0);var s={images:i},u={alignCorners:t,halfPixelCenters:n,size:e},c=J.runKernel($ne,s,u);return o?me(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var hhe=K({resizeBilinear_:fhe});function phe(r,e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!1);var a=M(r,"images","resizeNearestNeighbor");U(a.rank===3||a.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got "+"rank ".concat(a.rank,".")}),U(e.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+"".concat(e,".")}),U(a.dtype==="float32"||a.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"}),U(n===!1||t===!1,function(){return"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."});var i=a,o=!1;a.rank===3&&(o=!0,i=me(a,[1,a.shape[0],a.shape[1],a.shape[2]])),be(e,0);var s={images:i},u={alignCorners:t,halfPixelCenters:n,size:e},c=J.runKernel(zne,s,u);return o?me(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var dhe=K({resizeNearestNeighbor_:phe});function vhe(r,e,t,n){var a;e===void 0&&(e="binary"),t===void 0&&(t=!1),n===void 0&&(n=.5);var i=M(r,"image","threshold"),o=.2989,s=.587,u=.114,c=i.shape[0]*i.shape[1],l=ft(Da([n]),255),f,h,p,d;if(U(i.rank===3,function(){return"Error in threshold: image must be rank 3,"+"but got rank ".concat(i.rank,".")}),U(i.shape[2]===3||i.shape[2]===1,function(){return"Error in threshold: image color channel must be equal to 3 or 1"+"but got ".concat(i.shape[2],".")}),U(i.dtype==="int32"||i.dtype==="float32",function(){return"Error in dtype: image dtype must be int32 or float32,"+"but got dtype ".concat(i.dtype,".")}),U(e==="otsu"||e==="binary",function(){return"Method must be binary or otsu, but was ".concat(e)}),i.shape[2]===3){a=be(Rl(i,[1,1,1],-1),3),f=a[0],h=a[1],p=a[2];var m=ft(f,o),v=ft(h,s),g=ft(p,u);d=Lr(Lr(m,v),g)}else d=r;if(e==="otsu"){var y=pA(Fr(GA(d),"int32"),Au([]),256);l=mhe(y,c)}var w=t?m0(d,l):Fp(d,l),b=Fr(ft(w,255),"int32");return b}function mhe(r,e){for(var t=Da([-1]),n=Da([0]),a=Da([0]),i,o,s,u,c,l,f=0;f<r.size-1;f++){i=nr(r,0,f+1),o=nr(r,f+1),c=un(qt(i),e),l=un(qt(o),e);var h=qt(ft(i,_l(0,i.size)));s=un(h,qt(i));var p=Ip(o.shape,i.size),d=Lr(_l(0,o.size),p),m=ft(o,d);u=un(qt(m),qt(o));var v=kt(s,u),g=kt(s,u),y=ft(c,l);a=ft(ft(y,v),g);var w=Fp(a,n);n=mo(w,a,n),t=mo(w,Da([f]),t)}return t}var ghe=K({threshold_:vhe});function yhe(r,e,t,n,a,i){t===void 0&&(t="nearest"),n===void 0&&(n="constant"),a===void 0&&(a=0);var o=M(r,"image","transform","float32"),s=M(e,"transforms","transform","float32");U(o.rank===4,function(){return"Error in transform: image must be rank 4,"+"but got rank ".concat(o.rank,".")}),U(s.rank===2&&(s.shape[0]===o.shape[0]||s.shape[0]===1)&&s.shape[1]===8,function(){return"Error in transform: Input transform should be batch x 8 or 1 x 8"}),U(i==null||i.length===2,function(){return"Error in transform: outputShape must be [height, width] or null, "+"but got ".concat(i,".")});var u={image:o,transforms:s},c={interpolation:t,fillMode:n,fillValue:a,outputShape:i};return J.runKernel(kae,u,c)}var bhe=K({transform_:yhe});function whe(r,e,t){var n=M(r,"a","bandPart");U(n.rank>=2,function(){return"bandPart(): Rank must be at least 2, got ".concat(n.rank,".")});var a=n.shape,i=be(n.shape.slice(-2),2),o=i[0],s=i[1],u,c;typeof e=="number"?(U(e%1===0,function(){return"bandPart(): numLower must be an integer, got ".concat(e,".")}),U(e<=o,function(){return"bandPart(): numLower (".concat(e,")")+" must not be greater than the number of rows (".concat(o,").")}),u=M(e<0?o:e,"numLower","bandPart")):(U(e.dtype==="int32",function(){return"bandPart(): numLower's dtype must be an int32."}),u=mo(Qy(e,0),o,wp(e,o))),typeof t=="number"?(U(t%1===0,function(){return"bandPart(): numUpper must be an integer, got ".concat(t,".")}),U(t<=s,function(){return"bandPart(): numUpper (".concat(t,")")+" must not be greater than the number of columns (".concat(s,").")}),c=M(t<0?s:t,"numUpper","bandPart")):(U(t.dtype==="int32",function(){return"bandPart(): numUpper's dtype must be an int32."}),c=mo(Qy(t,0),s,wp(t,s)));var l=me(_l(0,o,1,"int32"),[-1,1]),f=_l(0,s,1,"int32"),h=kt(l,f),p=yp(m0(h,u),kA(h,vi(c))),d=Fu([o,s],n.dtype);return me(Ol(E0(me(n,[-1,o,s])).map(function(m){return mo(p,m,d)})),a)}var xhe=K({bandPart_:whe});function khe(r){var e;if(Array.isArray(r)){e=!1,U(r!=null&&r.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var t=r[0].shape[0],n=function(u){U(r[u].shape[0]===t,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: "+"(".concat(r[u].shape[0]," vs. ").concat(t,")")})},a=1;a<r.length;++a)n(a)}else e=!0,r=Rl(r,r.shape[0],0).map(function(u){return S0(u,[0])});U(r.length<=r[0].shape[0],function(){return"Gram-Schmidt: Number of vectors (".concat(r.length,") exceeds ")+"number of dimensions (".concat(r[0].shape[0],").")});for(var i=[],o=r,s=function(u){i.push(J.tidy(function(){var c=o[u];if(u>0)for(var l=0;l<u;++l){var f=ft(qt(ft(i[l],c)),i[l]);c=kt(c,f)}return un(c,_p(c,"euclidean"))}))},a=0;a<r.length;++a)s(a);return e?Ol(i,0):i}var She=K({gramSchmidt_:khe});function Ehe(r,e){if(e===void 0&&(e=!1),U(r.rank>=2,function(){return"qr() requires input tensor to have a rank >= 2, but got rank ".concat(r.rank)}),r.rank===2)return CC(r,e);var t=r.shape.slice(0,r.shape.length-2).reduce(function(u,c){return u*c}),n=E0(me(r,[t,r.shape[r.shape.length-2],r.shape[r.shape.length-1]]),0),a=[],i=[];n.forEach(function(u){var c=be(CC(u,e),2),l=c[0],f=c[1];a.push(l),i.push(f)});var o=me(Ol(a,0),r.shape),s=me(Ol(i,0),r.shape);return[o,s]}function CC(r,e){return e===void 0&&(e=!1),J.tidy(function(){U(r.shape.length===2,function(){return"qr2d() requires a 2D Tensor, but got a ".concat(r.shape.length,"D Tensor.")});for(var t=r.shape[0],n=r.shape[1],a=bA(t),i=Nu(r),o=Nl([[1]],[1,1]),s=Nu(o),u=t>=n?n:t,c=function(f){var h,p=i,d=s,m=a;h=be(J.tidy(function(){var v=nr(i,[f,f],[t-f,1]),g=_p(v),y=nr(i,[f,f],[1,1]),w=mo(Fp(y,0),Nl([[-1]]),Nl([[1]])),b=kt(y,ft(w,g)),x=un(v,b);x.shape[0]===1?s=Nu(o):s=Gn([o,nr(x,[1,0],[x.shape[0]-1,x.shape[1]])],0);var S=vi(un(_t(w,b),g)),T=nr(i,[f,0],[t-f,n]),N=ft(S,s),C=e0(s);if(f===0)i=kt(T,_t(N,_t(C,T)));else{var R=kt(T,_t(N,_t(C,T)));i=Gn([nr(i,[0,0],[f,n]),R],0)}var _=e0(N),P=nr(a,[0,f],[t,a.shape[1]-f]);if(f===0)a=kt(P,_t(_t(P,s),_));else{var $=kt(P,_t(_t(P,s),_));a=Gn([nr(a,[0,0],[t,f]),$],1)}return[s,i,a]}),3),s=h[0],i=h[1],a=h[2],Zle([p,d,m])},l=0;l<u;++l)c(l);return!e&&t>n&&(a=nr(a,[0,0],[t,n]),i=nr(i,[0,0],[n,n])),[a,i]})}var The=K({qr_:Ehe});var bn;(function(r){r[r.NONE=0]="NONE",r[r.MEAN=1]="MEAN",r[r.SUM=2]="SUM",r[r.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(bn||(bn={}));function Nhe(r,e,t){t===void 0&&(t=bn.SUM_BY_NONZERO_WEIGHTS);var n=M(r,"losses","computeWeightedLoss"),a=null;e!=null&&(a=M(e,"weights","computeWeightedLoss"));var i=a==null?n:ft(n,a);if(t===bn.NONE)return i;if(t===bn.SUM)return qt(i);if(t===bn.MEAN){if(a==null)return bp(i);var o=n.size/a.size,s=un(qt(i),qt(a));return o>1?un(s,yr(o)):s}if(t===bn.SUM_BY_NONZERO_WEIGHTS){if(a==null)return un(qt(i),yr(n.size));var u=ft(a,vs(n.shape)),c=Fr(qt(DA(u,yr(0))),"float32");return un(qt(i),c)}throw Error("Unknown reduction: ".concat(t))}var Li=K({computeWeightedLoss_:Nhe});function Ihe(r,e,t,n){n===void 0&&(n=bn.SUM_BY_NONZERO_WEIGHTS);var a=M(r,"labels","absoluteDifference"),i=M(e,"predictions","absoluteDifference"),o=null;t!=null&&(o=M(t,"weights","absoluteDifference")),_a(a.shape,i.shape,"Error in absoluteDifference: ");var s=Ta(kt(a,i));return Li(s,o,n)}var Che=K({absoluteDifference_:Ihe});function Ahe(r,e,t,n,a){a===void 0&&(a=bn.SUM_BY_NONZERO_WEIGHTS);var i=M(r,"labels","cosineDistance"),o=M(e,"predictions","cosineDistance"),s=null;n!=null&&(s=M(n,"weights","cosineDistance")),_a(i.shape,o.shape,"Error in cosineDistance: ");var u=yr(1),c=kt(u,qt(ft(i,o),t,!0));return Li(c,s,a)}var Dhe=K({cosineDistance_:Ahe});function _he(r,e,t,n){n===void 0&&(n=bn.SUM_BY_NONZERO_WEIGHTS);var a=M(r,"labels","hingeLoss"),i=M(e,"predictions","hingeLoss"),o=null;t!=null&&(o=M(t,"weights","hingeLoss")),_a(a.shape,i.shape,"Error in hingeLoss: ");var s=yr(1);a=kt(ft(yr(2),a),s);var u=Op(kt(s,ft(a,i)));return Li(u,o,n)}var Fhe=K({hingeLoss_:_he});function Rhe(r,e,t,n,a){n===void 0&&(n=1),a===void 0&&(a=bn.SUM_BY_NONZERO_WEIGHTS);var i=M(r,"labels","huberLoss"),o=M(e,"predictions","huberLoss"),s=null;t!=null&&(s=M(t,"weights","huberLoss")),_a(i.shape,o.shape,"Error in huberLoss: ");var u=yr(n),c=Ta(kt(o,i)),l=wp(c,u),f=kt(c,l),h=Lr(ft(yr(.5),Dp(l)),ft(u,f));return Li(h,s,a)}var Ohe=K({huberLoss_:Rhe});function Phe(r,e,t,n,a){n===void 0&&(n=1e-7),a===void 0&&(a=bn.SUM_BY_NONZERO_WEIGHTS);var i=M(r,"labels","logLoss"),o=M(e,"predictions","logLoss"),s=null;t!=null&&(s=M(t,"weights","logLoss")),_a(i.shape,o.shape,"Error in logLoss: ");var u=yr(1),c=yr(n),l=vi(ft(i,Dl(Lr(o,c)))),f=ft(kt(u,i),Dl(Lr(kt(u,o),c))),h=kt(l,f);return Li(h,s,a)}var Mhe=K({logLoss_:Phe});function Bhe(r,e,t,n){n===void 0&&(n=bn.SUM_BY_NONZERO_WEIGHTS);var a=M(r,"labels","meanSquaredError"),i=M(e,"predictions","meanSquaredError"),o=null;t!=null&&(o=M(t,"weights","meanSquaredError")),_a(a.shape,i.shape,"Error in meanSquaredError: ");var s=UA(a,i);return Li(s,o,n)}var Lhe=K({meanSquaredError_:Bhe});function zhe(r,e){var t=M(r,"labels","sigmoidCrossEntropyWithLogits"),n=M(e,"logits","sigmoidCrossEntropyWithLogits");_a(t.shape,n.shape,"Error in sigmoidCrossEntropyWithLogits: ");var a=Op(n),i=ft(n,t),o=EA(ms(vi(Ta(n))));return Lr(kt(a,i),o)}function $he(r,e,t,n,a){n===void 0&&(n=0),a===void 0&&(a=bn.SUM_BY_NONZERO_WEIGHTS);var i=M(r,"multiClassLabels","sigmoidCrossEntropy"),o=M(e,"logits","sigmoidCrossEntropy"),s=null;if(t!=null&&(s=M(t,"weights","sigmoidCrossEntropy")),_a(i.shape,o.shape,"Error in sigmoidCrossEntropy: "),n>0){var u=yr(n),c=yr(1),l=yr(.5);i=Lr(ft(i,kt(c,u)),ft(l,u))}var f=zhe(i,o);return Li(f,s,a)}var Whe=K({sigmoidCrossEntropy_:$he});function Ghe(r,e,t){if(t===void 0&&(t=-1),t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet "+"supported. Labels / logits was rank ".concat(e.rank," ")+"and dim was ".concat(t));var n=Bi(function(a,i,o){var s=!0,u=NA(i,[t],s),c=kt(Fr(i,"float32"),u);o([a,c]);var l=vi(ft(c,a)),f=qt(l,[t]),h=function(p,d){var m=be(d,2),v=m[0],g=m[1],y=Ap(p.shape,[t]);return[ft(me(p,y),kt(Fr(v,"float32"),ms(g))),ft(me(p,y),kt(ms(g),Fr(v,"float32")))]};return{value:f,gradFunc:h}});return n(r,e)}function Vhe(r,e,t,n,a){n===void 0&&(n=0),a===void 0&&(a=bn.SUM_BY_NONZERO_WEIGHTS);var i=M(r,"onehotLabels","softmaxCrossEntropy"),o=M(e,"logits","softmaxCrossEntropy"),s=null;if(t!=null&&(s=M(t,"weights","softmaxCrossEntropy")),_a(i.shape,o.shape,"Error in softmaxCrossEntropy: "),n>0){var u=yr(n),c=yr(1),l=yr(i.shape[1]);i=Lr(ft(i,kt(c,u)),un(u,l))}var f=Ghe(i,o);return Li(f,s,a)}var Uhe=K({softmaxCrossEntropy_:Vhe});function Hhe(r,e,t,n){var a=M(r,"indices","sparseFillEmptyRows","int32"),i=M(e,"values","sparseFillEmptyRows"),o=M(t,"denseShape","sparseFillEmptyRows","int32"),s=M(n,"defaultValue","sparseFillEmptyRows",i.dtype);if(a.rank!==2)throw new Error(`Indices should be Tensor2D but received shape
        `.concat(a.shape));if(i.rank!==1)throw new Error("Values should be Tensor1D but received shape ".concat(i.shape));if(o.rank!==1)throw new Error("Dense shape should be Tensor1D but received shape ".concat(o.shape));if(s.rank!==0)throw new Error("Default value should be a scalar but received shape ".concat(s.shape));var u={indices:a,values:i,denseShape:o,defaultValue:s},c=J.runKernel(sae,u);return{outputIndices:c[0],outputValues:c[1],emptyRowIndicator:c[2],reverseIndexMap:c[3]}}var qhe=K({sparseFillEmptyRows_:Hhe});function Khe(r,e,t){var n=M(r,"inputIndices","sparseReshape","int32"),a=M(e,"inputShape","sparseReshape","int32"),i=M(t,"newShape","sparseReshape","int32");if(n.rank!==2)throw new Error(`Input indices should be Tensor2D but received shape
        `.concat(n.shape));if(a.rank!==1)throw new Error("Input shape should be Tensor1D but received shape ".concat(a.shape));if(i.rank!==1)throw new Error("New shape should be Tensor1D but received shape ".concat(i.shape));var o={inputIndices:n,inputShape:a,newShape:i},s=J.runKernel(uae,o);return{outputIndices:s[0],outputShape:s[1]}}var jhe=K({sparseReshape_:Khe});function Xhe(r,e,t){var n=M(r,"data","sparseSegmentMean"),a=M(e,"indices","sparseSegmentMean","int32"),i=M(t,"segmentIds","sparseSegmentMean","int32");if(n.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
          `.concat(a.shape));if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
          `.concat(i.shape));var o={data:n,indices:a,segmentIds:i};return J.runKernel(cae,o)}var Yhe=K({sparseSegmentMean_:Xhe});function Zhe(r,e,t){var n=M(r,"data","sparseSegmentSum"),a=M(e,"indices","sparseSegmentSum","int32"),i=M(t,"segmentIds","sparseSegmentSum","int32");if(n.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
         `.concat(a.shape));if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
         `.concat(i.shape));var o={data:n,indices:a,segmentIds:i};return J.runKernel(lae,o)}var Jhe=K({sparseSegmentSum_:Zhe});function Qhe(r,e,t,n,a,i,o,s){var u=M(r,"data","stringNGrams","string");if(u.dtype!=="string")throw new Error("Data must be of datatype string");if(u.shape.length!==1)throw new Error("Data must be a vector, saw: ".concat(u.shape));var c=M(e,"dataSplits","stringNGrams");if(c.dtype!=="int32")throw new Error("Data splits must be of datatype int32");var l={separator:t,nGramWidths:n,leftPad:a,rightPad:i,padWidth:o,preserveShortSequences:s},f={data:u,dataSplits:c},h=J.runKernel(vae,f,l);return{nGrams:h[0],nGramsSplits:h[1]}}var epe=K({stringNGrams_:Qhe});function tpe(r,e,t){t===void 0&&(t=!0);var n=M(r,"input","stringSplit","string"),a=M(e,"delimiter","stringSplit","string");if(n.rank!==1)throw new Error("Input should be Tensor1D but received shape ".concat(n.shape));if(a.rank!==0)throw new Error("Delimiter should be a scalar but received shape ".concat(a.shape));var i={skipEmpty:t},o={input:n,delimiter:a},s=J.runKernel(mae,o,i);return{indices:s[0],values:s[1],shape:s[2]}}var rpe=K({stringSplit_:tpe});function npe(r,e){var t=M(r,"input","stringToHashBucketFast","string"),n={numBuckets:e};if(e<=0)throw new Error("Number of buckets must be at least 1");var a={input:t};return J.runKernel(gae,a,n)}var ape=K({stringToHashBucketFast_:npe});function ipe(r,e,t,n){n===void 0&&(n=!0);var a=M(r,"input","staticRegexReplace","string"),i={pattern:e,rewrite:t,replaceGlobal:n};return J.runKernel(pae,{x:a},i)}var ope=K({staticRegexReplace_:ipe});var spe={fft:x0,ifft:xp,rfft:k0,irfft:VA},upe={hammingWindow:Afe,hannWindow:XA,frame:YA,stft:Rfe},cpe={flipLeftRight:Bfe,grayscaleToRGB:zfe,resizeNearestNeighbor:dhe,resizeBilinear:hhe,rgbToGrayscale:Wfe,rotateWithOffset:Vfe,cropAndResize:Pfe,nonMaxSuppression:Hfe,nonMaxSuppressionAsync:rhe,nonMaxSuppressionWithScore:ahe,nonMaxSuppressionWithScoreAsync:ohe,nonMaxSuppressionPadded:uhe,nonMaxSuppressionPaddedAsync:lhe,threshold:ghe,transform:bhe},lpe={bandPart:xhe,gramSchmidt:She,qr:The},fpe={absoluteDifference:Che,computeWeightedLoss:Li,cosineDistance:Dhe,hingeLoss:Fhe,huberLoss:Ohe,logLoss:Mhe,meanSquaredError:Lhe,sigmoidCrossEntropy:Whe,softmaxCrossEntropy:Uhe},hpe={sparseFillEmptyRows:qhe,sparseReshape:jhe,sparseSegmentMean:Yhe,sparseSegmentSum:Jhe},ppe={stringNGrams:epe,stringSplit:rpe,stringToHashBucketFast:ape,staticRegexReplace:ope};var jr={__proto__:null,OP_SCOPE_SUFFIX:lA,abs:Ta,acos:rie,acosh:aie,add:Lr,addN:sie,all:cie,any:fie,argMax:pie,argMin:vie,asin:gie,asinh:bie,atan:xie,atan2:Sie,atanh:Tie,avgPool:fA,avgPool3d:Oie,basicLSTMCell:Vie,batchNorm:Np,batchNorm2d:jie,batchNorm3d:Yie,batchNorm4d:Jie,batchToSpaceND:hA,bincount:pA,bitwiseAnd:toe,booleanMaskAsync:Xle,broadcastArgs:noe,broadcastTo:fp,buffer:go,cast:Fr,ceil:ooe,clipByValue:uoe,clone:Nu,complex:yo,concat:Gn,concat1d:foe,concat2d:poe,concat3d:voe,concat4d:goe,conv1d:woe,conv2d:Cp,conv2dTranspose:Soe,conv3d:Toe,conv3dTranspose:Aoe,cos:_oe,cosh:Roe,cosineWindow:T0,cumprod:Poe,cumsum:Boe,denseBincount:zoe,depthToSpace:Woe,depthwiseConv2d:p0,diag:Uoe,dilation2d:qoe,div:un,divNoNan:ese,dot:rse,dropout:hfe,einsum:Eu,elu:gA,enclosingPowerOfTwo:jA,ensureShape:ose,equal:mA,erf:use,euclideanNorm:yse,exp:ms,expandDims:vo,expm1:kse,eye:bA,fft:x0,fill:Ip,floor:wA,floorDiv:vA,fused:Ife,gather:xA,gatherND:cfe,greater:Fp,greaterEqual:kA,ifft:xp,imag:Rp,image:cpe,inTopKAsync:dfe,irfft:VA,isFinite:_se,isInf:Rse,isNaN:Pse,leakyRelu:SA,less:Qy,lessEqual:m0,linalg:lpe,linspace:zse,localResponseNormalization:Wse,log:Dl,log1p:EA,logSigmoid:Kse,logSoftmax:Yse,logSumExp:NA,logicalAnd:yp,logicalNot:IA,logicalOr:CA,logicalXor:rue,losses:fpe,lowerBound:aue,matMul:_t,max:Cu,maxPool:AA,maxPool3d:sue,maxPoolWithArgmax:cue,maximum:fue,mean:bp,meshgrid:pue,min:Zy,minimum:wp,mirrorPad:mue,mod:yue,moments:wue,movingAverage:rfe,mul:ft,multiRNNCell:kue,multinomial:Eue,neg:vi,norm:_p,notEqual:DA,oneHot:Iue,ones:vs,onesLike:Aue,op:K,outerProduct:_ue,pad:Pl,pad1d:Oue,pad2d:Mue,pad3d:Lue,pad4d:$ue,pool:Hue,pow:v0,prelu:FA,print:Kue,prod:Xue,raggedGather:Zue,raggedRange:Que,raggedTensorToTensor:tce,rand:nce,randomGamma:Sce,randomNormal:$A,randomStandardNormal:Nce,randomUniform:w0,randomUniformInt:Ace,range:_l,real:Fl,reciprocal:Fce,relu:Op,relu6:WA,reshape:me,reverse:gs,reverse1d:Bce,reverse2d:zce,reverse3d:Wce,reverse4d:Vce,rfft:k0,round:GA,rsqrt:qce,scalar:yr,scatterND:afe,searchSorted:g0,selu:jce,separableConv2d:Yce,setdiff1dAsync:Jce,sigmoid:Iu,sign:ele,signal:upe,sin:rle,sinh:ale,slice:nr,slice1d:ole,slice2d:ule,slice3d:lle,slice4d:hle,softmax:dle,softplus:TA,spaceToBatchND:_A,sparse:hpe,sparseToDense:sfe,spectral:spe,split:Rl,sqrt:Jy,square:Dp,squaredDifference:UA,squeeze:S0,stack:Ol,step:HA,stridedSlice:Tle,string:ppe,sub:kt,sum:qt,tan:Ile,tanh:Yy,tensor:Au,tensor1d:Da,tensor2d:Nl,tensor3d:Cle,tensor4d:Ale,tensor5d:Dle,tensor6d:_le,tensorScatterUpdate:Ole,tile:Tl,topk:Mle,transpose:e0,truncatedNormal:Lle,unique:$le,unsortedSegmentSum:Gle,unstack:E0,upperBound:Ule,variable:Hle,where:mo,whereAsync:KA,zeros:Fu,zerosLike:d0};var dpe=function(r,e,t,n){switch(n===void 0&&(n=jr),r.op){case"BiasAdd":case"AddV2":case"Add":return[n.add(I("a",r,e,t),I("b",r,e,t))];case"AddN":return[n.addN(I("tensors",r,e,t))];case"FloorMod":case"Mod":return[n.mod(I("a",r,e,t),I("b",r,e,t))];case"Mul":return[n.mul(I("a",r,e,t),I("b",r,e,t))];case"RealDiv":case"Div":return[n.div(I("a",r,e,t),I("b",r,e,t))];case"DivNoNan":return[n.divNoNan(I("a",r,e,t),I("b",r,e,t))];case"FloorDiv":return[n.floorDiv(I("a",r,e,t),I("b",r,e,t))];case"Sub":return[n.sub(I("a",r,e,t),I("b",r,e,t))];case"Minimum":return[n.minimum(I("a",r,e,t),I("b",r,e,t))];case"Maximum":return[n.maximum(I("a",r,e,t),I("b",r,e,t))];case"Pow":return[n.pow(I("a",r,e,t),I("b",r,e,t))];case"SquaredDifference":return[n.squaredDifference(I("a",r,e,t),I("b",r,e,t))];default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};var vpe=function(r,e,t,n){switch(n===void 0&&(n=jr),r.op){case"Abs":case"ComplexAbs":return[n.abs(I("x",r,e,t))];case"Acos":return[n.acos(I("x",r,e,t))];case"Acosh":return[n.acosh(I("x",r,e,t))];case"Asin":return[n.asin(I("x",r,e,t))];case"Asinh":return[n.asinh(I("x",r,e,t))];case"Atan":return[n.atan(I("x",r,e,t))];case"Atan2":return[n.atan2(I("x",r,e,t),I("y",r,e,t))];case"Atanh":return[n.atanh(I("x",r,e,t))];case"Ceil":return[n.ceil(I("x",r,e,t))];case"Complex":return[n.complex(I("real",r,e,t),I("imag",r,e,t))];case"Cos":return[n.cos(I("x",r,e,t))];case"Cosh":return[n.cosh(I("x",r,e,t))];case"Elu":return[n.elu(I("x",r,e,t))];case"Erf":return[n.erf(I("x",r,e,t))];case"Exp":return[n.exp(I("x",r,e,t))];case"Expm1":return[n.expm1(I("x",r,e,t))];case"Floor":return[n.floor(I("x",r,e,t))];case"Log":return[n.log(I("x",r,e,t))];case"Log1p":return[n.log1p(I("x",r,e,t))];case"Imag":return[n.imag(I("x",r,e,t))];case"Neg":return[n.neg(I("x",r,e,t))];case"Reciprocal":return[n.reciprocal(I("x",r,e,t))];case"Real":return[n.real(I("x",r,e,t))];case"Relu":return[n.relu(I("x",r,e,t))];case"Round":return[n.round(I("x",r,e,t))];case"Selu":return[n.selu(I("x",r,e,t))];case"Sigmoid":return[n.sigmoid(I("x",r,e,t))];case"Sin":return[n.sin(I("x",r,e,t))];case"Sign":return[n.sign(I("x",r,e,t))];case"Sinh":return[n.sinh(I("x",r,e,t))];case"Softplus":return[n.softplus(I("x",r,e,t))];case"Sqrt":return[n.sqrt(I("x",r,e,t))];case"Square":return[n.square(I("x",r,e,t))];case"Tanh":return[n.tanh(I("x",r,e,t))];case"Tan":return[n.tan(I("x",r,e,t))];case"ClipByValue":return[n.clipByValue(I("x",r,e,t),I("clipValueMin",r,e,t),I("clipValueMax",r,e,t))];case"Relu6":return[n.relu6(I("x",r,e,t))];case"Rsqrt":return[n.rsqrt(Kr(r.inputNames[0],e,t))];case"LeakyRelu":return[n.leakyRelu(I("x",r,e,t),I("alpha",r,e,t))];case"Prelu":return[n.prelu(I("x",r,e,t),I("alpha",r,e,t))];case"IsNan":return[n.isNaN(Kr(r.inputNames[0],e,t))];case"IsInf":return[n.isInf(Kr(r.inputNames[0],e,t))];case"IsFinite":return[n.isFinite(Kr(r.inputNames[0],e,t))];default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};function Na(r,e,t){if(t===void 0&&(t=""),!(typeof r=="number"||typeof e=="number")){Me.util.assert(r.length===e.length,function(){return t+" Shapes ".concat(r," and ").concat(e," must match")});for(var n=0;n<r.length;n++){var a=r[n],i=e[n];Me.util.assert(a<0||i<0||a===i,function(){return t+" Shapes ".concat(r," and ").concat(e," must match")})}}}function AC(r){return!(typeof r=="number"||r.some(function(e){return e<0}))}function kl(r,e,t){var n=t0(r,t),a=!AC(n);if(a&&e.length===0)throw new Error("Tried to calculate elements of an empty list"+" with non-fully-defined elementShape: ".concat(n));if(a&&e.forEach(function(i){n=t0(i.shape,n)}),!AC(n))throw new Error("Non-fully-defined elementShape: ".concat(n));return n}function t0(r,e){if(typeof r=="number")return e;if(typeof e=="number")return r;if(r.length!==e.length)throw new Error("Incompatible ranks during merge: ".concat(r," vs. ").concat(e));for(var t=[],n=0;n<r.length;++n){var a=r[n],i=e[n];if(a>=0&&i>=0&&a!==i)throw new Error("Incompatible shape during merge: ".concat(r," vs. ").concat(e));t[n]=a>=0?a:i}return t}var mpe=(function(){function r(e,t,n,a,i,o,s){this.name=e,this.dtype=t,this.maxSize=n,this.elementShape=a,this.identicalElementShapes=i,this.dynamicSize=o,this.clearAfterRead=s,this.tensors=[],this.closed_=!1,this.idTensor=Me.scalar(0),Me.keep(this.idTensor)}return Object.defineProperty(r.prototype,"id",{get:function(){return this.idTensor.id},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"closed",{get:function(){return this.closed_},enumerable:!1,configurable:!0}),r.prototype.clearAndClose=function(e){this.tensors.forEach(function(t){(e==null||!e.has(t.tensor.id))&&t.tensor.dispose()}),this.tensors=[],this.closed_=!0,this.idTensor.dispose()},r.prototype.size=function(){return this.tensors.length},r.prototype.read=function(e){if(this.closed_)throw new Error("TensorArray ".concat(this.name," has already been closed."));if(e<0||e>=this.size())throw new Error("Tried to read from index ".concat(e,", but array size is: ").concat(this.size()));var t=this.tensors[e];if(t.cleared)throw new Error("TensorArray ".concat(this.name,": Could not read index ").concat(e," twice because it was cleared after a previous read ")+"(perhaps try setting clear_after_read = false?).");return this.clearAfterRead&&(t.cleared=!0),t.read=!0,t.tensor},r.prototype.readMany=function(e){var t=this;return e.map(function(n){return t.read(n)})},r.prototype.write=function(e,t){if(this.closed_)throw new Error("TensorArray ".concat(this.name," has already been closed."));if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error("Tried to write to index ".concat(e,", but array is not resizeable and size is: ").concat(this.maxSize));var n=this.tensors[e]||{};if(t.dtype!==this.dtype)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,`,
          because the value dtype is `).concat(t.dtype,", but TensorArray dtype is ").concat(this.dtype,"."));if(this.size()===0&&(this.elementShape==null||this.elementShape.length===0)&&(this.elementShape=t.shape),Na(this.elementShape,t.shape,"TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,".")),n.read)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,", because it has already been read."));if(n.written)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,", because it has already been written."));n.tensor=t,Me.keep(t),n.written=!0,this.tensors[e]=n},r.prototype.writeMany=function(e,t){var n=this;if(e.length!==t.length)throw new Error("TensorArray ".concat(this.name,": could not write multiple tensors,")+"because the index size: ".concat(e.length," is not the same as tensors size: ").concat(t.length,"."));e.forEach(function(a,i){return n.write(a,t[i])})},r.prototype.gather=function(e,t){if(t&&t!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but gather requested dtype ").concat(t));if(e)e=e.slice(0,this.size());else{e=[];for(var n=0;n<this.size();n++)e.push(n)}if(e.length===0)return Me.tensor([],[0].concat(this.elementShape));var a=this.readMany(e);return Na(this.elementShape,a[0].shape,"TensorArray shape mismatch: "),Me.stack(a,0)},r.prototype.concat=function(e){if(e&&e!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but concat requested dtype ").concat(e));if(this.size()===0)return Me.tensor([],[0].concat(this.elementShape));for(var t=[],n=0;n<this.size();n++)t.push(n);var a=this.readMany(t);return Na(this.elementShape,a[0].shape,"TensorArray shape mismatch: tensor array shape (".concat(this.elementShape,") vs first tensor shape (").concat(a[0].shape,")")),Me.concat(a,0)},r.prototype.scatter=function(e,t){if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but tensor has dtype ").concat(t.dtype));if(e.length!==t.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: ".concat(e.length," vs. ").concat(t.shape[0]));var n=Math.max.apply(Math,Et([],be(e),!1));if(!this.dynamicSize&&n>=this.maxSize)throw new Error("Max index must be < array size (".concat(n,"  vs. ").concat(this.maxSize,")"));this.writeMany(e,Me.unstack(t,0))},r.prototype.split=function(e,t){var n=this;if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but tensor has dtype ").concat(t.dtype));var a=0,i=e.map(function(l){return a+=l,a});if(a!==t.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        `.concat(a,", and tensor's shape is: ").concat(t.shape));if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error("TensorArray's size is not equal to the size of lengths (".concat(this.maxSize," vs. ").concat(e.length,"), ")+"and the TensorArray is not marked as dynamically resizeable");var o=a===0?0:t.size/a,s=[];Me.tidy(function(){t=Me.reshape(t,[1,a,o]);for(var l=0;l<e.length;++l){var f=l===0?0:i[l-1],h=[0,f,0],p=[1,e[l],o];s[l]=Me.reshape(Me.slice(t,h,p),n.elementShape)}return s});for(var u=[],c=0;c<e.length;c++)u[c]=c;this.writeMany(u,s)},r})(),Pp=(function(){function r(e,t,n,a){a===void 0&&(a=-1),this.tensors=e,this.elementShape=t,this.elementDtype=n,e?.forEach(function(i){if(n!==i.dtype)throw new Error("Invalid data types; op elements ".concat(n,", but list elements ").concat(i.dtype));Na(t,i.shape,"TensorList shape mismatch: "),Me.keep(i)}),this.idTensor=Me.scalar(0),this.maxNumElements=a,Me.keep(this.idTensor)}return Object.defineProperty(r.prototype,"id",{get:function(){return this.idTensor.id},enumerable:!1,configurable:!0}),r.prototype.copy=function(){return new r(Et([],be(this.tensors),!1),this.elementShape,this.elementDtype)},r.prototype.clearAndClose=function(e){this.tensors.forEach(function(t){(e==null||!e.has(t.id))&&t.dispose()}),this.tensors.length=0,this.idTensor.dispose()},r.prototype.size=function(){return this.tensors.length},r.prototype.stack=function(e,t,n){var a=this;if(n===void 0&&(n=-1),t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));if(n!==-1&&this.tensors.length!==n)throw new Error("Operation expected a list with ".concat(n," elements but got a list with ").concat(this.tensors.length," elements."));Na(e,this.elementShape,"TensorList shape mismatch: ");var i=kl(this.elementShape,this.tensors,e);return Me.tidy(function(){var o=a.tensors.map(function(s){return Me.reshape(s,i)});return Me.stack(o,0)})},r.prototype.popBack=function(e,t){if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));if(this.size()===0)throw new Error("Trying to pop from an empty list.");var n=kl(this.elementShape,this.tensors,e),a=this.tensors.pop();return a.kept=!1,Na(a.shape,e,"TensorList shape mismatch: "),Me.reshape(a,n)},r.prototype.pushBack=function(e){if(e.dtype!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(e.dtype,", but list elements ").concat(this.elementDtype));if(Na(e.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");Me.keep(e),this.tensors.push(e)},r.prototype.resize=function(e){if(e<0)throw new Error("TensorListResize expects size to be non-negative. Got: ".concat(e));if(this.maxNumElements!==-1&&e>this.maxNumElements)throw new Error("TensorListResize input size ".concat(e," is greater maxNumElement ").concat(this.maxNumElements,"."));var t=new r([],this.elementShape,this.elementDtype,this.maxNumElements);t.tensors.length=e;for(var n=0;n<Math.min(this.tensors.length,e);++n)t.tensors[n]=this.tensors[n];return t},r.prototype.getItem=function(e,t,n){if(n!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(n,", but list elements ").concat(this.elementDtype));if(e<0||e>this.tensors.length)throw new Error("Trying to access element ".concat(e," in a list with ").concat(this.tensors.length," elements."));if(this.tensors[e]==null)throw new Error("element at index ".concat(e," is null."));Na(this.tensors[e].shape,t,"TensorList shape mismatch: ");var a=kl(this.elementShape,this.tensors,t);return Me.reshape(this.tensors[e],a)},r.prototype.setItem=function(e,t){if(t.dtype!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t.dtype,", but list elements ").concat(this.elementDtype));if(e<0||this.maxNumElements!==-1&&e>=this.maxNumElements)throw new Error("Trying to set element ".concat(e," in a list with max ").concat(this.maxNumElements," elements."));Na(this.elementShape,t.shape,"TensorList shape mismatch: "),Me.keep(t),this.tensors[e]!=null&&(this.tensors[e].kept=!1),this.tensors[e]=t},r.prototype.gather=function(e,t,n){var a=this;if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));Na(this.elementShape,n,"TensorList shape mismatch: "),e=e.slice(0,this.size());var i=kl(this.elementShape,this.tensors,n);return e.length===0?Me.tensor([],[0].concat(i)):Me.tidy(function(){var o=e.map(function(s){return Me.reshape(a.tensors[s],i)});return Me.stack(o,0)})},r.prototype.concat=function(e,t){var n=this;if(e&&e!==this.elementDtype)throw new Error("TensorList dtype is ".concat(this.elementDtype," but concat requested dtype ").concat(e));Na(this.elementShape,t,"TensorList shape mismatch: ");var a=kl(this.elementShape,this.tensors,t);return this.size()===0?Me.tensor([],[0].concat(a)):Me.tidy(function(){var i=n.tensors.map(function(o){return Me.reshape(o,a)});return Me.concat(i,0)})},r})();function gpe(r,e,t){var n=r.dtype;if(r.shape.length<1)throw new Error("Tensor must be at least a vector, but saw shape: ".concat(r.shape));if(r.dtype!==t)throw new Error("Invalid data types; op elements ".concat(r.dtype,", but list elements ").concat(t));var a=r.shape.slice(1);Na(a,e,"TensorList shape mismatch: ");var i=Me.unstack(r);return new Pp(i,e,n)}function ype(r,e,t,n){return new Pp([],r,e,n)}function bpe(r,e,t,n){if(e.length!==r.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: ".concat(e.length," vs. ").concat(r.shape[0]));var a=Math.max.apply(Math,Et([],be(e),!1));if(n!=null&&n!==-1&&a>=n)throw new Error("Max index must be < array size (".concat(a,"  vs. ").concat(n,")"));var i=new Pp([],t,r.dtype,n),o=Me.unstack(r,0);return e.forEach(function(s,u){i.setItem(s,o[u])}),i}function wpe(r,e,t){var n=0,a=e.map(function(f){return n+=f,n});if(n!==r.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        `.concat(n,", and tensor's shape is: ").concat(r.shape));for(var i=r.shape.slice(1),o=t0(i,t),s=n===0?0:r.size/n,u=Me.tidy(function(){var f=[];r=Me.reshape(r,[1,n,s]);for(var h=0;h<e.length;++h){var p=h===0?0:a[h-1],d=[0,p,0],m=[1,e[h],s];f[h]=Me.reshape(Me.slice(r,d,m),o)}return r.dispose(),f}),c=new Pp([],t,r.dtype,e.length),l=0;l<u.length;l++)c.setItem(l,u[l]);return c}var xpe=function(r,e,t){return yt(void 0,void 0,void 0,function(){var n,a,i,o,c,h,s,u,c,l,f,h,p,d,m,m,y,v,y,g,y,y,y,vr,w,Ze,b,x,S,T,N,C,oe,nt,R,_,ce,P,we,Ae,$,z,L,pe,xe,B,Qe,G,it,X,Je,Yt,Z,V,j,re,te,vt,oe,nt,qe,vt,ce,Ze,je,qe,pe,xe,Ze,Ke,qe,Ze,et,fe,Ke,ge,qe,we,Ae,Ze,et,qe,vt,Ze,et,Ke,qe,ot,Ze,et,qe,Qe,qe,it,Ze,vt,nt,qe,vt,Ze,je,qe,Je,Ze,Yt,qe,vt,qe,vt,vr,nn,kr;return gt(this,function(mr){switch(mr.label){case 0:switch(n=r.op,n){case"If":return[3,1];case"StatelessIf":return[3,1];case"While":return[3,3];case"StatelessWhile":return[3,3];case"LoopCond":return[3,9];case"Switch":return[3,10];case"Merge":return[3,12];case"Enter":return[3,13];case"Exit":return[3,14];case"NextIteration":return[3,15];case"TensorArrayV3":return[3,16];case"TensorArrayWriteV3":return[3,17];case"TensorArrayReadV3":return[3,18];case"TensorArrayGatherV3":return[3,19];case"TensorArrayScatterV3":return[3,20];case"TensorArrayConcatV3":return[3,21];case"TensorArraySplitV3":return[3,22];case"TensorArraySizeV3":return[3,23];case"TensorArrayCloseV3":return[3,24];case"TensorListSetItem":return[3,25];case"TensorListGetItem":return[3,26];case"TensorListScatterV2":return[3,27];case"TensorListScatter":return[3,27];case"TensorListReserve":return[3,28];case"EmptyTensorList":return[3,28];case"TensorListGather":return[3,29];case"TensorListStack":return[3,30];case"TensorListFromTensor":return[3,31];case"TensorListConcat":return[3,32];case"TensorListConcatV2":return[3,32];case"TensorListPushBack":return[3,33];case"TensorListPopBack":return[3,34];case"TensorListSplit":return[3,35];case"TensorListLength":return[3,36];case"TensorListResize":return[3,37]}return[3,38];case 1:return a=I("thenBranch",r,e,t),i=I("elseBranch",r,e,t),o=I("cond",r,e,t),c=I("args",r,e,t),[4,o.data()];case 2:return h=mr.sent(),h[0]?[2,t.functionMap[a].executeFunctionAsync(c,t.tensorArrayMap,t.tensorListMap)]:[2,t.functionMap[i].executeFunctionAsync(c,t.tensorArrayMap,t.tensorListMap)];case 3:return s=I("body",r,e,t),u=I("cond",r,e,t),c=I("args",r,e,t),[4,t.functionMap[u].executeFunctionAsync(c,t.tensorArrayMap,t.tensorListMap)];case 4:return l=mr.sent(),f=c.map(function(Zt){return Zt.id}),[4,l[0].data()];case 5:h=mr.sent(),l.forEach(function(Zt){!Zt.kept&&f.indexOf(Zt.id)===-1&&Zt.dispose()}),p=c,d=function(){var Zt,En,an;return gt(this,function(Tn){switch(Tn.label){case 0:return Zt=p,[4,t.functionMap[s].executeFunctionAsync(p,t.tensorArrayMap,t.tensorListMap)];case 1:return p=Tn.sent(),En=p.map(function(fr){return fr.id}),Zt.forEach(function(fr){!fr.kept&&f.indexOf(fr.id)===-1&&En.indexOf(fr.id)===-1&&fr.dispose()}),[4,t.functionMap[u].executeFunctionAsync(p,t.tensorArrayMap,t.tensorListMap)];case 2:return an=Tn.sent(),[4,an[0].data()];case 3:return h=Tn.sent(),an.forEach(function(fr){!fr.kept&&f.indexOf(fr.id)===-1&&En.indexOf(fr.id)===-1&&fr.dispose()}),[2]}})},mr.label=6;case 6:return h[0]?[5,d()]:[3,8];case 7:return mr.sent(),[3,6];case 8:return[2,p];case 9:return m=I("pred",r,e,t),[2,[Mi(m)]];case 10:return m=I("pred",r,e,t),y=I("data",r,e,t),y.kept||(y=Mi(y)),[4,m.data()];case 11:return[2,mr.sent()[0]?[void 0,y]:[y,void 0]];case 12:return v=r.inputNames.find(function(Zt){return Kr(Zt,e,t)!==void 0}),v?(y=Kr(v,e,t),[2,[Mi(y)]]):[2,void 0];case 13:return g=I("frameName",r,e,t),y=I("tensor",r,e,t),t.enterFrame(g),[2,[Mi(y)]];case 14:return y=I("tensor",r,e,t),t.exitFrame(),[2,[Mi(y)]];case 15:return y=I("tensor",r,e,t),t.nextIteration(),[2,[Mi(y)]];case 16:return vr=I("size",r,e,t),w=I("dtype",r,e,t),Ze=I("elementShape",r,e,t),b=I("dynamicSize",r,e,t),x=I("clearAfterRead",r,e,t),S=I("identicalElementShapes",r,e,t),T=I("name",r,e,t),N=new mpe(T,w,vr,Ze,S,b,x),t.addTensorArray(N),[2,[N.idTensor,Me.scalar(1)]];case 17:return C=I("tensorArrayId",r,e,t),oe=I("index",r,e,t),nt=I("tensor",r,e,t),R=t.getTensorArray(C.id),R.write(oe,nt),[2,[R.idTensor]];case 18:return _=I("tensorArrayId",r,e,t),ce=I("index",r,e,t),P=t.getTensorArray(_.id),[2,[P.read(ce)]];case 19:return we=I("tensorArrayId",r,e,t),Ae=I("indices",r,e,t),$=I("dtype",r,e,t),z=t.getTensorArray(we.id),[2,[z.gather(Ae,$)]];case 20:return L=I("tensorArrayId",r,e,t),pe=I("indices",r,e,t),xe=I("tensor",r,e,t),B=t.getTensorArray(L.id),B.scatter(pe,xe),[2,[B.idTensor]];case 21:return Qe=I("tensorArrayId",r,e,t),G=t.getTensorArray(Qe.id),it=I("dtype",r,e,t),[2,[G.concat(it)]];case 22:return X=I("tensorArrayId",r,e,t),Je=I("tensor",r,e,t),Yt=I("lengths",r,e,t),Z=t.getTensorArray(X.id),Z.split(Yt,Je),[2,[Z.idTensor]];case 23:return V=I("tensorArrayId",r,e,t),j=t.getTensorArray(V.id),[2,[Me.scalar(j.size(),"int32")]];case 24:return re=I("tensorArrayId",r,e,t),te=t.getTensorArray(re.id),te.clearAndClose(),[2,[te.idTensor]];case 25:return vt=I("tensorListId",r,e,t),oe=I("index",r,e,t),nt=I("tensor",r,e,t),qe=t.getTensorList(vt.id),qe.setItem(oe,nt),[2,[qe.idTensor]];case 26:return vt=I("tensorListId",r,e,t),ce=I("index",r,e,t),Ze=I("elementShape",r,e,t),je=I("elementDType",r,e,t),qe=t.getTensorList(vt.id),[2,[qe.getItem(ce,Ze,je)]];case 27:return pe=I("indices",r,e,t),xe=I("tensor",r,e,t),Ze=I("elementShape",r,e,t),Ke=I("numElements",r,e,t),qe=bpe(xe,pe,Ze,Ke),t.addTensorList(qe),[2,[qe.idTensor]];case 28:return Ze=I("elementShape",r,e,t),et=I("elementDType",r,e,t),fe=void 0,r.op==="TensorListReserve"?fe="numElements":fe="maxNumElements",Ke=I(fe,r,e,t),ge=r.op==="TensorListReserve"?-1:Ke,qe=ype(Ze,et,Ke,ge),t.addTensorList(qe),[2,[qe.idTensor]];case 29:return we=I("tensorListId",r,e,t),Ae=I("indices",r,e,t),Ze=I("elementShape",r,e,t),et=I("elementDType",r,e,t),qe=t.getTensorList(we.id),[2,[qe.gather(Ae,et,Ze)]];case 30:return vt=I("tensorListId",r,e,t),Ze=I("elementShape",r,e,t),et=I("elementDType",r,e,t),Ke=I("numElements",r,e,t),qe=t.getTensorList(vt.id),[2,[qe.stack(Ze,et,Ke)]];case 31:return ot=I("tensor",r,e,t),Ze=I("elementShape",r,e,t),et=I("elementDType",r,e,t),qe=gpe(ot,Ze,et),t.addTensorList(qe),[2,[qe.idTensor]];case 32:return Qe=I("tensorListId",r,e,t),qe=t.getTensorList(Qe.id),it=I("dtype",r,e,t),Ze=I("elementShape",r,e,t),[2,[qe.concat(it,Ze)]];case 33:return vt=I("tensorListId",r,e,t),nt=I("tensor",r,e,t),qe=t.getTensorList(vt.id),qe.pushBack(nt),[2,[qe.idTensor]];case 34:return vt=I("tensorListId",r,e,t),Ze=I("elementShape",r,e,t),je=I("elementDType",r,e,t),qe=t.getTensorList(vt.id),[2,[qe.popBack(Ze,je)]];case 35:return Je=I("tensor",r,e,t),Ze=I("elementShape",r,e,t),Yt=I("lengths",r,e,t),qe=wpe(Je,Yt,Ze),t.addTensorList(qe),[2,[qe.idTensor]];case 36:return vt=I("tensorListId",r,e,t),qe=t.getTensorList(vt.id),[2,[Me.scalar(qe.size(),"int32")]];case 37:return vt=I("tensorListId",r,e,t),vr=I("size",r,e,t),nn=t.getTensorList(vt.id),kr=nn.resize(vr),t.addTensorList(kr),[2,[kr.idTensor]];case 38:throw TypeError("Node type ".concat(r.op," is not implemented"))}})})};function DC(r,e,t){var n=be(I("fusedOps",r,e,t),2),a=n[0],i=n[1],o=a==="biasadd",s=!o,u=i==="prelu",c=a==="fusedbatchnorm",l=I("numArgs",r,e,t);if(o){if(u&&l!==2)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!u&&o&&l!==1)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(c)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");var f=I("strides",r,e,t),h=up(r,e,t),p=I("dataFormat",r,e,t).toUpperCase(),d=I("dilations",r,e,t),m=be(I("args",r,e,t),2),v=m[0],g=m[1];s&&(g=v,v=void 0);var y=I("leakyreluAlpha",r,e,t);return{stride:f,pad:h,dataFormat:p,dilations:d,biasArg:v,preluArg:g,activationFunc:i,leakyreluAlpha:y}}var kpe=function(r,e,t,n){switch(n===void 0&&(n=jr),r.op){case"Conv1D":{var a=I("stride",r,e,t),i=I("pad",r,e,t),o=I("dataFormat",r,e,t).toUpperCase(),s=I("dilation",r,e,t);return[n.conv1d(I("x",r,e,t),I("filter",r,e,t),a,i,o,s)]}case"Conv2D":{var a=I("strides",r,e,t),i=up(r,e,t),o=I("dataFormat",r,e,t).toUpperCase(),u=I("dilations",r,e,t);return[n.conv2d(I("x",r,e,t),I("filter",r,e,t),[a[1],a[2]],i,o,[u[1],u[2]])]}case"_FusedConv2D":{var c=DC(r,e,t),a=c.stride,i=c.pad,o=c.dataFormat,u=c.dilations,l=c.biasArg,f=c.preluArg,h=c.activationFunc,p=c.leakyreluAlpha;return[n.fused.conv2d({x:I("x",r,e,t),filter:I("filter",r,e,t),strides:[a[1],a[2]],pad:i,dataFormat:o,dilations:[u[1],u[2]],bias:l,activation:h,preluActivationWeights:f,leakyreluAlpha:p})]}case"FusedDepthwiseConv2dNative":{var d=DC(r,e,t),a=d.stride,i=d.pad,o=d.dataFormat,u=d.dilations,l=d.biasArg,f=d.preluArg,h=d.activationFunc,p=d.leakyreluAlpha;return[n.fused.depthwiseConv2d({x:I("x",r,e,t),filter:I("filter",r,e,t),strides:[a[1],a[2]],pad:i,dataFormat:o,dilations:[u[1],u[2]],bias:l,activation:h,preluActivationWeights:f,leakyreluAlpha:p})]}case"Conv2DBackpropInput":case"Conv2dTranspose":{var m=I("outputShape",r,e,t),a=I("strides",r,e,t),i=up(r,e,t);return[n.conv2dTranspose(I("x",r,e,t),I("filter",r,e,t),m,[a[1],a[2]],i)]}case"DepthwiseConv2dNative":case"DepthwiseConv2d":{var a=I("strides",r,e,t),i=up(r,e,t),u=I("dilations",r,e,t),o=I("dataFormat",r,e,t).toUpperCase();return[n.depthwiseConv2d(I("input",r,e,t),I("filter",r,e,t),[a[1],a[2]],i,o,[u[1],u[2]])]}case"Conv3D":{var a=I("strides",r,e,t),i=I("pad",r,e,t),o=I("dataFormat",r,e,t).toUpperCase(),u=I("dilations",r,e,t);return[n.conv3d(I("x",r,e,t),I("filter",r,e,t),[a[1],a[2],a[3]],i,o,[u[1],u[2],u[3]])]}case"AvgPool":{var a=I("strides",r,e,t),i=I("pad",r,e,t),v=I("kernelSize",r,e,t);return[n.avgPool(I("x",r,e,t),[v[1],v[2]],[a[1],a[2]],i)]}case"MaxPool":{var a=I("strides",r,e,t),i=I("pad",r,e,t),v=I("kernelSize",r,e,t);return[n.maxPool(I("x",r,e,t),[v[1],v[2]],[a[1],a[2]],i)]}case"MaxPoolWithArgmax":{var a=I("strides",r,e,t),i=I("pad",r,e,t),v=I("kernelSize",r,e,t),g=I("includeBatchInIndex",r,e,t),y=n.maxPoolWithArgmax(I("x",r,e,t),[v[1],v[2]],[a[1],a[2]],i,g),w=y.result,b=y.indexes;return[w,b]}case"AvgPool3D":{var a=I("strides",r,e,t),i=I("pad",r,e,t),v=I("kernelSize",r,e,t);return[n.avgPool3d(I("x",r,e,t),[v[1],v[2],v[3]],[a[1],a[2],a[3]],i)]}case"MaxPool3D":{var a=I("strides",r,e,t),i=I("pad",r,e,t),v=I("kernelSize",r,e,t);return[n.maxPool3d(I("x",r,e,t),[v[1],v[2],v[3]],[a[1],a[2],a[3]],i)]}case"Dilation2D":{var x=I("strides",r,e,t),i=I("pad",r,e,t),u=I("dilations",r,e,t),S=x[1],T=x[2],N=u[1],C=u[2];return[n.dilation2d(I("x",r,e,t),I("filter",r,e,t),[S,T],i,[N,C],"NHWC")]}default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};var Spe=function(r,e,t,n){switch(n===void 0&&(n=jr),r.op){case"Fill":{var a=I("shape",r,e,t),i=I("dtype",r,e,t),o=I("value",r,e,t);return[n.fill(a,o,i)]}case"LinSpace":{var s=I("start",r,e,t),u=I("stop",r,e,t),c=I("num",r,e,t);return[n.linspace(s,u,c)]}case"Multinomial":{var l=I("logits",r,e,t),f=I("numSamples",r,e,t),h=I("seed",r,e,t);return[n.multinomial(l,f,h)]}case"OneHot":{var p=I("indices",r,e,t),d=I("depth",r,e,t),m=I("onValue",r,e,t),v=I("offValue",r,e,t),i=I("dtype",r,e,t);return[n.oneHot(p,d,m,v,i)]}case"Ones":return[n.ones(I("shape",r,e,t),I("dtype",r,e,t))];case"OnesLike":return[n.onesLike(I("x",r,e,t))];case"RandomStandardNormal":return[n.randomStandardNormal(I("shape",r,e,t),I("dtype",r,e,t),I("seed",r,e,t))];case"RandomUniform":return[n.randomUniform(I("shape",r,e,t),I("minval",r,e,t),I("maxval",r,e,t),I("dtype",r,e,t))];case"RandomUniformInt":return[n.randomUniformInt(I("shape",r,e,t),I("minval",r,e,t),I("maxval",r,e,t),I("seed",r,e,t))];case"Range":{var s=I("start",r,e,t),u=I("stop",r,e,t),g=I("step",r,e,t);return[n.range(s,u,g,I("dtype",r,e,t))]}case"TruncatedNormal":{var a=I("shape",r,e,t),y=I("mean",r,e,t),w=I("stdDev",r,e,t),h=I("seed",r,e,t);return[n.truncatedNormal(a,y,w,I("dtype",r,e,t),h)]}case"Zeros":return[n.zeros(I("shape",r,e,t),I("dtype",r,e,t))];case"ZerosLike":return[n.zerosLike(I("x",r,e,t))];default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};function Ay(r,e,t){var n=I("boxes",r,e,t),a=I("scores",r,e,t),i=I("maxOutputSize",r,e,t),o=I("iouThreshold",r,e,t),s=I("scoreThreshold",r,e,t),u=I("softNmsSigma",r,e,t);return{boxes:n,scores:a,maxOutputSize:i,iouThreshold:o,scoreThreshold:s,softNmsSigma:u}}var Epe=function(r,e,t,n,a){return a===void 0&&(a=jr),yt(void 0,void 0,void 0,function(){var i,o,f,h,p,d,m,s,g,u,f,h,p,d,m,c,g,l,f,h,p,d,m,v,g;return gt(this,function(y){switch(y.label){case 0:switch(i=r.op,i){case"NonMaxSuppressionV5":return[3,1];case"NonMaxSuppressionV4":return[3,3];case"NonMaxSuppressionV3":return[3,5];case"NonMaxSuppressionV2":return[3,5];case"Where":return[3,7];case"ListDiff":return[3,9]}return[3,10];case 1:return o=Ay(r,e,t),f=o.boxes,h=o.scores,p=o.maxOutputSize,d=o.iouThreshold,m=o.scoreThreshold,s=o.softNmsSigma,[4,a.image.nonMaxSuppressionWithScoreAsync(f,h,p,d,m,s)];case 2:return g=y.sent(),[2,[g.selectedIndices,g.selectedScores]];case 3:return u=Ay(r,e,t),f=u.boxes,h=u.scores,p=u.maxOutputSize,d=u.iouThreshold,m=u.scoreThreshold,c=I("padToMaxOutputSize",r,e,t),[4,a.image.nonMaxSuppressionPaddedAsync(f,h,p,d,m,c)];case 4:return g=y.sent(),[2,[g.selectedIndices,g.validOutputs]];case 5:return l=Ay(r,e,t),f=l.boxes,h=l.scores,p=l.maxOutputSize,d=l.iouThreshold,m=l.scoreThreshold,[4,a.image.nonMaxSuppressionAsync(f,h,p,d,m)];case 6:return[2,[y.sent()]];case 7:return v=a.cast(I("condition",r,e,t),"bool"),[4,a.whereAsync(v)];case 8:return g=[y.sent()],v.dispose(),[2,g];case 9:return[2,a.setdiff1dAsync(I("x",r,e,t),I("y",r,e,t))];case 10:throw TypeError("Node type ".concat(r.op," is not implemented"))}})})};var Tpe=function(r,e,t,n){switch(n===void 0&&(n=jr),r.op){case"LowerBound":{var a=I("sortedSequence",r,e,t),i=I("values",r,e,t);return[n.lowerBound(a,i)]}case"TopKV2":{var o=I("x",r,e,t),s=I("k",r,e,t),u=I("sorted",r,e,t),c=n.topk(o,s,u);return[c.values,c.indices]}case"UpperBound":{var a=I("sortedSequence",r,e,t),i=I("values",r,e,t);return[n.upperBound(a,i)]}case"Unique":{var o=I("x",r,e,t),c=n.unique(o);return[c.values,c.indices]}case"UniqueV2":{var o=I("x",r,e,t),l=I("axis",r,e,t),c=n.unique(o,l);return[c.values,c.indices]}default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};var Npe=function(r,e,t,n){switch(n===void 0&&(n=jr),r.op){case"Const":return e[r.name];case"PlaceholderWithDefault":var a=I("default",r,e,t);return[Kr(r.name,e,t)||a];case"Placeholder":return[Kr(r.name,e,t)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":{var i=I("x",r,e,t);return[Mi(i)]}case"IdentityN":return I("x",r,e,t).map(function(h){return Mi(h)});case"Snapshot":var o=I("x",r,e,t);return[Mi(o)];case"Shape":return[n.tensor1d(I("x",r,e,t).shape,"int32")];case"ShapeN":return I("x",r,e,t).map(function(h){return n.tensor1d(h.shape)});case"Size":return[n.scalar(I("x",r,e,t).size,"int32")];case"Rank":return[n.scalar(I("x",r,e,t).rank,"int32")];case"NoOp":return[n.scalar(1)];case"Print":var s=I("x",r,e,t),u=I("data",r,e,t),c=I("message",r,e,t),l=I("summarize",r,e,t);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(c);for(var f=0;f<u.length;f++)console.log(Array.prototype.slice.call(u[f].dataSync()).slice(0,l));return[s];default:throw TypeError("Node type ".concat(r.op," is not implemented"))}},Ipe=(function(){function r(e,t){this.keyDType=e,this.valueDType=t,this.handle=Me.scalar(0),this.tensorMap=new Map,Me.keep(this.handle)}return Object.defineProperty(r.prototype,"id",{get:function(){return this.handle.id},enumerable:!1,configurable:!0}),r.prototype.clearAndClose=function(){this.tensorMap.forEach(function(e){return e.dispose()}),this.tensorMap.clear(),this.handle.dispose()},r.prototype.size=function(){return this.tensorMap.size},r.prototype.tensorSize=function(){return yr(this.size(),"int32")},r.prototype.import=function(e,t){return yt(this,void 0,void 0,function(){var n,a=this;return gt(this,function(i){switch(i.label){case 0:return this.checkKeyAndValueTensor(e,t),[4,e.data()];case 1:return n=i.sent(),this.tensorMap.forEach(function(o){return o.dispose()}),this.tensorMap.clear(),[2,Me.tidy(function(){var o=Me.unstack(t),s=n.length,u=o.length;Me.util.assert(s===u,function(){return"The number of elements doesn't match, keys has "+"".concat(s," elements, the values has ").concat(u," ")+"elements."});for(var c=0;c<s;c++){var l=n[c],f=o[c];Me.keep(f),a.tensorMap.set(l,f)}return a.handle})]}})})},r.prototype.find=function(e,t){return yt(this,void 0,void 0,function(){var n,a=this;return gt(this,function(i){switch(i.label){case 0:return this.checkKeyAndValueTensor(e,t),[4,e.data()];case 1:return n=i.sent(),[2,Me.tidy(function(){for(var o=[],s=0;s<n.length;s++){var u=n[s],c=a.findWithDefault(u,t);o.push(c)}return Me.stack(o)})]}})})},r.prototype.findWithDefault=function(e,t){var n=this.tensorMap.get(e);return n??t},r.prototype.checkKeyAndValueTensor=function(e,t){if(e.dtype!==this.keyDType)throw new Error("Expect key dtype ".concat(this.keyDType,", but got ")+"".concat(e.dtype));if(t.dtype!==this.valueDType)throw new Error("Expect value dtype ".concat(this.valueDType,", but got ")+"".concat(t.dtype))},r})(),Cpe=function(r,e,t,n){return yt(void 0,void 0,void 0,function(){var a,i,o,s,h,f,c,u,h,f,c,l,h,f,h;return gt(this,function(p){switch(p.label){case 0:switch(a=r.op,a){case"HashTable":return[3,1];case"HashTableV2":return[3,1];case"InitializeTable":return[3,2];case"InitializeTableV2":return[3,2];case"LookupTableImport":return[3,2];case"LookupTableImportV2":return[3,2];case"LookupTableFind":return[3,4];case"LookupTableFindV2":return[3,4];case"LookupTableSize":return[3,6];case"LookupTableSizeV2":return[3,6]}return[3,7];case 1:return i=n.getHashTableHandleByName(r.name),i!=null?[2,[i]]:(o=I("keyDType",r,e,t),s=I("valueDType",r,e,t),h=new Ipe(o,s),n.addHashTable(r.name,h),[2,[h.handle]]);case 2:return f=I("tableHandle",r,e,t,n),c=I("keys",r,e,t),u=I("values",r,e,t),h=n.getHashTableById(f.id),[4,h.import(c,u)];case 3:return[2,[p.sent()]];case 4:return f=I("tableHandle",r,e,t,n),c=I("keys",r,e,t),l=I("defaultValue",r,e,t),h=n.getHashTableById(f.id),[4,h.find(c,l)];case 5:return[2,[p.sent()]];case 6:return f=I("tableHandle",r,e,t,n),h=n.getHashTableById(f.id),[2,[h.tensorSize()]];case 7:throw TypeError("Node type ".concat(r.op," is not implemented"))}})})};var Ape=function(r,e,t,n){switch(n===void 0&&(n=jr),r.op){case"ResizeBilinear":{var a=I("images",r,e,t),i=I("size",r,e,t),o=I("alignCorners",r,e,t),s=I("halfPixelCenters",r,e,t);return[n.image.resizeBilinear(a,[i[0],i[1]],o,s)]}case"ResizeNearestNeighbor":{var a=I("images",r,e,t),i=I("size",r,e,t),o=I("alignCorners",r,e,t),s=I("halfPixelCenters",r,e,t);return[n.image.resizeNearestNeighbor(a,[i[0],i[1]],o,s)]}case"CropAndResize":{var u=I("image",r,e,t),c=I("boxes",r,e,t),l=I("boxInd",r,e,t),f=I("cropSize",r,e,t),h=I("method",r,e,t),p=I("extrapolationValue",r,e,t);return[n.image.cropAndResize(u,c,l,f,h,p)]}case"ImageProjectiveTransformV3":{var a=I("images",r,e,t),d=I("transforms",r,e,t),m=I("outputShape",r,e,t),v=I("fillValue",r,e,t),g=I("interpolation",r,e,t),y=I("fillMode",r,e,t);return[n.image.transform(a,d,g.toLowerCase(),y.toLowerCase(),v,m)]}default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};var Dpe=function(r,e,t,n){switch(n===void 0&&(n=jr),r.op){case"Equal":return[n.equal(I("a",r,e,t),I("b",r,e,t))];case"NotEqual":return[n.notEqual(I("a",r,e,t),I("b",r,e,t))];case"Greater":return[n.greater(I("a",r,e,t),I("b",r,e,t))];case"GreaterEqual":return[n.greaterEqual(I("a",r,e,t),I("b",r,e,t))];case"Less":return[n.less(I("a",r,e,t),I("b",r,e,t))];case"LessEqual":return[n.lessEqual(I("a",r,e,t),I("b",r,e,t))];case"LogicalAnd":return[n.logicalAnd(I("a",r,e,t),I("b",r,e,t))];case"LogicalNot":return[n.logicalNot(I("a",r,e,t))];case"LogicalOr":return[n.logicalOr(I("a",r,e,t),I("b",r,e,t))];case"Select":case"SelectV2":return[n.where(I("condition",r,e,t),I("a",r,e,t),I("b",r,e,t))];case"BitwiseAnd":return[n.bitwiseAnd(I("a",r,e,t),I("b",r,e,t))];default:throw TypeError("Node type ".concat(r.op," is not implemented"))}},_pe=function(r,e,t,n){switch(n===void 0&&(n=jr),r.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[n.matMul(I("a",r,e,t),I("b",r,e,t),I("transposeA",r,e,t),I("transposeB",r,e,t))];case"Einsum":return[n.einsum.apply(n,Et([I("equation",r,e,t)],be(I("tensors",r,e,t)),!1))];case"Transpose":return[n.transpose(I("x",r,e,t),I("perm",r,e,t))];case"_FusedMatMul":var a=be(I("fusedOps",r,e,t),2),i=a[0],o=a[1],s=i==="biasadd",u=o==="prelu",c=I("numArgs",r,e,t),l=I("leakyreluAlpha",r,e,t);if(s){if(u&&c!==2)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!u&&c!==1)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}var f=be(I("args",r,e,t),2),h=f[0],p=f[1];return[n.fused.matMul({a:I("a",r,e,t),b:I("b",r,e,t),transposeA:I("transposeA",r,e,t),transposeB:I("transposeB",r,e,t),bias:h,activation:o,preluActivationWeights:p,leakyreluAlpha:l})];case"MatrixBandPart":return[n.linalg.bandPart(I("a",r,e,t),I("numLower",r,e,t),I("numUpper",r,e,t))];default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};var Fpe=function(r,e,t,n){switch(n===void 0&&(n=jr),r.op){case"EuclideanNorm":return[n.euclideanNorm(I("x",r,e,t),I("axis",r,e,t),I("keepDims",r,e,t))];case"FusedBatchNorm":case"FusedBatchNormV2":return[n.batchNorm(I("x",r,e,t),I("mean",r,e,t),I("variance",r,e,t),I("offset",r,e,t),I("scale",r,e,t),I("epsilon",r,e,t))];case"FusedBatchNormV3":return[n.batchNorm(I("x",r,e,t),I("mean",r,e,t),I("variance",r,e,t),I("offset",r,e,t),I("scale",r,e,t),I("epsilon",r,e,t))];case"LRN":return[n.localResponseNormalization(I("x",r,e,t),I("radius",r,e,t),I("bias",r,e,t),I("alpha",r,e,t),I("beta",r,e,t))];case"Softmax":return[n.softmax(I("x",r,e,t))];case"LogSoftmax":return[n.logSoftmax(I("x",r,e,t))];default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};var Rpe=function(r,e,t,n){switch(n===void 0&&(n=jr),r.op){case"RaggedGather":{var a=n.raggedGather(I("paramsNestedSplits",r,e,t),I("paramsDenseValues",r,e,t),I("indices",r,e,t),I("outputRaggedRank",r,e,t)),i=a.outputNestedSplits,o=a.outputDenseValues;return i.concat(o)}case"RaggedRange":{var s=n.raggedRange(I("starts",r,e,t),I("limits",r,e,t),I("splits",r,e,t)),u=s.rtNestedSplits,c=s.rtDenseValues;return[u,c]}case"RaggedTensorToTensor":return[n.raggedTensorToTensor(I("shape",r,e,t),I("values",r,e,t),I("defaultValue",r,e,t),I("rowPartitionTensors",r,e,t),I("rowPartitionTypes",r,e,t))];default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};var Ope=function(r,e,t,n){switch(n===void 0&&(n=jr),r.op){case"Max":{var a=I("axis",r,e,t),i=I("keepDims",r,e,t);return[n.max(I("x",r,e,t),a,i)]}case"Mean":{var a=I("axis",r,e,t),i=I("keepDims",r,e,t);return[n.mean(I("x",r,e,t),a,i)]}case"Min":{var a=I("axis",r,e,t),i=I("keepDims",r,e,t);return[n.min(I("x",r,e,t),a,i)]}case"Sum":{var a=I("axis",r,e,t),i=I("keepDims",r,e,t);return[n.sum(I("x",r,e,t),a,i)]}case"All":{var a=I("axis",r,e,t),i=I("keepDims",r,e,t);return[n.all(I("x",r,e,t),a,i)]}case"Any":{var a=I("axis",r,e,t),i=I("keepDims",r,e,t);return[n.any(I("x",r,e,t),a,i)]}case"ArgMax":{var a=I("axis",r,e,t);return[n.argMax(I("x",r,e,t),a)]}case"ArgMin":{var a=I("axis",r,e,t);return[n.argMin(I("x",r,e,t),a)]}case"Prod":{var a=I("axis",r,e,t),i=I("keepDims",r,e,t);return[n.prod(I("x",r,e,t),a,i)]}case"Cumprod":{var a=I("axis",r,e,t),o=I("exclusive",r,e,t),s=I("reverse",r,e,t);return[n.cumprod(I("x",r,e,t),a,o,s)]}case"Cumsum":{var a=I("axis",r,e,t),o=I("exclusive",r,e,t),s=I("reverse",r,e,t);return[n.cumsum(I("x",r,e,t),a,o,s)]}case"Bincount":var u=I("x",r,e,t),c=I("weights",r,e,t),l=I("size",r,e,t);return[n.bincount(u,c,l)];case"DenseBincount":{var f=I("x",r,e,t),h=I("weights",r,e,t),p=I("size",r,e,t),d=I("binaryOutput",r,e,t);return[n.denseBincount(f,h,p,d)]}default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};var Ppe=function(r,e,t,n){switch(n===void 0&&(n=jr),r.op){case"ConcatV2":case"Concat":{var a=I("n",r,e,t),i=I("axis",r,e,t),o=I("tensors",r,e,t);return o=o.slice(0,a),[n.concat(o,i)]}case"Gather":{var s=I("x",r,e,t),u=I("indices",r,e,t);return[n.gather(s,n.cast(u,"int32"),0)]}case"GatherV2":{var i=I("axis",r,e,t),c=I("batchDims",r,e,t),s=I("x",r,e,t),u=I("indices",r,e,t);return[n.gather(s,n.cast(u,"int32"),i,c)]}case"Reverse":{for(var l=I("dims",r,e,t),i=[],f=0;f<l.length;f++)l[f]&&i.push(f);var s=I("x",r,e,t);return[n.reverse(s,i)]}case"ReverseV2":{var i=I("axis",r,e,t),s=I("x",r,e,t);return[n.reverse(s,i)]}case"Slice":{var h=I("begin",r,e,t),p=I("size",r,e,t);return[n.slice(I("x",r,e,t),h,p)]}case"StridedSlice":{var h=I("begin",r,e,t),d=I("end",r,e,t),m=I("strides",r,e,t),v=I("beginMask",r,e,t),g=I("endMask",r,e,t),y=I("ellipsisMask",r,e,t),w=I("newAxisMask",r,e,t),b=I("shrinkAxisMask",r,e,t),x=I("x",r,e,t);return[n.stridedSlice(x,h,d,m,v,g,y,w,b)]}case"Pack":return Me.tidy(function(){var $=I("axis",r,e,t),z=I("tensors",r,e,t),L=z[0].shape,B=n.squeeze(z[0]).shape,G=z.map(function(X){var Z=Me.util.arraysEqual(X.shape,L);if(!Z&&!Me.util.arraysEqual(n.squeeze(X).shape,B))throw new Error("the input tensors shape does not match");return Z?X:n.reshape(X,L)});return[n.stack(G,$)]});case"Unpack":{var i=I("axis",r,e,t),x=I("tensor",r,e,t);return n.unstack(x,i)}case"Tile":{var S=I("reps",r,e,t);return[n.tile(I("x",r,e,t),S)]}case"Split":case"SplitV":{var i=I("axis",r,e,t),T=I("numOrSizeSplits",r,e,t),x=I("x",r,e,t);return n.split(x,T,i)}case"ScatterNd":{var u=I("indices",r,e,t),N=I("values",r,e,t),C=I("shape",r,e,t);return[n.scatterND(u,N,C)]}case"GatherNd":{var R=I("x",r,e,t),u=I("indices",r,e,t);return[n.gatherND(R,u)]}case"SparseToDense":{var u=I("sparseIndices",r,e,t),C=I("outputShape",r,e,t),_=I("sparseValues",r,e,t),P=I("defaultValue",r,e,t);return[n.sparseToDense(u,_,C,_.dtype===P.dtype?P:n.cast(P,_.dtype))]}case"TensorScatterUpdate":{var u=I("indices",r,e,t),N=I("values",r,e,t),x=I("tensor",r,e,t);return[n.tensorScatterUpdate(x,u,N)]}default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};var Mpe=function(r,e,t,n){switch(n===void 0&&(n=jr),r.op){case"SparseFillEmptyRows":{var a=n.sparse.sparseFillEmptyRows(I("indices",r,e,t),I("values",r,e,t),I("denseShape",r,e,t),I("defaultValue",r,e,t)),i=a.outputIndices,o=a.outputValues,s=a.emptyRowIndicator,u=a.reverseIndexMap;return[i,o,s,u]}case"SparseReshape":{var c=n.sparse.sparseReshape(I("inputIndices",r,e,t),I("inputShape",r,e,t),I("newShape",r,e,t)),i=c.outputIndices,l=c.outputShape;return[i,l]}case"SparseSegmentMean":{var f=n.sparse.sparseSegmentMean(I("data",r,e,t),I("indices",r,e,t),I("segmentIds",r,e,t));return[f]}case"SparseSegmentSum":{var f=n.sparse.sparseSegmentSum(I("data",r,e,t),I("indices",r,e,t),I("segmentIds",r,e,t));return[f]}default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};var Bpe=function(r,e,t,n){switch(n===void 0&&(n=jr),r.op){case"FFT":return[n.fft(I("x",r,e,t))];case"IFFT":return[n.ifft(I("x",r,e,t))];case"RFFT":return[n.rfft(I("x",r,e,t))];case"IRFFT":return[n.irfft(I("x",r,e,t))];default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};var Lpe=function(r,e,t,n){switch(n===void 0&&(n=jr),r.op){case"StaticRegexReplace":return[n.string.staticRegexReplace(I("input",r,e,t),I("pattern",r,e,t),I("rewrite",r,e,t),I("replaceGlobal",r,e,t))];case"StringNGrams":{var a=n.string.stringNGrams(I("data",r,e,t),I("dataSplits",r,e,t),I("separator",r,e,t),I("nGramWidths",r,e,t),I("leftPad",r,e,t),I("rightPad",r,e,t),I("padWidth",r,e,t),I("preserveShortSequences",r,e,t)),i=a.nGrams,o=a.nGramsSplits;return[i,o]}case"StringSplit":{var s=n.string.stringSplit(I("input",r,e,t),I("delimiter",r,e,t),I("skipEmpty",r,e,t)),u=s.indices,c=s.values,l=s.shape;return[u,c,l]}case"StringToHashBucketFast":{var f=n.string.stringToHashBucketFast(I("input",r,e,t),I("numBuckets",r,e,t));return[f]}default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};var zpe=function(r,e,t,n){switch(n===void 0&&(n=jr),r.op){case"Cast":return[n.cast(I("x",r,e,t),I("dtype",r,e,t))];case"ExpandDims":{var a=I("axis",r,e,t);return[n.expandDims(I("x",r,e,t),a)]}case"Squeeze":{var a=I("axis",r,e,t);return[n.squeeze(I("x",r,e,t),a)]}case"Reshape":return[n.reshape(I("x",r,e,t),I("shape",r,e,t))];case"EnsureShape":return[n.ensureShape(I("x",r,e,t),I("shape",r,e,t))];case"MirrorPad":return[n.mirrorPad(I("x",r,e,t),I("padding",r,e,t),I("mode",r,e,t))];case"PadV2":case"Pad":return[n.pad(I("x",r,e,t),I("padding",r,e,t),I("constantValue",r,e,t))];case"SpaceToBatchND":{var i=I("blockShape",r,e,t),o=I("paddings",r,e,t);return[n.spaceToBatchND(I("x",r,e,t),i,o)]}case"BatchToSpaceND":{var i=I("blockShape",r,e,t),s=I("crops",r,e,t);return[n.batchToSpaceND(I("x",r,e,t),i,s)]}case"DepthToSpace":{var u=I("blockSize",r,e,t),c=I("dataFormat",r,e,t).toUpperCase();return[n.depthToSpace(I("x",r,e,t),u,c)]}case"BroadcastTo":return[n.broadcastTo(I("x",r,e,t),I("shape",r,e,t))];case"BroadcastArgs":return[n.broadcastArgs(I("s0",r,e,t),I("s1",r,e,t))];default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};function _C(r,e,t,n,a){a===void 0&&(a=nC.tidy);var i=(function(o,s,u){switch(o.category){case"arithmetic":return a(function(){return dpe(o,s,u)});case"basic_math":return a(function(){return vpe(o,s,u)});case"control":return xpe(o,s,u);case"convolution":return a(function(){return kpe(o,s,u)});case"creation":return a(function(){return Spe(o,s,u)});case"dynamic":return Epe(o,s,u);case"evaluation":return a(function(){return Tpe(o,s,u)});case"image":return a(function(){return Ape(o,s,u)});case"graph":return a(function(){return Npe(o,s,u)});case"logical":return a(function(){return Dpe(o,s,u)});case"matrices":return a(function(){return _pe(o,s,u)});case"normalization":return a(function(){return Fpe(o,s,u)});case"ragged":return a(function(){return Rpe(o,s,u)});case"reduction":return a(function(){return Ope(o,s,u)});case"slice_join":return a(function(){return Ppe(o,s,u)});case"sparse":return a(function(){return Mpe(o,s,u)});case"spectral":return a(function(){return Bpe(o,s,u)});case"string":return a(function(){return Lpe(o,s,u)});case"transformation":return a(function(){return zpe(o,s,u)});case"hash_table":return Cpe(o,s,u,n);case"custom":var c=BC(o.op);if(c&&c.customExecutor)return c.customExecutor(new kte(o,s,u));throw TypeError("Custom op ".concat(o.op," is not registered."));default:throw TypeError("Unknown op '".concat(o.op,"'. File an issue at ")+"https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()")}})(r,e,t);return nC.util.isPromise(i)?i.then(function(o){return[].concat(o)}):[].concat(i)}var FC=(function(){function r(e,t,n,a,i){e===void 0&&(e={}),t===void 0&&(t={}),n===void 0&&(n={}),a===void 0&&(a={}),this.weightMap=e,this.tensorArrayMap=t,this.tensorListMap=n,this.functionMap=a,this.parseNodeNameCache=i,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}return r.prototype.newFrame=function(e,t){return{id:e,frameName:t,iterationId:0}},Object.defineProperty(r.prototype,"currentContext",{get:function(){return this.contexts},set:function(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"currentContextId",{get:function(){return this._currentContextIds[0]},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"currentContextIds",{get:function(){return this._currentContextIds},enumerable:!1,configurable:!0}),r.prototype.generateCurrentContextIds=function(){for(var e=[],t=0;t<this.contexts.length-1;t++){var n=this.contexts.slice(0,this.contexts.length-t);e.push(this.contextIdforContexts(n))}e.push(""),this._currentContextIds=e},r.prototype.contextIdforContexts=function(e){return e?e.map(function(t){return t.id===0&&t.iterationId===0?"":"".concat(t.frameName,"-").concat(t.iterationId)}).join("/"):""},r.prototype.enterFrame=function(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))},r.prototype.exitFrame=function(){if(this.contexts&&this.contexts.length>1)this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift();else throw new Error("Cannot exit frame, the context is empty")},r.prototype.nextIteration=function(){if(this.contexts&&this.contexts.length>0){this.contexts=this.contexts.slice(),this.lastId++;var e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}else throw new Error("Cannot increase frame iteration, the context is empty")},r.prototype.getWeight=function(e){return this.weightMap[e]},r.prototype.addTensorArray=function(e){this.tensorArrayMap[e.id]=e},r.prototype.getTensorArray=function(e){return this.tensorArrayMap[e]},r.prototype.addTensorList=function(e){this.tensorListMap[e.id]=e},r.prototype.getTensorList=function(e){return this.tensorListMap[e]},r.prototype.dispose=function(e){for(var t in this.tensorArrayMap)this.tensorArrayMap[t].clearAndClose(e);for(var t in this.tensorListMap)this.tensorListMap[t].clearAndClose(e)},r})();function RC(r,e,t,n){var a=new Set,i=[],o=null,s=null,u=new Set,c=new Set(Object.keys(r).map(function(p){return zn(p)[0]}));n=n||[];for(var l=new Set(n.map(function(p){return zn(p.name)[0]})),f=Et([],be(e),!1);f.length>0;){var h=f.pop();if((ps(h)||Kpe(h)||jpe(h))&&o==null&&(o=h,s=o.children.map(function(p){return p.name}).filter(function(p){return a.has(p)})),a.add(h.name),t[h.name]==null&&!c.has(h.name)&&!l.has(h.name)){if(h.inputs.length===0){i.push(h.name);continue}h.inputs.forEach(function(p){u.has(p.name)||(u.add(p.name),f.push(p))})}}return{inputs:r,outputs:e,usedNodes:a,missingInputs:i,dynamicNode:o,syncInputs:s}}function $pe(r,e){var t,n,a,i,o,s,u=e.usedNodes,c=e.inputs,l=Object.keys(c).map(function(L){return zn(L)[0]}).map(function(L){return r.nodes[L]}),f=r.initNodes||[],h=function(L){return u.has(typeof L=="string"?L:L.name)};function p(L){return Et([],be(new Map(L.map(function(B){return[B.name,B]})).values()),!1)}var d=p(Et(Et(Et([],be(l),!1),be(r.weights),!1),be(f),!1)).filter(h),m=p(Et(Et([],be(d),!1),be(Object.values(r.nodes)),!1)).filter(h),v=new Map(m.map(function(L){return[L.name,L]})),g={};try{for(var y=_r(m),w=y.next();!w.done;w=y.next()){var b=w.value;g[b.name]=g[b.name]||0;try{for(var x=(a=void 0,_r(b.children)),S=x.next();!S.done;S=x.next()){var T=S.value;h(T)||(g[T.name]=Number.POSITIVE_INFINITY),g[T.name]=(g[T.name]||0)+1}}catch(L){a={error:L}}finally{try{S&&!S.done&&(i=x.return)&&i.call(x)}finally{if(a)throw a.error}}}}catch(L){t={error:L}}finally{try{w&&!w.done&&(n=y.return)&&n.call(y)}finally{if(t)throw t.error}}for(var N=Object.entries(g).filter(function(L){var B=be(L,2),G=B[1];return G===0}).map(function(L){var B=be(L,1),G=B[0];return G}),C=Et([],be(N),!1);N.length>0;){var R=N.pop(),b=v.get(R);try{for(var _=(o=void 0,_r(b.children.filter(h))),P=_.next();!P.done;P=_.next()){var T=P.value;--g[T.name]===0&&(C.push(T.name),N.push(T.name))}}catch(B){o={error:B}}finally{try{P&&!P.done&&(s=_.return)&&s.call(_)}finally{if(o)throw o.error}}}var $=C.map(function(L){return v.get(L)}),z=Wpe($,d);return Gpe(z,d),z}function Wpe(r,e){for(var t,n,a=new Map(r.map(function(p){return[p.name,p]})),i=e.map(function(p){return p.name}),o=new Set(i);i.length>0;){var s=i.pop(),u=a.get(s);try{for(var c=(t=void 0,_r(u.children)),l=c.next();!l.done;l=c.next()){var f=l.value;!a.has(f.name)||o.has(f.name)||(o.add(f.name),i.push(f.name))}}catch(p){t={error:p}}finally{try{l&&!l.done&&(n=c.return)&&n.call(c)}finally{if(t)throw t.error}}}var h=r.filter(function(p){return o.has(p.name)});return h}var sp=(function(r){MC(e,r);function e(t){return r.call(this,"NodesExecutionOrderError: ".concat(t))||this}return e})(Error);function Gpe(r,e){var t,n,a,i,o,s,u=new Map(r.map(function(S,T){return[S.name,T]})),c=new Set(e.map(function(S){return S.name})),l=function(S){return c.has(typeof S=="string"?S:S.name)},f=new Set(r.map(function(S){return S.name})),h=function(S){return f.has(typeof S=="string"?S:S.name)};try{for(var p=_r(r),d=p.next();!d.done;d=p.next()){var m=d.value;try{for(var v=(a=void 0,_r(m.children.filter(h))),g=v.next();!g.done;g=v.next()){var y=g.value;if(!u.has(y.name))throw new sp("Child ".concat(y.name," of node ").concat(m.name," is unreachable."));if(u.get(m.name)>u.get(y.name))throw new sp("Node ".concat(m.name," is scheduled to run after its child ").concat(y.name,"."))}}catch(S){a={error:S}}finally{try{g&&!g.done&&(i=v.return)&&i.call(v)}finally{if(a)throw a.error}}if(!l(m))try{for(var w=(o=void 0,_r(m.inputs)),b=w.next();!b.done;b=w.next()){var x=b.value;if(!u.has(x.name))throw new sp("Input ".concat(x.name," of node ").concat(m.name," is unreachable."));if(u.get(x.name)>u.get(m.name))throw new sp("Node ".concat(m.name," is scheduled to run before its input ").concat(x.name,"."))}}catch(S){o={error:S}}finally{try{b&&!b.done&&(s=w.return)&&s.call(w)}finally{if(o)throw o.error}}}}catch(S){t={error:S}}finally{try{d&&!d.done&&(n=p.return)&&n.call(p)}finally{if(t)throw t.error}}}function Vpe(r){for(var e=new Map(r.map(function(f,h){return[f.name,h]})),t=Number.MAX_SAFE_INTEGER,n=r.map(function(f,h){return ps(f)?t:h}),a=function(f){var h=n[e.get(f.name)];return h??-1},i=r.map(function(f,h){return f.children.map(a).reduce(function(p,d){return Math.max(p,d)},n[h])}),o=new Map,s=0;s<r.length;++s){var u=i[s];if(u!==t){var c=r[s],l=r[u];o.has(l.name)||o.set(l.name,[]),o.get(l.name).push(c)}}return o}var Upe=new Set(["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"]),Hpe=new Set(["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"]),qpe=new Set(["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"]);function ps(r){return Upe.has(r.op)}function Kpe(r){return Hpe.has(r.op)}function jpe(r){return qpe.has(r.op)}var OC=(function(){function r(e,t){var n=this;this.graph=e,this.parent=t,this.compiledMap=new Map,this.parseNodeNameCache=new Map,this._weightMap={},this.SEPARATOR=",",this._functions={},this._functionExecutorMap={},this.keepIntermediateTensors=!1,this._outputs=e.outputs,this._inputs=e.inputs,this._initNodes=e.initNodes,this._signature=e.signature,this._functions=e.functions,e.functions!=null&&Object.keys(e.functions).forEach(function(a){n._functionExecutorMap[a]=new r(e.functions[a],n)})}return Object.defineProperty(r.prototype,"weightIds",{get:function(){return this.parent?this.parent.weightIds:this._weightIds},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"functionExecutorMap",{get:function(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"weightMap",{get:function(){return this.parent?this.parent.weightMap:this._weightMap},set:function(e){var t=Object.keys(e).map(function(n){return e[n].map(function(a){return a.id})});this._weightIds=[].concat.apply([],Et([],be(t),!1)),this._weightMap=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"resourceManager",{set:function(e){this._resourceManager=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"inputs",{get:function(){return this._inputs.map(function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}})},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"outputs",{get:function(){return this._outputs.map(function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}})},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"inputNodes",{get:function(){return this._inputs.map(function(e){return e.signatureKey||e.name})},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"outputNodes",{get:function(){return this._outputs.map(function(e){var t=e.signatureKey||e.name;return e.defaultOutput?"".concat(t,":").concat(e.defaultOutput):t})},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"functions",{get:function(){var e=this;return Object.keys(this._functions).reduce(function(t,n){return t[n]=e._functions[n].signature,t},{})},enumerable:!1,configurable:!0}),r.prototype.getCompilationKey=function(e,t){var n=e.map(function(i){return i.name}).sort(),a=t.map(function(i){return i.name}).sort();return n.join(this.SEPARATOR)+"--"+a.join(this.SEPARATOR)},r.prototype.compile=function(e,t){var n=RC(e,t,this.weightMap,this._initNodes),a=n.missingInputs,i=n.dynamicNode,o=n.syncInputs;if(i!=null)throw new Error("This execution contains the node '".concat(i.name,"', which has ")+"the dynamic op '".concat(i.op,"'. Please use ")+"model.executeAsync() instead. Alternatively, to avoid the "+"dynamic ops, specify the inputs [".concat(o,"]"));if(a.length>0){var s=t.map(function(f){return f.name}),u=Object.keys(e);throw new Error("Cannot compute the outputs [".concat(s,"] from the provided inputs ")+"[".concat(u,"]. Missing the following inputs: [").concat(a,"]"))}var c=$pe(this.graph,n),l=Vpe(c);return{orderedNodes:c,nodeLiveUntilMap:l}},r.prototype.cloneAndKeepTensor=function(e){if(e==null)return null;var t=e.clone();return Me.keep(t),t},r.prototype.cloneTensorList=function(e){var t=this;if(!e)return null;var n=e.map(function(a){return t.cloneAndKeepTensor(a)});return n},r.prototype.cloneTensorMap=function(e){var t=this;return Object.fromEntries(Object.entries(e).map(function(n){var a=be(n,2),i=a[0],o=a[1];return[i,t.cloneTensorList(o)]}))},r.prototype.execute=function(e,t){var n=this;this.disposeIntermediateTensors(),e=this.mapInputs(e);var a=Object.keys(e).sort();this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t);var i=a.map(function(p){return n.graph.nodes[zn(p)[0]]}),o=t.map(function(p){return zn(p)[0]}),s=new Set(o),u=o.map(function(p){return n.graph.nodes[p]});u.length===0&&(u=this._outputs);var c=this.getCompilationKey(i,u),l=this.compiledMap.get(c);l==null&&(l=this.compile(e,u),this.compiledMap.set(c,l));try{this.keepIntermediateTensors=Me.env().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(p){this.keepIntermediateTensors=!1,console.warn(p.message)}var f={},h={};return Me.tidy(function(){var p,d,m=new FC(n.weightMap,f,h,n.functionExecutorMap,n.parseNodeNameCache),v=Object.assign({},n.weightMap);n.keepIntermediateTensors&&(n.clonedTensorsMap=n.cloneTensorMap(n.weightMap)),Object.keys(e).forEach(function(N){var C=be(zn(N,m),2),R=C[0],_=C[1],P=[];P[_]=e[N],v[R]=P,n.keepIntermediateTensors&&(n.clonedTensorsMap[R]=n.cloneTensorList(P))});var g=n.getFrozenTensorIds(v),y=l.orderedNodes,w=l.nodeLiveUntilMap;try{for(var b=_r(y),x=b.next();!x.done;x=b.next()){var S=x.value;if(!v[S.name]){var T=_C(S,v,m,n._resourceManager);if(Me.util.isPromise(T))throw new Error("The execution of the op '".concat(S.op,"' returned a promise. ")+"Please use model.executeAsync() instead.");v[S.name]=T,n.keepIntermediateTensors&&(n.clonedTensorsMap[S.name]=n.cloneTensorList(T)),n.checkTensorForDisposalWithNodeLiveUntilInfo(S,v,m,g,s,w.get(S.name))}}}catch(N){p={error:N}}finally{try{x&&!x.done&&(d=b.return)&&d.call(b)}finally{if(p)throw p.error}}return n.parent==null&&m.dispose(g),t.map(function(N){return Kr(N,v,m)})})},r.prototype.getFrozenTensorIds=function(e){var t=[].concat.apply([],Object.keys(e).map(function(n){return e[n]}).map(function(n){return n.map(function(a){return a.id})}));return new Set(t)},r.prototype.checkTensorForDisposal=function(e,t,n,a,i,o,s){var u,c,l,f,h,p;if(!(ps(t)||o.has(e))){try{for(var d=_r(n[e]),m=d.next();!m.done;m=d.next()){var v=m.value;v!=null&&(s[v.id]=(s[v.id]||0)+t.children.length)}}catch(N){u={error:N}}finally{try{m&&!m.done&&(c=d.return)&&c.call(d)}finally{if(u)throw u.error}}try{for(var g=_r(t.inputs),y=g.next();!y.done;y=g.next()){var w=y.value;if(!ps(w)){var b=iC(w.name,n,a);if(b!=null)try{for(var x=(h=void 0,_r(b)),S=x.next();!S.done;S=x.next()){var v=S.value;if(!(!v||v.kept||i.has(v.id))){var T=s[v.id];T===1?(v.dispose(),delete s[v.id]):T!=null&&s[v.id]--}}}catch(N){h={error:N}}finally{try{S&&!S.done&&(p=x.return)&&p.call(x)}finally{if(h)throw h.error}}}}}catch(N){l={error:N}}finally{try{y&&!y.done&&(f=g.return)&&f.call(g)}finally{if(l)throw l.error}}}},r.prototype.checkTensorForDisposalWithNodeLiveUntilInfo=function(e,t,n,a,i,o){var s,u,c,l;function f(w){return ps(w)||i.has(w.name)}if(!(ps(e)||o==null))try{for(var h=_r(o),p=h.next();!p.done;p=h.next()){var d=p.value;if(!f(d)){var m=iC(d.name,t,n);try{for(var v=(c=void 0,_r(m)),g=v.next();!g.done;g=v.next()){var y=g.value;!y||y.kept||a.has(y.id)||y.dispose()}}catch(w){c={error:w}}finally{try{g&&!g.done&&(l=v.return)&&l.call(v)}finally{if(c)throw c.error}}}}}catch(w){s={error:w}}finally{try{p&&!p.done&&(u=h.return)&&u.call(h)}finally{if(s)throw s.error}}},r.prototype.executeAsync=function(e,t){return yt(this,void 0,void 0,function(){return gt(this,function(n){return[2,this._executeAsync(e,t)]})})},r.prototype.disposeIntermediateTensors=function(){this.clonedTensorsMap&&(Object.values(this.clonedTensorsMap).forEach(function(e){var t,n;try{for(var a=_r(e),i=a.next();!i.done;i=a.next()){var o=i.value;o&&!o.isDisposed&&o.dispose()}}catch(s){t={error:s}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}}),this.clonedTensorsMap=null)},r.prototype.getIntermediateTensors=function(){return this.clonedTensorsMap},r.prototype._executeAsync=function(e,t,n,a,i){return n===void 0&&(n=!1),a===void 0&&(a={}),i===void 0&&(i={}),yt(this,void 0,void 0,function(){var o,s,u,c,l,f;return gt(this,function(h){switch(h.label){case 0:this.disposeIntermediateTensors(),n||(e=this.mapInputs(e),this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t));try{this.keepIntermediateTensors=Me.env().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(p){this.keepIntermediateTensors=!1,console.warn(p.message)}return o=new FC(this.weightMap,a,i,this.functionExecutorMap,this.parseNodeNameCache),this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap)),[4,this.executeWithControlFlow(e,o,t,n)];case 1:return s=h.sent(),u=t.map(function(p){return Kr(p,s,o)}),c=u.map(function(p){return p.id}),l=Object.keys(e).map(function(p){return e[p].id}),f=new Set(Et(Et(Et([],be(c),!1),be(l),!1),be(this.weightIds),!1)),Object.values(s).forEach(function(p){p.forEach(function(d){d&&!d.isDisposed&&!f.has(d.id)&&d.dispose()})}),this.parent==null&&o.dispose(f),[2,u]}})})},r.prototype.executeFunctionAsync=function(e,t,n){return yt(this,void 0,void 0,function(){var a,i=this;return gt(this,function(o){return a=e.reduce(function(s,u,c){return s[i.inputs[c].name]=u,s},{}),[2,this._executeAsync(a,this.outputNodes,!0,t,n)]})})},r.prototype.executeWithControlFlow=function(e,t,n,a){return yt(this,void 0,void 0,function(){var i,o,s,u,c,l,f,h,p,d,m,v,g,y,w,b,x,S,T=this;return gt(this,function(N){switch(N.label){case 0:i=Object.keys(e),o=i.map(function(C){return T.graph.nodes[zn(C)[0]]}),s=n.map(function(C){return zn(C)[0]}),u=new Set(s),c=s.map(function(C){return T.graph.nodes[C]}),c.length===0&&(c=this._outputs),l=RC(e,c,this.weightMap,this._initNodes),f=l.usedNodes,h=l.missingInputs,p=l.dynamicNode,d=l.syncInputs,m=Et(Et(Et([],be(o),!1),be(this.graph.weights),!1),be(this._initNodes||[]),!1).map(function(C){return{node:C,contexts:t.currentContext}}),v=Object.assign({},this.weightMap),Object.keys(e).forEach(function(C){var R=be(zn(C),2),_=R[0],P=R[1],$=[];$[P]=e[C],v[_]=$}),g={},y=this.getFrozenTensorIds(v),w={},N.label=1;case 1:return m.length>0?(b=this.processStack(o,m,t,v,w,y,u,g,f),[4,Promise.all(b)]):[3,3];case 2:return N.sent(),[3,1];case 3:if(p==null&&!a&&console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead."),x=c.filter(function(C){return!ps(C)&&!Kr(C.name,v,t)}).map(function(C){return C.name}),x.length>0)throw S="",p!=null&&(S="Alternatively, to avoid the dynamic ops, use model.execute() "+"and specify the inputs [".concat(d,"]")),new Error("Cannot compute the outputs [".concat(x,"] from the provided ")+"inputs [".concat(i,"]. Consider providing the following inputs: ")+"[".concat(h,"]. ").concat(S));return[2,v]}})})},r.prototype.processStack=function(e,t,n,a,i,o,s,u,c){for(var l=this,f=[],h=function(){var d,m,v=t.pop();n.currentContext=v.contexts;var g="";if(v.node.op==="Enter"&&I("isConstant",v.node,a,n)&&(d=be(Pi(v.node.name,n),1),g=d[0]),a[v.node.name]==null){var y=_C(v.node,a,n,p._resourceManager);g||(m=be(Pi(v.node.name,n),1),g=m[0]);var w=n.currentContext;Me.util.isPromise(y)?f.push(y.then(function(b){return a[g]=b,l.keepIntermediateTensors&&(l.clonedTensorsMap[g]=l.cloneTensorList(b)),n.currentContext=w,l.checkTensorForDisposal(g,v.node,a,n,o,s,u),l.processChildNodes(v.node,t,n,a,i,c),b})):(a[g]=y,p.keepIntermediateTensors&&(p.clonedTensorsMap[g]=p.cloneTensorList(y)),p.checkTensorForDisposal(g,v.node,a,n,o,s,u),p.processChildNodes(v.node,t,n,a,i,c))}else p.processChildNodes(v.node,t,n,a,i,c)},p=this;t.length>0;)h();return f},r.prototype.processChildNodes=function(e,t,n,a,i,o){e.children.forEach(function(s){var u=be(Pi(s.name,n),1),c=u[0];i[c]||!o.has(s.name)||(s.op==="Merge"?s.inputNames.some(function(l){return!!Kr(l,a,n)})&&(i[c]=!0,t.push({contexts:n.currentContext,node:s})):s.inputNames.every(function(l){return!!Kr(l,a,n)})&&(i[c]=!0,t.push({contexts:n.currentContext,node:s})))})},r.prototype.dispose=function(){var e=this;Object.keys(this.weightMap).forEach(function(t){return e.weightMap[t].forEach(function(n){return n.dispose()})})},r.prototype.checkInputShapeAndType=function(e){var t=this;Object.keys(e).forEach(function(n){var a=e[n],i=be(zn(n),1),o=i[0],s=t.graph.nodes[o];if(s.attrParams.shape&&s.attrParams.shape.value){var u=s.attrParams.shape.value,c=u.length===a.shape.length&&a.shape.every(function(l,f){return u[f]===-1||u[f]===l});Me.util.assert(c,function(){return"The shape of dict['".concat(s.name,"'] provided in ")+"model.execute(dict) must be [".concat(u,"], but was ")+"[".concat(a.shape,"]")})}s.attrParams.dtype&&s.attrParams.dtype.value&&Me.util.assert(a.dtype===s.attrParams.dtype.value,function(){return"The dtype of dict['".concat(s.name,"'] provided in ")+"model.execute(dict) must be "+"".concat(s.attrParams.dtype.value,", but was ").concat(a.dtype)})})},r.prototype.mapInputs=function(e){var t,n,a={};for(var i in e){var o=(n=(t=this._signature)===null||t===void 0?void 0:t.inputs)===null||n===void 0?void 0:n[i];o!=null?a[o.name]=e[i]:a[i]=e[i]}return a},r.prototype.checkInputs=function(e){var t=this,n=Object.keys(e).filter(function(a){var i=be(zn(a),1),o=i[0];return t.graph.nodes[o]==null});if(n.length>0)throw new Error("The dict provided in model.execute(dict) has "+"keys: [".concat(n,"] that are not part of graph"))},r.prototype.mapOutputs=function(e){var t=this;return e.map(function(n){var a,i,o=(i=(a=t._signature)===null||a===void 0?void 0:a.outputs)===null||i===void 0?void 0:i[n];return o!=null?o.name:n},{})},r.prototype.checkOutputs=function(e){var t=this;e.forEach(function(n){var a=be(zn(n),1),i=a[0];if(!t.graph.nodes[i])throw new Error("The output '".concat(n,"' is not found in the graph"))})},r})(),Xpe=(function(){function r(e,t){e===void 0&&(e={}),t===void 0&&(t={}),this.hashTableNameToHandle=e,this.hashTableMap=t}return r.prototype.addHashTable=function(e,t){this.hashTableNameToHandle[e]=t.handle,this.hashTableMap[t.id]=t},r.prototype.getHashTableHandleByName=function(e){return this.hashTableNameToHandle[e]},r.prototype.getHashTableById=function(e){return this.hashTableMap[e]},r.prototype.dispose=function(){for(var e in this.hashTableMap)this.hashTableMap[e].clearAndClose(),delete this.hashTableMap[e];for(var t in this.hashTableNameToHandle)this.hashTableNameToHandle[t].dispose(),delete this.hashTableNameToHandle[t]},r})();var kp={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8},Sp=4;function Ype(r,e){return yt(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c;return gt(this,function(l){switch(l.label){case 0:return t=Br(r.shape),"quantization"in r?(a=r.quantization,n=kp[a.dtype],[3,7]):[3,1];case 1:if(r.dtype!=="string")return[3,6];i=0,o=0,l.label=2;case 2:return o<t?(s=i,u=Sp,c=Uint32Array.bind,[4,e(i,i+Sp)]):[3,5];case 3:i=s+(u+new(c.apply(Uint32Array,[void 0,l.sent()]))()[0]),l.label=4;case 4:return o++,[3,2];case 5:return[2,i];case 6:n=kp[r.dtype],l.label=7;case 7:return[2,t*n]}})})}function Zpe(r,e){var t=r.name,n=r.dtype,a=r.shape,i=Br(a),o,s=0;if("quantization"in r){var u=r.quantization;if(u.dtype==="uint8"||u.dtype==="uint16"){if(!("min"in u&&"scale"in u))throw new Error("Weight ".concat(r.name," with quantization ").concat(u.dtype," ")+"doesn't have corresponding metadata min and scale.")}else if(u.dtype==="float16"){if(n!=="float32")throw new Error("Weight ".concat(r.name," is quantized with ").concat(u.dtype," ")+"which only supports weights of type float32 not ".concat(n,"."))}else throw new Error("Weight ".concat(r.name," has unknown ")+"quantization dtype ".concat(u.dtype,". ")+"Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.");var c=kp[u.dtype],l=u.dtype==="uint8"?new Uint8Array(e):new Uint16Array(e);if(n==="float32")if(u.dtype==="uint8"||u.dtype==="uint16"){o=new Float32Array(l.length);for(var f=0;f<l.length;f++){var h=l[f];o[f]=h*u.scale+u.min}}else if(u.dtype==="float16"){var p=rde();o=p(l)}else throw new Error("Unsupported quantization type ".concat(u.dtype," ")+"for weight type float32.");else if(n==="int32"){if(u.dtype!=="uint8"&&u.dtype!=="uint16")throw new Error("Unsupported quantization type ".concat(u.dtype," ")+"for weight type int32.");o=new Int32Array(l.length);for(var f=0;f<l.length;f++){var h=l[f];o[f]=Math.round(h*u.scale+u.min)}}else throw new Error("Unsupported dtype in weight '".concat(t,"': ").concat(n));s+=i*c}else if(n==="string"){var d=Br(r.shape);o=[];for(var f=0;f<d;f++){var m=new Uint32Array(e.slice(s,s+Sp))[0];s+=Sp;var v=new Uint8Array(e.slice(s,s+m));o.push(v),s+=m}}else{var g=kp[n];if(n==="float32")o=new Float32Array(e);else if(n==="int32")o=new Int32Array(e);else if(n==="bool")o=new Uint8Array(e);else if(n==="complex64"){o=new Float32Array(e);for(var y=new Float32Array(o.length/2),w=new Float32Array(o.length/2),f=0;f<y.length;f++)y[f]=o[f*2],w[f]=o[f*2+1];var b=Au(y,a,"float32"),x=Au(w,a,"float32"),S=yo(b,x);return b.dispose(),x.dispose(),S}else throw new Error("Unsupported dtype in weight '".concat(t,"': ").concat(n));s+=i*g}return Au(o,a,n)}function PC(r,e,t){return yt(this,void 0,void 0,function(){var n,a,i,o,s,u;return gt(this,function(c){switch(c.label){case 0:n=new Uint8Array(e),c.label=1;case 1:return n.byteLength<t?[4,r.read()]:[3,3];case 2:if(a=c.sent(),i=a.done,o=a.value,i&&o==null)throw s=t-n.byteLength,new Error("Reader is done but ".concat(s," bytes are still expected"));return u=new Uint8Array(n.length+o.byteLength),u.set(n,0),u.set(new Uint8Array(o),n.length),n=u,[3,1];case 3:return[2,n.buffer]}})})}function Jpe(r,e){return yt(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l,f,h,p,d,m=this;return gt(this,function(v){switch(v.label){case 0:t={},n=r.getReader(),a=new ArrayBuffer(0),v.label=1;case 1:v.trys.push([1,7,8,9]),i=_r(e),o=i.next(),v.label=2;case 2:return o.done?[3,6]:(s=o.value,[4,Ype(s,function(g,y){return yt(m,void 0,void 0,function(){return gt(this,function(w){switch(w.label){case 0:return[4,PC(n,a,y)];case 1:return a=w.sent(),[2,a.slice(g,y)]}})})})]);case 3:return u=v.sent(),[4,PC(n,a,u)];case 4:a=v.sent(),c=a.slice(0,u),a=a.slice(u),l=Zpe(s,c),t[s.name]=l,Jle()==="webgpu"&&(f=Qle(),"uploadToGPU"in f&&Br(l.shape)>=wn().get("WEBGPU_CPU_HANDOFF_SIZE_THRESHOLD")&&f.uploadToGPU(l.dataId)),v.label=5;case 5:return o=i.next(),[3,2];case 6:return[3,9];case 7:return h=v.sent(),p={error:h},[3,9];case 8:try{o&&!o.done&&(d=i.return)&&d.call(i)}finally{if(p)throw p.error}return[7];case 9:return[2,t]}})})}function Qpe(){var r=function(n){for(var a=n<<13,i=0;(a&8388608)===0;)i-=8388608,a<<=1;return a&=-8388609,i+=947912704,a|i},e=new Uint32Array(2048);e[0]=0;for(var t=1;t<1024;t++)e[t]=r(t);for(var t=1024;t<2048;t++)e[t]=939524096+(t-1024<<13);return e}function ede(){var r=new Uint32Array(64);r[0]=0,r[31]=1199570944,r[32]=2147483648,r[63]=3347054592;for(var e=1;e<31;e++)r[e]=e<<23;for(var e=33;e<63;e++)r[e]=2147483648+(e-32<<23);return r}function tde(){for(var r=new Uint32Array(64),e=0;e<64;e++)r[e]=1024;return r[0]=r[32]=0,r}function rde(){var r=Qpe(),e=ede(),t=tde();return function(n){for(var a=new ArrayBuffer(4*n.length),i=new Uint32Array(a),o=0;o<n.length;o++){var s=n[o],u=r[t[s>>10]+(s&1023)]+e[s>>10];i[o]=u}return new Float32Array(a)}}var nde="?tfjs-format=file",ade="model.json",_0=(function(){function r(e,t,n){t===void 0&&(t={}),n===void 0&&(n=Me.io),this.modelUrl=e,this.loadOptions=t,this.version="n/a",this.io=n,t==null&&(this.loadOptions={}),this.resourceManager=new Xpe}return Object.defineProperty(r.prototype,"modelVersion",{get:function(){return this.version},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"inputNodes",{get:function(){return this.executor.inputNodes},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"outputNodes",{get:function(){return this.executor.outputNodes},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"inputs",{get:function(){return this.executor.inputs},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"outputs",{get:function(){return this.executor.outputs},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"weights",{get:function(){return this.executor.weightMap},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"metadata",{get:function(){return this.artifacts.userDefinedMetadata},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"modelSignature",{get:function(){return this.signature},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"modelStructuredOutputKeys",{get:function(){return this.structuredOutputKeys},enumerable:!1,configurable:!0}),r.prototype.findIOHandler=function(){var e=this.modelUrl;if(e.load!=null)this.handler=e;else if(this.loadOptions.requestInit!=null)this.handler=this.io.browserHTTPRequest(e,this.loadOptions);else{var t=this.io.getLoadHandlers(e,this.loadOptions);if(t.length===0)t.push(this.io.browserHTTPRequest(e,this.loadOptions));else if(t.length>1)throw new Error("Found more than one (".concat(t.length,") load handlers for ")+"URL '".concat([e],"'"));this.handler=t[0]}},r.prototype.load=function(){var e=this;if(this.findIOHandler(),this.handler.load==null)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");var t=this.handler.load();return Me.util.isPromise(t)?t.then(function(n){return n.getWeightStream==null?e.loadSync(n):e.loadStreaming(n)}):this.loadSync(t)},r.prototype.loadSync=function(e){var t=this.io.decodeWeights(e.weightData,e.weightSpecs);return this.loadWithWeightMap(e,t)},r.prototype.loadStreaming=function(e){return yt(this,void 0,void 0,function(){var t;return gt(this,function(n){switch(n.label){case 0:if(e.getWeightStream==null)throw new Error("Model artifacts missing streamWeights function");return[4,Jpe(e.getWeightStream(),e.weightSpecs)];case 1:return t=n.sent(),[2,this.loadWithWeightMap(e,t)]}})})},r.prototype.loadWithWeightMap=function(e,t){this.artifacts=e;var n=this.artifacts.modelTopology,a=this.artifacts.signature;if(this.artifacts.userDefinedMetadata!=null){var i=this.artifacts.userDefinedMetadata;i.signature!=null&&(a=i.signature),i.structuredOutputKeys!=null&&(this.structuredOutputKeys=i.structuredOutputKeys)}if(this.signature=a,this.version="".concat(n.versions.producer,".").concat(n.versions.minConsumer),this.executor=new OC(oC.Instance.transformGraph(n,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(t),this.executor.resourceManager=this.resourceManager,e.modelInitializer!=null&&e.modelInitializer.node!=null){var o=oC.Instance.transformGraph(e.modelInitializer);this.initializer=new OC(o),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializerSignature=e.initializerSignature}return!0},r.prototype.save=function(e,t){return yt(this,void 0,void 0,function(){var n;return gt(this,function(a){if(typeof e=="string"){if(n=this.io.getSaveHandlers(e),n.length===0)throw new Error("Cannot find any save handlers for URL '".concat(e,"'"));if(n.length>1)throw new Error("Found more than one (".concat(n.length,") save handlers for ")+"URL '".concat(e,"'"));e=n[0]}if(e.save==null)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return[2,e.save(this.artifacts)]})})},r.prototype.addStructuredOutputNames=function(e){var t=this;if(this.structuredOutputKeys){var n=e instanceof Me.Tensor?[e]:e,a={};return n.forEach(function(i,o){return a[t.structuredOutputKeys[o]]=i}),a}return e},r.prototype.predict=function(e,t){var n=this.execute(e,this.outputNodes);return this.addStructuredOutputNames(n)},r.prototype.predictAsync=function(e,t){return yt(this,void 0,void 0,function(){var n;return gt(this,function(a){switch(a.label){case 0:return[4,this.executeAsync(e,this.outputNodes)];case 1:return n=a.sent(),[2,this.addStructuredOutputNames(n)]}})})},r.prototype.normalizeInputs=function(e){var t=this,n;if(!(e instanceof Me.Tensor)&&!Array.isArray(e)){var a=(n=this.signature)===null||n===void 0?void 0:n.inputs;if(a!=null)for(var i in a){var o=a[i];o.resourceId!=null&&(e[i]=this.resourceIdToCapturedInput[o.resourceId])}return e}e=Array.isArray(e)?e:[e];var s=Object.keys(this.resourceIdToCapturedInput).length;if(e.length+s!==this.inputNodes.length)throw new Error("Input tensor count mismatch, the graph model has ".concat(this.inputNodes.length-s," non-resource placeholders, while there are ").concat(e.length," input tensors provided."));var u=0;return this.inputNodes.reduce(function(c,l){var f,h,p,d=(p=(h=(f=t.signature)===null||f===void 0?void 0:f.inputs)===null||h===void 0?void 0:h[l])===null||p===void 0?void 0:p.resourceId;return d!=null?c[l]=t.resourceIdToCapturedInput[d]:c[l]=e[u++],c},{})},r.prototype.normalizeOutputs=function(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]},r.prototype.executeInitializerGraph=function(){return this.initializer==null?[]:this.initializerSignature==null?this.initializer.execute({},[]):this.initializer.execute({},Object.keys(this.initializerSignature.outputs))},r.prototype.executeInitializerGraphAsync=function(){return yt(this,void 0,void 0,function(){return gt(this,function(e){return this.initializer==null?[2,[]]:this.initializerSignature==null?[2,this.initializer.executeAsync({},[])]:[2,this.initializer.executeAsync({},Object.keys(this.initializerSignature.outputs))]})})},r.prototype.setResourceIdToCapturedInput=function(e){if(this.resourceIdToCapturedInput={},this.initializerSignature)for(var t=this.initializerSignature.outputs,n=Object.keys(t),a=0;a<n.length;a++){var i=n[a],o=t[i];this.resourceIdToCapturedInput[o.resourceId]=e[a]}},r.prototype.execute=function(e,t){this.resourceIdToCapturedInput==null&&this.setResourceIdToCapturedInput(this.executeInitializerGraph()),e=this.normalizeInputs(e),t=this.normalizeOutputs(t);var n=this.executor.execute(e,t);return n.length>1?n:n[0]},r.prototype.executeAsync=function(e,t){return yt(this,void 0,void 0,function(){var n,a;return gt(this,function(i){switch(i.label){case 0:return this.resourceIdToCapturedInput!=null?[3,2]:(n=this.setResourceIdToCapturedInput,[4,this.executeInitializerGraphAsync()]);case 1:n.apply(this,[i.sent()]),i.label=2;case 2:return e=this.normalizeInputs(e),t=this.normalizeOutputs(t),[4,this.executor.executeAsync(e,t)];case 3:return a=i.sent(),[2,a.length>1?a:a[0]]}})})},r.prototype.getIntermediateTensors=function(){return this.executor.getIntermediateTensors()},r.prototype.disposeIntermediateTensors=function(){this.executor.disposeIntermediateTensors()},r.prototype.convertTensorMapToTensorsMap=function(e){return Object.keys(e).reduce(function(t,n){return t[n]=[e[n]],t},{})},r.prototype.dispose=function(){this.executor.dispose(),this.initializer&&(this.initializer.dispose(),this.resourceIdToCapturedInput&&Me.dispose(this.resourceIdToCapturedInput)),this.resourceManager.dispose()},r})();function ide(r,e,t){return e===void 0&&(e={}),t===void 0&&(t=Me.io),yt(this,void 0,void 0,function(){var n;return gt(this,function(a){switch(a.label){case 0:if(r==null)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");return e==null&&(e={}),e.fromTFHub&&typeof r=="string"&&(r=sde(r)),n=new _0(r,e,t),[4,n.load()];case 1:return a.sent(),[2,n]}})})}function ode(r){if(r==null)throw new Error("modelUrl in loadGraphModelSync() cannot be null. Please provide model artifacts or an IOHandler that loads the model");var e;if(r instanceof Array){var t=be(r,2),n=t[0],a=t[1];if(!n)throw new Error("modelJSON must be the first element of the array");if(!a||!(a instanceof ArrayBuffer))throw new Error("An ArrayBuffer of weights must be the second element of the array");if(!("modelTopology"in n))throw new Error("Model JSON is missing 'modelTopology'");if(!("weightsManifest"in n))throw new Error("Model JSON is missing 'weightsManifest'");var i=Me.io.getWeightSpecs(n.weightsManifest),o=Me.io.getModelArtifactsForJSONSync(n,i,a);e=Me.io.fromMemorySync(o)}else if("load"in r)e=r;else if("modelTopology"in r&&"weightSpecs"in r&&"weightData"in r)e=Me.io.fromMemorySync(r);else throw new Error("Unknown model format");var s=new _0(e);return s.load(),s}function sde(r){return r.endsWith("/")||(r=r+"/"),"".concat(r).concat(ade).concat(nde)}var ude="4.22.0";ks.GraphModel=_0;ks.deregisterOp=Mee;ks.loadGraphModel=ide;ks.loadGraphModelSync=ode;ks.registerOp=Pee;ks.version_converter=ude});var F0=Vr(()=>{});var TD=Vr(Hn=>{"use strict";var cr=Xo();function cde(r){var e=Object.create(null);return r&&Object.keys(r).forEach(function(t){if(t!=="default"){var n=Object.getOwnPropertyDescriptor(r,t);Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:function(){return r[t]}})}}),e.default=r,e}var ar=cde(cr),O0=function(r,e){return O0=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},O0(r,e)};function Tt(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");O0(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Be(r,e,t,n){function a(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function s(l){try{c(n.next(l))}catch(f){o(f)}}function u(l){try{c(n.throw(l))}catch(f){o(f)}}function c(l){l.done?i(l.value):a(l.value).then(s,u)}c((n=n.apply(r,e||[])).next())})}function Le(r,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(c){return function(l){return u([c,l])}}function u(c){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,a&&(i=c[0]&2?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[c[0]&2,i.value]),c[0]){case 0:case 1:i=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,a=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){t.label=c[1];break}if(c[0]===6&&t.label<i[1]){t.label=i[1],i=c;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(c);break}i[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(r,t)}catch(l){c=[6,l],a=0}finally{n=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function Ss(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function lde(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=n.next()).done;)i.push(a.value)}catch(s){o={error:s}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return i}function fde(r,e,t){if(t||arguments.length===2)for(var n=0,a=e.length,i;n<a;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return r.concat(i||Array.prototype.slice.call(e))}var Es=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function hde(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var t=function n(){if(this instanceof n){var a=[null];a.push.apply(a,arguments);var i=Function.bind.apply(e,a);return new i}return e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var a=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,a.get?a:{enumerable:!0,get:function(){return r[n]}})}),t}var tD={exports:{}};(function(r){(function(e,t,n){function a(u){var c=this,l=s();c.next=function(){var f=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=f-(c.c=f|0)},c.c=1,c.s0=l(" "),c.s1=l(" "),c.s2=l(" "),c.s0-=l(u),c.s0<0&&(c.s0+=1),c.s1-=l(u),c.s1<0&&(c.s1+=1),c.s2-=l(u),c.s2<0&&(c.s2+=1),l=null}function i(u,c){return c.c=u.c,c.s0=u.s0,c.s1=u.s1,c.s2=u.s2,c}function o(u,c){var l=new a(u),f=c&&c.state,h=l.next;return h.int32=function(){return l.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,f&&(typeof f=="object"&&i(f,l),h.state=function(){return i(l,{})}),h}function s(){var u=4022871197,c=function(l){l=String(l);for(var f=0;f<l.length;f++){u+=l.charCodeAt(f);var h=.02519603282416938*u;u=h>>>0,h-=u,h*=u,u=h>>>0,h-=u,u+=h*4294967296}return(u>>>0)*23283064365386963e-26};return c}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.alea=o})(Es,r,!1)})(tD);var pde=tD.exports,rD={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this,c="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var f=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^f^f>>>8},s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor128=o})(Es,r,!1)})(rD);var dde=rD.exports,nD={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this,c="";u.next=function(){var f=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^(f^f<<1))|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,l==c.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorwow=o})(Es,r,!1)})(nD);var vde=nD.exports,aD={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var l=u.x,f=u.i,h,p;return h=l[f],h^=h>>>7,p=h^h<<24,h=l[f+1&7],p^=h^h>>>10,h=l[f+3&7],p^=h^h>>>3,h=l[f+4&7],p^=h^h<<7,h=l[f+7&7],h=h^h<<13,p^=h^h<<9,l[f]=p,u.i=f+1&7,p};function c(l,f){var h,p=[];if(f===(f|0))p[0]=f;else for(f=""+f,h=0;h<f.length;++h)p[h&7]=p[h&7]<<15^f.charCodeAt(h)+p[h+1&7]<<13;for(;p.length<8;)p.push(0);for(h=0;h<8&&p[h]===0;++h);for(h==8?p[7]=-1:p[h],l.x=p,l.i=0,h=256;h>0;--h)l.next()}c(u,s)}function i(s,u){return u.x=s.x.slice(),u.i=s.i,u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(l.x&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorshift7=o})(Es,r,!1)})(aD);var mde=aD.exports,iD={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var l=u.w,f=u.X,h=u.i,p,d;return u.w=l=l+1640531527|0,d=f[h+34&127],p=f[h=h+1&127],d^=d<<13,p^=p<<17,d^=d>>>15,p^=p>>>12,d=f[h]=d^p,u.i=h,d+(l^l>>>16)|0};function c(l,f){var h,p,d,m,v,g=[],y=128;for(f===(f|0)?(p=f,f=null):(f=f+"\0",p=0,y=Math.max(y,f.length)),d=0,m=-32;m<y;++m)f&&(p^=f.charCodeAt((m+32)%f.length)),m===0&&(v=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,m>=0&&(v=v+1640531527|0,h=g[m&127]^=p+v,d=h==0?d+1:0);for(d>=128&&(g[(f&&f.length||0)&127]=-1),d=127,m=512;m>0;--m)p=g[d+34&127],h=g[d=d+1&127],p^=p<<13,h^=h<<17,p^=p>>>15,h^=h>>>12,g[d]=p^h;l.w=v,l.X=g,l.i=d}c(u,s)}function i(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(l.X&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor4096=o})(Es,r,!1)})(iD);var gde=iD.exports,oD={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this,c="";u.next=function(){var f=u.b,h=u.c,p=u.d,d=u.a;return f=f<<25^f>>>7^h,h=h-p|0,p=p<<24^p>>>8^d,d=d-f|0,u.b=f=f<<20^f>>>12^h,u.c=h=h-p|0,u.d=p<<16^h>>>16^d,u.a=d-f|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=s|0):c+=s;for(var l=0;l<c.length+20;l++)u.b^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.tychei=o})(Es,r,!1)})(oD);var yde=oD.exports,sD={exports:{}},bde={},wde={__proto__:null,default:bde},xde=hde(wde);(function(r){(function(e,t,n){var a=256,i=6,o=52,s="random",u=n.pow(a,i),c=n.pow(2,o),l=c*2,f=a-1,h;function p(b,x,S){var T=[];x=x==!0?{entropy:!0}:x||{};var N=g(v(x.entropy?[b,w(t)]:b??y(),3),T),C=new d(T),R=function(){for(var _=C.g(i),P=u,$=0;_<c;)_=(_+$)*a,P*=a,$=C.g(1);for(;_>=l;)_/=2,P/=2,$>>>=1;return(_+$)/P};return R.int32=function(){return C.g(4)|0},R.quick=function(){return C.g(4)/4294967296},R.double=R,g(w(C.S),t),(x.pass||S||function(_,P,$,z){return z&&(z.S&&m(z,C),_.state=function(){return m(C,{})}),$?(n[s]=_,P):_})(R,N,"global"in x?x.global:this==n,x.state)}function d(b){var x,S=b.length,T=this,N=0,C=T.i=T.j=0,R=T.S=[];for(S||(b=[S++]);N<a;)R[N]=N++;for(N=0;N<a;N++)R[N]=R[C=f&C+b[N%S]+(x=R[N])],R[C]=x;(T.g=function(_){for(var P,$=0,z=T.i,L=T.j,B=T.S;_--;)P=B[z=f&z+1],$=$*a+B[f&(B[z]=B[L=f&L+P])+(B[L]=P)];return T.i=z,T.j=L,$})(a)}function m(b,x){return x.i=b.i,x.j=b.j,x.S=b.S.slice(),x}function v(b,x){var S=[],T=typeof b,N;if(x&&T=="object")for(N in b)try{S.push(v(b[N],x-1))}catch{}return S.length?S:T=="string"?b:b+"\0"}function g(b,x){for(var S=b+"",T,N=0;N<S.length;)x[f&N]=f&(T^=x[f&N]*19)+S.charCodeAt(N++);return w(x)}function y(){try{var b;return h&&(b=h.randomBytes)?b=b(a):(b=new Uint8Array(a),(e.crypto||e.msCrypto).getRandomValues(b)),w(b)}catch{var x=e.navigator,S=x&&x.plugins;return[+new Date,e,S,e.screen,w(t)]}}function w(b){return String.fromCharCode.apply(0,b)}if(g(n.random(),t),r.exports){r.exports=p;try{h=xde}catch{}}else n["seed"+s]=p})(typeof self<"u"?self:Es,[],Math)})(sD);var kde=sD.exports,Sde=pde,Ede=dde,Tde=vde,Nde=mde,Ide=gde,Cde=yde,Ts=kde;Ts.alea=Sde;Ts.xor128=Ede;Ts.xorwow=Tde;Ts.xorshift7=Nde;Ts.xor4096=Ide;Ts.tychei=Cde;var uD=Ts;function Ade(r,e){return Lp(r,e)}function Lp(r,e,t,n){if(t===void 0&&(t=new Map),n===void 0&&(n=new Set),r==null)return null;if(typeof Blob=="function"&&r instanceof Blob)return r.slice();if(n.has(r))throw new Error("Circular references are not supported.");if(t.has(r))return t.get(r);var a=e(r);if(a.recurse&&a.value!==null)throw new Error("A deep map function may not return both a value and recurse=true.");if(a.recurse)if(Pu(r)){var i=Array.isArray(r)?[]:{};n.add(r);for(var o in r){var s=r[o],u=Lp(s,e,t,n);i[o]=u}return n.delete(r),r.__proto__&&(i.__proto__=r.__proto__),i}else throw new Error("Can't recurse into non-iterable type: ".concat(r));else return t.set(r,a.value),a.value}function Dde(r,e){return e===void 0&&(e=lD),cD(r,e)}function cD(r,e,t){t===void 0&&(t=new Set);var n=r[0];if(t.has(n))throw new Error("Circular references are not supported.");var a=e(r);if(a.recurse&&a.value!==null)throw new Error("A deep zip function may not return both a value and recurse=true.");if(a.recurse)if(Pu(n)){var i=Array.isArray(n)?[]:{};t.add(n);var o=function(u){var c=r.map(function(f){return f[u]}),l=cD(c,e,t);i[u]=l};for(var s in n)o(s);return t.delete(n),i}else throw new Error("Can't recurse into non-iterable type: ".concat(n));else return a.value}function lD(r){return r===null?null:Pu(r[0])?{value:null,recurse:!0}:{value:r,recurse:!1}}function fD(r,e){return Be(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l,f;return Le(this,function(h){switch(h.label){case 0:t=new Map,Lp(r,e,t),h.label=1;case 1:h.trys.push([1,6,7,8]),n=Ss(Array.from(t.keys())),a=n.next(),h.label=2;case 2:return a.done?[3,5]:(i=a.value,o=t.get(i),ar.util.isPromise(o)?[4,o]:[3,4]);case 3:s=h.sent(),t.set(i,s),h.label=4;case 4:return a=n.next(),[3,2];case 5:return[3,8];case 6:return u=h.sent(),l={error:u},[3,8];case 7:try{a&&!a.done&&(f=n.return)&&f.call(n)}finally{if(l)throw l.error}return[7];case 8:return c=Lp(r,e,t),[2,c]}})})}function Pu(r){var e=!1;if(ar.env().get("IS_BROWSER"))e=r instanceof TextDecoder;else{var t=F0().StringDecoder;e=r instanceof t}return r!=null&&!ArrayBuffer.isView(r)&&(Array.isArray(r)||typeof r=="object"&&!(r instanceof ar.Tensor)&&!(r instanceof Promise)&&!e)}function _de(r){return r==null||Fde(r)||Array.isArray(r)||typeof r=="object"&&r instanceof ar.Tensor||ar.util.isTypedArray(r)}function Fde(r){return r===null||typeof r!="object"&&typeof r!="function"}function Rde(r){return Ade(r,Ode)}function Ode(r){return r instanceof ar.Tensor?{value:r.clone(),recurse:!1}:Pu(r)?{value:null,recurse:!0}:{value:r,recurse:!1}}var hD=(function(){function r(e){if(this.capacity=e,this.begin=0,this.end=0,e==null)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(e<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(e),this.doubledCapacity=2*e}return r.prototype.wrap=function(e){for(;e<0;)e+=this.doubledCapacity;return e%this.doubledCapacity},r.prototype.get=function(e){if(e<0)throw new RangeError("Can't get item at a negative index.");return this.data[e%this.capacity]},r.prototype.set=function(e,t){if(e<0)throw new RangeError("Can't set item at a negative index.");this.data[e%this.capacity]=t},r.prototype.length=function(){var e=this.end-this.begin;return e<0&&(e=this.doubledCapacity+e),e},r.prototype.isFull=function(){return this.length()===this.capacity},r.prototype.isEmpty=function(){return this.length()===0},r.prototype.push=function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,e),this.end=this.wrap(this.end+1)},r.prototype.pushAll=function(e){var t,n;try{for(var a=Ss(e),i=a.next();!i.done;i=a.next()){var o=i.value;this.push(o)}}catch(s){t={error:s}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}},r.prototype.pop=function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);var e=this.get(this.end);return this.set(this.end,void 0),e},r.prototype.unshift=function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,e)},r.prototype.shift=function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var e=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),e},r.prototype.shuffleExcise=function(e){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var t=this.wrap(this.begin+e),n=this.get(t);return this.set(t,this.pop()),n},r})(),pD=(function(r){Tt(e,r);function e(){return r.call(this,e.INITIAL_CAPACITY)||this}return e.prototype.isFull=function(){return!1},e.prototype.push=function(t){r.prototype.isFull.call(this)&&this.expand(),r.prototype.push.call(this,t)},e.prototype.unshift=function(t){r.prototype.isFull.call(this)&&this.expand(),r.prototype.unshift.call(this,t)},e.prototype.expand=function(){for(var t=this.capacity*2,n=new Array(t),a=this.length(),i=0;i<a;i++)n[i]=this.get(this.wrap(this.begin+i));this.data=n,this.capacity=t,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=a},e})(hD);pD.INITIAL_CAPACITY=32;function dD(r){return new Bde(r)}function P0(r){return new Lde(r)}function Pde(r,e){return new vD(r,e)}function Mde(r,e){return e===void 0&&(e=ko.FAIL),new Kde(r,e)}var $r=(function(){function r(){}return r.prototype.toArray=function(){return Be(this,void 0,void 0,function(){var e,t;return Le(this,function(n){switch(n.label){case 0:return e=[],[4,this.next()];case 1:t=n.sent(),n.label=2;case 2:return t.done?[3,4]:(e.push(t.value),[4,this.next()]);case 3:return t=n.sent(),[3,2];case 4:return[2,e]}})})},r.prototype.toArrayForTest=function(){return Be(this,void 0,void 0,function(){var e,t,n;return Le(this,function(a){switch(a.label){case 0:return e=this.prefetch(100),t=[],[4,e.next()];case 1:n=a.sent(),a.label=2;case 2:return n.done?[3,4]:(t.push(n.value),[4,e.next()]);case 3:return n=a.sent(),[3,2];case 4:return[2,t]}})})},r.prototype.resolveFully=function(){return Be(this,void 0,void 0,function(){var e;return Le(this,function(t){switch(t.label){case 0:return[4,this.next()];case 1:e=t.sent(),t.label=2;case 2:return e.done?[3,4]:[4,this.next()];case 3:return e=t.sent(),[3,2];case 4:return[2]}})})},r.prototype.resolveWhile=function(e){return Be(this,void 0,void 0,function(){var t,n;return Le(this,function(a){switch(a.label){case 0:return[4,this.next()];case 1:t=a.sent(),n=e(t.value),a.label=2;case 2:return!t.done&&n?[4,this.next()]:[3,4];case 3:return t=a.sent(),n=e(t.value),[3,2];case 4:return[2]}})})},r.prototype.handleErrors=function(e){return new Hde(this,e)},r.prototype.filter=function(e){return new Vde(this,e)},r.prototype.map=function(e){return new Ude(this,e)},r.prototype.mapAsync=function(e){return new JA(this,e)},r.prototype.serialMapAsync=function(e){return new JA(this,e).serial()},r.prototype.flatmap=function(e){return new qde(this,e)},r.prototype.forEachAsync=function(e){return Be(this,void 0,void 0,function(){return Le(this,function(t){return[2,this.map(e).resolveFully()]})})},r.prototype.serialForEach=function(e){return Be(this,void 0,void 0,function(){return Le(this,function(t){return[2,this.serialMapAsync(e).resolveWhile(function(n){return n===!0})]})})},r.prototype.rowMajorBatch=function(e,t){return t===void 0&&(t=!0),new Gde(this,e,t)},r.prototype.columnMajorBatch=function(e,t,n){t===void 0&&(t=!0),n===void 0&&(n=lD);var a=this.rowMajorBatch(e,t);return a.map(function(i){return Dde(i,n)})},r.prototype.concatenate=function(e,t){return new vD(dD([this,e]),t)},r.prototype.take=function(e){return e<0||e==null?this:new Wde(this,e)},r.prototype.skip=function(e){return e<0||e==null?this:new $de(this,e)},r.prototype.prefetch=function(e){return new mD(this,e)},r.prototype.shuffle=function(e,t){return new jde(this,e,t)},r.prototype.serial=function(){return new zde(this)},r})(),Bde=(function(r){Tt(e,r);function e(t){var n=r.call(this)||this;return n.items=t,n.trav=0,n}return e.prototype.summary=function(){return"Array of ".concat(this.items.length," items")},e.prototype.next=function(){return Be(this,void 0,void 0,function(){var t;return Le(this,function(n){return this.trav>=this.items.length?[2,{value:null,done:!0}]:(t=this.items[this.trav],this.trav++,[2,{value:Rde(t),done:!1}])})})},e})($r),Lde=(function(r){Tt(e,r);function e(t){var n=r.call(this)||this;return n.nextFn=t,n}return e.prototype.summary=function(){return"Function call"},e.prototype.next=function(){return Be(this,void 0,void 0,function(){return Le(this,function(t){try{return[2,this.nextFn()]}catch(n){throw n.message="Error thrown while iterating through a dataset: ".concat(n.message),n}return[2]})})},e})($r),zde=(function(r){Tt(e,r);function e(t){var n=r.call(this)||this;return n.upstream=t,n.lastRead=Promise.resolve({value:null,done:!1}),n}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Serial")},e.prototype.next=function(){return Be(this,void 0,void 0,function(){var t=this;return Le(this,function(n){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return Be(this,void 0,void 0,function(){return Le(this,function(t){return[2,this.upstream.next()]})})},e})($r),$de=(function(r){Tt(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.maxCount=n,a.count=0,a.lastRead=Promise.resolve({value:null,done:!1}),a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Skip")},e.prototype.next=function(){return Be(this,void 0,void 0,function(){var t=this;return Le(this,function(n){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return Be(this,void 0,void 0,function(){var t;return Le(this,function(n){switch(n.label){case 0:return this.count++<this.maxCount?[4,this.upstream.next()]:[3,2];case 1:return t=n.sent(),t.done?[2,t]:(ar.dispose(t.value),[3,0]);case 2:return[2,this.upstream.next()]}})})},e})($r),Wde=(function(r){Tt(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.maxCount=n,a.count=0,a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Take")},e.prototype.next=function(){return Be(this,void 0,void 0,function(){return Le(this,function(t){return this.count++>=this.maxCount?[2,{value:null,done:!0}]:[2,this.upstream.next()]})})},e})($r),Gde=(function(r){Tt(e,r);function e(t,n,a){a===void 0&&(a=!0);var i=r.call(this)||this;return i.upstream=t,i.batchSize=n,i.enableSmallLastBatch=a,i.lastRead=Promise.resolve({value:null,done:!1}),i}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> RowMajorBatch")},e.prototype.next=function(){return Be(this,void 0,void 0,function(){var t=this;return Le(this,function(n){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return Be(this,void 0,void 0,function(){var t,n;return Le(this,function(a){switch(a.label){case 0:t=[],a.label=1;case 1:return t.length<this.batchSize?[4,this.upstream.next()]:[3,3];case 2:return n=a.sent(),n.done?this.enableSmallLastBatch&&t.length>0?[2,{value:t,done:!1}]:[2,{value:null,done:!0}]:(t.push(n.value),[3,1]);case 3:return[2,{value:t,done:!1}]}})})},e})($r),Vde=(function(r){Tt(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.predicate=n,a.lastRead=Promise.resolve({value:null,done:!1}),a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Filter")},e.prototype.next=function(){return Be(this,void 0,void 0,function(){var t=this;return Le(this,function(n){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return Be(this,void 0,void 0,function(){var t;return Le(this,function(n){switch(n.label){case 0:return[4,this.upstream.next()];case 1:return t=n.sent(),t.done||this.predicate(t.value)?[2,t]:(ar.dispose(t.value),[3,0]);case 2:return[2]}})})},e})($r),Ude=(function(r){Tt(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.transform=n,a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Map")},e.prototype.next=function(){return Be(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l;return Le(this,function(f){switch(f.label){case 0:return[4,this.upstream.next()];case 1:if(t=f.sent(),t.done)return[2,{value:null,done:!0}];n=ar.tensor_util.getTensorsInContainer(t.value),a=this.transform(t.value),i=ar.tensor_util.getTensorsInContainer(a);try{for(o=Ss(n),s=o.next();!s.done;s=o.next())u=s.value,ar.tensor_util.isTensorInList(u,i)||u.dispose()}catch(h){c={error:h}}finally{try{s&&!s.done&&(l=o.return)&&l.call(o)}finally{if(c)throw c.error}}return[2,{value:a,done:!1}]}})})},e})($r),Hde=(function(r){Tt(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.handler=n,a.count=0,a.lastRead=Promise.resolve({value:null,done:!1}),a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> handleErrors")},e.prototype.next=function(){return Be(this,void 0,void 0,function(){var t=this;return Le(this,function(n){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return Be(this,void 0,void 0,function(){var t;return Le(this,function(n){switch(n.label){case 0:n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.upstream.next()];case 2:return[2,n.sent()];case 3:return t=n.sent(),this.handler(t)?[3,4]:[2,{value:null,done:!0}];case 4:return[3,0];case 5:return[2]}})})},e})($r),JA=(function(r){Tt(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.transform=n,a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> AsyncMap")},e.prototype.next=function(){return Be(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l;return Le(this,function(f){switch(f.label){case 0:return[4,this.upstream.next()];case 1:return t=f.sent(),t.done?[2,{value:null,done:!0}]:(n=ar.tensor_util.getTensorsInContainer(t.value),[4,this.transform(t.value)]);case 2:a=f.sent(),i=ar.tensor_util.getTensorsInContainer(a);try{for(o=Ss(n),s=o.next();!s.done;s=o.next())u=s.value,ar.tensor_util.isTensorInList(u,i)||u.dispose()}catch(h){c={error:h}}finally{try{s&&!s.done&&(l=o.return)&&l.call(o)}finally{if(c)throw c.error}}return[2,{value:a,done:!1}]}})})},e})($r),M0=(function(r){Tt(e,r);function e(){var t=r.call(this)||this;return t.outputQueue=new pD,t.lastRead=Promise.resolve({value:null,done:!1}),t}return e.prototype.next=function(){return Be(this,void 0,void 0,function(){var t=this;return Le(this,function(n){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return Be(this,void 0,void 0,function(){return Le(this,function(t){switch(t.label){case 0:return this.outputQueue.length()!==0?[3,2]:[4,this.pump()];case 1:return t.sent()?[3,0]:[2,{value:null,done:!0}];case 2:return[2,{value:this.outputQueue.shift(),done:!1}]}})})},e})($r),qde=(function(r){Tt(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.transform=n,a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Flatmap")},e.prototype.pump=function(){return Be(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l;return Le(this,function(f){switch(f.label){case 0:return[4,this.upstream.next()];case 1:if(t=f.sent(),t.done)return[2,!1];n=ar.tensor_util.getTensorsInContainer(t.value),a=this.transform(t.value),i=ar.tensor_util.getTensorsInContainer(a),this.outputQueue.pushAll(a);try{for(o=Ss(n),s=o.next();!s.done;s=o.next())u=s.value,ar.tensor_util.isTensorInList(u,i)||u.dispose()}catch(h){c={error:h}}finally{try{s&&!s.done&&(l=o.return)&&l.call(o)}finally{if(c)throw c.error}}return[2,!0]}})})},e})(M0),vD=(function(r){Tt(e,r);function e(t,n){var a=r.call(this)||this;return a.baseErrorHandler=n,a.lastRead=null,a.iterator=null,a.moreIterators=t,a}return e.prototype.summary=function(){var t="TODO: fill in upstream of chained summaries";return"".concat(t," -> Chained")},e.prototype.next=function(){return Be(this,void 0,void 0,function(){return Le(this,function(t){return this.lastRead=this.readFromChain(this.lastRead),[2,this.lastRead]})})},e.prototype.readFromChain=function(t){return Be(this,void 0,void 0,function(){var n,a;return Le(this,function(i){switch(i.label){case 0:return[4,t];case 1:return i.sent(),this.iterator!=null?[3,3]:[4,this.moreIterators.next()];case 2:if(n=i.sent(),n.done)return[2,{value:null,done:!0}];this.iterator=n.value,this.baseErrorHandler!=null&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler)),i.label=3;case 3:return[4,this.iterator.next()];case 4:return a=i.sent(),a.done?(this.iterator=null,[2,this.readFromChain(t)]):[2,a]}})})},e})($r),ko;(function(r){r[r.FAIL=0]="FAIL",r[r.SHORTEST=1]="SHORTEST",r[r.LONGEST=2]="LONGEST"})(ko||(ko={}));var Kde=(function(r){Tt(e,r);function e(t,n){n===void 0&&(n=ko.FAIL);var a=r.call(this)||this;return a.iterators=t,a.mismatchMode=n,a.count=0,a.currentPromise=null,a}return e.prototype.summary=function(){var t="TODO: fill in upstream of zip summaries";return"{".concat(t,"} -> Zip")},e.prototype.nextState=function(t){return Be(this,void 0,void 0,function(){function n(s){if(s instanceof $r){var u=s.next();return{value:u.then(function(c){return a++,c.done&&i++,c.value}),recurse:!1}}else return{value:null,recurse:!0}}var a,i,o;return Le(this,function(s){switch(s.label){case 0:return[4,t];case 1:return s.sent(),a=0,i=0,[4,fD(this.iterators,n)];case 2:if(o=s.sent(),a===i)return[2,{value:null,done:!0}];if(i>0)switch(this.mismatchMode){case ko.FAIL:throw new Error("Zipped streams should have the same length. "+"Mismatched at element ".concat(this.count,"."));case ko.SHORTEST:return[2,{value:null,done:!0}];case ko.LONGEST:}return this.count++,[2,{value:o,done:!1}]}})})},e.prototype.next=function(){return Be(this,void 0,void 0,function(){return Le(this,function(t){return this.currentPromise=this.nextState(this.currentPromise),[2,this.currentPromise]})})},e})($r),mD=(function(r){Tt(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.bufferSize=n,a.buffer=new hD(n),a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Prefetch")},e.prototype.refill=function(){for(;!this.buffer.isFull();){var t=this.upstream.next();this.buffer.push(t)}},e.prototype.next=function(){return this.refill(),this.buffer.shift()},e})($r),jde=(function(r){Tt(e,r);function e(t,n,a){var i=r.call(this,t,n)||this;return i.upstream=t,i.windowSize=n,i.upstreamExhausted=!1,i.random=uD.alea(a||ar.util.now().toString()),i.lastRead=Promise.resolve({value:null,done:!1}),i}return e.prototype.next=function(){return Be(this,void 0,void 0,function(){var t=this;return Le(this,function(n){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.randomInt=function(t){return Math.floor(this.random()*t)},e.prototype.chooseIndex=function(){return this.randomInt(this.buffer.length())},e.prototype.serialNext=function(){return Be(this,void 0,void 0,function(){var t,n;return Le(this,function(a){switch(a.label){case 0:this.upstreamExhausted||this.refill(),a.label=1;case 1:return this.buffer.isEmpty()?[3,3]:(t=this.chooseIndex(),[4,this.buffer.shuffleExcise(t)]);case 2:if(n=a.sent(),n.done)this.upstreamExhausted=!0;else return this.refill(),[2,n];return[3,1];case 3:return[2,{value:null,done:!0}]}})})},e})(mD),Mu=(function(){function r(){this.size=null}return r.prototype.batch=function(e,t){var n=this;t===void 0&&(t=!0);var a=this;ar.util.assert(e>0,function(){return`batchSize needs to be positive, but it is
      `.concat(e)});var i;return this.size===1/0||this.size==null?i=this.size:t?i=Math.ceil(this.size/e):i=Math.floor(this.size/e),Un(function(){return Be(n,void 0,void 0,function(){return Le(this,function(o){switch(o.label){case 0:return[4,a.iterator()];case 1:return[2,o.sent().columnMajorBatch(e,t,Zde)]}})})},i)},r.prototype.concatenate=function(e){var t=this,n=this,a;return this.size===1/0||e.size===1/0?a=1/0:this.size!=null&&e.size!=null?a=this.size+e.size:a=null,Un(function(){return Be(t,void 0,void 0,function(){var i,o;return Le(this,function(s){switch(s.label){case 0:return[4,n.iterator()];case 1:return o=(i=s.sent()).concatenate,[4,e.iterator()];case 2:return[2,o.apply(i,[s.sent()])]}})})},a)},r.prototype.filter=function(e){var t=this,n=this,a;return this.size===1/0?a=1/0:a=null,Un(function(){return Be(t,void 0,void 0,function(){return Le(this,function(i){switch(i.label){case 0:return[4,n.iterator()];case 1:return[2,i.sent().filter(function(o){return ar.tidy(function(){return e(o)})})]}})})},a)},r.prototype.forEachAsync=function(e){return Be(this,void 0,void 0,function(){return Le(this,function(t){switch(t.label){case 0:return[4,this.iterator()];case 1:return[2,t.sent().forEachAsync(e)]}})})},r.prototype.map=function(e){var t=this,n=this;return Un(function(){return Be(t,void 0,void 0,function(){return Le(this,function(a){switch(a.label){case 0:return[4,n.iterator()];case 1:return[2,a.sent().map(function(i){return ar.tidy(function(){return e(i)})})]}})})},this.size)},r.prototype.mapAsync=function(e){var t=this,n=this;return Un(function(){return Be(t,void 0,void 0,function(){return Le(this,function(a){switch(a.label){case 0:return[4,n.iterator()];case 1:return[2,a.sent().mapAsync(e)]}})})},this.size)},r.prototype.prefetch=function(e){var t=this;if(e==null)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");var n=this;return Un(function(){return Be(t,void 0,void 0,function(){return Le(this,function(a){switch(a.label){case 0:return[4,n.iterator()];case 1:return[2,a.sent().prefetch(e)]}})})},this.size)},r.prototype.repeat=function(e){var t=this,n=this,a;return this.size!=null&&e>0?a=this.size*e:e===0?a=0:this.size!=null&&(e===void 0||e<0)?a=1/0:a=null,Un(function(){return Be(t,void 0,void 0,function(){var i,o=this;return Le(this,function(s){return i=P0(function(){return Be(o,void 0,void 0,function(){var u;return Le(this,function(c){switch(c.label){case 0:return u={},[4,n.iterator()];case 1:return[2,(u.value=c.sent(),u.done=!1,u)]}})})}),[2,Pde(i.take(e))]})})},a)},r.prototype.skip=function(e){var t=this,n=this,a;return this.size!=null&&e>=0&&this.size>=e?a=this.size-e:this.size!=null&&(this.size<e||e===void 0||e<0)?a=0:a=null,Un(function(){return Be(t,void 0,void 0,function(){return Le(this,function(i){switch(i.label){case 0:return[4,n.iterator()];case 1:return[2,i.sent().skip(e)]}})})},a)},r.prototype.shuffle=function(e,t,n){var a=this;if(n===void 0&&(n=!0),e==null||e<0)throw this.size==null?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError("`Dataset.shuffle()` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for `tf.Tensor`s), consider setting "+"bufferSize to the dataset size (".concat(this.size," elements)"));var i=this,o=uD.alea(t||ar.util.now().toString());return Un(function(){return Be(a,void 0,void 0,function(){var s;return Le(this,function(u){switch(u.label){case 0:return s=o.int32(),n&&(s+=o.int32()),[4,i.iterator()];case 1:return[2,u.sent().shuffle(e,s.toString())]}})})},this.size)},r.prototype.take=function(e){var t=this,n=this,a;return this.size!=null&&this.size>e?a=e:this.size!=null&&this.size<=e?a=this.size:a=null,Un(function(){return Be(t,void 0,void 0,function(){return Le(this,function(i){switch(i.label){case 0:return[4,n.iterator()];case 1:return[2,i.sent().take(e)]}})})},a)},r.prototype.toArray=function(){return Be(this,void 0,void 0,function(){return Le(this,function(e){switch(e.label){case 0:if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return[4,this.iterator()];case 1:return[2,e.sent().toArray()]}})})},r.prototype.toArrayForTest=function(){return Be(this,void 0,void 0,function(){return Le(this,function(e){switch(e.label){case 0:if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return[4,this.iterator()];case 1:return[2,e.sent().toArrayForTest()]}})})},r})();Mu.MAX_BUFFER_SIZE=1e4;function Un(r,e){return e===void 0&&(e=null),new((function(t){Tt(n,t);function n(){var a=t.apply(this,fde([],lde(arguments),!1))||this;return a.size=e,a}return n.prototype.iterator=function(){return Be(this,void 0,void 0,function(){return Le(this,function(a){return[2,r()]})})},n})(Mu))}function Xde(r){var e=this;return Un(function(){return Be(e,void 0,void 0,function(){return Le(this,function(t){return[2,dD(r)]})})},r.length)}function Yde(r){var e=this;if(!Pu(r))throw new Error("The argument to zip() must be an object or array.");var t;if(Array.isArray(r))for(var n=0;n<r.length;n++)t=t==null?r[n].size:Math.min(t,r[n].size);else if(r instanceof Object)for(var a in r)t=t==null?r[a].size:Math.min(t,r[a].size);return Un(function(){return Be(e,void 0,void 0,function(){var i;return Le(this,function(o){switch(o.label){case 0:return[4,fD(r,function(s){if(s instanceof Mu)return{value:s.iterator(),recurse:!1};if(Pu(s))return{value:null,recurse:!0};throw new Error("Leaves of the structure passed to zip() must be Datasets, not primitives.")})];case 1:return i=o.sent(),[2,Mde(i,ko.SHORTEST)]}})})},t)}function Zde(r){if(r===null)return null;var e=r[0];if(_de(e)){var t=Jde(r);return{value:t,recurse:!1}}return{value:null,recurse:!0}}function Jde(r){if(r.length===0)throw new Error("Can't make a batch of zero elements.");return r[0]instanceof ar.Tensor?ar.stack(r):ar.tensor(r)}var gD=(function(r){Tt(e,r);function e(t){var n=r.call(this)||this;return n.input=t,n}return e.prototype.iterator=function(){return Be(this,void 0,void 0,function(){var t,n,a;return Le(this,function(i){switch(i.label){case 0:return[4,this.input.iterator()];case 1:return t=i.sent(),n=t.decodeUTF8(),a=n.split(`
`).map(function(o){return o.endsWith("\r")&&(o=o.slice(0,-1)),o}),[2,a]}})})},e})(Mu),Mp='"',Ml=Symbol("out"),QA=Symbol("field"),Bp=Symbol("quote"),R0=Symbol("quoteafterquote"),eD=Symbol("quoteinquote"),yD=(function(r){Tt(e,r);function e(t,n){var a=r.call(this)||this;return a.input=t,a.hasHeader=!0,a.fullColumnNames=null,a.columnNamesValidated=!1,a.columnConfigs=null,a.configuredColumnsOnly=!1,a.delimiter=",",a.delimWhitespace=!1,a.base=new gD(t),n||(n={}),a.hasHeader=n.hasHeader!==!1,a.fullColumnNames=n.columnNames,a.columnConfigs=n.columnConfigs,a.configuredColumnsOnly=n.configuredColumnsOnly,n.delimWhitespace?(cr.util.assert(n.delimiter==null,function(){return"Delimiter should not be provided when delimWhitespace is true."}),a.delimWhitespace=!0,a.delimiter=" "):a.delimiter=n.delimiter?n.delimiter:",",a}return e.prototype.columnNames=function(){return Be(this,void 0,void 0,function(){return Le(this,function(t){switch(t.label){case 0:return this.columnNamesValidated?[3,2]:[4,this.setColumnNames()];case 1:t.sent(),t.label=2;case 2:return[2,this.configuredColumnsOnly?Object.keys(this.columnConfigs):this.fullColumnNames]}})})},e.prototype.setColumnNames=function(){return Be(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l,f=this;return Le(this,function(h){switch(h.label){case 0:return[4,this.maybeReadHeaderLine()];case 1:if(t=h.sent(),!this.fullColumnNames&&!t)throw new Error("Column names must be provided if there is no header line.");if(this.fullColumnNames&&t&&cr.util.assert(t.length===this.fullColumnNames.length,function(){return"The length of provided columnNames ("+f.fullColumnNames.length.toString()+") does not match the length of the header line read from file ("+t.length.toString()+")."}),this.fullColumnNames||(this.fullColumnNames=t),n=this.fullColumnNames.reduce(function(p,d){return p[d]=p[d]+1||1,p},{}),a=Object.keys(n).filter(function(p){return n[p]>1}),cr.util.assert(a.length===0,function(){return"Duplicate column names found: "+a.toString()}),this.columnConfigs)try{for(i=Ss(Object.keys(this.columnConfigs)),o=i.next();!o.done;o=i.next())if(s=o.value,u=this.fullColumnNames.indexOf(s),u===-1)throw new Error('The key "'+s+'" provided in columnConfigs does not match any of the column names ('+this.fullColumnNames.toString()+").")}catch(p){c={error:p}}finally{try{o&&!o.done&&(l=i.return)&&l.call(i)}finally{if(c)throw c.error}}return this.columnNamesValidated=!0,[2]}})})},e.prototype.maybeReadHeaderLine=function(){return Be(this,void 0,void 0,function(){var t,n,a,i;return Le(this,function(o){switch(o.label){case 0:return this.hasHeader?[4,this.base.iterator()]:[3,3];case 1:return t=o.sent(),[4,t.next()];case 2:if(n=o.sent(),n.done)throw new Error("No data was found for CSV parsing.");return a=n.value,i=this.parseRow(a,!1),[2,i];case 3:return[2,null]}})})},e.prototype.iterator=function(){return Be(this,void 0,void 0,function(){var t,n=this;return Le(this,function(a){switch(a.label){case 0:return this.columnNamesValidated?[3,2]:[4,this.setColumnNames()];case 1:a.sent(),a.label=2;case 2:return[4,this.base.iterator()];case 3:return t=a.sent(),this.hasHeader&&(t=t.skip(1)),[2,t.map(function(i){return n.makeDataElement(i)})]}})})},e.prototype.makeDataElement=function(t){for(var n=this.parseRow(t),a={},i={},o=0;o<this.fullColumnNames.length;o++){var s=this.fullColumnNames[o],u=this.columnConfigs?this.columnConfigs[s]:null;if(!(this.configuredColumnsOnly&&!u)){var c=n[o],l=null;if(c==="")if(u&&u.default!==void 0)l=u.default;else{if(u&&(u.required||u.isLabel))throw new Error("Required column ".concat(s," is empty in this line: ").concat(t));l=void 0}else{var f=Number(c);if(isNaN(f))u&&u.dtype==="bool"?l=this.getBoolean(c):l=c;else if(!u||!u.dtype)l=f;else switch(u.dtype){case"float32":l=f;break;case"int32":l=Math.floor(f);break;case"bool":l=this.getBoolean(c);break;default:l=f}}u&&u.isLabel?i[s]=l:a[s]=l}}return Object.keys(i).length===0?a:{xs:a,ys:i}},e.prototype.getBoolean=function(t){return t==="1"||t.toLowerCase()==="true"?1:0},e.prototype.parseRow=function(t,n){n===void 0&&(n=!0);for(var a=[],i=0,o=t.length,s=Ml,u=0;u<o;u++)switch(s){case Ml:switch(t.charAt(u)){case Mp:i=u+1,s=Bp;break;case this.delimiter:if(i=u+1,this.delimiter===" "&&this.delimWhitespace)break;a.push(""),s=Ml;break;default:s=QA,i=u;break}break;case QA:switch(t.charAt(u)){case this.delimiter:a.push(t.substring(i,u)),s=Ml,i=u+1;break}break;case Bp:switch(t.charAt(u)){case Mp:s=R0;break}break;case R0:switch(t.charAt(u)){case this.delimiter:a.push(t.substring(i,u-1)),s=Ml,i=u+1;break;case Mp:s=Bp;break;default:s=eD;break}break;case eD:switch(t.charAt(u)){case Mp:s=Bp;break}break}if(s===R0?a.push(t.substring(i,o-1)):a.push(t.substring(i)),n&&a.length!==this.fullColumnNames.length)throw new Error("Invalid row in csv file. Should have ".concat(this.fullColumnNames.length," elements in a row, but got ").concat(a));return a},e})(Mu),Qde=(function(r){Tt(e,r);function e(t){var n=r.call(this)||this;n.microphoneConfig=t,n.isClosed=!1,n.fftSize=t.fftSize||1024;var a=Math.log2(n.fftSize);if(n.fftSize<0||a<4||a>14||!Number.isInteger(a))throw new Error("Invalid fftSize: it must be a power of 2 between "+"2 to 4 and 2 to 14, but got ".concat(n.fftSize));if(n.numFrames=t.numFramesPerSpectrogram||43,n.sampleRateHz=t.sampleRateHz,n.columnTruncateLength=t.columnTruncateLength||n.fftSize,n.audioTrackConstraints=t.audioTrackConstraints,n.smoothingTimeConstant=t.smoothingTimeConstant||0,n.includeSpectrogram=t.includeSpectrogram!==!1,n.includeWaveform=t.includeWaveform===!0,!n.includeSpectrogram&&!n.includeWaveform)throw new Error("Both includeSpectrogram and includeWaveform are false. At least one type of data should be returned.");return n}return e.prototype.summary=function(){return"microphone"},e.create=function(t){return t===void 0&&(t={}),Be(this,void 0,void 0,function(){var n;return Le(this,function(a){switch(a.label){case 0:if(!cr.env().get("IS_BROWSER"))throw new Error("microphone API is only supported in browser environment.");return n=new e(t),[4,n.start()];case 1:return a.sent(),[2,n]}})})},e.prototype.start=function(){return Be(this,void 0,void 0,function(){var t,n,a,i;return Le(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),t=this,[4,navigator.mediaDevices.getUserMedia({audio:this.audioTrackConstraints==null?!0:this.audioTrackConstraints,video:!1})];case 1:return t.stream=o.sent(),[3,3];case 2:throw n=o.sent(),new Error("Error thrown while initializing video stream: ".concat(n.message));case 3:if(!this.stream)throw new Error("Could not obtain audio from microphone.");if(a=window.AudioContext||window.webkitAudioContext,this.audioContext=new a,!this.sampleRateHz)this.sampleRateHz=this.audioContext.sampleRate;else if(this.audioContext.sampleRate!==this.sampleRateHz)throw new Error("Mismatch in sampling rate: "+"Expected: ".concat(this.sampleRateHz,"; ")+"Actual: ".concat(this.audioContext.sampleRate));return i=this.audioContext.createMediaStreamSource(this.stream),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=this.fftSize*2,this.analyser.smoothingTimeConstant=this.smoothingTimeConstant,i.connect(this.analyser),this.freqData=new Float32Array(this.fftSize),this.timeData=new Float32Array(this.fftSize),[2]}})})},e.prototype.next=function(){return Be(this,void 0,void 0,function(){var t,n,a,i,o;return Le(this,function(s){switch(s.label){case 0:return this.isClosed?[2,{value:null,done:!0}]:[4,this.getAudioData()];case 1:return a=s.sent(),this.includeSpectrogram&&(i=this.flattenQueue(a.freqDataQueue),t=this.getTensorFromAudioDataArray(i,[this.numFrames,this.columnTruncateLength,1])),this.includeWaveform&&(o=this.flattenQueue(a.timeDataQueue),n=this.getTensorFromAudioDataArray(o,[this.numFrames*this.fftSize,1])),[2,{value:{spectrogram:t,waveform:n},done:!1}]}})})},e.prototype.capture=function(){return Be(this,void 0,void 0,function(){return Le(this,function(t){switch(t.label){case 0:return[4,this.next()];case 1:return[2,t.sent().value]}})})},e.prototype.getAudioData=function(){return Be(this,void 0,void 0,function(){var t,n,a,i=this;return Le(this,function(o){return t=[],n=[],a=0,[2,new Promise(function(s){var u=setInterval(function(){i.includeSpectrogram&&(i.analyser.getFloatFrequencyData(i.freqData),i.freqData[0]===-1/0&&s({freqDataQueue:t,timeDataQueue:n}),t.push(i.freqData.slice(0,i.columnTruncateLength))),i.includeWaveform&&(i.analyser.getFloatTimeDomainData(i.timeData),n.push(i.timeData.slice())),++a===i.numFrames&&(clearInterval(u),s({freqDataQueue:t,timeDataQueue:n}))},i.fftSize/i.sampleRateHz*1e3)})]})})},e.prototype.stop=function(){this.isClosed||(this.isClosed=!0,this.analyser.disconnect(),this.audioContext.close(),this.stream!=null&&this.stream.getTracks().length>0&&this.stream.getTracks()[0].stop())},e.prototype.toArray=function(){throw new Error("Can not convert infinite audio stream to array.")},e.prototype.getSampleRate=function(){return this.sampleRateHz},e.prototype.flattenQueue=function(t){var n=t[0].length,a=new Float32Array(t.length*n);return t.forEach(function(i,o){return a.set(i,o*n)}),a},e.prototype.getTensorFromAudioDataArray=function(t,n){var a=new Float32Array(cr.util.sizeFromShape(n));return a.set(t,a.length-t.length),cr.tensor(a,n)},e})($r),eve=(function(r){Tt(e,r);function e(t,n){var a=r.call(this)||this;if(a.webcamVideoElement=t,a.webcamConfig=n,a.isClosed=!0,a.resize=!1,a.needToResize())if(a.resize=!0,a.cropSize=[a.webcamConfig.resizeHeight,a.webcamConfig.resizeWidth],a.cropBoxInd=cr.tensor1d([0],"int32"),a.webcamConfig.centerCrop){var i=a.webcamConfig.resizeWidth*1/a.webcamVideoElement.width,o=a.webcamConfig.resizeHeight*1/a.webcamVideoElement.height,s=(1-i)/2,u=(1-o)/2,c=s+i,l=o+u;a.cropBox=cr.tensor2d([u,s,l,c],[1,4])}else a.cropBox=cr.tensor2d([0,0,1,1],[1,4]);return a}return e.prototype.summary=function(){return"webcam"},e.create=function(t,n){return n===void 0&&(n={}),Be(this,void 0,void 0,function(){var a;return Le(this,function(i){switch(i.label){case 0:if(!cr.env().get("IS_BROWSER"))throw new Error("tf.data.webcam is only supported in browser environment.");if(!t){if(t=document.createElement("video"),!n.resizeWidth||!n.resizeHeight)throw new Error("Please provide webcam video element, or resizeWidth and resizeHeight to create a hidden video element.");t.width=n.resizeWidth,t.height=n.resizeHeight}return a=new e(t,n),[4,a.start()];case 1:return i.sent(),[2,a]}})})},e.prototype.start=function(){return Be(this,void 0,void 0,function(){var t,n,a=this;return Le(this,function(i){switch(i.label){case 0:this.webcamConfig.facingMode&&cr.util.assert(this.webcamConfig.facingMode==="user"||this.webcamConfig.facingMode==="environment",function(){return"Invalid webcam facing mode: ".concat(a.webcamConfig.facingMode,". ")+"Please provide 'user' or 'environment'"}),i.label=1;case 1:return i.trys.push([1,3,,4]),t=this,[4,navigator.mediaDevices.getUserMedia({video:{deviceId:this.webcamConfig.deviceId,facingMode:this.webcamConfig.facingMode?this.webcamConfig.facingMode:"user",width:this.webcamVideoElement.width,height:this.webcamVideoElement.height}})];case 2:return t.stream=i.sent(),[3,4];case 3:throw n=i.sent(),n.message="Error thrown while initializing video stream: ".concat(n.message),n;case 4:if(!this.stream)throw new Error("Could not obtain video from webcam.");try{this.webcamVideoElement.srcObject=this.stream}catch(o){console.log(o),this.webcamVideoElement.src=window.URL.createObjectURL(this.stream)}return this.webcamVideoElement.play(),this.isClosed=!1,[2,new Promise(function(o){a.webcamVideoElement.onloadedmetadata=function(){o()}})]}})})},e.prototype.next=function(){return Be(this,void 0,void 0,function(){var t;return Le(this,function(n){if(this.isClosed)return[2,{value:null,done:!0}];try{t=cr.browser.fromPixels(this.webcamVideoElement)}catch(a){throw new Error("Error thrown converting video to pixels: ".concat(JSON.stringify(a)))}if(this.resize)try{return[2,{value:this.cropAndResizeFrame(t),done:!1}]}catch(a){throw new Error("Error thrown cropping the video: ".concat(a.message))}finally{t.dispose()}else return[2,{value:t,done:!1}];return[2]})})},e.prototype.needToResize=function(){return!!(this.webcamConfig.resizeWidth&&this.webcamConfig.resizeHeight&&(this.webcamVideoElement.width!==this.webcamConfig.resizeWidth||this.webcamVideoElement.height!==this.webcamConfig.resizeHeight))},e.prototype.cropAndResizeFrame=function(t){var n=this;return cr.tidy(function(){var a=cr.expandDims(cr.cast(t,"float32"),0),i;i=cr.image.cropAndResize(a,n.cropBox,n.cropBoxInd,n.cropSize,"bilinear");var o=i.shape;return cr.reshape(i,o.slice(1))})},e.prototype.capture=function(){return Be(this,void 0,void 0,function(){return Le(this,function(t){switch(t.label){case 0:return[4,this.next()];case 1:return[2,t.sent().value]}})})},e.prototype.stop=function(){var t=this.stream.getTracks();t.forEach(function(n){return n.stop()});try{this.webcamVideoElement.srcObject=null}catch(n){console.log(n),this.webcamVideoElement.src=null}this.isClosed=!0},e.prototype.toArray=function(){throw new Error("Can not convert infinite video stream to array.")},e})($r);var bD=(function(){function r(){}return r})(),wD=(function(r){Tt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.split=function(t){return new tve(this,t)},e})($r),tve=(function(r){Tt(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.impl=new rve(t,n),a}return e.prototype.summary=function(){return this.impl.summary()},e.prototype.next=function(){return Be(this,void 0,void 0,function(){return Le(this,function(t){return[2,this.impl.next()]})})},e})(wD),rve=(function(r){Tt(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.separator=n,a.carryover="",a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Split('").concat(this.separator,"')")},e.prototype.pump=function(){return Be(this,void 0,void 0,function(){var t,n,a,i,o,s,u;return Le(this,function(c){switch(c.label){case 0:return[4,this.upstream.next()];case 1:if(t=c.sent(),t.done)return this.carryover===""?[2,!1]:(this.outputQueue.push(this.carryover),this.carryover="",[2,!0]);n=t.value.split(this.separator),n[0]=this.carryover+n[0];try{for(a=Ss(n.slice(0,-1)),i=a.next();!i.done;i=a.next())o=i.value,this.outputQueue.push(o)}catch(l){s={error:l}}finally{try{i&&!i.done&&(u=a.return)&&u.call(a)}finally{if(s)throw s.error}}return this.carryover=n[n.length-1],[2,!0]}})})},e})(M0),nve=(function(r){Tt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.decodeUTF8=function(){return new ave(this)},e})($r),ave=(function(r){Tt(e,r);function e(t){var n=r.call(this)||this;return n.upstream=t,n.impl=new ive(t),n}return e.prototype.summary=function(){return this.impl.summary()},e.prototype.next=function(){return Be(this,void 0,void 0,function(){return Le(this,function(t){return[2,this.impl.next()]})})},e})(wD),ive=(function(r){Tt(e,r);function e(t){var n=r.call(this)||this;if(n.upstream=t,cr.env().get("IS_BROWSER"))n.decoder=new TextDecoder("utf-8");else{var a=F0().StringDecoder;n.decoder=new a("utf8")}return n}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Utf8")},e.prototype.pump=function(){return Be(this,void 0,void 0,function(){var t,n,a;return Le(this,function(i){switch(i.label){case 0:return[4,this.upstream.next()];case 1:return t=i.sent(),t.done?[2,!1]:(n=t.value,cr.env().get("IS_BROWSER")?a=this.decoder.decode(n,{stream:!0}):a=this.decoder.write(Buffer.from(n.buffer)),this.outputQueue.push(a),[2,!0])}})})},e})(M0),xD=(function(r){Tt(e,r);function e(t,n){n===void 0&&(n={});var a=r.call(this)||this;return a.file=t,a.options=n,cr.util.assert(t instanceof Uint8Array||(cr.env().get("IS_BROWSER")?t instanceof File||t instanceof Blob:!1),function(){return"FileChunkIterator only supports File, Blob and Uint8Array right now."}),a.offset=n.offset||0,a.chunkSize=n.chunkSize||1024*1024,a}return e.prototype.summary=function(){return"FileChunks ".concat(this.file)},e.prototype.next=function(){return Be(this,void 0,void 0,function(){var t,n,a=this;return Le(this,function(i){switch(i.label){case 0:return this.offset>=(this.file instanceof Uint8Array?this.file.byteLength:this.file.size)?[2,{value:null,done:!0}]:(t=new Promise(function(o,s){var u=a.offset+a.chunkSize;if(a.file instanceof Uint8Array)o(new Uint8Array(a.file.slice(a.offset,u)));else{var c=new FileReader;c.onload=function(f){var h=c.result;if(h instanceof ArrayBuffer&&(h=new Uint8Array(h)),!(h instanceof Uint8Array))return s(new TypeError("FileReader returned unknown type."));o(h)},c.onabort=function(f){return s(new Error("Aborted"))},c.onerror=function(f){return s(new Error(f.type))};var l=a.file.slice(a.offset,u);c.readAsArrayBuffer(l)}a.offset=u}),n={},[4,t]);case 1:return[2,(n.value=i.sent(),n.done=!1,n)]}})})},e})(nve);function ove(r,e,t){return e===void 0&&(e={}),Be(this,void 0,void 0,function(){var n,a,i,o,s;return Le(this,function(u){switch(u.label){case 0:return typeof r=="string"?n=r:(n=r.url,a=sve(r)),[4,(t||cr.util.fetch)(n,a)];case 1:return i=u.sent(),i.ok?(s=Uint8Array.bind,[4,i.arrayBuffer()]):[3,3];case 2:return o=new(s.apply(Uint8Array,[void 0,u.sent()])),[2,new xD(o,e)];case 3:throw new Error(i.statusText)}})})}var sve=function(r){var e={method:r.method,headers:r.headers,body:r.body,mode:r.mode,credentials:r.credentials,cache:r.cache,redirect:r.redirect,referrer:r.referrer,integrity:r.integrity};return e};function kD(r){return typeof r=="string"&&r.slice(0,7)==="file://"}var SD=(function(r){Tt(e,r);function e(t,n){n===void 0&&(n={});var a=r.call(this)||this;return a.input=t,a.options=n,a}return e.prototype.iterator=function(){return Be(this,void 0,void 0,function(){var t;return Le(this,function(n){return kD(this.input)&&cr.env().get("IS_NODE")&&(t=vc("fs"),this.input=t.readFileSync(this.input.slice(7))),[2,new xD(this.input,this.options)]})})},e})(bD),ED=(function(r){Tt(e,r);function e(t,n){n===void 0&&(n={});var a=r.call(this)||this;return a.url=t,a.fileOptions=n,a}return e.prototype.iterator=function(){return Be(this,void 0,void 0,function(){return Le(this,function(t){return kD(this.url)?[2,new SD(this.url,this.fileOptions).iterator()]:[2,ove(this.url,this.fileOptions)]})})},e})(bD);function uve(r,e){return e===void 0&&(e={}),new yD(new ED(r),e)}function cve(r){var e=this,t=P0(r);return Un(function(){return Be(e,void 0,void 0,function(){return Le(this,function(n){return[2,t]})})})}function lve(r){var e=this;return Un(function(){return Be(e,void 0,void 0,function(){var t;return Le(this,function(n){switch(n.label){case 0:return[4,r()];case 1:return t=n.sent(),[2,P0(function(){return t.next()})]}})})})}function fve(r,e){return Be(this,void 0,void 0,function(){return Le(this,function(t){return[2,eve.create(r,e)]})})}function hve(r){return Be(this,void 0,void 0,function(){return Le(this,function(e){return[2,Qde.create(r)]})})}var pve="4.22.0";Hn.CSVDataset=yD;Hn.Dataset=Mu;Hn.FileDataSource=SD;Hn.TextLineDataset=gD;Hn.URLDataSource=ED;Hn.array=Xde;Hn.csv=uve;Hn.func=cve;Hn.generator=lve;Hn.microphone=hve;Hn.version_data=pve;Hn.webcam=fve;Hn.zip=Yde});var ID=Vr((ND,B0)=>{(function(r,e,t){function n(s){var u=this,c=o();u.next=function(){var l=2091639*u.s0+u.c*23283064365386963e-26;return u.s0=u.s1,u.s1=u.s2,u.s2=l-(u.c=l|0)},u.c=1,u.s0=c(" "),u.s1=c(" "),u.s2=c(" "),u.s0-=c(s),u.s0<0&&(u.s0+=1),u.s1-=c(s),u.s1<0&&(u.s1+=1),u.s2-=c(s),u.s2<0&&(u.s2+=1),c=null}function a(s,u){return u.c=s.c,u.s0=s.s0,u.s1=s.s1,u.s2=s.s2,u}function i(s,u){var c=new n(s),l=u&&u.state,f=c.next;return f.int32=function(){return c.next()*4294967296|0},f.double=function(){return f()+(f()*2097152|0)*11102230246251565e-32},f.quick=f,l&&(typeof l=="object"&&a(l,c),f.state=function(){return a(c,{})}),f}function o(){var s=4022871197,u=function(c){c=String(c);for(var l=0;l<c.length;l++){s+=c.charCodeAt(l);var f=.02519603282416938*s;s=f>>>0,f-=s,f*=s,s=f>>>0,f-=s,s+=f*4294967296}return(s>>>0)*23283064365386963e-26};return u}e&&e.exports?e.exports=i:t&&t.amd?t(function(){return i}):this.alea=i})(ND,typeof B0=="object"&&B0,typeof define=="function"&&define)});var AD=Vr((CD,L0)=>{(function(r,e,t){function n(o){var s=this,u="";s.x=0,s.y=0,s.z=0,s.w=0,s.next=function(){var l=s.x^s.x<<11;return s.x=s.y,s.y=s.z,s.z=s.w,s.w^=s.w>>>19^l^l>>>8},o===(o|0)?s.x=o:u+=o;for(var c=0;c<u.length+64;c++)s.x^=u.charCodeAt(c)|0,s.next()}function a(o,s){return s.x=o.x,s.y=o.y,s.z=o.z,s.w=o.w,s}function i(o,s){var u=new n(o),c=s&&s.state,l=function(){return(u.next()>>>0)/4294967296};return l.double=function(){do var f=u.next()>>>11,h=(u.next()>>>0)/4294967296,p=(f+h)/(1<<21);while(p===0);return p},l.int32=u.next,l.quick=l,c&&(typeof c=="object"&&a(c,u),l.state=function(){return a(u,{})}),l}e&&e.exports?e.exports=i:t&&t.amd?t(function(){return i}):this.xor128=i})(CD,typeof L0=="object"&&L0,typeof define=="function"&&define)});var _D=Vr((DD,z0)=>{(function(r,e,t){function n(o){var s=this,u="";s.next=function(){var l=s.x^s.x>>>2;return s.x=s.y,s.y=s.z,s.z=s.w,s.w=s.v,(s.d=s.d+362437|0)+(s.v=s.v^s.v<<4^(l^l<<1))|0},s.x=0,s.y=0,s.z=0,s.w=0,s.v=0,o===(o|0)?s.x=o:u+=o;for(var c=0;c<u.length+64;c++)s.x^=u.charCodeAt(c)|0,c==u.length&&(s.d=s.x<<10^s.x>>>4),s.next()}function a(o,s){return s.x=o.x,s.y=o.y,s.z=o.z,s.w=o.w,s.v=o.v,s.d=o.d,s}function i(o,s){var u=new n(o),c=s&&s.state,l=function(){return(u.next()>>>0)/4294967296};return l.double=function(){do var f=u.next()>>>11,h=(u.next()>>>0)/4294967296,p=(f+h)/(1<<21);while(p===0);return p},l.int32=u.next,l.quick=l,c&&(typeof c=="object"&&a(c,u),l.state=function(){return a(u,{})}),l}e&&e.exports?e.exports=i:t&&t.amd?t(function(){return i}):this.xorwow=i})(DD,typeof z0=="object"&&z0,typeof define=="function"&&define)});var RD=Vr((FD,$0)=>{(function(r,e,t){function n(o){var s=this;s.next=function(){var c=s.x,l=s.i,f,h,p;return f=c[l],f^=f>>>7,h=f^f<<24,f=c[l+1&7],h^=f^f>>>10,f=c[l+3&7],h^=f^f>>>3,f=c[l+4&7],h^=f^f<<7,f=c[l+7&7],f=f^f<<13,h^=f^f<<9,c[l]=h,s.i=l+1&7,h};function u(c,l){var f,h,p=[];if(l===(l|0))h=p[0]=l;else for(l=""+l,f=0;f<l.length;++f)p[f&7]=p[f&7]<<15^l.charCodeAt(f)+p[f+1&7]<<13;for(;p.length<8;)p.push(0);for(f=0;f<8&&p[f]===0;++f);for(f==8?h=p[7]=-1:h=p[f],c.x=p,c.i=0,f=256;f>0;--f)c.next()}u(s,o)}function a(o,s){return s.x=o.x.slice(),s.i=o.i,s}function i(o,s){o==null&&(o=+new Date);var u=new n(o),c=s&&s.state,l=function(){return(u.next()>>>0)/4294967296};return l.double=function(){do var f=u.next()>>>11,h=(u.next()>>>0)/4294967296,p=(f+h)/(1<<21);while(p===0);return p},l.int32=u.next,l.quick=l,c&&(c.x&&a(c,u),l.state=function(){return a(u,{})}),l}e&&e.exports?e.exports=i:t&&t.amd?t(function(){return i}):this.xorshift7=i})(FD,typeof $0=="object"&&$0,typeof define=="function"&&define)});var PD=Vr((OD,W0)=>{(function(r,e,t){function n(o){var s=this;s.next=function(){var c=s.w,l=s.X,f=s.i,h,p;return s.w=c=c+1640531527|0,p=l[f+34&127],h=l[f=f+1&127],p^=p<<13,h^=h<<17,p^=p>>>15,h^=h>>>12,p=l[f]=p^h,s.i=f,p+(c^c>>>16)|0};function u(c,l){var f,h,p,d,m,v=[],g=128;for(l===(l|0)?(h=l,l=null):(l=l+"\0",h=0,g=Math.max(g,l.length)),p=0,d=-32;d<g;++d)l&&(h^=l.charCodeAt((d+32)%l.length)),d===0&&(m=h),h^=h<<10,h^=h>>>15,h^=h<<4,h^=h>>>13,d>=0&&(m=m+1640531527|0,f=v[d&127]^=h+m,p=f==0?p+1:0);for(p>=128&&(v[(l&&l.length||0)&127]=-1),p=127,d=512;d>0;--d)h=v[p+34&127],f=v[p=p+1&127],h^=h<<13,f^=f<<17,h^=h>>>15,f^=f>>>12,v[p]=h^f;c.w=m,c.X=v,c.i=p}u(s,o)}function a(o,s){return s.i=o.i,s.w=o.w,s.X=o.X.slice(),s}function i(o,s){o==null&&(o=+new Date);var u=new n(o),c=s&&s.state,l=function(){return(u.next()>>>0)/4294967296};return l.double=function(){do var f=u.next()>>>11,h=(u.next()>>>0)/4294967296,p=(f+h)/(1<<21);while(p===0);return p},l.int32=u.next,l.quick=l,c&&(c.X&&a(c,u),l.state=function(){return a(u,{})}),l}e&&e.exports?e.exports=i:t&&t.amd?t(function(){return i}):this.xor4096=i})(OD,typeof W0=="object"&&W0,typeof define=="function"&&define)});var BD=Vr((MD,G0)=>{(function(r,e,t){function n(o){var s=this,u="";s.next=function(){var l=s.b,f=s.c,h=s.d,p=s.a;return l=l<<25^l>>>7^f,f=f-h|0,h=h<<24^h>>>8^p,p=p-l|0,s.b=l=l<<20^l>>>12^f,s.c=f=f-h|0,s.d=h<<16^f>>>16^p,s.a=p-l|0},s.a=0,s.b=0,s.c=-1640531527,s.d=1367130551,o===Math.floor(o)?(s.a=o/4294967296|0,s.b=o|0):u+=o;for(var c=0;c<u.length+20;c++)s.b^=u.charCodeAt(c)|0,s.next()}function a(o,s){return s.a=o.a,s.b=o.b,s.c=o.c,s.d=o.d,s}function i(o,s){var u=new n(o),c=s&&s.state,l=function(){return(u.next()>>>0)/4294967296};return l.double=function(){do var f=u.next()>>>11,h=(u.next()>>>0)/4294967296,p=(f+h)/(1<<21);while(p===0);return p},l.int32=u.next,l.quick=l,c&&(typeof c=="object"&&a(c,u),l.state=function(){return a(u,{})}),l}e&&e.exports?e.exports=i:t&&t.amd?t(function(){return i}):this.tychei=i})(MD,typeof G0=="object"&&G0,typeof define=="function"&&define)});var zD=Vr((LD,zp)=>{(function(r,e,t){var n=256,a=6,i=52,o="random",s=t.pow(n,a),u=t.pow(2,i),c=u*2,l=n-1,f;function h(w,b,x){var S=[];b=b==!0?{entropy:!0}:b||{};var T=v(m(b.entropy?[w,y(e)]:w??g(),3),S),N=new p(S),C=function(){for(var R=N.g(a),_=s,P=0;R<u;)R=(R+P)*n,_*=n,P=N.g(1);for(;R>=c;)R/=2,_/=2,P>>>=1;return(R+P)/_};return C.int32=function(){return N.g(4)|0},C.quick=function(){return N.g(4)/4294967296},C.double=C,v(y(N.S),e),(b.pass||x||function(R,_,P,$){return $&&($.S&&d($,N),R.state=function(){return d(N,{})}),P?(t[o]=R,_):R})(C,T,"global"in b?b.global:this==t,b.state)}function p(w){var b,x=w.length,S=this,T=0,N=S.i=S.j=0,C=S.S=[];for(x||(w=[x++]);T<n;)C[T]=T++;for(T=0;T<n;T++)C[T]=C[N=l&N+w[T%x]+(b=C[T])],C[N]=b;(S.g=function(R){for(var _,P=0,$=S.i,z=S.j,L=S.S;R--;)_=L[$=l&$+1],P=P*n+L[l&(L[$]=L[z=l&z+_])+(L[z]=_)];return S.i=$,S.j=z,P})(n)}function d(w,b){return b.i=w.i,b.j=w.j,b.S=w.S.slice(),b}function m(w,b){var x=[],S=typeof w,T;if(b&&S=="object")for(T in w)try{x.push(m(w[T],b-1))}catch{}return x.length?x:S=="string"?w:w+"\0"}function v(w,b){for(var x=w+"",S,T=0;T<x.length;)b[l&T]=l&(S^=b[l&T]*19)+x.charCodeAt(T++);return y(b)}function g(){try{var w;return f&&(w=f.randomBytes)?w=w(n):(w=new Uint8Array(n),(r.crypto||r.msCrypto).getRandomValues(w)),y(w)}catch{var b=r.navigator,x=b&&b.plugins;return[+new Date,r,x,r.screen,y(e)]}}function y(w){return String.fromCharCode.apply(0,w)}if(v(t.random(),e),typeof zp=="object"&&zp.exports){zp.exports=h;try{f=vc("crypto")}catch{}}else typeof define=="function"&&define.amd?define(function(){return h}):t["seed"+o]=h})(typeof self<"u"?self:LD,[],Math)});var WD=Vr((a4e,$D)=>{var dve=ID(),vve=AD(),mve=_D(),gve=RD(),yve=PD(),bve=BD(),Ns=zD();Ns.alea=dve;Ns.xor128=vve;Ns.xorwow=mve;Ns.xorshift7=gve;Ns.xor4096=yve;Ns.tychei=bve;$D.exports=Ns});var u3=Vr(Hp=>{"use strict";var E=Xo(),wve=WD();function xve(r){var e=Object.create(null);return r&&Object.keys(r).forEach(function(t){if(t!=="default"){var n=Object.getOwnPropertyDescriptor(r,t);Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:function(){return r[t]}})}}),e.default=r,e}var kve=xve(wve),U0=function(r,e){return U0=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},U0(r,e)};function Sve(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");U0(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function GD(r,e,t,n){function a(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function s(l){try{c(n.next(l))}catch(f){o(f)}}function u(l){try{c(n.throw(l))}catch(f){o(f)}}function c(l){l.done?i(l.value):a(l.value).then(s,u)}c((n=n.apply(r,e||[])).next())})}function VD(r,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(c){return function(l){return u([c,l])}}function u(c){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,a&&(i=c[0]&2?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[c[0]&2,i.value]),c[0]){case 0:case 1:i=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,a=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){t.label=c[1];break}if(c[0]===6&&t.label<i[1]){t.label=i[1],i=c;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(c);break}i[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(r,t)}catch(l){c=[6,l],a=0}finally{n=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function Lu(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ge(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=n.next()).done;)i.push(a.value)}catch(s){o={error:s}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return i}function na(r,e,t){if(t||arguments.length===2)for(var n=0,a=e.length,i;n<a;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return r.concat(i||Array.prototype.slice.call(e))}function Ue(r,e){Array.isArray(r)||(r=[r]),r.forEach(function(t){t!=null&&E.util.assert(t.dtype!=="complex64",function(){return"".concat(e," does not support complex64 tensors in the CPU backend.")})})}var Eve=E.kernel_impls.whereImpl,K0=(function(r){Sve(e,r);function e(){var t=r.call(this)||this;return t.blockSize=48,t.firstUse=!0,t.data=new E.DataStorage(t,E.engine()),t}return e.prototype.nextDataId=function(){return e.nextDataId++},e.prototype.write=function(t,n,a){this.firstUse&&(this.firstUse=!1,E.env().get("IS_NODE")&&E.backend_util.warn(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));var i={id:this.nextDataId()};return this.data.set(i,{values:t,dtype:a,refCount:1}),i},e.prototype.makeTensorInfo=function(t,n,a){var i;if(n==="string"&&a!=null&&a.length>0&&E.util.isString(a[0])){var o=a.map(function(s){return E.util.encodeString(s)});i=this.write(o,t,n)}else i=this.write(a,t,n);return{dataId:i,shape:t,dtype:n}},e.prototype.refCount=function(t){if(this.data.has(t)){var n=this.data.get(t);return n.refCount}return 0},e.prototype.incRef=function(t){var n=this.data.get(t);n.refCount++},e.prototype.decRef=function(t){if(this.data.has(t)){var n=this.data.get(t);n.refCount--}},e.prototype.move=function(t,n,a,i,o){this.data.set(t,{values:n,dtype:i,refCount:o})},e.prototype.numDataIds=function(){return this.data.numDataIds()},e.prototype.read=function(t){return GD(this,void 0,void 0,function(){return VD(this,function(n){return[2,this.readSync(t)]})})},e.prototype.readSync=function(t){var n=this.data.get(t),a=n.dtype,i=n.complexTensorInfos;if(a==="complex64"){var o=this.readSync(i.real.dataId),s=this.readSync(i.imag.dataId);return E.backend_util.mergeRealAndImagArrays(o,s)}return E.util.convertBackendValuesAndArrayBuffer(this.data.get(t).values,a)},e.prototype.bufferSync=function(t){var n=this.readSync(t.dataId);if(t.dtype==="string")try{var a=n.map(function(i){return E.util.decodeString(i)});return E.buffer(t.shape,t.dtype,a)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return E.buffer(t.shape,t.dtype,n)},e.prototype.makeOutput=function(t,n,a){return E.engine().makeTensorFromTensorInfo(this.makeTensorInfo(n,a,t),this)},e.prototype.disposeData=function(t,n){if(n===void 0&&(n=!1),this.data.has(t)){if(this.data.get(t).refCount--,!n&&this.data.get(t).refCount>0)return!1;var a=this.data.get(t).complexTensorInfos;a!=null&&(this.disposeData(a.real.dataId,!0),this.disposeData(a.imag.dataId,!0)),this.data.delete(t)}return!0},e.prototype.disposeIntermediateTensorInfo=function(t){this.disposeData(t.dataId)},e.prototype.time=function(t){return GD(this,void 0,void 0,function(){var n,a;return VD(this,function(i){return n=E.util.now(),t(),a=E.util.now()-n,[2,{kernelMs:a}]})})},e.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},e.prototype.where=function(t){Ue([t],"where");var n=this.readSync(t.dataId);return Eve(t.shape,n)},e.prototype.dispose=function(){},e.prototype.floatPrecision=function(){return 32},e.prototype.epsilon=function(){return r.prototype.epsilon.call(this)},e})(E.KernelBackend);K0.nextDataId=0;function JD(r){for(var e=new Float32Array(r.length),t=0;t<r.length;++t)e[t]=Math.abs(r[t]);return e}var Tve=function(r){var e=r.inputs.x,t=r.backend;Ue(e,"abs");var n=new Float32Array(E.util.sizeFromShape(e.shape)),a=t.data.get(e.dataId).values;return n=JD(a),t.makeOutput(n,e.shape,e.dtype)},Nve={kernelName:E.Abs,backendName:"cpu",kernelFunc:Tve};function br(r){return function(e,t,n,a,i){var o=E.backend_util.assertAndGetBroadcastShape(e,t),s=o.length,u=E.util.computeStrides(o),c=E.util.sizeFromShape(o),l=E.util.getTypedArrayFromDType(i,c),f=e.length,h=t.length,p=E.util.computeStrides(e),d=E.util.computeStrides(t),m=E.backend_util.getBroadcastDims(e,o),v=E.backend_util.getBroadcastDims(t,o);if(m.length+v.length===0)for(var g=0;g<l.length;++g)l[g]=r(n[g%n.length],a[g%a.length]);else for(var y=function(w){var b=E.util.indexToLoc(w,s,u),x=b.slice(-f);m.forEach(function(C){return x[C]=0});var S=E.util.locToIndex(x,f,p),T=b.slice(-h);v.forEach(function(C){return T[C]=0});var N=E.util.locToIndex(T,h,d);l[w]=r(n[S],a[N])},g=0;g<l.length;++g)y(g);return[l,o]}}function qn(r){var e=r.inputs,t=r.backend,n=e.real,a=e.imag,i=t.data.get(n.dataId).values,o=t.data.get(a.dataId).values,s=t.makeTensorInfo(n.shape,"complex64"),u=t.data.get(s.dataId);return u.complexTensorInfos={real:t.makeTensorInfo(n.shape,"float32",i),imag:t.makeTensorInfo(a.shape,"float32",o)},s}var Ive={kernelName:E.Complex,backendName:"cpu",kernelFunc:qn};function $p(r,e,t){if(t===void 0&&(t="float32"),t==="complex64"){var n=$p(r,e,"float32"),a=$p(r,e,"float32");return qn({inputs:{real:n,imag:a},backend:r})}var i=E.util.makeZerosTypedArray(E.util.sizeFromShape(e),t);return r.makeTensorInfo(e,t,i)}function mi(r){var e=r.inputs,t=r.backend,n=e.x;return t.incRef(n.dataId),{dataId:n.dataId,shape:n.shape,dtype:n.dtype}}var Cve={kernelName:E.Identity,backendName:"cpu",kernelFunc:mi};function Cs(r){var e=r.inputs,t=r.backend,n=e.input,a=t.data.get(n.dataId).complexTensorInfos.real,i=t.data.get(a.dataId).values;return t.makeTensorInfo(a.shape,a.dtype,i)}var Ave={kernelName:E.Real,backendName:"cpu",kernelFunc:Cs};function QD(r,e,t,n){if(n==="int32"){var a=Int32Array.from(r);return[e,"int32",a]}if(n==="bool"){var i=E.util.toTypedArray([0],t),o=Ge(br(function(c,l){return c!==l?1:0})(e,[],r,i,"bool"),2),s=o[0],u=o[1];return[u,"bool",s]}throw new Error("Error in Cast: failed to cast ".concat(t," to ").concat(n))}function So(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.dtype;if(i==="complex64"){if(a.dtype==="complex64")return mi({inputs:{x:a},backend:t});var o=$p(t,a.shape,a.dtype),s=So({inputs:{x:a},backend:t,attrs:{dtype:"float32"}}),u=qn({inputs:{real:s,imag:o},backend:t});return t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(s),u}if(a.dtype==="complex64"){var c=Cs({inputs:{input:a},backend:t}),u=So({inputs:{x:c},backend:t,attrs:{dtype:i}});return t.disposeIntermediateTensorInfo(c),u}if(!E.util.hasEncodingLoss(a.dtype,i)){var u=mi({inputs:{x:a},backend:t});return{dataId:u.dataId,shape:u.shape,dtype:i}}var l=t.data.get(a.dataId).values,f=Ge(QD(l,a.shape,a.dtype,i),3),h=f[0],p=f[1],d=f[2];return t.makeTensorInfo(h,p,d)}var Dve={kernelName:E.Cast,backendName:"cpu",kernelFunc:So};function Rr(r,e,t,n){return t==null?function(a){var i=a.inputs,o=a.backend,s=i.a,u=i.b,c=o;Ue([s,u],r);var l=c.data.get(s.dataId).values,f=c.data.get(u.dataId).values,h=s.dtype==="string"?E.backend_util.fromUint8ToStringArray(l):l,p=s.dtype==="string"?E.backend_util.fromUint8ToStringArray(f):f,d=n||s.dtype,m=Ge(e(s.shape,u.shape,h,p,d),2),v=m[0],g=m[1];return c.makeTensorInfo(g,d,v)}:function(a){var i=a.inputs,o=a.backend,s=i.a,u=i.b,c=o;if(s.dtype==="complex64"||u.dtype==="complex64"){var l=So({inputs:{x:s},backend:c,attrs:{dtype:"complex64"}}),f=c.data.get(l.dataId),h=f.complexTensorInfos.real,p=f.complexTensorInfos.imag,d=c.data.get(h.dataId).values,m=c.data.get(p.dataId).values,v=So({inputs:{x:u},backend:c,attrs:{dtype:"complex64"}}),g=c.data.get(v.dataId),y=g.complexTensorInfos.real,w=g.complexTensorInfos.imag,b=c.data.get(y.dataId).values,x=c.data.get(w.dataId).values,S=Ge(t(s.shape,u.shape,d,m,b,x),3),T=S[0],N=S[1],C=S[2],R=c.makeTensorInfo(C,"float32",T),_=c.makeTensorInfo(C,"float32",N),P=qn({inputs:{real:R,imag:_},backend:c});return c.disposeIntermediateTensorInfo(l),c.disposeIntermediateTensorInfo(v),c.disposeIntermediateTensorInfo(R),c.disposeIntermediateTensorInfo(_),P}else{var $=c.data.get(s.dataId).values,z=c.data.get(u.dataId).values,L=n||s.dtype,B=Ge(e(s.shape,u.shape,$,z,L),2),G=B[0],C=B[1];return c.makeTensorInfo(C,L,G)}}}function j0(r){return function(e,t,n,a,i,o){var s=E.backend_util.assertAndGetBroadcastShape(e,t),u=E.util.sizeFromShape(s),c=s.length,l=E.util.computeStrides(s),f=E.util.getTypedArrayFromDType("float32",u),h=E.util.getTypedArrayFromDType("float32",u),p=E.backend_util.getBroadcastDims(e,s),d=E.backend_util.getBroadcastDims(t,s),m=E.backend_util.mergeRealAndImagArrays(n,a),v=E.backend_util.mergeRealAndImagArrays(i,o),g=e.length,y=E.util.computeStrides(e),w=t.length,b=E.util.computeStrides(t);if(p.length+d.length===0)for(var x=0;x<f.length;x++){var S=x%m.length,T=x%v.length,N=r(m[S*2],m[S*2+1],v[T*2],v[T*2+1]);f[x]=N.real,h[x]=N.imag}else for(var C=function(R){var _=E.util.indexToLoc(R,c,l),P=_.slice(-g);p.forEach(function(G){return P[G]=0});var $=E.util.locToIndex(P,g,y),z=_.slice(-w);d.forEach(function(G){return z[G]=0});var L=E.util.locToIndex(z,w,b),B=r(m[$*2],m[$*2+1],v[L*2],v[L*2+1]);f[R]=B.real,h[R]=B.imag},x=0;x<f.length;x++)C(x);return[f,h,s]}}var e_=br((function(r,e){return r+e})),_ve=j0((function(r,e,t,n){return{real:r+t,imag:e+n}})),zu=Rr(E.Add,e_,_ve),Fve={kernelName:E.Add,backendName:"cpu",kernelFunc:zu};function X0(r,e,t,n,a){for(var i=E.util.sizeFromShape(n),o=E.util.makeZerosTypedArray(a,t),s=0;s<r.length;s++){var u=r[s];if(u<0)throw new Error("Input x must be non-negative!");u>=a||(i>0?o[u]+=e[s]:o[u]+=1)}return o}function t_(r,e,t,n){n===void 0&&(n=!1);for(var a=r.shape[0],i=r.shape[1],o=E.buffer([a,t],e.dtype),s=0;s<a;s++)for(var u=0;u<i;u++){var c=r.get(s,u);if(c<0)throw new Error("Input x must be non-negative!");c>=t||(n?o.set(1,s,c):e.size>0?o.set(o.get(s,c)+e.get(s,u),s,c):o.set(o.get(s,c)+1,s,c))}return o}var r_=br((function(r,e){return r&e})),Rve=Rr(E.BitwiseAnd,r_),Ove={kernelName:E.BitwiseAnd,backendName:"cpu",kernelFunc:Rve};function gi(r){return function(e,t,n){for(var a=E.util.getArrayFromDType(t,e.length),i=0;i<e.length;++i)a[i]=r(e[i],n);return a}}function At(r,e,t){var n=gi(e);return Eo(r,n,t)}function Eo(r,e,t){return function(n){var a=n.inputs,i=n.attrs,o=n.backend,s=a.x;Ue(s,r);var u=o,c=u.data.get(s.dataId).values,l;if(s.dtype==="string"){if(!Array.isArray(c))throw new Error("String tensor's value was not an instance of Array");l=E.backend_util.fromUint8ToStringArray(c)}else l=c;var f=t||s.dtype,h=e(l,f,i);return u.makeTensorInfo(s.shape,f,h)}}var n_=gi(function(r){return Math.ceil(r)}),Pve=Eo(E.Ceil,n_),Mve={kernelName:E.Ceil,backendName:"cpu",kernelFunc:Pve};function a_(r,e,t,n){var a=E.util.getArrayFromDType(t,E.util.sizeFromShape(e));if(n&&t!=="string"){var i=0;r.forEach(function(s){var u=E.util.sizeFromShape(s.shape);a.set(s.vals,i),i+=u})}else{var o=0;r.forEach(function(s){for(var u=t==="string"?E.backend_util.fromUint8ToStringArray(s.vals):s.vals,c=0,l=0;l<s.shape[0];++l)for(var f=l*e[1]+o,h=0;h<s.shape[1];++h)a[f+h]=u[c++];o+=s.shape[1]})}return a}var i_=br(function(r,e){return r===e?1:0}),o_=Rr(E.Equal,i_,null,"bool"),Bve={kernelName:E.Equal,backendName:"cpu",kernelFunc:o_};var s_=gi(function(r){return Math.exp(r)}),u_=Eo(E.Exp,s_,"float32"),Lve={kernelName:E.Exp,backendName:"cpu",kernelFunc:u_};var c_=gi(function(r){return Math.expm1(r)}),zve=Eo(E.Expm1,c_),$ve={kernelName:E.Expm1,backendName:"cpu",kernelFunc:zve};var l_=gi(function(r){return Math.floor(r)}),Wve=Eo(E.Floor,l_),Gve={kernelName:E.Floor,backendName:"cpu",kernelFunc:Wve};var f_=br(function(r,e){return Math.floor(r/e)}),Vve=Rr(E.FloorDiv,f_,null,"int32"),Uve={kernelName:E.FloorDiv,backendName:"cpu",kernelFunc:Vve};function h_(r,e,t,n,a,i,o,s,u){for(var c=E.buffer([n,i],t),l=0;l<n;l++){for(var f=[],h=0,p=0;p<a;p++){var d=r[l*a+p];h+=d*o[p],f.push(d)}if(h<0||h>=u/i)throw new Error("Invalid indices: ".concat(f," does not index into ").concat(s));for(var m=0;m<i;m++)c.values[l*i+m]=e.get.apply(e,na([],Ge(e.indexToLoc(h*i+m)),!1))}return c}function p_(r,e,t){for(var n=E.buffer(t,r.dtype),a=0;a<n.size;++a){var i=n.indexToLoc(a),o=i.slice(),s=o[0],u=o[2],c=e.locToIndex([s,u]);o[2]=e.values[c];var l=r.locToIndex(o);0<=l&&l<r.values.length&&(n.values[a]=r.values[l])}return n}var d_=br(function(r,e){return r>e?1:0}),Hve=Rr(E.Greater,d_,null,"bool"),qve={kernelName:E.Greater,backendName:"cpu",kernelFunc:Hve};var v_=br(function(r,e){return r>=e?1:0}),Kve=Rr(E.GreaterEqual,v_,null,"bool"),jve={kernelName:E.GreaterEqual,backendName:"cpu",kernelFunc:Kve};var m_=br(function(r,e){return r<e?1:0}),Xve=Rr(E.Less,m_,null,"bool"),Yve={kernelName:E.Less,backendName:"cpu",kernelFunc:Xve};var g_=br(function(r,e){return r<=e?1:0}),Zve=Rr(E.LessEqual,g_,null,"bool"),Jve={kernelName:E.LessEqual,backendName:"cpu",kernelFunc:Zve};function y_(r,e,t){var n=(e-r)/(t-1),a=E.util.makeZerosTypedArray(t,"float32");a[0]=r;for(var i=1;i<a.length;i++)a[i]=a[i-1]+n;return a}var b_=gi(function(r){return Math.log(r)}),Qve=Eo(E.Log,b_),eme={kernelName:E.Log,backendName:"cpu",kernelFunc:Qve};function w_(r,e,t,n){for(var a=E.util.getTypedArrayFromDType(n,E.util.sizeFromShape(t)),i=0;i<a.length;++i){for(var o=i*e,s=r[o],u=0;u<e;++u){var c=r[o+u];(Number.isNaN(c)||c>s)&&(s=c)}a[i]=s}return a}var x_=br((function(r,e){return Math.max(r,e)})),tme=Rr(E.Maximum,x_),rme={kernelName:E.Maximum,backendName:"cpu",kernelFunc:tme};var k_=br((function(r,e){return Math.min(r,e)})),nme=Rr(E.Minimum,k_),ame={kernelName:E.Minimum,backendName:"cpu",kernelFunc:nme};var Y0=br((function(r,e){return r*e})),ime=j0((function(r,e,t,n){return{real:r*t-e*n,imag:r*n+e*t}})),Up=Rr(E.Multiply,Y0,ime),ome={kernelName:E.Multiply,backendName:"cpu",kernelFunc:Up};function S_(r,e,t){var n=E.util.createScalarValue(-1,t);return Y0([],e,n,r,t)}function sme(r){var e=r.inputs,t=r.backend,n=e.x;Ue(n,"neg");var a=t.data.get(n.dataId).values,i=Ge(S_(a,n.shape,n.dtype),2),o=i[0],s=i[1];return t.makeTensorInfo(s,n.dtype,o)}var ume={kernelName:E.Neg,backendName:"cpu",kernelFunc:sme};var E_=br((function(r,e){return r!==e?1:0})),cme=Rr(E.NotEqual,E_,null,"bool"),lme={kernelName:E.NotEqual,backendName:"cpu",kernelFunc:cme};function Z0(r,e,t,n,a){for(var i=e.length,o=E.util.sizeFromShape(e),s=E.util.computeStrides(e),u=E.util.computeStrides(a),c=E.util.getTypedArrayFromDType(t,E.util.sizeFromShape(a)),l=0;l<o;++l){for(var f=E.util.indexToLoc(l,i,s),h=new Array(f.length),p=0;p<h.length;p++)h[p]=f[n[p]];var d=E.util.locToIndex(h,i,u);c[d]=r[l]}return c}function xn(r){var e=r.inputs,t=r.attrs,n=r.backend,a=e.x,i=t.perm;Ue(a,"transpose");for(var o=a.shape.length,s=new Array(o),u=0;u<s.length;u++)s[u]=a.shape[i[u]];var c=n.data.get(a.dataId).values,l=Z0(c,a.shape,a.dtype,i,s),f=n.write(l,s,a.dtype);return{dataId:f,shape:s,dtype:a.dtype}}var fme={kernelName:E.Transpose,backendName:"cpu",kernelFunc:xn};function T_(r,e,t,n){for(var a=Ge(E.backend_util.computeOutAndReduceShapes(r,n),2),i=a[0],o=a[1],s=E.upcastType(e,"int32"),u=E.util.makeZerosTypedArray(E.util.sizeFromShape(i),s),c=E.util.sizeFromShape(o),l=0;l<u.length;++l){for(var f=l*c,h=1,p=0;p<c;++p)h*=t[f+p];u[l]=h}return{outVals:u,outShape:i,outDtype:s}}function hme(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims;Ue(a,"prod");var s=a.shape.length,u=E.util.parseAxisParam(i,a.shape),c=E.backend_util.getAxesPermutation(u,s),l=u,f=a,h=[];c!=null&&(f=xn({inputs:{x:a},backend:t,attrs:{perm:c}}),h.push(f),l=E.backend_util.getInnerMostAxes(l.length,s));var p=t.data.get(f.dataId).values,d=T_(f.shape,f.dtype,p,l),m=d.outVals,v=d.outShape,g=d.outDtype,y=v;return o&&(y=E.backend_util.expandShapeToKeepDim(v,u)),h.forEach(function(w){return t.disposeIntermediateTensorInfo(w)}),t.makeTensorInfo(y,g,m)}var pme={kernelName:E.Prod,backendName:"cpu",kernelFunc:hme};function dme(r,e,t){r.forEach(function(n,a){if(n<0||n>=t){var i=E.util.indexToLoc(a,e.length,E.util.computeStrides(e)).join(",");throw new Error("indices[".concat(i,"] = ").concat(n," is not in [0, ").concat(t,")"))}})}function vme(r,e){for(var t=0;t<r.length;++t){var n=r[t],a=t===r.length-1?e:r[t+1].length;if(n.length===0)throw new Error("Ragged splits may not be empty");if(n[0]<0)throw new Error("Ragged splits must be non-negative");if(n[n.length-1]>a)throw new Error("Ragged splits must not point past values");for(var i=1;i<n.length;++i)if(n[i-1]>n[i])throw new Error("Ragged splits must be sorted in ascending order")}}function mme(r,e,t,n){var a=[],i=0,o=e.length-1+t.length,s=new Array(o).fill(null).map(function(){return[0]});vme(t,n);for(var u=1,c=0;c<e.length-1;++c){u*=e[c];for(var l=e[c+1],f=1;f<u+1;++f)s[c].push(f*l)}for(var f=0;f<r.length;++f){for(var h=r[f],p=r[f]+1,c=0;c<t.length;++c){var d=t[c],m=c+e.length-1;if(m>=0)for(var v=s[m],g=v[v.length-1]-d[h],y=h;y<p;++y)s[m].push(d[y+1]+g);h=d[h],p=d[p]}p!==h&&(a.push([h,p]),i+=p-h)}return{outSplits:s,valueSlices:a,numValues:i}}function gme(r){for(var e=[],t=function(a){var i=r[a].length,o=E.util.getArrayFromDType("int32",i);e.push(o),r[a].forEach(function(s,u){return o[u]=s})},n=0;n<r.length;++n)t(n);return e}function UD(r,e){for(var t=r.slice(0,e);t.length<e;)t.push(1);for(var n=e;n<r.length;n++)t[e-1]*=r[n];return t}function yme(r,e,t,n,a,i){var o,s,u=UD(e,2)[1],c=UD(i,2)[1],l=0;try{for(var f=Lu(t),h=f.next();!h.done;h=f.next())for(var p=h.value,d=p[0];d<p[1];++d){for(var m=0;m<n;++m)a[l*c+m]=r[d*u+m];++l}}catch(v){o={error:v}}finally{try{h&&!h.done&&(s=f.return)&&s.call(f)}finally{if(o)throw o.error}}}function bme(r,e,t,n,a){var i=e.slice();i[0]=a;var o=E.util.getArrayFromDType(t,E.util.sizeFromShape(i)),s=r.length,u=s===0?0:s/e[0];return yme(r,e,n,u,o,i),[o,i]}function N_(r,e,t,n,a,i,o,s){if(r.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");var u=e[0][0]-1;if(dme(i,o,u),n.length===0)throw new Error("params.rank must be nonzero");var c=n[0],l=mme(i,o,r,c),f=l.outSplits,h=l.valueSlices,p=l.numValues,d=gme(f),m=bme(t,n,a,h,p);return[d,m[0],m[1]]}var HD=2147483647;function I_(r,e,t,n,a,i,o){if(e.length>1)throw new Error("starts must be a scalar or vector");if(a.length>1)throw new Error("limits must be a scalar or vector");if(o.length>1)throw new Error("deltas must be a scalar or vector");var s=e.length===0,u=a.length===0,c=o.length===0,l=[];s||l.push(e[0]),u||l.push(a[0]),c||l.push(o[0]);for(var f=1;f<l.length;++f)if(l[f]!==l[f-1])throw new Error("starts, limits, and deltas must have the same shape");var h=l.length===0?1:l[0],p=E.util.getArrayFromDType("int32",h+1);p[0]=0;for(var d=0;d<h;++d){var m=s?r[0]:r[d],v=u?n[0]:n[d],g=c?i[0]:i[d];if(g===0)throw new Error("Requires delta != 0");var y=void 0;if(g>0&&v<m||g<0&&v>m)y=0;else if(y=Math.ceil(Math.abs((v-m)/g)),y>HD)throw new Error("Requires ((limit - start) / delta) <= ".concat(HD));p[d+1]=p[d]+y}for(var w=p[h],b=E.util.getArrayFromDType(t,w),x=0,d=0;d<h;++d)for(var S=p[d+1]-p[d],T=s?r[0]:r[d],g=c?i[0]:i[d],f=0;f<S;++f)b[x++]=T,T+=g;return[p,b]}var Fa=E.backend_util.RowPartitionType,wme=(function(){function r(e,t,n,a,i,o,s,u,c,l){this.shape=e,this.shapeShape=t,this.values=n,this.valuesShape=a,this.valuesDType=i,this.defaultValue=o,this.defaultValueShape=s,this.rowPartitionValues=u,this.rowPartitionValuesShapes=c,this.rowPartitionTypes=E.backend_util.getRowPartitionTypesHelper(l),this.raggedRank=E.backend_util.getRaggedRank(this.rowPartitionTypes)}return r.prototype.getRowPartitionTypeByDimension=function(e){return this.rowPartitionTypes[0]===Fa.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]},r.prototype.getRowPartitionTensor=function(e){return this.rowPartitionTypes[0]===Fa.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]},r.prototype.getMaxWidth=function(e){var t=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case Fa.VALUE_ROWIDS:return r.getMaxWidthValueRowID(t);case Fa.ROW_SPLITS:return r.getMaxWidthRowSplit(t);default:throw new Error("Cannot handle partition type ".concat(Fa[this.getRowPartitionTypeByDimension(e-1)]))}},r.getMaxWidthRowSplit=function(e){var t=e.length;if(t===0||t===1)return 0;for(var n=0,a=0;a<t-1;++a){var i=e[a+1]-e[a];i>n&&(n=i)}return n},r.getMaxWidthValueRowID=function(e){var t=e.length;if(t===0)return 0;for(var n=0,a=e[0],i=0,o=1;o<t;++o){var s=e[o];s!==a&&(a=s,i=Math.max(o-n,i),n=o)}return Math.max(t-n,i)},r.prototype.tensorShapeFromTensor=function(e,t,n){if(n===void 0&&(n=!0),t.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return KD(e,n)},r.prototype.calculateOutputSize=function(e){var t=this.valuesShape,n=this.defaultValueShape;E.backend_util.validateDefaultValueShape(n,t);var a=this.tensorShapeFromTensor(this.shape,this.shapeShape),i=E.backend_util.combineRaggedTensorToTensorShapes(this.raggedRank,a,t),o=i;o[0]<0&&(o[0]=e);for(var s=1;s<=this.raggedRank;++s)o[s]<0&&(o[s]=this.getMaxWidth(s));return o},r.prototype.calculateFirstParentOutputIndex=function(e,t,n){for(var a=Math.min(e,n),i=[],o=0,s=0;s<a;++s,o+=t)i.push(o);for(var s=a;s<e;++s)i.push(-1);return E.util.assert(i.length===e,function(){return"Final length of result must be equal to firstDimension."}),i},r.prototype.calculateOutputIndexRowSplit=function(e,t,n,a){for(var i=e.length,o=[],s=0;s<i-1;++s){var u=e[s+1]-e[s],c=Math.min(a,u),l=t[s];l===-1&&(c=0);for(var f=0;f<c;++f)o.push(l),l+=n;for(var f=0;f<u-c;++f)o.push(-1)}if(i>0&&o.length!==e[i-1])throw new Error("Invalid row split size.");return o},r.prototype.calculateOutputIndexValueRowID=function(e,t,n,a){var i=e.length,o=[];if(i===0)return[];var s=0,u=e[0];if(u>=t.length)throw new Error("Got currentValueRowId=".concat(u,", which is not less than ").concat(t.length));var c=t[u];o.push(c);for(var l=1;l<i;++l){var f=e[l];if(f===u)c>=0&&(++s,s<a?c+=n:c=-1);else{if(s=0,u=f,f>=t.length)throw new Error("Got nextValueRowId=".concat(f," which is not less than ").concat(t.length));c=t[f]}o.push(c)}if(o.length!==e.length)throw new Error("Invalid row ids.");return o},r.prototype.calculateOutputIndex=function(e,t,n,a){var i=this.getRowPartitionTensor(e),o=this.getRowPartitionTypeByDimension(e);switch(o){case Fa.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(i,t,n,a);case Fa.ROW_SPLITS:if(i.length-1>t.length)throw new Error("Row partition size is greater than output size: ".concat(i.length-1," > ").concat(t.length));return this.calculateOutputIndexRowSplit(i,t,n,a);default:throw new Error("Unsupported partition type: ".concat(Fa[o]))}},r.prototype.getFirstDimensionSize=function(){var e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");var t=this.rowPartitionTypes[0];switch(t){case Fa.FIRST_DIM_SIZE:return e[0];case Fa.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case Fa.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error("Cannot handle type ".concat(Fa[t]))}},r.prototype.compute=function(){var e=this.rowPartitionValues[0];if(e.length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");var t=this.getFirstDimensionSize(),n=this.calculateOutputSize(t),a=new Array(this.raggedRank+1);a[a.length-1]=1;for(var i=a.length-2;i>=0;--i)a[i]=a[i+1]*n[i+1];var o=KD(n,!1),s=E.util.getArrayFromDType(this.valuesDType,E.util.sizeFromShape(o)),u=a[0]*n[0];if(u>0){for(var c=this.calculateFirstParentOutputIndex(t,a[0],n[0]),i=1;i<=this.raggedRank;++i){var l=this.calculateOutputIndex(i-1,c,a[i],n[i]);c=l}this.setOutput(this.raggedRank,c,s,o)}return[o,s]},r.prototype.setOutput=function(e,t,n,a){if(n.length!==0){var i=this.values,o=n,s=a.slice();s=s.slice(e+1);var u=E.util.sizeFromShape(s),c=t.length,l=this.defaultValue;if(l.length!==u&&l.length!==1){var f=this.defaultValueShape;E.tidy(function(){var x=E.reshape(l,f),S=E.broadcastTo(x,s);l=S.dataSync()})}for(var h=0,p=0,d=0,m=0;m<=c;++m){var v=m<c?t[m]:-1;if(v===d){++d;continue}if(p<d){var g=i.subarray(h*u),y=o.subarray(p*u),w=(d-p)*u;qD(y,g,w)}if(m>=c){var b=n.length;v=Math.floor(b/u)}if(v>d)if(this.defaultValue.length===1)o.subarray(d*u,v*u).fill(this.defaultValue[0]),d=v;else for(;v>d;){var y=o.slice(d*u);qD(y,l,u),++d}v<0?(h=m+1,p=d):(h=m,p=d,d=p+1)}}},r})();function qD(r,e,t){for(var n=0;n<t;n++)r[n]=e[n]}function KD(r,e){var t,n,a=[];try{for(var i=Lu(r),o=i.next();!o.done;o=i.next()){var s=o.value;if(s<0){if(!e)throw new Error("Dimension ".concat(s," must be >= 0"));if(s<-1)throw new Error("Dimension ".concat(s," must be >= -1"));s=-1}a.push(s)}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return a}function C_(r,e,t,n,a,i,o,s,u,c){return new wme(r,e,t,n,a,i,o,s,u,c).compute()}function A_(r,e,t,n){var a=r===e,i=r<e&&t<0,o=e<r&&t>1;if(a||i||o)return E.util.makeZerosTypedArray(0,n);var s=Math.abs(Math.ceil((e-r)/t)),u=E.util.makeZerosTypedArray(s,n);e<r&&t===1&&(t=-1),u[0]=r;for(var c=1;c<u.length;c++)u[c]=u[c-1]+t;return u}var D_=gi(function(r){return 1/Math.sqrt(r)}),xme=Eo(E.Rsqrt,D_),kme={kernelName:E.Rsqrt,backendName:"cpu",kernelFunc:xme};function Is(r,e,t,n,a,i,o,s,u,c){var l=[n/a,a],f=r.values,h=e.values;if(n===0)return E.buffer(t,e.dtype);var p=u instanceof E.TensorBuffer?u:E.buffer(l,e.dtype);typeof u=="string"||typeof u=="number"?p.values.fill(u):typeof u=="boolean"&&p.values.fill(+u);for(var d=0;d<i;d++){for(var m=[],v=0,g=0;g<o;g++){var y=f[d*o+g];m.push(y),v+=y*s[g]}if(v<0||v>=n/a)throw new Error("Invalid indices: ".concat(m," does not index into ").concat(t));for(var w=0;w<a;w++)c?p.values[v*a+w]+=h[d*a+w]:p.values[v*a+w]=e.rank===0?h[0]:h[d*a+w]}return p}var Sme=gi(function(r){return 1/(1+Math.exp(-r))}),__=At(E.Sigmoid,function(r){return 1/(1+Math.exp(-r))}),Eme={kernelName:E.Sigmoid,backendName:"cpu",kernelFunc:__};function F_(r,e,t,n,a){var i=E.slice_util.isSliceContinous(n,e,t),o=E.util.sizeFromShape(t),s=E.util.computeStrides(n);if(i){var u=E.slice_util.computeFlatOffset(e,s);return a==="string"?r.slice(u,u+o):r.subarray(u,u+o)}for(var c=a==="string"?E.backend_util.fromUint8ToStringArray(r):r,l=E.buffer(n,a,c),f=E.buffer(t,a),h=0;h<f.size;++h){var p=f.indexToLoc(h),d=p.map(function(m,v){return m+e[v]});f.set.apply(f,na([l.get.apply(l,na([],Ge(d),!1))],Ge(p),!1))}return a==="string"?E.backend_util.fromStringArrayToUint8(f.values):f.values}function As(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.begin,o=n.size;Ue(a,"slice");var s=Ge(E.slice_util.parseSliceParams(a,i,o),2),u=s[0],c=s[1];E.slice_util.assertParamsValid(a,u,c);var l=t.data.get(a.dataId).values,f=F_(l,u,c,a.shape,a.dtype);return t.makeTensorInfo(c,a.dtype,f)}var Tme={kernelName:E.Slice,backendName:"cpu",kernelFunc:As};function R_(r,e,t,n,a,i,o){var s=e[0],u=i[0],c=new Array(u),l=new Array(s),f=e[1];if(u===0){if(s!==0)throw new Error(E.backend_util.getSparseFillEmptyRowsIndicesDenseShapeMismatch(s));var h=E.util.getArrayFromDType(t,0),p=E.util.getArrayFromDType(a,0);return[h,[0,f],p,c,l]}for(var d=!0,m=0,v=new Array(u).fill(0),g=0;g<s;++g){var y=r[g*f];if(y<0)throw new Error(E.backend_util.getSparseFillEmptyRowsNegativeIndexErrorMessage(g,y));if(y>=u)throw new Error(E.backend_util.getSparseFillEmptyRowsOutOfRangeIndexErrorMessage(g,y,u));++v[y],d=d&&y>=m,m=y}for(var w=!0,y=0;y<u;++y){var b=v[y]===0;c[y]=b,w=w&&!b,v[y]=Math.max(v[y],1),y>0&&(v[y]+=v[y-1])}if(w&&d){for(var h=r,p=n,g=0;g<s;++g)l[g]=g;return[h,[s,f],p,c,l]}else{for(var x=v[u-1],h=E.util.getArrayFromDType(t,x*f),p=E.util.getArrayFromDType(a,x),S=new Array(u).fill(0),g=0;g<s;++g){var y=r[g*f],T=S[y],N=(y===0?0:v[y-1])+T;S[y]++;for(var C=0;C<f;++C)h[N*f+C]=r[g*f+C];p[N]=n[g],l[g]=N}for(var y=0;y<u;++y){var R=S[y];if(R===0){var _=y===0?0:v[y-1];h[_*f+0]=y;for(var P=1;P<f;++P)h[_*f+P]=0;p[_]=o}}return[h,[x,f],p,c,l]}}function O_(r,e,t,n,a){for(var i=E.util.sizeFromShape(n),o=e[0],s=a.length,u=[],c=1,l=-1,f=0;f<s;++f){var h=a[f];if(h===-1){if(l!==-1)throw new Error(E.backend_util.getSparseReshapeMultipleNegativeOneOutputDimErrorMessage(l,f));l=f,u.push(1)}else{if(h<0)throw new Error(E.backend_util.getSparseReshapeNegativeOutputDimErrorMessage(f,h));c*=h,u.push(h)}}if(l!==-1){if(c<=0)throw new Error(E.backend_util.getSparseReshapeEmptyTensorZeroOutputDimErrorMessage());var p=Math.trunc(i/c);if(c*p!==i)throw new Error(E.backend_util.getSparseReshapeInputOutputMultipleErrorMessage(n,u));u[l]=p}var d=E.util.sizeFromShape(u);if(d!==i)throw new Error(E.backend_util.getSparseReshapeInputOutputMismatchErrorMessage(n,u));var m=n.length,v=[];if(m>0){v[m-1]=1;for(var f=m-2;f>=0;--f)v[f]=v[f+1]*n[f+1]}var g=[];if(s>0){g[s-1]=1;for(var f=s-2;f>=0;--f)g[f]=g[f+1]*u[f+1]}for(var y=E.util.getArrayFromDType(t,o*s),w=0;w<o;++w){for(var b=0,x=0;x<m;++x)b+=r[w*m+x]*v[x];for(var x=0;x<s;++x)y[w*s+x]=Math.trunc(b/g[x]),b%=g[x]}return[y,[o,s],u]}function J0(r,e,t,n,a,i,o){i===void 0&&(i=!1),o===void 0&&(o=0);var s=n.length,u=[e[0],r.length/e[0]],c=u[1],l=s>0?a[s-1]+1:0,f=l;if(f<0)throw new Error(E.backend_util.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());var h=e.slice();h[0]=f;var p=h.reduce(function(T,N){return T*N},1),d=E.util.getArrayFromDType(t,p);if(s===0)return f>0&&d.fill(o),[d,h];if(f<=0)throw new Error(E.backend_util.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());for(var m=0,v=1,g=0,y=a[m];;){var w=0;if(v<s){if(w=a[v],y===w){++v;continue}if(y>=w)throw new Error(E.backend_util.getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage())}if(y<0||y>=f)throw new Error(E.backend_util.getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage(y,f));y>g&&d.fill(o,g*c,y*c);for(var b=m;b<v;++b){var x=n[b];if(x<0||x>=u[0])throw new Error(E.backend_util.getSparseSegmentReductionIndicesOutOfRangeErrorMessage(b,n[b],u[0]));for(var S=0;S<c;S++)d[y*c+S]+=r[x*c+S]}if(i)for(var S=0;S<c;S++)d[y*c+S]/=v-m;if(m=v,++v,g=y+1,y=w,v>s)break}return g<f&&d.fill(o,g*c,f*c),[d,h]}var Nme=gi(function(r){return Math.sqrt(r)}),Ime=At(E.Sqrt,function(r){return Math.sqrt(r)}),Cme={kernelName:E.Sqrt,backendName:"cpu",kernelFunc:Ime};var P_=br((function(r,e){var t=r-e;return t*t})),Ame=Rr(E.SquaredDifference,P_),Dme={kernelName:E.SquaredDifference,backendName:"cpu",kernelFunc:Ame};var M_=gi(function(r,e){var t=e.pattern,n=e.replaceGlobal,a=e.rewrite;return r.replace(new RegExp(t,n?"g":""),a)}),_me=Eo(E.StaticRegexReplace,M_),Fme={kernelName:E.StaticRegexReplace,backendName:"cpu",kernelFunc:_me};function B_(r,e,t,n){for(var a=E.buffer(r,e.dtype),i=0;i<a.size;i++){for(var o=a.indexToLoc(i),s=new Array(o.length),u=0;u<s.length;u++)s[u]=o[u]*t[u]+n[u];a.set.apply(a,na([e.get.apply(e,na([],Ge(s),!1))],Ge(o),!1))}return a}var Rme=(function(){function r(e,t,n,a,i,o){this.separator=E.util.encodeString(e),this.nGramWidths=t,this.leftPad=E.util.encodeString(n),this.rightPad=E.util.encodeString(a),this.padWidth=i,this.preserveShort=o}return r.prototype.getPadWidth=function(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)},r.prototype.getNumNGrams=function(e,t){var n=this.getPadWidth(t);return Math.max(0,e+2*n-t+1)},r.prototype.createNGrams=function(e,t,n,a,i,o){for(var s=function(l){var f=u.getPadWidth(o),h=Math.max(0,f-l),p=Math.max(0,f-(i-(l+1))),d=o-(h+p),m=t+(h>0?0:l-f),v=0;v+=h*u.leftPad.length;for(var g=0;g<d;++g)v+=e[m+g].length;v+=p*u.rightPad.length;var y=h+p+d-1;v+=y*u.separator.length,n[a+l]=new Uint8Array(v);for(var w=n[a+l],b=0,x=function(S){return S.forEach(function(T){return w[b++]=T})},g=0;g<h;++g)x(u.leftPad),x(u.separator);for(var g=0;g<d-1;++g)x(e[m+g]),x(u.separator);if(d>0){x(e[m+d-1]);for(var g=0;g<p;++g)x(u.separator),x(u.rightPad)}else{for(var g=0;g<p-1;++g)x(u.rightPad),x(u.separator);x(u.rightPad)}},u=this,c=0;c<i;++c)s(c)},r.prototype.compute=function(e,t){var n=this,a=e.length,i=t.length;if(i>0){var o=t[0];if(o!==0)throw new Error("First split value must be 0, got ".concat(o));for(var s=1;s<i;++s){var u=t[s]>=o;if(u=u&&t[s]<=a,!u)throw new Error("Invalid split value ".concat(t[s],", must be in [").concat(o,", ").concat(a,"]"));o=t[s]}if(o!==a)throw new Error("Last split value must be data size. Expected ".concat(a,", got ").concat(o))}var c=i-1,l=E.util.getArrayFromDType("int32",i);if(a===0||i===0){for(var f=new Array(a),s=0;s<=c;++s)l[s]=0;return[f,l]}l[0]=0;for(var h=function(g){var y=t[g]-t[g-1],w=0;p.nGramWidths.forEach(function(b){w+=n.getNumNGrams(y,b)}),p.preserveShort&&y>0&&w===0&&(w=1),l[g]=l[g-1]+w},p=this,s=1;s<=c;++s)h(s);for(var d=new Array(l[c]),m=function(g){var y=t[g],w=l[g];if(v.nGramWidths.forEach(function(T){var N=t[g+1]-t[g],C=n.getNumNGrams(N,T);n.createNGrams(e,y,d,w,C,T),w+=C}),v.preserveShort&&w===l[g]){var b=t[g+1]-t[g];if(b===0)return"continue";var x=b+2*v.padWidth,S=1;v.createNGrams(e,y,d,w,S,x)}},v=this,s=0;s<c;++s)m(s);return[d,l]},r})();function L_(r,e,t,n,a,i,o,s){return new Rme(t,n,a,i,o,s).compute(r,e)}function Ome(r,e,t,n){if(r.length){if(e.length===0){for(var a=0;a<r.length;++a)n.push(r.subarray(a,a+1));return}if(e.length===1){for(var i=e[0],o=r.indexOf(i);o!==-1;){var s=r.subarray(0,o);(!t||s.length!==0)&&n.push(s),r=r.subarray(o+1),o=r.indexOf(i)}(!t||r.length!==0)&&n.push(r);return}for(var u=0,a=0;a<r.length+1;a++)if(a===r.length||e.indexOf(r[a])!==-1){var s=r.subarray(u,a);(!t||s.length!==0)&&n.push(s),u=a+1}}}function z_(r,e,t){for(var n=r.length,a=[],i=0,o=0,s=new Array(n),u=0;u<n;++u){var c=a.length;Ome(r[u],e,t,a);var l=a.length-c;s[u]=l,i+=l,o=Math.max(o,l)}for(var f=E.util.getArrayFromDType("int32",i*2),h=new Array(i),p=[n,o],d=0,u=0;u<n;++u)for(var m=0;m<s[u];++m)f[d*2]=u,f[d*2+1]=m,h[d]=a[d],++d;return[f,h,p]}function $_(r,e){for(var t=E.util.getArrayFromDType("int32",r.length),n=0;n<r.length;++n)t[n]=E.util.fingerPrint64(r[n]).modulo(e).getLowBitsUnsigned();return t}var W_=br((function(r,e){return r-e})),Pme=j0((function(r,e,t,n){return{real:r-t,imag:e-n}})),Q0=Rr(E.Sub,W_,Pme),Mme={kernelName:E.Sub,backendName:"cpu",kernelFunc:Q0};function G_(r,e){for(var t=new Array(r.rank),n=0;n<t.length;n++)t[n]=r.shape[n]*e[n];for(var a=E.buffer(t,r.dtype),n=0;n<a.values.length;++n){for(var i=a.indexToLoc(n),o=new Array(r.rank),s=0;s<o.length;s++)o[s]=i[s]%r.shape[s];var u=r.locToIndex(o);a.values[n]=r.values[u]}return a}var Ll=function(r,e){var t=e.value-r.value;return t===0?r.index-e.index:t};function V_(r,e,t,n){for(t===void 0&&(t=0),n===void 0&&(n=r.length-1);n>t;){if(n-t>600){var a=n-t+1,i=e-t+1,o=Math.log(a),s=.5*Math.exp(2*o/3),u=.5*Math.sqrt(o*s*(a-s)/a)*Math.sign(i-a/2),c=Math.max(t,Math.floor(e-i*s/a+u)),l=Math.min(n,Math.floor(e+(a-i)*s/a+u));V_(r,e,c,l)}var f=r[e],h=t,p=n;for(E.util.swap(r,t,e),Ll(r[n],f)>0&&E.util.swap(r,t,n);h<p;){for(E.util.swap(r,h,p),h++,p--;Ll(r[h],f)<0;)h=h+1;for(;Ll(r[p],f)>0;)p=p-1}Ll(r[t],f)===0?E.util.swap(r,t,p):(p=p+1,E.util.swap(r,p,n)),p<=e&&(t=p+1),e<=p&&(n=p-1)}}function U_(r,e,t,n,a){for(var i=e[e.length-1],o=Ge([r.length/i,i],2),s=o[0],u=o[1],c=E.util.getTypedArrayFromDType(t,s*n),l=E.util.getTypedArrayFromDType("int32",s*n),f=function(d){var m=d*u,v=r.subarray(m,m+u),g=new Array(v.length);v.forEach(function(S,T){return g[T]={value:S,index:T}}),n<g.length&&(V_(g,n),g=g.slice(0,n)),a&&g.sort(Ll);for(var y=d*n,w=c.subarray(y,y+n),b=l.subarray(y,y+n),x=0;x<n;x++)w[x]=g[x].value,b[x]=g[x].index},h=0;h<s;h++)f(h);var p=e.slice();return p[p.length-1]=n,[E.buffer(p,t,c),E.buffer(p,"int32",l)]}function H_(r,e,t,n){for(var a=E.util.parseAxisParam(e,t)[0],i=[1,t[0],1],o=0;o<a;o++)i[0]*=t[o];i[1]=t[a];for(var o=a+1;o<t.length;o++)i[2]*=t[o];for(var s=new Map,u=new Int32Array(t[a]),c=new E.TensorBuffer(i,n,r),l=[],f=i[0]===1&&i[2]===1,o=0;o<t[a];o++){var h=void 0;if(f)h=r[o].toString();else{for(var p=[],d=0;d<i[0];d++)for(var m=0;m<i[2];m++)p.push(c.get(d,o,m));h=p.join(",")}var v=s.get(h);if(v!=null)u[o]=v;else{var g=s.size;s.set(h,g),u[o]=g,l.push(o)}}var y=i.slice();y[1]=s.size;var w=new E.TensorBuffer(y,n);l.forEach(function(x,S){for(var T=0;T<i[0];T++)for(var N=0;N<i[2];N++)w.set(c.get(T,x,N),T,S,N)});var b=t.slice();return b[a]=y[1],{outputValues:w.values,outputShape:b,indices:u}}var Bme={__proto__:null,addImpl:e_,bincountImpl:X0,bincountReduceImpl:t_,bitwiseAndImpl:r_,castImpl:QD,ceilImpl:n_,concatImpl:a_,equalImpl:i_,expImpl:s_,expm1Impl:c_,floorDivImpl:f_,floorImpl:l_,gatherNdImpl:h_,gatherV2Impl:p_,greaterEqualImpl:v_,greaterImpl:d_,lessEqualImpl:g_,lessImpl:m_,linSpaceImpl:y_,logImpl:b_,maxImpl:w_,maximumImpl:x_,minimumImpl:k_,multiplyImpl:Y0,negImpl:S_,notEqualImpl:E_,prodImpl:T_,raggedGatherImpl:N_,raggedRangeImpl:I_,raggedTensorToTensorImpl:C_,rangeImpl:A_,rsqrtImpl:D_,scatterImpl:Is,sigmoidImpl:Sme,simpleAbsImpl:JD,sliceImpl:F_,sparseFillEmptyRowsImpl:R_,sparseReshapeImpl:O_,sparseSegmentReductionImpl:J0,sqrtImpl:Nme,squaredDifferenceImpl:P_,staticRegexReplaceImpl:M_,stridedSliceImpl:B_,stringNGramsImpl:L_,stringSplitImpl:z_,stringToHashBucketFastImpl:$_,subImpl:W_,tileImpl:G_,topKImpl:U_,transposeImpl:Z0,uniqueImpl:H_};var Lme="4.22.0";E.registerBackend("cpu",function(){return new K0},1);var q_=At(E.Elu,function(r){return r>=0?r:Math.exp(r)-1}),zme={kernelName:E.Elu,backendName:"cpu",kernelFunc:q_};function K_(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.alpha;Ue([a],"leakyRelu");for(var o=E.util.sizeFromShape(a.shape),s=t.data.get(a.dataId).values,u=E.util.getTypedArrayFromDType("float32",o),c=0;c<s.length;c++)u[c]=s[c]<0?i*s[c]:s[c];return t.makeTensorInfo(a.shape,"float32",u)}var $me={kernelName:E.LeakyRelu,backendName:"cpu",kernelFunc:K_},Wme=br(function(r,e){return r<0?e*r:r});function j_(r){var e=r.inputs,t=r.backend,n=e.x,a=e.alpha;Ue([n,a],"prelu");var i=t.data.get(n.dataId).values,o=t.data.get(a.dataId).values,s=Ge(Wme(n.shape,a.shape,i,o,"float32"),2),u=s[0],c=s[1];return t.makeTensorInfo(c,"float32",u)}var Gme={kernelName:E.Prelu,backendName:"cpu",kernelFunc:j_};var X_=At(E.Relu,function(r){return Math.max(0,r)}),Vme={kernelName:E.Relu,backendName:"cpu",kernelFunc:X_};var Y_=At(E.Relu6,function(r){return Math.min(Math.max(0,r),6)}),Ume={kernelName:E.Relu6,backendName:"cpu",kernelFunc:Y_};function Wp(r,e,t,n,a){if(t==="linear")return mi({inputs:{x:e},backend:r});if(t==="relu")return X_({inputs:{x:e},backend:r});if(t==="elu")return q_({inputs:{x:e},backend:r});if(t==="relu6")return Y_({inputs:{x:e},backend:r});if(t==="prelu")return j_({inputs:{x:e,alpha:n},backend:r});if(t==="leakyrelu")return K_({inputs:{x:e},backend:r,attrs:{alpha:a}});if(t==="sigmoid")return __({inputs:{x:e},backend:r});throw new Error("Activation ".concat(t," has not been implemented for the CPU backend."))}function Mt(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.shape,o=E.util.sizeFromShape(a.shape),s=E.util.inferFromImplicitShape(i,o),u=E.util.sizeFromShape(s);E.util.assert(o===u,function(){return"The new shape (".concat(s,") has ").concat(u," elements and the old ")+"shape (".concat(a.shape,") has ").concat(o," elements. The new shape and old ")+"shape must have the same number of elements."}),t.incRef(a.dataId);var c=t.data.get(a.dataId);if(c.complexTensorInfos!=null){var l=c.complexTensorInfos.real,f=c.complexTensorInfos.imag;l.shape=s,f.shape=s}return{dataId:a.dataId,shape:s,dtype:a.dtype}}var Hme={kernelName:E.Reshape,backendName:"cpu",kernelFunc:Mt};function Z_(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.a,i=e.b,o=n.transposeA,s=n.transposeB;Ue([a,i],"matMul");var u=a.shape.length,c=i.shape.length,l=o?a.shape[u-2]:a.shape[u-1],f=s?i.shape[c-1]:i.shape[c-2],h=o?a.shape[u-1]:a.shape[u-2],p=s?i.shape[c-2]:i.shape[c-1],d=a.shape.slice(0,-2),m=i.shape.slice(0,-2),v=E.util.sizeFromShape(d),g=E.util.sizeFromShape(m),y=E.broadcast_util.assertAndGetBroadcastShape(a.shape.slice(0,-2),i.shape.slice(0,-2)),w=y.concat([h,p]);E.util.assert(l===f,function(){return"Error in matMul: inner shapes (".concat(l,") and (")+"".concat(f,") of Tensors with shapes ").concat(a.shape," and ")+"".concat(i.shape," and transposeA=").concat(o)+" and transposeB=".concat(s," must match.")});for(var b=o?[v,l,h]:[v,h,l],x=s?[g,p,f]:[g,f,p],S=Mt({inputs:{x:a},backend:t,attrs:{shape:b}}),T=Mt({inputs:{x:i},backend:t,attrs:{shape:x}}),N=o?S.shape[1]:S.shape[2],C=o?S.shape[2]:S.shape[1],R=s?T.shape[1]:T.shape[2],_=Math.max(v,g),P=t.data.get(S.dataId).values,$=t.data.get(T.dataId).values,z=E.util.computeStrides(S.shape),L=E.util.computeStrides(T.shape),B=Ge(o?[z[0],1,z[1]]:[z[0],z[1],1],3),G=B[0],X=B[1],Z=B[2],V=Ge(s?[1,L[1],L[0]]:[L[1],1,L[0]],3),j=V[0],re=V[1],te=V[2],oe=C*R,ce=E.buffer([_,C,R],S.dtype),pe=ce.values,xe=t.blockSize,fe=0;fe<_;fe++)for(var ge=fe%v,we=fe%g,Ae=0;Ae<C;Ae+=xe)for(var Ke=Math.min(Ae+xe,C),ot=0;ot<R;ot+=xe)for(var et=Math.min(ot+xe,R),Qe=0;Qe<N;Qe+=xe)for(var it=Math.min(Qe+xe,N),nt=Ae;nt<Ke;nt++)for(var je=ot;je<et;je++){for(var Je=0,Ze=Qe;Ze<it;Ze++){var Yt=P[ge*G+nt*X+Ze*Z],qe=$[Ze*j+je*re+we*te];Je+=Yt*qe}pe[fe*oe+(nt*R+je)]+=Je}return t.disposeIntermediateTensorInfo(S),t.disposeIntermediateTensorInfo(T),t.makeTensorInfo(w,ce.dtype,ce.values)}var qme={kernelName:E.BatchMatMul,backendName:"cpu",kernelFunc:Z_};function Kme(r){var e,t,n=r.inputs,a=r.backend,i=r.attrs,o=n.a,s=n.b,u=n.bias,c=n.preluActivationWeights,l=i.transposeA,f=i.transposeB,h=i.activation,p=i.leakyreluAlpha,d,m,v,g=[],y=Z_({inputs:{a:o,b:s},attrs:{transposeA:l,transposeB:f},backend:a});d=y,u&&(m=zu({inputs:{a:d,b:u},backend:a}),g.push(d),d=m),h&&(v=Wp(a,d,h,c,p),g.push(d),d=v);try{for(var w=Lu(g),b=w.next();!b.done;b=w.next()){var x=b.value;a.disposeIntermediateTensorInfo(x)}}catch(S){e={error:S}}finally{try{b&&!b.done&&(t=w.return)&&t.call(w)}finally{if(e)throw e.error}}return d}var jme={kernelName:E._FusedMatMul,backendName:"cpu",kernelFunc:Kme};var Xme=At(E.Acos,function(r){return Math.acos(r)}),Yme={kernelName:E.Acos,backendName:"cpu",kernelFunc:Xme};var Zme=At(E.Acosh,function(r){return Math.acosh(r)}),Jme={kernelName:E.Acosh,backendName:"cpu",kernelFunc:Zme};function Qme(r){var e=r.inputs,t=r.backend,n=e;Ue(e,"addN");for(var a=n.map(function(l){return t.data.get(l.dataId).values}),i=E.buffer(n[0].shape,n[0].dtype),o=i.values,s=0;s<n.length;s++)for(var u=a[s],c=0;c<o.length;c++)o[c]+=u[c];return t.makeTensorInfo(i.shape,i.dtype,i.values)}var ege={kernelName:E.AddN,backendName:"cpu",kernelFunc:Qme};function tge(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims;Ue(a,"all");var s=E.util.parseAxisParam(i,a.shape),u=s,c=E.backend_util.getAxesPermutation(u,a.shape.length),l=a;c!=null&&(l=xn({inputs:{x:a},backend:t,attrs:{perm:c}}),u=E.backend_util.getInnerMostAxes(u.length,a.shape.length)),E.backend_util.assertAxesAreInnerMostDims("all",u,l.shape.length);for(var f=Ge(E.backend_util.computeOutAndReduceShapes(l.shape,u),2),h=f[0],p=f[1],d=E.util.sizeFromShape(p),m=E.util.makeZerosTypedArray(E.util.sizeFromShape(h),l.dtype),v=t.data.get(l.dataId).values,g=0;g<m.length;++g){for(var y=g*d,w=v[y],b=0;b<d;++b){var x=v[y+b];w=w&&x}m[g]=w}c!=null&&t.disposeIntermediateTensorInfo(l);var S=t.makeTensorInfo(h,l.dtype,m);if(o){var T=E.backend_util.expandShapeToKeepDim(h,s),N=Mt({inputs:{x:S},backend:t,attrs:{shape:T}});return t.disposeIntermediateTensorInfo(S),N}return S}var rge={kernelName:E.All,backendName:"cpu",kernelFunc:tge};function nge(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims;Ue(a,"any");var s=E.util.parseAxisParam(i,a.shape),u=s,c=E.backend_util.getAxesPermutation(u,a.shape.length),l=a;c!=null&&(l=xn({inputs:{x:a},backend:t,attrs:{perm:c}}),u=E.backend_util.getInnerMostAxes(u.length,a.shape.length)),E.backend_util.assertAxesAreInnerMostDims("any",u,l.shape.length);for(var f=Ge(E.backend_util.computeOutAndReduceShapes(l.shape,u),2),h=f[0],p=f[1],d=E.util.sizeFromShape(p),m=E.util.makeZerosTypedArray(E.util.sizeFromShape(h),l.dtype),v=t.data.get(l.dataId).values,g=0;g<m.length;++g){for(var y=g*d,w=v[y],b=0;b<d;++b){var x=v[y+b];w=w||x}m[g]=w}c!=null&&t.disposeIntermediateTensorInfo(l);var S=t.makeTensorInfo(h,l.dtype,m);if(o){var T=E.backend_util.expandShapeToKeepDim(h,s),N=Mt({inputs:{x:S},backend:t,attrs:{shape:T}});return t.disposeIntermediateTensorInfo(S),N}return S}var age={kernelName:E.Any,backendName:"cpu",kernelFunc:nge};function ige(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis;Ue(a,"argMax");var o=E.util.parseAxisParam(i,a.shape),s=E.backend_util.getAxesPermutation(o,a.shape.length),u=a,c=[];s!=null&&(u=xn({inputs:{x:a},backend:t,attrs:{perm:s}}),c.push(u),o=E.backend_util.getInnerMostAxes(o.length,u.shape.length)),o=[o[0]],E.backend_util.assertAxesAreInnerMostDims("argMax",o,u.shape.length);for(var l=Ge(E.backend_util.computeOutAndReduceShapes(u.shape,o),2),f=l[0],h=l[1],p=E.util.sizeFromShape(f),d=E.util.makeZerosTypedArray(p,"int32"),m=E.util.sizeFromShape(h),v=t.data.get(u.dataId).values,g=0;g<d.length;++g){for(var y=g*m,w=v[y],b=0,x=0;x<m;++x){var S=v[y+x];S>w&&(w=S,b=x)}d[g]=b}return c.forEach(function(T){return t.disposeIntermediateTensorInfo(T)}),t.makeTensorInfo(f,"int32",d)}var oge={kernelName:E.ArgMax,backendName:"cpu",kernelFunc:ige};function sge(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis;Ue(a,"argMin");var o=E.util.parseAxisParam(i,a.shape),s=E.backend_util.getAxesPermutation(o,a.shape.length),u=a,c=[];s!=null&&(u=xn({inputs:{x:a},backend:t,attrs:{perm:s}}),c.push(u),o=E.backend_util.getInnerMostAxes(o.length,u.shape.length)),o=[o[0]],E.backend_util.assertAxesAreInnerMostDims("argMin",o,u.shape.length);for(var l=Ge(E.backend_util.computeOutAndReduceShapes(u.shape,o),2),f=l[0],h=l[1],p=E.util.sizeFromShape(f),d=E.util.makeZerosTypedArray(p,"int32"),m=E.util.sizeFromShape(h),v=t.data.get(u.dataId).values,g=0;g<d.length;++g){for(var y=g*m,w=v[y],b=0,x=0;x<m;++x){var S=v[y+x];S<w&&(w=S,b=x)}d[g]=b}return c.forEach(function(T){return t.disposeIntermediateTensorInfo(T)}),t.makeTensorInfo(f,"int32",d)}var uge={kernelName:E.ArgMin,backendName:"cpu",kernelFunc:sge};var cge=At(E.Asin,function(r){return Math.asin(r)}),lge={kernelName:E.Asin,backendName:"cpu",kernelFunc:cge};var fge=At(E.Asinh,function(r){return Math.asinh(r)}),hge={kernelName:E.Asinh,backendName:"cpu",kernelFunc:fge};var pge=At(E.Atan,function(r){return Math.atan(r)}),dge={kernelName:E.Atan,backendName:"cpu",kernelFunc:pge};var vge=br(function(r,e){return Math.atan2(r,e)}),mge=Rr(E.Atan2,vge),gge={kernelName:E.Atan2,backendName:"cpu",kernelFunc:mge};var yge=At(E.Atanh,function(r){return Math.atanh(r)}),bge={kernelName:E.Atanh,backendName:"cpu",kernelFunc:yge};function eb(r,e,t,n,a,i){for(var o=a.strideHeight,s=a.strideWidth,u=a.dilationHeight,c=a.dilationWidth,l=a.effectiveFilterHeight,f=a.effectiveFilterWidth,h=a.padInfo.top,p=a.padInfo.left,d=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=E.buffer(a.outShape,t),v=m.values,g=a.outShape[1]*a.outShape[2]*a.outShape[3],y=a.outShape[2]*a.outShape[3],w=a.outShape[3],b=0;b<a.batchSize;++b)for(var x=b*g,S=b*n[0],T=0;T<a.inChannels;++T)for(var N=0;N<a.outHeight;++N)for(var C=N*o-h,R=Math.max(0,C),_=Math.min(a.inHeight,l+C),P=x+N*y,$=0;$<a.outWidth;++$){for(var z=$*s-p,L=Math.max(0,z),B=Math.min(a.inWidth,f+z),G=d,X=0,Z=0,V=R;V<_;V+=u){for(var j=S+V*n[1],re=L;re<B;re+=c){var te=j+re*n[2],oe=r[te+T];i==="max"&&oe>G?G=oe:i==="avg"&&(X+=oe,Z++)}if(isNaN(G))break}var ce=P+$*w+T;v[ce]=i==="avg"?X/Z:G}return m}function J_(r,e,t,n,a,i){a===void 0&&(a=!1),i===void 0&&(i=!1);for(var o=E.buffer(n.outShape,"int32"),s=n.strideHeight,u=n.strideWidth,c=n.dilationHeight,l=n.dilationWidth,f=n.effectiveFilterHeight,h=n.effectiveFilterWidth,p=n.padInfo.top,d=n.padInfo.left,m=E.buffer(e,t,r),v=0;v<n.batchSize;++v)for(var g=0;g<n.inChannels;++g)for(var y=0;y<n.outHeight;++y){for(var w=y*s-p,b=w;b<0;)b+=c;for(var x=Math.min(n.inHeight,f+w),S=0;S<n.outWidth;++S){for(var T=S*u-d,N=T;N<0;)N+=l;for(var C=Math.min(n.inWidth,h+T),R=Number.NEGATIVE_INFINITY,_=-1,P=b;P<x;P+=c)for(var $=P-w,z=N;z<C;z+=l){var L=z-T,B=m.get(v,P,z,g);B>R&&(R=B,a?_=i?((v*n.inHeight+P)*n.inWidth+z)*n.inChannels+g:(P*n.inWidth+z)*n.inChannels+g:_=$*h+L)}o.set(_,v,y,S,g)}}return o}function Q_(r,e,t,n,a,i){for(var o=a.strideDepth,s=a.strideHeight,u=a.strideWidth,c=a.dilationDepth,l=a.dilationHeight,f=a.dilationWidth,h=a.effectiveFilterDepth,p=a.effectiveFilterHeight,d=a.effectiveFilterWidth,m=a.padInfo.front,v=a.padInfo.top,g=a.padInfo.left,y=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,w=E.buffer(a.outShape,t),b=w.values,x=a.outShape[1]*a.outShape[2]*a.outShape[3]*a.outShape[4],S=a.outShape[2]*a.outShape[3]*a.outShape[4],T=a.outShape[3]*a.outShape[4],N=a.outShape[4],C=0;C<a.batchSize;++C)for(var R=C*x,_=C*n[0],P=0;P<a.inChannels;++P)for(var $=0;$<a.outDepth;++$){for(var z=$*o-m,L=z;L<0;)L+=c;for(var B=Math.min(a.inDepth,h+z),G=R+$*S,X=0;X<a.outHeight;++X){for(var Z=X*s-v,V=Z;V<0;)V+=l;for(var j=Math.min(a.inHeight,p+Z),re=G+X*T,te=0;te<a.outWidth;++te){for(var oe=te*u-g,ce=oe;ce<0;)ce+=f;for(var pe=Math.min(a.inWidth,d+oe),xe=re+te*N,fe=y,ge=0,we=0,Ae=L;Ae<B;Ae+=c){for(var Ke=_+Ae*n[1],ot=V;ot<j;ot+=l){for(var et=Ke+ot*n[2],Qe=ce;Qe<pe;Qe+=f){var it=et+Qe*n[3],nt=r[it+P];if(i==="max"&&nt>fe?fe=nt:i==="avg"&&(ge+=nt,we++),isNaN(fe))break}if(isNaN(fe))break}if(isNaN(fe))break}var je=xe+P;b[je]=i==="avg"?ge/Math.max(we,1):fe}}}return w}function wge(r,e){for(var t=E.buffer(e.outShape,"int32"),n=e.strideDepth,a=e.strideHeight,i=e.strideWidth,o=e.dilationDepth,s=e.dilationHeight,u=e.dilationWidth,c=e.effectiveFilterDepth,l=e.effectiveFilterHeight,f=e.effectiveFilterWidth,h=e.padInfo.front,p=e.padInfo.top,d=e.padInfo.left,m=0;m<e.batchSize;++m)for(var v=0;v<e.inChannels;++v)for(var g=0;g<e.outDepth;++g){for(var y=g*n-h,w=y;w<0;)w+=o;for(var b=Math.min(e.inDepth,c+y),x=0;x<e.outHeight;++x){for(var S=x*a-p,T=S;T<0;)T+=s;for(var N=Math.min(e.inHeight,l+S),C=0;C<e.outWidth;++C){for(var R=C*i-d,_=R;_<0;)_+=u;for(var P=Math.min(e.inWidth,f+R),$=Number.NEGATIVE_INFINITY,z=-1,L=w;L<b;L+=o)for(var B=L-y,G=T;G<N;G+=s)for(var X=G-S,Z=_;Z<P;Z+=u){var V=Z-R,j=r.get(m,L,G,Z,v);j>=$&&($=j,z=B*l*f+X*l+V)}t.set(z,m,g,x,C,v)}}}return t}function xge(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x;Ue(a,"avgPool");var i=n.filterSize,o=n.strides,s=n.pad,u=n.dimRoundingMode,c=1;E.util.assert(E.backend_util.eitherStridesOrDilationsAreOne(o,c),function(){return"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(c,"'")});var l=E.backend_util.computePool2DInfo(a.shape,i,o,c,s,u),f;if(l.filterWidth===1&&l.filterHeight===1&&E.util.arraysEqual(l.inShape,l.outShape))f=mi({inputs:{x:a},backend:t});else{var h=t.data.get(a.dataId).values,p=E.util.computeStrides(a.shape),d=eb(h,a.shape,a.dtype,p,l,"avg");f=t.makeTensorInfo(l.outShape,a.dtype,d.values)}return f}var kge={kernelName:E.AvgPool,backendName:"cpu",kernelFunc:xge};function Sge(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.filterSize,o=n.strides,s=n.pad,u=n.dimRoundingMode,c=n.dataFormat;Ue(a,"avgPool3d");var l=E.backend_util.computePool3DInfo(a.shape,i,o,1,s,u,c),f=t.data.get(a.dataId).values,h=Q_(f,a.shape,a.dtype,E.util.computeStrides(a.shape),l,"avg");return t.makeTensorInfo(h.shape,"float32",h.values)}var Ege={kernelName:E.AvgPool3D,backendName:"cpu",kernelFunc:Sge};function Tge(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.input,o=n.filterSize,s=n.strides,u=n.pad,c=n.dimRoundingMode;Ue([a,i],"avgPool3DGrad");for(var l=E.backend_util.computePool3DInfo(i.shape,o,s,1,u,c),f=l.strideDepth,h=l.strideHeight,p=l.strideWidth,d=l.filterDepth,m=l.filterHeight,v=l.filterWidth,g=l.dilationDepth,y=l.dilationHeight,w=l.dilationWidth,b=l.effectiveFilterDepth,x=l.effectiveFilterHeight,S=l.effectiveFilterWidth,T=b-1-l.padInfo.front,N=S-1-l.padInfo.left,C=x-1-l.padInfo.top,R=E.buffer(i.shape,"float32"),_=1/(d*m*v),P=t.bufferSync(a),$=0;$<l.batchSize;++$)for(var z=0;z<l.inChannels;++z)for(var L=0;L<l.inDepth;++L)for(var B=0;B<l.inHeight;++B)for(var G=0;G<l.inWidth;++G){for(var X=L-T,Z=B-C,V=G-N,j=0,re=0;re<b;re+=g){var te=(X+re)/f;if(!(te<0||te>=l.outDepth||Math.floor(te)!==te))for(var oe=0;oe<x;oe+=y){var ce=(Z+oe)/h;if(!(ce<0||ce>=l.outHeight||Math.floor(ce)!==ce))for(var pe=0;pe<S;pe+=w){var xe=(V+pe)/p;if(!(xe<0||xe>=l.outWidth||Math.floor(xe)!==xe)){var fe=P.get($,te,ce,xe,z);j+=fe}}}}R.set(j*_,$,L,B,G,z)}return t.makeTensorInfo(R.shape,R.dtype,R.values)}var Nge={kernelName:E.AvgPool3DGrad,backendName:"cpu",kernelFunc:Tge};function Ige(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.input,o=i;Ue([a,i],"avgPoolGrad");for(var s=n.filterSize,u=n.strides,c=n.pad,l=E.backend_util.computePool2DInfo(o.shape,s,u,1,c),f=l.strideHeight,h=l.strideWidth,p=l.filterHeight,d=l.filterWidth,m=l.dilationHeight,v=l.dilationWidth,g=l.effectiveFilterHeight,y=l.effectiveFilterWidth,w=y-1-l.padInfo.left,b=g-1-l.padInfo.top,x=E.buffer(o.shape,"float32"),S=1/(p*d),T=t.data.get(a.dataId).values,N=E.buffer(a.shape,"float32",T),C=0;C<l.batchSize;++C)for(var R=0;R<l.inChannels;++R)for(var _=0;_<l.inHeight;++_)for(var P=0;P<l.inWidth;++P){for(var $=_-b,z=P-w,L=0,B=0;B<g;B+=m){var G=($+B)/f;if(!(G<0||G>=l.outHeight||Math.floor(G)!==G))for(var X=0;X<y;X+=v){var Z=(z+X)/h;if(!(Z<0||Z>=l.outWidth||Math.floor(Z)!==Z)){var V=N.get(C,G,Z,R);L+=V}}}x.set(L*S,C,_,P,R)}return t.makeTensorInfo(x.shape,x.dtype,x.values)}var Cge={kernelName:E.AvgPoolGrad,backendName:"cpu",kernelFunc:Ige};function Age(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.scale,o=e.offset,s=e.mean,u=e.variance;E.util.assert(s.shape.length===u.shape.length,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),E.util.assert(o==null||s.shape.length===o.shape.length,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),E.util.assert(i==null||s.shape.length===i.shape.length,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),Ue([a,s,u,i,o],"batchNorm");var c=n.varianceEpsilon;c==null&&(c=.001);for(var l=t.data.get(a.dataId).values,f=t.data.get(s.dataId).values,h=t.data.get(u.dataId).values,p=i?t.data.get(i.dataId).values:new Float32Array([1]),d=o?t.data.get(o.dataId).values:new Float32Array([0]),m=new Float32Array(l.length),v=d.length,g=p.length,y=h.length,w=f.length,b=0,x=0,S=0,T=0,N=0;N<l.length;++N)m[N]=d[b++]+(l[N]-f[x++])*p[S++]/Math.sqrt(h[T++]+c),b>=v&&(b=0),x>=w&&(x=0),S>=g&&(S=0),T>=y&&(T=0);return t.makeTensorInfo(a.shape,a.dtype,m)}var Dge={kernelName:E.FusedBatchNorm,backendName:"cpu",kernelFunc:Age};function _ge(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.blockShape,o=n.crops;Ue([a],"batchToSpaceND");var s=i.reduce(function(g,y){return g*y}),u=E.backend_util.getReshaped(a.shape,i,s),c=E.backend_util.getPermuted(u.length,i.length),l=E.backend_util.getReshapedPermuted(a.shape,i,s),f=E.backend_util.getSliceBeginCoords(o,i.length),h=E.backend_util.getSliceSize(l,o,i.length),p=Mt({inputs:{x:a},backend:t,attrs:{shape:u}}),d=xn({inputs:{x:p},backend:t,attrs:{perm:c}}),m=Mt({inputs:{x:d},backend:t,attrs:{shape:l}}),v=As({inputs:{x:m},backend:t,attrs:{begin:f,size:h}});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(m),v}var Fge={kernelName:E.BatchToSpaceND,backendName:"cpu",kernelFunc:_ge};function Rge(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.weights,o=n.size,s=t.data.get(a.dataId).values,u=t.data.get(i.dataId).values,c=X0(s,u,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,c)}var Oge={kernelName:E.Bincount,backendName:"cpu",kernelFunc:Rge};function Pge(r){var e=r.inputs,t=r.backend,n=e.s0,a=e.s1,i=t.data.get(n.dataId).values,o=t.data.get(a.dataId).values,s=E.backend_util.assertAndGetBroadcastShape(Array.from(i),Array.from(o));return t.makeTensorInfo([s.length],"int32",Int32Array.from(s))}var Mge={kernelName:E.BroadcastArgs,backendName:"cpu",kernelFunc:Pge};var Bge=At(E.ClipByValue,function(r,e){var t=e;return r>t.clipValueMax?t.clipValueMax:r<t.clipValueMin?t.clipValueMin:r}),Lge={kernelName:E.ClipByValue,backendName:"cpu",kernelFunc:Bge};var zge=function(r){for(var e=r.inputs.x,t=r.backend,n=new Float32Array(E.util.sizeFromShape(e.shape)),a=t.data.get(e.dataId),i=a.complexTensorInfos.real,o=a.complexTensorInfos.imag,s=t.data.get(i.dataId).values,u=t.data.get(o.dataId).values,c=0;c<s.length;c++){var l=s[c],f=u[c];n[c]=Math.hypot(l,f)}return t.makeOutput(n,e.shape,"float32")},$ge={kernelName:E.ComplexAbs,backendName:"cpu",kernelFunc:zge};function $u(r){var e=r.inputs,t=r.backend,n=e.input,a=t.data.get(n.dataId).complexTensorInfos.imag,i=t.data.get(a.dataId).values;return t.makeTensorInfo(a.shape,a.dtype,i)}var Wge={kernelName:E.Imag,backendName:"cpu",kernelFunc:$u};function Wu(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.axis,i=E.util.parseAxisParam(a,e[0].shape)[0],o=e.map(function(b){return b.shape});E.backend_util.assertParamsConsistent(o,i);var s=E.backend_util.computeOutShape(e.map(function(b){return b.shape}),i);if(E.util.sizeFromShape(s)===0)return t.makeTensorInfo(s,e[0].dtype,[]);var u=e.filter(function(b){return E.util.sizeFromShape(b.shape)>0});if(u.length===1)return mi({inputs:{x:u[0]},backend:t});if(u[0].dtype==="complex64"){var c=u.map(function(b){return Cs({inputs:{input:b},backend:t})}),l=u.map(function(b){return $u({inputs:{input:b},backend:t})}),f=Wu({inputs:c,backend:t,attrs:{axis:i}}),h=Wu({inputs:l,backend:t,attrs:{axis:i}}),p=qn({inputs:{real:f,imag:h},backend:t});return c.forEach(function(b){return t.disposeIntermediateTensorInfo(b)}),l.forEach(function(b){return t.disposeIntermediateTensorInfo(b)}),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(h),p}var d=u.map(function(b){var x=E.util.sizeFromShape(b.shape.slice(i)),S=[-1,x];return Mt({inputs:{x:b},backend:t,attrs:{shape:S}})}),m=d.map(function(b){return{vals:t.data.get(b.dataId).values,shape:b.shape}});s=E.backend_util.computeOutShape(d.map(function(b){return b.shape}),1);var v=d[0].shape[0]===1,g=a_(m,s,e[0].dtype,v),y=E.backend_util.computeOutShape(u.map(function(b){return b.shape}),i),w=t.makeTensorInfo(y,e[0].dtype,g);return d.forEach(function(b){return t.disposeIntermediateTensorInfo(b)}),w}var Gge={kernelName:E.Concat,backendName:"cpu",kernelFunc:Wu};function e3(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=n.strides,s=n.pad,u=n.dataFormat,c=n.dilations,l=n.dimRoundingMode;Ue([a,i],"conv2d");for(var f=E.backend_util.convertConv2DDataFormat(u),h=E.backend_util.computeConv2DInfo(a.shape,i.shape,o,c,s,l,!1,f),p=h.filterHeight,d=h.filterWidth,m=h.dilationHeight,v=h.dilationWidth,g=h.padInfo.left,y=h.padInfo.top,w=h.dataFormat==="channelsLast",b=new E.TensorBuffer(h.outShape,a.dtype),x=E.util.computeStrides(a.shape),S=E.util.computeStrides(i.shape),T=x[0],N=w?x[1]:x[2],C=w?x[2]:1,R=w?1:x[1],_=b.strides[0],P=w?b.strides[1]:b.strides[2],$=w?b.strides[2]:1,z=w?1:b.strides[1],L=t.data.get(a.dataId).values,B=t.data.get(i.dataId).values,G=b.values,X=0;X<h.batchSize;++X)for(var Z=X*T,V=X*_,j=0;j<h.outHeight;++j)for(var re=V+j*P,te=j*h.strideHeight-y,oe=0;oe<p;++oe){var ce=te+oe*m;if(!(ce<0||ce>=h.inHeight))for(var pe=oe*S[0],xe=Z+ce*N,fe=0;fe<h.outWidth;++fe)for(var ge=re+fe*$,we=fe*h.strideWidth-g,Ae=0;Ae<d;++Ae){var Ke=we+Ae*v;if(!(Ke<0||Ke>=h.inWidth))for(var ot=pe+Ae*S[1],et=xe+Ke*C,Qe=ot,it=0;it<h.inChannels;++it){for(var nt=L[et+it*R],je=0;je<h.outChannels;++je)G[ge+je*z]+=nt*B[Qe+je];Qe+=h.outChannels}}}return t.makeTensorInfo(b.shape,b.dtype,G)}var Vge={kernelName:E.Conv2D,backendName:"cpu",kernelFunc:e3};function Uge(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.dy,o=n.strides,s=n.pad,u=n.dataFormat,c=n.dimRoundingMode,l=n.filterShape;Ue([a,i],"conv2dBackpropFilter");for(var f=E.backend_util.convertConv2DDataFormat(u),h=E.backend_util.computeConv2DInfo(a.shape,l,o,1,s,c,!1,f),p=h.strideHeight,d=h.strideWidth,m=h.filterHeight,v=h.filterWidth,g=h.dataFormat==="channelsLast",y=new E.TensorBuffer(h.filterShape,"float32"),w=h.padInfo.left,b=h.padInfo.top,x=t.data.get(a.dataId).values,S=t.data.get(i.dataId).values,T=new E.TensorBuffer(a.shape,a.dtype,x),N=new E.TensorBuffer(i.shape,i.dtype,S),C=0;C<m;++C)for(var R=Math.max(0,Math.ceil((b-C)/p)),_=Math.min(h.outHeight,(h.inHeight+b-C)/p),P=0;P<v;++P)for(var $=Math.max(0,Math.ceil((w-P)/d)),z=Math.min(h.outWidth,(h.inWidth+w-P)/d),L=0;L<h.inChannels;++L)for(var B=0;B<h.outChannels;++B){for(var G=0,X=0;X<h.batchSize;++X)for(var Z=R;Z<_;++Z)for(var V=C+Z*p-b,j=$;j<z;++j){var re=P+j*d-w;g?G+=T.get(X,V,re,L)*N.get(X,Z,j,B):G+=T.get(X,L,V,re)*N.get(X,B,Z,j)}y.set(G,C,P,L,B)}return t.makeTensorInfo(y.shape,y.dtype,y.values)}var Hge={kernelName:E.Conv2DBackpropFilter,backendName:"cpu",kernelFunc:Uge};function qge(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.filter,o=n.inputShape,s=n.strides,u=n.pad,c=n.dataFormat,l=n.dimRoundingMode;Ue([a,i],"conv2dBackpropInput");var f=E.util.computeStrides(i.shape),h=E.util.computeStrides(a.shape),p=E.backend_util.convertConv2DDataFormat(c),d=E.backend_util.computeConv2DInfo(o,i.shape,s,1,u,l,!1,p),m=new E.TensorBuffer(d.inShape,"float32"),v=m.values,g=t.data.get(a.dataId).values,y=t.data.get(i.dataId).values,w=Ge(f,3),b=w[0],x=w[1],S=w[2],T=d.batchSize,N=d.filterHeight,C=d.filterWidth,R=d.inChannels,_=d.inHeight,P=d.inWidth,$=d.outChannels,z=d.outHeight,L=d.outWidth,B=d.strideHeight,G=d.strideWidth;p=d.dataFormat;for(var X=N-1-d.padInfo.top,Z=C-1-d.padInfo.left,V=p==="channelsLast",j=m.strides[0],re=V?m.strides[1]:m.strides[2],te=V?m.strides[2]:1,oe=V?1:m.strides[1],ce=h[0],pe=V?h[1]:h[2],xe=V?h[2]:1,fe=V?1:h[1],ge=0;ge<T;++ge)for(var we=0;we<R;++we)for(var Ae=0;Ae<_;++Ae)for(var Ke=Ae-X,ot=Math.max(0,Math.ceil(Ke/B)),et=Math.min(z,(N+Ke)/B),Qe=0;Qe<P;++Qe){for(var it=Qe-Z,nt=Math.max(0,Math.ceil(it/G)),je=Math.min(L,(C+it)/G),Je=0,Ze=ot;Ze<et;++Ze)for(var Yt=Ze*B-Ke,qe=nt;qe<je;++qe)for(var vt=qe*G-it,vr=ce*ge+pe*Ze+xe*qe,nn=b*(N-1-Yt)+x*(C-1-vt)+S*we,kr=0;kr<$;++kr){var mr=g[vr+fe*kr],Zt=y[nn+kr];Je+=mr*Zt}var En=j*ge+re*Ae+te*Qe+oe*we;v[En]=Je}return t.makeTensorInfo(m.shape,m.dtype,m.values)}var Kge={kernelName:E.Conv2DBackpropInput,backendName:"cpu",kernelFunc:qge};function jge(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=n.strides,s=n.pad,u=n.dilations;Ue([a,i],"conv3d");for(var c=E.backend_util.computeConv3DInfo(a.shape,i.shape,o,u,s),l=c.filterDepth,f=c.filterHeight,h=c.filterWidth,p=c.dilationDepth,d=c.dilationHeight,m=c.dilationWidth,v=c.padInfo,g=v.front,y=v.left,w=v.top,b=new E.TensorBuffer(c.outShape,a.dtype),x=t.data.get(a.dataId).values,S=t.data.get(i.dataId).values,T=b.values,N=E.util.computeStrides(a.shape),C=E.util.computeStrides(i.shape),R=0;R<c.batchSize;++R)for(var _=R*N[0],P=R*b.strides[0],$=0;$<c.outDepth;++$)for(var z=P+$*b.strides[1],L=$*c.strideDepth-g,B=0;B<l;++B){var G=L+B*p;if(!(G<0||G>=c.inDepth))for(var X=B*C[0],Z=_+G*N[1],V=0;V<c.outHeight;++V)for(var j=z+V*b.strides[2],re=V*c.strideHeight-w,te=0;te<f;++te){var oe=re+te*d;if(!(oe<0||oe>=c.inHeight))for(var ce=X+te*C[1],pe=Z+oe*N[2],xe=0;xe<c.outWidth;++xe)for(var fe=j+xe*c.outChannels,ge=xe*c.strideWidth-y,we=0;we<h;++we){var Ae=ge+we*m;if(!(Ae<0||Ae>=c.inWidth))for(var Ke=ce+we*C[2],ot=pe+Ae*c.inChannels,et=Ke,Qe=0;Qe<c.inChannels;++Qe){for(var it=x[ot+Qe],nt=0;nt<c.outChannels;++nt)T[fe+nt]+=it*S[et+nt];et+=c.outChannels}}}}return t.makeTensorInfo(b.shape,b.dtype,b.values)}var Xge={kernelName:E.Conv3D,backendName:"cpu",kernelFunc:jge};function Yge(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.dy,o=n.strides,s=n.pad,u=n.filterShape;Ue([a,i],"conv3dBackpropFilterV2");for(var c=E.util.computeStrides(a.shape),l=E.util.computeStrides(i.shape),f=E.backend_util.computeConv3DInfo(a.shape,u,o,1,s),h=f.strideDepth,p=f.strideHeight,d=f.strideWidth,m=f.filterDepth,v=f.filterHeight,g=f.filterWidth,y=new E.TensorBuffer(f.filterShape,"float32"),w=y.values,b=Ge(y.strides,4),x=b[0],S=b[1],T=b[2],N=b[3],C=t.data.get(i.dataId).values,R=Ge(l,4),_=R[0],P=R[1],$=R[2],z=R[3],L=t.data.get(a.dataId).values,B=Ge(c,4),G=B[0],X=B[1],Z=B[2],V=B[3],j=f.padInfo.front,re=f.padInfo.left,te=f.padInfo.top,oe=0;oe<m;++oe)for(var ce=Math.max(0,Math.ceil((j-oe)/h)),pe=Math.min(f.outDepth,(f.inDepth+j-oe)/h),xe=oe*x,fe=0;fe<v;++fe)for(var ge=Math.max(0,Math.ceil((te-fe)/p)),we=Math.min(f.outHeight,(f.inHeight+te-fe)/p),Ae=fe*S+xe,Ke=0;Ke<g;++Ke)for(var ot=Math.max(0,Math.ceil((re-Ke)/d)),et=Math.min(f.outWidth,(f.inWidth+re-Ke)/d),Qe=Ke*T+Ae,it=0;it<f.inChannels;++it)for(var nt=it*N+Qe,je=0;je<f.outChannels;++je){for(var Je=0,Ze=0;Ze<f.batchSize;++Ze)for(var Yt=Ze*G,qe=Ze*_,vt=ce;vt<pe;++vt)for(var vr=oe+vt*h-j,nn=vr*X+Yt,kr=vt*P+qe,mr=ge;mr<we;++mr)for(var Zt=fe+mr*p-te,En=Zt*Z+nn,an=mr*$+kr,Tn=ot;Tn<et;++Tn){var fr=Ke+Tn*d-re,ki=fr*V+En,Gs=Tn*z+an;Je+=L[ki+it]*C[Gs+je]}w[nt+je]=Je}return t.makeTensorInfo(y.shape,y.dtype,y.values)}var Zge={kernelName:E.Conv3DBackpropFilterV2,backendName:"cpu",kernelFunc:Yge};function Jge(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.filter,o=n.pad,s=n.strides,u=n.inputShape;Ue([a],"conv3dBackpropInputV2");for(var c=E.util.computeStrides(a.shape),l=E.util.computeStrides(i.shape),f=E.backend_util.computeConv3DInfo(u,i.shape,s,1,o),h=new E.TensorBuffer(f.inShape,"float32"),p=h.values,d=Ge(h.strides,4),m=d[0],v=d[1],g=d[2],y=d[3],w=t.data.get(a.dataId).values,b=Ge(c,4),x=b[0],S=b[1],T=b[2],N=b[3],C=t.data.get(i.dataId).values,R=Ge(l,4),_=R[0],P=R[1],$=R[2],z=R[3],L=f.batchSize,B=f.filterDepth,G=f.filterHeight,X=f.filterWidth,Z=f.inChannels,V=f.inDepth,j=f.inHeight,re=f.inWidth,te=f.outChannels,oe=f.outDepth,ce=f.outHeight,pe=f.outWidth,xe=f.strideDepth,fe=f.strideHeight,ge=f.strideWidth,we=B-1-f.padInfo.front,Ae=G-1-f.padInfo.top,Ke=X-1-f.padInfo.left,ot=0;ot<L;++ot)for(var et=0;et<Z;++et)for(var Qe=0;Qe<V;++Qe)for(var it=Qe-we,nt=Math.max(0,Math.ceil(it/xe)),je=Math.min(oe,(B+it)/xe),Je=0;Je<j;++Je)for(var Ze=Je-Ae,Yt=Math.max(0,Math.ceil(Ze/fe)),qe=Math.min(ce,(G+Ze)/fe),vt=0;vt<re;++vt){for(var vr=vt-Ke,nn=Math.max(0,Math.ceil(vr/ge)),kr=Math.min(pe,(X+vr)/ge),mr=0,Zt=nt;Zt<je;++Zt)for(var En=Zt*xe-it,an=Yt;an<qe;++an)for(var Tn=an*fe-Ze,fr=nn;fr<kr;++fr)for(var ki=fr*ge-vr,Gs=x*ot+S*Zt+T*an+N*fr,wf=_*(B-1-En)+P*(G-1-Tn)+$*(X-1-ki)+z*et,Si=0;Si<te;++Si){var Do=w[Gs+Si],Vs=C[wf+Si];mr+=Do*Vs}p[m*ot+v*Qe+g*Je+y*vt+et]=mr}return t.makeTensorInfo(h.shape,h.dtype,h.values)}var Qge={kernelName:E.Conv3DBackpropInputV2,backendName:"cpu",kernelFunc:Jge};var eye=At(E.Cos,function(r){return Math.cos(r)}),tye={kernelName:E.Cos,backendName:"cpu",kernelFunc:eye};var rye=At(E.Cosh,function(r){return Math.cosh(r)}),nye={kernelName:E.Cosh,backendName:"cpu",kernelFunc:rye};function aye(r){for(var e=r.inputs,t=r.backend,n=r.attrs,a=e.image,i=e.boxes,o=e.boxInd,s=n.cropSize,u=n.method,c=n.extrapolationValue,l=Ge(a.shape,4),f=l[0],h=l[1],p=l[2],d=l[3],m=i.shape[0],v=Ge(s,2),g=v[0],y=v[1],w=E.buffer([m,g,y,d],"float32"),b=t.data.get(i.dataId).values,x=t.data.get(o.dataId).values,S=t.data.get(a.dataId).values,T=E.util.computeStrides(a.shape),N=E.util.computeStrides(w.shape),C=0;C<m;C++){var R=C*4,_=b[R],P=b[R+1],$=b[R+2],z=b[R+3],L=x[C];if(!(L>=f))for(var B=g>1?($-_)*(h-1)/(g-1):0,G=y>1?(z-P)*(p-1)/(y-1):0,X=0;X<g;X++){var Z=g>1?_*(h-1)+X*B:.5*(_+$)*(h-1);if(Z<0||Z>h-1){for(var V=0;V<y;V++)for(var j=0;j<d;j++){var re=j+V*N[2]+X*N[1]+C*N[0];w.values[re]=c}continue}if(u==="bilinear")for(var te=Math.floor(Z),oe=Math.ceil(Z),ce=Z-te,V=0;V<y;V++){var pe=y>1?P*(p-1)+V*G:.5*(P+z)*(p-1);if(pe<0||pe>p-1){for(var j=0;j<d;j++){var re=j+V*N[2]+X*N[1]+C*N[0];w.values[re]=c}continue}for(var xe=Math.floor(pe),fe=Math.ceil(pe),ge=pe-xe,j=0;j<d;j++){var re=j+xe*T[2]+te*T[1]+L*T[0],we=S[re];re=j+fe*T[2]+te*T[1]+L*T[0];var Ae=S[re];re=j+xe*T[2]+oe*T[1]+L*T[0];var Ke=S[re];re=j+fe*T[2]+oe*T[1]+L*T[0];var ot=S[re],et=we+(Ae-we)*ge,Qe=Ke+(ot-Ke)*ge;re=j+V*N[2]+X*N[1]+C*N[0],w.values[re]=et+(Qe-et)*ce}}else for(var V=0;V<y;++V){var pe=y>1?P*(p-1)+V*G:.5*(P+z)*(p-1);if(pe<0||pe>p-1){for(var j=0;j<d;j++){var re=j+V*N[2]+X*N[1]+C*N[0];w.values[re]=c}continue}for(var it=Math.round(pe),nt=Math.round(Z),j=0;j<d;j++){var je=j+it*T[2]+nt*T[1]+L*T[0],Je=j+V*N[2]+X*N[1]+C*N[0];w.values[Je]=S[je]}}}}return t.makeTensorInfo(w.shape,w.dtype,w.values)}var iye={kernelName:E.CropAndResize,backendName:"cpu",kernelFunc:aye};function oye(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.exclusive,s=n.reverse;Ue(a,"cumprod");var u=E.backend_util.getAxesPermutation([i],a.shape.length),c=a;u!=null&&(c=xn({inputs:{x:a},backend:t,attrs:{perm:u}}));var l=E.backend_util.getInnerMostAxes(1,a.shape.length)[0];if(l!==c.shape.length-1)throw new Error("backend.cumprod in CPU expects an inner-most "+"axis=".concat(c.shape.length-1," but got axis=").concat(l));for(var f=E.upcastType(c.dtype,"int32"),h=E.util.makeOnesTypedArray(E.util.sizeFromShape(c.shape),f),p=t.data.get(c.dataId).values,d=c.shape[c.shape.length-1],m=s?function(T,N){return T+d-N-1}:function(T,N){return T+N},v=0;v<p.length;v+=d)for(var g=0;g<d;g++){var y=m(v,g);if(g===0)h[y]=o?1:p[y];else{var w=m(v,g-1);h[y]=o?p[w]*h[w]:p[y]*h[w]}}var b=t.makeTensorInfo(c.shape,f,h);if(u!=null){var x=E.backend_util.getUndoAxesPermutation(u),S=xn({inputs:{x:b},backend:t,attrs:{perm:x}});return t.disposeIntermediateTensorInfo(b),t.disposeIntermediateTensorInfo(c),S}return b}var sye={kernelName:E.Cumprod,backendName:"cpu",kernelFunc:oye};function uye(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.exclusive,s=n.reverse;Ue(a,"cumsum");var u=E.backend_util.getAxesPermutation([i],a.shape.length),c=a;u!=null&&(c=xn({inputs:{x:a},backend:t,attrs:{perm:u}}));var l=E.backend_util.getInnerMostAxes(1,a.shape.length)[0];if(l!==c.shape.length-1)throw new Error("backend.cumsum in CPU expects an inner-most "+"axis=".concat(c.shape.length-1," but got axis=").concat(l));for(var f=E.upcastType(c.dtype,"int32"),h=E.util.makeZerosTypedArray(E.util.sizeFromShape(c.shape),f),p=t.data.get(c.dataId).values,d=c.shape[c.shape.length-1],m=s?function(T,N){return T+d-N-1}:function(T,N){return T+N},v=0;v<p.length;v+=d)for(var g=0;g<d;g++){var y=m(v,g);if(g===0)h[y]=o?0:p[y];else{var w=m(v,g-1);h[y]=o?p[w]+h[w]:p[y]+h[w]}}var b=t.makeTensorInfo(c.shape,f,h);if(u!=null){var x=E.backend_util.getUndoAxesPermutation(u),S=xn({inputs:{x:b},backend:t,attrs:{perm:x}});return t.disposeIntermediateTensorInfo(b),t.disposeIntermediateTensorInfo(c),S}return b}var cye={kernelName:E.Cumsum,backendName:"cpu",kernelFunc:uye};function lye(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.weights,o=n.size,s=n.binaryOutput;if(a.shape.length===1){var u=t.data.get(a.dataId).values,c=t.data.get(i.dataId).values,l=X0(u,c,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,l)}else if(a.shape.length===2){var f=t.bufferSync(a),h=t.bufferSync(i),p=t_(f,h,o,s);return t.makeTensorInfo(p.shape,i.dtype,p.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank"+"".concat(a.shape.length,"."))}var fye={kernelName:E.DenseBincount,backendName:"cpu",kernelFunc:lye};function hye(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.blockSize,o=n.dataFormat;E.util.assert(o==="NHWC",function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got ".concat(o)});for(var s=a.shape[0],u=a.shape[1],c=a.shape[2],l=a.shape[3],f=u*i,h=c*i,p=l/(i*i),d=t.data.get(a.dataId).values,m=new Float32Array(s*f*h*p),v=0,g=0;g<s;++g)for(var y=0;y<f;++y)for(var w=Math.floor(y/i),b=y%i,x=0;x<h;++x)for(var S=Math.floor(x/i),T=x%i,N=(b*i+T)*p,C=0;C<p;++C){var R=C+N,_=R+l*(S+c*(w+u*g));m[v++]=d[_]}return t.makeTensorInfo([s,f,h,p],a.dtype,m)}var pye={kernelName:E.DepthToSpace,backendName:"cpu",kernelFunc:hye};function t3(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=n.strides,s=n.pad,u=n.dilations,c=n.dimRoundingMode;Ue([a,i],"depthwiseConv2DNative");var l=E.util.computeStrides(a.shape),f=E.util.computeStrides(i.shape),h=u;h==null&&(h=[1,1]),E.util.assert(E.backend_util.eitherStridesOrDilationsAreOne(o,h),function(){return"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(o," and dilations '").concat(h,"'")});for(var p=E.backend_util.computeConv2DInfo(a.shape,i.shape,o,h,s,c,!0),d=p.filterHeight,m=p.filterWidth,v=p.dilationHeight,g=p.dilationWidth,y=p.padInfo,w=y.left,b=y.top,x=p.outChannels/p.inChannels,S=new E.TensorBuffer(p.outShape,a.dtype),T=t.data.get(a.dataId).values,N=t.data.get(i.dataId).values,C=S.values,R=0;R<p.batchSize;++R)for(var _=R*l[0],P=R*S.strides[0],$=0;$<p.outHeight;++$)for(var z=P+$*S.strides[1],L=$*p.strideHeight-b,B=0;B<d;++B){var G=L+B*v;if(!(G<0||G>=p.inHeight))for(var X=B*f[0],Z=_+G*l[1],V=0;V<p.outWidth;++V)for(var j=z+V*S.strides[2],re=V*p.strideWidth-w,te=0;te<m;++te){var oe=re+te*g;if(!(oe<0||oe>=p.inWidth))for(var ce=X+te*f[1],pe=Z+oe*p.inChannels,xe=j,fe=ce,ge=0;ge<p.inChannels;++ge){for(var we=T[pe+ge],Ae=0;Ae<x;++Ae)C[xe+Ae]+=we*N[fe+Ae];xe+=x,fe+=x}}}return t.makeTensorInfo(S.shape,S.dtype,S.values)}var dye={kernelName:E.DepthwiseConv2dNative,backendName:"cpu",kernelFunc:t3};function vye(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.dy,o=n.strides,s=n.dilations,u=n.pad,c=n.dimRoundingMode,l=n.filterShape;Ue([a,i],"depthwiseConv2dNativeBackpropFilter");for(var f=E.backend_util.computeConv2DInfo(a.shape,l,o,s,u,c,!0),h=f.strideHeight,p=f.strideWidth,d=f.filterHeight,m=f.filterWidth,v=new E.TensorBuffer(f.filterShape,"float32"),g=f.padInfo.left,y=f.padInfo.top,w=f.outChannels/f.inChannels,b=t.data.get(a.dataId).values,x=new E.TensorBuffer(a.shape,a.dtype,b),S=t.data.get(i.dataId).values,T=new E.TensorBuffer(i.shape,i.dtype,S),N=0;N<d;++N)for(var C=Math.max(0,Math.ceil((y-N)/h)),R=Math.min(f.outHeight,(f.inHeight+y-N)/h),_=0;_<m;++_)for(var P=Math.max(0,Math.ceil((g-_)/p)),$=Math.min(f.outWidth,(f.inWidth+g-_)/p),z=0;z<f.outChannels;++z){for(var L=Math.trunc(z/w),B=z%w,G=0,X=0;X<f.batchSize;++X)for(var Z=C;Z<R;++Z)for(var V=N+Z*h-y,j=P;j<$;++j){var re=_+j*p-g;G+=x.get(X,V,re,L)*T.get(X,Z,j,z)}v.set(G,N,_,L,B)}return t.makeTensorInfo(v.shape,v.dtype,v.values)}var mye={kernelName:E.DepthwiseConv2dNativeBackpropFilter,backendName:"cpu",kernelFunc:vye};function gye(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.filter,o=n.strides,s=n.dilations,u=n.pad,c=n.dimRoundingMode,l=n.inputShape;Ue([a,i],"depthwiseConv2DNativeBackpropInput");for(var f=E.util.computeStrides(a.shape),h=E.util.computeStrides(i.shape),p=E.backend_util.computeConv2DInfo(l,i.shape,o,s,u,c,!0),d=new E.TensorBuffer(p.inShape,"float32"),m=d.values,v=Ge(d.strides,3),g=v[0],y=v[1],w=v[2],b=t.data.get(a.dataId).values,x=Ge(f,3),S=x[0],T=x[1],N=x[2],C=t.data.get(i.dataId).values,R=Ge(h,3),_=R[0],P=R[1],$=R[2],z=p.batchSize,L=p.filterHeight,B=p.filterWidth,G=p.inChannels,X=p.inHeight,Z=p.inWidth,V=p.outChannels,j=p.outHeight,re=p.outWidth,te=p.strideHeight,oe=p.strideWidth,ce=L-1-p.padInfo.top,pe=B-1-p.padInfo.left,xe=V/G,fe=0;fe<z;++fe)for(var ge=0;ge<G;++ge)for(var we=0;we<X;++we)for(var Ae=we-ce,Ke=Math.max(0,Math.ceil(Ae/te)),ot=Math.min(j,(L+Ae)/te),et=0;et<Z;++et){for(var Qe=et-pe,it=Math.max(0,Math.ceil(Qe/oe)),nt=Math.min(re,(B+Qe)/oe),je=0,Je=Ke;Je<ot;++Je)for(var Ze=Je*te-Ae,Yt=it;Yt<nt;++Yt)for(var qe=Yt*oe-Qe,vt=S*fe+T*Je+N*Yt,vr=_*(L-1-Ze)+P*(B-1-qe)+$*ge,nn=0;nn<xe;++nn){var kr=ge*xe+nn,mr=b[vt+kr],Zt=C[vr+nn];je+=mr*Zt}m[g*fe+y*we+w*et+ge]=je}return t.makeTensorInfo(d.shape,d.dtype,d.values)}var yye={kernelName:E.DepthwiseConv2dNativeBackpropInput,backendName:"cpu",kernelFunc:gye};function bye(r){for(var e=r.inputs,t=r.backend,n=e.x,a=E.util.sizeFromShape(n.shape),i=t.data.get(n.dataId).values,o=E.buffer([a,a],n.dtype),s=o.values,u=0;u<i.length;u++)s[u*a+u]=i[u];var c=na(na([],Ge(n.shape),!1),Ge(n.shape),!1);return t.makeTensorInfo(c,o.dtype,o.values)}var wye={kernelName:E.Diag,backendName:"cpu",kernelFunc:bye};var xye={kernelName:E.Dilation2D,backendName:"cpu",kernelFunc:function(r){for(var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=n.strides,s=n.pad,u=n.dilations,c=t,l=c.data.get(a.dataId).values,f=a.shape.length,h=c.data.get(i.dataId).values,p=i.shape.length,d=E.backend_util.computeDilation2DInfo(a.shape,i.shape,o,s,"NHWC",u),m=d.batchSize,v=d.inHeight,g=d.inWidth,y=d.inChannels,w=d.outHeight,b=d.outWidth,x=d.padInfo,S=d.strideHeight,T=d.strideWidth,N=d.filterHeight,C=d.filterWidth,R=d.dilationHeight,_=d.dilationWidth,P=d.outShape,$=E.util.sizeFromShape(P),z=P.length,L=E.util.getArrayFromDType(a.dtype,$),B=0;B<m;++B)for(var G=0;G<w;++G)for(var X=G*S-x.top,Z=0;Z<b;++Z)for(var V=Z*T-x.left,j=0;j<y;++j){for(var re=Number.MIN_SAFE_INTEGER,te=0;te<N;++te){var oe=X+te*R;if(oe>=0&&oe<v)for(var ce=0;ce<C;++ce){var pe=V+ce*_;if(pe>=0&&pe<g){var xe=E.util.locToIndex([B,oe,pe,j],f,E.util.computeStrides(a.shape)),fe=E.util.locToIndex([te,ce,j],p,E.util.computeStrides(i.shape)),ge=l[xe]+h[fe];ge>re&&(re=ge)}}}var we=E.util.locToIndex([B,G,Z,j],z,E.util.computeStrides(P));L[we]=re}var Ae=c.write(E.util.toTypedArray(L,a.dtype),P,a.dtype);return{dataId:Ae,shape:P,dtype:a.dtype}}};var kye={kernelName:E.Dilation2DBackpropFilter,backendName:"cpu",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=e.dy,s=n.strides,u=n.pad,c=n.dilations,l=t,f=E.util.toNestedArray(a.shape,l.data.get(a.dataId).values),h=E.util.toNestedArray(i.shape,l.data.get(i.dataId).values),p=E.backend_util.computeDilation2DInfo(a.shape,i.shape,s,u,"NHWC",c),d=p.batchSize,m=p.inHeight,v=p.inWidth,g=p.inChannels,y=p.outHeight,w=p.outWidth,b=p.padInfo,x=p.strideHeight,S=p.strideWidth,T=p.filterHeight,N=p.filterWidth,C=p.dilationHeight,R=p.dilationWidth,_=p.outShape;E.util.assert(o.rank===_.length,function(){return"Error in ".concat(E.Dilation2DBackpropFilter,", dy ")+"must have the same rank as output ".concat(_.length,", but got ")+"".concat(o.rank)});for(var P=E.util.toNestedArray(_,l.data.get(o.dataId).values),$=E.util.makeZerosNestedTypedArray(i.shape,i.dtype),z=0;z<d;++z)for(var L=0;L<y;++L)for(var B=L*x-b.top,G=0;G<w;++G)for(var X=G*S-b.left,Z=0;Z<g;++Z){for(var V=Number.MIN_SAFE_INTEGER,j=0,re=0,te=0;te<T;++te){var oe=B+te*C;if(oe>=0&&oe<m)for(var ce=0;ce<N;++ce){var pe=X+ce*R;if(pe>=0&&pe<v){var xe=f[z][oe][pe][Z]+h[te][ce][Z];xe>V&&(V=xe,j=te,re=ce)}}}$[j][re][Z]+=P[z][L][G][Z]}var fe=l.write(E.util.toTypedArray($,a.dtype),i.shape,i.dtype);return{dataId:fe,shape:i.shape,dtype:i.dtype}}};var Sye={kernelName:E.Dilation2DBackpropInput,backendName:"cpu",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=e.dy,s=n.strides,u=n.pad,c=n.dilations,l=t,f=E.util.toNestedArray(a.shape,l.data.get(a.dataId).values),h=E.util.toNestedArray(i.shape,l.data.get(i.dataId).values),p=E.backend_util.computeDilation2DInfo(a.shape,i.shape,s,u,"NHWC",c),d=p.batchSize,m=p.inHeight,v=p.inWidth,g=p.inChannels,y=p.outHeight,w=p.outWidth,b=p.padInfo,x=p.strideHeight,S=p.strideWidth,T=p.filterHeight,N=p.filterWidth,C=p.dilationHeight,R=p.dilationWidth,_=p.outShape;E.util.assert(o.rank===_.length,function(){return"Error in ".concat(E.Dilation2DBackpropInput,", dy ")+"must have the same rank as output ".concat(_.length,", but got ")+"".concat(o.rank)});for(var P=E.util.toNestedArray(_,l.data.get(o.dataId).values),$=E.util.makeZerosNestedTypedArray(a.shape,a.dtype),z=0;z<d;++z)for(var L=0;L<y;++L)for(var B=L*x-b.top,G=0;G<w;++G)for(var X=G*S-b.left,Z=0;Z<g;++Z){for(var V=Number.MIN_SAFE_INTEGER,j=B<0?0:B,re=X<0?0:X,te=0;te<T;++te){var oe=B+te*C;if(oe>=0&&oe<m)for(var ce=0;ce<N;++ce){var pe=X+ce*R;if(pe>=0&&pe<v){var xe=f[z][oe][pe][Z]+h[te][ce][Z];xe>V&&(V=xe,j=oe,re=pe)}}}$[z][j][re][Z]+=P[z][L][G][Z]}var fe=l.write(E.util.toTypedArray($,a.dtype),a.shape,a.dtype);return{dataId:fe,shape:a.shape,dtype:a.dtype}}};function Eye(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.image,i=n.canvas,o=n.options,s=o||{},u=s.contextOptions,c=s.imageOptions,l=c?.alpha||1,f=u?.contextType||"2d";if(f!=="2d")throw new Error("Context type ".concat(u.contextType," is not supported by the CPU backend."));var h=i.getContext(f,u?.contextAttributes||{});if(h==null)throw new Error("Could not get the context with ".concat(f," type."));for(var p=Ge(a.shape.slice(0,2),2),d=p[0],m=p[1],v=a.shape.length===2?1:a.shape[2],g=t.data.get(a.dataId).values,y=a.dtype==="float32"?255:1,w=new Uint8ClampedArray(m*d*4),b=0;b<d*m;++b){for(var x=[0,0,0,255*l],S=0;S<v;S++){var T=g[b*v+S];if(a.dtype==="float32"){if(T<0||T>1)throw new Error("Tensor values for a float32 Tensor must be in the "+"range [0 - 1] but encountered ".concat(T,"."))}else if(a.dtype==="int32"&&(T<0||T>255))throw new Error("Tensor values for a int32 Tensor must be in the "+"range [0 - 255] but encountered ".concat(T,"."));v===1?(x[0]=T*y,x[1]=T*y,x[2]=T*y):x[S]=T*y}var N=b*4;w[N+0]=Math.round(x[0]),w[N+1]=Math.round(x[1]),w[N+2]=Math.round(x[2]),w[N+3]=Math.round(x[3])}i.width=m,i.height=d;var C=new ImageData(w,m,d);return h.putImageData(C,0,0),a}var Tye={kernelName:E.Draw,backendName:"cpu",kernelFunc:Eye};function $l(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims;Ue(a,"sum");var s;a.dtype==="bool"?s=So({inputs:{x:a},backend:t,attrs:{dtype:"int32"}}):s=mi({inputs:{x:a},backend:t});var u=s.shape.length,c=E.util.parseAxisParam(i,s.shape),l=E.backend_util.getAxesPermutation(c,u),f=c,h=s;l!=null&&(h=xn({inputs:{x:s},backend:t,attrs:{perm:l}}),f=E.backend_util.getInnerMostAxes(f.length,u)),E.backend_util.assertAxesAreInnerMostDims("sum",f,h.shape.length);for(var p=Ge(E.backend_util.computeOutAndReduceShapes(h.shape,f),2),d=p[0],m=p[1],v=E.backend_util.upcastType(h.dtype,"int32"),g=$p(t,d,v),y=E.util.sizeFromShape(m),w=t.data.get(g.dataId).values,b=t.data.get(h.dataId).values,x=0;x<w.length;++x){for(var S=x*y,T=0,N=0;N<y;++N)T+=b[S+N];w[x]=T}if(o){var C=E.backend_util.expandShapeToKeepDim(g.shape,c),R=g;g=Mt({inputs:{x:g},backend:t,attrs:{shape:C}}),t.disposeIntermediateTensorInfo(R)}return t.disposeIntermediateTensorInfo(s),l!=null&&t.disposeIntermediateTensorInfo(h),g}var Nye={kernelName:E.Sum,backendName:"cpu",kernelFunc:$l};function Iye(r){var e,t,n,a,i=r.inputs,o=r.backend,s=r.attrs,u=s.equation,c=i,l=E.backend_util.decodeEinsumEquation(u,c.length),f=l.allDims,h=l.summedDims,p=l.idDims;E.backend_util.checkEinsumDimSizes(f.length,p,c);for(var d=E.backend_util.getEinsumComputePath(h,p),m=d.path,v=d.steps,g=v.length,y=null,w=f.length,b=[],x=0;x<g;++x){try{for(var S=(e=void 0,Lu(v[x])),T=S.next();!T.done;T=S.next()){var N=T.value,C=E.backend_util.getEinsumPermutation(w,p[N]),R=C.permutationIndices,_=C.expandDims,P=void 0;E.backend_util.isIdentityPermutation(R)?P=c[N]:(P=xn({inputs:{x:c[N]},backend:o,attrs:{perm:R}}),b.push(P));for(var $=P.shape.slice(),z=0;z<_.length;++z)$.splice(_[z],0,1);E.util.arraysEqual(P.shape,$)||(P=Mt({inputs:{x:P},backend:o,attrs:{shape:$}}),b.push(P)),y===null?y=P:(y=Up({inputs:{a:P,b:y},backend:o}),b.push(y))}}catch(X){e={error:X}}finally{try{T&&!T.done&&(t=S.return)&&t.call(S)}finally{if(e)throw e.error}}x<g-1&&(m[x]>=0&&(y=$l({inputs:{x:y},backend:o,attrs:{axis:m[x]-(f.length-w),keepDims:!1}}),b.push(y)),w--)}try{for(var L=Lu(b),B=L.next();!B.done;B=L.next()){var G=B.value;G!==y&&o.disposeIntermediateTensorInfo(G)}}catch(X){n={error:X}}finally{try{B&&!B.done&&(a=L.return)&&a.call(L)}finally{if(n)throw n.error}}return y}var Cye={kernelName:E.Einsum,backendName:"cpu",kernelFunc:Iye};function Aye(r){var e=r.inputs,t=r.backend,n=e.dy,a=e.y;Ue([n,a],"eluGrad");for(var i=new Float32Array(E.util.sizeFromShape(a.shape)),o=t.data.get(a.dataId).values,s=t.data.get(n.dataId).values,u=0;u<o.length;++u){var c=o[u];c>=0?i[u]=s[u]:i[u]=s[u]*(c+1)}return t.makeTensorInfo(a.shape,"float32",i)}var Dye={kernelName:E.EluGrad,backendName:"cpu",kernelFunc:Aye};var _ye=E.backend_util.ERF_P,Fye=E.backend_util.ERF_A1,Rye=E.backend_util.ERF_A2,Oye=E.backend_util.ERF_A3,Pye=E.backend_util.ERF_A4,Mye=E.backend_util.ERF_A5,Bye=At(E.Erf,function(r){var e=Math.sign(r),t=Math.abs(r),n=1/(1+_ye*t);return e*(1-((((Mye*n+Pye)*n+Oye)*n+Rye)*n+Fye)*n*Math.exp(-t*t))}),Lye={kernelName:E.Erf,backendName:"cpu",kernelFunc:Bye};function Gp(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.input,i=n.dim,o=a.shape.length,s=a.shape.slice(),u=i;return i<0&&(E.util.assert(-(o+1)<=i,function(){return"Axis must be in the interval [".concat(-(o+1),", ").concat(o,"]")}),u=o+i+1),s.splice(u,0,1),Mt({inputs:{x:a},backend:t,attrs:{shape:s}})}var zye={kernelName:E.ExpandDims,backendName:"cpu",kernelFunc:Gp};var $ye=br(function(r,e){return r/e}),tb=Rr(E.RealDiv,$ye),H0={kernelName:E.RealDiv,backendName:"cpu",kernelFunc:tb};function r3(r,e,t){for(var n=r.shape,a=n[0],i=n[1],o=t.data.get(r.dataId),s=o.complexTensorInfos.real,u=o.complexTensorInfos.imag,c=[a,i],l=E.util.sizeFromShape(c),f=E.util.getTypedArrayFromDType("float32",l),h=E.util.getTypedArrayFromDType("float32",l),p=0;p<a;p++){for(var d=As({inputs:{x:s},backend:t,attrs:{begin:[p,0],size:[1,i]}}),m=As({inputs:{x:u},backend:t,attrs:{begin:[p,0],size:[1,i]}}),v=qn({inputs:{real:d,imag:m},backend:t}),g=Wye(v,e,t),y=g.real,w=g.imag,b=E.backend_util.mergeRealAndImagArrays(y,w),x=0;x<i;x++){var S=E.backend_util.getComplexWithIndex(b,x);f[p*i+x]=S.real,h[p*i+x]=S.imag}t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(v)}var T=t.makeTensorInfo(c,"float32",f),N=t.makeTensorInfo(c,"float32",h),C=qn({inputs:{real:T,imag:N},backend:t});return t.disposeIntermediateTensorInfo(T),t.disposeIntermediateTensorInfo(N),C}function Wye(r,e,t){var n=E.util.sizeFromShape(r.shape),a=t.data.get(r.dataId),i=t.data.get(a.complexTensorInfos.real.dataId).values,o=t.data.get(a.complexTensorInfos.imag.dataId).values;if(Gye(n)){var s=q0(i,o,n,e,t),u=[r.shape[0],r.shape[1]];if(e){var c=t.makeTensorInfo(u,"float32",s.real),l=t.makeTensorInfo(u,"float32",s.imag),f=t.makeTensorInfo([],"float32",E.util.createScalarValue(n,"float32")),h=mi({inputs:{x:f},backend:t}),p=H0.kernelFunc({inputs:{a:c,b:f},backend:t}),d=H0.kernelFunc({inputs:{a:l,b:h},backend:t}),m=t.data.get(p.dataId).values,v=t.data.get(d.dataId).values;return t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(d),{real:m,imag:v}}return s}else{var g=E.backend_util.mergeRealAndImagArrays(i,o),y=Vye(g,n,e);return E.backend_util.splitRealAndImagArrays(y)}}function Gye(r){return(r&r-1)===0}function q0(r,e,t,n,a){if(t===1)return{real:r,imag:e};var i=E.backend_util.mergeRealAndImagArrays(r,e),o=t/2,s=E.backend_util.complexWithEvenIndex(i),u=s.real,c=s.imag,l=[u.length],f=a.makeTensorInfo(l,"float32",u),h=a.makeTensorInfo(l,"float32",c),p=qn({inputs:{real:f,imag:h},backend:a}),d=E.backend_util.complexWithOddIndex(i),m=d.real,v=d.imag,g=[m.length],y=a.makeTensorInfo(g,"float32",m),w=a.makeTensorInfo(g,"float32",v),b=qn({inputs:{real:y,imag:w},backend:a}),x=q0(u,c,o,n,a),S=x.real,T=x.imag,N=[S.length],C=a.makeTensorInfo(N,"float32",S),R=a.makeTensorInfo(N,"float32",T),_=qn({inputs:{real:C,imag:R},backend:a}),P=q0(m,v,o,n,a),$=P.real,z=P.imag,L=[$.length],B=a.makeTensorInfo(L,"float32",$),G=a.makeTensorInfo(L,"float32",z),X=qn({inputs:{real:B,imag:G},backend:a}),Z=E.backend_util.exponents(t,n),V=[Z.real.length],j=a.makeTensorInfo(V,"float32",Z.real),re=a.makeTensorInfo(V,"float32",Z.imag),te=qn({inputs:{real:j,imag:re},backend:a}),oe=Up({inputs:{a:te,b:X},backend:a}),ce=zu({inputs:{a:_,b:oe},backend:a}),pe=Q0({inputs:{a:_,b:oe},backend:a}),xe=Cs({inputs:{input:ce},backend:a}),fe=Cs({inputs:{input:pe},backend:a}),ge=$u({inputs:{input:ce},backend:a}),we=$u({inputs:{input:pe},backend:a}),Ae=Wu({inputs:[xe,fe],backend:a,attrs:{axis:0}}),Ke=Wu({inputs:[ge,we],backend:a,attrs:{axis:0}}),ot=a.data.get(Ae.dataId).values,et=a.data.get(Ke.dataId).values;return a.disposeIntermediateTensorInfo(f),a.disposeIntermediateTensorInfo(h),a.disposeIntermediateTensorInfo(p),a.disposeIntermediateTensorInfo(y),a.disposeIntermediateTensorInfo(w),a.disposeIntermediateTensorInfo(b),a.disposeIntermediateTensorInfo(C),a.disposeIntermediateTensorInfo(R),a.disposeIntermediateTensorInfo(_),a.disposeIntermediateTensorInfo(B),a.disposeIntermediateTensorInfo(G),a.disposeIntermediateTensorInfo(X),a.disposeIntermediateTensorInfo(j),a.disposeIntermediateTensorInfo(re),a.disposeIntermediateTensorInfo(te),a.disposeIntermediateTensorInfo(oe),a.disposeIntermediateTensorInfo(ce),a.disposeIntermediateTensorInfo(pe),a.disposeIntermediateTensorInfo(xe),a.disposeIntermediateTensorInfo(ge),a.disposeIntermediateTensorInfo(fe),a.disposeIntermediateTensorInfo(we),a.disposeIntermediateTensorInfo(Ae),a.disposeIntermediateTensorInfo(Ke),{real:ot,imag:et}}function Vye(r,e,t){for(var n=new Float32Array(e*2),a=0;a<e;a++){for(var i=0,o=0,s=0;s<e;s++){var u=E.backend_util.exponent(a*s,e,t),c=E.backend_util.getComplexWithIndex(r,s);i+=c.real*u.real-c.imag*u.imag,o+=c.real*u.imag+c.imag*u.real}t&&(i/=e,o/=e),E.backend_util.assignToTypedArray(n,i,o,a)}return n}function Uye(r){var e=r.inputs,t=r.backend,n=e.input,a=E.util.sizeFromShape(n.shape),i=n.shape[n.shape.length-1],o=a/i,s=Mt({inputs:{x:n},backend:t,attrs:{shape:[o,i]}}),u=r3(s,!1,t),c=Mt({inputs:{x:u},backend:t,attrs:{shape:n.shape}});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(u),c}var Hye={kernelName:E.FFT,backendName:"cpu",kernelFunc:Uye};function rb(r){var e=r.backend,t=r.attrs,n=t.shape,a=t.value,i=t.dtype,o=i||E.util.inferDtype(a),s=E.util.getArrayFromDType(o,E.util.sizeFromShape(n));return Kye(s,a,o),e.makeTensorInfo(n,o,s)}var qye={kernelName:E.Fill,backendName:"cpu",kernelFunc:rb};function Kye(r,e,t){r.fill(e)}var jye={kernelName:E.FlipLeftRight,backendName:"cpu",kernelFunc:function(r){var e=r.inputs;r.attrs;for(var t=r.backend,n=e.image,a=t,i=E.util.getTypedArrayFromDType(n.dtype,E.util.sizeFromShape(n.shape)),o=Ge(n.shape,4),s=o[0],u=o[1],c=o[2],l=o[3],f=a.data.get(n.dataId).values,h=0;h<s;h++)for(var p=h*c*u*l,d=0;d<u;d++)for(var m=d*(c*l),v=0;v<c;v++)for(var g=v*l,y=0;y<l;y++){var w=Math.round(c-v-1),b=p+m+g+y,x=f[b];if(w>=0&&w<c){var S=w*l,T=p+m+S+y;x=f[T]}i[b]=x}var N=a.write(i,n.shape,n.dtype);return{dataId:N,shape:n.shape,dtype:n.dtype}}};function Xye(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=e.bias,s=e.preluActivationWeights,u=n.strides,c=n.pad,l=n.dataFormat,f=n.dilations,h=n.dimRoundingMode,p=n.activation,d=n.leakyreluAlpha,m=e3({inputs:{x:a,filter:i},backend:t,attrs:{strides:u,pad:c,dataFormat:l,dilations:f,dimRoundingMode:h}});if(o){var v=m;if(l==="NCHW"&&o.shape.length===1&&o.shape[0]!==1){var g=Mt({inputs:{x:o},backend:t,attrs:{shape:[o.shape[0],1,1]}});m=zu({inputs:{a:m,b:g},backend:t}),t.disposeIntermediateTensorInfo(g)}else m=zu({inputs:{a:m,b:o},backend:t});t.disposeIntermediateTensorInfo(v)}if(p){var v=m;if(l==="NCHW"&&p==="prelu"&&s.shape.length===1&&s.shape[0]!==1){var y=Mt({inputs:{x:s},backend:t,attrs:{shape:[s.shape[0],1,1]}});m=Wp(t,m,p,y,d),t.disposeIntermediateTensorInfo(y)}else m=Wp(t,m,p,s,d);t.disposeIntermediateTensorInfo(v)}return m}var Yye={kernelName:E.FusedConv2D,backendName:"cpu",kernelFunc:Xye};function Zye(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=e.bias,s=e.preluActivationWeights,u=n.strides,c=n.pad,l=n.dataFormat,f=n.dilations,h=n.dimRoundingMode,p=n.activation,d=n.leakyreluAlpha,m=t3({inputs:{x:a,filter:i},backend:t,attrs:{strides:u,pad:c,dataFormat:l,dilations:f,dimRoundingMode:h}});if(o){var v=m;m=zu({inputs:{a:m,b:o},backend:t}),t.disposeIntermediateTensorInfo(v)}if(p){var v=m;m=Wp(t,m,p,s,d),t.disposeIntermediateTensorInfo(v)}return m}var Jye={kernelName:E.FusedDepthwiseConv2D,backendName:"cpu",kernelFunc:Zye};function Qye(r){var e=r.inputs,t=r.backend,n=e.params,a=e.indices,i=E.util.sizeFromShape(n.shape),o=a.shape,s=o[o.length-1],u=Ge(E.backend_util.prepareAndValidate(n,a),4),c=u[0],l=u[1],f=u[2],h=u[3];if(l===0)return t.makeTensorInfo(c,n.dtype,[]);var p=t.data.get(a.dataId).values,d=t.bufferSync(n),m=h_(p,d,n.dtype,l,s,f,h,n.shape,i);return t.makeTensorInfo(c,n.dtype,m.values)}var e0e={kernelName:E.GatherNd,backendName:"cpu",kernelFunc:Qye};function t0e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.indices,o=n.axis,s=n.batchDims;Ue([a,i],"gatherV2");for(var u=E.util.parseAxisParam(o,a.shape)[0],c=t.data.get(i.dataId).values,l=a.shape[u],f=function(S){var T=c[S];E.util.assert(T<=l-1&&T>=0,function(){return"GatherV2: the index value ".concat(T," is not in [0, ").concat(l-1,"]")})},h=0;h<c.length;++h)f(h);var p=s;s==null&&(p=0);var d=E.util.sizeFromShape(i.shape),m=E.backend_util.segment_util.collectGatherOpShapeInfo(a,i,u,p),v=Mt({inputs:{x:a},backend:t,attrs:{shape:[m.batchSize,m.outerSize,m.dimSize,m.sliceSize]}}),g=Mt({inputs:{x:i},backend:t,attrs:{shape:[m.batchSize,d/m.batchSize]}}),y=[m.batchSize,m.outerSize,d/m.batchSize,m.sliceSize],w=t.bufferSync(g),b=t.bufferSync(v),x=p_(b,w,y);return t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(g),t.makeTensorInfo(m.outputShape,x.dtype,x.values)}var r0e={kernelName:E.GatherV2,backendName:"cpu",kernelFunc:t0e};function n0e(r){var e=r.inputs,t=r.backend,n=e.input,a=E.util.sizeFromShape(n.shape),i=n.shape[n.shape.length-1],o=a/i,s=Mt({inputs:{x:n},backend:t,attrs:{shape:[o,i]}}),u=r3(s,!0,t),c=Mt({inputs:{x:u},backend:t,attrs:{shape:n.shape}});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(u),c}var a0e={kernelName:E.IFFT,backendName:"cpu",kernelFunc:n0e};var i0e=At(E.IsFinite,function(r){return Number.isFinite(r)?1:0},"bool"),o0e={kernelName:E.IsFinite,backendName:"cpu",kernelFunc:i0e};var s0e=At(E.IsInf,function(r){return Math.abs(r)===1/0?1:0},"bool"),u0e={kernelName:E.IsInf,backendName:"cpu",kernelFunc:s0e};var c0e=At(E.IsNan,function(r){return Number.isNaN(r)?1:0},"bool"),l0e={kernelName:E.IsNan,backendName:"cpu",kernelFunc:c0e};function f0e(r){var e=r.backend,t=r.attrs,n=t.start,a=t.stop,i=t.num,o=y_(n,a,i);return e.makeTensorInfo([o.length],"float32",o)}var h0e={kernelName:E.LinSpace,backendName:"cpu",kernelFunc:f0e};var p0e=At(E.Log1p,function(r){return Math.log1p(r)}),d0e={kernelName:E.Log1p,backendName:"cpu",kernelFunc:p0e};var v0e=br(function(r,e){return r&&e}),m0e=Rr(E.LogicalAnd,v0e,null,"bool"),g0e={kernelName:E.LogicalAnd,backendName:"cpu",kernelFunc:m0e};var y0e=At(E.LogicalNot,function(r){return r?0:1},"bool"),b0e={kernelName:E.LogicalNot,backendName:"cpu",kernelFunc:y0e};var w0e=br(function(r,e){return r||e}),x0e=Rr(E.LogicalOr,w0e,null,"bool"),k0e={kernelName:E.LogicalOr,backendName:"cpu",kernelFunc:x0e};function S0e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.depthRadius,o=n.bias,s=n.alpha,u=n.beta;Ue(a,"LRN");var c=a.shape[3],l=c-1,f=t.data.get(a.dataId).values,h=E.util.sizeFromShape(a.shape),p=new Float32Array(h);function d(y){for(var w=y%c,b=y-w+Math.max(0,w-i),x=y-w+Math.min(w+i,l),S=0;b<=x;b++){var T=f[b];S+=T*T}return S}for(var m=0;m<h;m++){var v=d(m),g=f[m]*Math.pow(o+s*v,-u);p[m]=g}return t.makeTensorInfo(a.shape,a.dtype,p)}var E0e={kernelName:E.LRN,backendName:"cpu",kernelFunc:S0e};function T0e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.y,o=e.dy,s=n.depthRadius,u=n.bias,c=n.alpha,l=n.beta;Ue(o,"LRNGrad");for(var f=E.util.sizeFromShape(o.shape),h=o.shape[3],p=t.data.get(o.dataId).values,d=t.data.get(a.dataId).values,m=t.data.get(i.dataId).values,v=new Float32Array(f),g=f,y=0;y<g;y++){for(var w=y%h,b=y-w+Math.max(0,w-s),x=y-w+Math.min(h,w+s+1),S=0,T=b;T<x;T++)S+=Math.pow(d[T],2);S=c*S+u;for(var T=b;T<x;T++){var N=-2*c*l*d[T]*m[y]/S;y===T&&(N+=Math.pow(S,-l)),N*=p[y],v[T]+=N}}return t.makeTensorInfo(o.shape,a.dtype,v)}var N0e={kernelName:E.LRNGrad,backendName:"cpu",kernelFunc:T0e};function n3(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.reductionIndices,o=n.keepDims,s=t,u=a.shape,c=u.length,l=E.util.parseAxisParam(i,u),f=l,h=E.backend_util.getAxesPermutation(f,c),p=s.data.get(a.dataId).values;if(h!=null){for(var d=new Array(c),m=0;m<d.length;m++)d[m]=u[h[m]];p=Z0(p,u,a.dtype,h,d),f=E.backend_util.getInnerMostAxes(f.length,c),u=d}Ue(a,"max"),E.backend_util.assertAxesAreInnerMostDims("max",f,c);var v=Ge(E.backend_util.computeOutAndReduceShapes(u,f),2),g=v[0],y=v[1],w=E.util.sizeFromShape(y),b=w_(p,w,g,a.dtype),x=s.write(b,g,a.dtype),S=g;if(o){var d=E.backend_util.expandShapeToKeepDim(g,l);S=d}return{dataId:x,shape:S,dtype:a.dtype}}var I0e={kernelName:E.Max,backendName:"cpu",kernelFunc:n3};function C0e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x;Ue(a,"maxPool");var i=n.filterSize,o=n.strides,s=n.pad,u=n.dimRoundingMode,c=1;E.util.assert(E.backend_util.eitherStridesOrDilationsAreOne(o,c),function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(c,"'")});var l=E.backend_util.computePool2DInfo(a.shape,i,o,c,s,u),f;if(l.filterWidth===1&&l.filterHeight===1&&E.util.arraysEqual(l.inShape,l.outShape))f=mi({inputs:{x:a},backend:t});else{var h=t.data.get(a.dataId).values,p=E.util.computeStrides(a.shape),d=eb(h,a.shape,a.dtype,p,l,"max");f=t.makeTensorInfo(l.outShape,a.dtype,d.values)}return f}var A0e={kernelName:E.MaxPool,backendName:"cpu",kernelFunc:C0e};function D0e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.filterSize,o=n.strides,s=n.pad,u=n.dimRoundingMode,c=n.dataFormat;Ue(a,"maxPool3d");var l=E.backend_util.computePool3DInfo(a.shape,i,o,1,s,u,c),f=t.data.get(a.dataId).values,h=Q_(f,a.shape,a.dtype,E.util.computeStrides(a.shape),l,"max");return t.makeTensorInfo(h.shape,"float32",h.values)}var _0e={kernelName:E.MaxPool3D,backendName:"cpu",kernelFunc:D0e};function F0e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.input,o=n.filterSize,s=n.strides,u=n.pad,c=n.dimRoundingMode;Ue([a,i],"maxPool3DGrad");for(var l=E.backend_util.computePool3DInfo(i.shape,o,s,1,u,c),f=t.bufferSync(i),h=wge(f,l),p=l.strideDepth,d=l.strideHeight,m=l.strideWidth,v=l.dilationDepth,g=l.dilationHeight,y=l.dilationWidth,w=l.effectiveFilterDepth,b=l.effectiveFilterHeight,x=l.effectiveFilterWidth,S=w-1-l.padInfo.front,T=x-1-l.padInfo.left,N=b-1-l.padInfo.top,C=E.buffer(i.shape,"float32"),R=t.bufferSync(a),_=0;_<l.batchSize;++_)for(var P=0;P<l.inChannels;++P)for(var $=0;$<l.inDepth;++$)for(var z=0;z<l.inHeight;++z)for(var L=0;L<l.inWidth;++L){for(var B=$-S,G=z-N,X=L-T,Z=0,V=0;V<w;V+=v){var j=(B+V)/p;if(!(j<0||j>=l.outDepth||Math.floor(j)!==j))for(var re=0;re<b;re+=g){var te=(G+re)/d;if(!(te<0||te>=l.outHeight||Math.floor(te)!==te))for(var oe=0;oe<x;oe+=y){var ce=(X+oe)/m;if(!(ce<0||ce>=l.outWidth||Math.floor(ce)!==ce)){var pe=w*b*x-1-h.get(_,j,te,ce,P),xe=V*b*x+re*x+oe,fe=pe===xe?1:0;if(fe!==0){var ge=R.get(_,j,te,ce,P);Z+=ge*fe}}}}}C.set(Z,_,$,z,L,P)}return t.makeTensorInfo(C.shape,C.dtype,C.values)}var R0e={kernelName:E.MaxPool3DGrad,backendName:"cpu",kernelFunc:F0e};function O0e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.input,o=e.output,s=i;Ue([i,o],"maxPoolGrad");for(var u=n.filterSize,c=n.strides,l=n.pad,f=n.dimRoundingMode,h=E.backend_util.computePool2DInfo(s.shape,u,c,1,l,f),p=t.data.get(s.dataId).values,d=E.buffer(h.outShape,s.dtype,J_(p,s.shape,s.dtype,h).values),m=h.strideHeight,v=h.strideWidth,g=h.dilationHeight,y=h.dilationWidth,w=h.effectiveFilterHeight,b=h.effectiveFilterWidth,x=b-1-h.padInfo.left,S=w-1-h.padInfo.top,T=E.buffer(s.shape,"float32"),N=t.data.get(a.dataId).values,C=E.buffer(a.shape,"float32",N),R=0;R<h.batchSize;++R)for(var _=0;_<h.inChannels;++_)for(var P=0;P<h.inHeight;++P)for(var $=0;$<h.inWidth;++$){for(var z=P-S,L=$-x,B=0,G=0;G<w;G+=g){var X=(z+G)/m;if(!(X<0||X>=h.outHeight||Math.floor(X)!==X))for(var Z=0;Z<b;Z+=y){var V=(L+Z)/v;if(!(V<0||V>=h.outWidth||Math.floor(V)!==V)){var j=w*b-1-d.get(R,X,V,_),re=G*b+Z,te=j===re?1:0;if(te!==0){var oe=C.get(R,X,V,_);B+=oe*te}}}}T.set(B,R,P,$,_)}return t.makeTensorInfo(T.shape,T.dtype,T.values)}var P0e={kernelName:E.MaxPoolGrad,backendName:"cpu",kernelFunc:O0e};function M0e(r,e,t,n,a){var i=E.util.computeStrides(e),o=eb(r,e,t,i,a,"max"),s=J_(r,e,t,a,!0,n);return[o.values,s.values]}var B0e={kernelName:E.MaxPoolWithArgmax,backendName:"cpu",kernelFunc:function(r){var e=r.inputs,t=r.attrs,n=r.backend,a=e.x,i=t.filterSize,o=t.strides,s=t.pad,u=t.includeBatchInIndex,c=n;Ue(a,"MaxPoolWithArgmax");var l=c.data.get(a.dataId).values,f=E.backend_util.computePool2DInfo(a.shape,i,o,[1,1],s),h=Ge(M0e(l,a.shape,a.dtype,u,f),2),p=h[0],d=h[1],m=c.write(p,f.outShape,a.dtype),v=c.write(d,f.outShape,a.dtype);return[{dataId:m,shape:f.outShape,dtype:a.dtype},{dataId:v,shape:f.outShape,dtype:"int32"}]}};function L0e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims,s=E.util.parseAxisParam(i,a.shape),u=E.backend_util.computeOutAndReduceShapes(a.shape,s),c=u[1],l=E.util.sizeFromShape(c),f=[],h=t.makeTensorInfo([],"float32",new Float32Array([l]));f.push(h);var p=So({inputs:{x:a},backend:t,attrs:{dtype:"float32"}});f.push(p);var d=tb({inputs:{a:p,b:h},backend:t});f.push(d);var m=$l({inputs:{x:d},backend:t,attrs:{axis:i,keepDims:o}});return f.forEach(function(v){return t.disposeIntermediateTensorInfo(v)}),m}var z0e={kernelName:E.Mean,backendName:"cpu",kernelFunc:L0e};function $0e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims;Ue(a,"min");var s=E.util.parseAxisParam(i,a.shape),u=s,c=E.backend_util.getAxesPermutation(u,a.shape.length),l=a;c!=null&&(l=xn({inputs:{x:a},backend:t,attrs:{perm:c}}),u=E.backend_util.getInnerMostAxes(u.length,a.shape.length)),E.backend_util.assertAxesAreInnerMostDims("min",u,l.shape.length);for(var f=Ge(E.backend_util.computeOutAndReduceShapes(l.shape,u),2),h=f[0],p=f[1],d=E.util.sizeFromShape(p),m=E.util.makeZerosTypedArray(E.util.sizeFromShape(h),l.dtype),v=t.data.get(l.dataId).values,g=0;g<m.length;++g){for(var y=g*d,w=v[y],b=0;b<d;++b){var x=v[y+b];(Number.isNaN(x)||x<w)&&(w=x)}m[g]=w}c!=null&&t.disposeIntermediateTensorInfo(l);var S=t.makeTensorInfo(h,l.dtype,m);if(o){var T=E.backend_util.expandShapeToKeepDim(h,s),N=Mt({inputs:{x:S},backend:t,attrs:{shape:T}});return t.disposeIntermediateTensorInfo(S),N}return S}var W0e={kernelName:E.Min,backendName:"cpu",kernelFunc:$0e};function G0e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.paddings,o=n.mode;Ue(a,"mirrorPad");for(var s=i.map(function(T,N){return T[0]+a.shape[N]+T[1]}),u=i.map(function(T){return T[0]}),c=i.map(function(T,N){return T[0]+a.shape[N]}),l=o==="reflect"?0:1,f=t.data.get(a.dataId).values,h=a.shape.length,p=E.util.computeStrides(a.shape),d=E.util.sizeFromShape(s),m=s.length,v=E.util.computeStrides(s),g=E.util.getTypedArrayFromDType(a.dtype,d),y=0;y<d;y++){for(var w=E.util.indexToLoc(y,m,v),b=0;b<m;b++)w[b]<u[b]?w[b]=u[b]*2-w[b]-l:w[b]>=c[b]&&(w[b]=(c[b]-1)*2-w[b]+l);w=w.map(function(T,N){return T-u[N]});var x=E.util.locToIndex(w,h,p);g[y]=f[x]}var S=t.write(g,s,a.dtype);return{dataId:S,shape:s,dtype:a.dtype}}var V0e={kernelName:E.MirrorPad,backendName:"cpu",kernelFunc:G0e};var U0e=br((function(r,e){var t=r%e;return r<0&&e<0||r>=0&&e>=0?t:(t+e)%e})),H0e=Rr(E.Mod,U0e),q0e={kernelName:E.Mod,backendName:"cpu",kernelFunc:H0e};function a3(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.logits,i=n.dim,o=a.shape.length,s=i;if(s===-1&&(s=o-1),s!==o-1)throw Error("Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(o," and dim was ").concat(s));var u=E.util.parseAxisParam([s],a.shape),c=n3({inputs:{x:a},backend:t,attrs:{reductionIndices:u,keepDims:!1}}),l=E.backend_util.expandShapeToKeepDim(c.shape,u),f=Mt({inputs:{x:c},backend:t,attrs:{shape:l}}),h=Q0({inputs:{a,b:f},backend:t}),p=u_({inputs:{x:h},backend:t}),d=$l({inputs:{x:p},backend:t,attrs:{axis:u,keepDims:!1}}),m=Mt({inputs:{x:d},backend:t,attrs:{shape:l}}),v=tb({inputs:{a:p,b:m},backend:t});return t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(m),v}var K0e={kernelName:E.Softmax,backendName:"cpu",kernelFunc:a3};function j0e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.logits,i=n.numSamples,o=n.seed,s=n.normalized;Ue(a,"multinomial");for(var u=s?a:a3({inputs:{logits:a},backend:t,attrs:{dim:-1}}),c=u.shape[0],l=u.shape[1],f=t.data.get(u.dataId).values,h=[c,i],p=E.util.makeZerosTypedArray(E.util.sizeFromShape(h),"int32"),d=0;d<c;++d){var m=d*l,v=new Float32Array(l-1);v[0]=f[m];for(var g=1;g<v.length;++g)v[g]=v[g-1]+f[m+g];for(var y=kve.alea(o.toString()),w=d*i,b=0;b<i;++b){var x=y();p[w+b]=v.length;for(var g=0;g<v.length;g++)if(x<v[g]){p[w+b]=g;break}}}return s||t.disposeIntermediateTensorInfo(u),t.makeTensorInfo(h,"int32",p)}var X0e={kernelName:E.Multinomial,backendName:"cpu",kernelFunc:j0e};var Y0e=E.kernel_impls.nonMaxSuppressionV3Impl;function Z0e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.boxes,i=e.scores,o=n.maxOutputSize,s=n.iouThreshold,u=n.scoreThreshold;Ue(a,"NonMaxSuppression");var c=t.data.get(a.dataId).values,l=t.data.get(i.dataId).values,f=Y0e(c,l,o,s,u).selectedIndices;return t.makeTensorInfo([f.length],"int32",new Int32Array(f))}var J0e={kernelName:E.NonMaxSuppressionV3,backendName:"cpu",kernelFunc:Z0e};var Q0e=E.kernel_impls.nonMaxSuppressionV4Impl;function ebe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.boxes,i=e.scores,o=n.maxOutputSize,s=n.iouThreshold,u=n.scoreThreshold,c=n.padToMaxOutputSize;Ue(a,"NonMaxSuppressionPadded");var l=t.data.get(a.dataId).values,f=t.data.get(i.dataId).values,h=Q0e(l,f,o,s,u,c),p=h.selectedIndices,d=h.validOutputs;return[t.makeTensorInfo([p.length],"int32",new Int32Array(p)),t.makeTensorInfo([],"int32",new Int32Array([d]))]}var tbe={kernelName:E.NonMaxSuppressionV4,backendName:"cpu",kernelFunc:ebe};var rbe=E.kernel_impls.nonMaxSuppressionV5Impl;function nbe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.boxes,i=e.scores,o=n.maxOutputSize,s=n.iouThreshold,u=n.scoreThreshold,c=n.softNmsSigma;Ue(a,"NonMaxSuppressionWithScore");var l=t.data.get(a.dataId).values,f=t.data.get(i.dataId).values,h=o,p=s,d=u,m=c,v=rbe(l,f,h,p,d,m),g=v.selectedIndices,y=v.selectedScores;return[t.makeTensorInfo([g.length],"int32",new Int32Array(g)),t.makeTensorInfo([y.length],"float32",new Float32Array(y))]}var abe={kernelName:E.NonMaxSuppressionV5,backendName:"cpu",kernelFunc:nbe};function ibe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.indices,i=n.dtype,o=n.depth,s=n.onValue,u=n.offValue;Ue(a,"oneHot");var c=E.util.sizeFromShape(a.shape),l=new Float32Array(c*o);l.fill(u);for(var f=t.data.get(a.dataId).values,h=0;h<c;++h)f[h]>=0&&f[h]<o&&(l[h*o+f[h]]=s);return t.makeTensorInfo(na(na([],Ge(a.shape),!1),[o],!1),i,l)}var obe={kernelName:E.OneHot,backendName:"cpu",kernelFunc:ibe};function Vp(r){var e=r.inputs,t=r.backend,n=e.x;if(n.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(n.dtype==="complex64"){var a=Cs({inputs:{input:n},backend:t}),i=Vp({inputs:{x:a},backend:t}),o=$u({inputs:{input:n},backend:t}),s=Vp({inputs:{x:o},backend:t}),u=qn({inputs:{real:i,imag:s},backend:t});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(s),u}else return rb({backend:t,attrs:{shape:n.shape,value:0,dtype:n.dtype}})}var sbe={kernelName:E.ZerosLike,backendName:"cpu",kernelFunc:Vp};function i3(r){var e=r.inputs,t=r.backend,n=e.x;if(n.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(n.dtype==="complex64"){var a=Cs({inputs:{input:n},backend:t}),i=i3({inputs:{x:a},backend:t}),o=$u({inputs:{input:n},backend:t}),s=Vp({inputs:{x:o},backend:t}),u=qn({inputs:{real:i,imag:s},backend:t});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(s),u}else return rb({backend:t,attrs:{shape:n.shape,value:1,dtype:n.dtype}})}var ube={kernelName:E.OnesLike,backendName:"cpu",kernelFunc:i3};function o3(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.axis;if(e.length===1)return Gp({inputs:{input:e[0]},backend:t,attrs:{dim:a}});var i=e[0].shape,o=e[0].dtype;e.forEach(function(l){E.util.assertShapesMatch(i,l.shape,"All tensors passed to stack must have matching shapes"),E.util.assert(o===l.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var s=[],u=e.map(function(l){var f=Gp({inputs:{input:l},backend:t,attrs:{dim:a}});return s.push(f),f}),c=Wu({inputs:u,backend:t,attrs:{axis:a}});return s.forEach(function(l){return t.disposeIntermediateTensorInfo(l)}),c}var cbe={kernelName:E.Pack,backendName:"cpu",kernelFunc:o3};function lbe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.paddings,o=n.constantValue;Ue(a,"pad");var s=i.map(function(S,T){return S[0]+a.shape[T]+S[1]}),u=i.map(function(S){return S[0]}),c=t.data.get(a.dataId).values,l=E.util.sizeFromShape(a.shape),f=a.shape.length,h=E.util.computeStrides(a.shape),p=E.util.sizeFromShape(s),d=s.length,m=E.util.computeStrides(s),v=E.util.getTypedArrayFromDType(a.dtype,p);o!==0&&v.fill(o);for(var g=0;g<l;g++){var y=E.util.indexToLoc(g,f,h),w=y.map(function(S,T){return S+u[T]}),b=E.util.locToIndex(w,d,m);v[b]=c[g]}var x=t.write(v,s,a.dtype);return{dataId:x,shape:s,dtype:a.dtype}}var s3={kernelName:E.PadV2,backendName:"cpu",kernelFunc:lbe};var fbe=br(function(r,e){return Math.pow(r,e)}),hbe=Rr(E.Pow,fbe),pbe={kernelName:E.Pow,backendName:"cpu",kernelFunc:hbe};function dbe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.paramsNestedSplits,i=e.paramsDenseValues,o=e.indices;n.outputRaggedRank;var s=a.map(function(g){return t.data.get(g.dataId).values}),u=a.map(function(g){return g.shape}),c=t.data.get(i.dataId).values,l=t.data.get(o.dataId).values,f=Ge(N_(s,u,c,i.shape,i.dtype,l,o.shape),3),h=f[0],p=f[1],d=f[2],m=h.map(function(g){return t.makeTensorInfo([g.length],"int32",g)}),v=t.makeTensorInfo(d,i.dtype,p);return m.concat([v])}var vbe={kernelName:E.RaggedGather,backendName:"cpu",kernelFunc:dbe};function mbe(r){var e=r.inputs,t=r.backend,n=e.starts,a=e.limits,i=e.deltas,o=t.data.get(n.dataId).values,s=t.data.get(a.dataId).values,u=t.data.get(i.dataId).values,c=Ge(I_(o,n.shape,n.dtype,s,a.shape,u,i.shape),2),l=c[0],f=c[1],h=t.makeTensorInfo([l.length],"int32",l),p=t.makeTensorInfo([f.length],n.dtype,f);return[h,p]}var gbe={kernelName:E.RaggedRange,backendName:"cpu",kernelFunc:mbe};function ybe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.shape,i=e.values,o=e.defaultValue,s=e.rowPartitionTensors,u=n.rowPartitionTypes,c=t.data.get(a.dataId).values,l=t.data.get(i.dataId).values,f=t.data.get(o.dataId).values,h=s.map(function(g){return t.data.get(g.dataId).values}),p=s.map(function(g){return g.shape}),d=Ge(C_(c,a.shape,l,i.shape,i.dtype,f,o.shape,h,p,u),2),m=d[0],v=d[1];return t.makeTensorInfo(m,i.dtype,v)}var bbe={kernelName:E.RaggedTensorToTensor,backendName:"cpu",kernelFunc:ybe};function wbe(r){var e=r.backend,t=r.attrs,n=t.start,a=t.stop,i=t.dtype,o=t.step,s=A_(n,a,o,i);return e.makeTensorInfo([s.length],i,s)}var xbe={kernelName:E.Range,backendName:"cpu",kernelFunc:wbe};var kbe=At(E.Reciprocal,function(r){return 1/r}),Sbe={kernelName:E.Reciprocal,backendName:"cpu",kernelFunc:kbe};function Ebe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.images,i=n.alignCorners,o=n.halfPixelCenters,s=n.size;Ue(a,"resizeBilinear");for(var u=E.util.computeStrides(a.shape),c=Ge(s,2),l=c[0],f=c[1],h=Ge(a.shape,4),p=h[0],d=h[1],m=h[2],v=h[3],g=t.data.get(a.dataId).values,y=new Float32Array(E.util.sizeFromShape([p,l,f,v])),w=[i&&l>1?d-1:d,i&&f>1?m-1:m],b=[i&&l>1?l-1:l,i&&f>1?f-1:f],x=0,S=w[0]/b[0],T=w[1]/b[1],N=0;N<p;N++)for(var C=0;C<l;C++){var R=void 0;o?R=S*(C+.5)-.5:R=S*C;for(var _=Math.max(0,Math.floor(R)),P=R-_,$=Math.min(d-1,Math.ceil(R)),z=N*u[0]+_*u[1],L=N*u[0]+$*u[1],B=0;B<f;B++){var G=void 0;o?G=T*(B+.5)-.5:G=T*B;for(var X=Math.max(0,Math.floor(G)),Z=G-X,V=Math.min(m-1,Math.ceil(G)),j=z+X*u[2],re=L+X*u[2],te=z+V*u[2],oe=L+V*u[2],ce=0;ce<v;ce++){var pe=g[j+ce],xe=g[re+ce],fe=g[te+ce],ge=g[oe+ce],we=pe+(fe-pe)*Z,Ae=xe+(ge-xe)*Z,Ke=we+(Ae-we)*P;y[x++]=Ke}}}return t.makeTensorInfo([p,l,f,v],"float32",y)}var Tbe={kernelName:E.ResizeBilinear,backendName:"cpu",kernelFunc:Ebe};function Nbe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.images,i=e.dy,o=n.alignCorners;Ue([i,a],"resizeBilinearGrad");for(var s=E.util.computeStrides(a.shape),u=Ge(a.shape,4),c=u[0],l=u[1],f=u[2],h=u[3],p=Ge(i.shape,3),d=p[1],m=p[2],v=new Float32Array(c*l*f*h),g=[o&&d>1?l-1:l,o&&m>1?f-1:f],y=[o&&d>1?d-1:d,o&&m>1?m-1:m],w=g[0]/y[0],b=g[1]/y[1],x=t.data.get(i.dataId).values,S=0,T=0;T<c;T++)for(var N=T*s[0],C=0;C<d;C++)for(var R=C*w,_=Math.floor(R),P=Math.min(Math.ceil(R),l-1),$=N+_*s[1],z=N+P*s[1],L=R-_,B=1-L,G=0;G<m;G++)for(var X=G*b,Z=Math.floor(X),V=Math.min(Math.ceil(X),f-1),j=X-Z,re=1-j,te=$+Z*s[2],oe=$+V*s[2],ce=z+Z*s[2],pe=z+V*s[2],xe=B*re,fe=B*j,ge=L*re,we=L*j,Ae=0;Ae<h;Ae++){var Ke=x[S++];v[te+Ae]+=Ke*xe,v[oe+Ae]+=Ke*fe,v[ce+Ae]+=Ke*ge,v[pe+Ae]+=Ke*we}return t.makeTensorInfo([c,f,l,h],"float32",v)}var Ibe={kernelName:E.ResizeBilinearGrad,backendName:"cpu",kernelFunc:Nbe};function Cbe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.images,i=n.alignCorners,o=n.halfPixelCenters,s=n.size;Ue(a,"resizeNearestNeighbor");for(var u=E.util.computeStrides(a.shape),c=Ge(s,2),l=c[0],f=c[1],h=Ge(a.shape,4),p=h[0],d=h[1],m=h[2],v=h[3],g=t.data.get(a.dataId).values,y=new Float32Array(p*l*f*v),w=[i&&l>1?d-1:d,i&&f>1?m-1:m],b=[i&&l>1?l-1:l,i&&f>1?f-1:f],x=w[0]/b[0],S=w[1]/b[1],T=0,N=0;N<p;N++)for(var C=N*u[0],R=0;R<l;R++){var _=o?x*(R+.5):x*R,P=Math.min(d-1,i?Math.round(_):Math.floor(_));o&&(P=Math.max(0,P));for(var $=C+P*u[1],z=0;z<f;z++){var L=o?S*(z+.5):S*z,B=Math.min(m-1,i?Math.round(L):Math.floor(L));o&&(B=Math.max(0,B));for(var G=$+B*u[2],X=0;X<v;X++){var Z=g[G+X];y[T++]=Z}}}return t.makeTensorInfo([p,l,f,v],a.dtype,y)}var Abe={kernelName:E.ResizeNearestNeighbor,backendName:"cpu",kernelFunc:Cbe};function Dbe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.images,i=e.dy,o=n.alignCorners;Ue([i,a],"resizeNearestNeighborGrad");for(var s=E.util.computeStrides(a.shape),u=E.util.computeStrides(i.shape),c=Ge(a.shape,4),l=c[0],f=c[1],h=c[2],p=c[3],d=Ge(i.shape,3),m=d[1],v=d[2],g=new Float32Array(l*f*h*p),y=t.data.get(i.dataId).values,w=[o&&m>1?f-1:f,o&&v>1?h-1:h],b=[o&&m>1?m-1:m,o&&v>1?v-1:v],x=w[0]/b[0],S=w[1]/b[1],T=1/x,N=1/S,C=Math.ceil(T)*2+2,R=Math.ceil(N)*2+2,_=0;_<l;_++)for(var P=_*s[0],$=0;$<f;$++)for(var z=P+$*s[1],L=Math.floor($*T),B=Math.floor(L-C/2),G=0;G<h;G++)for(var X=z+G*s[2],Z=Math.floor(G*N),V=Math.floor(Z-R/2),j=0;j<p;j++){for(var re=0,te=0;te<C;te++){var oe=te+B;if(!(oe<0||oe>=m)){var ce=P+oe*u[1],pe=oe*x,xe=Math.min(f-1,o?Math.round(pe):Math.floor(pe));if($===xe)for(var fe=0;fe<R;fe++){var ge=fe+V;if(!(ge<0||ge>=v)){var we=ce+ge*u[2],Ae=ge*S,Ke=Math.min(h-1,o?Math.round(Ae):Math.floor(Ae));G===Ke&&(re+=y[we+j])}}}}g[X+j]=re}return t.makeTensorInfo(a.shape,a.dtype,g)}var _be={kernelName:E.ResizeNearestNeighborGrad,backendName:"cpu",kernelFunc:Dbe};function Fbe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.dims;Ue(a,"reverse");var o=a.shape.length,s=E.util.parseAxisParam(i,a.shape);if(o===0)return mi({inputs:{x:a},backend:t});for(var u=new E.TensorBuffer(a.shape,a.dtype),c=t.bufferSync(a),l=function(h){var p=u.indexToLoc(h),d=p.slice();s.forEach(function(m){return d[m]=a.shape[m]-1-d[m]}),u.set.apply(u,na([c.get.apply(c,na([],Ge(d),!1))],Ge(p),!1))},f=0;f<u.size;f++)l(f);return t.makeTensorInfo(u.shape,u.dtype,u.values)}var Rbe={kernelName:E.Reverse,backendName:"cpu",kernelFunc:Fbe},Obe={kernelName:E.RotateWithOffset,backendName:"cpu",kernelFunc:function(r){for(var e=r.inputs,t=r.attrs,n=r.backend,a=e.image,i=t.radians,o=t.fillValue,s=t.center,u=n,c=E.util.getTypedArrayFromDType(a.dtype,E.util.sizeFromShape(a.shape)),l=Ge(a.shape,4),f=l[0],h=l[1],p=l[2],d=l[3],m=Ge(E.backend_util.getImageCenter(s,h,p),2),v=m[0],g=m[1],y=255,w=Math.sin(i),b=Math.cos(i),x=u.data.get(a.dataId).values,S=0;S<f;S++)for(var T=S*p*h*d,N=0;N<h;N++)for(var C=N*(p*d),R=0;R<p;R++)for(var _=R*d,P=0;P<d;P++){var $=[f,N,R,P],z=$[2],L=$[1],B=(z-v)*b-(L-g)*w,G=(z-v)*w+(L-g)*b;B=Math.round(B+v),G=Math.round(G+g);var X=o;if(typeof o!="number"&&(P===3?X=y:X=o[P]),B>=0&&B<p&&G>=0&&G<h){var Z=G*(p*d),V=B*d,j=T+Z+V+P;X=x[j]}var re=T+C+_+P;c[re]=X}var te=u.write(c,a.shape,a.dtype);return{dataId:te,shape:a.shape,dtype:a.dtype}}};var Pbe=At(E.Round,function(r){var e=Math.floor(r);return r-e<.5?Math.floor(r):r-e>.5?Math.ceil(r):e%2===0?e:e+1}),Mbe={kernelName:E.Round,backendName:"cpu",kernelFunc:Pbe};function Bbe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.indices,i=e.updates,o=n.shape,s=E.backend_util.calculateShapes(i,a,o),u=s.sliceRank,c=s.numUpdates,l=s.sliceSize,f=s.strides,h=s.outputSize,p=!0,d=t.bufferSync(a),m=t.bufferSync(i),v=Is(d,m,o,h,l,c,u,f,0,p);return t.makeTensorInfo(o,v.dtype,v.values)}var Lbe={kernelName:E.ScatterNd,backendName:"cpu",kernelFunc:Bbe};function zbe(r,e){for(var t=0,n=r.length,a=0;t<n;)a=Math.floor((t+n)/2),r[a]<e?t=a+1:n=a;return n}function $be(r,e){for(var t=0,n=r.length,a=0;t<n;)a=Math.floor((t+n)/2),r[a]<=e?t=a+1:n=a;return n}function Wbe(r,e,t,n,a,i){for(var o=E.util.getArrayFromDType("int32",t*a),s=0;s<t;++s)for(var u=r.slice(s*n,(s+1)*n),c=s*a,l=0;l<a;++l)o[c+l]=i==="left"?zbe(u,e[l+c]):$be(u,e[l+c]);return o}function Gbe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.sortedSequence,i=e.values,o=n.side,s=t.data.get(a.dataId).values,u=t.data.get(i.dataId).values,c=Wbe(s,u,a.shape[0],a.shape[1],i.shape[1],o);return t.makeTensorInfo(i.shape,"int32",c)}var Vbe={kernelName:E.SearchSorted,backendName:"cpu",kernelFunc:Gbe};function Ube(r){var e=r.inputs,t=r.backend,n=e.condition,a=e.t,i=e.e;Ue([n,a,i],"select");for(var o=n.shape.length,s=t.data.get(n.dataId).values,u=t.data.get(a.dataId).values,c=t.data.get(i.dataId).values,l=E.upcastType(a.dtype,i.dtype),f=E.util.makeZerosTypedArray(E.util.sizeFromShape(a.shape),l),h=0,p=o===0||o>1||a.shape.length===1?1:E.util.sizeFromShape(a.shape.slice(1)),d=0;d<s.length;d++)for(var m=0;m<p;m++)s[d]===1?f[h++]=u[d]:f[h++]=c[d];return t.makeTensorInfo(a.shape,l,f)}var Hbe={kernelName:E.Select,backendName:"cpu",kernelFunc:Ube};var qbe=E.backend_util.SELU_SCALEALPHA,Kbe=E.backend_util.SELU_SCALE,jbe=At(E.Selu,function(r){return r>=0?Kbe*r:qbe*(Math.exp(r)-1)}),Xbe={kernelName:E.Selu,backendName:"cpu",kernelFunc:jbe};var Ybe=At(E.Sign,function(r){return r<0?-1:r>0?1:0}),Zbe={kernelName:E.Sign,backendName:"cpu",kernelFunc:Ybe};var Jbe=At(E.Sin,function(r){return Math.sin(r)}),Qbe={kernelName:E.Sin,backendName:"cpu",kernelFunc:Jbe};var ewe=At(E.Sinh,function(r){return Math.sinh(r)}),twe={kernelName:E.Sinh,backendName:"cpu",kernelFunc:ewe};var rwe=11920928955078125e-23,jD=Math.log(rwe)+2,nwe=At(E.Softplus,function(r){var e=r>-jD,t=r<jD,n=Math.exp(r),a;return t?a=n:e?a=r:a=Math.log(1+n),a}),awe={kernelName:E.Softplus,backendName:"cpu",kernelFunc:nwe};function iwe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.blockShape,o=n.paddings;Ue([a],"spaceToBatchND");var s=E.util.sizeFromShape(i),u=[[0,0]];u.push.apply(u,na([],Ge(o),!1));for(var c=1+i.length;c<a.shape.length;++c)u.push([0,0]);var l=s3.kernelFunc({inputs:{x:a},backend:t,attrs:{paddings:u,constantValue:0}}),f=E.backend_util.getReshaped(l.shape,i,s,!1),h=E.backend_util.getPermuted(f.length,i.length,!1),p=E.backend_util.getReshapedPermuted(l.shape,i,s,!1),d={x:l},m={shape:f},v=Mt({inputs:d,backend:t,attrs:m}),g={x:v},y={perm:h},w=xn({inputs:g,backend:t,attrs:y}),b={x:w},x={shape:p},S=Mt({inputs:b,backend:t,attrs:x});return t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(w),S}var owe={kernelName:E.SpaceToBatchND,backendName:"cpu",kernelFunc:iwe};function swe(r){var e=r.inputs,t=r.backend,n=e.indices,a=e.values,i=e.denseShape,o=e.defaultValue;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        `.concat(i.shape));if(n.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        `.concat(n.shape));if(a.shape.length!==1)throw new Error(`Values must be a vector, saw:
        `.concat(a.shape));if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        `.concat(o.shape));var s=t.data.get(n.dataId).values,u=t.data.get(a.dataId).values,c=t.data.get(i.dataId).values,l=t.data.get(o.dataId).values[0],f=Ge(R_(s,n.shape,n.dtype,u,a.dtype,c,l),5),h=f[0],p=f[1],d=f[2],m=f[3],v=f[4];return[t.makeTensorInfo(p,n.dtype,h),t.makeTensorInfo([p[0]],a.dtype,d),t.makeTensorInfo([m.length],"bool",new Uint8Array(m.map(function(g){return Number(g)}))),t.makeTensorInfo([v.length],n.dtype,new Int32Array(v))]}var uwe={kernelName:E.SparseFillEmptyRows,backendName:"cpu",kernelFunc:swe};function cwe(r){var e=r.inputs,t=r.backend,n=e.inputIndices,a=e.inputShape,i=e.newShape;if(n.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        `.concat(n.shape));if(a.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        `.concat(a.shape));if(i.shape.length!==1)throw new Error("Target shape should be a vector but received shape ".concat(i.shape));var o=Array.from(t.data.get(a.dataId).values),s=t.data.get(n.dataId).values,u=Array.from(t.data.get(i.dataId).values),c=Ge(O_(s,n.shape,n.dtype,o,u),3),l=c[0],f=c[1],h=c[2];return[t.makeTensorInfo(f,n.dtype,l),t.makeTensorInfo([h.length],i.dtype,new Int32Array(h))]}var lwe={kernelName:E.SparseReshape,backendName:"cpu",kernelFunc:cwe};function fwe(r){var e=r.inputs,t=r.backend,n=e.data,a=e.indices,i=e.segmentIds;if(n.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          `.concat(a.shape));if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          `.concat(i.shape));if(a.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");var o=t.data.get(n.dataId).values,s=t.data.get(a.dataId).values,u=t.data.get(i.dataId).values,c=Ge(J0(o,n.shape,n.dtype,s,u,!0),2),l=c[0],f=c[1];return t.makeTensorInfo(f,n.dtype,l)}var hwe={kernelName:E.SparseSegmentMean,backendName:"cpu",kernelFunc:fwe};function pwe(r){var e=r.inputs,t=r.backend,n=e.data,a=e.indices,i=e.segmentIds;if(n.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         `.concat(a.shape));if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         `.concat(i.shape));if(a.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");var o=t.data.get(n.dataId).values,s=t.data.get(a.dataId).values,u=t.data.get(i.dataId).values,c=Ge(J0(o,n.shape,n.dtype,s,u),2),l=c[0],f=c[1];return t.makeTensorInfo(f,n.dtype,l)}var dwe={kernelName:E.SparseSegmentSum,backendName:"cpu",kernelFunc:pwe};function vwe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.sparseIndices,i=e.sparseValues,o=e.defaultValue,s=n.outputShape,u=E.backend_util.calculateShapes(i,a,s),c=u.sliceRank,l=u.numUpdates,f=u.sliceSize,h=u.strides,p=u.outputSize,d=!1,m=t.bufferSync(a),v;switch(i.dtype){case"bool":{var g=t.bufferSync(i),y=!!t.data.get(o.dataId).values[0];v=Is(m,g,s,p,f,l,c,h,y,d);break}case"float32":{var g=t.bufferSync(i),y=t.data.get(o.dataId).values[0];v=Is(m,g,s,p,f,l,c,h,y,d);break}case"int32":{var g=t.bufferSync(i),y=t.data.get(o.dataId).values[0];v=Is(m,g,s,p,f,l,c,h,y,d);break}case"string":{var g=t.bufferSync(i),y=E.util.decodeString(t.data.get(o.dataId).values[0]);v=Is(m,g,s,p,f,l,c,h,y,d);break}default:throw new Error("Unsupported type ".concat(i.dtype))}return t.makeTensorInfo(s,v.dtype,v.values)}var mwe={kernelName:E.SparseToDense,backendName:"cpu",kernelFunc:vwe};function gwe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.numOrSizeSplits,o=n.axis,s=E.util.parseAxisParam(o,a.shape)[0],u=E.backend_util.prepareSplitSize(a,i,s),c=new Array(a.shape.length).fill(0),l=a.shape.slice();return u.map(function(f){var h=na([],Ge(l),!1);h[s]=f;var p=As({inputs:{x:a},backend:t,attrs:{begin:c,size:h}});return c[s]+=f,p})}var ywe={kernelName:E.SplitV,backendName:"cpu",kernelFunc:gwe};var bwe={kernelName:E.Square,backendName:"cpu",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=e.x,a=t;Ue(n,"square");for(var i=a.data.get(n.dataId).values,o=new Float32Array(i.length),s=0;s<i.length;++s){var u=i[s];o[s]=u*u}var c=a.write(o,n.shape,n.dtype);return{dataId:c,shape:n.shape,dtype:n.dtype}}};var wwe=At(E.Step,function(r,e){var t=e;return isNaN(r)?NaN:r>0?1:t.alpha}),xwe={kernelName:E.Step,backendName:"cpu",kernelFunc:wwe};function kwe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.begin,o=n.end,s=n.strides,u=n.beginMask,c=n.endMask,l=n.ellipsisMask,f=n.newAxisMask,h=n.shrinkAxisMask;Ue(a,"stridedSlice");var p=E.slice_util.sliceInfo(a.shape,i,o,s,u,c,l,f,h),d=p.finalShapeSparse,m=p.finalShape,v=p.isIdentity,g=p.sliceDim0,y=p.isSimpleSlice,w=p.begin,b=p.end,x=p.strides,S;if(v)S=Mt({inputs:{x:a},backend:t,attrs:{shape:m}});else if(g||y){E.util.assert(a.shape.length>=1,function(){return"Input must have rank at least 1, got: ".concat(a.shape.length)});var T=E.slice_util.computeOutShape(w,b,x),N=As({inputs:{x:a},backend:t,attrs:{begin:w,size:T}});S=Mt({inputs:{x:N},backend:t,attrs:{shape:m}}),t.disposeIntermediateTensorInfo(N)}else{var C=t.bufferSync(a),R=B_(d,C,x,w);S=t.makeTensorInfo(m,R.dtype,R.values)}return S}var Swe={kernelName:E.StridedSlice,backendName:"cpu",kernelFunc:kwe};function Ewe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.separator,i=n.nGramWidths,o=n.leftPad,s=n.rightPad,u=n.padWidth,c=n.preserveShortSequences,l=e.data,f=e.dataSplits,h=t.data.get(l.dataId).values,p=t.data.get(f.dataId).values,d=Ge(L_(h,p,a,i,o,s,u,c),2),m=d[0],v=d[1];return[t.makeTensorInfo([m.length],"string",m),t.makeTensorInfo(f.shape,"int32",v)]}var Twe={kernelName:E.StringNGrams,backendName:"cpu",kernelFunc:Ewe};function Nwe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.skipEmpty,i=e.input,o=e.delimiter;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error("Input must be a vector, got shape: ".concat(i.shape));if(o.shape.length!==0)throw new Error("Delimiter must be a scalar, got shape: ".concat(o.shape));var s=t.data.get(i.dataId).values,u=t.data.get(o.dataId).values[0],c=Ge(z_(s,u,a),3),l=c[0],f=c[1],h=c[2],p=f.length;return[t.makeTensorInfo([p,2],"int32",l),t.makeTensorInfo([p],"string",f),t.makeTensorInfo([2],"int32",new Int32Array(h))]}var Iwe={kernelName:E.StringSplit,backendName:"cpu",kernelFunc:Nwe};function Cwe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.numBuckets,i=e.input;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(a<=0)throw new Error("Number of buckets must be at least 1");var o=t.data.get(i.dataId).values,s=$_(o,a);return t.makeTensorInfo(i.shape,"int32",s)}var Awe={kernelName:E.StringToHashBucketFast,backendName:"cpu",kernelFunc:Cwe};var Dwe=At(E.Tan,function(r){return Math.tan(r)}),_we={kernelName:E.Tan,backendName:"cpu",kernelFunc:Dwe};var Fwe=At(E.Tanh,function(r){return Math.tanh(r)}),Rwe={kernelName:E.Tanh,backendName:"cpu",kernelFunc:Fwe};function Owe(r){var e=r.inputs,t=r.backend,n=e.tensor,a=e.indices,i=e.updates,o=E.backend_util.calculateShapes(i,a,n.shape),s=o.sliceRank,u=o.numUpdates,c=o.sliceSize,l=o.strides,f=o.outputSize,h=!1,p=t.bufferSync(a),d=t.bufferSync(i),m=t.bufferSync(n),v=Is(p,d,n.shape,f,c,u,s,l,m,h);return t.makeTensorInfo(n.shape,v.dtype,v.values)}var Pwe={kernelName:E.TensorScatterUpdate,backendName:"cpu",kernelFunc:Owe};function Mwe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.reps;Ue(a,"tile");var o=G_(t.bufferSync(a),i);return t.makeTensorInfo(o.shape,o.dtype,o.values)}var Bwe={kernelName:E.Tile,backendName:"cpu",kernelFunc:Mwe};function Lwe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.k,o=n.sorted;Ue(a,"topk");var s=t.data.get(a.dataId).values,u=Ge(U_(s,a.shape,a.dtype,i,o),2),c=u[0],l=u[1];return[t.makeTensorInfo(c.shape,c.dtype,c.values),t.makeTensorInfo(l.shape,l.dtype,l.values)]}var zwe={kernelName:E.TopK,backendName:"cpu",kernelFunc:Lwe};function $we(r){var e=r.inputs,t=r.attrs,n=r.backend,a=e.image,i=e.transforms,o=t.interpolation,s=t.fillMode,u=t.fillValue,c=t.outputShape,l=Ge(a.shape,4),f=l[0],h=l[1],p=l[2],d=l[3],m=Ge(c??[h,p],2),v=m[0],g=m[1],y=[f,v,g,d],w=E.util.computeStrides(a.shape),b=w[0],x=w[1],S=w[2],T=E.util.computeStrides(y),N=T[0],C=T[1],R=T[2],_=E.util.getTypedArrayFromDType(a.dtype,E.util.sizeFromShape(y));_.fill(u);for(var P=n.data.get(a.dataId).values,$=n.data.get(i.dataId).values,z=0;z<f;++z){for(var L=i.shape[0]===1?$:$.subarray(z*8,z*8+8),B=0;B<v;++B)for(var G=0;G<g;++G)for(var X=0;X<d;++X){var Z=void 0,V=L[6]*G+L[7]*B+1;if(V!==0){var j=(L[0]*G+L[1]*B+L[2])/V,re=(L[3]*G+L[4]*B+L[5])/V,te=XD(j,p,s),oe=XD(re,h,s);switch(o){case"nearest":Z=qwe(P,h,p,b,x,S,z,oe,te,X,u);break;case"bilinear":Z=Kwe(P,h,p,b,x,S,z,oe,te,X,u);break;default:throw new Error("Error in Transform: Expect 'nearest' or "+"'bilinear', but got ".concat(o))}var ce=z*N+B*C+G*R+X;_[ce]=Z}}return n.makeTensorInfo(y,a.dtype,_)}var pe=n.write(_,y,a.dtype);return{dataId:pe,shape:a.shape,dtype:a.dtype}}var Wwe={kernelName:E.Transform,backendName:"cpu",kernelFunc:$we};function XD(r,e,t){switch(t){case"reflect":return Gwe(r,e);case"wrap":return Vwe(r,e);case"nearest":return Hwe(r,e);case"constant":default:return Uwe(r)}}function Gwe(r,e){var t=r;if(t<0)if(e<=1)t=0;else{var n=2*e;t<n&&(t=n*Math.trunc(-t/n)+t),t=t<-e?t+n:-t-1}else if(t>e-1)if(e<=1)t=0;else{var n=2*e;t-=n*Math.trunc(t/n),t>=e&&(t=n-t-1)}return E.util.clamp(0,t,e-1)}function Vwe(r,e){var t=r;if(t<0)if(e<=1)t=0;else{var n=e-1;t+=e*(Math.trunc(-t/n)+1)}else if(t>e-1)if(e<=1)t=0;else{var n=e-1;t-=e*Math.trunc(t/n)}return E.util.clamp(0,t,e-1)}function Uwe(r,e){return r}function Hwe(r,e){return E.util.clamp(0,r,e-1)}function zl(r,e,t,n,a,i,o,s,u,c,l){var f=o*n+s*a+u*i+c;return 0<=s&&s<e&&0<=u&&u<t?r[f]:l}function qwe(r,e,t,n,a,i,o,s,u,c,l){var f=Math.round(s),h=Math.round(u);return zl(r,e,t,n,a,i,o,f,h,c,l)}function Kwe(r,e,t,n,a,i,o,s,u,c,l){var f=Math.floor(s),h=Math.floor(u),p=f+1,d=h+1,m=(d-u)*zl(r,e,t,n,a,i,o,f,h,c,l)+(u-h)*zl(r,e,t,n,a,i,o,f,d,c,l),v=(d-u)*zl(r,e,t,n,a,i,o,p,h,c,l)+(u-h)*zl(r,e,t,n,a,i,o,p,d,c,l);return(p-s)*m+(s-f)*v}function jwe(r){var e=r.inputs,t=r.attrs,n=r.backend,a=t.axis,i=e.x;Ue(i,"unique");var o=n.data.get(i.dataId).values,s=H_(o,a,i.shape,i.dtype),u=s.outputValues,c=s.outputShape,l=s.indices;return[n.makeTensorInfo(c,i.dtype,u),n.makeTensorInfo([l.length],"int32",l)]}var Xwe={kernelName:E.Unique,backendName:"cpu",kernelFunc:jwe};function Ywe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.value,i=n.axis;i<0&&(i+=a.shape.length);for(var o=a.shape.length,s=a.shape[i],u=new Array(o-1),c=0,l=0;l<o;l++)l!==i&&(u[c++]=a.shape[l]);var f=new Array(o).fill(0),h=a.shape.slice();h[i]=1;for(var p=new Array(s),l=0;l<p.length;l++){f[i]=l;var d=As({inputs:{x:a},backend:t,attrs:{begin:f,size:h}});p[l]=Mt({inputs:{x:d},backend:t,attrs:{shape:u}}),t.disposeIntermediateTensorInfo(d)}return p}var Zwe={kernelName:E.Unpack,backendName:"cpu",kernelFunc:Ywe};function Jwe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.segmentIds,o=n.numSegments;Ue(a,"unsortedSegmentSum");for(var s=a.shape.length,u=i.shape.length,c=[],l=[],f=s-u,h=i,p=0;p<f;++p){var d=Gp({inputs:{input:h},backend:t,attrs:{dim:p+1}});h=d,l.push(d)}for(var p=0;p<o;++p){var m=E.util.createScalarValue(p,"int32"),v=t.makeTensorInfo([],"int32",m),g=o_({inputs:{a:v,b:h},backend:t}),y=So({inputs:{x:g},backend:t,attrs:{dtype:"float32"}}),w=Up({inputs:{a:y,b:a},backend:t}),b=$l({inputs:{x:w},backend:t,attrs:{axis:0,keepDims:!1}});c.push(b),l.push(v),l.push(g),l.push(y),l.push(w),l.push(b)}var x=o3({inputs:c,backend:t,attrs:{axis:0}});return l.forEach(function(S){return t.disposeIntermediateTensorInfo(S)}),x}var Qwe={kernelName:E.UnsortedSegmentSum,backendName:"cpu",kernelFunc:Jwe},V0,YD,e1e=[jme,Nve,Yme,Jme,Fve,ege,rge,age,oge,uge,lge,hge,dge,gge,bge,kge,Ege,Nge,Cge,qme,Dge,Fge,Oge,Ove,Mge,Dve,Mve,Lge,Ive,$ge,Gge,Vge,Hge,Kge,Xge,Zge,Qge,tye,nye,iye,sye,cye,fye,pye,dye,mye,yye,wye,xye,kye,Sye,Tye,Cye,zme,Dye,Bve,Lye,Lve,zye,$ve,Hye,qye,jye,Gve,Uve,Yye,Jye,e0e,r0e,qve,jve,Cve,a0e,Wge,o0e,u0e,l0e,$me,Yve,Jve,h0e,eme,d0e,g0e,b0e,k0e,E0e,N0e,I0e,rme,A0e,_0e,R0e,P0e,B0e,z0e,W0e,ame,V0e,q0e,X0e,ome,ume,J0e,tbe,abe,lme,obe,ube,cbe,s3,pbe,Gme,pme,vbe,gbe,bbe,xbe,Ave,H0,Sbe,Vme,Ume,Hme,Tbe,Ibe,Abe,_be,Rbe,Obe,Mbe,kme,Lbe,Vbe,Hbe,Xbe,Eme,Zbe,Qbe,twe,Tme,K0e,awe,owe,uwe,lwe,hwe,dwe,mwe,ywe,Cme,bwe,Dme,Fme,xwe,Swe,Twe,Iwe,Awe,Mme,Nye,_we,Rwe,Pwe,Bwe,zwe,Wwe,fme,Xwe,Zwe,Qwe,sbe];try{for(Bl=Lu(e1e),Bu=Bl.next();!Bu.done;Bu=Bl.next())ZD=Bu.value,E.registerKernel(ZD)}catch(r){V0={error:r}}finally{try{Bu&&!Bu.done&&(YD=Bl.return)&&YD.call(Bl)}finally{if(V0)throw V0.error}}var ZD,Bl,Bu;Hp.MathBackendCPU=K0;Hp.shared=Bme;Hp.version_cpu=Lme});var dR=Vr(Wi=>{"use strict";var k=Xo();function t1e(r){var e=Object.create(null);return r&&Object.keys(r).forEach(function(t){if(t!=="default"){var n=Object.getOwnPropertyDescriptor(r,t);Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:function(){return r[t]}})}}),e.default=r,e}var r1e=t1e(k),ib=function(r,e){return ib=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},ib(r,e)};function n1e(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");ib(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Uu(r,e,t,n){function a(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function s(l){try{c(n.next(l))}catch(f){o(f)}}function u(l){try{c(n.throw(l))}catch(f){o(f)}}function c(l){l.done?i(l.value):a(l.value).then(s,u)}c((n=n.apply(r,e||[])).next())})}function Hu(r,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(c){return function(l){return u([c,l])}}function u(c){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,a&&(i=c[0]&2?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[c[0]&2,i.value]),c[0]){case 0:case 1:i=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,a=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){t.label=c[1];break}if(c[0]===6&&t.label<i[1]){t.label=i[1],i=c;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(c);break}i[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(r,t)}catch(l){c=[6,l],a=0}finally{n=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function ln(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ee(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=n.next()).done;)i.push(a.value)}catch(s){o={error:s}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return i}function ir(r,e,t){if(t||arguments.length===2)for(var n=0,a=e.length,i;n<a;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return r.concat(i||Array.prototype.slice.call(e))}var _s={},qp={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function z3(r,e){_s[r]=e}function ni(r,e){if(!(r in _s)||e!=null){var t=i1e(r,e);if(t!==null)_s[r]=t;else return console.log("Could not get context for WebGL version",r),null}var n=_s[r];return n==null||n.isContextLost()?(delete _s[r],ni(r)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),_s[r])}function a1e(r){if(!k.env().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&r===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function i1e(r,e){if(r!==1&&r!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var t=e??a1e(r);return t.addEventListener("webglcontextlost",function(n){n.preventDefault(),delete _s[r]},!1),k.env().getBool("SOFTWARE_WEBGL_ENABLED")&&(qp.failIfMajorPerformanceCaveat=!1),r===1?t.getContext("webgl",qp)||t.getContext("experimental-webgl",qp):t.getContext("webgl2",qp)}var Kl;(function(r){r[r.DENSE=0]="DENSE",r[r.SHARED_BATCH=1]="SHARED_BATCH"})(Kl||(Kl={}));var aa;(function(r){r[r.RENDER=0]="RENDER",r[r.UPLOAD=1]="UPLOAD",r[r.PIXELS=2]="PIXELS",r[r.DOWNLOAD=3]="DOWNLOAD"})(aa||(aa={}));var Xr;(function(r){r[r.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",r[r.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",r[r.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",r[r.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",r[r.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(Xr||(Xr={}));function Jl(r,e){return[e,r]}function o1e(r,e){return r*e}function Kp(r){var e=k.util.sizeFromShape(r),t=Math.ceil(e/4);return k.util.sizeToSquarishShape(t)}function qu(r,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(r/2))]}function s1e(r,e){var t=Ee(qu(r,e),2),n=t[0],a=t[1];return n*a*4}function pb(r,e){var t=r,n,a,i,o,s,u,c,l,f,h;return k.env().getNumber("WEBGL_VERSION")===2?(n=t.R32F,a=t.R16F,i=t.RGBA16F,o=t.RGBA32F,s=t.RED,c=4,l=1,f=t.HALF_FLOAT,h=t.FLOAT,u=t.RGBA8):(n=r.RGBA,a=r.RGBA,i=r.RGBA,o=t.RGBA,s=r.RGBA,c=4,l=4,f=e!=null?e.HALF_FLOAT_OES:null,h=r.FLOAT,u=r.RGBA),{internalFormatFloat:n,internalFormatHalfFloat:a,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:o,textureFormatFloat:s,downloadTextureFormat:u,downloadUnpackNumChannels:c,defaultNumChannels:l,textureTypeHalfFloat:f,textureTypeFloat:h}}function Oe(r,e){var t=e();return k.env().getBool("DEBUG")&&u1e(r),t}function u1e(r){var e=r.getError();if(e!==r.NO_ERROR)throw new Error("WebGL Error: "+W3(r,e))}var c1e=596e-10,l1e=65504;function $3(r){return!!(k.env().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||r===0||c1e<Math.abs(r)&&Math.abs(r)<l1e)}function W3(r,e){switch(e){case r.NO_ERROR:return"NO_ERROR";case r.INVALID_ENUM:return"INVALID_ENUM";case r.INVALID_VALUE:return"INVALID_VALUE";case r.INVALID_OPERATION:return"INVALID_OPERATION";case r.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case r.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case r.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code ".concat(e)}}function Gl(r,e){return zi(r,function(){return r.getExtension(e)},'Extension "'+e+'" not supported on this browser.')}function G3(r,e){var t=zi(r,function(){return r.createShader(r.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(Oe(r,function(){return r.shaderSource(t,e)}),Oe(r,function(){return r.compileShader(t)}),r.getShaderParameter(t,r.COMPILE_STATUS)===!1)throw console.log(r.getShaderInfoLog(t)),new Error("Failed to compile vertex shader.");return t}function V3(r,e){var t=zi(r,function(){return r.createShader(r.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(Oe(r,function(){return r.shaderSource(t,e)}),Oe(r,function(){return r.compileShader(t)}),k.env().get("ENGINE_COMPILE_ONLY"))return t;if(r.getShaderParameter(t,r.COMPILE_STATUS)===!1)throw db(e,r.getShaderInfoLog(t)),new Error("Failed to compile fragment shader.");return t}var f1e=/ERROR: [0-9]+:([0-9]+):/g;function db(r,e){var t=f1e.exec(e);if(t==null){console.log("Couldn't parse line number in error: ".concat(e)),console.log(r);return}for(var n=+t[1],a=r.split(`
`),i=a.length.toString().length+2,o=a.map(function(h,p){return k.util.rightPad((p+1).toString(),i)+h}),s=0,u=0;u<o.length;u++)s=Math.max(o[u].length,s);var c=o.slice(0,n-1),l=o.slice(n-1,n),f=o.slice(n);console.log(c.join(`
`)),console.log(e.split(`
`)[0]),console.log("%c ".concat(k.util.rightPad(l[0],s)),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(f.join(`
`))}function U3(r){return zi(r,function(){return r.createProgram()},"Unable to create WebGLProgram.")}function H3(r,e){if(Oe(r,function(){return r.linkProgram(e)}),!k.env().get("ENGINE_COMPILE_ONLY")&&r.getProgramParameter(e,r.LINK_STATUS)===!1)throw console.log(r.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function Zp(r,e){if(Oe(r,function(){return r.validateProgram(e)}),r.getProgramParameter(e,r.VALIDATE_STATUS)===!1)throw console.log(r.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function q3(r,e){var t=zi(r,function(){return r.createBuffer()},"Unable to create WebGLBuffer");return Oe(r,function(){return r.bindBuffer(r.ARRAY_BUFFER,t)}),Oe(r,function(){return r.bufferData(r.ARRAY_BUFFER,e,r.STATIC_DRAW)}),t}function K3(r,e){var t=zi(r,function(){return r.createBuffer()},"Unable to create WebGLBuffer");return Oe(r,function(){return r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t)}),Oe(r,function(){return r.bufferData(r.ELEMENT_ARRAY_BUFFER,e,r.STATIC_DRAW)}),t}function h1e(){return k.env().getNumber("WEBGL_VERSION")===2?1:4}function j3(r){return zi(r,function(){return r.createTexture()},"Unable to create WebGLTexture.")}function X3(r,e){var t=k.env().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(r<=0||e<=0){var n="[".concat(r,"x").concat(e,"]");throw new Error("Requested texture size "+n+" is invalid.")}if(r>t||e>t){var n="[".concat(r,"x").concat(e,"]"),a="[".concat(t,"x").concat(t,"]");throw new Error("Requested texture size "+n+" greater than WebGL maximum on this browser / GPU "+a+".")}}function Y3(r){return zi(r,function(){return r.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function ob(r,e,t,n,a,i,o){var s=r.getAttribLocation(e,t);return s===-1?!1:(Oe(r,function(){return r.bindBuffer(r.ARRAY_BUFFER,n)}),Oe(r,function(){return r.vertexAttribPointer(s,a,r.FLOAT,!1,i,o)}),Oe(r,function(){return r.enableVertexAttribArray(s)}),!0)}function Z3(r,e,t){rF(r,t),Oe(r,function(){return r.activeTexture(r.TEXTURE0+t)}),Oe(r,function(){return r.bindTexture(r.TEXTURE_2D,e)})}function p1e(r,e){rF(r,e),Oe(r,function(){return r.activeTexture(r.TEXTURE0+e)}),Oe(r,function(){return r.bindTexture(r.TEXTURE_2D,null)})}function J3(r,e,t){return zi(r,function(){return r.getUniformLocation(e,t)},'uniform "'+t+'" not present in program.')}function Q3(r,e,t){return r.getUniformLocation(e,t)}function eF(r,e,t,n){Oe(r,function(){return Z3(r,e,n)}),Oe(r,function(){return r.uniform1i(t,n)})}function d1e(r){Oe(r,function(){return r.bindFramebuffer(r.FRAMEBUFFER,null)}),Oe(r,function(){return r.viewport(0,0,r.canvas.width,r.canvas.height)}),Oe(r,function(){return r.scissor(0,0,r.canvas.width,r.canvas.height)})}function Jp(r,e,t){Oe(r,function(){return r.bindFramebuffer(r.FRAMEBUFFER,t)}),Oe(r,function(){return r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0)})}function sb(r,e){Oe(r,function(){return r.bindFramebuffer(r.FRAMEBUFFER,e)}),Oe(r,function(){return r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,null,0)})}function Vl(r){var e=r.checkFramebufferStatus(r.FRAMEBUFFER);if(e!==r.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+tF(r,e))}function tF(r,e){switch(e){case r.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case r.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case r.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case r.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error ".concat(e)}}function zi(r,e,t){var n=Oe(r,function(){return e()});if(n==null)throw new Error(t);return n}function rF(r,e){var t=r.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,n=e+r.TEXTURE0;if(n<r.TEXTURE0||n>t){var a="[gl.TEXTURE0, gl.TEXTURE".concat(t,"]");throw new Error("textureUnit must be in ".concat(a,"."))}}function Fs(r,e){return e===void 0&&(e=2),k.util.sizeFromShape(r.slice(0,r.length-e))}function Rs(r){if(r.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[r.length>1?r[r.length-2]:1,r[r.length-1]]}function Ul(r){var e=[1,1,1],t=r.length===0||r.length===1&&r[0]===1;return t||(e=ir([Fs(r)],Ee(Rs(r)),!1)),e}function nF(r,e){var t;e===void 0&&(e=!1);var n=k.env().getNumber("WEBGL_MAX_TEXTURE_SIZE"),a=k.env().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");if(a===1/0&&k.env().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(a=n/2),e&&(n=n*2,a=a*2,r=r.map(function(h,p){return p>=r.length-2?k.util.nearestLargerEven(r[p]):r[p]}),r.length===1&&(r=[2,r[0]])),r.length!==2){var i=k.util.squeezeShape(r);r=i.newShape}var o=k.util.sizeFromShape(r),s=null;r.length<=1&&o<=n?s=[1,o]:r.length===2&&r[0]<=n&&r[1]<=n?s=r:r.length===3&&r[0]*r[1]<=n&&r[2]<=n?s=[r[0]*r[1],r[2]]:r.length===3&&r[0]<=n&&r[1]*r[2]<=n?s=[r[0],r[1]*r[2]]:r.length===4&&r[0]*r[1]*r[2]<=n&&r[3]<=n?s=[r[0]*r[1]*r[2],r[3]]:r.length===4&&r[0]<=n&&r[1]*r[2]*r[3]<=n&&(s=[r[0],r[1]*r[2]*r[3]]);var u=s!=null&&Math.max.apply(Math,ir([],Ee(s),!1))>a&&Math.min.apply(Math,ir([],Ee(s),!1))<=(e?2:1)&&Math.min.apply(Math,ir([],Ee(s),!1))>0;if(s==null||u)if(e){var c=Fs(r),l=2,f=2;r.length&&(t=Ee(Rs(r),2),l=t[0],f=t[1]),o=c*(l/2)*(f/2),s=k.util.sizeToSquarishShape(o).map(function(h){return h*2})}else s=k.util.sizeToSquarishShape(o);return s}function jp(r){return r%2===0}function jl(r,e){if(r=r.slice(-2),e=e.slice(-2),k.util.arraysEqual(r,e)||!r.length||!e.length||r[0]===0||r[1]===0||e[0]===0||e[1]===0)return!0;if(r.length!==e.length){var t=r[r.length-1],n=e[e.length-1];if(t===n||jp(t)&&jp(n)&&(r[0]===1||e[0]===1))return!0}return r[1]===e[1]&&jp(r[0])&&jp(e[0])}var Qp,ed;function aF(r){if(Qp==null){var e=ni(r);Qp=e.getParameter(e.MAX_TEXTURE_SIZE)}return Qp}function v1e(){Qp=null}function m1e(){ed=null}function iF(r){if(ed==null){var e=ni(r);ed=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,ed)}function oF(r){if(r===0)return 0;var e,t=ni(r);return ia(t,"EXT_disjoint_timer_query_webgl2")&&r===2?e=2:ia(t,"EXT_disjoint_timer_query")?e=1:e=0,e}function ia(r,e){var t=r.getExtension(e);return t!=null}function ub(r){try{var e=ni(r);if(e!=null)return!0}catch(t){return console.log("Error when getting WebGL context: ",t),!1}return!1}function sF(r){if(r===0)return!1;var e=ni(r);if(r===1){if(!ia(e,"OES_texture_float"))return!1}else if(!ia(e,"EXT_color_buffer_float"))return!1;var t=cb(e);return t}function uF(r){if(r===0)return!1;var e=ni(r);if(r===1){if(!ia(e,"OES_texture_float")||!ia(e,"WEBGL_color_buffer_float"))return!1}else{if(ia(e,"EXT_color_buffer_float"))return cb(e);var t="EXT_color_buffer_half_float";if(ia(e,t)){var n=e.getExtension(t);return g1e(e,n)}return!1}var a=cb(e);return a}function cb(r){var e=pb(r),t=r.createTexture();r.bindTexture(r.TEXTURE_2D,t);var n=1,a=1;r.texImage2D(r.TEXTURE_2D,0,e.internalFormatFloat,n,a,0,e.textureFormatFloat,e.textureTypeFloat,null);var i=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,i),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0);var o=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(t),r.deleteFramebuffer(i),o}function g1e(r,e){var t=pb(r,e),n=r.createTexture();r.bindTexture(r.TEXTURE_2D,n);var a=1,i=1;r.texImage2D(r.TEXTURE_2D,0,t.internalFormatHalfFloat,a,i,0,t.textureFormatFloat,t.textureTypeHalfFloat,null);var o=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,o),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,n,0);var s=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(n),r.deleteFramebuffer(o),s}function cF(r){if(r!==2)return!1;var e=ni(r),t=e.fenceSync!=null;return t}function Ku(r,e){Array.isArray(r)||(r=[r]),r.forEach(function(t){t!=null&&k.util.assert(t.dtype!=="complex64",function(){return"".concat(e," does not support complex64 tensors ")+"in the WebGL backend."})})}var y1e={__proto__:null,assertNotComplex:Ku,bindCanvasToFramebuffer:d1e,bindColorTextureToFramebuffer:Jp,bindTextureToProgramUniformSampler:eF,bindTextureUnit:Z3,bindVertexBufferToProgramAttribute:ob,callAndCheck:Oe,canBeRepresented:$3,createFragmentShader:V3,createFramebuffer:Y3,createProgram:U3,createStaticIndexBuffer:K3,createStaticVertexBuffer:q3,createTexture:j3,createVertexShader:G3,getBatchDim:Fs,getExtensionOrThrow:Gl,getFramebufferErrorMessage:tF,getMaxTexturesInShader:iF,getNumChannels:h1e,getProgramUniformLocation:Q3,getProgramUniformLocationOrThrow:J3,getRowsCols:Rs,getShapeAs3D:Ul,getTextureShapeFromLogicalShape:nF,getWebGLDisjointQueryTimerVersion:oF,getWebGLErrorMessage:W3,getWebGLMaxTextureSize:aF,hasExtension:ia,isCapableOfRenderingToFloatTexture:sF,isDownloadFloatTextureEnabled:uF,isReshapeFree:jl,isWebGLFenceEnabled:cF,isWebGLVersionEnabled:ub,linkProgram:H3,logShaderSourceAndInfoLog:db,resetMaxTextureSize:v1e,resetMaxTexturesInShader:m1e,unbindColorTextureFromFramebuffer:sb,unbindTextureUnit:p1e,validateFramebuffer:Vl,validateProgram:Zp,validateTextureSize:X3};var He=k.env();He.registerFlag("HAS_WEBGL",function(){return He.getNumber("WEBGL_VERSION")>0});He.registerFlag("WEBGL_VERSION",function(){return ub(2)?2:ub(1)?1:0});He.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",function(){return!1});He.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return He.get("WEBGL_VERSION")===2});He.registerFlag("WEBGL_CPU_FORWARD",function(){return!0});He.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1});He.registerFlag("WEBGL_PACK",function(){return He.getBool("HAS_WEBGL")});He.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return He.getBool("WEBGL_PACK")});He.registerFlag("WEBGL_PACK_CLIP",function(){return He.getBool("WEBGL_PACK")});He.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return He.getBool("WEBGL_PACK")});He.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return He.getBool("WEBGL_PACK")});He.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return He.getBool("WEBGL_PACK")});He.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return He.getBool("WEBGL_PACK")});He.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return He.getBool("WEBGL_PACK")});He.registerFlag("WEBGL_PACK_REDUCE",function(){return He.getBool("WEBGL_PACK")});He.registerFlag("WEBGL_LAZILY_UNPACK",function(){return He.getBool("WEBGL_PACK")});He.registerFlag("WEBGL_CONV_IM2COL",function(){return He.getBool("WEBGL_PACK")});He.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",function(){return He.getBool("WEBGL_PACK")});He.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return aF(He.getNumber("WEBGL_VERSION"))});He.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return iF(He.getNumber("WEBGL_VERSION"))});He.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var r=He.getNumber("WEBGL_VERSION");return r===0?0:oF(r)});He.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return He.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!k.device_util.isMobile()});He.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return sF(He.getNumber("WEBGL_VERSION"))});He.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return He.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:He.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")});He.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return uF(He.getNumber("WEBGL_VERSION"))});He.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return cF(He.getNumber("WEBGL_VERSION"))});He.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){var r=He.getBool("WEBGL_RENDER_FLOAT32_ENABLED");return r?4:0});He.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",function(){return-1},function(r){if(typeof r!="number")throw new Error("WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but "+"got ".concat(r,"."));if(r<0&&r!==-1)throw new Error("WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never "+"delete) or at least 0, but got ".concat(r,"."))});He.registerFlag("WEBGL_FLUSH_THRESHOLD",function(){return k.device_util.isMobile()?1:-1},function(r){if(typeof r!="number")throw new Error("WEBGL_FLUSH_THRESHOLD must be a number but got "+"".concat(r,"."));if(r<0&&r!==-1)throw new Error("WEBGL_FLUSH_THRESHOLD must be -1 (indicating never "+"manual flush) or at least 0, but got ".concat(r,"."))});He.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",function(){return 128});He.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",function(){return!1});He.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",function(){return 1e5});He.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",function(){return 128});He.registerFlag("WEBGL_EXP_CONV",function(){return!1});He.registerFlag("SOFTWARE_WEBGL_ENABLED",function(){return He.getBool("IS_TEST")});He.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",function(){return 1/0});He.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",function(){return!1});He.registerFlag("WEBGL2_ISNAN_CUSTOM",function(){return!1});He.registerFlag("ENGINE_COMPILE_ONLY",function(){return!1});function hn(){var r,e,t,n,a,i,o,s,u,c;return k.env().getNumber("WEBGL_VERSION")===2?(r="#version 300 es",e="in",t="out",n="in",a="texture",i="outputColor",o="out vec4 outputColor;",s=k.env().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",u="",c=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(r="",e="attribute",t="varying",n="varying",a="texture2D",i="gl_FragColor",o="",s=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,u=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,c=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:r,attribute:e,varyingVs:t,varyingFs:n,texture2D:a,output:i,defineOutput:o,defineSpecialNaN:s,defineSpecialInf:u,defineRound:c}}function Ps(r,e,t){t===void 0&&(t="index");var n=k.util.computeStrides(e);return n.map(function(a,i){var o="int ".concat(r[i]," = ").concat(t," / ").concat(a),s=i===n.length-1?"int ".concat(r[i+1]," = ").concat(t," - ").concat(r[i]," * ").concat(a):"index -= ".concat(r[i]," * ").concat(a);return"".concat(o,"; ").concat(s,";")}).join("")}function od(r,e,t){t===void 0&&(t="index");var n=k.util.computeStrides(e);return n.map(function(a,i){var o="int ".concat(r[i]," = ").concat(t," / outShapeStrides[").concat(i,"]"),s=i===n.length-1?"int ".concat(r[i+1]," = ").concat(t," - ").concat(r[i]," * outShapeStrides[").concat(i,"]"):"index -= ".concat(r[i]," * outShapeStrides[").concat(i,"]");return"".concat(o,"; ").concat(s,";")}).join("")}function b1e(r,e){var t=r.length,n=r.map(function(o){return"".concat(e,"[").concat(o,"]")}),a=new Array(t-1);a[t-2]=n[t-1];for(var i=t-3;i>=0;--i)a[i]="(".concat(a[i+1]," * ").concat(n[i+1],")");return a}function w1e(r,e,t){t===void 0&&(t="index");var n=r.map(function(i,o){return o}),a=b1e(n,e);return a.map(function(i,o){var s="int ".concat(r[o]," = ").concat(t," / ").concat(a[o]),u=o===a.length-1?"int ".concat(r[o+1]," = ").concat(t," - ").concat(r[o]," * ").concat(a[o]):"index -= ".concat(r[o]," * ").concat(a[o]);return"".concat(s,"; ").concat(u,";")}).join("")}function vb(r){var e=k.util.computeStrides(r).map(function(t){return t.toString()});return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `.concat(e[0]," + coords.y * ").concat(e[1],` + coords.z;
  }
`)}function mb(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}var lF=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`,fF=k.backend_util.getBroadcastDims;function x1e(r,e,t){var n=[];if(r.forEach(function(p){var d=k.util.sizeFromShape(p.shapeInfo.logicalShape);if(p.shapeInfo.isUniform?n.push("uniform float ".concat(p.name).concat(d>1?"[".concat(d,"]"):"",";")):(n.push("uniform sampler2D ".concat(p.name,";")),n.push("uniform int offset".concat(p.name,";"))),t.enableShapeUniforms){var m=gb(t.packedInputs,p.shapeInfo.logicalShape,p.shapeInfo.texShape).uniformShape;switch(m.length){case 1:n.push("uniform int ".concat(p.name,"Shape;"));break;case 2:n.push("uniform ivec2 ".concat(p.name,"Shape;"));break;case 3:n.push("uniform ivec3 ".concat(p.name,"Shape;"));break;case 4:n.push("uniform ivec4 ".concat(p.name,"Shape;"));break}n.push("uniform ivec2 ".concat(p.name,"TexShape;"))}}),t.enableShapeUniforms){switch(e.logicalShape.length){case 1:n.push("uniform int outShape;");break;case 2:n.push("uniform ivec2 outShape;"),n.push("uniform int outShapeStrides;");break;case 3:n.push("uniform ivec3 outShape;"),n.push("uniform ivec2 outShapeStrides;");break;case 4:n.push("uniform ivec4 outShape;"),n.push("uniform ivec3 outShapeStrides;");break}n.push("uniform ivec2 outTexShape;")}t.customUniforms&&t.customUniforms.forEach(function(p){n.push("uniform ".concat(p.type," ").concat(p.name).concat(p.arrayIndex?"[".concat(p.arrayIndex,"]"):"",";"))});var a=n.join(`
`),i=r.map(function(p){return k1e(p,e,t.packedInputs,t.enableShapeUniforms)}).join(`
`),o=e.texShape,s=hn(),u=T1e(s),c,l,f=C1e(s);e.isPacked?(c=S1e(e.logicalShape,o,t.enableShapeUniforms),l=I1e(s)):(c=E1e(e.logicalShape,o,t.enableShapeUniforms),l=N1e(s)),t.packedInputs&&(f+=F1e);var h=[f,u,l,a,c,i,t.userCode].join(`
`);return h}function ju(r,e){e===void 0&&(e=!1);var t=r.shapeInfo.logicalShape;switch(t.length){case 0:return U1e(r,e);case 1:return q1e(r,e);case 2:return j1e(r,e);case 3:return Y1e(r,e);case 4:return J1e(r,e);case 5:return Q1e(r);case 6:return exe(r);default:throw new Error("".concat(t.length,"-D input sampling")+" is not yet supported")}}function hF(r,e){var t=r.shapeInfo.logicalShape;switch(t.length){case 0:return V1e(r);case 1:return H1e(r,e);case 2:return K1e(r,e);case 3:return X1e(r,e);default:return Z1e(r,e)}}function k1e(r,e,t,n){t===void 0&&(t=!1);var a="";t?a+=hF(r,n):a+=ju(r,n);var i=r.shapeInfo.logicalShape,o=e.logicalShape;return i.length<=o.length&&(t?a+=txe(r,e):a+=rxe(r,e)),a}function S1e(r,e,t){switch(r.length){case 0:return pF();case 1:return R1e(r,e,t);case 2:return W1e(r,e,t);case 3:return P1e(r,e,t);default:return B1e(r,e,t)}}function E1e(r,e,t){switch(r.length){case 0:return pF();case 1:return O1e(r,e,t);case 2:return G1e(r,e,t);case 3:return M1e(r,e,t);case 4:return L1e(r,e,t);case 5:return z1e(r,e);case 6:return $1e(r,e);default:throw new Error("".concat(r.length,"-D output sampling is not yet supported"))}}function T1e(r){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `.concat(r.texture2D,`(textureSampler, uv).r;
    }
  `)}function N1e(r){return`
    void setOutput(float val) {
      `.concat(r.output,` = vec4(val, 0, 0, 0);
    }
  `)}function I1e(r){return`
    void setOutput(vec4 val) {
      `.concat(r.output,` = val;
    }
  `)}function C1e(r){var e="".concat(r.version,`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `).concat(r.varyingFs,` vec2 resultUV;
    `).concat(r.defineOutput,`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    `).concat(r.defineSpecialNaN,`
    `).concat(r.defineSpecialInf,`
    `).concat(r.defineRound,`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `).concat(A1e,`
    `).concat(D1e,`
    `).concat(_1e,`
  `);return e}var A1e=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,D1e=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,_1e=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,F1e=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function pF(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function R1e(r,e,t){var n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return n[0]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `.concat(n[1],`.0);
      }
    `):n[1]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `.concat(n[0],`.0);
      }
    `):t?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`.concat(n[0],", ").concat(n[1],`));
      return 2 * (resTexRC.x * `).concat(n[1],` + resTexRC.y);
    }
  `)}function O1e(r,e,t){return e[0]===1?t?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * `.concat(e[1],`.0);
      }
    `):e[1]===1?t?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * `.concat(e[0],`.0);
      }
    `):t?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`.concat(e[0],", ").concat(e[1],`));
      return resTexRC.x * `).concat(e[1],` + resTexRC.y;
    }
  `)}function P1e(r,e,t){if(t)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;var n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],a=Math.ceil(r[2]/2),i=a*Math.ceil(r[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`.concat(n[0],", ").concat(n[1],`));
      int index = resTexRC.x * `).concat(n[1],` + resTexRC.y;

      int b = index / `).concat(i,`;
      index -= b * `).concat(i,`;

      int r = 2 * (index / `).concat(a,`);
      int c = imod(index, `).concat(a,`) * 2;

      return ivec3(b, r, c);
    }
  `)}function M1e(r,e,t){if(t){var n=od(["r","c","d"],r);return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    `.concat(n,`
    return ivec3(r, c, d);
  }
`)}var a=Ps(["r","c","d"],r);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`.concat(e[0],", ").concat(e[1],`));
      int index = resTexRC.x * `).concat(e[1],` + resTexRC.y;
      `).concat(a,`
      return ivec3(r, c, d);
    }
  `)}function B1e(r,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;for(var n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],a=Math.ceil(r[r.length-1]/2),i=a*Math.ceil(r[r.length-2]/2),o=i,s="",u="b, r, c",c=2;c<r.length-1;c++)o*=r[r.length-c-1],s=`
      int b`.concat(c," = index / ").concat(o,`;
      index -= b`).concat(c," * ").concat(o,`;
    `)+s,u="b".concat(c,", ")+u;return`
    ivec`.concat(r.length,` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`).concat(n[0],", ").concat(n[1],`));
      int index = resTexRC.x * `).concat(n[1],` + resTexRC.y;

      `).concat(s,`

      int b = index / `).concat(i,`;
      index -= b * `).concat(i,`;

      int r = 2 * (index / `).concat(a,`);
      int c = imod(index, `).concat(a,`) * 2;

      return ivec`).concat(r.length,"(").concat(u,`);
    }
  `)}function L1e(r,e,t){if(t){var n=od(["r","c","d","d2"],r);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      `.concat(n,`
      return ivec4(r, c, d, d2);
    }
  `)}var a=Ps(["r","c","d","d2"],r);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`.concat(e[0],", ").concat(e[1],`));
      int index = resTexRC.x * `).concat(e[1],` + resTexRC.y;
      `).concat(a,`
      return ivec4(r, c, d, d2);
    }
  `)}function z1e(r,e){var t=Ps(["r","c","d","d2","d3"],r);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`.concat(e[0],`,
                             `).concat(e[1],`));

      int index = resTexRC.x * `).concat(e[1],` + resTexRC.y;

      `).concat(t,`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `)}function $1e(r,e){var t=Ps(["r","c","d","d2","d3","d4"],r);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`.concat(e[0],", ").concat(e[1],`));
      int index = resTexRC.x * `).concat(e[1],` + resTexRC.y;

      `).concat(t,`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `)}function W1e(r,e,t){var n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(k.util.arraysEqual(r,e))return t?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`.concat(n[0],", ").concat(n[1],`));
      }
    `);var a=Math.ceil(r[1]/2);return t?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`.concat(n[0],", ").concat(n[1],`));

      int index = resTexRC.x * `).concat(n[1],` + resTexRC.y;
      int r = 2 * (index / `).concat(a,`);
      int c = imod(index, `).concat(a,`) * 2;

      return ivec2(r, c);
    }
  `)}function G1e(r,e,t){return k.util.arraysEqual(r,e)?t?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`.concat(e[0],", ").concat(e[1],`));
      }
    `):r[1]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`.concat(e[0],", ").concat(e[1],`));
        int index = resTexRC.x * `).concat(e[1],` + resTexRC.y;
        return ivec2(index, 0);
      }
    `):r[0]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`.concat(e[0],", ").concat(e[1],`));
        int index = resTexRC.x * `).concat(e[1],` + resTexRC.y;
        return ivec2(0, index);
      }
    `):t?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`.concat(e[0],", ").concat(e[1],`));
      int index = resTexRC.x * `).concat(e[1],` + resTexRC.y;
      int r = index / `).concat(r[1],`;
      int c = index - r * `).concat(r[1],`;
      return ivec2(r, c);
    }
  `)}function Ms(r){return"offset".concat(r)}function V1e(r){var e=r.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),n=hn();return`
    vec4 `.concat(t,`() {
      return `).concat(n.texture2D,"(").concat(e,`, halfCR);
    }
  `)}function U1e(r,e){var t=r.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(r.shapeInfo.isUniform)return"float ".concat(n,"() {return ").concat(t,";}");var a=Ee(r.shapeInfo.texShape,2),i=a[0],o=a[1];if(i===1&&o===1)return`
      float `.concat(n,`() {
        return sampleTexture(`).concat(t,`, halfCR);
      }
    `);var s=Ms(t);if(e)return`
    float `.concat(n,`() {
      vec2 uv = uvFromFlat(`).concat(t,"TexShape[0], ").concat(t,"TexShape[1], ").concat(s,`);
      return sampleTexture(`).concat(t,`, uv);
    }
  `);var u=Ee(r.shapeInfo.texShape,2),c=u[0],l=u[1];return`
    float `.concat(n,`() {
      vec2 uv = uvFromFlat(`).concat(c,", ").concat(l,", ").concat(s,`);
      return sampleTexture(`).concat(t,`, uv);
    }
  `)}function H1e(r,e){var t=r.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),a=r.shapeInfo.texShape,i=hn();if(e)return`
    vec4 `.concat(n,`(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(`).concat(t,"TexShape[0]) / 2.0), ceil(float(").concat(t,`TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return `).concat(i.texture2D,"(").concat(t,`, uv);
    }
  `);var o=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];return`
    vec4 `.concat(n,`(int index) {
      vec2 uv = packedUVfrom1D(
        `).concat(o[0],", ").concat(o[1],`, index);
      return `).concat(i.texture2D,"(").concat(t,`, uv);
    }
  `)}function q1e(r,e){var t=r.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(r.shapeInfo.isUniform)return`
      float `.concat(n,`(int index) {
        `).concat(Xu(r),`
      }
    `);var a=r.shapeInfo.texShape,i=a[0],o=a[1];if(o===1&&i===1)return`
      float `.concat(n,`(int index) {
        return sampleTexture(`).concat(t,`, halfCR);
      }
    `);var s=Ms(t);return o===1?e?`
      float `.concat(n,`(int index) {
        vec2 uv = vec2(0.5, (float(index + `).concat(s,") + 0.5) / float(").concat(t,`TexShape[0]));
        return sampleTexture(`).concat(t,`, uv);
      }
    `):`
      float `.concat(n,`(int index) {
        vec2 uv = vec2(0.5, (float(index + `).concat(s,") + 0.5) / ").concat(i,`.0);
        return sampleTexture(`).concat(t,`, uv);
      }
    `):i===1?e?`
      float `.concat(n,`(int index) {
        vec2 uv = vec2((float(index + `).concat(s,") + 0.5) / float(").concat(t,`TexShape[1]), 0.5);
        return sampleTexture(`).concat(t,`, uv);
      }
    `):`
      float `.concat(n,`(int index) {
        vec2 uv = vec2((float(index + `).concat(s,") + 0.5) / ").concat(o,`.0, 0.5);
        return sampleTexture(`).concat(t,`, uv);
      }
    `):e?`
    float `.concat(n,`(int index) {
      vec2 uv = uvFromFlat(`).concat(t,"TexShape[0], ").concat(t,"TexShape[1], index + ").concat(s,`);
      return sampleTexture(`).concat(t,`, uv);
    }
  `):`
    float `.concat(n,`(int index) {
      vec2 uv = uvFromFlat(`).concat(i,", ").concat(o,", index + ").concat(s,`);
      return sampleTexture(`).concat(t,`, uv);
    }
  `)}function K1e(r,e){var t=r.shapeInfo.logicalShape,n=r.name,a="get"+n.charAt(0).toUpperCase()+n.slice(1),i=r.shapeInfo.texShape,o=i[0],s=i[1],u=hn();if(i!=null&&k.util.arraysEqual(t,i))return e?`
      vec4 `.concat(a,`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`).concat(n,"TexShape[1], ").concat(n,`TexShape[0]);

        return `).concat(u.texture2D,"(").concat(n,`, uv);
      }
    `):`
      vec4 `.concat(a,`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`).concat(s,".0, ").concat(o,`.0);

        return `).concat(u.texture2D,"(").concat(n,`, uv);
      }
    `);if(e)return`
    vec4 `.concat(a,`(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(`).concat(n,"TexShape[0]) / 2.0), ceil(float(").concat(n,`TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(`).concat(n,`Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return `).concat(u.texture2D,"(").concat(n,`, uv);
    }
  `);var c=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],l=Math.ceil(t[1]/2);return`
    vec4 `.concat(a,`(int row, int col) {
      vec2 uv = packedUVfrom2D(`).concat(l,", ").concat(c[0],", ").concat(c[1],`, row, col);
      return `).concat(u.texture2D,"(").concat(n,`, uv);
    }
  `)}function j1e(r,e){var t=r.shapeInfo.logicalShape,n=r.name,a="get"+n.charAt(0).toUpperCase()+n.slice(1),i=r.shapeInfo.texShape;if(i!=null&&k.util.arraysEqual(t,i)){if(e)return`
      float `.concat(a,`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`).concat(n,"TexShape[1], ").concat(n,`TexShape[0]);
        return sampleTexture(`).concat(n,`, uv);
      }
    `);var o=i[0],s=i[1];return`
    float `.concat(a,`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`).concat(s,".0, ").concat(o,`.0);
      return sampleTexture(`).concat(n,`, uv);
    }
  `)}var u=k.util.squeezeShape(t),c=u.newShape,l=u.keptDims,f=c;if(f.length<t.length){var h=Yu(r,f),p=["row","col"];return`
      `.concat(ju(h,e),`
      float `).concat(a,`(int row, int col) {
        return `).concat(a,"(").concat(Zu(p,l),`);
      }
    `)}if(r.shapeInfo.isUniform)return`
      float `.concat(a,`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`).concat(t[1],`, 1)));
        `).concat(Xu(r),`
      }
    `);var d=i[0],m=i[1],v=Ms(n);return m===1?e?`
      float `.concat(a,`(int row, int col) {
        float index = dot(vec3(row, col, `).concat(v,"), vec3(").concat(n,`Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(`).concat(n,`TexShape[0]));
        return sampleTexture(`).concat(n,`, uv);
      }
    `):`
    float `.concat(a,`(int row, int col) {
      float index = dot(vec3(row, col, `).concat(v,"), vec3(").concat(t[1],`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `).concat(d,`.0);
      return sampleTexture(`).concat(n,`, uv);
    }
  `):d===1?e?`
      float `.concat(a,`(int row, int col) {
        float index = dot(vec3(row, col, `).concat(v,"), vec3(").concat(n,`Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(`).concat(n,`TexShape[1]), 0.5);
        return sampleTexture(`).concat(n,`, uv);
      }
    `):`
    float `.concat(a,`(int row, int col) {
      float index = dot(vec3(row, col, `).concat(v,"), vec3(").concat(t[1],`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `).concat(m,`.0, 0.5);
      return sampleTexture(`).concat(n,`, uv);
    }
  `):e?`
      float `.concat(a,`(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `).concat(n,"Shape[1] + col + ").concat(v,`;
        vec2 uv = uvFromFlat(`).concat(n,"TexShape[0], ").concat(n,`TexShape[1], index);
        return sampleTexture(`).concat(n,`, uv);
      }
    `):`
  float `.concat(a,`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `).concat(t[1]," + col + ").concat(v,`;
    vec2 uv = uvFromFlat(`).concat(d,", ").concat(m,`, index);
    return sampleTexture(`).concat(n,`, uv);
  }
`)}function X1e(r,e){var t=r.shapeInfo.logicalShape,n=r.name,a="get"+n.charAt(0).toUpperCase()+n.slice(1),i=r.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(t[0]===1){var s=t.slice(1),u=[1,2],c=Yu(r,s),l=["b","row","col"];return`
        `.concat(hF(c,e),`
        vec4 `).concat(a,`(int b, int row, int col) {
          return `).concat(a,"(").concat(Zu(l,u),`);
        }
      `)}var f=hn();if(e)return`
    vec4 `.concat(a,`(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(`).concat(n,"TexShape[0]) / 2.0), ceil(float(").concat(n,`TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(`).concat(n,`Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(`).concat(n,`Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return `).concat(f.texture2D,"(").concat(n,`, uv);
    }
  `);var h=o[0],p=o[1],d=Math.ceil(t[2]/2),m=d*Math.ceil(t[1]/2);return`
    vec4 `.concat(a,`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `).concat(h,", ").concat(p,", ").concat(m,", ").concat(d,`, b, row, col);
      return `).concat(f.texture2D,"(").concat(n,`, uv);
    }
  `)}function Y1e(r,e){var t=r.shapeInfo.logicalShape,n=r.name,a="get"+n.charAt(0).toUpperCase()+n.slice(1),i=t[1]*t[2],o=t[2],s=k.util.squeezeShape(t),u=s.newShape,c=s.keptDims,l=u;if(l.length<t.length){var f=Yu(r,l),h=["row","col","depth"];return`
        `.concat(ju(f,e),`
        float `).concat(a,`(int row, int col, int depth) {
          return `).concat(a,"(").concat(Zu(h,c),`);
        }
      `)}if(r.shapeInfo.isUniform)return`
      float `.concat(a,`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`).concat(i,", ").concat(o,`, 1)));
        `).concat(Xu(r),`
      }
    `);var p=r.shapeInfo.texShape,d=p[0],m=p[1],v=r.shapeInfo.flatOffset;if(m===i&&v==null)return e?`
      float `.concat(a,`(int row, int col, int depth) {
        int stride1 = `).concat(n,`Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`).concat(n,"TexShape[1], ").concat(n,`TexShape[0]);
        return sampleTexture(`).concat(n,`, uv);
      }
    `):`
        float `.concat(a,`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`).concat(o,`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`).concat(m,".0, ").concat(d,`.0);
          return sampleTexture(`).concat(n,`, uv);
        }
      `);if(m===o&&v==null)return e?`
      float `.concat(a,`(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(`).concat(n,`Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`).concat(n,"TexShape[1], ").concat(n,`TexShape[0]);
        return sampleTexture(`).concat(n,`, uv);
      }
    `):`
    float `.concat(a,`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`).concat(t[1],`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`).concat(m,".0, ").concat(d,`.0);
      return sampleTexture(`).concat(n,`, uv);
    }
  `);var g=Ms(n);return e?`
    float `.concat(a,`(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = `).concat(n,"Shape[1] * ").concat(n,`Shape[2];
      int stride1 = `).concat(n,`Shape[2];
      int index = row * stride0 + col * stride1 + depth + `).concat(g,`;
      vec2 uv = uvFromFlat(`).concat(n,"TexShape[0], ").concat(n,`TexShape[1], index);
      return sampleTexture(`).concat(n,`, uv);
    }
    `):`
      float `.concat(a,`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `).concat(i," + col * ").concat(o," + depth + ").concat(g,`;
        vec2 uv = uvFromFlat(`).concat(d,", ").concat(m,`, index);
        return sampleTexture(`).concat(n,`, uv);
      }
  `)}function Z1e(r,e){var t=r.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),a=hn();if(e)return`
    vec4 `.concat(n,`(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(`).concat(t,`Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(`).concat(t,`Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= `).concat(t,`Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(`).concat(t,"TexShape[0]) / 2.0), ceil(float(").concat(t,`TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return `).concat(a.texture2D,"(").concat(t,`, uv);
    }
  `);for(var i=r.shapeInfo.logicalShape,o=i.length,s=r.shapeInfo.texShape,u=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],c=u[0],l=u[1],f=Math.ceil(i[o-1]/2),h=f*Math.ceil(i[o-2]/2),p="int b, int row, int col",d="b * ".concat(h," + (row / 2) * ").concat(f," + (col / 2)"),m=2;m<o-1;m++)p="int b".concat(m,", ")+p,h*=i[o-m-1],d="b".concat(m," * ").concat(h," + ")+d;return`
    vec4 `.concat(n,"(").concat(p,`) {
      int index = `).concat(d,`;
      int texR = index / `).concat(l,`;
      int texC = index - texR * `).concat(l,`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`).concat(l,", ").concat(c,`);
      return `).concat(a.texture2D,"(").concat(t,`, uv);
    }
  `)}function J1e(r,e){var t=r.shapeInfo.logicalShape,n=r.name,a="get"+n.charAt(0).toUpperCase()+n.slice(1),i=t[3],o=t[2]*i,s=t[1]*o,u=k.util.squeezeShape(t),c=u.newShape,l=u.keptDims;if(c.length<t.length){var f=Yu(r,c),h=["row","col","depth","depth2"];return`
      `.concat(ju(f,e),`
      float `).concat(a,`(int row, int col, int depth, int depth2) {
        return `).concat(a,"(").concat(Zu(h,l),`);
      }
    `)}if(r.shapeInfo.isUniform)return`
      float `.concat(a,`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`).concat(s,", ").concat(o,", ").concat(i,`, 1)));
        `).concat(Xu(r),`
      }
    `);var p=r.shapeInfo.flatOffset,d=r.shapeInfo.texShape,m=d[0],v=d[1],g="int stride2 = ".concat(n,"Shape[3];"),y="int stride1 = ".concat(n,"Shape[2] * stride2;"),w="int stride0 = ".concat(n,"Shape[1] * stride1;");if(v===s&&p==null)return e?`
      float `.concat(a,`(int row, int col, int depth, int depth2) {
        `).concat(g,`
        `).concat(y,`
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`).concat(n,"TexShape[1], ").concat(n,`TexShape[0]);
        return sampleTexture(`).concat(n,`, uv);
      }
    `):`
      float `.concat(a,`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`).concat(o,", ").concat(i,`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`).concat(v,".0, ").concat(m,`.0);
        return sampleTexture(`).concat(n,`, uv);
      }
    `);if(v===i&&p==null)return e?`
      float `.concat(a,`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`).concat(n,"Shape[1] * ").concat(n,"Shape[2], ").concat(n,`Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`).concat(n,"TexShape[1], ").concat(n,`TexShape[0]);
        return sampleTexture(`).concat(n,`, uv);
      }
    `):`
      float `.concat(a,`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`).concat(t[1]*t[2],", ").concat(t[2],`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`).concat(v,".0, ").concat(m,`.0);
        return sampleTexture(`).concat(n,`, uv);
      }
    `);var b=Ms(n);return e?`
    float `.concat(a,`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      `).concat(g,`
      `).concat(y,`
      `).concat(w,`
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(`).concat(n,"TexShape[0], ").concat(n,"TexShape[1], index + ").concat(b,`);
      return sampleTexture(`).concat(n,`, uv);
    }
  `):`
    float `.concat(a,`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `).concat(s," + col * ").concat(o,` +
          depth * `).concat(i,` + depth2;
      vec2 uv = uvFromFlat(`).concat(m,", ").concat(v,", index + ").concat(b,`);
      return sampleTexture(`).concat(n,`, uv);
    }
  `)}function Q1e(r){var e=r.shapeInfo.logicalShape,t=r.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),a=e[4],i=e[3]*a,o=e[2]*i,s=e[1]*o,u=k.util.squeezeShape(e),c=u.newShape,l=u.keptDims;if(c.length<e.length){var f=Yu(r,c),h=["row","col","depth","depth2","depth3"];return`
      `.concat(ju(f),`
      float `).concat(n,`(int row, int col, int depth, int depth2, int depth3) {
        return `).concat(n,"(").concat(Zu(h,l),`);
      }
    `)}if(r.shapeInfo.isUniform)return`
      float `.concat(n,`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`).concat(s,", ").concat(o,", ").concat(i,", ").concat(a,`)) +
          depth3;
        `).concat(Xu(r),`
      }
    `);var p=r.shapeInfo.flatOffset,d=r.shapeInfo.texShape,m=d[0],v=d[1];if(v===s&&p==null)return`
      float `.concat(n,`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`).concat(o,", ").concat(i,", ").concat(a,`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`).concat(v,".0, ").concat(m,`.0);
        return sampleTexture(`).concat(t,`, uv);
      }
    `);if(v===a&&p==null)return`
      float `.concat(n,`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`).concat(e[1]*e[2]*e[3],`,
               `).concat(e[2]*e[3],", ").concat(e[3],`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`).concat(v,".0, ").concat(m,`.0);
        return sampleTexture(`).concat(t,`, uv);
      }
    `);var g=Ms(t);return`
    float `.concat(n,`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `).concat(s," + col * ").concat(o," + depth * ").concat(i,` +
          depth2 * `).concat(a," + depth3 + ").concat(g,`;
      vec2 uv = uvFromFlat(`).concat(m,", ").concat(v,`, index);
      return sampleTexture(`).concat(t,`, uv);
    }
  `)}function exe(r){var e=r.shapeInfo.logicalShape,t=r.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),a=k.util.squeezeShape(e),i=a.newShape,o=a.keptDims;if(i.length<e.length){var s=Yu(r,i),u=["row","col","depth","depth2","depth3","depth4"];return`
      `.concat(ju(s),`
      float `).concat(n,`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `).concat(n,"(").concat(Zu(u,o),`);
      }
    `)}var c=e[5],l=e[4]*c,f=e[3]*l,h=e[2]*f,p=e[1]*h;if(r.shapeInfo.isUniform)return`
      float `.concat(n,`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`).concat(p,", ").concat(h,", ").concat(f,", ").concat(l,`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`).concat(c,`, 1)));
        `).concat(Xu(r),`
      }
    `);var d=r.shapeInfo.flatOffset,m=r.shapeInfo.texShape,v=m[0],g=m[1];if(g===p&&d==null)return`
      float `.concat(n,`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`).concat(h,", ").concat(f,", ").concat(l,", ").concat(c,`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`).concat(g,".0, ").concat(v,`.0);
        return sampleTexture(`).concat(t,`, uv);
      }
    `);if(g===c&&d==null)return`
      float `.concat(n,`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`).concat(e[1]*e[2]*e[3]*e[4],`,
               `).concat(e[2]*e[3]*e[4],`,
               `).concat(e[3]*e[4],`,
               `).concat(e[4],`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`).concat(g,".0, ").concat(v,`.0);
        return sampleTexture(`).concat(t,`, uv);
      }
    `);var y=Ms(t);return`
    float `.concat(n,`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `).concat(p," + col * ").concat(h," + depth * ").concat(f,` +
          depth2 * `).concat(l," + depth3 * ").concat(c," + depth4 + ").concat(y,`;
      vec2 uv = uvFromFlat(`).concat(v,", ").concat(g,`, index);
      return sampleTexture(`).concat(t,`, uv);
    }
  `)}function Xu(r){var e=r.name,t=k.util.sizeFromShape(r.shapeInfo.logicalShape);return t<2?"return ".concat(e,";"):`
    for (int i = 0; i < `.concat(t,`; i++) {
      if (i == index) {
        return `).concat(e,`[i];
      }
    }
  `)}function txe(r,e){var t=r.name,n=t.charAt(0).toUpperCase()+t.slice(1),a="get"+n+"AtOutCoords",i=r.shapeInfo.logicalShape.length,o=e.logicalShape.length,s=fF(r.shapeInfo.logicalShape,e.logicalShape),u=Ft(o),c=o-i,l,f=["x","y","z","w","u","v"];i===0?l="":o<2&&s.length>=1?l="coords = 0;":l=s.map(function(b){return"coords.".concat(f[b+c]," = 0;")}).join(`
`);var h="";o<2&&i>0?h="coords":h=r.shapeInfo.logicalShape.map(function(b,x){return"coords.".concat(f[x+c])}).join(", ");var p="return outputValue;",d=k.util.sizeFromShape(r.shapeInfo.logicalShape),m=d===1,v=k.util.sizeFromShape(e.logicalShape),g=v===1;if(i===1&&!m&&!g)p=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(m&&!g)o===1?p=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:p=`
        return vec4(outputValue.x);
      `;else if(s.length){var y=i-2,w=i-1;s.indexOf(y)>-1&&s.indexOf(w)>-1?p="return vec4(outputValue.x);":s.indexOf(y)>-1?p="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":s.indexOf(w)>-1&&(p="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 `.concat(a,`() {
      `).concat(u,` coords = getOutputCoords();
      `).concat(l,`
      vec4 outputValue = get`).concat(n,"(").concat(h,`);
      `).concat(p,`
    }
  `)}function rxe(r,e){var t=r.name,n=t.charAt(0).toUpperCase()+t.slice(1),a="get"+n+"AtOutCoords",i=e.texShape,o=r.shapeInfo.texShape,s=r.shapeInfo.logicalShape.length,u=e.logicalShape.length;if(!r.shapeInfo.isUniform&&s===u&&r.shapeInfo.flatOffset==null&&k.util.arraysEqual(o,i))return`
      float `.concat(a,`() {
        return sampleTexture(`).concat(t,`, resultUV);
      }
    `);var c=Ft(u),l=fF(r.shapeInfo.logicalShape,e.logicalShape),f=u-s,h,p=["x","y","z","w","u","v"];s===0?h="":u<2&&l.length>=1?h="coords = 0;":h=l.map(function(m){return"coords.".concat(p[m+f]," = 0;")}).join(`
`);var d="";return u<2&&s>0?d="coords":d=r.shapeInfo.logicalShape.map(function(m,v){return"coords.".concat(p[v+f])}).join(", "),`
    float `.concat(a,`() {
      `).concat(c,` coords = getOutputCoords();
      `).concat(h,`
      return get`).concat(n,"(").concat(d,`);
    }
  `)}function Ft(r){if(r<=1)return"int";if(r===2)return"ivec2";if(r===3)return"ivec3";if(r===4)return"ivec4";if(r===5)return"ivec5";if(r===6)return"ivec6";throw Error("GPU for rank ".concat(r," is not yet supported"))}function gb(r,e,t){var n=k.util.squeezeShape(e),a=n.newShape,i=n.keptDims,o=e.length,s=r&&o===3&&e[0]===1,u=s?e.slice(1):a,c=!r&&o>1&&!k.util.arraysEqual(e,t)&&a.length<o||s,l=c?u:e;return{useSqueezeShape:c,uniformShape:l,keptDims:i}}function Yu(r,e){var t=JSON.parse(JSON.stringify(r));return t.shapeInfo.logicalShape=e,t}function Zu(r,e){return e.map(function(t){return r[t]}).join(", ")}function nxe(r,e,t,n){var a=t.map(function(l,f){var h={logicalShape:l.shape,texShape:l.isUniform?null:l.texData.texShape,isUniform:l.isUniform,isPacked:l.isUniform?!1:l.texData.isPacked,flatOffset:null};return l.texData!=null&&l.texData.slice!=null&&l.texData.slice.flatOffset>0&&(h.flatOffset=l.texData.slice.flatOffset),{name:e.variableNames[f],shapeInfo:h}}),i=a.map(function(l){return l.shapeInfo}),o={logicalShape:n.shape,texShape:n.texData.texShape,isUniform:!1,isPacked:n.texData.isPacked,flatOffset:null},s=x1e(a,o,e),u=V3(r.gl,s),c=r.createProgram(u);return k.env().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:u,source:s,webGLProgram:c,inShapeInfos:i,outShapeInfo:o,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(r.buildVao(c),Object.assign({program:e,fragmentShader:u,source:s,webGLProgram:c,inShapeInfos:i,outShapeInfo:o},dF(r,e,c)))}function dF(r,e,t){var n,a,i,o,s=[],u=[],c,l,f,h=null,p=null;p=r.getUniformLocation(t,"NAN",!1),k.env().getNumber("WEBGL_VERSION")===1&&(h=r.getUniformLocation(t,"INFINITY",!1));var d=!1;try{for(var m=ln(e.variableNames),v=m.next();!v.done;v=m.next()){var g=v.value,y={name:g,uniform:r.getUniformLocation(t,g,d),offset:r.getUniformLocation(t,"offset".concat(g),d)};e.enableShapeUniforms&&(y.shape=r.getUniformLocation(t,"".concat(g,"Shape"),d),y.texShape=r.getUniformLocation(t,"".concat(g,"TexShape"),d)),s.push(y)}}catch(S){n={error:S}}finally{try{v&&!v.done&&(a=m.return)&&a.call(m)}finally{if(n)throw n.error}}if(e.enableShapeUniforms&&(c=r.getUniformLocation(t,"outShape",d),f=r.getUniformLocation(t,"outShapeStrides",d),l=r.getUniformLocation(t,"outTexShape",d)),e.customUniforms)try{for(var w=ln(e.customUniforms),b=w.next();!b.done;b=w.next()){var x=b.value;u.push(r.getUniformLocation(t,x.name,d))}}catch(S){i={error:S}}finally{try{b&&!b.done&&(o=w.return)&&o.call(w)}finally{if(i)throw i.error}}return{variablesLocations:s,customUniformLocations:u,infLoc:h,nanLoc:p,outShapeLocation:c,outShapeStridesLocation:f,outTexShapeLocation:l}}function c3(r,e){if(r.length!==e.length)throw Error("Binary was compiled with ".concat(r.length," inputs, but ")+"was executed with ".concat(e.length," inputs"));r.forEach(function(t,n){var a=t.logicalShape,i=e[n],o=i.shape;if(!k.util.arraysEqual(a,o))throw Error("Binary was compiled with different shapes than "+"the current args. Shapes ".concat(a," and ").concat(o," must match"));if(!(t.isUniform&&i.isUniform)){var s=t.texShape,u=i.isUniform?null:i.texData.texShape;if(!k.util.arraysEqual(s,u))throw Error("Binary was compiled with different texture shapes than the"+" current args. Shape ".concat(s," and ").concat(u," must match"))}})}function axe(r,e,t,n,a){e.program.enableShapeUniforms||(c3(e.inShapeInfos,t),c3([e.outShapeInfo],[n]));var i=n.texData.texture,o=n.texData.texShape;n.texData.isPacked?r.setOutputPackedMatrixTexture(i.texture,o[0],o[1]):r.setOutputMatrixTexture(i.texture,o[0],o[1]),r.setProgram(e.webGLProgram),r.bindVertexArray(e.webGLProgram.vao),k.env().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&r.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&r.gl.uniform1f(e.nanLoc,NaN);for(var s=0;s<t.length;++s){var u=t[s],c=e.variablesLocations[s],l=c.uniform,f=c.offset,h=c.shape,p=c.texShape;if(h){var d=gb(e.program.packedInputs,u.shape,u.texData.texShape).uniformShape;switch(d.length){case 1:r.gl.uniform1iv(h,new Int32Array(d));break;case 2:r.gl.uniform2iv(h,new Int32Array(d));break;case 3:r.gl.uniform3iv(h,new Int32Array(d));break;case 4:r.gl.uniform4iv(h,new Int32Array(d));break}}if(p&&r.gl.uniform2i(p,u.texData.texShape[0],u.texData.texShape[1]),l!=null){if(u.isUniform){if(k.util.sizeFromShape(u.shape)<2)r.gl.uniform1f(l,u.uniformValues[0]);else{var m=u.uniformValues;m instanceof Float32Array||(m=new Float32Array(m)),r.gl.uniform1fv(l,m)}continue}u.texData.slice!=null&&f!=null&&r.gl.uniform1i(f,u.texData.slice.flatOffset),r.setInputMatrixTexture(u.texData.texture.texture,l,s)}}var v=e.outShapeLocation;if(v)switch(n.shape.length){case 1:r.gl.uniform1iv(v,new Int32Array(n.shape));break;case 2:r.gl.uniform2iv(v,new Int32Array(n.shape));break;case 3:r.gl.uniform3iv(v,new Int32Array(n.shape));break;case 4:r.gl.uniform4iv(v,new Int32Array(n.shape));break}if(e.outShapeStridesLocation){var g=k.util.computeStrides(n.shape);switch(n.shape.length){case 2:r.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(g));break;case 3:r.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(g));break;case 4:r.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(g));break}}if(e.outTexShapeLocation&&r.gl.uniform2i(e.outTexShapeLocation,n.texData.texShape[0],n.texData.texShape[1]),e.program.customUniforms&&a)for(var s=0;s<e.program.customUniforms.length;++s){var y=e.program.customUniforms[s],w=e.customUniformLocations[s],b=a[s];if(y.type==="float")r.gl.uniform1fv(w,b);else if(y.type==="vec2")r.gl.uniform2fv(w,b);else if(y.type==="vec3")r.gl.uniform3fv(w,b);else if(y.type==="vec4")r.gl.uniform4fv(w,b);else if(y.type==="int")r.gl.uniform1iv(w,b);else if(y.type==="ivec2")r.gl.uniform2iv(w,b);else if(y.type==="ivec3")r.gl.uniform3iv(w,b);else if(y.type==="ivec4")r.gl.uniform4iv(w,b);else throw Error("uniform type ".concat(y.type," is not supported yet."))}r.executeProgram()}function ixe(r,e,t){var n="";e.concat(t).forEach(function(o){var s=o.texData!=null&&o.texData.slice!=null&&o.texData.slice.flatOffset>0;if(r.enableShapeUniforms&&!o.isUniform){var u=o.texData.texShape,c=gb(r.packedInputs,o.shape,u),l=c.useSqueezeShape,f=c.uniformShape,h=c.keptDims,p="",d="",m="";if(f.length===1&&r.packedInputs){var v=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];p="".concat(v[0]>1,"_").concat(v[1]>1)}else if(f.length===2&&!r.packedInputs)d="".concat(f[0]>1,"_").concat(f[1]>1);else if(f.length>2&&!r.packedInputs){var g=k.util.computeStrides(f);m="".concat(g[0]===u[1],"_").concat(g[g.length-1]===u[1])}var y=o.shape.length,w=f.length===2&&k.util.arraysEqual(o.shape,u),b=k.util.sizeFromShape(o.shape)===1,x=k.backend_util.getBroadcastDims(o.shape,t.shape),S=!r.packedInputs&&y===t.shape.length&&k.util.arraysEqual(u,t.texData.texShape),T=r.packedInputs||f.length>2?"":"".concat(u[0]>1,"_").concat(u[1]>1);n+="".concat(y,"_").concat(S,"_").concat(l?h:"","_").concat(f.length,"_").concat(b,"_").concat(x,"_").concat(w,"_").concat(p,"_").concat(d,"_").concat(m,"_").concat(T,"_").concat(s)}else{var N=o.isUniform?"uniform":o.texData.texShape;n+="".concat(o.shape,"_").concat(N,"_").concat(s)}});var a=r.userCode,i=r.constructor.name;return i+="_"+n+"_"+a+"".concat(k.env().getNumber("WEBGL_VERSION")),i}function tn(r){return k.env().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&r<=4}var oxe=(function(){function r(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Kl.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];var t=hn();this.outputShape=e,this.enableShapeUniforms=tn(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `.concat(this.enableShapeUniforms?od(["r","c","d"],e):Ps(["r","c","d"],e),`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `).concat(t.output,` = result;
      }
    `)}return r})();var sxe=(function(){function r(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Kl.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];var t=hn();this.outputShape=e,this.enableShapeUniforms=tn(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `.concat(this.enableShapeUniforms?od(["r","c","d"],e):Ps(["r","c","d"],e),`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `).concat(t.output,` = result;
      }
    `)}return r})();var uxe=(function(){function r(e){this.variableNames=["A"],this.outTexUsage=aa.DOWNLOAD;var t=hn();this.outputShape=e,this.userCode=`
      `.concat(lF,`

      void main() {
        float x = getAAtOutCoords();
        `).concat(t.output,` = encode_float(x);
      }
    `)}return r})();var cxe=(function(){function r(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=aa.DOWNLOAD;var t=hn();this.outputShape=e,this.userCode=`
      `.concat(lF,`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `).concat(t.output,` = encode_float(x);
      }
    `)}return r})();var lxe={R:0,G:1,B:2,A:3},l3=(function(){function r(e,t,n){t===void 0&&(t=!1),n===void 0&&(n="RGBA"),this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];var a=hn();this.outputShape=e,this.enableShapeUniforms=tn(this.outputShape.length);var i="result";t&&(i="floor(result * 255. + 0.5)");for(var o="",s=0;s<n.length;s++){var u=n[s];o+=`
          if(offset == `.concat(s,`) {
            result = values[`).concat(lxe[u],`];
          }`)}this.userCode=`
      `.concat(this.enableShapeUniforms?mb():vb(e),`

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, `).concat(n.length,`);

        flatIndex = idiv(flatIndex, `).concat(n.length,`, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = `).concat(a.texture2D,`(A, uv);
          `).concat(o,`
        }
        `).concat(a.output," = vec4(").concat(i,`, 0., 0., 0.);
      }
    `)}return r})();var fxe=(function(){function r(e,t){t===void 0&&(t=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];var n=hn();this.outputShape=e,this.enableShapeUniforms=tn(this.outputShape.length);var a="",i="result";t&&(i="floor(result * 255. + 0.5)");for(var o=0;o<=1;o++)for(var s=0;s<=1;s++){var u=o*2+s;a+=`
          localCoords = coords;
          if(localCoords[2] + `.concat(s," < ").concat(this.enableShapeUniforms?"outShape[2]":"".concat(e[2]),`) {
          localCoords[2] += `).concat(s,`;
          if (localCoords[1] + `).concat(o," < ").concat(this.enableShapeUniforms?"outShape[1]":"".concat(e[1]),`) {
            localCoords[1] += `).concat(o,`;

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = `).concat(n.texture2D,`(A, uv);

            if (offset == 0) {
              result[`).concat(u,`] = values[0];
            } else if (offset == 1) {
              result[`).concat(u,`] = values[1];
            } else if (offset == 2) {
              result[`).concat(u,`] = values[2];
            } else {
              result[`).concat(u,`] = values[3];
            }
          }
        }
        `)}this.userCode=`
        `.concat(this.enableShapeUniforms?mb():vb(e),`

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          `).concat(a,`

          `).concat(n.output," = ").concat(i,`;
        }
    `)}return r})();function vF(r){var e=hn(),t="".concat(e.version,`
    precision highp float;
    `).concat(e.attribute,` vec3 clipSpacePos;
    `).concat(e.attribute,` vec2 uv;
    `).concat(e.varyingVs,` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`);return G3(r,t)}function mF(r){var e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return q3(r,e)}function gF(r){var e=new Uint16Array([0,1,2,2,1,3]);return K3(r,e)}function Ql(r,e,t,n,a,i){X3(e,t);var o=j3(r),s=r.TEXTURE_2D;return Oe(r,function(){return r.bindTexture(s,o)}),Oe(r,function(){return r.texParameteri(s,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE)}),Oe(r,function(){return r.texParameteri(s,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE)}),Oe(r,function(){return r.texParameteri(s,r.TEXTURE_MIN_FILTER,r.NEAREST)}),Oe(r,function(){return r.texParameteri(s,r.TEXTURE_MAG_FILTER,r.NEAREST)}),k.env().getNumber("WEBGL_VERSION")===1?Oe(r,function(){return r.texImage2D(s,0,n,e,t,0,a,i,null)}):Oe(r,function(){return r.texStorage2D(s,1,n,e,t)}),Oe(r,function(){return r.bindTexture(r.TEXTURE_2D,null)}),{texture:o,texShape:[t,e]}}function yb(r){return r.internalFormatFloat}function yF(r,e,t,n){var a=Ee(Jl(e,t),2),i=a[0],o=a[1];return Ql(r,i,o,yb(n),n.textureFormatFloat,r.FLOAT)}function bb(r){return r.internalFormatHalfFloat}function bF(r,e,t,n){var a=Ee(Jl(e,t),2),i=a[0],o=a[1];return Ql(r,i,o,bb(n),n.textureFormatFloat,n.textureTypeHalfFloat)}function wb(r){return r.downloadTextureFormat}function wF(r,e,t,n){var a=Ee(Jl(e,t),2),i=a[0],o=a[1];return Ql(r,i,o,wb(n),r.RGBA,r.UNSIGNED_BYTE)}function xb(r){return r.internalFormatPackedFloat}function xF(r,e,t,n){var a=Ee(qu(e,t),2),i=a[0],o=a[1];return Ql(r,i,o,xb(n),r.RGBA,r.FLOAT)}function kb(r){return r.internalFormatPackedHalfFloat}function kF(r,e,t,n){var a=Ee(qu(e,t),2),i=a[0],o=a[1];return Ql(r,i,o,kb(n),r.RGBA,n.textureTypeHalfFloat)}function SF(r,e,t){var n=0,a=12,i=20;Oe(r,function(){return r.bindBuffer(r.ARRAY_BUFFER,t)});var o=ob(r,e,"clipSpacePos",t,3,i,n);return o&&ob(r,e,"uv",t,2,i,a)}function EF(r,e,t,n,a,i){Oe(r,function(){return r.bindTexture(r.TEXTURE_2D,e)});var o,s,u;a instanceof Uint8Array?(o=new Uint8Array(t*n*4),s=r.UNSIGNED_BYTE,u=r.RGBA):(o=new Float32Array(t*n*4),s=r.FLOAT,u=i.internalFormatPackedFloat),o.set(a),k.env().getNumber("WEBGL_VERSION")===2?Oe(r,function(){return r.texSubImage2D(r.TEXTURE_2D,0,0,0,t,n,r.RGBA,s,o)}):Oe(r,function(){return r.texImage2D(r.TEXTURE_2D,0,u,t,n,0,r.RGBA,s,o)}),Oe(r,function(){return r.bindTexture(r.TEXTURE_2D,null)})}function TF(r,e,t){Oe(r,function(){return r.bindTexture(r.TEXTURE_2D,e)}),t.data instanceof Uint8Array?k.env().getNumber("WEBGL_VERSION")===2?Oe(r,function(){return r.texSubImage2D(r.TEXTURE_2D,0,0,0,t.width,t.height,r.RGBA,r.UNSIGNED_BYTE,t.data)}):Oe(r,function(){return r.texImage2D(r.TEXTURE_2D,0,r.RGBA,t.width,t.height,0,r.RGBA,r.UNSIGNED_BYTE,t.data)}):k.env().getNumber("WEBGL_VERSION")===2?Oe(r,function(){return r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,t)}):Oe(r,function(){return r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,t)}),Oe(r,function(){return r.bindTexture(r.TEXTURE_2D,null)})}function NF(r,e,t,n){var a=r.createBuffer();Oe(r,function(){return r.bindBuffer(r.PIXEL_PACK_BUFFER,a)});var i=4,o=4,s=i*o*e*t;return Oe(r,function(){return r.bufferData(r.PIXEL_PACK_BUFFER,s,r.STREAM_READ)}),Oe(r,function(){return r.readPixels(0,0,t,e,r.RGBA,r.FLOAT,0)}),Oe(r,function(){return r.bindBuffer(r.PIXEL_PACK_BUFFER,null)}),a}function IF(r,e,t){var n=r,a=new Float32Array(t);return n.bindBuffer(n.PIXEL_PACK_BUFFER,e),n.getBufferSubData(n.PIXEL_PACK_BUFFER,0,a),n.bindBuffer(n.PIXEL_PACK_BUFFER,null),a}function CF(r,e,t,n){var a=Ee(Jl(e,t),2),i=a[0],o=a[1],s=4,u=new Uint8Array(o1e(e*t,s));return Oe(r,function(){return r.readPixels(0,0,i,o,n.downloadTextureFormat,r.UNSIGNED_BYTE,u)}),new Float32Array(u.buffer)}function AF(r,e,t,n,a,i,o,s){var u=r,c=new Float32Array(s1e(i,o));return u.bindBuffer(u.PIXEL_PACK_BUFFER,e),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c}function DF(r,e,t){var n=new Float32Array(e*t*4);return Oe(r,function(){return r.readPixels(0,0,t,e,r.RGBA,r.FLOAT,n)}),n}var hxe={__proto__:null,bindVertexProgramAttributeStreams:SF,createBufferFromOutputTexture:NF,createFloat16MatrixTexture:bF,createFloat16PackedMatrixTexture:kF,createFloat32MatrixTexture:yF,createIndexBuffer:gF,createPackedMatrixTexture:xF,createUnsignedBytesMatrixTexture:wF,createVertexBuffer:mF,createVertexShader:vF,downloadByteEncodedFloatMatrixFromOutputTexture:CF,downloadFloat32MatrixFromBuffer:IF,downloadMatrixFromPackedOutputTexture:DF,downloadPackedMatrixFromBuffer:AF,getInternalFormatForFloat16MatrixTexture:bb,getInternalFormatForFloat16PackedMatrixTexture:kb,getInternalFormatForFloat32MatrixTexture:yb,getInternalFormatForPackedMatrixTexture:xb,getInternalFormatForUnsignedBytesMatrixTexture:wb,uploadDenseMatrixToTexture:EF,uploadPixelDataToTexture:TF},td=(function(){function r(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];var t=k.env().getNumber("WEBGL_VERSION");if(e!=null?(this.gl=e,z3(t,e)):this.gl=ni(t),e=this.gl,k.env().getNumber("WEBGL_VERSION")===2){var n=e;this.createVertexArray=function(){return Oe(n,function(){return n.createVertexArray()})},this.bindVertexArray=function(c){return Oe(n,function(){return n.bindVertexArray(c)})},this.deleteVertexArray=function(c){return Oe(n,function(){return n.deleteVertexArray(c)})},this.getVertexArray=function(){return Oe(n,function(){return n.getParameter(n.VERTEX_ARRAY_BINDING)})}}else if(e!=null){var a=e.getExtension("OES_vertex_array_object");if(a==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=function(){return Oe(e,function(){return a.createVertexArrayOES()})},this.bindVertexArray=function(c){return Oe(e,function(){return a.bindVertexArrayOES(c)})},this.deleteVertexArray=function(c){return Oe(e,function(){return a.deleteVertexArrayOES(c)})},this.getVertexArray=function(){return Oe(e,function(){return e.getParameter(a.VERTEX_ARRAY_BINDING_OES)})}}var i="WEBGL_color_buffer_float",o="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),k.env().getNumber("WEBGL_VERSION")===1){var s="OES_texture_float",u="OES_texture_half_float";if(this.textureFloatExtension=Gl(this.gl,s),ia(this.gl,u))this.textureHalfFloatExtension=Gl(this.gl,u);else if(k.env().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(i),ia(this.gl,o))this.colorBufferHalfFloatExtension=Gl(this.gl,o);else if(k.env().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(i="EXT_color_buffer_float",ia(this.gl,i))this.colorBufferFloatExtension=this.gl.getExtension(i);else if(ia(this.gl,o))this.colorBufferHalfFloatExtension=this.gl.getExtension(o);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=mF(this.gl),this.indexBuffer=gF(this.gl),this.framebuffer=Y3(this.gl),this.textureConfig=pb(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(r.prototype,"debug",{get:function(){return k.env().getBool("DEBUG")},enumerable:!1,configurable:!0}),r.prototype.dispose=function(){var e=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;Oe(t,function(){return t.finish()}),Oe(t,function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)}),Oe(t,function(){return t.deleteFramebuffer(e.framebuffer)}),Oe(t,function(){return t.bindBuffer(t.ARRAY_BUFFER,null)}),Oe(t,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}),Oe(t,function(){return t.deleteBuffer(e.indexBuffer)}),this.disposed=!0}},r.prototype.createFloat32MatrixTexture=function(e,t){return this.throwIfDisposed(),yF(this.gl,e,t,this.textureConfig)},r.prototype.createFloat16MatrixTexture=function(e,t){return this.throwIfDisposed(),bF(this.gl,e,t,this.textureConfig)},r.prototype.createUnsignedBytesMatrixTexture=function(e,t){return this.throwIfDisposed(),wF(this.gl,e,t,this.textureConfig)},r.prototype.uploadPixelDataToTexture=function(e,t){this.throwIfDisposed(),TF(this.gl,e,t)},r.prototype.uploadDenseMatrixToTexture=function(e,t,n,a){this.throwIfDisposed(),EF(this.gl,e,t,n,a,this.textureConfig)},r.prototype.createFloat16PackedMatrixTexture=function(e,t){return this.throwIfDisposed(),kF(this.gl,e,t,this.textureConfig)},r.prototype.createPackedMatrixTexture=function(e,t){return this.throwIfDisposed(),xF(this.gl,e,t,this.textureConfig)},r.prototype.deleteMatrixTexture=function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(sb(this.gl,this.framebuffer),this.outputTexture=null),Oe(this.gl,function(){return t.gl.deleteTexture(e)})},r.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,n){var a=this;return this.downloadMatrixDriver(e,function(){return CF(a.gl,t,n,a.textureConfig)})},r.prototype.downloadPackedMatrixFromBuffer=function(e,t,n,a,i,o){return AF(this.gl,e,t,n,a,i,o,this.textureConfig)},r.prototype.downloadFloat32MatrixFromBuffer=function(e,t){return IF(this.gl,e,t)},r.prototype.createBufferFromTexture=function(e,t,n){this.bindTextureToFrameBuffer(e);var a=NF(this.gl,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),a},r.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},r.prototype.createFence=function(e){var t=this,n,a;if(k.env().getBool("WEBGL_FENCE_API_ENABLED")){var i=e,o=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),a=function(){var s=i.clientWaitSync(o,0,0);return s===i.ALREADY_SIGNALED||s===i.CONDITION_SATISFIED},n=o}else k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(n=this.beginQuery(),this.endQuery(),a=function(){return t.isQueryAvailable(n,k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):a=function(){return!0};return{query:n,isFencePassed:a}},r.prototype.downloadMatrixFromPackedTexture=function(e,t,n){var a=this;return this.downloadMatrixDriver(e,function(){return DF(a.gl,t,n)})},r.prototype.createProgram=function(e){var t=this;this.throwIfDisposed();var n=this.gl;this.vertexShader==null&&(this.vertexShader=vF(n));var a=U3(n);Oe(n,function(){return n.attachShader(a,t.vertexShader)}),Oe(n,function(){return n.attachShader(a,e)}),H3(n,a);var i=Object.assign(a,{vao:this.createVertexArray()});return this.debug&&Zp(n,i),i},r.prototype.buildVao=function(e){var t=this;this.setProgram(e),this.bindVertexArray(e.vao);var n=this.gl;Oe(n,function(){return n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t.indexBuffer)}),SF(n,e,this.vertexBuffer)},r.prototype.deleteProgram=function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&(Oe(this.gl,function(){return t.gl.deleteProgram(e)}),this.deleteVertexArray(e.vao))},r.prototype.setProgram=function(e){var t=this;this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&Zp(this.gl,this.program),Oe(this.gl,function(){return t.gl.useProgram(e)})},r.prototype.getUniformLocation=function(e,t,n){return n===void 0&&(n=!0),this.throwIfDisposed(),n?J3(this.gl,e,t):Q3(this.gl,e,t)},r.prototype.getAttributeLocation=function(e,t){var n=this;return this.throwIfDisposed(),Oe(this.gl,function(){return n.gl.getAttribLocation(e,t)})},r.prototype.getUniformLocationNoThrow=function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)},r.prototype.setInputMatrixTexture=function(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),eF(this.gl,e,t,n)},r.prototype.setOutputMatrixTexture=function(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)},r.prototype.setOutputPackedMatrixTexture=function(e,t,n){this.throwIfDisposed();var a=Ee(qu(t,n),2),i=a[0],o=a[1];this.setOutputMatrixTextureDriver(e,i,o)},r.prototype.setOutputMatrixWriteRegion=function(e,t,n,a){this.setOutputMatrixWriteRegionDriver(n,e,a,t)},r.prototype.setOutputPackedMatrixWriteRegion=function(e,t,n,a){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},r.prototype.debugValidate=function(){this.program!=null&&Zp(this.gl,this.program),Vl(this.gl)},r.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;if(this.debug){var t=this.getVertexArray();console.assert(t===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}Oe(e,function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)})},r.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),Oe(this.gl,function(){return e.gl.finish()})},r.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=Gl(this.gl,k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},r.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},r.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},r.prototype.beginQuery=function(){if(k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}var a=this.getQueryTimerExtensionWebGL1(),i=a.createQueryEXT();return a.beginQueryEXT(a.TIME_ELAPSED_EXT,i),i},r.prototype.endQuery=function(){if(k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var e=this.gl,t=this.getQueryTimerExtensionWebGL2();e.endQuery(t.TIME_ELAPSED_EXT);return}var n=this.getQueryTimerExtensionWebGL1();n.endQueryEXT(n.TIME_ELAPSED_EXT)},r.prototype.waitForQueryAndGetTime=function(e){return Uu(this,void 0,void 0,function(){var t=this;return Hu(this,function(n){switch(n.label){case 0:return[4,k.util.repeatedTry(function(){return t.disposed||t.isQueryAvailable(e,k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return n.sent(),[2,this.getQueryTime(e,k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},r.prototype.getQueryTime=function(e,t){if(t===0)return null;if(t===2){var n=this.gl,a=n.getQueryParameter(e,n.QUERY_RESULT);return a/1e6}else{var i=this.getQueryTimerExtensionWebGL1(),a=i.getQueryObjectEXT(e,i.QUERY_RESULT_EXT);return a/1e6}},r.prototype.isQueryAvailable=function(e,t){if(t===0)return!0;if(t===2){var n=this.gl,a=this.getQueryTimerExtensionWebGL2(),i=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(a.GPU_DISJOINT_EXT)),i&&!this.disjoint}else{var a=this.getQueryTimerExtensionWebGL1(),i=a.getQueryObjectEXT(e,a.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(a.GPU_DISJOINT_EXT)),i&&!this.disjoint}},r.prototype.pollFence=function(e){var t=this;return new Promise(function(n){t.addItemToPoll(function(){return e.isFencePassed()},function(){return n()})})},r.prototype.pollItems=function(){for(var e=pxe(this.itemsToPoll.map(function(a){return a.isDoneFn})),t=0;t<=e;++t){var n=this.itemsToPoll[t].resolveFn;n()}this.itemsToPoll=this.itemsToPoll.slice(e+1)},r.prototype.addItemToPoll=function(e,t){var n=this;if(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),!(this.itemsToPoll.length>1)){var a=void 0;"setTimeoutCustom"in k.env().platform&&(a=k.env().platform.setTimeoutCustom.bind(k.env().platform)),k.util.repeatedTry(function(){return n.pollItems(),n.itemsToPoll.length===0},function(){return 0},null,a)}},r.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),Jp(this.gl,e,this.framebuffer),this.debug&&Vl(this.gl)},r.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(Jp(this.gl,this.outputTexture,this.framebuffer),this.debug&&Vl(this.gl)):sb(this.gl,this.framebuffer)},r.prototype.downloadMatrixDriver=function(e,t){this.bindTextureToFrameBuffer(e);var n=t();return this.unbindTextureToFrameBuffer(),n},r.prototype.setOutputMatrixTextureDriver=function(e,t,n){this.throwIfDisposed();var a=this.gl;Jp(a,e,this.framebuffer),this.debug&&Vl(a),this.outputTexture=e,Oe(a,function(){return a.viewport(0,0,t,n)}),Oe(a,function(){return a.scissor(0,0,t,n)})},r.prototype.setOutputMatrixWriteRegionDriver=function(e,t,n,a){var i=this;this.throwIfDisposed(),Oe(this.gl,function(){return i.gl.scissor(e,t,n,a)})},r.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},r.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},r})();function pxe(r){for(var e=0;e<r.length;++e){var t=r[e]();if(!t)break}return e-1}function dxe(r){for(var e=new Float32Array(r.length),t=0;t<r.length;++t)e[t]=Math.abs(r[t]);return e}function oa(r){return function(e,t,n,a,i){var o=k.backend_util.assertAndGetBroadcastShape(e,t),s=o.length,u=k.util.computeStrides(o),c=k.util.sizeFromShape(o),l=k.util.getTypedArrayFromDType(i,c),f=e.length,h=t.length,p=k.util.computeStrides(e),d=k.util.computeStrides(t),m=k.backend_util.getBroadcastDims(e,o),v=k.backend_util.getBroadcastDims(t,o);if(m.length+v.length===0)for(var g=0;g<l.length;++g)l[g]=r(n[g%n.length],a[g%a.length]);else for(var y=function(w){var b=k.util.indexToLoc(w,s,u),x=b.slice(-f);m.forEach(function(C){return x[C]=0});var S=k.util.locToIndex(x,f,p),T=b.slice(-h);v.forEach(function(C){return T[C]=0});var N=k.util.locToIndex(T,h,d);l[w]=r(n[S],a[N])},g=0;g<l.length;++g)y(g);return[l,o]}}function vxe(r,e,t,n){if(n==="int32"){var a=Int32Array.from(r);return[e,"int32",a]}if(n==="bool"){var i=k.util.toTypedArray([0],t),o=Ee(oa(function(c,l){return c!==l?1:0})(e,[],r,i,"bool"),2),s=o[0],u=o[1];return[u,"bool",s]}throw new Error("Error in Cast: failed to cast ".concat(t," to ").concat(n))}var mxe=oa((function(r,e){return r+e}));function gxe(r,e,t,n,a){for(var i=k.util.sizeFromShape(n),o=k.util.makeZerosTypedArray(a,t),s=0;s<r.length;s++){var u=r[s];if(u<0)throw new Error("Input x must be non-negative!");u>=a||(i>0?o[u]+=e[s]:o[u]+=1)}return o}function yxe(r,e,t,n){n===void 0&&(n=!1);for(var a=r.shape[0],i=r.shape[1],o=k.buffer([a,t],e.dtype),s=0;s<a;s++)for(var u=0;u<i;u++){var c=r.get(s,u);if(c<0)throw new Error("Input x must be non-negative!");c>=t||(n?o.set(1,s,c):e.size>0?o.set(o.get(s,c)+e.get(s,u),s,c):o.set(o.get(s,c)+1,s,c))}return o}var bxe=oa((function(r,e){return r&e}));function $i(r){return function(e,t,n){for(var a=k.util.getArrayFromDType(t,e.length),i=0;i<e.length;++i)a[i]=r(e[i],n);return a}}var wxe=$i(function(r){return Math.ceil(r)});function xxe(r,e,t,n){var a=k.util.getArrayFromDType(t,k.util.sizeFromShape(e));if(n&&t!=="string"){var i=0;r.forEach(function(s){var u=k.util.sizeFromShape(s.shape);a.set(s.vals,i),i+=u})}else{var o=0;r.forEach(function(s){for(var u=t==="string"?k.backend_util.fromUint8ToStringArray(s.vals):s.vals,c=0,l=0;l<s.shape[0];++l)for(var f=l*e[1]+o,h=0;h<s.shape[1];++h)a[f+h]=u[c++];o+=s.shape[1]})}return a}var kxe=oa(function(r,e){return r===e?1:0});var Sxe=$i(function(r){return Math.exp(r)});var Exe=$i(function(r){return Math.expm1(r)});var Txe=$i(function(r){return Math.floor(r)});function Nxe(r,e,t,n,a,i,o,s,u){for(var c=k.buffer([n,i],t),l=0;l<n;l++){for(var f=[],h=0,p=0;p<a;p++){var d=r[l*a+p];h+=d*o[p],f.push(d)}if(h<0||h>=u/i)throw new Error("Invalid indices: ".concat(f," does not index into ").concat(s));for(var m=0;m<i;m++)c.values[l*i+m]=e.get.apply(e,ir([],Ee(e.indexToLoc(h*i+m)),!1))}return c}function Ixe(r,e,t){for(var n=k.buffer(t,r.dtype),a=0;a<n.size;++a){var i=n.indexToLoc(a),o=i.slice(),s=o[0],u=o[2],c=e.locToIndex([s,u]);o[2]=e.values[c];var l=r.locToIndex(o);0<=l&&l<r.values.length&&(n.values[a]=r.values[l])}return n}var Cxe=oa(function(r,e){return r>e?1:0});var Axe=oa(function(r,e){return r>=e?1:0});var Dxe=oa(function(r,e){return r<e?1:0});var _xe=oa(function(r,e){return r<=e?1:0});function Fxe(r,e,t){var n=(e-r)/(t-1),a=k.util.makeZerosTypedArray(t,"float32");a[0]=r;for(var i=1;i<a.length;i++)a[i]=a[i-1]+n;return a}var Rxe=$i(function(r){return Math.log(r)});function Oxe(r,e,t,n){for(var a=k.util.getTypedArrayFromDType(n,k.util.sizeFromShape(t)),i=0;i<a.length;++i){for(var o=i*e,s=r[o],u=0;u<e;++u){var c=r[o+u];(Number.isNaN(c)||c>s)&&(s=c)}a[i]=s}return a}var Pxe=oa((function(r,e){return Math.max(r,e)}));var Mxe=oa((function(r,e){return Math.min(r,e)}));var _F=oa((function(r,e){return r*e}));function Bxe(r,e,t){var n=k.util.createScalarValue(-1,t);return _F([],e,n,r,t)}var Lxe=oa((function(r,e){return r!==e?1:0}));function zxe(r,e,t,n,a){for(var i=e.length,o=k.util.sizeFromShape(e),s=k.util.computeStrides(e),u=k.util.computeStrides(a),c=k.util.getTypedArrayFromDType(t,k.util.sizeFromShape(a)),l=0;l<o;++l){for(var f=k.util.indexToLoc(l,i,s),h=new Array(f.length),p=0;p<h.length;p++)h[p]=f[n[p]];var d=k.util.locToIndex(h,i,u);c[d]=r[l]}return c}function $xe(r,e,t,n){for(var a=Ee(k.backend_util.computeOutAndReduceShapes(r,n),2),i=a[0],o=a[1],s=k.upcastType(e,"int32"),u=k.util.makeZerosTypedArray(k.util.sizeFromShape(i),s),c=k.util.sizeFromShape(o),l=0;l<u.length;++l){for(var f=l*c,h=1,p=0;p<c;++p)h*=t[f+p];u[l]=h}return{outVals:u,outShape:i,outDtype:s}}function Wxe(r,e,t){r.forEach(function(n,a){if(n<0||n>=t){var i=k.util.indexToLoc(a,e.length,k.util.computeStrides(e)).join(",");throw new Error("indices[".concat(i,"] = ").concat(n," is not in [0, ").concat(t,")"))}})}function Gxe(r,e){for(var t=0;t<r.length;++t){var n=r[t],a=t===r.length-1?e:r[t+1].length;if(n.length===0)throw new Error("Ragged splits may not be empty");if(n[0]<0)throw new Error("Ragged splits must be non-negative");if(n[n.length-1]>a)throw new Error("Ragged splits must not point past values");for(var i=1;i<n.length;++i)if(n[i-1]>n[i])throw new Error("Ragged splits must be sorted in ascending order")}}function Vxe(r,e,t,n){var a=[],i=0,o=e.length-1+t.length,s=new Array(o).fill(null).map(function(){return[0]});Gxe(t,n);for(var u=1,c=0;c<e.length-1;++c){u*=e[c];for(var l=e[c+1],f=1;f<u+1;++f)s[c].push(f*l)}for(var f=0;f<r.length;++f){for(var h=r[f],p=r[f]+1,c=0;c<t.length;++c){var d=t[c],m=c+e.length-1;if(m>=0)for(var v=s[m],g=v[v.length-1]-d[h],y=h;y<p;++y)s[m].push(d[y+1]+g);h=d[h],p=d[p]}p!==h&&(a.push([h,p]),i+=p-h)}return{outSplits:s,valueSlices:a,numValues:i}}function Uxe(r){for(var e=[],t=function(a){var i=r[a].length,o=k.util.getArrayFromDType("int32",i);e.push(o),r[a].forEach(function(s,u){return o[u]=s})},n=0;n<r.length;++n)t(n);return e}function f3(r,e){for(var t=r.slice(0,e);t.length<e;)t.push(1);for(var n=e;n<r.length;n++)t[e-1]*=r[n];return t}function Hxe(r,e,t,n,a,i){var o,s,u=f3(e,2)[1],c=f3(i,2)[1],l=0;try{for(var f=ln(t),h=f.next();!h.done;h=f.next())for(var p=h.value,d=p[0];d<p[1];++d){for(var m=0;m<n;++m)a[l*c+m]=r[d*u+m];++l}}catch(v){o={error:v}}finally{try{h&&!h.done&&(s=f.return)&&s.call(f)}finally{if(o)throw o.error}}}function qxe(r,e,t,n,a){var i=e.slice();i[0]=a;var o=k.util.getArrayFromDType(t,k.util.sizeFromShape(i)),s=r.length,u=s===0?0:s/e[0];return Hxe(r,e,n,u,o,i),[o,i]}function Kxe(r,e,t,n,a,i,o,s){if(r.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");var u=e[0][0]-1;if(Wxe(i,o,u),n.length===0)throw new Error("params.rank must be nonzero");var c=n[0],l=Vxe(i,o,r,c),f=l.outSplits,h=l.valueSlices,p=l.numValues,d=Uxe(f),m=qxe(t,n,a,h,p);return[d,m[0],m[1]]}var h3=2147483647;function jxe(r,e,t,n,a,i,o){if(e.length>1)throw new Error("starts must be a scalar or vector");if(a.length>1)throw new Error("limits must be a scalar or vector");if(o.length>1)throw new Error("deltas must be a scalar or vector");var s=e.length===0,u=a.length===0,c=o.length===0,l=[];s||l.push(e[0]),u||l.push(a[0]),c||l.push(o[0]);for(var f=1;f<l.length;++f)if(l[f]!==l[f-1])throw new Error("starts, limits, and deltas must have the same shape");var h=l.length===0?1:l[0],p=k.util.getArrayFromDType("int32",h+1);p[0]=0;for(var d=0;d<h;++d){var m=s?r[0]:r[d],v=u?n[0]:n[d],g=c?i[0]:i[d];if(g===0)throw new Error("Requires delta != 0");var y=void 0;if(g>0&&v<m||g<0&&v>m)y=0;else if(y=Math.ceil(Math.abs((v-m)/g)),y>h3)throw new Error("Requires ((limit - start) / delta) <= ".concat(h3));p[d+1]=p[d]+y}for(var w=p[h],b=k.util.getArrayFromDType(t,w),x=0,d=0;d<h;++d)for(var S=p[d+1]-p[d],T=s?r[0]:r[d],g=c?i[0]:i[d],f=0;f<S;++f)b[x++]=T,T+=g;return[p,b]}var Ra=k.backend_util.RowPartitionType,Xxe=(function(){function r(e,t,n,a,i,o,s,u,c,l){this.shape=e,this.shapeShape=t,this.values=n,this.valuesShape=a,this.valuesDType=i,this.defaultValue=o,this.defaultValueShape=s,this.rowPartitionValues=u,this.rowPartitionValuesShapes=c,this.rowPartitionTypes=k.backend_util.getRowPartitionTypesHelper(l),this.raggedRank=k.backend_util.getRaggedRank(this.rowPartitionTypes)}return r.prototype.getRowPartitionTypeByDimension=function(e){return this.rowPartitionTypes[0]===Ra.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]},r.prototype.getRowPartitionTensor=function(e){return this.rowPartitionTypes[0]===Ra.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]},r.prototype.getMaxWidth=function(e){var t=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case Ra.VALUE_ROWIDS:return r.getMaxWidthValueRowID(t);case Ra.ROW_SPLITS:return r.getMaxWidthRowSplit(t);default:throw new Error("Cannot handle partition type ".concat(Ra[this.getRowPartitionTypeByDimension(e-1)]))}},r.getMaxWidthRowSplit=function(e){var t=e.length;if(t===0||t===1)return 0;for(var n=0,a=0;a<t-1;++a){var i=e[a+1]-e[a];i>n&&(n=i)}return n},r.getMaxWidthValueRowID=function(e){var t=e.length;if(t===0)return 0;for(var n=0,a=e[0],i=0,o=1;o<t;++o){var s=e[o];s!==a&&(a=s,i=Math.max(o-n,i),n=o)}return Math.max(t-n,i)},r.prototype.tensorShapeFromTensor=function(e,t,n){if(n===void 0&&(n=!0),t.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return d3(e,n)},r.prototype.calculateOutputSize=function(e){var t=this.valuesShape,n=this.defaultValueShape;k.backend_util.validateDefaultValueShape(n,t);var a=this.tensorShapeFromTensor(this.shape,this.shapeShape),i=k.backend_util.combineRaggedTensorToTensorShapes(this.raggedRank,a,t),o=i;o[0]<0&&(o[0]=e);for(var s=1;s<=this.raggedRank;++s)o[s]<0&&(o[s]=this.getMaxWidth(s));return o},r.prototype.calculateFirstParentOutputIndex=function(e,t,n){for(var a=Math.min(e,n),i=[],o=0,s=0;s<a;++s,o+=t)i.push(o);for(var s=a;s<e;++s)i.push(-1);return k.util.assert(i.length===e,function(){return"Final length of result must be equal to firstDimension."}),i},r.prototype.calculateOutputIndexRowSplit=function(e,t,n,a){for(var i=e.length,o=[],s=0;s<i-1;++s){var u=e[s+1]-e[s],c=Math.min(a,u),l=t[s];l===-1&&(c=0);for(var f=0;f<c;++f)o.push(l),l+=n;for(var f=0;f<u-c;++f)o.push(-1)}if(i>0&&o.length!==e[i-1])throw new Error("Invalid row split size.");return o},r.prototype.calculateOutputIndexValueRowID=function(e,t,n,a){var i=e.length,o=[];if(i===0)return[];var s=0,u=e[0];if(u>=t.length)throw new Error("Got currentValueRowId=".concat(u,", which is not less than ").concat(t.length));var c=t[u];o.push(c);for(var l=1;l<i;++l){var f=e[l];if(f===u)c>=0&&(++s,s<a?c+=n:c=-1);else{if(s=0,u=f,f>=t.length)throw new Error("Got nextValueRowId=".concat(f," which is not less than ").concat(t.length));c=t[f]}o.push(c)}if(o.length!==e.length)throw new Error("Invalid row ids.");return o},r.prototype.calculateOutputIndex=function(e,t,n,a){var i=this.getRowPartitionTensor(e),o=this.getRowPartitionTypeByDimension(e);switch(o){case Ra.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(i,t,n,a);case Ra.ROW_SPLITS:if(i.length-1>t.length)throw new Error("Row partition size is greater than output size: ".concat(i.length-1," > ").concat(t.length));return this.calculateOutputIndexRowSplit(i,t,n,a);default:throw new Error("Unsupported partition type: ".concat(Ra[o]))}},r.prototype.getFirstDimensionSize=function(){var e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");var t=this.rowPartitionTypes[0];switch(t){case Ra.FIRST_DIM_SIZE:return e[0];case Ra.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case Ra.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error("Cannot handle type ".concat(Ra[t]))}},r.prototype.compute=function(){var e=this.rowPartitionValues[0];if(e.length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");var t=this.getFirstDimensionSize(),n=this.calculateOutputSize(t),a=new Array(this.raggedRank+1);a[a.length-1]=1;for(var i=a.length-2;i>=0;--i)a[i]=a[i+1]*n[i+1];var o=d3(n,!1),s=k.util.getArrayFromDType(this.valuesDType,k.util.sizeFromShape(o)),u=a[0]*n[0];if(u>0){for(var c=this.calculateFirstParentOutputIndex(t,a[0],n[0]),i=1;i<=this.raggedRank;++i){var l=this.calculateOutputIndex(i-1,c,a[i],n[i]);c=l}this.setOutput(this.raggedRank,c,s,o)}return[o,s]},r.prototype.setOutput=function(e,t,n,a){if(n.length!==0){var i=this.values,o=n,s=a.slice();s=s.slice(e+1);var u=k.util.sizeFromShape(s),c=t.length,l=this.defaultValue;if(l.length!==u&&l.length!==1){var f=this.defaultValueShape;k.tidy(function(){var x=k.reshape(l,f),S=k.broadcastTo(x,s);l=S.dataSync()})}for(var h=0,p=0,d=0,m=0;m<=c;++m){var v=m<c?t[m]:-1;if(v===d){++d;continue}if(p<d){var g=i.subarray(h*u),y=o.subarray(p*u),w=(d-p)*u;p3(y,g,w)}if(m>=c){var b=n.length;v=Math.floor(b/u)}if(v>d)if(this.defaultValue.length===1)o.subarray(d*u,v*u).fill(this.defaultValue[0]),d=v;else for(;v>d;){var y=o.slice(d*u);p3(y,l,u),++d}v<0?(h=m+1,p=d):(h=m,p=d,d=p+1)}}},r})();function p3(r,e,t){for(var n=0;n<t;n++)r[n]=e[n]}function d3(r,e){var t,n,a=[];try{for(var i=ln(r),o=i.next();!o.done;o=i.next()){var s=o.value;if(s<0){if(!e)throw new Error("Dimension ".concat(s," must be >= 0"));if(s<-1)throw new Error("Dimension ".concat(s," must be >= -1"));s=-1}a.push(s)}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return a}function Yxe(r,e,t,n,a,i,o,s,u,c){return new Xxe(r,e,t,n,a,i,o,s,u,c).compute()}function Zxe(r,e,t,n){var a=r===e,i=r<e&&t<0,o=e<r&&t>1;if(a||i||o)return k.util.makeZerosTypedArray(0,n);var s=Math.abs(Math.ceil((e-r)/t)),u=k.util.makeZerosTypedArray(s,n);e<r&&t===1&&(t=-1),u[0]=r;for(var c=1;c<u.length;c++)u[c]=u[c-1]+t;return u}var Jxe=$i(function(r){return 1/Math.sqrt(r)});function Qxe(r,e,t,n,a,i,o,s,u,c){var l=[n/a,a],f=r.values,h=e.values;if(n===0)return k.buffer(t,e.dtype);var p=u instanceof k.TensorBuffer?u:k.buffer(l,e.dtype);typeof u=="string"||typeof u=="number"?p.values.fill(u):typeof u=="boolean"&&p.values.fill(+u);for(var d=0;d<i;d++){for(var m=[],v=0,g=0;g<o;g++){var y=f[d*o+g];m.push(y),v+=y*s[g]}if(v<0||v>=n/a)throw new Error("Invalid indices: ".concat(m," does not index into ").concat(t));for(var w=0;w<a;w++)c?p.values[v*a+w]+=h[d*a+w]:p.values[v*a+w]=e.rank===0?h[0]:h[d*a+w]}return p}var eke=$i(function(r){return 1/(1+Math.exp(-r))});function tke(r,e,t,n,a){var i=k.slice_util.isSliceContinous(n,e,t),o=k.util.sizeFromShape(t),s=k.util.computeStrides(n);if(i){var u=k.slice_util.computeFlatOffset(e,s);return a==="string"?r.slice(u,u+o):r.subarray(u,u+o)}for(var c=a==="string"?k.backend_util.fromUint8ToStringArray(r):r,l=k.buffer(n,a,c),f=k.buffer(t,a),h=0;h<f.size;++h){var p=f.indexToLoc(h),d=p.map(function(m,v){return m+e[v]});f.set.apply(f,ir([l.get.apply(l,ir([],Ee(d),!1))],Ee(p),!1))}return a==="string"?k.backend_util.fromStringArrayToUint8(f.values):f.values}function rke(r,e,t,n,a,i,o){var s=e[0],u=i[0],c=new Array(u),l=new Array(s),f=e[1];if(u===0){if(s!==0)throw new Error(k.backend_util.getSparseFillEmptyRowsIndicesDenseShapeMismatch(s));var h=k.util.getArrayFromDType(t,0),p=k.util.getArrayFromDType(a,0);return[h,[0,f],p,c,l]}for(var d=!0,m=0,v=new Array(u).fill(0),g=0;g<s;++g){var y=r[g*f];if(y<0)throw new Error(k.backend_util.getSparseFillEmptyRowsNegativeIndexErrorMessage(g,y));if(y>=u)throw new Error(k.backend_util.getSparseFillEmptyRowsOutOfRangeIndexErrorMessage(g,y,u));++v[y],d=d&&y>=m,m=y}for(var w=!0,y=0;y<u;++y){var b=v[y]===0;c[y]=b,w=w&&!b,v[y]=Math.max(v[y],1),y>0&&(v[y]+=v[y-1])}if(w&&d){for(var h=r,p=n,g=0;g<s;++g)l[g]=g;return[h,[s,f],p,c,l]}else{for(var x=v[u-1],h=k.util.getArrayFromDType(t,x*f),p=k.util.getArrayFromDType(a,x),S=new Array(u).fill(0),g=0;g<s;++g){var y=r[g*f],T=S[y],N=(y===0?0:v[y-1])+T;S[y]++;for(var C=0;C<f;++C)h[N*f+C]=r[g*f+C];p[N]=n[g],l[g]=N}for(var y=0;y<u;++y){var R=S[y];if(R===0){var _=y===0?0:v[y-1];h[_*f+0]=y;for(var P=1;P<f;++P)h[_*f+P]=0;p[_]=o}}return[h,[x,f],p,c,l]}}function nke(r,e,t,n,a){for(var i=k.util.sizeFromShape(n),o=e[0],s=a.length,u=[],c=1,l=-1,f=0;f<s;++f){var h=a[f];if(h===-1){if(l!==-1)throw new Error(k.backend_util.getSparseReshapeMultipleNegativeOneOutputDimErrorMessage(l,f));l=f,u.push(1)}else{if(h<0)throw new Error(k.backend_util.getSparseReshapeNegativeOutputDimErrorMessage(f,h));c*=h,u.push(h)}}if(l!==-1){if(c<=0)throw new Error(k.backend_util.getSparseReshapeEmptyTensorZeroOutputDimErrorMessage());var p=Math.trunc(i/c);if(c*p!==i)throw new Error(k.backend_util.getSparseReshapeInputOutputMultipleErrorMessage(n,u));u[l]=p}var d=k.util.sizeFromShape(u);if(d!==i)throw new Error(k.backend_util.getSparseReshapeInputOutputMismatchErrorMessage(n,u));var m=n.length,v=[];if(m>0){v[m-1]=1;for(var f=m-2;f>=0;--f)v[f]=v[f+1]*n[f+1]}var g=[];if(s>0){g[s-1]=1;for(var f=s-2;f>=0;--f)g[f]=g[f+1]*u[f+1]}for(var y=k.util.getArrayFromDType(t,o*s),w=0;w<o;++w){for(var b=0,x=0;x<m;++x)b+=r[w*m+x]*v[x];for(var x=0;x<s;++x)y[w*s+x]=Math.trunc(b/g[x]),b%=g[x]}return[y,[o,s],u]}function ake(r,e,t,n,a,i,o){i===void 0&&(i=!1),o===void 0&&(o=0);var s=n.length,u=[e[0],r.length/e[0]],c=u[1],l=s>0?a[s-1]+1:0,f=l;if(f<0)throw new Error(k.backend_util.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());var h=e.slice();h[0]=f;var p=h.reduce(function(T,N){return T*N},1),d=k.util.getArrayFromDType(t,p);if(s===0)return f>0&&d.fill(o),[d,h];if(f<=0)throw new Error(k.backend_util.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());for(var m=0,v=1,g=0,y=a[m];;){var w=0;if(v<s){if(w=a[v],y===w){++v;continue}if(y>=w)throw new Error(k.backend_util.getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage())}if(y<0||y>=f)throw new Error(k.backend_util.getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage(y,f));y>g&&d.fill(o,g*c,y*c);for(var b=m;b<v;++b){var x=n[b];if(x<0||x>=u[0])throw new Error(k.backend_util.getSparseSegmentReductionIndicesOutOfRangeErrorMessage(b,n[b],u[0]));for(var S=0;S<c;S++)d[y*c+S]+=r[x*c+S]}if(i)for(var S=0;S<c;S++)d[y*c+S]/=v-m;if(m=v,++v,g=y+1,y=w,v>s)break}return g<f&&d.fill(o,g*c,f*c),[d,h]}var ike=$i(function(r){return Math.sqrt(r)});var oke=$i(function(r,e){var t=e.pattern,n=e.replaceGlobal,a=e.rewrite;return r.replace(new RegExp(t,n?"g":""),a)});function ske(r,e,t,n){for(var a=k.buffer(r,e.dtype),i=0;i<a.size;i++){for(var o=a.indexToLoc(i),s=new Array(o.length),u=0;u<s.length;u++)s[u]=o[u]*t[u]+n[u];a.set.apply(a,ir([e.get.apply(e,ir([],Ee(s),!1))],Ee(o),!1))}return a}var uke=(function(){function r(e,t,n,a,i,o){this.separator=k.util.encodeString(e),this.nGramWidths=t,this.leftPad=k.util.encodeString(n),this.rightPad=k.util.encodeString(a),this.padWidth=i,this.preserveShort=o}return r.prototype.getPadWidth=function(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)},r.prototype.getNumNGrams=function(e,t){var n=this.getPadWidth(t);return Math.max(0,e+2*n-t+1)},r.prototype.createNGrams=function(e,t,n,a,i,o){for(var s=function(l){var f=u.getPadWidth(o),h=Math.max(0,f-l),p=Math.max(0,f-(i-(l+1))),d=o-(h+p),m=t+(h>0?0:l-f),v=0;v+=h*u.leftPad.length;for(var g=0;g<d;++g)v+=e[m+g].length;v+=p*u.rightPad.length;var y=h+p+d-1;v+=y*u.separator.length,n[a+l]=new Uint8Array(v);for(var w=n[a+l],b=0,x=function(S){return S.forEach(function(T){return w[b++]=T})},g=0;g<h;++g)x(u.leftPad),x(u.separator);for(var g=0;g<d-1;++g)x(e[m+g]),x(u.separator);if(d>0){x(e[m+d-1]);for(var g=0;g<p;++g)x(u.separator),x(u.rightPad)}else{for(var g=0;g<p-1;++g)x(u.rightPad),x(u.separator);x(u.rightPad)}},u=this,c=0;c<i;++c)s(c)},r.prototype.compute=function(e,t){var n=this,a=e.length,i=t.length;if(i>0){var o=t[0];if(o!==0)throw new Error("First split value must be 0, got ".concat(o));for(var s=1;s<i;++s){var u=t[s]>=o;if(u=u&&t[s]<=a,!u)throw new Error("Invalid split value ".concat(t[s],", must be in [").concat(o,", ").concat(a,"]"));o=t[s]}if(o!==a)throw new Error("Last split value must be data size. Expected ".concat(a,", got ").concat(o))}var c=i-1,l=k.util.getArrayFromDType("int32",i);if(a===0||i===0){for(var f=new Array(a),s=0;s<=c;++s)l[s]=0;return[f,l]}l[0]=0;for(var h=function(g){var y=t[g]-t[g-1],w=0;p.nGramWidths.forEach(function(b){w+=n.getNumNGrams(y,b)}),p.preserveShort&&y>0&&w===0&&(w=1),l[g]=l[g-1]+w},p=this,s=1;s<=c;++s)h(s);for(var d=new Array(l[c]),m=function(g){var y=t[g],w=l[g];if(v.nGramWidths.forEach(function(T){var N=t[g+1]-t[g],C=n.getNumNGrams(N,T);n.createNGrams(e,y,d,w,C,T),w+=C}),v.preserveShort&&w===l[g]){var b=t[g+1]-t[g];if(b===0)return"continue";var x=b+2*v.padWidth,S=1;v.createNGrams(e,y,d,w,S,x)}},v=this,s=0;s<c;++s)m(s);return[d,l]},r})();function cke(r,e,t,n,a,i,o,s){return new uke(t,n,a,i,o,s).compute(r,e)}function lke(r,e,t,n){if(r.length){if(e.length===0){for(var a=0;a<r.length;++a)n.push(r.subarray(a,a+1));return}if(e.length===1){for(var i=e[0],o=r.indexOf(i);o!==-1;){var s=r.subarray(0,o);(!t||s.length!==0)&&n.push(s),r=r.subarray(o+1),o=r.indexOf(i)}(!t||r.length!==0)&&n.push(r);return}for(var u=0,a=0;a<r.length+1;a++)if(a===r.length||e.indexOf(r[a])!==-1){var s=r.subarray(u,a);(!t||s.length!==0)&&n.push(s),u=a+1}}}function fke(r,e,t){for(var n=r.length,a=[],i=0,o=0,s=new Array(n),u=0;u<n;++u){var c=a.length;lke(r[u],e,t,a);var l=a.length-c;s[u]=l,i+=l,o=Math.max(o,l)}for(var f=k.util.getArrayFromDType("int32",i*2),h=new Array(i),p=[n,o],d=0,u=0;u<n;++u)for(var m=0;m<s[u];++m)f[d*2]=u,f[d*2+1]=m,h[d]=a[d],++d;return[f,h,p]}function hke(r,e){for(var t=k.util.getArrayFromDType("int32",r.length),n=0;n<r.length;++n)t[n]=k.util.fingerPrint64(r[n]).modulo(e).getLowBitsUnsigned();return t}var pke=oa((function(r,e){return r-e}));function dke(r,e){for(var t=new Array(r.rank),n=0;n<t.length;n++)t[n]=r.shape[n]*e[n];for(var a=k.buffer(t,r.dtype),n=0;n<a.values.length;++n){for(var i=a.indexToLoc(n),o=new Array(r.rank),s=0;s<o.length;s++)o[s]=i[s]%r.shape[s];var u=r.locToIndex(o);a.values[n]=r.values[u]}return a}var Hl=function(r,e){var t=e.value-r.value;return t===0?r.index-e.index:t};function FF(r,e,t,n){for(t===void 0&&(t=0),n===void 0&&(n=r.length-1);n>t;){if(n-t>600){var a=n-t+1,i=e-t+1,o=Math.log(a),s=.5*Math.exp(2*o/3),u=.5*Math.sqrt(o*s*(a-s)/a)*Math.sign(i-a/2),c=Math.max(t,Math.floor(e-i*s/a+u)),l=Math.min(n,Math.floor(e+(a-i)*s/a+u));FF(r,e,c,l)}var f=r[e],h=t,p=n;for(k.util.swap(r,t,e),Hl(r[n],f)>0&&k.util.swap(r,t,n);h<p;){for(k.util.swap(r,h,p),h++,p--;Hl(r[h],f)<0;)h=h+1;for(;Hl(r[p],f)>0;)p=p-1}Hl(r[t],f)===0?k.util.swap(r,t,p):(p=p+1,k.util.swap(r,p,n)),p<=e&&(t=p+1),e<=p&&(n=p-1)}}function vke(r,e,t,n,a){for(var i=e[e.length-1],o=Ee([r.length/i,i],2),s=o[0],u=o[1],c=k.util.getTypedArrayFromDType(t,s*n),l=k.util.getTypedArrayFromDType("int32",s*n),f=function(d){var m=d*u,v=r.subarray(m,m+u),g=new Array(v.length);v.forEach(function(S,T){return g[T]={value:S,index:T}}),n<g.length&&(FF(g,n),g=g.slice(0,n)),a&&g.sort(Hl);for(var y=d*n,w=c.subarray(y,y+n),b=l.subarray(y,y+n),x=0;x<n;x++)w[x]=g[x].value,b[x]=g[x].index},h=0;h<s;h++)f(h);var p=e.slice();return p[p.length-1]=n,[k.buffer(p,t,c),k.buffer(p,"int32",l)]}function mke(r,e,t,n){for(var a=k.util.parseAxisParam(e,t)[0],i=[1,t[0],1],o=0;o<a;o++)i[0]*=t[o];i[1]=t[a];for(var o=a+1;o<t.length;o++)i[2]*=t[o];for(var s=new Map,u=new Int32Array(t[a]),c=new k.TensorBuffer(i,n,r),l=[],f=i[0]===1&&i[2]===1,o=0;o<t[a];o++){var h=void 0;if(f)h=r[o].toString();else{for(var p=[],d=0;d<i[0];d++)for(var m=0;m<i[2];m++)p.push(c.get(d,o,m));h=p.join(",")}var v=s.get(h);if(v!=null)u[o]=v;else{var g=s.size;s.set(h,g),u[o]=g,l.push(o)}}var y=i.slice();y[1]=s.size;var w=new k.TensorBuffer(y,n);l.forEach(function(x,S){for(var T=0;T<i[0];T++)for(var N=0;N<i[2];N++)w.set(c.get(T,x,N),T,S,N)});var b=t.slice();return b[a]=y[1],{outputValues:w.values,outputShape:b,indices:u}}var gke=mxe,RF=gxe,yke=yxe,bke=bxe,wke=vxe,xke=wxe,kke=xxe,Ske=kxe,Eke=Sxe,Tke=Exe,Nke=Txe,Ike=Nxe,Cke=Ixe,Ake=Cxe,Dke=Axe,_ke=Dxe,Fke=_xe,Rke=Fxe,Oke=Rxe,Pke=Oxe,Mke=Pxe,Bke=Mxe,Lke=_F,zke=Bxe,$ke=Lxe,Wke=$xe,Gke=Kxe,Vke=jxe,Uke=Yxe,Hke=Zxe,qke=Jxe,Kke=Qxe,jke=eke,OF=dxe,Xke=tke,Yke=rke,Zke=nke,PF=ake,Jke=ike,Qke=oke,e2e=ske,t2e=cke,r2e=fke,n2e=hke,a2e=pke,i2e=dke,o2e=vke,Sb=zxe,s2e=mke;function MF(r,e){return["x","y","z","w","u","v"].slice(0,e).map(function(t){return"".concat(r,".").concat(t)})}function cn(r,e){return e===1?[r]:MF(r,e)}function u2e(r,e){if(r===1)return"rc";for(var t="",n=0;n<r;n++)t+=e[n],n<r-1&&(t+=",");return t}var c2e=(function(){function r(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=tn(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var t=cn("rc",this.rank),n=Ft(this.rank),a=this.getOutOfBoundsCondition(t),i=this.getSetup(t),o=this.getOutput(t);this.userCode=`
        void main() {
          `.concat(n,` rc = getOutputCoords();

          if(`).concat(a,`) {
            setOutput(vec4(0));
          } else {
            `).concat(i,`

            setOutput(vec4(`).concat(o,`));
          }
        }
      `)}}return r.prototype.getSourceCoordsArr=function(e){for(var t=[],n=0;n<=1;n++)for(var a=0;a<=1;a++){for(var i="".concat(n===0?"r":"rp1",", ").concat(a===0?"c":"cp1"),o=2;o<this.rank;o++)i="".concat(e[e.length-1-o],",")+i;t.push(i)}return t},r.prototype.getOutOfBoundsCondition=function(e){if(this.rank===1)return"rc > ".concat(this.enableShapeUniforms?"outShape":this.outputShape[0]);for(var t="",n=this.rank-2;n<this.rank;n++)t+="".concat(e[n]," >= ").concat(this.enableShapeUniforms?"outShape[".concat(n,"]"):this.outputShape[n]),n<this.rank-1&&(t+="||");return t},r.prototype.getSetup=function(e){if(this.rank===1)return"";var t=e.slice(-2),n=this.enableShapeUniforms?"outShape[".concat(this.rank," - 1]"):this.outputShape[this.rank-1],a=this.enableShapeUniforms?"outShape[".concat(this.rank," - 2]"):this.outputShape[this.rank-2];return`
      int r = `.concat(t[0],`;
      int c = `).concat(t[1],`;
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= `).concat(n,`;
      bool rEdge = rp1 >= `).concat(a,`;
    `)},r.prototype.getOutput=function(e){var t=this.getSourceCoordsArr(e);if(this.rank===1){var n=this.enableShapeUniforms?"outShape":this.outputShape[0];return"getA(rc), (rc + 1 >= ".concat(n," ? 0. : getA(rc + 1)), 0, 0")}return"getA(".concat(t[0],`),
            cEdge ? 0. : getA(`).concat(t[1],`),
            rEdge ? 0. : getA(`).concat(t[2],`),
            rEdge || cEdge ? 0. : getA(`).concat(t[3],")")},r})();var BF=(function(){function r(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=tn(this.outputShape.length);for(var n="",a=0;a<4;a++){var i="thisRC = rc;";a%2===1&&(i+="thisRC.z += 1;"),a>1&&(i+="thisRC.y += 1;"),n+=`
        `.concat(i,`
        `).concat(a>0?"if(thisRC.y < rows && thisRC.z < cols){":"",`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`).concat(a,`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `).concat(a>0?"}":"",`
      `)}this.userCode=`
      `.concat(l2e(t,this.enableShapeUniforms),`
      `).concat(this.enableShapeUniforms?mb():vb(e),`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `).concat(this.enableShapeUniforms?"outShape[1]":e[1],`;
        int cols = `).concat(this.enableShapeUniforms?"outShape[2]":e[2],`;

        `).concat(n,`

        setOutput(result);
      }
    `)}return r})();function l2e(r,e){var t=e?w1e(["r","c","d"],"inputShape"):Ps(["r","c","d"],r);return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `.concat(t,`
      return ivec3(r, c, d);
    }
  `)}var f2e=(function(){function r(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}return r.prototype.acquireTexture=function(e,t,n){var a=m3(t,n),i=g3(e,a,n);i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]);var o=v3(e,a,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();var s=this.freeTextures[i].pop();return this.usedTextures[i].push(s),s}var u;return a===Xr.PACKED_2X2_FLOAT32?u=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):a===Xr.PACKED_2X2_FLOAT16?u=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):a===Xr.UNPACKED_FLOAT32?u=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):a===Xr.UNPACKED_FLOAT16?u=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):a===Xr.PACKED_4X1_UNSIGNED_BYTE&&(u=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[i].push(u),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),u},r.prototype.releaseTexture=function(e,t,n,a){if(this.freeTextures!=null){var i=m3(n,a),o=g3(t,i,a);o in this.freeTextures||(this.freeTextures[o]=[]);var s=v3(t,i,this.gpgpu.gl,this.gpgpu.textureConfig,a),u=k.env().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");u!==-1&&this._numBytesAllocated>u?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=s):(this.freeTextures[o].push(e),this.numFreeTextures++,this._numBytesFree+=s),this.numUsedTextures--;var c=this.usedTextures[o],l=c&&c.indexOf(e);if(l==null||l<0)throw new Error("Cannot release a texture that was never provided by this texture manager");c[l]=c[c.length-1],c.pop(),this.log()}},r.prototype.log=function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used","".concat(this.numFreeTextures," / ").concat(this.numUsedTextures),"(".concat(e,")"));var t=this._numBytesFree/this._numBytesAllocated;console.log("Bytes allocated: ".concat(this._numBytesAllocated)),console.log("Bytes unused: ".concat(this._numBytesFree," (").concat(Math.round(100*t),"%)"))}},Object.defineProperty(r.prototype,"numBytesAllocated",{get:function(){return this._numBytesAllocated},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"numBytesFree",{get:function(){return this._numBytesFree},enumerable:!1,configurable:!0}),r.prototype.getNumUsedTextures=function(){return this.numUsedTextures},r.prototype.getNumFreeTextures=function(){return this.numFreeTextures},r.prototype.dispose=function(){var e=this;if(this.freeTextures!=null){for(var t in this.freeTextures)this.freeTextures[t].forEach(function(n){e.gpgpu.deleteMatrixTexture(n.texture)});for(var t in this.usedTextures)this.usedTextures[t].forEach(function(a){e.gpgpu.deleteMatrixTexture(a.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}},r})();function h2e(r,e){var t=r;if(e===t.R32F)return 4;if(e===t.R16F)return 2;if(e===t.RGBA32F)return 16;if(e===r.RGBA)return 16;if(e===t.RGBA16F)return 8;if(e===t.RGBA8)return 4;throw new Error("Unknown internal format ".concat(e))}function v3(r,e,t,n,a){var i=p2e(e,n),o;if(a){var s=Ee(qu(r[0],r[1]),2),u=s[0],c=s[1];o=u*c}else{var l=Ee(Jl(r[0],r[1]),2),f=l[0],h=l[1];o=f*h}var p=h2e(t,i);return o*p}function p2e(r,e){switch(r){case Xr.PACKED_2X2_FLOAT32:return xb(e);case Xr.PACKED_2X2_FLOAT16:return kb(e);case Xr.UNPACKED_FLOAT32:return yb(e);case Xr.UNPACKED_FLOAT16:return bb(e);case Xr.PACKED_4X1_UNSIGNED_BYTE:return wb(e);default:throw new Error("Unknown physical texture type ".concat(r))}}function d2e(r){return k.env().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?r?Xr.PACKED_2X2_FLOAT32:Xr.UNPACKED_FLOAT32:r?Xr.PACKED_2X2_FLOAT16:Xr.UNPACKED_FLOAT16}function m3(r,e){if(r===aa.UPLOAD)return Xr.PACKED_2X2_FLOAT32;if(r===aa.RENDER||r==null)return d2e(e);if(r===aa.DOWNLOAD||r===aa.PIXELS)return Xr.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type ".concat(r))}function g3(r,e,t){return"".concat(r[0],"_").concat(r[1],"_").concat(e,"_").concat(t)}var yi=(function(){function r(e,t){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=tn(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        `.concat(t,`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `)}return r})(),Oa="if (isnan(x)) return x;",v2e="return x;",y3="return abs(x);",m2e="return (x >= 0.0) ? x : (exp(x) - 1.0);",g2e=Oa+`
  return (x < 0.0) ? 0.0 : x;
`,y2e=Oa+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,To="return x;",b2e="return 1.0 / (1.0 + exp(-1.0 * x));";var w2e="return x;",x2e=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,k2e=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,S2e=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,E2e="return 1.0 / (1.0 + exp(-1.0 * x));",No=(function(){function r(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=tn(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `.concat(t,`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `)}return r})();var T2e=(function(){function r(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=tn(this.outputShape.length);var t=e.length,n=cn("rc",t),a=Ft(t),i=u2e(t,n),o=n.slice(-2),s=t<=1?"rc":"vec2(".concat(o.join(","),")");this.userCode=`
      void main() {
        `.concat(a,` rc = getOutputCoords();
        vec4 packedInput = getA(`).concat(i,`);

        setOutput(getChannel(packedInput, `).concat(s,`));
      }
    `)}return r})(),N2e=k.kernel_impls.whereImpl,I2e=1e-7,C2e=1e-4,Xp={};function A2e(r){return r in Xp||(Xp[r]={}),Xp[r]}var D2e=k.env().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),_2e=600;function F2e(){return k.env().global.screen==null?1024:k.env().global.screen.height*k.env().global.screen.width*window.devicePixelRatio*_2e/1024/1024}var Eb=(function(r){n1e(e,r);function e(t){var n=r.call(this)||this;if(n.pendingRead=new WeakMap,n.pendingDisposal=new WeakSet,n.dataRefCount=new WeakMap,n.numBytesInGPU=0,n.uploadWaitMs=0,n.downloadWaitMs=0,n.lastGlFlushTime=0,n.warnedAboutMemory=!1,n.pendingDeletes=0,n.disposed=!1,!k.env().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");var a;if(t!=null){if(t instanceof td)a=t;else{var i=ni(k.env().getNumber("WEBGL_VERSION"),t);a=new td(i)}n.binaryCache={},n.gpgpuCreatedLocally=!1}else{var i=ni(k.env().getNumber("WEBGL_VERSION"));a=new td(i),n.binaryCache=A2e(k.env().getNumber("WEBGL_VERSION")),n.gpgpuCreatedLocally=!0}return n.gpgpu=a,n.canvas=n.gpgpu.gl.canvas,n.textureManager=new f2e(n.gpgpu),n.numMBBeforeWarning=F2e(),n.texData=new k.DataStorage(n,k.engine()),n}return e.prototype.nextDataId=function(){return e.nextDataId++},e.prototype.numDataIds=function(){return this.texData.numDataIds()-this.pendingDeletes},e.prototype.writeTexture=function(t,n,a,i,o,s){var u=this.makeTensorInfo(n,a),c=this.texData.get(u.dataId);c.isPacked=!1,c.texture={texture:t,texShape:[i,o]},c.texShape=[i,o];var l=Ul(n),f=new l3(l,!1,s),h=this.runWebGLProgram(f,[u],a,[[i,o]]);return h.shape=n,c.texture=null,this.disposeIntermediateTensorInfo(u),h.dataId},e.prototype.write=function(t,n,a){if((k.env().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||k.env().getBool("DEBUG"))&&this.checkNumericalProblems(t),a==="complex64"&&t!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var i={id:this.nextDataId()};return this.texData.set(i,{shape:n,dtype:a,values:t,usage:aa.UPLOAD,refCount:1}),i},e.prototype.refCount=function(t){if(this.texData.has(t)){var n=this.texData.get(t);return n.refCount}return 0},e.prototype.incRef=function(t){var n=this.texData.get(t);n.refCount++},e.prototype.decRef=function(t){if(this.texData.has(t)){var n=this.texData.get(t);n.refCount--}},e.prototype.move=function(t,n,a,i,o){if(k.env().getBool("DEBUG")&&this.checkNumericalProblems(n),i==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:a,dtype:i,values:n,usage:aa.UPLOAD,refCount:o})},e.prototype.disposeIntermediateTensorInfo=function(t){this.disposeData(t.dataId)},e.prototype.readSync=function(t){var n=this.texData.get(t),a=n.values,i=n.dtype,o=n.complexTensorInfos,s=n.slice,u=n.shape,c=n.isPacked;if(s!=null){var l=void 0;c?l=new No(u,To):l=new yi(u,To);var f=this.runWebGLProgram(l,[{dataId:t,shape:u,dtype:i}],i),h=this.readSync(f.dataId);return this.disposeIntermediateTensorInfo(f),h}if(a!=null)return this.convertAndCacheOnCPU(t);if(i==="string")return a;var p=this.activeTimers!=null,d;p&&(d=k.util.now());var m;if(i==="complex64"){var v=this.readSync(o.real.dataId),g=this.readSync(o.imag.dataId);m=k.backend_util.mergeRealAndImagArrays(v,g)}else m=this.getValuesFromTexture(t);return p&&(this.downloadWaitMs+=k.util.now()-d),this.convertAndCacheOnCPU(t,m)},e.prototype.read=function(t){return Uu(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f,h,p,d,m,v,g,y,w,b,x,S,T,N,C;return Hu(this,function(R){switch(R.label){case 0:if(this.pendingRead.has(t))return n=this.pendingRead.get(t),[2,new Promise(function(_){return n.push(_)})];if(a=this.texData.get(t),i=a.values,o=a.shape,s=a.slice,u=a.dtype,c=a.complexTensorInfos,l=a.isPacked,s!=null)return f=void 0,l?f=new No(o,To):f=new yi(o,To),h=this.runWebGLProgram(f,[{dataId:t,shape:o,dtype:u}],u),p=this.read(h.dataId),this.disposeIntermediateTensorInfo(h),[2,p];if(i!=null)return[2,this.convertAndCacheOnCPU(t)];if(k.env().getBool("DEBUG")&&!k.env().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&k.env().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return d=null,u!=="complex64"&&k.env().get("WEBGL_BUFFER_SUPPORTED")&&(m=this.decode(t),v=this.texData.get(m.dataId),d=(C=this.gpgpu).createBufferFromTexture.apply(C,ir([v.texture.texture],Ee(Kp(o)),!1))),this.pendingRead.set(t,[]),u==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:R.sent(),R.label=2;case 2:return u!=="complex64"?[3,4]:[4,Promise.all([this.read(c.real.dataId),this.read(c.imag.dataId)])];case 3:return y=R.sent(),w=y[0],b=y[1],g=k.backend_util.mergeRealAndImagArrays(w,b),[3,5];case 4:d==null?g=this.getValuesFromTexture(t):(x=k.util.sizeFromShape(o),g=this.gpgpu.downloadFloat32MatrixFromBuffer(d,x)),R.label=5;case 5:return m!=null&&this.disposeIntermediateTensorInfo(m),d!=null&&(S=this.gpgpu.gl,Oe(S,function(){return S.deleteBuffer(d)})),T=this.convertAndCacheOnCPU(t,g),N=this.pendingRead.get(t),this.pendingRead.delete(t),N.forEach(function(_){return _(T)}),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t)&&k.engine().removeDataId(t,this),this.pendingDeletes--),[2,T]}})})},e.prototype.readToGPU=function(t,n){n===void 0&&(n={});var a=this.texData.get(t),i=a.values,o=a.shape,s=a.slice,u=a.dtype,c=a.isPacked,l=a.texture;if(u==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(s!=null){var f=void 0;c?f=new No(o,To):f=new yi(o,To);var h=this.runWebGLProgram(f,[{dataId:t,shape:o,dtype:u}],u),p=this.readToGPU(h,n);return this.disposeIntermediateTensorInfo(h),p}if(l==null)throw i!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");var d=this.decode(t,n.customTexShape),m=k.engine().makeTensorFromTensorInfo(d),v=this.texData.get(d.dataId);return Object.assign({tensorRef:m},v.texture)},e.prototype.bufferSync=function(t){var n=this.readSync(t.dataId);if(t.dtype==="string")try{var a=n.map(function(i){return k.util.decodeString(i)});return k.buffer(t.shape,t.dtype,a)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return k.buffer(t.shape,t.dtype,n)},e.prototype.checkNumericalProblems=function(t){if(t!=null)for(var n=0;n<t.length;n++){var a=t[n];if(!$3(a))throw k.env().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value ".concat(a," cannot be represented with your ")+"current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value ".concat(a," cannot be represented on this device."))}},e.prototype.getValuesFromTexture=function(t){var n,a=this.texData.get(t),i=a.shape,o=a.dtype,s=a.isPacked,u=k.util.sizeFromShape(i);if(k.env().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var c=this.decode(t),l=this.texData.get(c.dataId),f=(n=this.gpgpu).downloadMatrixFromPackedTexture.apply(n,ir([l.texture.texture],Ee(Kp(i)),!1)).subarray(0,u);return this.disposeIntermediateTensorInfo(c),f}var h=k.env().getBool("WEBGL_PACK")&&s===!0,p=h?Ul(i):i,d=h?new cxe(p):new uxe(p),m=this.runWebGLProgram(d,[{shape:p,dtype:o,dataId:t}],"float32"),v=this.texData.get(m.dataId),g=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(v.texture.texture,v.texShape[0],v.texShape[1]).subarray(0,u);return this.disposeIntermediateTensorInfo(m),g},e.prototype.timerAvailable=function(){return k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0},e.prototype.time=function(t){var n=this,a=this.activeTimers,i=[],o=!1;this.programTimersStack==null?(this.programTimersStack=i,o=!0):this.activeTimers.push(i),this.activeTimers=i,t();var s=k.util.flatten(this.activeTimers.map(function(l){return l.query})).filter(function(l){return l!=null}),u=k.util.flatten(this.activeTimers.map(function(l){return l.name})).filter(function(l){return l!=null});this.activeTimers=a,o&&(this.programTimersStack=null);var c={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(function(){return Uu(n,void 0,void 0,function(){var l;return Hu(this,function(f){switch(f.label){case 0:return k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(s)]:[3,2];case 1:return l=f.sent(),c.kernelMs=k.util.sum(l),c.getExtraProfileInfo=function(){return l.map(function(h,p){return{name:u[p],ms:h}}).map(function(h){return"".concat(h.name,": ").concat(h.ms)}).join(", ")},[3,3];case 2:c.kernelMs={error:"WebGL query timers are not supported in this environment."},f.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,c]}})})})()},e.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}},e.prototype.startTimer=function(){return k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:k.util.now(),endMs:null}},e.prototype.endTimer=function(t){return k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=k.util.now(),t)},e.prototype.getQueryTime=function(t){return Uu(this,void 0,void 0,function(){var n;return Hu(this,function(a){return k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(t)]:(n=t,[2,n.endMs-n.startMs])})})},e.prototype.disposeData=function(t,n){if(n===void 0&&(n=!1),this.pendingDisposal.has(t))return!1;if(!this.texData.has(t))return!0;if(n?this.texData.get(t).refCount=0:this.texData.get(t).refCount--,!n&&this.texData.get(t).refCount>0)return!1;if(this.pendingRead.has(t))return this.pendingDisposal.add(t),this.pendingDeletes++,!1;this.releaseGPUData(t);var a=this.texData.get(t).complexTensorInfos;return a!=null&&(this.disposeData(a.real.dataId,n),this.disposeData(a.imag.dataId,n)),this.texData.delete(t),!0},e.prototype.releaseGPUData=function(t){var n=this.texData.get(t),a=n.texture,i=n.dtype,o=n.texShape,s=n.usage,u=n.isPacked,c=n.slice,l=c&&c.origDataId||t,f=this.dataRefCount.get(l);f>1?this.dataRefCount.set(l,f-1):(this.dataRefCount.delete(l),a!=null&&(this.numBytesInGPU-=this.computeBytes(o,i),this.textureManager.releaseTexture(a,o,s,u)));var h=this.texData.get(t);h.texture=null,h.texShape=null,h.isPacked=!1,h.slice=null},e.prototype.getTexture=function(t){return this.uploadToGPU(t),this.texData.get(t).texture.texture},e.prototype.getDataInfo=function(t){return this.texData.get(t)},e.prototype.shouldExecuteOnCPU=function(t,n){var a=this;return n===void 0&&(n=D2e),k.env().getBool("WEBGL_CPU_FORWARD")&&t.every(function(i){return a.texData.get(i.dataId).texture==null&&k.util.sizeFromShape(i.shape)<n})},e.prototype.getGPGPUContext=function(){return this.gpgpu},e.prototype.where=function(t){k.backend_util.warn("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var n=t.dataSync();return N2e(t.shape,n)},e.prototype.packedUnaryOp=function(t,n,a){var i=new No(t.shape,n),o=this.compileAndRun(i,[t],a);return k.engine().makeTensorFromTensorInfo(o)},e.prototype.abs=function(t){if(this.shouldExecuteOnCPU([t])&&t.dtype!=="complex64"){var n=OF(this.texData.get(t.dataId).values);return this.makeOutput(t.shape,t.dtype,n)}if(k.env().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,y3,t.dtype);var a=new yi(t.shape,y3),i=this.compileAndRun(a,[t]);return k.engine().makeTensorFromTensorInfo(i)},e.prototype.makeTensorInfo=function(t,n,a){var i;if(n==="string"&&a!=null&&a.length>0&&k.util.isString(a[0])){var o=a.map(function(s){return k.util.encodeString(s)});i=this.write(o,t,n)}else i=this.write(a,t,n);return this.texData.get(i).usage=null,{dataId:i,shape:t,dtype:n}},e.prototype.makeOutput=function(t,n,a){return k.engine().makeTensorFromTensorInfo(this.makeTensorInfo(t,n,a),this)},e.prototype.unpackTensor=function(t){var n=new T2e(t.shape);return this.runWebGLProgram(n,[t],t.dtype)},e.prototype.packTensor=function(t){var n=new c2e(t.shape),a=!0;return this.runWebGLProgram(n,[t],t.dtype,null,a)},e.prototype.packedReshape=function(t,n){var a=ir([Fs(t.shape)],Ee(Rs(t.shape)),!1),i={dtype:t.dtype,shape:a,dataId:t.dataId},o=ir([Fs(n)],Ee(Rs(n)),!1),s=new BF(o,a),u=!0,c=[a],l=this.runWebGLProgram(s,[i],t.dtype,c,u);return{dataId:l.dataId,shape:n,dtype:l.dtype}},e.prototype.decode=function(t,n){var a=this.texData.get(t),i=a.isPacked,o=a.shape,s=a.dtype;if(n!=null){var u=k.util.sizeFromShape(o),c=n[0]*n[1]*4;k.util.assert(u<=c,function(){return"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data."})}var l=Ul(o),f;i?f=new sxe(l):f=new oxe(l);var h=!0,p=[n??Kp(l)],d=this.runWebGLProgram(f,[{shape:l,dtype:s,dataId:t}],s,p,h,n);return{dtype:s,shape:o,dataId:d.dataId}},e.prototype.runWebGLProgram=function(t,n,a,i,o,s){var u=this;o===void 0&&(o=!1);var c=this.makeTensorInfo(t.outputShape,a),l=this.texData.get(c.dataId);if(t.packedOutput&&(l.isPacked=!0),t.outPackingScheme===Kl.DENSE){var f=s??Kp(t.outputShape);l.texShape=f.map(function(S){return S*2})}if(t.outTexUsage!=null&&(l.usage=t.outTexUsage),k.util.sizeFromShape(c.shape)===0)return l.values=k.util.getTypedArrayFromDType(c.dtype,0),c;var h=[],p=n.map(function(S){if(S.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var T=u.texData.get(S.dataId);if(T.texture==null){if(!t.packedInputs&&k.util.sizeFromShape(S.shape)<=k.env().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:S.shape,texData:null,isUniform:!0,uniformValues:T.values};t.packedInputs&&(T.isPacked=!0,T.shape=S.shape)}if(u.uploadToGPU(S.dataId),!!T.isPacked!=!!t.packedInputs)S=T.isPacked?u.unpackTensor(S):u.packTensor(S),h.push(S),T=u.texData.get(S.dataId);else if(T.isPacked&&!jl(T.shape,S.shape)){var N=S,C=S.shape;S.shape=T.shape,S=u.packedReshape(S,C),h.push(S),T=u.texData.get(S.dataId),N.shape=C}return{shape:S.shape,texData:T,isUniform:!1}});this.uploadToGPU(c.dataId);var d={shape:c.shape,texData:l,isUniform:!1},m=ixe(t,p,d),v=this.getAndSaveBinary(m,function(){return nxe(u.gpgpu,t,p,d)}),g=this.activeTimers!=null,y;g&&(y=this.startTimer()),k.env().get("ENGINE_COMPILE_ONLY")||axe(this.gpgpu,v,p,d,i),h.forEach(function(S){return u.disposeIntermediateTensorInfo(S)}),g&&(y=this.endTimer(y),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(y)}));var w=k.env().getNumber("WEBGL_FLUSH_THRESHOLD");if(w>0){var b=k.util.now();b-this.lastGlFlushTime>w&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=b)}if(!k.env().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&o===!1){var x=this.unpackTensor(c);return this.disposeIntermediateTensorInfo(c),x}return c},e.prototype.compileAndRun=function(t,n,a,i,o){o===void 0&&(o=!1),a=a||n[0].dtype;var s=this.runWebGLProgram(t,n,a,i,o);return s},e.prototype.getAndSaveBinary=function(t,n){return t in this.binaryCache||(this.binaryCache[t]=n()),this.binaryCache[t]},e.prototype.getTextureManager=function(){return this.textureManager},e.prototype.dispose=function(){var t=this;if(!this.disposed){if(!k.env().getBool("IS_TEST")){var n=Object.keys(this.binaryCache);n.forEach(function(a){t.gpgpu.deleteProgram(t.binaryCache[a].webGLProgram),delete t.binaryCache[a]})}this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0}},e.prototype.floatPrecision=function(){var t=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=k.tidy(function(){if(!k.env().get("WEBGL_RENDER_FLOAT32_ENABLED")){var n=k.env().getBool("DEBUG");k.env().set("DEBUG",!1);var a=t.abs(k.scalar(1e-8)).dataSync()[0];if(k.env().set("DEBUG",n),a>0)return 32}return 16})),this.floatPrecisionValue},e.prototype.epsilon=function(){return this.floatPrecision()===32?I2e:C2e},e.prototype.uploadToGPU=function(t){var n,a=this.texData.get(t),i=a.shape,o=a.dtype,s=a.values,u=a.texture,c=a.usage,l=a.isPacked;if(u==null){var f=this.activeTimers!=null,h;f&&(h=k.util.now());var p=a.texShape;if(p==null&&(p=nF(i,l),a.texShape=p),s!=null){var d=Ul(i),m=void 0,v=p[1],g=p[0],y=s instanceof Uint8Array||s instanceof Uint8ClampedArray;(l||!y)&&(n=Ee(qu(p[0],p[1]),2),v=n[0],g=n[1]),l?m=new fxe(d,y):m=new l3(d,y);var w=y?[g,v]:p,b=this.makeTensorInfo(w,o),x=this.texData.get(b.dataId);y?x.usage=aa.PIXELS:x.usage=aa.UPLOAD,x.texShape=w,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(b.dataId),v,g,s);var S=[[g,v]],T=!0,N=this.runWebGLProgram(m,[b],o,S,T),C=this.texData.get(N.dataId);a.texShape=C.texShape,a.isPacked=C.isPacked,a.usage=C.usage,k.env().get("ENGINE_COMPILE_ONLY")?this.disposeData(N.dataId):(a.texture=C.texture,a.values=null,this.texData.delete(N.dataId)),this.disposeIntermediateTensorInfo(b),f&&(this.uploadWaitMs+=k.util.now()-h)}else{var R=this.acquireTexture(p,c,o,l);a.texture=R}}},e.prototype.convertAndCacheOnCPU=function(t,n){var a=this.texData.get(t),i=a.dtype;return n!=null&&(a.values=R2e(n,i)),a.values},e.prototype.acquireTexture=function(t,n,a,i){if(this.numBytesInGPU+=this.computeBytes(t,a),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){var o=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: ".concat(o," MB, ")+"most likely due to a memory leak")}return this.textureManager.acquireTexture(t,n,i)},e.prototype.computeBytes=function(t,n){return t[0]*t[1]*k.util.bytesPerElement(n)},e.prototype.checkCompileCompletion=function(){var t,n;try{for(var a=ln(Object.entries(this.binaryCache)),i=a.next();!i.done;i=a.next()){var o=Ee(i.value,2),s=o[1];this.checkCompletion_(s)}}catch(u){t={error:u}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}},e.prototype.checkCompileCompletionAsync=function(){return Uu(this,void 0,void 0,function(){var t,n,a,i,l,o,s,u,c,l,f,h,p,d,m=this;return Hu(this,function(v){if(t=[],this.gpgpu.parallelCompilationExtension){try{for(n=ln(Object.entries(this.binaryCache)),a=n.next();!a.done;a=n.next())i=Ee(a.value,2),l=i[1],t.push(this.checkCompletionAsync_(l))}catch(g){f={error:g}}finally{try{a&&!a.done&&(h=n.return)&&h.call(n)}finally{if(f)throw f.error}}return[2,Promise.all(t)]}else{o=function(g){var y=new Promise(function(w){try{m.checkCompletion_(g),w(!0)}catch(b){throw b}});t.push(y)};try{for(s=ln(Object.entries(this.binaryCache)),u=s.next();!u.done;u=s.next())c=Ee(u.value,2),l=c[1],o(l)}catch(g){p={error:g}}finally{try{u&&!u.done&&(d=s.return)&&d.call(s)}finally{if(p)throw p.error}}return[2,Promise.all(t)]}})})},e.prototype.checkCompletionAsync_=function(t){return Uu(this,void 0,void 0,function(){return Hu(this,function(n){switch(n.label){case 0:return this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?[2,this.checkCompletion_(t)]:[3,1];case 1:return[4,k.nextFrame()];case 2:return n.sent(),[2,this.checkCompletionAsync_(t)]}})})},e.prototype.checkCompletion_=function(t){if(this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(t.webGLProgram)),this.gpgpu.gl.getShaderParameter(t.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(db(t.source,this.gpgpu.gl.getShaderInfoLog(t.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0},e.prototype.getUniformLocations=function(){var t,n;try{for(var a=ln(Object.values(this.binaryCache)),i=a.next();!i.done;i=a.next()){var o=i.value;this.gpgpu.buildVao(o.webGLProgram);var s=dF(this.gpgpu,o.program,o.webGLProgram),u=s.variablesLocations,c=s.customUniformLocations,l=s.infLoc,f=s.nanLoc,h=s.outShapeLocation,p=s.outShapeStridesLocation,d=s.outTexShapeLocation;o.variablesLocations=u,o.customUniformLocations=c,o.infLoc=l,o.nanLoc=f,o.outShapeLocation=h,o.outShapeStridesLocation=p,o.outTexShapeLocation=d}}catch(m){t={error:m}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}},e.prototype.createTensorFromGPUData=function(t,n,a){t.channels=t.channels||"RGBA";var i=t.texture,o=t.height,s=t.width,u=t.channels,c=k.engine().backend;if(!c.gpgpu.gl.isTexture(i))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");var l=c.writeTexture(i,n,a,o,s,u);return k.engine().makeTensorFromDataId(l,n,a,c)},e})(k.KernelBackend);Eb.nextDataId=0;function R2e(r,e){if(e==="float32"||e==="complex64")return r;if(e==="int32"||e==="bool"){for(var t=e==="int32"?new Int32Array(r.length):new Uint8Array(r.length),n=0;n<t.length;++n)t[n]=Math.round(r[n]);return t}else throw new Error("Unknown dtype ".concat(e))}var O2e="4.22.0";function LF(){k.env().set("WEBGL_FORCE_F16_TEXTURES",!0)}k.device_util.isBrowser()&&k.registerBackend("webgl",function(){return new Eb},2);var P2e={forceHalfFloat:LF};var Tb=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`,Os=(function(){function r(e,t,n){this.variableNames=["A","B"],this.outputShape=k.backend_util.assertAndGetBroadcastShape(t,n),this.enableShapeUniforms=tn(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        `.concat(e,`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `)}return r})();var Bs=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`,Ju=(function(){function r(e,t,n,a){a===void 0&&(a=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=k.backend_util.assertAndGetBroadcastShape(t,n);var i=this.outputShape.length;this.enableShapeUniforms=tn(i);var o="";if(a)if(i===0||k.util.sizeFromShape(this.outputShape)===1)o=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else{var s=Ft(i);if(o=`
          `.concat(s,` coords = getOutputCoords();
        `),i===1)this.enableShapeUniforms?o+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:o+=`
            result.y = (coords + 1) >= `.concat(this.outputShape[0],` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `);else{var u=cn("coords",i);this.enableShapeUniforms?o+=`
            bool nextRowOutOfBounds =
              (`.concat(u[i-2]," + 1) >= outShape[").concat(i,` - 2];
            bool nextColOutOfBounds =
              (`).concat(u[i-1]," + 1) >= outShape[").concat(i,` - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `):o+=`
            bool nextRowOutOfBounds =
              (`.concat(u[i-2]," + 1) >= ").concat(this.outputShape[i-2],`;
            bool nextColOutOfBounds =
              (`).concat(u[i-1]," + 1) >= ").concat(this.outputShape[i-1],`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `)}}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `.concat(e,`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `).concat(o,`

        setOutput(result);
      }
    `)}return r})();function Kn(r){var e=r.inputs,t=r.backend,n=e.x;return t.incRef(n.dataId),{dataId:n.dataId,shape:n.shape,dtype:n.dtype}}var M2e={kernelName:k.Identity,backendName:"webgl",kernelFunc:Kn};function Io(r){var e=r.inputs,t=r.backend,n=e.real,a=e.imag,i=t.makeTensorInfo(n.shape,"complex64"),o=t.texData.get(i.dataId),s=Kn({inputs:{x:n},backend:t}),u=Kn({inputs:{x:a},backend:t});return o.complexTensorInfos={real:s,imag:u},i}var B2e={kernelName:k.Complex,backendName:"webgl",kernelFunc:Io};var zF="return (a < 0.) ? b * a : a;",$F=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function L2e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.alpha,o=t.makeTensorInfo([],"float32",k.util.createScalarValue(i,"float32")),s=k.env().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ju($F,a.shape,o.shape):new Os(zF,a.shape,o.shape),u=t.runWebGLProgram(s,[a,o],"float32");return t.disposeIntermediateTensorInfo(o),u}var z2e={kernelName:k.LeakyRelu,backendName:"webgl",kernelFunc:L2e};var WF="return (a < 0.) ? b * a : a;",GF=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function $2e(r){var e=r.inputs,t=r.backend,n=e.x,a=e.alpha,i=k.env().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ju(GF,n.shape,a.shape):new Os(WF,n.shape,a.shape);return t.runWebGLProgram(i,[n,a],"float32")}var W2e={kernelName:k.Prelu,backendName:"webgl",kernelFunc:$2e},Qu="if (isnan(x)) return x;";function bt(r){var e=r.opSnippet,t=r.packedOpSnippet,n=r.cpuKernelImpl,a=r.dtype;return function(i){var o=i.inputs,s=i.backend,u=o.x,c=s,l=a||u.dtype;if(c.shouldExecuteOnCPU([u])&&n!=null){var f=c.texData.get(u.dataId),h=n(f.values,l);return c.makeTensorInfo(u.shape,l,h)}var p=k.env().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&t!=null,d;return p?d=new No(u.shape,t):d=new yi(u.shape,e),c.runWebGLProgram(d,[u],l)}}function Yr(r){var e=r.opSnippet,t=r.packedOpSnippet,n=r.checkOutOfBounds,a=n===void 0?!1:n,i=r.supportsComplex,o=i===void 0?!1:i,s=r.cpuKernelImpl,u=r.dtype;return function(c){var l=c.inputs,f=c.backend,h=l.a,p=l.b,d=f;if(o&&h.dtype==="complex64"){var m=d.texData.get(h.dataId),v=d.texData.get(p.dataId),g=Ee([[m.complexTensorInfos.real,v.complexTensorInfos.real],[m.complexTensorInfos.imag,v.complexTensorInfos.imag]].map(function(G){var X=Ee(G,2),Z=X[0],V=X[1],j={dataId:Z.dataId,dtype:Z.dtype,shape:h.shape},re={dataId:V.dataId,dtype:V.dtype,shape:p.shape},te=new Os(e,h.shape,p.shape);return d.runWebGLProgram(te,[j,re],k.upcastType(Z.dtype,V.dtype))}),2),y=g[0],w=g[1],b=Io({inputs:{real:y,imag:w},backend:d});return d.disposeIntermediateTensorInfo(y),d.disposeIntermediateTensorInfo(w),b}var x=u||k.upcastType(h.dtype,p.dtype);if((h.dtype==="string"||p.dtype==="string"||d.shouldExecuteOnCPU([h,p]))&&s!=null){var S=d.texData.get(h.dataId).values,T=d.texData.get(p.dataId).values,N=h.dtype==="string"?k.backend_util.fromUint8ToStringArray(S):S,C=h.dtype==="string"?k.backend_util.fromUint8ToStringArray(T):T,R=Ee(s(h.shape,p.shape,N,C,x),2),_=R[0],P=R[1],$=d.makeTensorInfo(P,x),z=d.texData.get($.dataId);return z.values=_,$}var L=k.env().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&t!=null,B;return L?B=new Ju(t,h.shape,p.shape,a):B=new Os(e,h.shape,p.shape),d.runWebGLProgram(B,[h,p],x)}}function Xl(r,e){if(e===void 0&&(e=!1),r==="linear")return e?w2e:v2e;if(r==="relu")return e?k2e:g2e;if(r==="elu")return e?x2e:m2e;if(r==="relu6")return e?S2e:y2e;if(r==="prelu")return e?GF:WF;if(r==="leakyrelu")return e?$F:zF;if(r==="sigmoid")return e?E2e:b2e;throw new Error("Activation ".concat(r," has not been implemented for the WebGL backend."))}var VF=(function(){function r(e,t,n,a,i,o,s,u,c){a===void 0&&(a=!1),i===void 0&&(i=!1),o===void 0&&(o=!1),s===void 0&&(s=null),u===void 0&&(u=!1),c===void 0&&(c=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.enableShapeUniforms=tn(this.outputShape.length);var l=a?e[1]:e[2],f=Math.ceil(l/2),h=a?"i * 2, rc.y":"rc.y, i * 2",p=i?"rc.z, i * 2":"i * 2, rc.z",d=a?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],m=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],v="",g="";s&&(u?v=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `.concat(s,`
        }`):c?v=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          `.concat(s,`
        }`):v=`vec4 activation(vec4 x) {
          `.concat(s,`
        }`),g="result = activation(result);");var y=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),u&&this.variableNames.push("preluActivationWeights"),c&&this.variableNames.push("leakyreluAlpha");var w="rc.x",b="rc.x";e[0]<t[0]?w="imod(rc.x, ".concat(e[0],")"):t[0]<e[0]&&(b="imod(rc.x, ".concat(t[0],")")),this.userCode=`
      `.concat(v,`
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = `).concat(f,`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = `).concat(w,`;
        int batchB = `).concat(b,`;
        for (int i = 0; i < `).concat(f,`; i++) {
          vec4 a = getMatrixA(batchA, `).concat(h,`);
          vec4 b = getMatrixB(batchB, `).concat(p,`);

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (`).concat(d[0]," * ").concat(m[0],`);
          result += (`).concat(d[1]," * ").concat(m[1],`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `).concat(y,`

        `).concat(g,`

        setOutput(result);
      }
    `)}return r})();var b3={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"},w3=(function(){function r(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=k.backend_util.assertAndGetBroadcastShape(t,n),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `.concat(e,`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `)}return r})(),x3="return a * b;";function Nb(r){var e=r.inputs,t=r.backend,n=e.a,a=e.b,i=k.backend_util.upcastType(n.dtype,a.dtype);if(n.dtype==="complex64"){var o=t.texData.get(n.dataId),s=t.texData.get(a.dataId),u=new w3(b3.REAL,n.shape,a.shape),c=new w3(b3.IMAG,n.shape,a.shape),l=[{dataId:o.complexTensorInfos.real.dataId,dtype:o.complexTensorInfos.real.dtype,shape:n.shape},{dataId:o.complexTensorInfos.imag.dataId,dtype:o.complexTensorInfos.imag.dtype,shape:n.shape},{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:a.shape},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:a.shape}],f=t.runWebGLProgram(u,l,"float32"),h=t.runWebGLProgram(c,l,"float32"),p=Io({inputs:{real:f,imag:h},backend:t});return t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(h),p}if(t.shouldExecuteOnCPU([n,a])){var o=t.texData.get(n.dataId),s=t.texData.get(a.dataId),d=Ee(Lke(n.shape,a.shape,o.values,s.values,i),2),m=d[0],v=d[1],g=t.makeTensorInfo(v,i),y=t.texData.get(g.dataId);return y.values=m,g}var w;return k.env().getBool("WEBGL_PACK_BINARY_OPERATIONS")?w=new Ju(x3,n.shape,a.shape):w=new Os(x3,n.shape,a.shape),t.runWebGLProgram(w,[n,a],i)}var G2e={kernelName:k.Multiply,backendName:"webgl",kernelFunc:Nb};function V2e(r,e,t){var n=ir([Fs(r.shape)],Ee(Rs(r.shape)),!1),a={dtype:r.dtype,shape:n,dataId:r.dataId},i=ir([Fs(e)],Ee(Rs(e)),!1),o=new BF(i,n),s=!0,u=[n],c=t.runWebGLProgram(o,[a],r.dtype,u,s);return{dataId:c.dataId,shape:e,dtype:c.dtype}}function Ce(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.shape,o=t,s=k.util.sizeFromShape(a.shape),u=k.util.inferFromImplicitShape(i,s),c=k.util.sizeFromShape(u);k.util.assert(s===c,function(){return"The new shape (".concat(u,") has ").concat(c," elements and the old ")+"shape (".concat(a.shape,") has ").concat(s," elements. The new shape and old ")+"shape must have the same number of elements."});var l=o.texData.get(a.dataId);return l.isPacked&&!jl(a.shape,u)&&!(l.texture!==null&&jl(l.shape,u))?V2e(a,u,o):(o.incRef(a.dataId),{dataId:a.dataId,shape:u,dtype:a.dtype})}var U2e={kernelName:k.Reshape,backendName:"webgl",kernelFunc:Ce};var k3=(function(){function r(e,t){this.variableNames=["x"];var n=e.windowSize,a=e.batchSize,i=e.inSize,o=e.outSize;this.outputShape=[a,o];var s=Math.floor(n/4)*4,u=n%4,c="sumValue += dot(values, ones);";if(t!=null){var l=1/t;c="sumValue += dot(values * ".concat(k.util.isInt(l)?l.toPrecision(2):l,", ones);")}var f="";i%n>0&&(f=`
        if (inIdx < 0 || inIdx >= `.concat(i,`) {
          return 0.0;
        }
      `)),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `.concat(f,`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `).concat(n,`;

        float sumValue = 0.0;

        for (int i = 0; i < `).concat(s,`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `).concat(c,`
        }

        int inIdx = inOffset + `).concat(s,`;
        if (`).concat(u===1,`) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          `).concat(c,`
        } else if (`).concat(u===2,`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          `).concat(c,`
        } else if (`).concat(u===3,`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          `).concat(c,`
        }
        setOutput(sumValue);
      }
    `)}return r})();var H2e=(function(){function r(e,t){this.variableNames=["x"];var n=e.windowSize,a=e.batchSize,i=e.inSize,o=e.outSize;this.outputShape=[a,o];var s="0.0",u="";t==="prod"?s="1.0":t==="min"?(s="1.0 / 1e-20",u="min"):t==="max"&&(s="-1.0 / 1e-20",u="max");var c="".concat(t,"(").concat(t,"(").concat(t,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="sum"?c="sumValue":t==="prod"?c="prodValue":t==="all"?c="allValue":t==="any"&&(c="anyValue");var l=Math.floor(n/4)*4,f=n%4,h=`
      if (`.concat(t==="sum",`) {
        sumValue += dot(values, ones);
      } else if (`).concat(t==="prod",`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `).concat(u,`(values, minMaxValue);
        if (`).concat(t==="min"," || ").concat(t==="max",`) {
          minMaxValue = `).concat(u,`(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `),p="vec4";t==="all"?(s="1.0",h=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,p="bvec4"):t==="any"&&(s="0.0",h=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,p="bvec4");var d="";i%n>0&&(d=`
        if (inIdx < 0 || inIdx >= `.concat(i,`) {
          return initializationValue;
        }
      `)),this.userCode=`
      const float initializationValue = `.concat(s,`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `).concat(d,`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `).concat(n,`;

        vec4 minMaxValue = vec4(`).concat(s,`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `).concat(l,`; i += 4) {
          int inIdx = inOffset + i;
          `).concat(p," values = ").concat(p,`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `).concat(h,`
        }

        int inIdx = inOffset + `).concat(l,`;
        if (`).concat(f===1,`) {
          `).concat(p," values = ").concat(p,`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `).concat(h,`
        } else if (`).concat(f===2,`) {
          `).concat(p," values = ").concat(p,`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `).concat(h,`
        } else if (`).concat(f===3,`) {
          `).concat(p," values = ").concat(p,`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `).concat(h,`
        }
        setOutput(`).concat(c,`);
      }
    `)}return r})();function q2e(r){for(var e=[];e.length===0||e[e.length-1].outSize!==1;){var t=e.length?e[e.length-1].outSize:r[1],n=k.backend_util.computeOptimalWindowSize(t);e.push({inSize:t,windowSize:n,outSize:Math.ceil(t/n)})}return e}function Ls(r,e,t,n){for(var a=q2e(r.shape),i=r,o=0;o<a.length;o++){var s=a[o],u=s.inSize,c=s.windowSize,l=s.outSize,f=void 0,h=void 0;t==="mean"?f=o===0?new k3({windowSize:c,inSize:u,batchSize:r.shape[0],outSize:l},u):new k3({windowSize:c,inSize:u,batchSize:r.shape[0],outSize:l}):f=new H2e({windowSize:c,inSize:u,batchSize:r.shape[0],outSize:l},t),h=i,i=n.runWebGLProgram(f,[i],e),h.dataId!==r.dataId&&n.disposeIntermediateTensorInfo(h)}return i}var K2e=(function(){function r(e,t){this.variableNames=["A"];for(var n=new Array(e.length),a=0;a<n.length;a++)n[a]=e[t[a]];this.outputShape=n,this.rank=n.length;var i=Ft(this.rank),o=j2e(t);this.userCode=`
    void main() {
      `.concat(i,` resRC = getOutputCoords();
      setOutput(getA(`).concat(o,`));
    }
    `)}return r})();function j2e(r){var e=r.length;if(e>6)throw Error("Transpose for rank ".concat(e," is not yet supported"));for(var t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],n=new Array(e),a=0;a<r.length;a++)n[r[a]]=t[a];return n.join()}var X2e=(function(){function r(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var n=new Array(e.length),a=0;a<n.length;a++)n[a]=e[t[a]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error("Packed transpose for rank ".concat(this.rank," is not yet supported."));for(var i=Ft(this.rank),o=MF("rc",this.rank),s=new Array(this.rank),a=0;a<t.length;a++)s[t[a]]=o[a];var u="vec2(".concat(s.slice(-2).join(),")"),c="++".concat(o[this.rank-1]," < ").concat(n[this.rank-1]),l="getChannel(getA(".concat(s.join(),"), ").concat(u,")");this.userCode=`
    void main() {
      `.concat(i,` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `).concat(l,`;
      if(`).concat(c,`) {
        result[1] = `).concat(l,`;
      }
      --`).concat(o[this.rank-1],`;
      if(++`).concat(o[this.rank-2]," < ").concat(n[this.rank-2],`) {
        result[2] = `).concat(l,`;
        if(`).concat(c,`) {
          result[3] = `).concat(l,`;
        }
      }
      setOutput(result);
    }
    `)}return r})();function sd(r,e,t){var n=k.env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new X2e(r.shape,e):new K2e(r.shape,e);return t.runWebGLProgram(n,[r],r.dtype)}function Y2e(r,e,t,n){var a=e,i=r.shape.length,o=k.util.parseAxisParam(a,r.shape),s=o,u=k.backend_util.getAxesPermutation(s,i),c=u!=null,l=r;c&&(l=sd(r,u,n),s=k.backend_util.getInnerMostAxes(s.length,i)),k.backend_util.assertAxesAreInnerMostDims("sum",s,i);var f=Ee(k.backend_util.computeOutAndReduceShapes(l.shape,s),2),h=f[0],p=f[1],d=h;t&&(d=k.backend_util.expandShapeToKeepDim(h,o));var m=k.util.sizeFromShape(p),v=k.util.sizeFromShape(r.shape),g=v/m,y=Ce({inputs:{x:l},attrs:{shape:[g,m]},backend:n}),w=k.sumOutType(r.dtype),b=Ls(y,w,"sum",n),x=Ce({inputs:{x:b},attrs:{shape:d},backend:n});return n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(b),c&&n.disposeIntermediateTensorInfo(l),x}function ud(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims;return Y2e(a,i,o,t)}var Z2e={kernelName:k.Sum,backendName:"webgl",kernelFunc:ud};function fn(r){for(var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.perm,o=t,s=a.shape.length,u=new Array(s),c=0;c<u.length;c++)u[c]=a.shape[i[c]];var l;if(o.shouldExecuteOnCPU([a])){var f=o.texData.get(a.dataId),h=f.values,p=Sb(h,a.shape,a.dtype,i,u);l=o.makeTensorInfo(u,a.dtype);var d=o.texData.get(l.dataId);d.values=p}else l=sd(a,i,o);return l}var J2e={kernelName:k.Transpose,backendName:"webgl",kernelFunc:fn},UF=1e3;function nd(r){var e,t,n=r.a,a=r.b,i=r.transposeA,o=r.transposeB,s=r.backend,u=r.bias,c=u===void 0?null:u,l=r.preluActivationWeights,f=l===void 0?null:l,h=r.leakyreluAlpha,p=h===void 0?0:h,d=r.activation,m=d===void 0?null:d,v=n.shape.length,g=a.shape.length,y=i?n.shape[v-2]:n.shape[v-1],w=o?a.shape[g-1]:a.shape[g-2],b=i?n.shape[v-1]:n.shape[v-2],x=o?a.shape[g-2]:a.shape[g-1],S=n.shape.slice(0,-2),T=a.shape.slice(0,-2),N=k.util.sizeFromShape(S),C=k.util.sizeFromShape(T),R=k.broadcast_util.assertAndGetBroadcastShape(n.shape.slice(0,-2),a.shape.slice(0,-2)),_=R.concat([b,x]);k.util.assert(y===w,function(){return"Error in matMul: inner shapes (".concat(y,") and (")+"".concat(w,") of Tensors with shapes ").concat(n.shape," and ")+"".concat(a.shape," and transposeA=").concat(i)+" and transposeB=".concat(o," must match.")});var P=i?[N,y,b]:[N,b,y],$=o?[C,x,w]:[C,w,x],z=Ce({inputs:{x:n},backend:s,attrs:{shape:P}}),L=Ce({inputs:{x:a},backend:s,attrs:{shape:$}}),B=[z,L],G=Math.max(N,C),X=i?z.shape[1]:z.shape[2],Z=c!=null,V=f!=null,j=m==="leakyrelu",re=m!=null?Xl(m,!0):null,te=Z||V||j||re!=null,oe;if((b===1||x===1)&&X>UF&&te===!1){var ce=z,pe=L;i&&(ce=fn({inputs:{x:z},backend:s,attrs:{perm:[0,2,1]}}),B.push(ce)),o&&(pe=fn({inputs:{x:L},backend:s,attrs:{perm:[0,2,1]}}),B.push(pe));var xe=x!==1,fe=x===1,ge=ce;xe&&(ge=Ce({inputs:{x:ce},backend:s,attrs:{shape:[G,X,1]}}),B.push(ge));var we=x===1?2:1,Ae=pe;fe&&(Ae=Ce({inputs:{x:pe},backend:s,attrs:{shape:[G,1,X]}}),B.push(Ae));var Ke=Nb({inputs:{a:ge,b:Ae},backend:s});oe=ud({inputs:{x:Ke},backend:s,attrs:{axis:we,keepDims:!0}}),B.push(Ke)}else{var ot=k.upcastType(n.dtype,a.dtype),et=new VF(P,$,[G,b,x],i,o,Z,re,V,j),Qe=[z,L];if(c!=null&&Qe.push(c),V&&Qe.push(f),j){var it=s.makeTensorInfo([],"float32",k.util.createScalarValue(p,"float32"));Qe.push(it),B.push(it)}oe=s.runWebGLProgram(et,Qe,ot)}var nt=Ce({inputs:{x:oe},backend:s,attrs:{shape:_}});B.push(oe);try{for(var je=ln(B),Je=je.next();!Je.done;Je=je.next()){var Ze=Je.value;s.disposeIntermediateTensorInfo(Ze)}}catch(Yt){e={error:Yt}}finally{try{Je&&!Je.done&&(t=je.return)&&t.call(je)}finally{if(e)throw e.error}}return nt}function Q2e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.a,i=e.b,o=e.bias,s=e.preluActivationWeights,u=n.transposeA,c=n.transposeB,l=n.activation,f=n.leakyreluAlpha;return nd({a,b:i,transposeA:u,transposeB:c,backend:t,bias:o,preluActivationWeights:s,leakyreluAlpha:f,activation:l})}var eSe={kernelName:k._FusedMatMul,backendName:"webgl",kernelFunc:Q2e};var S3="return abs(x);";function tSe(r){var e=r.inputs,t=r.backend,n=e.x;if(t.shouldExecuteOnCPU([n])&&n.dtype!=="complex64"){var a=t.texData.get(n.dataId),i=OF(a.values);return t.makeTensorInfo(n.shape,n.dtype,i)}var o;return k.env().getBool("WEBGL_PACK_UNARY_OPERATIONS")?o=new No(n.shape,S3):o=new yi(n.shape,S3),t.runWebGLProgram(o,[n],n.dtype)}var rSe={kernelName:k.Abs,backendName:"webgl",kernelFunc:tSe};var nSe=Oa+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,aSe=bt({opSnippet:nSe}),iSe={kernelName:k.Acos,backendName:"webgl",kernelFunc:aSe};var oSe=Oa+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,sSe=bt({opSnippet:oSe}),uSe={kernelName:k.Acosh,backendName:"webgl",kernelFunc:sSe};var E3="return a + b;",cSe=Yr({opSnippet:E3,packedOpSnippet:E3,supportsComplex:!0,cpuKernelImpl:gke}),lSe={kernelName:k.Add,backendName:"webgl",kernelFunc:cSe};var fSe=(function(){function r(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map(function(i,o){return"T".concat(o)});var n=[];this.variableNames.forEach(function(i){n.push("float v".concat(i," = get").concat(i,"AtOutCoords();"))});var a=this.variableNames.map(function(i){return"v".concat(i)}).join(" + ");this.userCode=`
      void main() {
        `.concat(n.join(`
        `),`

        float result = `).concat(a,`;
        setOutput(result);
      }
    `)}return r})();var hSe=(function(){function r(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map(function(i,o){return"T".concat(o)});var n=[];this.variableNames.forEach(function(i){n.push("vec4 v".concat(i," = get").concat(i,"AtOutCoords();"))});var a=this.variableNames.map(function(i){return"v".concat(i)}).join(" + ");this.userCode=`
      void main() {
        `.concat(n.join(`
        `),`

        vec4 result = `).concat(a,`;
        setOutput(result);
      }
    `)}return r})();function rd(r){var e=r.inputs,t=r.backend,n=e;if(n.length===1)return Kn({inputs:{x:n[0]},backend:t});if(n.length>k.env().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var a=Math.floor(n.length/2),i=rd({inputs:n.slice(0,a),backend:t}),o=rd({inputs:n.slice(a),backend:t});return rd({inputs:[i,o],backend:t})}var s=n.map(function(f){return f.dtype}).reduce(function(f,h){return k.upcastType(f,h)}),u=n.map(function(f){return f.shape}),c=k.env().getBool("WEBGL_PACK"),l=c?new hSe(n[0].shape,u):new fSe(n[0].shape,u);return t.runWebGLProgram(l,n,s)}var pSe={kernelName:k.AddN,backendName:"webgl",kernelFunc:rd};function dSe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims,s=a.shape.length,u=k.util.parseAxisParam(i,a.shape),c=u,l=k.backend_util.getAxesPermutation(c,s),f=a;l!=null&&(f=fn({inputs:{x:a},backend:t,attrs:{perm:l}}),c=k.backend_util.getInnerMostAxes(c.length,s)),k.backend_util.assertAxesAreInnerMostDims("all",c,s);var h=Ee(k.backend_util.computeOutAndReduceShapes(f.shape,c),2),p=h[0],d=h[1],m=k.util.sizeFromShape(d),v=Ce({inputs:{x:f},backend:t,attrs:{shape:[-1,m]}}),g=Ls(v,v.dtype,"all",t),y;if(o){var w=k.backend_util.expandShapeToKeepDim(p,u);y=Ce({inputs:{x:g},backend:t,attrs:{shape:w}})}else y=Ce({inputs:{x:g},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(g),l!=null&&t.disposeIntermediateTensorInfo(f),y}var vSe={kernelName:k.All,backendName:"webgl",kernelFunc:dSe};function mSe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims,s=a.shape.length,u=k.util.parseAxisParam(i,a.shape),c=u,l=k.backend_util.getAxesPermutation(c,s),f=a;l!=null&&(f=fn({inputs:{x:a},backend:t,attrs:{perm:l}}),c=k.backend_util.getInnerMostAxes(c.length,s)),k.backend_util.assertAxesAreInnerMostDims("any",c,s);var h=Ee(k.backend_util.computeOutAndReduceShapes(f.shape,c),2),p=h[0],d=h[1],m=k.util.sizeFromShape(d),v=Ce({inputs:{x:f},backend:t,attrs:{shape:[-1,m]}}),g=Ls(v,v.dtype,"any",t),y;if(o){var w=k.backend_util.expandShapeToKeepDim(p,u);y=Ce({inputs:{x:g},backend:t,attrs:{shape:w}})}else y=Ce({inputs:{x:g},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(g),l!=null&&t.disposeIntermediateTensorInfo(f),y}var gSe={kernelName:k.Any,backendName:"webgl",kernelFunc:mSe};var ySe=(function(){function r(e,t,n){this.variableNames=["A"];var a=e.windowSize,i=e.batchSize,o=e.outSize;n||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o];var s=t==="max"?">":"<",u=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `.concat(a,`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `).concat(a,`; i++) {
          int inIdx = `).concat(u,`;
          float candidate = getA(batch, inIdx);
          if (candidate `).concat(s,` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `)}return r})();var bSe=(function(){function r(e,t,n,a){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,k.util.assert(e.length>2,function(){return"Packed arg".concat(n.charAt(0).toUpperCase()+n.slice(1)," supports only inputs with rank above 2.")});var i=e[e.length-1],o=Math.ceil(i/t);this.outputShape=e.slice(0,-1),o>1&&this.outputShape.push(o),a||this.variableNames.push("bestIndicesA");var s=this.outputShape,u=s.length,c=Ft(u),l=cn("coords",u),f,h;if(o===1){h=u+1;var p=Ft(h);f=`
        `.concat(p," sourceLocR = ").concat(p,"(").concat(l.join(),`, 0);
        ++`).concat(l[u-1],`;
        `).concat(p," sourceLocG = ").concat(p,"(").concat(l.join(),`, 0);
        ++`).concat(l[u-2],`;
        `).concat(p," sourceLocA = ").concat(p,"(").concat(l.join(),`, 0);
        --`).concat(l[u-1],`;
        `).concat(p," sourceLocB = ").concat(p,"(").concat(l.join(),`, 0);
        --`).concat(l[u-2],";")}else h=u,f=`
        `.concat(c,` sourceLocR = coords;
        ++`).concat(l[u-1],`;
        `).concat(c,` sourceLocG = coords;
        ++`).concat(l[u-2],`;
        `).concat(c,` sourceLocA = coords;
        --`).concat(l[u-1],`;
        `).concat(c,` sourceLocB = coords;
        --`).concat(l[u-2],";");var d=["x","y","z","w","u","v"].slice(0,h),m="."+d[h-1],v=d.map(function(C){return"int "+C}),g=cn("sourceLocR",h-1).concat("inIdx.r"),y=cn("sourceLocG",h-1).concat("inIdx.g"),w=cn("sourceLocB",h-1).concat("inIdx.b"),b=cn("sourceLocA",h-1).concat("inIdx.a"),x=n==="max"?"greaterThan":"lessThan",S=a?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`.concat(g.join(),`),
                             getBestIndicesAChannel(`).concat(y.join(),`),
                             getBestIndicesAChannel(`).concat(w.join(),`),
                             getBestIndicesAChannel(`).concat(b.join(),")));"),T=`vec4(
            getAChannel(`.concat(g.join(),`),
            hasNextCol ? getAChannel(`).concat(y.join(),`) : 0.,
            hasNextRow ? getAChannel(`).concat(w.join(),`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`).concat(b.join(),") : 0.)"),N=a?"":`
      float getBestIndicesAChannel(`.concat(v.join(),`) {
        return getChannel(getBestIndicesA(`).concat(d.join(),`),
                                          vec2(`).concat(d.slice(-2).join(),`));
      }`);this.userCode=`
      float getAChannel(`.concat(v.join(),`) {
        return getChannel(getA(`).concat(d.join(),`),
                               vec2(`).concat(d.slice(-2).join(),`));
      }
      `).concat(N,`
      void main() {
        `).concat(c,` coords = getOutputCoords();
        bool hasNextCol = `).concat(l[u-1]," < ").concat(s[u-1]-1,`;
        bool hasNextRow = `).concat(l[u-2]," < ").concat(s[u-2]-1,`;
        `).concat(f,`
        ivec4 srcIdx = ivec4(sourceLocR`).concat(m,", sourceLocG").concat(m,`,
          sourceLocB`).concat(m,", sourceLocA").concat(m,") * ").concat(t,`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `).concat(T,`;

        for (int i = 0; i < `).concat(t,`; i++) {
          inIdx = srcIdx;
          `).concat(S,`
          vec4 candidate = `).concat(T,`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`).concat(x,`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `)}return r})();function HF(r,e,t,n){n===void 0&&(n=null);var a=e.shape[0],i=e.shape[1];n!=null&&(a=n.shape[0],i=n.shape[1]);var o=k.backend_util.computeOptimalWindowSize(i),s={windowSize:o,inSize:i,batchSize:a,outSize:Math.ceil(i/o)},u=new ySe(s,t,n==null),c=[e];n!=null&&c.push(n);var l=r.runWebGLProgram(u,c,"int32");if(l.shape[1]===1)return l;var f=HF(r,e,t,l);return r.disposeIntermediateTensorInfo(l),f}function qF(r,e,t,n){n===void 0&&(n=null);var a=n!=null?n.shape:e.shape,i=a[a.length-1],o=k.backend_util.computeOptimalWindowSize(i),s=new bSe(a,o,t,n==null),u=n==null?[e]:[e,n],c=r.runWebGLProgram(s,u,"int32");if(c.shape.length===e.shape.length){var l=qF(r,e,t,c);return r.disposeIntermediateTensorInfo(c),l}return c}function KF(r,e,t,n){var a=[t];if(k.backend_util.assertAxesAreInnerMostDims("arg"+n.charAt(0).toUpperCase()+n.slice(1),a,e.shape.length),!k.env().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){var i=[],o=r.texData.get(e.dataId),s=o!==null&&o.isPacked,u=e;s&&(u=r.unpackTensor(e),i.push(u));var c=Ee(k.backend_util.computeOutAndReduceShapes(u.shape,a),2),l=c[0],f=c[1],h=k.util.sizeFromShape(f),p=Ce({inputs:{x:u},backend:r,attrs:{shape:[-1,h]}});i.push(p);var d=HF(r,p,n);i.push(d);var m=Ce({inputs:{x:d},backend:r,attrs:{shape:l}});return i.forEach(function(v){return r.disposeIntermediateTensorInfo(v)}),m}return qF(r,e,n)}function wSe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=k.util.parseAxisParam(i,a.shape),s=k.backend_util.getAxesPermutation(o,a.shape.length),u=a,c=[];s!=null&&(u=fn({inputs:{x:a},backend:t,attrs:{perm:s}}),c.push(u),o=k.backend_util.getInnerMostAxes(o.length,u.shape.length)),k.backend_util.assertAxesAreInnerMostDims("argMax",[o[0]],u.shape.length);var l=KF(t,u,o[0],"max");return c.forEach(function(f){return t.disposeIntermediateTensorInfo(f)}),l}var xSe={kernelName:k.ArgMax,backendName:"webgl",kernelFunc:wSe};function kSe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=k.util.parseAxisParam(i,a.shape),s=k.backend_util.getAxesPermutation(o,a.shape.length),u=a,c=[];s!=null&&(u=fn({inputs:{x:a},backend:t,attrs:{perm:s}}),c.push(u),o=k.backend_util.getInnerMostAxes(o.length,u.shape.length)),k.backend_util.assertAxesAreInnerMostDims("argMin",[o[0]],u.shape.length);var l=KF(t,u,o[0],"min");return c.forEach(function(f){return t.disposeIntermediateTensorInfo(f)}),l}var SSe={kernelName:k.ArgMin,backendName:"webgl",kernelFunc:kSe};var ESe=Oa+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,TSe=bt({opSnippet:ESe}),NSe={kernelName:k.Asin,backendName:"webgl",kernelFunc:TSe};var ISe=Oa+"return log(x + sqrt(x * x + 1.0));",CSe=bt({opSnippet:ISe}),ASe={kernelName:k.Asinh,backendName:"webgl",kernelFunc:CSe};var DSe=Oa+`
  return atan(x);
`,_Se=bt({opSnippet:DSe}),FSe={kernelName:k.Atan,backendName:"webgl",kernelFunc:_Se};var RSe=Tb+`
  return atan(a, b);
`,OSe=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Bs+`
  return result;
`,PSe=Yr({opSnippet:RSe,packedOpSnippet:OSe}),MSe={kernelName:k.Atan2,backendName:"webgl",kernelFunc:PSe};var BSe=Oa+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,LSe=bt({opSnippet:BSe}),zSe={kernelName:k.Atanh,backendName:"webgl",kernelFunc:LSe};var Yl=(function(){function r(e,t,n,a,i){if(a===void 0&&(a=!1),i===void 0&&(i=!1),this.variableNames=["x"],t==="avg"&&n)throw new Error("Cannot compute positions for average pool.");var o=e.filterWidth,s=e.strideHeight,u=e.strideWidth,c=e.dilationHeight,l=e.dilationWidth,f=e.effectiveFilterHeight,h=e.effectiveFilterWidth,p=e.padInfo.top,d=e.padInfo.left;this.outputShape=e.outShape;var m=t==="avg",v="((batch  * ".concat(e.inHeight," + xR) * ").concat(e.inWidth," + xC) * ").concat(e.inChannels," + d"),g="(xR * ".concat(e.inWidth," + xC) * ").concat(e.inChannels," + d"),y="0.0";if(m||(y="-1.0 / 1e-20"),n){var w=">=";this.userCode=`
        const ivec2 strides = ivec2(`.concat(s,", ").concat(u,`);
        const ivec2 pads = ivec2(`).concat(p,", ").concat(d,`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `).concat(f,`;
              wR += `).concat(c,`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `).concat(e.inHeight,`) {
              continue;
            }

            for (int wC = 0; wC < `).concat(h,`;
                wC += `).concat(l,`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `).concat(e.inWidth,`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value `).concat(w,` currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = `).concat(a?i?v:g:"wR * ".concat(h," + wC"),`;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `);return}var b="max",x="".concat(t,"(").concat(t,"(").concat(t,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="avg"&&(x="avgValue / max(count, 1.0)");var S=Math.floor(o/4)*4,T=o%4,N=`
      if (`.concat(m,`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = `).concat(b,`(values, minMaxValue);
      }
    `);this.userCode=`
      const ivec2 strides = ivec2(`.concat(s,", ").concat(u,`);
      const ivec2 pads = ivec2(`).concat(p,", ").concat(d,`);
      const float initializationValue = `).concat(y,`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `).concat(e.inWidth,`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`).concat(y,`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `).concat(f,`;
            wR += `).concat(c,`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `).concat(e.inHeight,`) {
            continue;
          }

          for (int wC = 0; wC < `).concat(S,`; wC += 4) {
            int xC = xCCorner + wC * `).concat(l,`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `).concat(l,`, d),
              getValue(batch, xR, xC + 2 * `).concat(l,`, d),
              getValue(batch, xR, xC + 3 * `).concat(l,`, d)
            );

            `).concat(N,`
          }

          int xC = xCCorner + `).concat(S,`;
          if (`).concat(T===1,`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `).concat(N,`
          } else if (`).concat(T===2,`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `).concat(l,`, d),
              initializationValue,
              initializationValue
            );

            `).concat(N,`
          } else if (`).concat(T===3,`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `).concat(l,`, d),
              getValue(batch, xR, xC + 2 * `).concat(l,`, d),
              initializationValue
            );

            `).concat(N,`
          }
        }
        setOutput(`).concat(x,`);
      }
    `)}return r})(),Ib=(function(){function r(e,t,n,a,i){if(a===void 0&&(a=!1),i===void 0&&(i=!1),this.variableNames=["x"],t==="avg"&&n)throw new Error("Cannot compute positions for average pool.");var o=e.filterWidth,s=e.strideDepth,u=e.strideHeight,c=e.strideWidth,l=e.dilationDepth,f=e.dilationHeight,h=e.dilationWidth,p=e.effectiveFilterDepth,d=e.effectiveFilterHeight,m=e.effectiveFilterWidth,v=e.padInfo.front,g=e.padInfo.top,y=e.padInfo.left;this.outputShape=e.outShape;var w=t==="avg",b="0.0";if(w||(b="-1.0 / 1e-20"),n){var x=">=";this.userCode=`
        const ivec3 strides =
            ivec3(`.concat(s,", ").concat(u,", ").concat(c,`);
        const ivec3 pads = ivec3(`).concat(v,", ").concat(g,", ").concat(y,`);

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < `).concat(p,`;
              wD += `).concat(l,`) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= `).concat(e.inDepth,`) {
              continue;
            }

            for (int wR = 0; wR < `).concat(d,`;
                wR += `).concat(f,`) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= `).concat(e.inHeight,`) {
                continue;
              }

              for (int wC = 0; wC < `).concat(m,`;
                  wC += `).concat(h,`) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= `).concat(e.inWidth,`) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value `).concat(x,` currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = `).concat(a?i?"(((batch * ".concat(e.inDepth," + xD) * ").concat(e.inHeight," + xR) * ").concat(e.inWidth," + xC) * ").concat(e.inChannels," + ch"):"((xD * ".concat(e.inHeight," + xR) * ").concat(e.inWidth," + xC) * ").concat(e.inChannels," + ch"):"wD * ".concat(d," * ").concat(m,` +
                      wR * `).concat(m," + wC"),`;
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `);return}var S="max",T="".concat(t,"(").concat(t,"(").concat(t,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="avg"&&(T="avgValue / max(count, 1.0)");var N=Math.floor(o/4)*4,C=o%4,R=`
      if (`.concat(w,`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = `).concat(S,`(values, minMaxValue);
      }
    `);this.userCode=`
      const ivec3 strides =
        ivec3(`.concat(s,", ").concat(u,", ").concat(c,`);
      const ivec3 pads = ivec3(`).concat(v,", ").concat(g,", ").concat(y,`);
      const float initializationValue = `).concat(b,`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= `).concat(e.inWidth,`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(`).concat(b,`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < `).concat(p,`;
            wD += `).concat(l,`) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= `).concat(e.inDepth,`) {
            continue;
          }

          for (int wR = 0; wR < `).concat(d,`;
            wR += `).concat(f,`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `).concat(e.inHeight,`) {
              continue;
            }

            for (int wC = 0; wC < `).concat(N,`; wC += 4) {
              int xC = xCCorner + wC * `).concat(h,`;

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `).concat(h,`, ch),
                getValue(batch, xD, xR, xC + 2 * `).concat(h,`, ch),
                getValue(batch, xD, xR, xC + 3 * `).concat(h,`, ch)
              );

              `).concat(R,`
            }

            int xC = xCCorner + `).concat(N,`;
            if (`).concat(C===1,`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              `).concat(R,`
            } else if (`).concat(C===2,`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `).concat(h,`, ch),
                initializationValue,
                initializationValue
              );

              `).concat(R,`
            } else if (`).concat(C===3,`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `).concat(h,`, ch),
                getValue(batch, xD, xR, xC + 2 * `).concat(h,`, ch),
                initializationValue
              );

              `).concat(R,`
            }
          }
        }
        setOutput(`).concat(T,`);
      }
    `)}return r})();function $Se(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x;Ku(a,"avgPool");var i=n.filterSize,o=n.strides,s=n.pad,u=n.dimRoundingMode,c=1;k.util.assert(k.backend_util.eitherStridesOrDilationsAreOne(o,c),function(){return"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(c,"'")});var l=k.backend_util.computePool2DInfo(a.shape,i,o,c,s,u);if(l.filterWidth===1&&l.filterHeight===1&&k.util.arraysEqual(l.inShape,l.outShape))return Kn({inputs:{x:a},backend:t});var f=new Yl(l,"avg",!1);return t.runWebGLProgram(f,[a],"float32")}var WSe={kernelName:k.AvgPool,backendName:"webgl",kernelFunc:$Se};function GSe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.filterSize,o=n.strides,s=n.pad,u=n.dimRoundingMode,c=n.dataFormat,l=[1,1,1],f=k.backend_util.computePool3DInfo(a.shape,i,o,l,s,u,c),h=new Ib(f,"avg",!1);return t.runWebGLProgram(h,[a],"float32")}var VSe={kernelName:k.AvgPool3D,backendName:"webgl",kernelFunc:GSe};var USe=(function(){function r(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,a=e.strideHeight,i=e.strideWidth,o=e.dilationHeight,s=e.dilationWidth,u=e.effectiveFilterHeight,c=e.effectiveFilterWidth,l=u-1-e.padInfo.top,f=c-1-e.padInfo.left,h=1/(t*n);this.userCode=`
      const ivec2 pads = ivec2(`.concat(l,", ").concat(f,`);
      const float avgMultiplier = float(`).concat(h,`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `).concat(u,`;
            wR += `).concat(o,`) {
          float dyR = float(dyRCorner + wR) / `).concat(a,`.0;

          if (dyR < 0.0 || dyR >= `).concat(e.outHeight,`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `).concat(c,`;
            wC+= `).concat(s,`) {
            float dyC = float(dyCCorner + wC) / `).concat(i,`.0;

            if (dyC < 0.0 || dyC >= `).concat(e.outWidth,`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `)}return r})(),HSe=(function(){function r(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,a=e.filterWidth,i=e.strideDepth,o=e.strideHeight,s=e.strideWidth,u=e.dilationDepth,c=e.dilationHeight,l=e.dilationWidth,f=e.effectiveFilterDepth,h=e.effectiveFilterHeight,p=e.effectiveFilterWidth,d=f-1-e.padInfo.front,m=h-1-e.padInfo.top,v=p-1-e.padInfo.left,g=1/(t*n*a);this.userCode=`
      const ivec3 pads = ivec3(`.concat(d,", ").concat(m,", ").concat(v,`);
      const float avgMultiplier = float(`).concat(g,`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `).concat(f,`;
            wD += `).concat(u,`) {
          float dyD = float(dyDCorner + wD) / `).concat(i,`.0;

          if (dyD < 0.0 || dyD >= `).concat(e.outDepth,`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `).concat(h,`;
              wR += `).concat(c,`) {
            float dyR = float(dyRCorner + wR) / `).concat(o,`.0;

            if (dyR < 0.0 || dyR >= `).concat(e.outHeight,`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `).concat(p,`;
                wC += `).concat(l,`) {
              float dyC = float(dyCCorner + wC) / `).concat(s,`.0;

              if (dyC < 0.0 || dyC >= `).concat(e.outWidth,`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `)}return r})();function qSe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.input,o=i,s=n.filterSize,u=n.strides,c=n.pad,l=n.dimRoundingMode,f=[1,1,1],h=k.backend_util.computePool3DInfo(o.shape,s,u,f,c,l),p=new HSe(h);return t.runWebGLProgram(p,[a],o.dtype)}var KSe={kernelName:k.AvgPool3DGrad,backendName:"webgl",kernelFunc:qSe};function jSe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.input,o=i;Ku([a,i],"avgPoolGrad");var s=n.filterSize,u=n.strides,c=n.pad,l=k.backend_util.computePool2DInfo(o.shape,s,u,1,c),f=new USe(l);return t.runWebGLProgram(f,[a],o.dtype)}var XSe={kernelName:k.AvgPoolGrad,backendName:"webgl",kernelFunc:jSe};function YSe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.a,i=e.b,o=n.transposeA,s=n.transposeB;return nd({a,b:i,transposeA:o,transposeB:s,backend:t})}var ZSe={kernelName:k.BatchMatMul,backendName:"webgl",kernelFunc:YSe};var JSe=(function(){function r(e,t,n,a,i,o){this.outputShape=[],this.variableNames=["x","mean","variance"],k.backend_util.assertAndGetBroadcastShape(e,t),k.backend_util.assertAndGetBroadcastShape(e,n);var s="0.0";a!=null&&(k.backend_util.assertAndGetBroadcastShape(e,a),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="1.0";i!=null&&(k.backend_util.assertAndGetBroadcastShape(e,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `.concat(s,`;
        float scale = `).concat(u,`;
        float inv = scale * inversesqrt(variance + float(`).concat(o,`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `)}return r})();var QSe=(function(){function r(e,t,n,a,i,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],k.backend_util.assertAndGetBroadcastShape(e,t),k.backend_util.assertAndGetBroadcastShape(e,n);var s="vec4(0.0)";a!=null&&(k.backend_util.assertAndGetBroadcastShape(e,a),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="vec4(1.0)";i!=null&&(k.backend_util.assertAndGetBroadcastShape(e,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = `.concat(s,`;
        vec4 scale = `).concat(u,`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`).concat(o,`));

        setOutput((x - mean) * inv + offset);
      }
    `)}return r})();var eEe=function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.mean,o=e.variance,s=e.offset,u=e.scale;k.util.assert(i.shape.length===o.shape.length,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),k.util.assert(s==null||i.shape.length===s.shape.length,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),k.util.assert(u==null||i.shape.length===u.shape.length,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."});var c=n.varianceEpsilon;c==null&&(c=.001);var l=[a,i,o],f=null;s!=null&&(f=s.shape,l.push(s));var h=null;u!=null&&(h=u.shape,l.push(u));var p=k.env().getBool("WEBGL_PACK_NORMALIZATION")?new QSe(a.shape,i.shape,o.shape,f,h,c):new JSe(a.shape,i.shape,o.shape,f,h,c),d=t.runWebGLProgram(p,l,l[0].dtype);return d},tEe={kernelName:k.FusedBatchNorm,backendName:"webgl",kernelFunc:eEe};var rEe=(function(){function r(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var t=Ft(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];var n=nEe(this.rank),a,i=e.map(function(o,s){return"sourceLoc.".concat(lb[s]," = start[").concat(s,"] + coords.").concat(lb[s],";")});a=`
        `.concat(t,` sourceLoc;
        `).concat(t,` coords = getOutputCoords();
        `).concat(i.join(`
`),`
      `),this.userCode=`
      void main() {
        `.concat(a,`
        setOutput(getSource(`).concat(n,`));
      }
    `)}return r})(),lb=["x","y","z","w","u","v"];function nEe(r){if(r===1)return"sourceLoc";if(r<=6)return lb.slice(0,r).map(function(e){return"sourceLoc."+e}).join(",");throw Error("Slicing for rank ".concat(r," is not yet supported"))}var aEe=(function(){function r(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];var t=Ft(this.rank),n=cn("coords",this.rank),a=cn("sourceLoc",this.rank),i=this.rank===1?"sourceLoc":"vec2(".concat(a.slice(-2).join(),")"),o="getChannel(getSource(".concat(a.join(),"), ").concat(i,")"),s=`
      result.x = `.concat(o,`;
      if (++`).concat(n[this.rank-1]," < ").concat(e[this.rank-1],`) {
        ++`).concat(a[this.rank-1],`;
        result.y = `).concat(o,`;
        --`).concat(a[this.rank-1],`;
      }
    `),u=this.rank===1?"":`
      --`.concat(n[this.rank-1],`;
      if (++`).concat(n[this.rank-2]," < ").concat(e[this.rank-2],`) {
        ++`).concat(a[this.rank-2],`;
        result.z = `).concat(o,`;
        if (++`).concat(n[this.rank-1]," < ").concat(e[this.rank-1],`) {
          ++`).concat(a[this.rank-1],`;
          result.w = `).concat(o,`;
        }
      }
    `),c=this.rank<=4?`sourceLoc = coords +
            `.concat(t,"(").concat(e.map(function(l,f){return"start[".concat(f,"]")}).join(),");"):e.map(function(l,f){return"".concat(a[f]," = ").concat(n[f]," + start[").concat(f,"];")}).join(`
`);this.userCode=`
      void main() {
        `.concat(t,` coords = getOutputCoords();
        `).concat(t,` sourceLoc;
        `).concat(c,`
        vec4 result = vec4(0.);
        `).concat(s,`
        `).concat(u,`
        setOutput(result);
      }
    `)}return r})();function iEe(r,e,t,n){var a=n.texData.get(r.dataId),i=n.makeTensorInfo(t,r.dtype),o=n.texData.get(i.dataId);Object.assign(o,a),o.refCount=1,o.shape=t,o.dtype=r.dtype;var s=k.slice_util.computeFlatOffset(e,k.util.computeStrides(r.shape));a.slice&&(s+=a.slice.flatOffset),o.slice={flatOffset:s,origDataId:a.slice&&a.slice.origDataId||r.dataId};var u=n.dataRefCount.get(o.slice.origDataId)||1;return n.dataRefCount.set(o.slice.origDataId,u+1),i}function ec(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.begin,o=n.size,s=Ee(k.slice_util.parseSliceParams(a,i,o),2),u=s[0],c=s[1];if(k.slice_util.assertParamsValid(a,u,c),k.util.sizeFromShape(c)===0)return t.makeTensorInfo(c,a.dtype,[]);if(t.shouldExecuteOnCPU([a])||a.dtype==="string"){var l=t.texData.get(a.dataId),f=Xke(l.values,u,c,a.shape,a.dtype);return t.makeTensorInfo(c,a.dtype,f)}var h=t.texData.get(a.dataId).isPacked,p=k.slice_util.isSliceContinous(a.shape,u,c);if(h||!p){var d=k.env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new aEe(c):new rEe(c),m=[u];return t.runWebGLProgram(d,[a],a.dtype,m)}return t.uploadToGPU(a.dataId),iEe(a,u,c,t)}var oEe={kernelName:k.Slice,backendName:"webgl",kernelFunc:ec};var sEe=function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.blockShape,o=n.crops;k.util.assert(a.shape.length<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var s=i.reduce(function(y,w){return y*w}),u=k.backend_util.getReshaped(a.shape,i,s),c=k.backend_util.getPermuted(u.length,i.length),l=k.backend_util.getReshapedPermuted(a.shape,i,s),f=k.backend_util.getSliceBeginCoords(o,i.length),h=k.backend_util.getSliceSize(l,o,i.length),p=[],d=Ce({inputs:{x:a},backend:t,attrs:{shape:u}}),m=fn({inputs:{x:d},backend:t,attrs:{perm:c}}),v=Ce({inputs:{x:m},backend:t,attrs:{shape:l}}),g=ec({inputs:{x:v},backend:t,attrs:{begin:f,size:h}});return p.push(d),p.push(m),p.push(v),p.forEach(function(y){return t.disposeIntermediateTensorInfo(y)}),g},uEe={kernelName:k.BatchToSpaceND,backendName:"webgl",kernelFunc:sEe};function cEe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.weights,o=n.size,s=t.readSync(a.dataId),u=t.readSync(i.dataId),c=RF(s,u,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,c)}var lEe={kernelName:k.Bincount,backendName:"webgl",kernelFunc:cEe},fEe=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,hEe=`
  return float(int(a.r) & int(b.r));
`;function pEe(r){var e=r.inputs,t=r.backend,n=e.a,a=e.b,i=k.env().getBool("WEBGL_PACK_BINARY_OPERATIONS"),o=k.env().getNumber("WEBGL_VERSION");if(t.shouldExecuteOnCPU([n,a])||o===1){var s=t.texData.get(n.dataId).values,u=t.texData.get(a.dataId).values,c=Ee(bke(n.shape,a.shape,s,u,n.dtype),2),l=c[0],f=c[1],h=t.makeTensorInfo(f,n.dtype),p=t.texData.get(h.dataId);return p.values=l,h}var d;return i?d=new Ju(fEe,n.shape,a.shape,!1):d=new Os(hEe,n.shape,a.shape),t.runWebGLProgram(d,[n,a],n.dtype)}var dEe={kernelName:k.BitwiseAnd,backendName:"webgl",kernelFunc:pEe};function vEe(r){var e=r.inputs,t=r.backend,n=e.s0,a=e.s1,i=t.readSync(n.dataId),o=t.readSync(a.dataId),s=k.backend_util.assertAndGetBroadcastShape(Array.from(i),Array.from(o));return t.makeTensorInfo([s.length],"int32",Int32Array.from(s))}var mEe={kernelName:k.BroadcastArgs,backendName:"webgl",kernelFunc:vEe};var gEe="return float(a != b);",jF=Yr({opSnippet:gEe,cpuKernelImpl:$ke,dtype:"bool"}),yEe={kernelName:k.NotEqual,backendName:"webgl",kernelFunc:jF};function ef(r){var e=r.inputs,t=r.backend,n=e.input,a=t.texData.get(n.dataId);return Kn({inputs:{x:a.complexTensorInfos.real},backend:t})}var bEe={kernelName:k.Real,backendName:"webgl",kernelFunc:ef};var wEe="return float(int(x));";function xEe(r,e){var t=new yi(r.shape,wEe),n=e.runWebGLProgram(t,[r],"int32");return{dataId:n.dataId,shape:n.shape,dtype:n.dtype}}function fb(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.dtype;if(i==="complex64"){if(a.dtype==="complex64")return Kn({inputs:{x:a},backend:t});var o=r1e.zeros(a.shape),s=fb({inputs:{x:a},backend:t,attrs:{dtype:"float32"}}),u=Io({inputs:{real:s,imag:o},backend:t});return o.dispose(),t.disposeIntermediateTensorInfo(s),u}if(a.dtype==="complex64"){var c=ef({inputs:{input:a},backend:t}),u=fb({inputs:{x:c},backend:t,attrs:{dtype:i}});return t.disposeIntermediateTensorInfo(c),u}if(!k.util.hasEncodingLoss(a.dtype,i)){var u=Kn({inputs:{x:a},backend:t});return{dataId:u.dataId,shape:u.shape,dtype:i}}if(t.shouldExecuteOnCPU([a])){var l=t.texData.get(a.dataId).values,f=Ee(wke(l,a.shape,a.dtype,i),3),h=f[0],p=f[1],d=f[2];return t.makeTensorInfo(h,p,d)}if(i==="int32")return xEe(a,t);if(i==="bool"){var m=t.makeTensorInfo([],"bool",k.util.getTypedArrayFromDType("bool",1)),v={a,b:m},u=jF({inputs:v,backend:t});return t.disposeIntermediateTensorInfo(m),u}throw new Error("Error in Cast: failed to cast ".concat(a.dtype," to ").concat(i))}var kEe={kernelName:k.Cast,backendName:"webgl",kernelFunc:fb};var T3="return ceil(x);",SEe=bt({opSnippet:T3,packedOpSnippet:T3,cpuKernelImpl:xke}),EEe={kernelName:k.Ceil,backendName:"webgl",kernelFunc:SEe};var TEe=(function(){function r(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}return r})();var NEe=(function(){function r(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}return r})();function IEe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.clipValueMin,o=n.clipValueMax,s;k.env().getBool("WEBGL_PACK_CLIP")?s=new NEe(a.shape):s=new TEe(a.shape);var u=[[i],[o]];return t.runWebGLProgram(s,[a],a.dtype,u)}var CEe={kernelName:k.ClipByValue,backendName:"webgl",kernelFunc:IEe};var AEe=(function(){function r(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}return r})();function N3(r,e){return{dataId:e.dataId,dtype:e.dtype,shape:r.shape}}function DEe(r){var e=r.inputs,t=r.backend,n=e.x,a=t.texData.get(n.dataId),i=new AEe(n.shape),o=[N3(n,a.complexTensorInfos.real),N3(n,a.complexTensorInfos.imag)];return t.runWebGLProgram(i,o,o[0].dtype)}var _Ee={kernelName:k.ComplexAbs,backendName:"webgl",kernelFunc:DEe};var FEe=(function(){function r(e){this.outputShape=[],this.outputShape=k.backend_util.computeOutShape(e,1),this.variableNames=e.map(function(u,c){return"T".concat(c)});var t=new Array(e.length-1);t[0]=e[0][1];for(var n=1;n<t.length;n++)t[n]=t[n-1]+e[n][1];for(var a=["if (yC < ".concat(t[0],") setOutput(getT0(yR, yC));")],n=1;n<t.length;n++){var i=t[n-1];a.push("else if (yC < ".concat(t[n],") ")+"setOutput(getT".concat(n,"(yR, yC-").concat(i,"));"))}var o=t.length,s=t[t.length-1];a.push("else setOutput(getT".concat(o,"(yR, yC-").concat(s,"));")),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `.concat(a.join(`
        `),`
      }
    `)}return r})();var REe=(function(){function r(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=k.backend_util.computeOutShape(e,t);var n=this.outputShape,a=n.length,i=Ft(a),o=cn("coords",a),s=["x","y","z","w","u","v"].slice(0,a);this.variableNames=e.map(function(g,y){return"T".concat(y)});var u=new Array(e.length-1);u[0]=e[0][t];for(var c=1;c<u.length;c++)u[c]=u[c-1]+e[c][t];for(var l=s[t],f=s.slice(-2),h=s.join(),p="if (".concat(l," < ").concat(u[0],`) {
        return getChannel(
            getT0(`).concat(h,"), vec2(").concat(f.join(),`));
        }`),c=1;c<u.length;c++){var d=u[c-1];p+=`
        if (`.concat(l," < ").concat(u[c],"  && ").concat(l," >= ").concat(u[c-1],`) {
          return getChannel(
            getT`).concat(c,"(").concat(Yp(s,l,d),`),
            vec2(`).concat(Yp(f,l,d),`));
        }`)}var m=u.length,v=u[u.length-1];p+=`
        return getChannel(
          getT`.concat(m,"(").concat(Yp(s,l,v),`),
          vec2(`).concat(Yp(f,l,v),"));"),this.userCode=`
      float getValue(`.concat(s.map(function(g){return"int "+g}),`) {
        `).concat(p,`
      }

      void main() {
        `).concat(i,` coords = getOutputCoords();
        vec4 result = vec4(getValue(`).concat(o,`), 0., 0., 0.);

        `).concat(o[a-1]," = ").concat(o[a-1],` + 1;
        if (`).concat(o[a-1]," < ").concat(n[a-1],`) {
          result.g = getValue(`).concat(o,`);
        }

        `).concat(o[a-2]," = ").concat(o[a-2],` + 1;
        if (`).concat(o[a-2]," < ").concat(n[a-2],`) {
          result.a = getValue(`).concat(o,`);
        }

        `).concat(o[a-1]," = ").concat(o[a-1],` - 1;
        if (`).concat(o[a-2]," < ").concat(n[a-2],` &&
            `).concat(o[a-1]," < ").concat(n[a-1],`) {
          result.b = getValue(`).concat(o,`);
        }
        setOutput(result);
      }
    `)}return r})();function Yp(r,e,t){var n=r.indexOf(e),a=r.map(function(i,o){return o===n?"".concat(i," - ").concat(t):i});return a.join()}function cd(r){var e=r.inputs,t=r.backend,n=e.input,a=t.texData.get(n.dataId);return Kn({inputs:{x:a.complexTensorInfos.imag},backend:t})}var OEe={kernelName:k.Imag,backendName:"webgl",kernelFunc:cd};function ql(r,e,t){var n,a,i=r[0].dtype;if(i==="complex64"){var o=r.map(function(V){return ef({inputs:{input:V},backend:t})}),s=r.map(function(V){return cd({inputs:{input:V},backend:t})}),u=ql(o,e,t),c=ql(s,e,t),l=Io({inputs:{real:u,imag:c},backend:t});return o.forEach(function(V){return t.disposeIntermediateTensorInfo(V)}),s.forEach(function(V){return t.disposeIntermediateTensorInfo(V)}),t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(c),l}var f=t.shouldExecuteOnCPU(r);if(i==="string"&&(f=!0),f){var h=r.map(function(V){var j=k.util.sizeFromShape(V.shape.slice(e)),re=[-1,j];return Ce({inputs:{x:V},backend:t,attrs:{shape:re}})}),p=h.map(function(V){return{vals:t.readSync(V.dataId),shape:V.shape}}),d=k.backend_util.computeOutShape(h.map(function(V){return V.shape}),1),m=h[0].shape[0]===1,v=kke(p,d,i,m),g=k.backend_util.computeOutShape(r.map(function(V){return V.shape}),e),y=t.makeTensorInfo(g,i,v);return h.forEach(function(V){return t.disposeIntermediateTensorInfo(V)}),y}var w=r.filter(function(V){return k.util.sizeFromShape(V.shape)>0}),b=k.env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&w[0].shape.length>1;if(w.length===1){var x=b?new yi(r[0].shape,To):new No(r[0].shape,To);return t.runWebGLProgram(x,r,i)}var S=k.env().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(w.length>S){for(var T=[],N=0;N<w.length;N+=S){var C=w.slice(N,N+S);T.push(ql(C,e,t))}var R=ql(T,e,t);try{for(var _=ln(T),P=_.next();!P.done;P=_.next()){var N=P.value;t.disposeIntermediateTensorInfo(N)}}catch(V){n={error:V}}finally{try{P&&!P.done&&(a=_.return)&&a.call(_)}finally{if(n)throw n.error}}return R}if(b){var $=new REe(w.map(function(V){return V.shape}),e);return t.runWebGLProgram($,w,i)}var z=PEe(w,e,t),L=z.tensors2D,B=z.outShape,G=new FEe(L.map(function(V){return V.shape})),X=t.runWebGLProgram(G,L,i);L.forEach(function(V){return t.disposeIntermediateTensorInfo(V)});var Z=Ce({inputs:{x:X},attrs:{shape:B},backend:t});return t.disposeIntermediateTensorInfo(X),Z}function PEe(r,e,t){var n=k.backend_util.computeOutShape(r.map(function(i){return i.shape}),e),a=r.map(function(i){return Ce({inputs:{x:i},attrs:{shape:[-1,k.util.sizeFromShape(i.shape.slice(e))]},backend:t})});return{tensors2D:a,outShape:n}}function XF(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.axis,i=k.util.parseAxisParam(a,e[0].shape)[0],o=e.map(function(c){return c.shape});k.backend_util.assertParamsConsistent(o,i);var s=k.backend_util.computeOutShape(e.map(function(c){return c.shape}),i);if(k.util.sizeFromShape(s)===0)return t.makeTensorInfo(s,e[0].dtype,[]);var u=e.filter(function(c){return k.util.sizeFromShape(c.shape)>0});return u.length===1?Kn({inputs:{x:u[0]},backend:t}):ql(u,i,t)}var MEe={kernelName:k.Concat,backendName:"webgl",kernelFunc:XF};var YF=(function(){function r(e,t,n,a,i){t===void 0&&(t=!1),n===void 0&&(n=null),a===void 0&&(a=!1),i===void 0&&(i=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var o=e.padInfo.top,s=e.padInfo.left,u=e.strideHeight,c=e.strideWidth,l=e.dilationHeight,f=e.dilationWidth,h=e.filterHeight,p=e.filterWidth,d=Math.floor(e.inChannels/4)*4,m=e.inChannels%4,v=e.dataFormat==="channelsLast",g=v?1:2,y=v?2:3,w=v?3:1,b="",x="";n&&(a?b=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `.concat(n,`
        }`):i?b=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          `.concat(n,`
        }`):b=`
          float activation(float x) {
            `.concat(n,`
          }
        `),x="result = activation(result);");var S=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      `.concat(b,`

      const ivec2 strides = ivec2(`).concat(u,", ").concat(c,`);
      const ivec2 pads = ivec2(`).concat(o,", ").concat(s,`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[`).concat(w,`];

        ivec2 xRCCorner =
            ivec2(coords[`).concat(g,"], coords[").concat(y,`]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `).concat(h,`; wR++) {
          int xR = xRCorner + wR * `).concat(l,`;

          if (xR < 0 || xR >= `).concat(e.inHeight,`) {
            continue;
          }

          for (int wC = 0; wC < `).concat(p,`; wC++) {
            int xC = xCCorner + wC * `).concat(f,`;

            if (xC < 0 || xC >= `).concat(e.inWidth,`) {
              continue;
            }

            for (int d1 = 0; d1 < `).concat(d,`; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (`).concat(v,`) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (`).concat(m===1,`) {

              if (`).concat(v,`) {
                dotProd +=
                    getX(batch, xR, xC, `).concat(d,`) *
                    getW(wR, wC, `).concat(d,`, d2);
              } else {
                dotProd +=
                    getX(batch, `).concat(d,`, xR, xC) *
                    getW(wR, wC, `).concat(d,`, d2);
              }

            } else if (`).concat(m===2,`) {
              vec2 wValues = vec2(
                getW(wR, wC, `).concat(d,`, d2),
                getW(wR, wC, `).concat(d,` + 1, d2)
              );

              if (`).concat(v,`) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, `).concat(d,`),
                  getX(batch, xR, xC, `).concat(d,` + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, `).concat(d,`, xR, xC),
                  getX(batch, `).concat(d,` + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (`).concat(m===3,`) {
              vec3 wValues = vec3(
                getW(wR, wC, `).concat(d,`, d2),
                getW(wR, wC, `).concat(d,` + 1, d2),
                getW(wR, wC, `).concat(d,` + 2, d2)
              );

              if (`).concat(v,`) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, `).concat(d,`),
                  getX(batch, xR, xC, `).concat(d,` + 1),
                  getX(batch, xR, xC, `).concat(d,` + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, `).concat(d,`, xR, xC),
                  getX(batch, `).concat(d,` + 1, xR, xC),
                  getX(batch, `).concat(d,` + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        `).concat(S,`
        `).concat(x,`
        setOutput(result);
      }
    `)}return r})(),BEe=(function(){function r(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.padInfo.front,n=e.padInfo.top,a=e.padInfo.left,i=e.strideDepth,o=e.strideHeight,s=e.strideWidth,u=e.dilationDepth,c=e.dilationHeight,l=e.dilationWidth,f=e.filterDepth,h=e.filterHeight,p=e.filterWidth,d=Math.floor(e.inChannels/4)*4,m=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`.concat(i,", ").concat(o,", ").concat(s,`);
      const ivec3 pads = ivec3(`).concat(t,", ").concat(n,", ").concat(a,`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `).concat(f,`; wF++) {
          int xF = xFCorner + wF * `).concat(u,`;

          if (xF < 0 || xF >= `).concat(e.inDepth,`) {
            continue;
          }

          for (int wR = 0; wR < `).concat(h,`; wR++) {
            int xR = xRCorner + wR * `).concat(c,`;

            if (xR < 0 || xR >= `).concat(e.inHeight,`) {
              continue;
            }

            for (int wC = 0; wC < `).concat(p,`; wC++) {
              int xC = xCCorner + wC * `).concat(l,`;

              if (xC < 0 || xC >= `).concat(e.inWidth,`) {
                continue;
              }

              for (int d1 = 0; d1 < `).concat(d,`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`).concat(m===1,`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `).concat(d,`) *
                  getW(wF, wR, wC, `).concat(d,`, d2);
              } else if (`).concat(m===2,`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `).concat(d,`),
                  getX(batch, xF, xR, xC, `).concat(d,` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `).concat(d,`, d2),
                  getW(wF, wR, wC, `).concat(d,` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`).concat(m===3,`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `).concat(d,`),
                  getX(batch, xF, xR, xC, `).concat(d,` + 1),
                  getX(batch, xF, xR, xC, `).concat(d,` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `).concat(d,`, d2),
                  getW(wF, wR, wC, `).concat(d,` + 1, d2),
                  getW(wF, wR, wC, `).concat(d,` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `)}return r})();var ZF=(function(){function r(e,t,n,a,i){t===void 0&&(t=!1),n===void 0&&(n=null),a===void 0&&(a=!1),i===void 0&&(i=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=tn(this.outputShape.length);for(var o=e.padInfo.left,s=e.strideWidth,u=e.dilationWidth,c=e.filterHeight,l=e.filterWidth,f=l,h=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`,p=0;p<l;p++)h+=`
           vec4 xTexelC`.concat(p*2,`;
           int xTexelC`).concat(p*2,`Ready;
           vec4 xTexelC`).concat(p*2+1,`;
           int xTexelC`).concat(p*2+1,`Ready;
           vec4 xC`).concat(p,";");h+=`
     for (int r = 0; r < `.concat(c,`; r++) {
      for (int d1 = 0; d1 < `).concat(e.inChannels,`; d1 += 2) {
       `);for(var p=0;p<l;p++)h+=`
           xTexelC`.concat(p*2,` = vec4(0.0);
           xTexelC`).concat(p*2,`Ready = 0;
           xTexelC`).concat(p*2+1,` = vec4(0.0);
           xTexelC`).concat(p*2+1,`Ready = 0;
           xC`).concat(p," = vec4(0.0);");h+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(var d=0;d<(f+1)/2;d++){var m=d*2;if(h+=`
           xC = xCCorner + `.concat(m*u,`;
           `),s===1){if(m<l&&(o%2===1?(h+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`.concat(m,`Ready == 0) {
                   xTexelC`).concat(m,` = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC`).concat(m,`.zw = vec2(0.0);
                   }
                   xTexelC`).concat(m,`Ready = 1;
                 }
               `),u===1&&m>0?h+=`
                 xC`.concat(m," = vec4(xTexelC").concat(m-2,".zw, xTexelC").concat(m,`.xy);
                 `):h+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC`.concat(m," = vec4(previous.zw, xTexelC").concat(m,`.xy);
                   } else {
                     xC`).concat(m," = vec4(0.0, 0.0, xTexelC").concat(m,`.xy);
                   }
                   `)):h+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC`.concat(m,`Ready == 0) {
                   xTexelC`).concat(m,` = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC`).concat(m,`.zw = vec2(0.0);
                   }
                   xTexelC`).concat(m,`Ready = 1;
                 }

                 xC`).concat(m," = xTexelC").concat(m,`;
                 `),m+1<l)){var v=o%2===0?k.util.nearestLargerEven(u):u;u%2===0&&o%2===1||u%2!==0&&o%2!==1?(h+=`
                   xCOffset = xC + imod(pads[1], 2) + `.concat(v,`;

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`).concat(m+1,`Ready == 0) {
                     xTexelC`).concat(m+1,` = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC`).concat(m+1,`.zw = vec2(0.0);
                     }
                     xTexelC`).concat(m+1,`Ready = 1;
                   }
                   `),u>1?h+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC`.concat(m+1," = vec4(previous.zw, xTexelC").concat(m+1,`.xy);
                     } else {
                      xC`).concat(m+1," = vec4(0.0, 0.0, xTexelC").concat(m+1,`.xy);
                     }
                     `):h+=`
                     xC`.concat(m+1," = vec4(xTexelC").concat(m,".zw, xTexelC").concat(m+1,`.xy);
                     `)):v===1?h+=`
                     xC`.concat(m+1," = xTexelC").concat(m,`;
                     `):h+=`
                     xCOffset = xC + `.concat(v,`;

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`).concat(m+1,`Ready == 0) {
                       xTexelC`).concat(m+1,` = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC`).concat(m+1,`.zw = vec2(0.0);
                       }
                       xTexelC`).concat(m+1,`Ready = 1;
                     }

                     xC`).concat(m+1," = xTexelC").concat(m+1,`;
                     `)}}else m<l&&(o%2===1?(h+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`.concat(m,`Ready == 0) {
                   xTexelC`).concat(m,` = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC`).concat(m,`.zw = vec2(0.0);
                   }
                   xTexelC`).concat(m,`Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC`).concat(m+1,`Ready == 0) {
                   xTexelC`).concat(m+1,` = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC`).concat(m+1,`.zw = vec2(0.0);
                   }
                   xTexelC`).concat(m+1,`Ready = 1;
                 }

                 xC`).concat(m," = vec4(xTexelC").concat(m,".zw, xTexelC").concat(m+1,`.zw);
               `),m+1<l&&(h+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC`.concat(m+1," = vec4(xTexelC").concat(m+1,`.xy, final.xy);
                 `))):(h+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC`.concat(m,`Ready == 0) {
                   xTexelC`).concat(m,` = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC`).concat(m,`.zw = vec2(0.0);
                   }
                   xTexelC`).concat(m,`Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`).concat(m+1,`Ready == 0) {
                   xTexelC`).concat(m+1,` = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC`).concat(m+1,`.zw = vec2(0.);
                   }
                   xTexelC`).concat(m+1,`Ready = 1;
                 }

                 xC`).concat(m,` = vec4(
                   xTexelC`).concat(m,".xy, xTexelC").concat(m+1,`.xy);
               `),m+1<l&&(h+=`
                   xC`.concat(m+1," = vec4(xTexelC").concat(m,".zw, xTexelC").concat(m+1,`.zw);
                 `))));m<l&&(h+=`
             wTexel = getW(r, `.concat(m,`, d1, d2);
             dotProd += xC`).concat(m,`.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < `).concat(e.inChannels,`) {
               dotProd += xC`).concat(m,`.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `),m+1<l&&(h+=`
               wTexel = getW(r, `.concat(m+1,`, d1, d2);
               dotProd += xC`).concat(m+1,`.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < `).concat(e.inChannels,`) {
                 dotProd += xC`).concat(m+1,`.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `)))}h+=`
     }
   `,h+=`
     }
   `,h+=`
     }
   `;var g="",y="";n&&(a?g=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           `.concat(n,`
         }`):i?g=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           `.concat(n,`
         }`):g=`vec4 activation(vec4 x) {
           `.concat(n,`
         }`),y="result = activation(result);");var w=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       `.concat(g,`

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         `).concat(h,`

         vec4 result = dotProd - vec4(0.000000000000001);
         `).concat(w,`
         `).concat(y,`
         setOutput(result);
       }
     `)}return r})();var LEe=(function(){function r(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=tn(this.outputShape.length);for(var n=t.dataFormat,a=hn(),i=n==="channelsLast",o=i?1:2,s=i?2:3,u=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":"if(blockIndex < ".concat(e[2]," && pos < ").concat(e[1],") {"),c="",l=0;l<=1;l++)for(var f=0;f<=1;f++)c+=`
          blockIndex = rc.z + `.concat(f,`;
          pos = rc.y + `).concat(l,`;

          `).concat(u,`
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[`).concat(o,`] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[`).concat(s,`] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (`).concat(i,`) {
                  innerDims = vec2(d1, ch);
                  result[`).concat(l*2+f,`] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[`).concat(l*2+f,`] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `);this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        `.concat(c,`

        `).concat(a.output,` = result;
      }
    `)}return r})();function ad(r,e){var t=r.length;return t>=3?e?ir(ir([],Ee(r.slice(0,-3)),!1),[r[t-3]*r[t-2],r[t-1]],!1):ir(ir([],Ee(r.slice(0,-3)),!1),[r[t-3],r[t-2]*r[t-1]],!1):!e&&t===1&&r[0]>1?[r[0],1]:null}function JF(r){var e,t,n=r.x,a=r.filter,i=r.convInfo,o=r.backend,s=r.bias,u=s===void 0?null:s,c=r.preluActivationWeights,l=c===void 0?null:c,f=r.leakyreluAlpha,h=f===void 0?0:f,p=r.activation,d=p===void 0?null:p,m=n.shape,v=o.texData.get(n.dataId),g=i.inChannels,y=m[0]*m[1]*m[2],w=i.outChannels,b=i.dataFormat==="channelsLast",x=!1,S=!1,T,N=[];if(l!=null){var C=ad(l.shape,b);C!=null&&(l=Ce({inputs:{x:l},backend:o,attrs:{shape:C}}),N.push(l))}if(u!=null){var C=ad(u.shape,b);C!=null&&(u=Ce({inputs:{x:u},backend:o,attrs:{shape:C}}),N.push(u))}var R=(y===1||w===1)&&g>UF,_=!R&&v.isPacked&&b&&v.texture!=null&&m[2]%2!==0&&k.util.arraysEqual(v.shape.slice(-3),m.slice(-3));if(_){var C=m[0]*m[1]*(m[2]+1),P={dataId:n.dataId,shape:[1,C,i.inChannels],dtype:n.dtype},$=v.shape;v.shape=v.shape.slice(),v.shape[v.shape.length-2]++,k.util.assert(jl(v.shape,P.shape),function(){return"packed reshape ".concat(v.shape," to ").concat(P.shape," isn't free")});var z=Ce({inputs:{x:a},backend:o,attrs:{shape:[1,i.inChannels,i.outChannels]}});N.push(z);var L=nd({a:P,b:z,backend:o,transposeA:x,transposeB:S,bias:u,activation:d,preluActivationWeights:l,leakyreluAlpha:h}),B=o.texData.get(L.dataId);k.util.assert(B.isPacked,function(){return"batchMatMul result is expected to be packed"}),v.shape=$,B.shape=i.outShape,T=Kn({inputs:{x:L},backend:o}),T.shape=i.outShape,N.push(L)}else{var G=i.outHeight*i.outWidth,X=Ce({inputs:{x:n},backend:o,attrs:{shape:b?[i.batchSize,G,i.inChannels]:[i.batchSize,i.inChannels,G]}}),z=Ce({inputs:{x:a},backend:o,attrs:{shape:[1,i.inChannels,i.outChannels]}}),Z=nd({a:b?X:z,b:b?z:X,transposeA:!b,transposeB:S,backend:o,bias:u,activation:d,preluActivationWeights:l,leakyreluAlpha:h});T=Ce({inputs:{x:Z},backend:o,attrs:{shape:i.outShape}}),N.push(X),N.push(z),N.push(Z)}try{for(var V=ln(N),j=V.next();!j.done;j=V.next()){var re=j.value;o.disposeIntermediateTensorInfo(re)}}catch(te){e={error:te}}finally{try{j&&!j.done&&(t=V.return)&&t.call(V)}finally{if(e)throw e.error}}return T}function QF(r){var e,t,n=r.x,a=r.filter,i=r.convInfo,o=r.backend,s=r.bias,u=s===void 0?null:s,c=r.preluActivationWeights,l=c===void 0?null:c,f=r.leakyreluAlpha,h=f===void 0?0:f,p=r.activation,d=p===void 0?null:p,m=i.filterWidth,v=i.filterHeight,g=i.inChannels,y=i.outWidth,w=i.outHeight,b=i.dataFormat,x=b==="channelsLast",S=m*v*g,T=w*y,N=[i.batchSize,S,T],C=!0,R=!1,_=[];if(l!=null){var P=ad(l.shape,x);P!=null&&(l=Ce({inputs:{x:l},backend:o,attrs:{shape:P}}),_.push(l))}if(u!=null){var P=ad(u.shape,x);P!=null&&(u=Ce({inputs:{x:u},backend:o,attrs:{shape:P}}),_.push(u))}var $=Ce({inputs:{x:a},backend:o,attrs:{shape:[1,S,k.util.sizeFromShape(a.shape)/S]}});_.push($);var z=new LEe(N,i),L=[n.shape,[i.padInfo.top,i.padInfo.left],[i.strideHeight,i.strideWidth],[i.dilationHeight,i.dilationWidth],[i.inChannels],[i.filterWidth*i.inChannels],[i.outWidth]],B=o.runWebGLProgram(z,[n],"float32",L),G=Ce({inputs:{x:B},backend:o,attrs:{shape:N}});_.push(B),_.push(G);var X=u!=null,Z=l!=null,V=d==="leakyrelu",j=d?Xl(d,!0):null,re=new VF(x?G.shape:$.shape,x?$.shape:G.shape,x?[i.batchSize,T,i.outChannels]:[i.batchSize,i.outChannels,T],C,R,X,j,Z,V),te=x?[G,$]:[$,G];if(u&&te.push(u),Z&&te.push(l),V){var oe=o.makeTensorInfo([],"float32",k.util.createScalarValue(h,"float32"));te.push(oe),_.push(oe)}var ce=o.runWebGLProgram(re,te,"float32"),pe=Ce({inputs:{x:ce},backend:o,attrs:{shape:i.outShape}});_.push(ce);try{for(var xe=ln(_),fe=xe.next();!fe.done;fe=xe.next()){var ge=fe.value;o.disposeIntermediateTensorInfo(ge)}}catch(we){e={error:we}}finally{try{fe&&!fe.done&&(t=xe.return)&&t.call(xe)}finally{if(e)throw e.error}}return pe}function zEe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=n.strides,s=n.pad,u=n.dataFormat,c=n.dilations,l=n.dimRoundingMode,f=k.backend_util.convertConv2DDataFormat(u),h=k.backend_util.computeConv2DInfo(a.shape,i.shape,o,c,s,l,!1,f),p;if(h.filterHeight===1&&h.filterWidth===1&&h.dilationHeight===1&&h.dilationWidth===1&&h.strideHeight===1&&h.strideWidth===1&&(h.padInfo.type==="SAME"||h.padInfo.type==="VALID"))p=JF({x:a,filter:i,convInfo:h,backend:t});else if(h.strideWidth<=2&&f==="channelsLast"&&k.env().getBool("WEBGL_EXP_CONV")){var d=new ZF(h),m=[[h.padInfo.top,h.padInfo.left],[h.strideHeight,h.strideWidth],[h.dilationHeight,h.dilationWidth],[h.inHeight,h.inWidth]];p=t.runWebGLProgram(d,[a,i],"float32",m)}else if(k.env().getBool("WEBGL_CONV_IM2COL"))p=QF({x:a,filter:i,convInfo:h,backend:t});else{var d=new YF(h);p=t.runWebGLProgram(d,[a,i],"float32")}var v=Ce({inputs:{x:p},backend:t,attrs:{shape:h.outShape}});return t.disposeIntermediateTensorInfo(p),v}var $Ee={kernelName:k.Conv2D,backendName:"webgl",kernelFunc:zEe};var WEe=(function(){function r(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,a=e.padInfo.top,i=e.padInfo.left,o=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `.concat(e.batchSize,`; b++) {
          for (int yR = 0; yR < `).concat(e.outHeight,`; yR++) {
            int xR = wR + yR * `).concat(t," - ").concat(a,`;

            if (xR < 0 || xR >= `).concat(e.inHeight,`) {
              continue;
            }

            for (int yC = 0; yC < `).concat(e.outWidth,`; yC++) {
              int xC = wC + yC * `).concat(n," - ").concat(i,`;

              if (xC < 0 || xC >= `).concat(e.inWidth,`) {
                continue;
              }

              `).concat(o?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`,`
            }
          }
        }
        setOutput(dotProd);
      }
    `)}return r})(),GEe=(function(){function r(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,a=e.strideHeight,i=e.strideWidth,o=e.dataFormat==="channelsLast",s=t-1-e.padInfo.top,u=n-1-e.padInfo.left,c=o?1:2,l=o?2:3,f=o?3:1;this.userCode=`
      const ivec2 pads = ivec2(`.concat(s,", ").concat(u,`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[`).concat(f,`];

        ivec2 dyCorner = ivec2(coords[`).concat(c,"], coords[").concat(l,`]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `).concat(t,`; wR++) {
          float dyR = float(dyRCorner + wR) / `).concat(a,`.0;

          if (dyR < 0.0 || dyR >= `).concat(e.outHeight,`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `).concat(t,` - 1 - wR;

          for (int wC = 0; wC < `).concat(n,`; wC++) {
            float dyC = float(dyCCorner + wC) / `).concat(i,`.0;

            if (dyC < 0.0 || dyC >= `).concat(e.outWidth,`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `).concat(n,` - 1 - wC;

            for (int d2 = 0; d2 < `).concat(e.outChannels,`; d2++) {

              if (`).concat(o,`) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `)}return r})(),VEe=(function(){function r(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideDepth,n=e.strideHeight,a=e.strideWidth,i=e.padInfo.front,o=e.padInfo.top,s=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `.concat(e.batchSize,`; b++) {
          for (int yF = 0; yF < `).concat(e.outDepth,`; yF++) {
            int xF = wF + yF * `).concat(t," - ").concat(i,`;

            if (xF < 0 || xF >= `).concat(e.inDepth,`) {
              continue;
            }

            for (int yR = 0; yR < `).concat(e.outHeight,`; yR++) {
              int xR = wR + yR * `).concat(n," - ").concat(o,`;

              if (xR < 0 || xR >= `).concat(e.inHeight,`) {
                continue;
              }

              for (int yC = 0; yC < `).concat(e.outWidth,`; yC++) {
                int xC = wC + yC * `).concat(a," - ").concat(s,`;

                if (xC < 0 || xC >= `).concat(e.inWidth,`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `)}return r})(),UEe=(function(){function r(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,a=e.filterWidth,i=e.strideDepth,o=e.strideHeight,s=e.strideWidth,u=t-1-e.padInfo.front,c=n-1-e.padInfo.top,l=a-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`.concat(u,", ").concat(c,", ").concat(l,`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `).concat(t,`; wF++) {
          float dyF = float(dyFCorner + wF) / `).concat(i,`.0;

          if (dyF < 0.0 || dyF >= `).concat(e.outDepth,`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `).concat(t,` - 1 - wF;

          for (int wR = 0; wR < `).concat(n,`; wR++) {
            float dyR = float(dyRCorner + wR) / `).concat(o,`.0;

            if (dyR < 0.0 || dyR >= `).concat(e.outHeight,`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `).concat(n,` - 1 - wR;

            for (int wC = 0; wC < `).concat(a,`; wC++) {
              float dyC = float(dyCCorner + wC) / `).concat(s,`.0;

              if (dyC < 0.0 || dyC >= `).concat(e.outWidth,`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `).concat(a,` - 1 - wC;

              for (int d2 = 0; d2 < `).concat(e.outChannels,`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `)}return r})();function HEe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.dy,o=n.strides,s=n.pad,u=n.dataFormat,c=n.dimRoundingMode,l=n.filterShape,f=k.backend_util.convertConv2DDataFormat(u),h=k.backend_util.computeConv2DInfo(a.shape,l,o,1,s,c,!1,f),p=new WEe(h);return t.runWebGLProgram(p,[a,i],"float32")}var qEe={kernelName:k.Conv2DBackpropFilter,backendName:"webgl",kernelFunc:HEe};var KEe=(function(){function r(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=tn(this.outputShape.length);var t=e.filterHeight,n=e.filterWidth,a=t-1-e.padInfo.top,i=n-1-e.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(`.concat(a,", ").concat(i,`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < `).concat(t,`; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= `).concat(e.outHeight,`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = `).concat(t,` - 1 - wR;

          for (int wC = 0; wC < `).concat(n,`; wC++) {
            int wCPerm = `).concat(n,` - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < `).concat(e.outWidth,`.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < `).concat(e.outWidth,`.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < `).concat(e.outChannels,`; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < `).concat(e.outChannels,`; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < `).concat(e.outChannels,`; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `)}return r})();function jEe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.filter,o=n.inputShape,s=n.strides,u=n.pad,c=n.dataFormat,l=n.dimRoundingMode,f=k.backend_util.convertConv2DDataFormat(c),h=k.backend_util.computeConv2DInfo(o,i.shape,s,1,u,l,!1,f);if(k.env().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&f==="channelsLast"){var p=[[h.strideHeight,h.strideWidth]],d=new KEe(h);return t.runWebGLProgram(d,[a,i],"float32",p)}else{var d=new GEe(h);return t.runWebGLProgram(d,[a,i],"float32")}}var XEe={kernelName:k.Conv2DBackpropInput,backendName:"webgl",kernelFunc:jEe};function YEe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=n.strides,s=n.pad,u=n.dilations,c=k.backend_util.computeConv3DInfo(a.shape,i.shape,o,u,s),l=new BEe(c);return t.runWebGLProgram(l,[a,i],"float32")}var ZEe={kernelName:k.Conv3D,backendName:"webgl",kernelFunc:YEe};function JEe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.dy,o=n.strides,s=n.pad,u=n.filterShape,c=k.backend_util.computeConv3DInfo(a.shape,u,o,1,s),l=new VEe(c);return t.runWebGLProgram(l,[a,i],"float32")}var QEe={kernelName:k.Conv3DBackpropFilterV2,backendName:"webgl",kernelFunc:JEe};function eTe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.filter,o=n.pad,s=n.strides,u=n.inputShape,c=k.backend_util.computeConv3DInfo(u,i.shape,s,1,o),l=new UEe(c);return t.runWebGLProgram(l,[a,i],"float32")}var tTe={kernelName:k.Conv3DBackpropInputV2,backendName:"webgl",kernelFunc:eTe};var rTe=Qu+`
  return cos(x);
`,nTe=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  `.concat(Bs,`
  return result;
`),aTe=bt({opSnippet:rTe,packedOpSnippet:nTe}),iTe={kernelName:k.Cos,backendName:"webgl",kernelFunc:aTe};var oTe=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,sTe=bt({opSnippet:oTe}),uTe={kernelName:k.Cosh,backendName:"webgl",kernelFunc:sTe};var cTe=(function(){function r(e,t,n,a,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var o=Ee(e,4),s=o[0],u=o[1],c=o[2],l=o[3],f=Ee(t,1),h=f[0],p=Ee(n,2),d=p[0],m=p[1];this.outputShape=[h,d,m,l];var v=a==="bilinear"?1:0,g=Ee(["".concat(u-1,".0"),"".concat(c-1,".0")],2),y=g[0],w=g[1],b=Ee(d>1?["".concat((u-1)/(d-1)),"(y2-y1) * height_ratio","y1*".concat(y," + float(y)*(height_scale)")]:["0.0","0.0","0.5 * (y1+y2) * ".concat(y)],3),x=b[0],S=b[1],T=b[2],N=Ee(m>1?["".concat((c-1)/(m-1)),"(x2-x1) * width_ratio","x1*".concat(w," + float(x)*(width_scale)")]:["0.0","0.0","0.5 * (x1+x2) * ".concat(w)],3),C=N[0],R=N[1],_=N[2];this.userCode=`
      const float height_ratio = float(`.concat(x,`);
      const float width_ratio = float(`).concat(C,`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `).concat(s,`) {
          return;
        }

        float height_scale = `).concat(S,`;
        float width_scale = `).concat(R,`;

        float in_y = `).concat(T,`;
        if( in_y < 0.0 || in_y > `).concat(y,` ) {
          setOutput(float(`).concat(i,`));
          return;
        }
        float in_x = `).concat(_,`;
        if( in_x < 0.0 || in_x > `).concat(w,` ) {
          setOutput(float(`).concat(i,`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`).concat(v,` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `)}return r})();var lTe=function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.image,i=e.boxes,o=e.boxInd,s=n.cropSize,u=n.method,c=n.extrapolationValue,l=new cTe(a.shape,i.shape,s,u,c);return t.runWebGLProgram(l,[a,i,o],"float32")},fTe={kernelName:k.CropAndResize,backendName:"webgl",kernelFunc:lTe},Zl;(function(r){r.Prod="*",r.Sum="+"})(Zl||(Zl={}));var I3=(function(){function r(e,t,n,a){this.op=e,this.outputShape=t,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];var i=this.outputShape.length,o=this.op===Zl.Prod?"1.0":"0.0",s=n?o:"getX(".concat(C3(i,"coords",this.op),")"),u=this.outputShape[this.outputShape.length-1],c="",l="";n?(c=a?"end != ".concat(u-1):"end != 0",l=a?"end + 1":"end - 1"):(c=a?"end + pow2 < ".concat(u):"end >= pow2",l=a?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        `.concat(Ft(i),` coords = getOutputCoords();
        int end = `).concat(A3(i,"coords",this.op),`;
        float val = `).concat(s,`;
        int pow2 = int(pow(2.0, index));
        if (`).concat(c,`) {
          int idx = `).concat(l,`;
          `).concat(A3(i,"coords",this.op),` = idx;
          val `).concat(this.op,"= getX(").concat(C3(i,"coords",this.op),`);
        }
        setOutput(val);
      }
    `)}return r})();function C3(r,e,t){if(r===1)return"".concat(e);if(r===2)return"".concat(e,".x, ").concat(e,".y");if(r===3)return"".concat(e,".x, ").concat(e,".y, ").concat(e,".z");if(r===4)return"".concat(e,".x, ").concat(e,".y, ").concat(e,".z, ").concat(e,".w");throw new Error("Cumulative ".concat(t," for rank ").concat(r," is not yet supported"))}function A3(r,e,t){if(r===1)return"".concat(e);if(r===2)return"".concat(e,".y");if(r===3)return"".concat(e,".z");if(r===4)return"".concat(e,".w");throw new Error("Cumulative ".concat(t," for rank ").concat(r," is not yet supported"))}function eR(r,e,t,n,a,i){var o=e.shape.length,s=k.backend_util.getAxesPermutation([n],o),u=e;s!=null&&(u=fn({inputs:{x:e},backend:t,attrs:{perm:s}}));var c=k.backend_util.getInnerMostAxes(1,o)[0];if(c!==o-1)throw new Error("WebGL cumprod shader expects an inner-most axis=".concat(e.shape.length-1," ")+"but got axis=".concat(n));for(var l=u.shape[c],f=Kn({inputs:{x:u},backend:t}),h=0;h<=Math.ceil(Math.log2(l))-1;h++){var p=new I3(r,u.shape,!1,i),d=[[h]],m=f;f=t.runWebGLProgram(p,[f],f.dtype,d),t.disposeIntermediateTensorInfo(m)}if(a){var p=new I3(r,u.shape,a,i),m=f;f=t.runWebGLProgram(p,[f],f.dtype),t.disposeIntermediateTensorInfo(m)}if(s!=null){var v=k.backend_util.getUndoAxesPermutation(s),g=fn({inputs:{x:f},backend:t,attrs:{perm:v}});return t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(u),g}return f}function hTe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.exclusive,s=n.reverse;return eR(Zl.Prod,a,t,i,o,s)}var pTe={kernelName:k.Cumprod,backendName:"webgl",kernelFunc:hTe};function dTe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.exclusive,s=n.reverse;return eR(Zl.Sum,a,t,i,o,s)}var vTe={kernelName:k.Cumsum,backendName:"webgl",kernelFunc:dTe};function mTe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.weights,o=n.size,s=n.binaryOutput;if(a.shape.length===1){var u=t.readSync(a.dataId),c=t.readSync(i.dataId),l=RF(u,c,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,l)}else if(a.shape.length===2){var f=t.bufferSync(a),h=t.bufferSync(i),p=yke(f,h,o,s);return t.makeTensorInfo(p.shape,i.dtype,p.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank"+"".concat(a.shape.length,"."))}var gTe={kernelName:k.DenseBincount,backendName:"webgl",kernelFunc:mTe};var yTe=(function(){function r(e,t,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=n,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `.concat(this.getHeightCoordString(),`;
      int w = `).concat(this.getWidthCoordString(),`;
      int d = `).concat(this.getDepthCoordString(),`;

      int in_h = h / `).concat(t,`;
      int offset_h = imod(h, `).concat(t,`);
      int in_w = w / `).concat(t,`;
      int offset_w = imod(w, `).concat(t,`);
      int offset_d = (offset_h * `).concat(t,` + offset_w) *
        `).concat(this.getOutputDepthSize(),`;
      int in_d = d + offset_d;

      float result = `).concat(this.getInputSamplingString(),`;
      setOutput(result);
    }
  `)}return r.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},r.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},r.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},r.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},r.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},r})();function bTe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.blockSize,o=n.dataFormat,s=a.shape[0],u=o==="NHWC"?a.shape[1]:a.shape[2],c=o==="NHWC"?a.shape[2]:a.shape[3],l=o==="NHWC"?a.shape[3]:a.shape[1],f=u*i,h=c*i,p=l/(i*i),d=o==="NHWC"?[s,f,h,p]:[s,p,f,h],m=new yTe(d,i,o);return t.runWebGLProgram(m,[a],a.dtype)}var wTe={kernelName:k.DepthToSpace,backendName:"webgl",kernelFunc:bTe};var tR=(function(){function r(e,t,n,a,i){t===void 0&&(t=!1),n===void 0&&(n=null),a===void 0&&(a=!1),i===void 0&&(i=!1),this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=tn(this.outputShape.length);var o=e.filterHeight,s=e.filterWidth,u=e.outChannels/e.inChannels,c="",l="";n&&(a?c=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `.concat(n,`
        }`):i?c=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          `.concat(n,`
        }`):c=`
          float activation(float x) {
            `.concat(n,`
          }
        `),l="result = activation(result);");var f=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      `.concat(c,`

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `).concat(u,`;
        int q = d2 - d1 * `).concat(u,`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `).concat(o,`; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < `).concat(s,`; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        `).concat(f,`
        `).concat(l,`
        setOutput(result);
      }
    `)}return r})();var rR=(function(){function r(e,t,n,a,i){t===void 0&&(t=!1),n===void 0&&(n=null),a===void 0&&(a=!1),i===void 0&&(i=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=tn(this.outputShape.length);for(var o=e.outChannels/e.inChannels,s=e.padInfo.left,u=e.strideWidth,c=e.dilationWidth,l=e.filterHeight,f=e.filterWidth,h=f,p=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`,d=0;d<f;d++)p+=`
          vec4 xTexelC`.concat(d*2,`;
          int xTexelC`).concat(d*2,`Ready;
          vec4 xTexelC`).concat(d*2+1,`;
          int xTexelC`).concat(d*2+1,`Ready;
          vec4 xC`).concat(d,";");p+=`
    for (int r = 0; r < `.concat(l,`; r++) {
      `);for(var d=0;d<f;d++)p+=`
          xTexelC`.concat(d*2,` = vec4(0.0);
          xTexelC`).concat(d*2,`Ready = 0;
          xTexelC`).concat(d*2+1,` = vec4(0.0);
          xTexelC`).concat(d*2+1,`Ready = 0;
          xC`).concat(d," = vec4(0.0);");p+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(var m=0;m<(h+1)/2;m++){var v=m*2;if(p+=`
          xC = xCCorner + `.concat(v*c,`;
          `),u===1){if(v<f&&(s%2===1?(p+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`.concat(v,`Ready == 0) {
                  xTexelC`).concat(v,` = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC`).concat(v,`.zw = vec2(0.0);
                  }
                  xTexelC`).concat(v,`Ready = 1;
                }
              `),c===1&&v>0?p+=`
                xC`.concat(v," = vec4(xTexelC").concat(v-2,".zw, xTexelC").concat(v,`.xy);
                `):p+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC`.concat(v," = vec4(previous.zw, xTexelC").concat(v,`.xy);
                  } else {
                    xC`).concat(v," = vec4(0.0, 0.0, xTexelC").concat(v,`.xy);
                  }
                  `)):p+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC`.concat(v,`Ready == 0) {
                  xTexelC`).concat(v,` = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC`).concat(v,`.zw = vec2(0.0);
                  }
                  xTexelC`).concat(v,`Ready = 1;
                }

                xC`).concat(v," = xTexelC").concat(v,`;
                `),v+1<f)){var g=s%2===0?k.util.nearestLargerEven(c):c;c%2===0&&s%2===1||c%2!==0&&s%2!==1?(p+=`
                  xCOffset = xC + imod(pads[1], 2) + `.concat(g,`;

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`).concat(v+1,`Ready == 0) {
                    xTexelC`).concat(v+1,` = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC`).concat(v+1,`.zw = vec2(0.0);
                    }
                    xTexelC`).concat(v+1,`Ready = 1;
                  }
                  `),c>1?p+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC`.concat(v+1," = vec4(previous.zw, xTexelC").concat(v+1,`.xy);
                    } else {
                     xC`).concat(v+1," = vec4(0.0, 0.0, xTexelC").concat(v+1,`.xy);
                    }
                    `):p+=`
                    xC`.concat(v+1," = vec4(xTexelC").concat(v,".zw, xTexelC").concat(v+1,`.xy);
                    `)):g===1?p+=`
                    xC`.concat(v+1," = xTexelC").concat(v,`;
                    `):p+=`
                    xCOffset = xC + `.concat(g,`;

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`).concat(v+1,`Ready == 0) {
                      xTexelC`).concat(v+1,` = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC`).concat(v+1,`.zw = vec2(0.0);
                      }
                      xTexelC`).concat(v+1,`Ready = 1;
                    }

                    xC`).concat(v+1," = xTexelC").concat(v+1,`;
                    `)}}else v<f&&(s%2===1?(p+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`.concat(v,`Ready == 0) {
                  xTexelC`).concat(v,` = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC`).concat(v,`.zw = vec2(0.0);
                  }
                  xTexelC`).concat(v,`Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC`).concat(v+1,`Ready == 0) {
                  xTexelC`).concat(v+1,` = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC`).concat(v+1,`.zw = vec2(0.0);
                  }
                  xTexelC`).concat(v+1,`Ready = 1;
                }

                xC`).concat(v," = vec4(xTexelC").concat(v,".zw, xTexelC").concat(v+1,`.zw);
              `),v+1<f&&(p+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC`.concat(v+1," = vec4(xTexelC").concat(v+1,`.xy, final.xy);
                `))):(p+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC`.concat(v,`Ready == 0) {
                  xTexelC`).concat(v,` = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC`).concat(v,`.zw = vec2(0.0);
                  }
                  xTexelC`).concat(v,`Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`).concat(v+1,`Ready == 0) {
                  xTexelC`).concat(v+1,` = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC`).concat(v+1,`.zw = vec2(0.);
                  }
                  xTexelC`).concat(v+1,`Ready = 1;
                }

                xC`).concat(v,` = vec4(
                  xTexelC`).concat(v,".xy, xTexelC").concat(v+1,`.xy);
              `),v+1<f&&(p+=`
                  xC`.concat(v+1," = vec4(xTexelC").concat(v,".zw, xTexelC").concat(v+1,`.zw);
                `))));v<f&&(p+=`
            wTexel = getW(r, `.concat(v,`, d1, q);
            dotProd += xC`).concat(v,` * vec4(wTexel.xz, wTexel.xz);
          `),v+1<f&&(p+=`
              wTexel = getW(r, `.concat(v+1,`, d1, q);
              dotProd += xC`).concat(v+1,` * vec4(wTexel.xz, wTexel.xz);
            `)))}p+=`
    }
  `,p+=`
      }
    `;var y="",w="";n&&(a?y=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `.concat(n,`
        }`):i?y=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          `.concat(n,`
        }`):y=`vec4 activation(vec4 x) {
          `.concat(n,`
        }`),w="result = activation(result);");var b=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      `.concat(y,`

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `).concat(o,`;
        int q = d2 - d1 * `).concat(o,`;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        `).concat(p,`

        vec4 result = dotProd - vec4(0.000000000000001);
        `).concat(b,`
        `).concat(w,`
        setOutput(result);
      }
    `)}return r})();function xTe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=n.strides,s=n.pad,u=n.dilations,c=n.dimRoundingMode,l=u;l==null&&(l=[1,1]),k.util.assert(k.backend_util.eitherStridesOrDilationsAreOne(o,l),function(){return"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(o," and dilations '").concat(l,"'")});var f=k.backend_util.computeConv2DInfo(a.shape,i.shape,o,l,s,c,!0),h;k.env().getBool("WEBGL_PACK_DEPTHWISECONV")&&f.strideWidth<=2&&f.outChannels/f.inChannels===1?h=new rR(f):h=new tR(f);var p=[[f.padInfo.top,f.padInfo.left],[f.strideHeight,f.strideWidth],[f.dilationHeight,f.dilationWidth],[f.inHeight,f.inWidth]];return t.runWebGLProgram(h,[a,i],"float32",p)}var kTe={kernelName:k.DepthwiseConv2dNative,backendName:"webgl",kernelFunc:xTe};var STe=(function(){function r(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,a=e.padInfo.top,i=e.padInfo.left,o=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `.concat(o,` + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < `).concat(e.batchSize,`; b++) {
          for (int yR = 0; yR < `).concat(e.outHeight,`; yR++) {
            int xR = wR + yR * `).concat(t," - ").concat(a,`;

            if (xR < 0 || xR >= `).concat(e.inHeight,`) {
              continue;
            }

            for (int yC = 0; yC < `).concat(e.outWidth,`; yC++) {
              int xC = wC + yC * `).concat(n," - ").concat(i,`;

              if (xC < 0 || xC >= `).concat(e.inWidth,`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `)}return r})(),ETe=(function(){function r(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,a=e.strideHeight,i=e.strideWidth,o=t-1-e.padInfo.top,s=n-1-e.padInfo.left,u=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`.concat(o,", ").concat(s,`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `).concat(t,`; wR++) {
          float dyR = float(dyRCorner + wR) / `).concat(a,`.0;

          if (dyR < 0.0 || dyR >= `).concat(e.outHeight,`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `).concat(t,` - 1 - wR;

          for (int wC = 0; wC < `).concat(n,`; wC++) {
            float dyC = float(dyCCorner + wC) / `).concat(i,`.0;

            if (dyC < 0.0 || dyC >= `).concat(e.outWidth,`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `).concat(n,` - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < `).concat(u,`; dm++) {
              int d2 = d1 * `).concat(u,` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `)}return r})();function TTe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.dy,o=n.strides,s=n.dilations,u=n.pad,c=n.dimRoundingMode,l=n.filterShape,f=k.backend_util.computeConv2DInfo(a.shape,l,o,s,u,c,!0),h=new STe(f);return t.runWebGLProgram(h,[a,i],"float32")}var NTe={kernelName:k.DepthwiseConv2dNativeBackpropFilter,backendName:"webgl",kernelFunc:TTe};function ITe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.filter,o=n.strides,s=n.dilations,u=n.pad,c=n.dimRoundingMode,l=n.inputShape,f=k.backend_util.computeConv2DInfo(l,i.shape,o,s,u,c,!0),h=new ETe(f);return t.runWebGLProgram(h,[a,i],"float32")}var CTe={kernelName:k.DepthwiseConv2dNativeBackpropInput,backendName:"webgl",kernelFunc:ITe};var ATe=(function(){function r(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}return r})();function DTe(r){var e=r.inputs,t=r.backend,n=e.x,a=ir(ir([],Ee(n.shape),!1),Ee(n.shape),!1),i=k.util.sizeFromShape(n.shape),o=Ce({inputs:{x:n},backend:t,attrs:{shape:[i]}}),s=new ATe(i),u=t.runWebGLProgram(s,[o],o.dtype),c=Ce({inputs:{x:u},backend:t,attrs:{shape:a}});return t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(u),c}var _Te={kernelName:k.Diag,backendName:"webgl",kernelFunc:DTe};var FTe=(function(){function r(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.inHeight,n=e.inWidth,a=e.padInfo,i=e.strideHeight,o=e.strideWidth,s=e.filterHeight,u=e.filterWidth,c=e.dilationHeight,l=e.dilationWidth,f=a.top,h=a.left;this.userCode=`
      const ivec2 strides = ivec2(`.concat(i,", ").concat(o,`);
      const ivec2 pads = ivec2(`).concat(f,", ").concat(h,`);
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < `).concat(s,`; h++) {
          int hIn = hBeg + h * `).concat(c,`;

          if (hIn >= 0 && hIn < `).concat(t,`) {
            for (int w = 0; w < `).concat(u,`; w++) {
              int wIn = wBeg + w * `).concat(l,`;

              if (wIn >= 0 && wIn < `).concat(n,`) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `)}return r})();function RTe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=n.strides,s=n.pad,u=n.dilations,c=k.backend_util.computeDilation2DInfo(a.shape,i.shape,o,s,"NHWC",u),l,f=new FTe(c);l=t.runWebGLProgram(f,[a,i],"float32");var h=Ce({inputs:{x:l},backend:t,attrs:{shape:c.outShape}});return t.disposeIntermediateTensorInfo(l),h}var OTe={kernelName:k.Dilation2D,backendName:"webgl",kernelFunc:RTe};function PTe(r){var e,t,n,a,i=r.inputs,o=r.backend,s=r.attrs,u=s.equation,c=i,l=k.backend_util.decodeEinsumEquation(u,c.length),f=l.allDims,h=l.summedDims,p=l.idDims;k.backend_util.checkEinsumDimSizes(f.length,p,c);for(var d=k.backend_util.getEinsumComputePath(h,p),m=d.path,v=d.steps,g=v.length,y=null,w=f.length,b=[],x=0;x<g;++x){try{for(var S=(e=void 0,ln(v[x])),T=S.next();!T.done;T=S.next()){var N=T.value,C=k.backend_util.getEinsumPermutation(w,p[N]),R=C.permutationIndices,_=C.expandDims,P=void 0;k.backend_util.isIdentityPermutation(R)?P=c[N]:(P=fn({inputs:{x:c[N]},backend:o,attrs:{perm:R}}),b.push(P));for(var $=P.shape.slice(),z=0;z<_.length;++z)$.splice(_[z],0,1);k.util.arraysEqual(P.shape,$)||(P=Ce({inputs:{x:P},backend:o,attrs:{shape:$}}),b.push(P)),y===null?y=P:(y=Nb({inputs:{a:P,b:y},backend:o}),b.push(y))}}catch(X){e={error:X}}finally{try{T&&!T.done&&(t=S.return)&&t.call(S)}finally{if(e)throw e.error}}x<g-1&&(m[x]>=0&&(y=ud({inputs:{x:y},backend:o,attrs:{axis:m[x]-(f.length-w),keepDims:!1}}),b.push(y)),w--)}try{for(var L=ln(b),B=L.next();!B.done;B=L.next()){var G=B.value;G!==y&&o.disposeIntermediateTensorInfo(G)}}catch(X){n={error:X}}finally{try{B&&!B.done&&(a=L.return)&&a.call(L)}finally{if(n)throw n.error}}return y}var MTe={kernelName:k.Einsum,backendName:"webgl",kernelFunc:PTe};var BTe="return (x >= 0.0) ? x : (exp(x) - 1.0);",LTe=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,zTe=bt({opSnippet:BTe,packedOpSnippet:LTe}),$Te={kernelName:k.Elu,backendName:"webgl",kernelFunc:zTe};var WTe="return (b >= 0.0) ? a : a * (b + 1.0);",GTe=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,VTe=function(r){var e=r.inputs,t=r.backend,n=e.dy,a=e.y,i=k.env().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ju(GTe,n.shape,a.shape):new Os(WTe,n.shape,a.shape);return t.runWebGLProgram(i,[n,a],n.dtype)},UTe={kernelName:k.EluGrad,backendName:"webgl",kernelFunc:VTe};var HTe=`
  return vec4(equal(a, b));
`,qTe="return float(a == b);",KTe=Yr({opSnippet:qTe,packedOpSnippet:HTe,dtype:"bool",cpuKernelImpl:Ske}),jTe={kernelName:k.Equal,backendName:"webgl",kernelFunc:KTe};var XTe=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = `.concat(k.backend_util.ERF_P,`;
  float a1 = `).concat(k.backend_util.ERF_A1,`;
  float a2 = `).concat(k.backend_util.ERF_A2,`;
  float a3 = `).concat(k.backend_util.ERF_A3,`;
  float a4 = `).concat(k.backend_util.ERF_A4,`;
  float a5 = `).concat(k.backend_util.ERF_A5,`;

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`),YTe=bt({opSnippet:XTe}),ZTe={kernelName:k.Erf,backendName:"webgl",kernelFunc:YTe};var JTe=Qu+`
  return exp(x);
`,QTe=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,nR=bt({opSnippet:JTe,packedOpSnippet:QTe,cpuKernelImpl:Eke,dtype:"float32"}),eNe={kernelName:k.Exp,backendName:"webgl",kernelFunc:nR};function hb(r){var e=r.inputs,t=r.attrs,n=r.backend,a=t.dim,i=e.input,o=i.shape.length,s=i.shape.slice(),u=a;return a<0&&(k.util.assert(-(o+1)<=a,function(){return"Axis must be in the interval [".concat(-(o+1),", ").concat(o,"]")}),u=o+a+1),s.splice(u,0,1),Ce({inputs:{x:i},backend:n,attrs:{shape:s}})}var tNe={kernelName:k.ExpandDims,backendName:"webgl",kernelFunc:hb};var D3="return exp(x) - 1.0;",rNe=bt({opSnippet:D3,packedOpSnippet:D3,cpuKernelImpl:Tke}),nNe={kernelName:k.Expm1,backendName:"webgl",kernelFunc:rNe};var _3=(function(){function r(e,t,n){this.variableNames=["real","imag"];var a=t[1];this.outputShape=t;var i=n?"2.0 * ".concat(Math.PI):"-2.0 * ".concat(Math.PI),o=n?"".concat(a,".0"):"1.0",s;if(e==="real")s="return real * expR - imag * expI;";else if(e==="imag")s="return real * expI + imag * expR;";else throw new Error('FFT component must be either "real" or "imag", got '.concat(e,"."));this.userCode=`
      const float exponentMultiplier = `.concat(i,`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `).concat(s,`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`).concat(a,`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `).concat(a,`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `).concat(o,`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `)}return r})();function aR(r,e,t){var n=t.texData.get(r.dataId),a=k.util.sizeFromShape(r.shape),i=r.shape[r.shape.length-1],o=a/i,s=Ce({inputs:{x:r},backend:t,attrs:{shape:[o,i]}}),u=s.shape,c=new _3("real",u,e),l=new _3("imag",u,e),f=[{dataId:n.complexTensorInfos.real.dataId,dtype:n.complexTensorInfos.real.dtype,shape:u},{dataId:n.complexTensorInfos.imag.dataId,dtype:n.complexTensorInfos.imag.dtype,shape:u}],h=t.runWebGLProgram(c,f,"float32"),p=t.runWebGLProgram(l,f,"float32"),d=Io({inputs:{real:h,imag:p},backend:t});t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(p);var m=Ce({inputs:{x:d},backend:t,attrs:{shape:r.shape}});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(d),m}function aNe(r){var e=r.inputs,t=r.backend,n=e.input;return aR(n,!1,t)}var iNe={kernelName:k.FFT,backendName:"webgl",kernelFunc:aNe};var oNe=(function(){function r(e,t){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return r})();function tf(r){var e=r.backend,t=r.attrs,n=t.shape,a=t.value,i=t.dtype;if(i=i||k.util.inferDtype(a),i==="string"){var o=k.util.getArrayFromDType(i,k.util.sizeFromShape(n));return o.fill(a),e.makeTensorInfo(n,i,o)}else{var s=new oNe(n,a),u=[[a]];return e.runWebGLProgram(s,[],i,u)}}var sNe={kernelName:k.Fill,backendName:"webgl",kernelFunc:tf};var uNe=(function(){function r(e){this.variableNames=["Image"],this.outputShape=[];var t=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = `.concat(t,` - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < `).concat(t,`) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `)}return r})();var cNe={kernelName:k.FlipLeftRight,backendName:"webgl",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=e.image,a=t,i=new uNe(n.shape),o=a.runWebGLProgram(i,[n],n.dtype);return o}};var F3="return floor(x);",lNe=bt({opSnippet:F3,packedOpSnippet:F3,cpuKernelImpl:Nke}),fNe={kernelName:k.Floor,backendName:"webgl",kernelFunc:lNe};var hNe=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,pNe=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,dNe=Yr({opSnippet:hNe,packedOpSnippet:pNe,dtype:"int32"}),vNe={kernelName:k.FloorDiv,backendName:"webgl",kernelFunc:dNe},mNe=(function(){function r(e){this.variableNames=["A"];var t=hn(),n=Ee(e,2),a=n[0],i=n[1];this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`.concat(i,".0, ").concat(a,`.0);

        vec4 values = `).concat(t.texture2D,`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `)}return r})(),gNe=(function(){function r(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var t=hn(),n=Ee(e,2),a=n[0],i=n[1];this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(`.concat(i,".0, ").concat(a,`.0);
            vec4 values = `).concat(t.texture2D,`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `).concat(t.output,` = result;
      }
    `)}return r})(),yNe={kernelName:k.FromPixels,backendName:"webgl",kernelFunc:bNe},Gu,nb=k.env().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function bNe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.pixels,i=n.numChannels,o=typeof HTMLVideoElement<"u"&&a instanceof HTMLVideoElement,s=typeof HTMLImageElement<"u"&&a instanceof HTMLImageElement,u=Ee(o?[a.videoWidth,a.videoHeight]:[a.width,a.height],2),c=u[0],l=u[1],f=[l,c],h=[l,c,i];if(s||o){var p=k.env().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(Gu==null||p!==nb)&&(nb=p,Gu=document.createElement("canvas").getContext("2d",{willReadFrequently:nb})),Gu.canvas.width=c,Gu.canvas.height=l,Gu.drawImage(a,0,0,c,l),a=Gu.canvas}var d=t.makeTensorInfo(f,"int32");t.texData.get(d.dataId).usage=aa.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(d.dataId),a);var m=k.env().getBool("WEBGL_PACK")?new gNe(h):new mNe(h),v=t.runWebGLProgram(m,[d],"int32");return t.disposeData(d.dataId),v}function wNe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=e.bias,s=e.preluActivationWeights,u=n.strides,c=n.pad,l=n.dataFormat,f=n.dilations,h=n.dimRoundingMode,p=n.activation,d=n.leakyreluAlpha,m=k.backend_util.convertConv2DDataFormat(l),v=k.backend_util.computeConv2DInfo(a.shape,i.shape,u,f,c,h,!1,m),g,y=[],w=o!=null,b=s!=null,x=p==="leakyrelu",S=function(){var $=[a,i],z=function(B,G){if(G==="NCHW"&&B.shape.length===1&&B.shape[0]!==1){var X=Ce({inputs:{x:B},backend:t,attrs:{shape:[B.shape[0],1,1]}});return y.push(X),X}return B};if(w&&$.push(z(o,l)),b&&$.push(z(s,l)),x){var L=t.makeTensorInfo([],"float32",k.util.createScalarValue(d,"float32"));$.push(L),y.push(L)}return $};if(v.filterHeight===1&&v.filterWidth===1&&v.dilationHeight===1&&v.dilationWidth===1&&v.strideHeight===1&&v.strideWidth===1&&(v.padInfo.type==="SAME"||v.padInfo.type==="VALID"))g=JF({x:a,filter:i,convInfo:v,backend:t,bias:o,activation:p,preluActivationWeights:s,leakyreluAlpha:d});else if(v.strideWidth<=2&&m==="channelsLast"&&k.env().getBool("WEBGL_EXP_CONV")){var T=p?Xl(p,!0):null,N=new ZF(v,w,T,b,x),C=[[v.padInfo.top,v.padInfo.left],[v.strideHeight,v.strideWidth],[v.dilationHeight,v.dilationWidth],[v.inHeight,v.inWidth]],R=S();g=t.runWebGLProgram(N,R,"float32",C)}else if(k.env().getBool("WEBGL_CONV_IM2COL"))g=QF({x:a,filter:i,convInfo:v,backend:t,bias:o,activation:p,preluActivationWeights:s,leakyreluAlpha:d});else{var T=p?Xl(p,!1):null,N=new YF(v,w,T,b,x),_=S();g=t.runWebGLProgram(N,_,"float32")}var P=Ce({inputs:{x:g},backend:t,attrs:{shape:v.outShape}});return y.push(g),y.forEach(function($){return t.disposeIntermediateTensorInfo($)}),P}var xNe={kernelName:k.FusedConv2D,backendName:"webgl",kernelFunc:wNe};function kNe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=e.bias,s=e.preluActivationWeights,u=n.strides,c=n.pad,l=n.dilations,f=n.dimRoundingMode,h=n.activation,p=n.leakyreluAlpha,d=[],m=l;m==null&&(m=[1,1]),k.util.assert(k.backend_util.eitherStridesOrDilationsAreOne(u,m),function(){return"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(u," and dilations '").concat(m,"'")});var v=k.backend_util.computeConv2DInfo(a.shape,i.shape,u,m,c,f,!0),g=k.env().getBool("WEBGL_PACK_DEPTHWISECONV")&&v.strideWidth<=2&&v.outChannels/v.inChannels===1,y=h?Xl(h,g):null,w=[a,i],b=o!=null,x=s!=null,S=h==="leakyrelu";if(b&&w.push(o),x&&w.push(s),S){var T=t.makeTensorInfo([],"float32",k.util.createScalarValue(p,"float32"));w.push(T),d.push(T)}var N;g?N=new rR(v,b,y,x,S):N=new tR(v,b,y,x,S);var C=[[v.padInfo.top,v.padInfo.left],[v.strideHeight,v.strideWidth],[v.dilationHeight,v.dilationWidth],[v.inHeight,v.inWidth]],R=t.runWebGLProgram(N,w,"float32",C);return d.forEach(function(_){return t.disposeIntermediateTensorInfo(_)}),R}var SNe={kernelName:k.FusedDepthwiseConv2D,backendName:"webgl",kernelFunc:kNe},ENe=(function(){function r(e,t,n,a){this.sliceDim=e,this.strides=t,this.paramsShape=a,this.variableNames=["x","indices"],this.outputShape=n;for(var i=Ft(n.length),o=`
    int index;`,s=0;s<this.sliceDim;s++)o+=`
          index = round(getIndices(coords[0], `.concat(s,`));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= `).concat(this.paramsShape[s],`;
          flattenIndex += index * `).concat(this.strides[s],";");this.userCode=`
         void main() {
          `.concat(i,` coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          `).concat(o,`

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `)}return r})();function TNe(r){var e=r.inputs,t=r.backend,n=e.params,a=e.indices,i=a.shape,o=i[i.length-1],s=k.util.sizeFromShape(n.shape),u=Ee(k.backend_util.prepareAndValidate(n,a),4),c=u[0],l=u[1],f=u[2],h=u[3],p=Ce({inputs:{x:a},backend:t,attrs:{shape:[l,o]}}),d=Ce({inputs:{x:n},backend:t,attrs:{shape:[k.util.sizeFromShape(n.shape)/f,f]}});if(t.shouldExecuteOnCPU([n,a])||n.dtype==="string"){var m=t.readSync(a.dataId),v=t.bufferSync(n),g=Ike(m,v,n.dtype,l,o,f,h,n.shape,s);return t.makeTensorInfo(c,n.dtype,g.values)}var y=new ENe(o,h,[l,f],n.shape),w=t.runWebGLProgram(y,[d,p],d.dtype),b=Ce({inputs:{x:w},backend:t,attrs:{shape:c}});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(w),b}var NNe={kernelName:k.GatherNd,backendName:"webgl",kernelFunc:TNe};var INe=(function(){function r(e,t){this.variableNames=["A","indices"],this.outputShape=t,this.rank=t.length;var n=Ft(this.rank),a=CNe(e);this.userCode=`
      void main() {
        `.concat(n,` resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < `).concat(e[2],`) ? 1.0 : 0.0;
        setOutput(inBounds * getA(`).concat(a,`));
      }
    `)}return r})();function CNe(r,e){for(var t=["resRC.x","resRC.y","resRC.z","resRC.w"],n=[],a=0;a<r.length;a++)a===2?n.push("index"):n.push("".concat(t[a]));return n.join()}function iR(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.indices,o=n.axis,s=n.batchDims,u=k.util.parseAxisParam(o,a.shape)[0];if(k.env().get("DEBUG"))for(var c=t.readSync(i.dataId),l=a.shape[u],f=function(C){var R=c[C];k.util.assert(R<=l-1&&R>=0,function(){return"GatherV2: the index value ".concat(R," is not in [0, ").concat(l-1,"]")})},h=0;h<c.length;++h)f(h);var p=k.backend_util.segment_util.collectGatherOpShapeInfo(a,i,u,s),d=k.util.sizeFromShape(i.shape),m=[],v=Ce({inputs:{x:a},backend:t,attrs:{shape:[p.batchSize,p.outerSize,p.dimSize,p.sliceSize]}}),g=Ce({inputs:{x:i},backend:t,attrs:{shape:[p.batchSize,d/p.batchSize]}});m.push(v),m.push(g);var y=[p.batchSize,p.outerSize,d/p.batchSize,p.sliceSize];if(t.shouldExecuteOnCPU([a,i])||a.dtype==="string"){var w=t.bufferSync(g),b=t.bufferSync(v),x=Cke(b,w,y);return m.forEach(function(C){return t.disposeIntermediateTensorInfo(C)}),t.makeTensorInfo(p.outputShape,x.dtype,x.values)}var S=new INe(v.shape,y),T=t.runWebGLProgram(S,[v,g],v.dtype);m.push(T);var N=Ce({inputs:{x:T},backend:t,attrs:{shape:p.outputShape}});return m.forEach(function(C){return t.disposeIntermediateTensorInfo(C)}),N}var ANe={kernelName:k.GatherV2,backendName:"webgl",kernelFunc:iR};var DNe="return float(a > b);",_Ne=`
  return vec4(greaterThan(a, b));
`,FNe=Yr({opSnippet:DNe,packedOpSnippet:_Ne,cpuKernelImpl:Ake,dtype:"bool"}),RNe={kernelName:k.Greater,backendName:"webgl",kernelFunc:FNe};var ONe="return float(a >= b);",PNe=`
  return vec4(greaterThanEqual(a, b));
`,MNe=Yr({opSnippet:ONe,packedOpSnippet:PNe,dtype:"bool",cpuKernelImpl:Dke}),BNe={kernelName:k.GreaterEqual,backendName:"webgl",kernelFunc:MNe};function LNe(r){var e=r.inputs,t=r.backend,n=e.input;return aR(n,!0,t)}var zNe={kernelName:k.IFFT,backendName:"webgl",kernelFunc:LNe};var $Ne="return float(!isnan(x) && !isinf(x));",WNe=bt({opSnippet:$Ne,dtype:"bool"}),GNe={kernelName:k.IsFinite,backendName:"webgl",kernelFunc:WNe};var VNe="return float(isinf(x));",UNe=bt({opSnippet:VNe,dtype:"bool"}),HNe={kernelName:k.IsInf,backendName:"webgl",kernelFunc:UNe};var qNe="return float(isnan(x));",KNe=bt({opSnippet:qNe,dtype:"bool"}),jNe={kernelName:k.IsNan,backendName:"webgl",kernelFunc:KNe};var XNe="return float(a < b);",YNe=`
  return vec4(lessThan(a, b));
`,ZNe=Yr({opSnippet:XNe,packedOpSnippet:YNe,cpuKernelImpl:_ke,dtype:"bool"}),JNe={kernelName:k.Less,backendName:"webgl",kernelFunc:ZNe};var QNe="return float(a <= b);",eIe=`
  return vec4(lessThanEqual(a, b));
`,tIe=Yr({opSnippet:QNe,packedOpSnippet:eIe,cpuKernelImpl:Fke,dtype:"bool"}),rIe={kernelName:k.LessEqual,backendName:"webgl",kernelFunc:tIe};function nIe(r){var e=r.backend,t=r.attrs,n=t.start,a=t.stop,i=t.num,o=Rke(n,a,i);return e.makeTensorInfo([o.length],"float32",o)}var aIe={kernelName:k.LinSpace,backendName:"webgl",kernelFunc:nIe};var iIe=Qu+`
  return x < 0.0 ? 0./0. : log(x);
`,oIe=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,sIe=bt({opSnippet:iIe,packedOpSnippet:oIe,cpuKernelImpl:Oke}),uIe={kernelName:k.Log,backendName:"webgl",kernelFunc:sIe};var cIe=Qu+`
  return log(1.0 + x);
`,lIe=bt({opSnippet:cIe}),fIe={kernelName:k.Log1p,backendName:"webgl",kernelFunc:lIe};var hIe="return float(a >= 1.0 && b >= 1.0);",pIe=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,dIe=Yr({opSnippet:hIe,packedOpSnippet:pIe,dtype:"bool"}),vIe={kernelName:k.LogicalAnd,backendName:"webgl",kernelFunc:dIe};var mIe="return float(!(x >= 1.0));",gIe=bt({opSnippet:mIe}),yIe={kernelName:k.LogicalNot,backendName:"webgl",kernelFunc:gIe};var bIe="return float(a >= 1.0 || b >= 1.0);",wIe=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,xIe=Yr({opSnippet:bIe,packedOpSnippet:wIe,dtype:"bool"}),kIe={kernelName:k.LogicalOr,backendName:"webgl",kernelFunc:xIe};var SIe=(function(){function r(e,t,n,a,i){this.variableNames=["x"],this.outputShape=[];var o=t,s=e[3]-1;this.outputShape=e;var u,c="float(".concat(n,") + float(").concat(a,") * sum");i===.5?u="inversesqrt(".concat(c,")"):i===1?u="1.0/(".concat(c,")"):u="exp(log(".concat(c,") * float(-").concat(i,"));"),this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`.concat(o,"; j <= ").concat(o,`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `).concat(s,`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `).concat(u,`;
        setOutput(val);
      }
    `)}return r})();var EIe=(function(){function r(e,t,n,a,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var o=t,s=e[3]-1;this.outputShape=e;var u,c="float(".concat(n,") + float(").concat(a,") * sum");i===.5?u="inversesqrt(".concat(c,")"):i===1?u="1.0/(".concat(c,")"):u="exp(log(".concat(c,") * float(-").concat(i,"));"),this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `.concat(this.outputShape[3],`;
        bool hasNextRow = c < `).concat(this.outputShape[2],`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `).concat(o,`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `).concat(o,"; j <= ").concat(o,`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`).concat(s,`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `).concat(u,`;
        setOutput(result);
      }
    `)}return r})();var TIe=function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.depthRadius,o=n.bias,s=n.alpha,u=n.beta,c=k.env().getBool("WEBGL_PACK_NORMALIZATION")?new EIe(a.shape,i,o,s,u):new SIe(a.shape,i,o,s,u);return t.runWebGLProgram(c,[a],a.dtype)},NIe={kernelName:k.LRN,backendName:"webgl",kernelFunc:TIe};var IIe=(function(){function r(e,t,n,a,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=n,this.alpha=a,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `.concat(this.depth,`; ++d) {
          int depthBegin = int(max(0.0, float(d - `).concat(t,`)));
          int depthEnd = int(min(float(`).concat(this.depth,`),
              float(d + `).concat(t,` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `).concat(this.depth,`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`).concat(a,") * norm + float(").concat(n,`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`).concat(a,`)
                * float(`).concat(i,`)
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `).concat(i,`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `)}return r})();var CIe=function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.y,o=e.dy,s=n.depthRadius,u=n.bias,c=n.alpha,l=n.beta,f=new IIe(a.shape,s,u,c,l);return t.runWebGLProgram(f,[a,i,o],a.dtype)},AIe={kernelName:k.LRNGrad,backendName:"webgl",kernelFunc:CIe};function DIe(r,e,t,n){var a=k.util.sizeFromShape(e),i=k.util.sizeFromShape(r.shape),o=i/a,s=Ce({inputs:{x:r},attrs:{shape:[o,a]},backend:n}),u=Ls(s,r.dtype,"max",n),c=Ce({inputs:{x:u},attrs:{shape:t},backend:n});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(u),c}function oR(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.reductionIndices,o=n.keepDims,s=a.shape.length,u=k.util.parseAxisParam(i,a.shape),c=u,l=k.backend_util.getAxesPermutation(c,s),f=l!=null,h=t.shouldExecuteOnCPU([a]),p=a;if(f){if(h){for(var d=t.texData.get(p.dataId),m=d.values,v=new Array(s),g=0;g<v.length;g++)v[g]=a.shape[l[g]];var y=Sb(m,a.shape,a.dtype,l,v);p=t.makeTensorInfo(v,a.dtype);var w=t.texData.get(p.dataId);w.values=y}else p=sd(a,l,t);c=k.backend_util.getInnerMostAxes(c.length,s)}k.backend_util.assertAxesAreInnerMostDims("max",c,s);var b=Ee(k.backend_util.computeOutAndReduceShapes(p.shape,c),2),x=b[0],S=b[1],T=x;o&&(T=k.backend_util.expandShapeToKeepDim(x,u));var N;if(h){var d=t.texData.get(p.dataId),m=d.values,C=Pke(m,k.util.sizeFromShape(S),T,a.dtype);N=t.makeTensorInfo(T,a.dtype);var R=t.texData.get(N.dataId);R.values=C}else N=DIe(p,S,T,t);return f&&t.disposeIntermediateTensorInfo(p),N}var _Ie={kernelName:k.Max,backendName:"webgl",kernelFunc:oR};var FIe=Tb+`
  return max(a, b);
`,RIe=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Bs+`
  return result;
`,OIe=Yr({opSnippet:FIe,packedOpSnippet:RIe,cpuKernelImpl:Mke}),PIe={kernelName:k.Maximum,backendName:"webgl",kernelFunc:OIe};function MIe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x;Ku(a,"maxPool");var i=n.filterSize,o=n.strides,s=n.pad,u=n.dimRoundingMode,c=1;k.util.assert(k.backend_util.eitherStridesOrDilationsAreOne(o,c),function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(c,"'")});var l=k.backend_util.computePool2DInfo(a.shape,i,o,c,s,u);if(l.filterWidth===1&&l.filterHeight===1&&k.util.arraysEqual(l.inShape,l.outShape))return Kn({inputs:{x:a},backend:t});var f=new Yl(l,"max",!1);return t.runWebGLProgram(f,[a],a.dtype)}var BIe={kernelName:k.MaxPool,backendName:"webgl",kernelFunc:MIe};function LIe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.filterSize,o=n.strides,s=n.pad,u=n.dataFormat,c=n.dimRoundingMode,l=[1,1,1],f=k.backend_util.computePool3DInfo(a.shape,i,o,l,s,c,u),h=new Ib(f,"max",!1);return t.runWebGLProgram(h,[a],a.dtype)}var zIe={kernelName:k.MaxPool3D,backendName:"webgl",kernelFunc:LIe};var $Ie=(function(){function r(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideHeight,n=e.strideWidth,a=e.dilationHeight,i=e.effectiveFilterHeight,o=e.effectiveFilterWidth,s=i-1-e.padInfo.top,u=o-1-e.padInfo.left,c=i*o-1;this.userCode=`
      const ivec2 pads = ivec2(`.concat(s,", ").concat(u,`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `).concat(i,`;
          wR += `).concat(a,`) {
          float dyR = float(dyRCorner + wR) / `).concat(t,`.0;

          if (dyR < 0.0 || dyR >= `).concat(e.outHeight,`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `).concat(o,`; wC++) {
            float dyC = float(dyCCorner + wC) / `).concat(n,`.0;

            if (dyC < 0.0 || dyC >= `).concat(e.outWidth,`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `).concat(c,` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `).concat(o,` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `)}return r})(),WIe=(function(){function r(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideDepth,n=e.strideHeight,a=e.strideWidth,i=e.dilationDepth,o=e.dilationHeight,s=e.dilationWidth,u=e.effectiveFilterDepth,c=e.effectiveFilterHeight,l=e.effectiveFilterWidth,f=u-1-e.padInfo.front,h=c-1-e.padInfo.top,p=l-1-e.padInfo.left,d=u*c*l-1;this.userCode=`
      const ivec3 pads = ivec3(`.concat(f,", ").concat(h,", ").concat(p,`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `).concat(u,`;
           wD += `).concat(i,`) {
          float dyD = float(dyDCorner + wD) / `).concat(t,`.0;

          if (dyD < 0.0 || dyD >= `).concat(e.outDepth,`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `).concat(c,`;
              wR += `).concat(o,`) {
            float dyR = float(dyRCorner + wR) / `).concat(n,`.0;

            if (dyR < 0.0 || dyR >= `).concat(e.outHeight,`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `).concat(l,`;
                wC += `).concat(s,`) {
              float dyC = float(dyCCorner + wC) / `).concat(a,`.0;

              if (dyC < 0.0 || dyC >= `).concat(e.outWidth,`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = `).concat(d,` -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * `).concat(c," * ").concat(l,` +
                  wR * `).concat(l,` + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `)}return r})();function GIe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.input,o=i,s=n.filterSize,u=n.strides,c=n.pad,l=n.dimRoundingMode,f=[1,1,1],h=k.backend_util.computePool3DInfo(o.shape,s,u,f,c,l),p=new Ib(h,"max",!0),d=t.runWebGLProgram(p,[o],o.dtype),m=new WIe(h),v=t.runWebGLProgram(m,[a,d],o.dtype);return t.disposeIntermediateTensorInfo(d),v}var VIe={kernelName:k.MaxPool3DGrad,backendName:"webgl",kernelFunc:GIe};function UIe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.input,o=e.output,s=i;Ku([i,o],"maxPoolGrad");var u=n.filterSize,c=n.strides,l=n.pad,f=n.dimRoundingMode,h=k.backend_util.computePool2DInfo(s.shape,u,c,1,l,f),p=!0,d=new Yl(h,"max",p),m=t.runWebGLProgram(d,[s],s.dtype),v=new $Ie(h),g=t.runWebGLProgram(v,[a,m],s.dtype);return t.disposeIntermediateTensorInfo(m),g}var HIe={kernelName:k.MaxPoolGrad,backendName:"webgl",kernelFunc:UIe};function qIe(r,e,t,n){var a=new Yl(t,"max",!1),i=n.runWebGLProgram(a,[r],"float32");a=new Yl(t,"max",!0,!0,e);var o=n.runWebGLProgram(a,[r],"float32");return[i,o]}var KIe={kernelName:k.MaxPoolWithArgmax,backendName:"webgl",kernelFunc:function(r){var e=r.inputs,t=r.attrs,n=r.backend,a=e.x,i=t.filterSize,o=t.strides,s=t.pad,u=t.includeBatchInIndex,c=n;k.util.assert(a.shape.length===4,function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(a.shape.length,".")});var l=[1,1];k.util.assert(k.backend_util.eitherStridesOrDilationsAreOne(o,l),function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(l,"'")});var f=k.backend_util.computePool2DInfo(a.shape,i,o,l,s),h=Ee(qIe(a,u,f,c),2),p=h[0],d=h[1];return[p,d]}};function jIe(r,e,t,n){var a=k.util.sizeFromShape(e),i=k.util.sizeFromShape(r.shape),o=i/a,s=Ce({inputs:{x:r},attrs:{shape:[o,a]},backend:n}),u=Ls(s,"float32","mean",n),c=Ce({inputs:{x:u},attrs:{shape:t},backend:n});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(u),c}var XIe={kernelName:k.Mean,backendName:"webgl",kernelFunc:function(r){var e,t,n=r.inputs,a=r.attrs,i=r.backend,o=n.x,s=a.keepDims,u=a.axis,c=i,l=o.shape.length,f=k.util.parseAxisParam(u,o.shape),h=f,p=k.backend_util.getAxesPermutation(h,l),d=p!=null,m=c.shouldExecuteOnCPU([o]),v=[],g=o;if(d){if(m){for(var y=c.texData.get(g.dataId),w=y.values,b=new Array(l),x=0;x<b.length;x++)b[x]=o.shape[p[x]];var S=Sb(w,o.shape,o.dtype,p,b);g=c.makeTensorInfo(b,o.dtype);var T=c.texData.get(g.dataId);T.values=S}else g=sd(o,p,c);v.push(g),h=k.backend_util.getInnerMostAxes(h.length,l)}k.backend_util.assertAxesAreInnerMostDims("sum",h,l);var N=Ee(k.backend_util.computeOutAndReduceShapes(g.shape,h),2),C=N[0],R=N[1],_=C;s&&(_=k.backend_util.expandShapeToKeepDim(C,f));var P=jIe(g,R,_,c);try{for(var $=ln(v),z=$.next();!z.done;z=$.next()){var x=z.value;c.disposeIntermediateTensorInfo(x)}}catch(L){e={error:L}}finally{try{z&&!z.done&&(t=$.return)&&t.call($)}finally{if(e)throw e.error}}return P}};function YIe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims,s=a.shape.length,u=k.util.parseAxisParam(i,a.shape),c=u,l=k.backend_util.getAxesPermutation(c,s),f=a;l!=null&&(f=fn({inputs:{x:a},backend:t,attrs:{perm:l}}),c=k.backend_util.getInnerMostAxes(c.length,a.shape.length)),k.backend_util.assertAxesAreInnerMostDims("min",c,s);var h=Ee(k.backend_util.computeOutAndReduceShapes(f.shape,c),2),p=h[0],d=h[1],m=k.util.sizeFromShape(d),v=Ce({inputs:{x:f},backend:t,attrs:{shape:[-1,m]}}),g=Ls(v,v.dtype,"min",t),y;if(o){var w=k.backend_util.expandShapeToKeepDim(p,u);y=Ce({inputs:{x:g},backend:t,attrs:{shape:w}})}else y=Ce({inputs:{x:g},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(g),l!=null&&t.disposeIntermediateTensorInfo(f),y}var ZIe={kernelName:k.Min,backendName:"webgl",kernelFunc:YIe};var JIe=Tb+`
  return min(a, b);
`,QIe=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Bs+`
  return result;
`,eCe=Yr({opSnippet:JIe,packedOpSnippet:QIe,cpuKernelImpl:Bke}),tCe={kernelName:k.Minimum,backendName:"webgl",kernelFunc:eCe};var rCe=(function(){function r(e,t,n){this.variableNames=["x"],this.outputShape=t.map(function(l,f){return l[0]+e[f]+l[1]});var a=e.length,i=Ft(a),o=t.map(function(l){return l[0]}).join(","),s=t.map(function(l,f){return l[0]+e[f]}).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a),c=n==="reflect"?0:1;if(a===1){this.userCode=`
        int start = `.concat(o,`;
        int end = `).concat(s,`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - `).concat(c,`;
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + `).concat(c,`;
          }
          setOutput(getX(outC - start));
        }
      `);return}this.userCode=`
      `.concat(i," start = ").concat(i,"(").concat(o,`);
      `).concat(i," end = ").concat(i,"(").concat(s,`);

      void main() {
        `).concat(i,` outC = getOutputCoords();
        for (int i = 0; i < `).concat(a,`; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - `).concat(c,`;
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + `).concat(c,`;
          }
        }
        `).concat(i,` coords = outC - start;
        setOutput(getX(`).concat(u,`));
      }
    `)}return r})();var nCe=(function(){function r(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map(function(m,v){return m[0]+e[v]+m[1]});var a=e.length,i=Ft(a),o=t.map(function(m){return m[0]}).join(","),s=t.map(function(m,v){return m[0]+e[v]}).join(","),u=cn("rc",a),c=cn("source",a),l="".concat(u[a-1]," < ").concat(this.outputShape[a-1]),f=a===1?"source":"vec2(".concat(c.slice(-2).join(),")"),h=n==="reflect"?0:1,p="";if(a===1){var d=`
        `.concat(i,` source = rc;
        if (source < start) {
          source = start * 2 - source - `).concat(h,`;
        } else if (source >= end) {
          source = (end - 1) * 2 - source + `).concat(h,`;
        }
        source -= start;
      `);p=`
        `.concat(i,` rc = outputLoc;
        `).concat(d,`
        result[0] = getChannel(getX(`).concat(c.join(),"), ").concat(f,`);
        `).concat(u[a-1],` += 1;
        if(`).concat(l,`) {
          `).concat(d,`
          result[1] = getChannel(getX(`).concat(c.join(),"), ").concat(f,`);
        }
      `)}else{var d=`
        `.concat(i,` source = rc;
        `).concat(i," lt = ").concat(i,`(lessThan(source, start));
        `).concat(i," gte = ").concat(i,`(greaterThanEqual(source, end));
        `).concat(i,` orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - `).concat(h,`) +
                gte * ((end - 1) * 2 - source + `).concat(h,`);
        source -= start;
      `);p=`
        `.concat(i,` rc = outputLoc;
        `).concat(d,`
        result[0] = getChannel(getX(`).concat(c.join(),"), ").concat(f,`);
        `).concat(u[a-1],` += 1;
        if(`).concat(l,`) {
          `).concat(d,`
          result[1] = getChannel(getX(`).concat(c.join(),"), ").concat(f,`);
        }
        rc = outputLoc;
        `).concat(u[a-2],` += 1;
        if(`).concat(u[a-2]," < ").concat(this.outputShape[a-2],`) {
          `).concat(d,`
          result[2] = getChannel(getX(`).concat(c.join(),"), ").concat(f,`);
          `).concat(u[a-1],` += 1;
          if(`).concat(l,`) {
            `).concat(d,`
            result[3] = getChannel(getX(`).concat(c.join(),"), ").concat(f,`);
          }
        }
      `)}this.userCode=`
      const `.concat(i," start = ").concat(i,"(").concat(o,`);
      const `).concat(i," end = ").concat(i,"(").concat(s,`);

      void main() {
        `).concat(i,` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `).concat(p,`
        setOutput(result);
      }
    `)}return r})();var aCe=function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.paddings,o=n.mode,s=k.env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new nCe(a.shape,i,o):new rCe(a.shape,i,o),u=t.runWebGLProgram(s,[a],a.dtype);return u},iCe={kernelName:k.MirrorPad,backendName:"webgl",kernelFunc:aCe};var oCe=`if (b == 0.0) return NAN;
  return mod(a, b);`,sCe=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+Bs+`
  return result;
`,uCe=Yr({opSnippet:oCe,packedOpSnippet:sCe}),cCe={kernelName:k.Mod,backendName:"webgl",kernelFunc:uCe};var lCe=(function(){function r(e,t,n){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,n],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `.concat(t-1,`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`).concat(t-1,`));
      }
    `)}return r})();var fCe=`
if (a == b) {
  return 1.0;
};
return a / b;`,hCe=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,sR=Yr({opSnippet:fCe,packedOpSnippet:hCe,checkOutOfBounds:!0}),pCe={kernelName:k.RealDiv,backendName:"webgl",kernelFunc:sR};var R3="return a - b;",uR=Yr({opSnippet:R3,packedOpSnippet:R3,supportsComplex:!0,cpuKernelImpl:a2e}),dCe={kernelName:k.Sub,backendName:"webgl",kernelFunc:uR};function cR(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.logits,i=n.dim,o=k.util.parseAxisParam([i],a.shape),s=oR({inputs:{x:a},backend:t,attrs:{reductionIndices:o,keepDims:!1}}),u=k.backend_util.expandShapeToKeepDim(s.shape,o),c=Ce({inputs:{x:s},backend:t,attrs:{shape:u}}),l=uR({inputs:{a,b:c},backend:t}),f=nR({inputs:{x:l},backend:t}),h=ud({inputs:{x:f},backend:t,attrs:{axis:o,keepDims:!1}}),p=Ce({inputs:{x:h},backend:t,attrs:{shape:u}}),d=sR({inputs:{a:f,b:p},backend:t});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(p),d}var vCe={kernelName:k.Softmax,backendName:"webgl",kernelFunc:cR};function mCe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.logits,i=n.numSamples,o=n.seed,s=n.normalized,u=s?a:cR({inputs:{logits:a},backend:t,attrs:{dim:a.shape.length-1}}),c=u.shape[0],l=u.shape[1],f=new lCe(c,l,i),h=[[o]],p=t.runWebGLProgram(f,[u],"int32",h);return s||t.disposeIntermediateTensorInfo(u),p}var gCe={kernelName:k.Multinomial,backendName:"webgl",kernelFunc:mCe},yCe=Oa+`
  return -x;
`,bCe=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function wCe(r){var e=r.inputs,t=r.backend,n=e.x;if(t.shouldExecuteOnCPU([n])){var a=t.texData.get(n.dataId),i=Ee(zke(a.values,n.shape,n.dtype),2),o=i[0],s=i[1];return t.makeTensorInfo(s,n.dtype,o)}var u;return k.env().getBool("WEBGL_PACK_UNARY_OPERATIONS")?u=new No(n.shape,bCe):u=new yi(n.shape,yCe),t.runWebGLProgram(u,[n],n.dtype)}var xCe={kernelName:k.Neg,backendName:"webgl",kernelFunc:wCe};var kCe=k.kernel_impls.nonMaxSuppressionV3Impl;function SCe(r){k.backend_util.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var e=r.inputs,t=r.backend,n=r.attrs,a=e.boxes,i=e.scores,o=n.maxOutputSize,s=n.iouThreshold,u=n.scoreThreshold,c=t.readSync(a.dataId),l=t.readSync(i.dataId),f=kCe(c,l,o,s,u).selectedIndices;return t.makeTensorInfo([f.length],"int32",new Int32Array(f))}var ECe={kernelName:k.NonMaxSuppressionV3,backendName:"webgl",kernelFunc:SCe};var TCe=k.kernel_impls.nonMaxSuppressionV4Impl;function NCe(r){k.backend_util.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var e=r.inputs,t=r.backend,n=r.attrs,a=e.boxes,i=e.scores,o=n.maxOutputSize,s=n.iouThreshold,u=n.scoreThreshold,c=n.padToMaxOutputSize,l=t.readSync(a.dataId),f=t.readSync(i.dataId),h=TCe(l,f,o,s,u,c),p=h.selectedIndices,d=h.validOutputs;return[t.makeTensorInfo([p.length],"int32",new Int32Array(p)),t.makeTensorInfo([],"int32",new Int32Array([d]))]}var ICe={kernelName:k.NonMaxSuppressionV4,backendName:"webgl",kernelFunc:NCe};var CCe=k.kernel_impls.nonMaxSuppressionV5Impl;function ACe(r){k.backend_util.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var e=r.inputs,t=r.backend,n=r.attrs,a=e.boxes,i=e.scores,o=n.maxOutputSize,s=n.iouThreshold,u=n.scoreThreshold,c=n.softNmsSigma,l=t.readSync(a.dataId),f=t.readSync(i.dataId),h=o,p=s,d=u,m=c,v=CCe(l,f,h,p,d,m),g=v.selectedIndices,y=v.selectedScores;return[t.makeTensorInfo([g.length],"int32",new Int32Array(g)),t.makeTensorInfo([y.length],"float32",new Float32Array(y))]}var DCe={kernelName:k.NonMaxSuppressionV5,backendName:"webgl",kernelFunc:ACe};var _Ce=(function(){function r(e,t,n,a){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`.concat(a,"), float(").concat(n,`),
                      float(index == coords.y)));
      }
    `)}return r})(),FCe=function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.indices,i=n.dtype,o=n.depth,s=n.onValue,u=n.offValue,c=k.util.sizeFromShape(a.shape),l=new _Ce(c,o,s,u),f=Ce({inputs:{x:a},backend:t,attrs:{shape:[c]}}),h=t.runWebGLProgram(l,[f],i);t.disposeIntermediateTensorInfo(f);var p=ir(ir([],Ee(a.shape),!1),[o],!1),d=Ce({inputs:{x:h},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(h),d},RCe={kernelName:k.OneHot,backendName:"webgl",kernelFunc:FCe};function id(r){var e=r.inputs,t=r.backend,n=e.x;if(n.dtype==="complex64"){var a=ef({inputs:{input:n},backend:t}),i=id({inputs:{x:a},backend:t}),o=cd({inputs:{input:n},backend:t}),s=id({inputs:{x:o},backend:t}),u=Io({inputs:{real:i,imag:s},backend:t});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(s),u}else return tf({attrs:{shape:n.shape,dtype:n.dtype,value:n.dtype==="string"?"":0},backend:t})}var OCe={kernelName:k.ZerosLike,backendName:"webgl",kernelFunc:id};function lR(r){var e=r.inputs,t=r.backend,n=e.x;if(n.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(n.dtype==="complex64"){var a=ef({inputs:{input:n},backend:t}),i=lR({inputs:{x:a},backend:t}),o=cd({inputs:{input:n},backend:t}),s=id({inputs:{x:o},backend:t}),u=Io({inputs:{real:i,imag:s},backend:t});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(s),u}else return tf({attrs:{shape:n.shape,dtype:n.dtype,value:1},backend:t})}var PCe={kernelName:k.OnesLike,backendName:"webgl",kernelFunc:lR};function MCe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.axis;if(e.length===1)return hb({inputs:{input:e[0]},backend:t,attrs:{dim:a}});var i=e[0].shape,o=e[0].dtype;e.forEach(function(l){k.util.assertShapesMatch(i,l.shape,"All tensors passed to stack must have matching shapes"),k.util.assert(o===l.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var s=[],u=e.map(function(l){var f=hb({inputs:{input:l},backend:t,attrs:{dim:a}});return s.push(f),f}),c=XF({inputs:u,backend:t,attrs:{axis:a}});return s.forEach(function(l){return t.disposeIntermediateTensorInfo(l)}),c}var BCe={kernelName:k.Pack,backendName:"webgl",kernelFunc:MCe};var LCe=(function(){function r(e,t,n){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map(function(c,l){return c[0]+e[l]+c[1]});var a=e.length,i=Ft(a),o=t.map(function(c){return c[0]}).join(","),s=t.map(function(c,l){return c[0]+e[l]}).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a);if(a===1){this.userCode=`
        int start = `.concat(o,`;
        int end = `).concat(s,`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `);return}this.userCode=`
      `.concat(i," start = ").concat(i,"(").concat(o,`);
      `).concat(i," end = ").concat(i,"(").concat(s,`);

      void main() {
        `).concat(i,` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          `).concat(i,` coords = outC - start;
          setOutput(getX(`).concat(u,`));
        }
      }
    `)}return r})();var zCe=(function(){function r(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map(function(g,y){return g[0]+e[y]+g[1]});for(var a=e.length,i=Ft(a),o=t.map(function(g){return g[0]}).join(","),s=t.map(function(g,y){return g[0]+e[y]}).join(","),u=cn("rc",a),c=cn("source",a),l="".concat(u[a-1]," < ").concat(this.outputShape[a-1]),f=a===1?"source":"vec2(".concat(c.slice(-2).join(),")"),h=["".concat(i," rc = outputLoc;"),"".concat(u[a-1],` += 1;
       if(`).concat(l,`) {
      `),a===1?"":`}
       rc = outputLoc;
       `.concat(u[a-2],` += 1;
       if(`).concat(u[a-2]," < ").concat(this.outputShape[a-2],") {"),a===1?"":"  ".concat(u[a-1],` += 1;
         if(`).concat(l,") {")],p=a===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",d="",m=0,v=a===1?2:4;m<v;m++)d+=`
        `.concat(h[m],`
        if (`).concat(p,`) {
          result[`).concat(m,`] = float(value);
        } else {
          `).concat(i,` source = rc - start;
          result[`).concat(m,"] = getChannel(getX(").concat(c.join(),"), ").concat(f,`);
        }
      `);d+=a===1?"} ":"}}",this.userCode=`
      const `.concat(i," start = ").concat(i,"(").concat(o,`);
      const `).concat(i," end = ").concat(i,"(").concat(s,`);

      void main() {
        `).concat(i,` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `).concat(d,`
        setOutput(result);
      }
    `)}return r})();var fR=function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.paddings,o=n.constantValue;if(k.util.sizeFromShape(a.shape)===0){var s=i.map(function(l,f){return l[0]+a.shape[f]+l[1]});return tf({backend:t,attrs:{shape:s,value:o,dtype:a.dtype}})}var u=k.env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new zCe(a.shape,i,o):new LCe(a.shape,i,o),c=[[o]];return t.runWebGLProgram(u,[a],a.dtype,c)},$Ce={kernelName:k.PadV2,backendName:"webgl",kernelFunc:fR};var WCe=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,GCe=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+Bs+`
  return result;
`,VCe=Yr({opSnippet:WCe,packedOpSnippet:GCe}),UCe={kernelName:k.Pow,backendName:"webgl",kernelFunc:VCe};function HCe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims,s=a.shape.length,u=[],c=k.util.parseAxisParam(i,a.shape),l=c,f=k.backend_util.getAxesPermutation(l,s),h=a;f!=null&&(h=fn({inputs:{x:a},backend:t,attrs:{perm:f}}),l=k.backend_util.getInnerMostAxes(l.length,s),u.push(h)),k.backend_util.assertAxesAreInnerMostDims("prod",l,s);var p;if(t.shouldExecuteOnCPU([h])){var d=t.texData.get(h.dataId).values,m=Wke(h.shape,h.dtype,d,l),v=m.outVals,g=m.outShape,y=m.outDtype;p=t.makeTensorInfo(g,y,v)}else{var w=Ee(k.backend_util.computeOutAndReduceShapes(h.shape,l),2),g=w[0],b=w[1],x=k.util.sizeFromShape(b),S=Ce({inputs:{x:h},backend:t,attrs:{shape:[-1,x]}}),T=k.sumOutType(a.dtype),N=Ls(S,T,"prod",t);p=Ce({inputs:{x:N},backend:t,attrs:{shape:g}}),u.push(S),u.push(N)}if(o){u.push(p);var C=k.backend_util.expandShapeToKeepDim(p.shape,c);p=Ce({inputs:{x:p},backend:t,attrs:{shape:C}})}return u.forEach(function(R){return t.disposeIntermediateTensorInfo(R)}),p}var qCe={kernelName:k.Prod,backendName:"webgl",kernelFunc:HCe};function KCe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.paramsNestedSplits,i=e.paramsDenseValues,o=e.indices;n.outputRaggedRank;var s=a.map(function(g){return t.readSync(g.dataId)}),u=a.map(function(g){return g.shape}),c=t.readSync(i.dataId),l=t.readSync(o.dataId),f=Ee(Gke(s,u,c,i.shape,i.dtype,l,o.shape),3),h=f[0],p=f[1],d=f[2],m=h.map(function(g){return t.makeTensorInfo([g.length],"int32",g)}),v=t.makeTensorInfo(d,i.dtype,p);return m.concat([v])}var jCe={kernelName:k.RaggedGather,backendName:"webgl",kernelFunc:KCe};function XCe(r){var e=r.inputs,t=r.backend,n=e.starts,a=e.limits,i=e.deltas,o=t.readSync(n.dataId),s=t.readSync(a.dataId),u=t.readSync(i.dataId),c=Ee(Vke(o,n.shape,n.dtype,s,a.shape,u,i.shape),2),l=c[0],f=c[1],h=t.makeTensorInfo([l.length],"int32",l),p=t.makeTensorInfo([f.length],n.dtype,f);return[h,p]}var YCe={kernelName:k.RaggedRange,backendName:"webgl",kernelFunc:XCe};function ZCe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.shape,i=e.values,o=e.defaultValue,s=e.rowPartitionTensors,u=n.rowPartitionTypes,c=t.readSync(a.dataId),l=t.readSync(i.dataId),f=t.readSync(o.dataId),h=s.map(function(g){return t.readSync(g.dataId)}),p=s.map(function(g){return g.shape}),d=Ee(Uke(c,a.shape,l,i.shape,i.dtype,f,o.shape,h,p,u),2),m=d[0],v=d[1];return t.makeTensorInfo(m,i.dtype,v)}var JCe={kernelName:k.RaggedTensorToTensor,backendName:"webgl",kernelFunc:ZCe};var hR=function(r){var e=r.backend,t=r.attrs,n=t.start,a=t.stop,i=t.step,o=t.dtype,s=Hke(n,a,i,o);return e.makeTensorInfo([s.length],o,s)},QCe={kernelName:k.Range,backendName:"webgl",kernelFunc:hR};var eAe="return 1.0 / x;",tAe=bt({opSnippet:eAe}),rAe={kernelName:k.Reciprocal,backendName:"webgl",kernelFunc:tAe};var nAe=Oa+`
  return (x < 0.0) ? 0.0 : x;
`,aAe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,iAe=bt({opSnippet:nAe,packedOpSnippet:aAe}),oAe={kernelName:k.Relu,backendName:"webgl",kernelFunc:iAe};var sAe=Oa+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,uAe=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,cAe=bt({opSnippet:sAe,packedOpSnippet:uAe}),lAe={kernelName:k.Relu6,backendName:"webgl",kernelFunc:cAe};var fAe=(function(){function r(e,t,n,a,i){this.variableNames=["A"],this.outputShape=[];var o=Ee(e,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,t,n,l];var f=[a&&t>1?u-1:u,a&&n>1?c-1:c],h=[a&&t>1?t-1:t,a&&n>1?n-1:n],p;i?p="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":p="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `.concat(f[0]/h[0],`,
          `).concat(f[1]/h[1],`);
      const vec2 inputShapeRC = vec2(`).concat(u,".0, ").concat(c,`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = `).concat(p,`;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `)}return r})();var hAe=(function(){function r(e,t,n,a,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=Ee(e,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,t,n,l];var f=[a&&t>1?u-1:u,a&&n>1?c-1:c],h=[a&&t>1?t-1:t,a&&n>1?n-1:n],p;i?p="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":p="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `.concat(f[0]/h[0],`,
          `).concat(f[1]/h[1],`,
          `).concat(f[1]/h[1],`);
      const vec3 inputShapeRC = vec3(`).concat(u,".0, ").concat(c,`.0,
                                     `).concat(c,`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = `).concat(p,`;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `).concat(l-1,`;
        bool hasNextRow = coords.z < `).concat(n-1,`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `)}return r})();function pAe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.images,i=n.alignCorners,o=n.halfPixelCenters,s=n.size,u=Ee(s,2),c=u[0],l=u[1],f=k.env().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new hAe(a.shape,c,l,i,o):new fAe(a.shape,c,l,i,o);return t.runWebGLProgram(f,[a],"float32")}var dAe={kernelName:k.ResizeBilinear,backendName:"webgl",kernelFunc:pAe};var vAe=(function(){function r(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;var a=Ee(t,3),i=a[1],o=a[2],s=Ee(e,3),u=s[1],c=s[2],l=[n&&u>1?i-1:i,n&&c>1?o-1:o],f=[n&&u>1?u-1:u,n&&c>1?c-1:c],h=l[0]/f[0],p=l[1]/f[1],d=1/h,m=1/p,v=Math.ceil(d)*2+2,g=Math.ceil(m)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`.concat(h,`);
        const float widthScale = float(`).concat(p,`);

        const float invHeightScale = float(`).concat(d,`);
        const float invWidthScale = float(`).concat(m,`);

        const int winHeight = int(`).concat(v,`);
        const int winWidth = int(`).concat(g,`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `).concat(u,`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `).concat(c,`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `).concat(i-1,`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `).concat(o-1,`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `)}return r})();function mAe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.images,i=e.dy,o=n.alignCorners,s=new vAe(i.shape,a.shape,o);return t.runWebGLProgram(s,[i],i.dtype)}var gAe={kernelName:k.ResizeBilinearGrad,backendName:"webgl",kernelFunc:mAe};var yAe=(function(){function r(e,t,n,a,i){this.variableNames=["A"],this.outputShape=[];var o=Ee(e,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,t,n,l];var f=[a&&t>1?u-1:u,a&&n>1?c-1:c],h=[a&&t>1?t-1:t,a&&n>1?n-1:n],p=a?"0.5":"0.0",d;i?d="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":d="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `.concat(f[0]/h[0],`,
          `).concat(f[1]/h[1],`);
      const vec2 inputShapeRC = vec2(`).concat(u,".0, ").concat(c,`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = `).concat(d,`;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `).concat(p,`)));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `)}return r})();var bAe=(function(){function r(e,t,n,a,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=Ee(e,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,t,n,l];var f=[a&&t>1?u-1:u,a&&n>1?c-1:c],h=[a&&t>1?t-1:t,a&&n>1?n-1:n],p=a?"0.5":"0.0",d;i?d="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":d="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `.concat(f[0]/h[0],`,
          `).concat(f[1]/h[1],`,
          `).concat(f[1]/h[1],`);
      const vec3 inputShapeRC = vec3(`).concat(u,".0, ").concat(c,`.0,
                                     `).concat(c,`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = `).concat(d,`;

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `).concat(p,`)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `).concat(l-1,`;
        bool hasNextRow = coords.z < `).concat(n-1,`;

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `)}return r})();function wAe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.images,i=n.alignCorners,o=n.halfPixelCenters,s=n.size,u=Ee(s,2),c=u[0],l=u[1],f=k.env().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new bAe(a.shape,c,l,i,o):new yAe(a.shape,c,l,i,o);return t.runWebGLProgram(f,[a],a.dtype)}var xAe={kernelName:k.ResizeNearestNeighbor,backendName:"webgl",kernelFunc:wAe};var kAe=(function(){function r(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;var a=Ee(t,3),i=a[1],o=a[2],s=Ee(e,3),u=s[1],c=s[2],l=[n&&u>1?i-1:i,n&&c>1?o-1:o],f=[n&&u>1?u-1:u,n&&c>1?c-1:c],h=l[0]/f[0],p=l[1]/f[1],d=1/h,m=1/p,v=Math.ceil(d)*2+2,g=Math.ceil(m)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`.concat(h,`);
        const float widthScale = float(`).concat(p,`);

        const float invHeightScale = float(`).concat(d,`);
        const float invWidthScale = float(`).concat(m,`);

        const int winHeight = int(`).concat(v,`);
        const int winWidth = int(`).concat(g,`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `).concat(u,`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `).concat(c,`) {
              continue;
            }

            float sourceFracRow =
              float(`).concat(l[0],`) *
                (float(dyR) / float(`).concat(f[0],`));

            float sourceFracCol =
                float(`).concat(l[1],`) *
                  (float(dyC) / float(`).concat(f[1],`));

            int sourceNearestRow = int(min(
                float(int(`).concat(i,`) - 1),
                `).concat(n,` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`).concat(o,`) - 1),
                `).concat(n,` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `)}return r})();function SAe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.images,i=e.dy,o=n.alignCorners,s=new kAe(i.shape,a.shape,o);return t.runWebGLProgram(s,[i],i.dtype)}var EAe={kernelName:k.ResizeNearestNeighborGrad,backendName:"webgl",kernelFunc:SAe};var TAe=(function(){function r(e,t){this.variableNames=["x"];var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-".concat(n," tensor is not yet supported"));if(this.outputShape=e,n===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`.concat(e[0],` - coord - 1));
        }
      `);return}var a=function(s){return t.indexOf(s)!==-1&&e[s]!==1?"".concat(e[s]," - coords[").concat(s,"] - 1"):"coords[".concat(s,"]")},i=e.map(function(s,u){return a(u)}).join(","),o=Ft(n);this.userCode=`
      void main() {
        `.concat(o,` coords = getOutputCoords();
        setOutput(getX(`).concat(i,`));
      }
    `)}return r})();var NAe=(function(){function r(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-".concat(n," tensor is not yet supported"));this.outputShape=e;var a=cn("rc",n),i="".concat(a[n-1]," + 1 < ").concat(this.outputShape[n-1]),o="".concat(a[n-2]," + 1 < ").concat(this.outputShape[n-2]),s=Ft(n);n===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`.concat(e[0],` - rc - 1),
            `).concat(e[0],` - rc - 1);
          if(`).concat(i,`){
              result.g = getChannel(getX(`).concat(e[0],` - (rc  + 1) - 1),
                `).concat(e[0],` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `):this.userCode=`
        void main() {
          `.concat(s,` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `).concat(u(a.slice()),`;
          if(`).concat(i,`){
            result.g = `).concat(c(a.slice()),`;
          }
          if(`).concat(o,`) {
            result.b = `).concat(l(a.slice()),`;
            if(`).concat(i,`) {
              result.a = `).concat(f(a.slice()),`;
            }
          }
          setOutput(result);
        }
    `);function u(d){return h(d)}function c(d){return d[n-1]="("+d[n-1]+" + 1)",h(d)}function l(d){return d[n-2]="("+d[n-2]+" + 1)",h(d)}function f(d){return d[n-1]="("+d[n-1]+" + 1)",d[n-2]="("+d[n-2]+" + 1)",h(d)}function h(d){var m=e.map(function(y,w){return p(w,d)}),v=m.join(","),g=m.slice(-2).join(",");return"getChannel(getX(".concat(v,"), vec2(").concat(g,"))")}function p(d,m){return t.indexOf(d)!==-1&&e[d]!==1?"".concat(e[d]," - ").concat(m[d]," - 1"):"".concat(m[d])}}return r})();function IAe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.dims,o=a.shape.length,s=k.util.parseAxisParam(i,a.shape);if(o===0)return Kn({inputs:{x:a},backend:t});var u=k.env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new NAe(a.shape,s):new TAe(a.shape,s);return t.runWebGLProgram(u,[a],a.dtype)}var CAe={kernelName:k.Reverse,backendName:"webgl",kernelFunc:IAe};var AAe=(function(){function r(e,t){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];var n=e[1],a=e[2];this.outputShape=e;var i="";typeof t=="number"?i="float outputValue = ".concat(t.toFixed(2),";"):i=`
        vec3 fill = vec3(`.concat(t.join(","),`);
        float outputValue = fill[coords[3]];`),this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          `.concat(i,`
          if(coordX >= 0 && coordX < `).concat(a," && coordY >= 0 && coordY < ").concat(n,`) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `)}return r})(),DAe={kernelName:k.RotateWithOffset,backendName:"webgl",kernelFunc:function(r){var e=r.inputs,t=r.attrs,n=r.backend,a=e.image,i=t.radians,o=t.fillValue,s=t.center,u=n,c=new AAe(a.shape,o),l=Ee(k.backend_util.getImageCenter(s,a.shape[1],a.shape[2]),2),f=l[0],h=l[1],p=[[f,h,Math.sin(i),Math.cos(i)]],d=u.runWebGLProgram(c,[a],a.dtype,p);return d}};var _Ae=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,FAe=bt({opSnippet:_Ae}),RAe={kernelName:k.Round,backendName:"webgl",kernelFunc:FAe};var OAe="return inversesqrt(x);",PAe=bt({opSnippet:OAe,cpuKernelImpl:qke}),MAe={kernelName:k.Rsqrt,backendName:"webgl",kernelFunc:PAe};var Cb=(function(){function r(e,t,n,a,i,o,s,u){u===void 0&&(u=!1),this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var c=Ft(i.length),l=Ft(o.length),f="";n===1?f="i":n===2&&(f="i, j");var h="getIndices(".concat(f,")"),p="";a===1?p="i":a===2&&(p="i, coords[1]");var d="getUpdates(".concat(p,")"),m="";u&&(m="coords[0], coords[1]");var v="getDefaultValue(".concat(m,")"),g=t>1?"strides[j]":"strides";this.userCode=`
        `.concat(c," strides = ").concat(c,"(").concat(i,`);

        void main() {
          `).concat(l,` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `).concat(e,`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `).concat(t,`; j++) {
              int index = round(`).concat(h,`);
              flattenedIndex += index * `).concat(g,`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `).concat(d,`;
              found = true;
            }
          }
          setOutput(mix(`).concat(v,`, sum, float(found)));
        }
      `)}return r})();var BAe=(function(){function r(e,t,n,a,i,o,s,u){u===void 0&&(u=!1),this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=o;var c=Ft(i.length),l=Ft(o.length),f="";n===1?f="i":n===2&&(f="i, j");var h="getIndices(".concat(f,")"),p="";a===1?p="i":a===2&&(p="i, coords[1]");var d="getUpdates(".concat(p,")"),m="";u&&(m="coords[0], coords[1]");var v="getDefaultValue(".concat(m,")"),g=t>1?"strides[j]":"strides",y=t>1?"strides[j + 1]":"strides";this.userCode=`
        `.concat(c," strides = ").concat(c,"(").concat(i,`);

        void main() {
          `).concat(l,` coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < `).concat(e,`; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < `).concat(t,`; j+=2) {
              ivec4 index = round(`).concat(h,`);
              flattenedIndex += index.xz * `).concat(g,`;
              if (j + 1 < `).concat(t,`) {
                flattenedIndex += index.yw * `).concat(y,`;
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = `).concat(d,`;
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(`).concat(v,`, sum, found));
        }
      `)}return r})();function LAe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.indices,i=e.updates,o=n.shape,s=k.backend_util.calculateShapes(i,a,o),u=s.sliceRank,c=s.numUpdates,l=s.sliceSize,f=s.strides,h=s.outputSize,p=[h/l,l];if(h===0)return t.makeTensorInfo(o,a.dtype);var d=Ce({inputs:{x:a},backend:t,attrs:{shape:[c,u]}}),m=Ce({inputs:{x:i},backend:t,attrs:{shape:[c,l]}}),v=t.makeTensorInfo([],"float32",new Float32Array([0])),g;k.env().getBool("WEBGL_PACK")?g=new BAe(c,u,d.shape.length,m.shape.length,f,p):g=new Cb(c,u,d.shape.length,m.shape.length,f,p);var y=t.runWebGLProgram(g,[m,d,v],m.dtype),w=Ce({inputs:{x:y},backend:t,attrs:{shape:o}});return t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(v),w}var zAe={kernelName:k.ScatterNd,backendName:"webgl",kernelFunc:LAe};var $Ae=(function(){function r(e,t,n,a){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,n];var i="while (left < right) {",o="for (int i = 0; i < ".concat(Math.ceil(Math.log2(t+1)),"; ++i) { if (left >= right) break;"),s=k.env().getNumber("WEBGL_VERSION")===2?i:o,u=a==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         `.concat(s,`
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) `).concat(u,` value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `)}return r})();function WAe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.sortedSequence,i=e.values,o=n.side,s=new $Ae(a.shape[0],a.shape[1],i.shape[1],o),u=[[a.shape[1]]];return t.runWebGLProgram(s,[a,i],"int32",u)}var GAe={kernelName:k.SearchSorted,backendName:"webgl",kernelFunc:WAe};var VAe=(function(){function r(e,t,n){this.variableNames=["c","a","b"],this.outputShape=t;var a,i;if(n>4)throw Error("Where for rank ".concat(n," is not yet supported"));if(n===1)i="resRC",a="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[],u=[],c=0;c<t.length;c++)u.push("".concat(o[c])),c<e&&s.push("".concat(o[c]));a=s.join(),i=u.join()}var l=Ft(n);this.userCode=`
      void main() {
        `.concat(l,` resRC = getOutputCoords();
        float cVal = getC(`).concat(a,`);
        if (cVal >= 1.0) {
          setOutput(getA(`).concat(i,`));
        } else {
          setOutput(getB(`).concat(i,`));
        }
      }
    `)}return r})();function UAe(r){var e=r.inputs,t=r.backend,n=e.condition,a=e.t,i=e.e,o=new VAe(n.shape.length,a.shape,a.shape.length);return t.runWebGLProgram(o,[n,a,i],k.upcastType(a.dtype,i.dtype))}var HAe={kernelName:k.Select,backendName:"webgl",kernelFunc:UAe};var qAe=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = `.concat(k.backend_util.SELU_SCALEALPHA,`;
  float scale = `).concat(k.backend_util.SELU_SCALE,`;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`),KAe=bt({opSnippet:qAe}),jAe={kernelName:k.Selu,backendName:"webgl",kernelFunc:KAe};var XAe=Qu+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,YAe=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,ZAe=bt({opSnippet:XAe,packedOpSnippet:YAe,cpuKernelImpl:jke}),JAe={kernelName:k.Sigmoid,backendName:"webgl",kernelFunc:ZAe};var QAe=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,eDe=bt({opSnippet:QAe}),tDe={kernelName:k.Sign,backendName:"webgl",kernelFunc:eDe};var rDe=Qu+`
  return sin(x);
`,nDe=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  `.concat(Bs,`
  return result;
`),aDe=bt({opSnippet:rDe,packedOpSnippet:nDe}),iDe={kernelName:k.Sin,backendName:"webgl",kernelFunc:aDe};var oDe=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,sDe=bt({opSnippet:oDe}),uDe={kernelName:k.Sinh,backendName:"webgl",kernelFunc:sDe};var cDe=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,lDe=bt({opSnippet:cDe}),fDe={kernelName:k.Softplus,backendName:"webgl",kernelFunc:lDe},hDe=function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.blockShape,o=n.paddings;k.util.assert(a.shape.length<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var s=i.reduce(function(y,w){return y*w}),u=[[0,0]];u.push.apply(u,ir([],Ee(o),!1));for(var c=1+i.length;c<a.shape.length;++c)u.push([0,0]);var l=[],f=fR({inputs:{x:a},backend:t,attrs:{paddings:u,constantValue:0}}),h=k.backend_util.getReshaped(f.shape,i,s,!1),p=k.backend_util.getPermuted(h.length,i.length,!1),d=k.backend_util.getReshapedPermuted(f.shape,i,s,!1),m=Ce({inputs:{x:f},backend:t,attrs:{shape:h}}),v=fn({inputs:{x:m},backend:t,attrs:{perm:p}}),g=Ce({inputs:{x:v},backend:t,attrs:{shape:d}});return l.push(f),l.push(m),l.push(v),l.forEach(function(y){return t.disposeIntermediateTensorInfo(y)}),g},pDe={kernelName:k.SpaceToBatchND,backendName:"webgl",kernelFunc:hDe};function dDe(r){var e=r.inputs,t=r.backend,n=e.indices,a=e.values,i=e.denseShape,o=e.defaultValue;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         `.concat(i.shape));if(n.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         `.concat(n.shape));if(a.shape.length!==1)throw new Error(`Values must be a vector, saw:
         `.concat(a.shape));if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        `.concat(o.shape));var s=t.readSync(n.dataId),u=t.readSync(a.dataId),c=t.readSync(i.dataId),l=t.readSync(o.dataId)[0],f=Ee(Yke(s,n.shape,n.dtype,u,a.dtype,c,l),5),h=f[0],p=f[1],d=f[2],m=f[3],v=f[4];return[t.makeTensorInfo(p,n.dtype,h),t.makeTensorInfo([p[0]],a.dtype,d),t.makeTensorInfo([m.length],"bool",new Uint8Array(m.map(function(g){return Number(g)}))),t.makeTensorInfo([v.length],n.dtype,new Int32Array(v))]}var vDe={kernelName:k.SparseFillEmptyRows,backendName:"webgl",kernelFunc:dDe};function mDe(r){var e=r.inputs,t=r.backend,n=e.inputIndices,a=e.inputShape,i=e.newShape;if(n.shape.length!==2)throw new Error("Input indices should be a matrix but received shape ".concat(n.shape));if(a.shape.length!==1)throw new Error("Input shape should be a vector but received shape ".concat(a.shape));if(i.shape.length!==1)throw new Error("Target shape should be a vector but received shape ".concat(i.shape));var o=Array.from(t.readSync(a.dataId)),s=t.readSync(n.dataId),u=Array.from(t.readSync(i.dataId)),c=Ee(Zke(s,n.shape,n.dtype,o,u),3),l=c[0],f=c[1],h=c[2];return[t.makeTensorInfo(f,n.dtype,l),t.makeTensorInfo([h.length],i.dtype,new Int32Array(h))]}var gDe={kernelName:k.SparseReshape,backendName:"webgl",kernelFunc:mDe};function yDe(r){var e=r.inputs,t=r.backend,n=e.data,a=e.indices,i=e.segmentIds;if(n.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              `.concat(a.shape));if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              `.concat(i.shape));var o=t.readSync(n.dataId),s=t.readSync(a.dataId),u=t.readSync(i.dataId),c=Ee(PF(o,n.shape,n.dtype,s,u,!0),2),l=c[0],f=c[1];return t.makeTensorInfo(f,n.dtype,l)}var bDe={kernelName:k.SparseSegmentMean,backendName:"webgl",kernelFunc:yDe};function wDe(r){var e=r.inputs,t=r.backend,n=e.data,a=e.indices,i=e.segmentIds;if(n.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             `.concat(a.shape));if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             `.concat(i.shape));var o=t.readSync(n.dataId),s=t.readSync(a.dataId),u=t.readSync(i.dataId),c=Ee(PF(o,n.shape,n.dtype,s,u),2),l=c[0],f=c[1];return t.makeTensorInfo(f,n.dtype,l)}var xDe={kernelName:k.SparseSegmentSum,backendName:"webgl",kernelFunc:wDe};function kDe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.sparseIndices,i=e.sparseValues,o=e.defaultValue,s=n.outputShape,u=k.backend_util.calculateShapes(i,a,s),c=u.sliceRank,l=u.numUpdates,f=u.sliceSize,h=u.strides,p=u.outputSize,d=!1;if(i.dtype==="string"){var m=t.bufferSync(a),v=t.bufferSync(i),g=k.util.decodeString(t.readSync(o.dataId)[0]),y=Kke(m,v,s,p,f,l,c,h,g,d);return t.makeTensorInfo(s,y.dtype,y.values)}var w=new Cb(l,c,a.shape.length,i.shape.length,h,[p,1],d),b=t.runWebGLProgram(w,[i,a,o],i.dtype),x=Ce({inputs:{x:b},backend:t,attrs:{shape:s}});return t.disposeIntermediateTensorInfo(b),x}var SDe={kernelName:k.SparseToDense,backendName:"webgl",kernelFunc:kDe};function EDe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.numOrSizeSplits,o=n.axis,s=k.util.parseAxisParam(o,a.shape)[0],u=k.backend_util.prepareSplitSize(a,i,s),c=a.shape.length,l=new Array(c).fill(0),f=a.shape.slice();return u.map(function(h){var p=ir([],Ee(f),!1);p[s]=h;var d=ec({inputs:{x:a},backend:t,attrs:{begin:l,size:p}});return l[s]+=h,d})}var TDe={kernelName:k.SplitV,backendName:"webgl",kernelFunc:EDe};var O3="return sqrt(x);",NDe=bt({opSnippet:O3,packedOpSnippet:O3,cpuKernelImpl:Jke}),IDe={kernelName:k.Sqrt,backendName:"webgl",kernelFunc:NDe};var CDe="return x * x;",ADe=bt({opSnippet:CDe}),DDe={kernelName:k.Square,backendName:"webgl",kernelFunc:ADe};var P3="return (a - b) * (a - b);",_De=Yr({opSnippet:P3,packedOpSnippet:P3}),FDe={kernelName:k.SquaredDifference,backendName:"webgl",kernelFunc:_De};function RDe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x;if(a.dtype!=="string")throw new Error("Input must be of datatype string");var i=t.readSync(a.dataId),o=k.backend_util.fromUint8ToStringArray(i),s=Qke(o,"string",n);return t.makeTensorInfo(a.shape,"string",s)}var ODe={kernelName:k.StaticRegexReplace,backendName:"webgl",kernelFunc:RDe};function PDe(r){var e=r.inputs,t=r.attrs,n=r.backend,a=e.x,i=Oa+`
    return x > 0.0 ? 1.0 : float(`.concat(t.alpha,`);
  `),o=new yi(a.shape,i);return n.runWebGLProgram(o,[a],a.dtype)}var MDe={kernelName:k.Step,backendName:"webgl",kernelFunc:PDe};var BDe=(function(){function r(e,t,n){this.variableNames=["x"],this.outputShape=n;var a=n.length,i=Ft(n.length),o=Ft(n.length),s="";if(a===1)s="coords * strides + begin";else{var u=0;s=n.map(function(c,l){return u++,n.length===1?"coords * strides[".concat(l,"] + begin[").concat(l,"]"):"coords[".concat(u-1,"] * strides[").concat(l,"] + begin[").concat(l,"]")}).join(",")}this.userCode=`
      `.concat(i," begin = ").concat(i,"(").concat(e,`);
      `).concat(i," strides = ").concat(i,"(").concat(t,`);

      void main() {
        `).concat(o,` coords = getOutputCoords();
        setOutput(getX(`).concat(s,`));
      }
    `)}return r})();function LDe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.begin,o=n.end,s=n.strides,u=n.beginMask,c=n.endMask,l=n.ellipsisMask,f=n.newAxisMask,h=n.shrinkAxisMask,p=k.slice_util.sliceInfo(a.shape,i,o,s,u,c,l,f,h),d=p.finalShapeSparse,m=p.finalShape,v=p.isIdentity,g=p.sliceDim0,y=p.isSimpleSlice,w=p.begin,b=p.end,x=p.strides,S;if(v)S=Ce({inputs:{x:a},backend:t,attrs:{shape:m}});else if(g||y){k.util.assert(a.shape.length>=1,function(){return"Input must have rank at least 1, got: ".concat(a.shape.length)});var T=k.slice_util.computeOutShape(w,b,x),N=ec({inputs:{x:a},backend:t,attrs:{begin:w,size:T}});S=Ce({inputs:{x:N},backend:t,attrs:{shape:m}}),t.disposeIntermediateTensorInfo(N)}else{var C=t.shouldExecuteOnCPU([a]);if(C){var R=t.readSync(a.dataId),_=k.buffer(a.shape,a.dtype,R),P=e2e(d,_,x,w);S=t.makeTensorInfo(m,a.dtype,P.values)}else{var $=new BDe(w,x,d);S=t.runWebGLProgram($,[a],a.dtype)}}var z=Ce({inputs:{x:S},backend:t,attrs:{shape:m}});return t.disposeIntermediateTensorInfo(S),z}var zDe={kernelName:k.StridedSlice,backendName:"webgl",kernelFunc:LDe};function $De(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.separator,i=n.nGramWidths,o=n.leftPad,s=n.rightPad,u=n.padWidth,c=n.preserveShortSequences,l=e.data,f=e.dataSplits,h=t.readSync(l.dataId),p=t.readSync(f.dataId),d=Ee(t2e(h,p,a,i,o,s,u,c),2),m=d[0],v=d[1];return[t.makeTensorInfo([m.length],"string",m),t.makeTensorInfo(f.shape,"int32",v)]}var WDe={kernelName:k.StringNGrams,backendName:"webgl",kernelFunc:$De};function GDe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.skipEmpty,i=e.input,o=e.delimiter;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error("Input must be a vector, got shape: ".concat(i.shape));if(o.shape.length!==0)throw new Error("Delimiter must be a scalar, got shape: ".concat(o.shape));var s=t.readSync(i.dataId),u=t.readSync(o.dataId)[0],c=Ee(r2e(s,u,a),3),l=c[0],f=c[1],h=c[2],p=f.length;return[t.makeTensorInfo([p,2],"int32",l),t.makeTensorInfo([p],"string",f),t.makeTensorInfo([2],"int32",new Int32Array(h))]}var VDe={kernelName:k.StringSplit,backendName:"webgl",kernelFunc:GDe};function UDe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.numBuckets,i=e.input;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(a<=0)throw new Error("Number of buckets must be at least 1");var o=t.readSync(i.dataId),s=n2e(o,a);return t.makeTensorInfo(i.shape,"int32",s)}var HDe={kernelName:k.StringToHashBucketFast,backendName:"webgl",kernelFunc:UDe};var qDe="return tan(x);",KDe=bt({opSnippet:qDe}),jDe={kernelName:k.Tan,backendName:"webgl",kernelFunc:KDe};var XDe=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,YDe=bt({opSnippet:XDe}),ZDe={kernelName:k.Tanh,backendName:"webgl",kernelFunc:YDe};function JDe(r){var e=r.inputs,t=r.backend;r.attrs;var n=e.tensor,a=e.indices,i=e.updates,o=k.backend_util.calculateShapes(i,a,n.shape),s=o.sliceRank,u=o.numUpdates,c=o.sliceSize,l=o.strides,f=o.outputSize,h=[f/c,c];if(f===0)return t.makeTensorInfo(n.shape,a.dtype);var p=Ce({inputs:{x:a},backend:t,attrs:{shape:[u,s]}}),d=Ce({inputs:{x:i},backend:t,attrs:{shape:[u,c]}}),m=Ce({inputs:{x:n},backend:t,attrs:{shape:h}}),v=new Cb(u,s,p.shape.length,d.shape.length,l,h,!1,!0),g=t.runWebGLProgram(v,[d,p,m],m.dtype),y=Ce({inputs:{x:g},backend:t,attrs:{shape:n.shape}});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),y}var QDe={kernelName:k.TensorScatterUpdate,backendName:"webgl",kernelFunc:JDe};var e_e=(function(){function r(e,t){this.variableNames=["A"];for(var n=new Array(e.length),a=0;a<n.length;a++)n[a]=e[a]*t[a];this.outputShape=n,this.rank=n.length;var i=Ft(this.rank),o=t_e(e);this.userCode=`
      void main() {
        `.concat(i,` resRC = getOutputCoords();
        setOutput(getA(`).concat(o,`));
      }
    `)}return r})();function t_e(r){var e=r.length;if(e>5)throw Error("Tile for rank ".concat(e," is not yet supported"));if(e===1)return"imod(resRC, ".concat(r[0],")");for(var t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],n=[],a=0;a<r.length;a++)n.push("imod(".concat(t[a],", ").concat(r[a],")"));return n.join()}function pR(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.reps;if(a.dtype==="string"||a.shape.length>5){var o=t.readSync(a.dataId),s=a.dtype==="string"?o.map(function(h){return k.util.decodeString(h)}):o,u=k.buffer(a.shape,a.dtype,s),c=i2e(u,i);return t.makeTensorInfo(c.shape,c.dtype,c.values)}var l=new e_e(a.shape,i),f=t.runWebGLProgram(l,[a],a.dtype);return f}var r_e={kernelName:k.Tile,backendName:"webgl",kernelFunc:pR},n_e=(function(){function r(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}return r})(),a_e=(function(){function r(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}return r})();function Ds(r,e){e!==null&&r.disposeIntermediateTensorInfo(e)}function M3(r){for(var e=1;e<r;)e*=2;return e}function i_e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.k,o=n.sorted,s=k.env().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),u=k.env().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),c=a.shape,l=c[c.length-1];if(t.shouldExecuteOnCPU([a])||l<s||i>u){var f=t.readSync(a.dataId),h=Ee(o2e(f,c,a.dtype,i,o),2),p=h[0],d=h[1];return[t.makeTensorInfo(p.shape,p.dtype,p.values),t.makeTensorInfo(d.shape,d.dtype,d.values)]}if(i===0)return c[c.length-1]=0,[t.makeTensorInfo(c,a.dtype,[]),t.makeTensorInfo(c,"int32",[])];if(l===1)return[a,tf({attrs:{shape:c,dtype:"int32",value:0},backend:t})];var m=t.texData.get(a.dataId),v=m!==null&&m.isPacked,g=v?t.unpackTensor(a):a,y=k.util.sizeFromShape(c),w=y/l,b=Ce({inputs:{x:g},attrs:{shape:[w,l]},backend:t});v&&Ds(t,g);for(var x=M3(i),S=M3(l),T=null,N=function(){return T===null?[b,b]:[b,T]},C=function(te,oe,ce){var pe=N(),xe=new n_e(ce),fe=T===null?1:0,ge=[[l],[fe],[Number.NEGATIVE_INFINITY],[te],[oe]],we=T;T=t.runWebGLProgram(xe,pe,"int32",ge),Ds(t,we)},R=1;R<x;R*=2)for(var _=R*2,P=R;P>=1;P/=2)C(_,P,[w,S]);for(var $=S;$>x;$/=2){var z=N(),L=new a_e([w,$/2]),B=T===null?1:0,G=[[l],[B],[x]],X=T;T=t.runWebGLProgram(L,z,"int32",G),Ds(t,X);for(var R=x/2,_=R*2,P=R;P>=1;P/=2)C(_,P,T.shape)}var Z=T;T=ec({inputs:{x:T},backend:t,attrs:{begin:0,size:[w,i]}}),Ds(t,Z);var V=iR({inputs:{x:b,indices:T},backend:t,attrs:{axis:1,batchDims:1}});Ds(t,b);var j=c.slice(0,-1);j.push(i),Z=T,T=Ce({inputs:{x:T},attrs:{shape:j},backend:t}),Ds(t,Z);var re=V;return V=Ce({inputs:{x:V},attrs:{shape:j},backend:t}),Ds(t,re),[V,T]}var o_e={kernelName:k.TopK,backendName:"webgl",kernelFunc:i_e};var s_e=(function(){function r(e,t,n,a,i,o){this.variableNames=["Image","Transforms"],this.outputShape=o;var s=n==="nearest"?1:2,u;switch(a){case"constant":u=1;break;case"reflect":u=2;break;case"wrap":u=3;break;case"nearest":u=4;break;default:u=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(`.concat(u,` == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (`).concat(u,` == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (`).concat(u,` == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < `).concat(e," && 0 <= coordX && coordX < ").concat(t,`) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(`).concat(i,`);
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(`).concat(i,`);
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(`).concat(t,`));
                float mapY = mapCoord(inY, float(`).concat(e,`));

                if (`).concat(s,` == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `)}return r})();function u_e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.image,i=e.transforms,o=n.interpolation,s=n.fillMode,u=n.fillValue,c=n.outputShape,l=Ee(a.shape,4),f=l[0],h=l[1],p=l[2],d=l[3],m=Ee(c??[h,p],2),v=m[0],g=m[1],y=[f,v,g,d],w=new s_e(h,p,o,s,u,y);return t.runWebGLProgram(w,[a,i],"float32")}var c_e={kernelName:k.Transform,backendName:"webgl",kernelFunc:u_e};function l_e(r){var e=r.inputs,t=r.attrs,n=r.backend,a=t.axis,i=e.x;Ku(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");var o=n.readSync(i.dataId),s=s2e(o,a,i.shape,i.dtype),u=s.outputValues,c=s.outputShape,l=s.indices;return[n.makeTensorInfo(c,i.dtype,u),n.makeTensorInfo([l.length],"int32",l)]}var f_e={kernelName:k.Unique,backendName:"webgl",kernelFunc:l_e};function h_e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.value,i=n.axis;i<0&&(i+=a.shape.length);for(var o=a,s=o.shape.length,u=a.shape[i],c=new Array(s-1),l=0,f=0;f<s;f++)f!==i&&(c[l++]=o.shape[f]);var h=[],p=new Array(s).fill(0),d=o.shape.slice();d[i]=1;for(var m=new Array(u),f=0;f<m.length;f++){p[i]=f;var v=ec({inputs:{x:o},backend:t,attrs:{begin:p,size:d}}),g=Ce({inputs:{x:v},backend:t,attrs:{shape:c}});m[f]=g,h.push(v)}return h.forEach(function(y){return t.disposeIntermediateTensorInfo(y)}),m}var p_e={kernelName:k.Unpack,backendName:"webgl",kernelFunc:h_e};var d_e=(function(){function r(e,t){this.variableNames=["x","segmentIds"];var n=e.windowSize,a=e.batchSize,i=e.inSize,o=e.numSegments,s=o*Math.ceil(i/n);this.outputShape=[a,s];var u="0.0",c="sumValue",l=Math.floor(n/4)*4,f=n%4,h=`
        sumValue += dot(values, segFilter);
    `,p="";i%n>0&&(p=`
        if (inIdx < 0 || inIdx >= `.concat(i,`) {
          return initializationValue;
        }
      `));var d="";i%n>0&&(d=`
        if (inIdx < 0 || inIdx >= `.concat(i,`) {
          return -1.0;
        }
      `)),this.userCode=`
      const float initializationValue = `.concat(u,`;

      float getValue(int batch, int inIdx) {
        `).concat(p,`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `).concat(d,`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `).concat(o,")) * float(").concat(n,`));
        int currentSeg = int(mod(float(outIdx), float(`).concat(o,`)));

        float sumValue = 0.0;

        for (int i = 0; i < `).concat(l,`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `).concat(h,`
        }

        int inIdx = inOffset + `).concat(l,`;
        if (`).concat(f===1,`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `).concat(h,`
        } else if (`).concat(f===2,`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `).concat(h,`
        } else if (`).concat(f===3,`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `).concat(h,`
        }
        setOutput(`).concat(c,`);
      }
    `)}return r})();function v_e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.segmentIds,o=n.numSegments,s=a.shape.length,u=[],c=0,l=k.backend_util.getAxesPermutation([c],s),f=a;l!=null&&(f=fn({inputs:{x:a},backend:t,attrs:{perm:l}}),u.push(f),c=k.backend_util.getInnerMostAxes(1,s)[0]);var h=k.backend_util.segment_util.computeOutShape(f.shape,c,o),p=k.util.sizeFromShape([f.shape[c]]),d=Ce({inputs:{x:f},backend:t,attrs:{shape:[-1,p]}});u.push(d);var m=k.sumOutType(a.dtype),v=function(x,S,T,N,C){var R=x.shape[0],_=x.shape[1],P=k.backend_util.segment_util.segOpComputeOptimalWindowSize(_,C),$={windowSize:P,inSize:_,batchSize:R,numSegments:C},z=new d_e($,S),L=t.compileAndRun(z,[x,T],N);if(u.push(L),L.shape[1]===C)return L;var B=hR({backend:t,attrs:{start:0,stop:C,step:1,dtype:"float32"}}),G=pR({inputs:{x:B},backend:t,attrs:{reps:[_/P]}});u.push(B),u.push(G);var X=v(L,S,G,N,C);return X},g=v(d,"unsortedSegmentSum",i,m,o),y=Ce({inputs:{x:g},backend:t,attrs:{shape:h}}),w=y;if(l!=null){u.push(y);var b=k.backend_util.getUndoAxesPermutation(l);w=fn({inputs:{x:w},backend:t,attrs:{perm:b}})}return u.forEach(function(x){return t.disposeIntermediateTensorInfo(x)}),w}var m_e={kernelName:k.UnsortedSegmentSum,backendName:"webgl",kernelFunc:v_e},ab,B3,g_e=[eSe,rSe,iSe,uSe,lSe,pSe,vSe,gSe,xSe,SSe,NSe,ASe,FSe,MSe,zSe,WSe,VSe,KSe,XSe,ZSe,tEe,uEe,lEe,dEe,mEe,kEe,EEe,CEe,B2e,_Ee,MEe,$Ee,qEe,XEe,ZEe,QEe,tTe,iTe,uTe,fTe,pTe,vTe,gTe,wTe,kTe,NTe,CTe,_Te,OTe,MTe,$Te,UTe,jTe,ZTe,eNe,tNe,nNe,iNe,sNe,cNe,fNe,vNe,yNe,xNe,SNe,NNe,ANe,RNe,BNe,M2e,zNe,OEe,GNe,HNe,jNe,z2e,JNe,rIe,aIe,uIe,fIe,vIe,yIe,kIe,NIe,AIe,_Ie,PIe,BIe,zIe,VIe,HIe,KIe,XIe,ZIe,tCe,iCe,cCe,gCe,G2e,xCe,ECe,ICe,DCe,yEe,RCe,PCe,BCe,$Ce,UCe,W2e,qCe,jCe,YCe,JCe,QCe,bEe,pCe,rAe,oAe,lAe,U2e,dAe,gAe,xAe,EAe,CAe,DAe,RAe,MAe,zAe,GAe,HAe,jAe,JAe,tDe,iDe,uDe,oEe,vCe,fDe,pDe,vDe,gDe,bDe,xDe,SDe,TDe,IDe,DDe,FDe,ODe,MDe,zDe,WDe,VDe,HDe,dCe,Z2e,jDe,ZDe,QDe,r_e,o_e,c_e,J2e,f_e,p_e,m_e,OCe];try{for(Wl=ln(g_e),Vu=Wl.next();!Vu.done;Vu=Wl.next())L3=Vu.value,k.registerKernel(L3)}catch(r){ab={error:r}}finally{try{Vu&&!Vu.done&&(B3=Wl.return)&&B3.call(Wl)}finally{if(ab)throw ab.error}}var L3,Wl,Vu;Wi.GPGPUContext=td;Wi.MathBackendWebGL=Eb;Wi.forceHalfFloat=LF;Wi.gpgpu_util=hxe;Wi.setWebGLContext=z3;Wi.version_webgl=O2e;Wi.webgl=P2e;Wi.webgl_util=y1e});var KLe=Vr(ua=>{var Fb=Xo(),y_e=lE(),Rb=rC(),Ob=ZA(),zR=TD(),Pb=u3(),Mb=dR();function $R(r){var e=Object.create(null);return r&&Object.keys(r).forEach(function(t){if(t!=="default"){var n=Object.getOwnPropertyDescriptor(r,t);Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:function(){return r[t]}})}}),e.default=r,e}var vR=$R(y_e),b_e=$R(zR),WR="Abs",GR="Acos",VR="Acosh",ew="Add",w_e="AddN",x_e="All",k_e="Any",UR="ArgMax",HR="ArgMin",qR="Asin",KR="Asinh",jR="Atan",XR="Atanh",YR="Atan2",ZR="AvgPool",S_e="AvgPoolGrad",E_e="AvgPool3D",T_e="AvgPool3DGrad",JR="BatchMatMul",QR="BatchToSpaceND",N_e="BroadcastTo",tw="Cast",eO="Ceil",tO="ClipByValue",I_e="Complex",rO="ComplexAbs",nO="Concat",aO="Conv2D",C_e="Conv2DBackpropFilter",iO="Conv2DBackpropInput",A_e="Conv3D",D_e="Conv3DBackpropFilterV2",__e="Conv3DBackpropInputV2",oO="Cos",sO="Cosh",F_e="Cumprod",uO="Cumsum",R_e="DepthToSpace",cO="DepthwiseConv2dNative",O_e="DepthwiseConv2dNativeBackpropFilter",P_e="DepthwiseConv2dNativeBackpropInput",lO="Dilation2D",M_e="Dilation2DBackpropInput",B_e="Dilation2DBackpropFilter",fO="RealDiv",hO="Elu",L_e="EluGrad",pO="Erf",z_e="Equal",dO="Exp",vO="ExpandDims",mO="Expm1",$_e="FFT",W_e="Fill",gO="Floor",yO="FloorDiv",bO="FusedBatchNorm",wO="GatherV2",G_e="Greater",xO="GreaterEqual",rw="Identity",V_e="IFFT",U_e="Imag",kO="IsFinite",SO="IsInf",EO="IsNan",TO="LeakyRelu",H_e="Less",q_e="LessEqual",NO="Log",IO="Log1p",K_e="LogicalAnd",j_e="LogicalNot",X_e="LogicalOr",Y_e="LogSoftmax",CO="LRN",Z_e="LRNGrad",AO="Max",DO="Maximum",_O="MaxPool",J_e="MaxPoolGrad",Q_e="MaxPool3D",e3e="MaxPool3DGrad",FO="Mean",RO="Min",OO="Minimum",PO="MirrorPad",MO="Mod",BO="Multiply",LO="Neg",t3e="NotEqual",zO="OnesLike",$O="OneHot",WO="Pack",GO="PadV2",VO="Pow",UO="Prelu",HO="Prod",r3e="Real",qO="Reciprocal",KO="Relu",jO="Reshape",XO="ResizeNearestNeighbor",n3e="ResizeNearestNeighborGrad",YO="ResizeBilinear",a3e="ResizeBilinearGrad",ZO="Relu6",JO="Reverse",QO="Round",eP="Rsqrt",i3e="TensorScatterUpdate",tP="Select",rP="Selu",nP="Slice",aP="Sin",iP="Sinh",oP="Sign",sP="Sigmoid",uP="Softplus",cP="Sqrt",lP="Sum",fP="SpaceToBatchND",hP="SplitV",pP="Softmax",dP="SquaredDifference",o3e="Square",s3e="StridedSlice",vP="Sub",mP="Tan",gP="Tanh",nw="Tile",u3e="TopK",ld="Transpose",c3e="Unique",yP="Unpack",bP="UnsortedSegmentSum",wP="ZerosLike",xP="Step";var l3e=1e-7,f3e=1e-4,Bb=class{refCount(e){return jn("refCount")}incRef(e){return jn("incRef")}timerAvailable(){return!0}time(e){return jn("time")}read(e){return jn("read")}readSync(e){return jn("readSync")}readToGPU(e,t){return jn("readToGPU")}numDataIds(){return jn("numDataIds")}disposeData(e,t){return jn("disposeData")}write(e,t,n){return jn("write")}move(e,t,n,a,i){return jn("move")}createTensorFromGPUData(e,t,n){return jn("createTensorFromGPUData")}memory(){return jn("memory")}floatPrecision(){return jn("floatPrecision")}epsilon(){return this.floatPrecision()===32?l3e:f3e}dispose(){return jn("dispose")}};function jn(r){throw new Error(`'${r}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}function ae(r,e){if(!r)throw new Error(typeof e=="string"?e:e())}function h3e(r,e,t=""){ae(aw(r,e),()=>t+` Shapes ${r} and ${e} must match`)}function Vi(r){if(r.length===0)return 1;let e=r[0];for(let t=1;t<r.length;t++)e*=r[t];return e}function aw(r,e){if(r===e)return!0;if(r==null||e==null||r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}function lf(r){return r%1===0}function fd(r,e){return e<=r.length?r:r+" ".repeat(e-r.length)}function xi(r,e){let t=e.length;return r=r==null?e.map((n,a)=>a):[].concat(r),ae(r.every(n=>n>=-t&&n<t),()=>`All values in axis param must be in range [-${t}, ${t}) but got axis ${r}`),ae(r.every(n=>lf(n)),()=>`All values in axis param must be integers but got axis ${r}`),r.map(n=>n<0?t+n:n)}function p3e(r,e){let t=[],n=[],a=e!=null&&Array.isArray(e)&&e.length===0,i=e==null||a?null:xi(e,r).sort(),o=0;for(let s=0;s<r.length;++s){if(i!=null){if(i[o]===s&&r[s]!==1)throw new Error(`Can't squeeze axis ${s} since its dim '${r[s]}' is not 1`);(i[o]==null||i[o]>s)&&r[s]===1&&(t.push(r[s]),n.push(s)),i[o]<=s&&o++}r[s]!==1&&(t.push(r[s]),n.push(s))}return{newShape:t,keptDims:n}}function d3e(r,e){for(let t=0;t<r.length;t++){let n=r[t];if(isNaN(n)||!isFinite(n))throw Error(`A tensor of type ${e} being uploaded contains ${n}.`)}}function v3e(r){return r==="bool"||r==="complex64"||r==="float32"||r==="int32"||r==="string"}function Lb(r){if(r==="float32"||r==="int32")return 4;if(r==="complex64")return 8;if(r==="bool")return 1;throw new Error(`Unknown dtype ${r}`)}function m3e(r){if(r==null)return 0;let e=0;return r.forEach(t=>e+=t.length),e}function iw(r){return typeof r=="string"||r instanceof String}function g3e(r){return typeof r=="boolean"}function y3e(r){return typeof r=="number"}function Sd(r){return Array.isArray(r)?Sd(r[0]):r instanceof Float32Array?"float32":r instanceof Int32Array||r instanceof Uint8Array||r instanceof Uint8ClampedArray?"int32":y3e(r)?"float32":iw(r)?"string":g3e(r)?"bool":"float32"}function zb(r){return!!(r&&r.constructor&&r.call&&r.apply)}function kP(r){let e=r.length;if(e<2)return[];let t=new Array(e-1);t[e-2]=r[e-1];for(let n=e-3;n>=0;--n)t[n]=t[n+1]*r[n+1];return t}function SP(r,e,t,n=!1){let a=new Array;if(e.length===1){let i=e[0]*(n?2:1);for(let o=0;o<i;o++)a[o]=t[r+o]}else{let i=e[0],o=e.slice(1),s=o.reduce((u,c)=>u*c)*(n?2:1);for(let u=0;u<i;u++)a[u]=SP(r+u*s,o,t,n)}return a}function mR(r,e,t=!1){if(r.length===0)return e[0];let n=r.reduce((a,i)=>a*i)*(t?2:1);if(n===0)return[];if(n!==e.length)throw new Error(`[${r}] does not match the input size ${e.length}${t?" for a complex tensor":""}.`);return SP(0,r,e,t)}function EP(r,e){let t=ow(r,e);for(let n=0;n<t.length;n++)t[n]=1;return t}function ow(r,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool")return new Uint8Array(r);throw new Error(`Unknown data type ${e}`)}function bf(r){r.forEach(e=>{ae(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${r}].`)})}function sw(r){return r&&r.then&&typeof r.then=="function"}var gR="tfjsflags",$b=class{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=b3e,this.populateURLFlags()}setPlatform(e,t){this.platform!=null&&(Xt().getBool("IS_TEST")||Xt().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=t}registerFlag(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},this.urlFlags[e]!=null){let a=this.urlFlags[e];Xt().getBool("IS_TEST")||Xt().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${a}.`),this.set(e,a)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];let t=this.evaluateFlag(e);if(sw(t))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;let e=this.getQueryParams(this.global.location.search);gR in e&&e[gR].split(",").forEach(n=>{let[a,i]=n.split(":");this.urlFlags[a]=x3e(a,i)})}};function b3e(r){let e={};return r.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(t,...n)=>(w3e(e,n[0],n[1]),n.join("="))),e}function w3e(r,e,t){r[decodeURIComponent(e)]=decodeURIComponent(t||"")}function x3e(r,e){let t=e.toLowerCase();return t==="true"||t==="false"?t==="true":`${+t}`===t?+t:e}function Xt(){return TP}var TP=null;function k3e(r){TP=r}var Ab;function NP(){if(Ab==null){let r;if(typeof window<"u")r=window;else if(typeof global<"u")r=global;else if(typeof process<"u")r=process;else if(typeof self<"u")r=self;else throw new Error("Could not find a global object");Ab=r}return Ab}function S3e(){let r=NP();return r._tfGlobals==null&&(r._tfGlobals=new Map),r._tfGlobals}function uw(r,e){let t=S3e();if(t.has(r))return t.get(r);{let n=e();return t.set(r,n),t.get(r)}}function tc(...r){Xt().getBool("IS_TEST")||Xt().getBool("PROD")||console.warn(...r)}var IP=uw("kernelRegistry",()=>new Map),Wb=uw("gradRegistry",()=>new Map);function yR(r,e){let t=T3e(r,e);return IP.get(t)}function bR(r){return Wb.get(r)}function wR(r){let e=IP.entries(),t=[];for(;;){let{done:n,value:a}=e.next();if(n)break;let[i,o]=a,[s]=i.split("_");s===r&&t.push(o)}return t}function E3e(r){let{kernelName:e}=r;Wb.has(e)&&Xt().getBool("DEBUG")&&tc(`Overriding the gradient for '${e}'`),Wb.set(e,r)}function T3e(r,e){return`${e}_${r}`}function N3e(r){return r instanceof Float32Array||r instanceof Int32Array||r instanceof Uint8Array||r instanceof Uint8ClampedArray}var I3e=vR.default||vR;function cw(r){return I3e.fromString(r,!0,16)}var s4e=cw("c3a5c85c97cb3127"),u4e=cw("b492b66fbe98f273"),c4e=cw("9ae16a3b2f90404f");function C3e(r,e){return r instanceof Float32Array&&e==="float32"||r instanceof Int32Array&&e==="int32"||r instanceof Uint8Array&&e==="bool"}function CP(r,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(r)&&(r=ff(r)),Xt().getBool("DEBUG")&&d3e(r,e),C3e(r,e))return r;if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool"){let t=new Uint8Array(r.length);for(let n=0;n<t.length;++n)Math.round(r[n])!==0&&(t[n]=1);return t}else throw new Error(`Unknown data type ${e}`)}function vd(){return Xt().platform.now()}function A3e(r,e="utf-8"){return e=e||"utf-8",Xt().platform.encode(r,e)}function xR(r,e="utf-8"){return e=e||"utf-8",Xt().platform.decode(r,e)}function Ma(r){return Xt().platform.isTypedArray!=null?Xt().platform.isTypedArray(r):N3e(r)}function ff(r,e=[],t=!1){if(e==null&&(e=[]),typeof r=="boolean"||typeof r=="number"||typeof r=="string"||sw(r)||r==null||Ma(r)&&t)e.push(r);else if(Array.isArray(r)||Ma(r))for(let n=0;n<r.length;++n)ff(r[n],e,t);else{let n=-1;for(let a of Object.keys(r))/^([1-9]+[0-9]*|0)$/.test(a)&&(n=Math.max(n,Number(a)));for(let a=0;a<=n;a++)ff(r[a],e,t)}return e}var Gb=class{constructor(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new Vb)}profileKernel(e,t,n){let a,i=()=>{a=n()},o,s=vd();if(this.backendTimer.timerAvailable())o=this.backendTimer.time(i);else{i();for(let c of a)c.dataSync();o=Promise.resolve({kernelMs:vd()-s})}if(Xt().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let c=0;c<a.length;c++){let l=a[c];l.data().then(f=>{D3e(f,l.dtype,e)})}return{kernelName:e,outputs:a,inputs:t,timeMs:o.then(c=>c.kernelMs),extraInfo:o.then(c=>c.getExtraProfileInfo!=null?c.getExtraProfileInfo():"")}}logKernelProfile(e){let{kernelName:t,outputs:n,timeMs:a,inputs:i,extraInfo:o}=e;n.forEach(s=>{Promise.all([s.data(),a,o]).then(u=>{this.logger.logKernelProfile(t,s,u[0],u[1],i,u[2])})})}};function D3e(r,e,t){if(e!=="float32")return!1;for(let n=0;n<r.length;n++){let a=r[n];if(isNaN(a)||!isFinite(a))return console.warn(`Found ${a} in the result of '${t}'`),!0}return!1}var Vb=class{logKernelProfile(e,t,n,a,i,o){let s=typeof a=="number"?fd(`${a}ms`,9):a.error,u=fd(e,25),c=t.rank,l=t.size,f=fd(t.shape.toString(),14),h="";for(let p in i){let d=i[p];if(d!=null){let m=d.shape||t.shape,v=m.length;h+=`${p}: ${v}D ${v>0?m:""} `}}console.log(`%c${u}	%c${s}	%c${c}D ${f}	%c${l}	%c${h}	%c${o}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}};function _3e(r,e,t){let n={},a={};for(let u=0;u<e.length;u++)n[e[u].id]=!0;for(let u=0;u<r.length;u++){let c=r[u],l=c.inputs;for(let f in l){let h=l[f],p=!1;for(let d=0;d<e.length;d++)if(n[h.id]){c.outputs.forEach(m=>n[m.id]=!0),p=!0,a[c.id]=!0;break}if(p)break}}let i={};i[t.id]=!0;let o={};for(let u=r.length-1;u>=0;u--){let c=r[u],l=c.inputs;for(let f=0;f<c.outputs.length;f++)if(i[c.outputs[f].id]){for(let h in l)i[l[h].id]=!0,o[c.id]=!0;break}}let s=[];for(let u=0;u<r.length;u++){let c=r[u];if(a[c.id]&&o[c.id]){let l={};for(let h in c.inputs){let p=c.inputs[h];n[p.id]&&(l[h]=p)}let f=Object.assign({},c);f.inputs=l,f.outputs=c.outputs,s.push(f)}}return s}function F3e(r,e,t,n){for(let a=e.length-1;a>=0;a--){let i=e[a],o=[];if(i.outputs.forEach(u=>{let c=r[u.id];c!=null?o.push(c):o.push(null)}),i.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${i.kernelName}.`);let s=i.gradient(o);for(let u in i.inputs){if(!(u in s))throw new Error(`Cannot backprop through input ${u}. Available gradients found: ${Object.keys(s)}.`);let c=t(()=>s[u]());if(c.dtype!=="float32")throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input ${u} must have 'float32' dtype, but has '${c.dtype}'`);let l=i.inputs[u];if(!aw(c.shape,l.shape))throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input '${u}' has shape '${c.shape}', which does not match the shape of the input '${l.shape}'`);if(r[l.id]==null)r[l.id]=c;else{let f=r[l.id];r[l.id]=n(f,c),f.dispose()}}}}var kR=20,rf=3,Db=7;function R3e(r,e,t,n){let a=kP(e),i=O3e(r,e,t,a),o=e.length,s=hd(r,e,t,a,i),u=["Tensor"];return n&&(u.push(`  dtype: ${t}`),u.push(`  rank: ${o}`),u.push(`  shape: [${e}]`),u.push("  values:")),u.push(s.map(c=>"    "+c).join(`
`)),u.join(`
`)}function O3e(r,e,t,n){let a=Vi(e),i=n[n.length-1],o=new Array(i).fill(0),s=e.length,u=t==="complex64"?uf(r):r;if(s>1)for(let c=0;c<a/i;c++){let l=c*i;for(let f=0;f<i;f++)o[f]=Math.max(o[f],sf(u[l+f],0,t).length)}return o}function sf(r,e,t){let n;return Array.isArray(r)?n=`${parseFloat(r[0].toFixed(Db))} + ${parseFloat(r[1].toFixed(Db))}j`:iw(r)?n=`'${r}'`:t==="bool"?n=AP(r):n=parseFloat(r.toFixed(Db)).toString(),fd(n,e)}function AP(r){return r===0?"false":"true"}function hd(r,e,t,n,a,i=!0){let o=t==="complex64"?2:1,s=e[0],u=e.length;if(u===0){if(t==="complex64"){let m=uf(r);return[sf(m[0],0,t)]}return t==="bool"?[AP(r[0])]:[r[0].toString()]}if(u===1){if(s>kR){let v=rf*o,g=Array.from(r.slice(0,v)),y=Array.from(r.slice((s-rf)*o,s*o));return t==="complex64"&&(g=uf(g),y=uf(y)),["["+g.map((w,b)=>sf(w,a[b],t)).join(", ")+", ..., "+y.map((w,b)=>sf(w,a[s-rf+b],t)).join(", ")+"]"]}return["["+(t==="complex64"?uf(r):Array.from(r)).map((v,g)=>sf(v,a[g],t)).join(", ")+"]"]}let c=e.slice(1),l=n.slice(1),f=n[0]*o,h=[];if(s>kR){for(let m=0;m<rf;m++){let v=m*f,g=v+f;h.push(...hd(r.slice(v,g),c,t,l,a,!1))}h.push("...");for(let m=s-rf;m<s;m++){let v=m*f,g=v+f;h.push(...hd(r.slice(v,g),c,t,l,a,m===s-1))}}else for(let m=0;m<s;m++){let v=m*f,g=v+f;h.push(...hd(r.slice(v,g),c,t,l,a,m===s-1))}let p=u===2?",":"";h[0]="["+(s>0?h[0]+p:"");for(let m=1;m<h.length-1;m++)h[m]=" "+h[m]+p;let d=`,
`;for(let m=2;m<u;m++)d+=`
`;return h[h.length-1]=" "+h[h.length-1]+"]"+(i?"":d),h}function uf(r){let e=[];for(let t=0;t<r.length;t+=2)e.push([r[t],r[t+1]]);return e}var bi=null,nf=null,P3e=null;function M3e(r){bi=r}function B3e(r){P3e=r}var kn=class{constructor(e,t,n,a){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=Vi(e),this.strides=kP(e),this.dataId=n,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){let e=await this.data();return nf.buffer(this.shape,this.dtype,e)}bufferSync(){return nf.buffer(this.shape,this.dtype,this.dataSync())}async array(){let e=await this.data();return mR(this.shape,e,this.dtype==="complex64")}arraySync(){return mR(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();let e=bi().read(this.dataId);if(this.dtype==="string"){let t=await e;try{return t.map(n=>xR(n))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),bi().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();let e=bi().readSync(this.dataId);if(this.dtype==="string")try{return e.map(t=>xR(t))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();let e=await bi().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),bi().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return nf.print(this,e)}clone(){return this.throwIfDisposed(),nf.clone(this)}toString(e=!1){let t=this.dataSync();return R3e(t,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),nf.cast(this,e)}variable(e=!0,t,n){return this.throwIfDisposed(),bi().makeVariable(this,e,t,n)}};Object.defineProperty(kn,Symbol.hasInstance,{value:r=>!!r&&r.data!=null&&r.dataSync!=null&&r.throwIfDisposed!=null});function ue(){return uw("Tensor",()=>kn)}ue();var nc=class extends kn{constructor(e,t,n,a){super(e.shape,e.dtype,e.dataId,a),this.trainable=t,this.name=n}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!aw(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);bi().disposeTensor(this),this.dataId=e.dataId,bi().incRef(this,null)}dispose(){bi().disposeVariable(this),this.isDisposedInternal=!0}};Object.defineProperty(nc,Symbol.hasInstance,{value:r=>r instanceof kn&&r.assign!=null&&r.assign instanceof Function});var SR;(function(r){r.R0="R0",r.R1="R1",r.R2="R2",r.R3="R3",r.R4="R4",r.R5="R5",r.R6="R6"})(SR||(SR={}));var Ub;(function(r){r.float32="float32",r.int32="int32",r.bool="int32",r.complex64="complex64"})(Ub||(Ub={}));var Hb;(function(r){r.float32="float32",r.int32="int32",r.bool="bool",r.complex64="complex64"})(Hb||(Hb={}));var qb;(function(r){r.float32="float32",r.int32="float32",r.bool="float32",r.complex64="complex64"})(qb||(qb={}));var Kb;(function(r){r.float32="complex64",r.int32="complex64",r.bool="complex64",r.complex64="complex64"})(Kb||(Kb={}));var L3e={float32:qb,int32:Ub,bool:Hb,complex64:Kb};function z3e(r,e){if(r==="string"||e==="string"){if(r==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${r} with ${e}`)}return L3e[r][e]}function DP(r){return r!=null&&typeof r=="object"&&"texture"in r&&r.texture instanceof WebGLTexture}function _P(r){return typeof GPUBuffer<"u"&&r!=null&&typeof r=="object"&&"buffer"in r&&r.buffer instanceof GPUBuffer}function Gr(r,e){if(r.dtype===e.dtype)return[r,e];let t=z3e(r.dtype,e.dtype);return[r.cast(t),e.cast(t)]}function FP(r){let e=[];return RP(r,e,new Set),e}function RP(r,e,t){if(r==null)return;if(r instanceof kn){e.push(r);return}if(!$3e(r))return;let n=r;for(let a in n){let i=n[a];t.has(i)||(t.add(i),RP(i,e,t))}}function $3e(r){return Array.isArray(r)||typeof r=="object"}function _b(r){return r.kernelName!=null}var md=class{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(let e in this.registeredVariables)this.registeredVariables[e].dispose()}},hf=class r{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new md}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;let e=this.getSortedBackends();for(let t=0;t<e.length;t++){let n=e[t];if(await this.initializeBackend(n).success){await this.setBackend(n);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){let{name:e,asyncInit:t}=this.initializeBackendsAndReturnBest();if(t)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){let{asyncInit:t}=this.initializeBackend(e);if(t)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,t,n=1){return e in this.registryFactory?(tc(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:t,priority:n},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;let{success:t,asyncInit:n}=this.initializeBackend(e);if(!(n?await t:t))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new Gb(this.backendInstance),!0}setupRegisteredKernels(){wR(this.backendName).forEach(t=>{t.setupFunc!=null&&t.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){wR(e).forEach(n=>{n.disposeFunc!=null&&n.disposeFunc(this.registry[e])})}initializeBackend(e){let t=this.registryFactory[e];if(t==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{let n=t.factory();if(n&&!(n instanceof Bb)&&typeof n.then=="function"){let a=++this.pendingBackendInitId,i=n.then(o=>a<this.pendingBackendInitId?!1:(this.registry[e]=o,this.pendingBackendInit=null,!0)).catch(o=>(a<this.pendingBackendInitId||(this.pendingBackendInit=null,tc(`Initialization of backend ${e} failed`),tc(o.stack||o.message)),!1));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}else return this.registry[e]=n,{success:!0,asyncInit:!1}}catch(n){return tc(`Initialization of backend ${e} failed`),tc(n.stack||n.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,t)=>this.registryFactory[t].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){let e=this.getSortedBackends();for(let t=0;t<e.length;t++){let n=e[t],{success:a,asyncInit:i}=this.initializeBackend(n);if(i||a)return{name:n,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,t){let n=this.state.tensorInfo.get(t),a=n.backend,i=this.readSync(t),o=a.refCount(t);a.disposeData(t,!0),n.backend=e,e.move(t,i,n.shape,n.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,t){let n=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");n=e}let a;return this.scopedRun(()=>this.startScope(n),()=>this.endScope(a),()=>(a=t(),a instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),a))}scopedRun(e,t,n){e();try{let a=n();return t(),a}catch(a){throw t(),a}}nextTensorId(){return r.nextTensorId++}nextVariableId(){return r.nextVariableId++}clone(e){let t=ne.runKernel(rw,{x:e}),n={x:e},a=o=>({x:()=>{let s="float32",u={x:o},c={dtype:s};return ne.runKernel(tw,u,c)}}),i=[];return this.addTapeNode(this.state.activeScope.name,n,[t],a,i,{}),t}runKernel(e,t,n){if(this.backendName==null&&this.backend,!(yR(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:t,attrs:n})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,t,n){let a=this.backend.numDataIds(),i=0;n.forEach(u=>{i+=u.dtype==="complex64"?3:1});let o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=a-t-i-o;if(s>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${s} data ids) after running '${e}'`)}runKernelFunc(e){let t,n=[],a=this.isTapeOn(),i=this.state.numBytes,o=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let s;this.backendName==null&&this.backend;let u,c=_b(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(_b(e)){let{kernelName:d,inputs:m,attrs:v}=e;this.backendName==null&&this.backend;let g=yR(d,this.backendName);ae(g!=null,()=>`Cannot find registered kernel '${d}' for backend '${this.backendName}'`),s=()=>{let y=this.backend.numDataIds();u=g.kernelFunc({inputs:m,attrs:v,backend:this.backend});let w=Array.isArray(u)?u:[u];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(d,y,w);let b=w.map(x=>x.rank!=null?x:this.makeTensorFromTensorInfo(x));if(a){let x=this.getTensorsForGradient(d,m,b);n=this.saveTensorsForBackwardMode(x)}return b}}else{let{forwardFunc:d}=e,m=v=>{a&&(n=v.map(g=>this.keep(this.clone(g))))};s=()=>{let v=this.backend.numDataIds();u=this.tidy(()=>d(this.backend,m));let g=Array.isArray(u)?u:[u];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(c,v,g),g}}let{inputs:l,attrs:f}=e,h=_b(e)?null:e.backwardsFunc,p;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?t=s():(p=this.profiler.profileKernel(c,l,()=>s()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(p),t=p.outputs)}),a&&this.addTapeNode(c,l,t,h,n,f),this.state.profiling&&this.state.activeProfile.kernels.push({name:c,bytesAdded:this.state.numBytes-i,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(l).map(d=>l[d]!=null?l[d].shape:null),outputShapes:t.map(d=>d.shape),kernelTimeMs:p.timeMs,extraInfo:p.extraInfo}),Array.isArray(u)?t:t[0]}saveTensorsForBackwardMode(e){return e.map(n=>this.keep(this.clone(n)))}getTensorsForGradient(e,t,n){let a=bR(e);if(a!=null){let i=a.inputsToSave||[],o=a.outputsToSave||[],s;a.saveAllInputs?(ae(Array.isArray(t),()=>"saveAllInputs is true, expected inputs to be an array."),s=Object.keys(t).map(c=>t[c])):s=i.map(c=>t[c]);let u=n.filter((c,l)=>o[l]);return s.concat(u)}return[]}makeTensor(e,t,n,a){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",a=a||this.backend;let i=e;n==="string"&&iw(e[0])&&(i=e.map(u=>A3e(u)));let o=a.write(i,t,n),s=new kn(t,n,o,this.nextTensorId());if(this.trackTensor(s,a),n==="string"){let u=this.state.tensorInfo.get(o),c=m3e(i);this.state.numBytes+=c-u.bytes,u.bytes=c}return s}makeTensorFromDataId(e,t,n,a){n=n||"float32";let i={dataId:e,shape:t,dtype:n};return this.makeTensorFromTensorInfo(i,a)}makeTensorFromTensorInfo(e,t){let{dataId:n,shape:a,dtype:i}=e,o=new kn(a,i,n,this.nextTensorId());return this.trackTensor(o,t),o}makeVariable(e,t=!0,n,a){n=n||this.nextVariableId().toString(),a!=null&&a!==e.dtype&&(e=e.cast(a));let i=new nc(e,t,n,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error(`Variable with name ${i.name} was already registered`);return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i}trackTensor(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let n=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(n=e.size*Lb(e.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n})),e instanceof nc||this.track(e)}incRef(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}removeDataId(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;let t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){let n=e.size*Lb(e.dtype);this.state.numBytes-=n}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}disposeVariables(){for(let e in this.state.registeredVariables){let t=this.state.registeredVariables[e];this.disposeVariable(t)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){let e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;let t=this.state.numBytes,n=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(a=>a.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n;for(let a of this.state.activeProfile.kernels)a.kernelTimeMs=await a.kernelTimeMs,a.extraInfo=await a.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,t,n,a,i,o){let s={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:i},u=bR(e);u!=null&&(a=u.gradFunc),a!=null&&(s.gradient=c=>(c=c.map((l,f)=>{if(l==null){let h=n[f],p=ow(h.size,h.dtype);return this.makeTensor(p,h.shape,h.dtype)}return l}),a(c.length>1?c:c[0],i,o))),this.state.activeTape.push(s)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){let t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}endScope(e){let t=FP(e),n=new Set(t.map(i=>i.id));for(let i=0;i<this.state.activeScope.track.length;i++){let o=this.state.activeScope.track[i];!o.kept&&!n.has(o.id)&&o.dispose()}let a=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach(i=>{!i.kept&&i.scopeId===a.id&&this.track(i)})}gradients(e,t,n,a=!1){if(ae(t.length>0,()=>"gradients() received an empty list of xs."),n!=null&&n.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${n.dtype}'`);let i=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));ae(i instanceof kn,()=>"The result y returned by f() must be a tensor.");let o=_3e(this.state.activeTape,t,i);if(!a&&o.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{let s={};s[i.id]=n??W3e(i.shape),F3e(s,o,c=>this.tidy(c),V3e);let u=t.map(c=>s[c.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(c=>{for(let l of c.saved)l.dispose()}),this.state.activeTape=null),{value:i,grads:u}})}customGrad(e){return ae(zb(e),()=>"The f passed in customGrad(f) must be a function."),(...t)=>{ae(t.every(s=>s instanceof kn),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let n,a={};t.forEach((s,u)=>{a[u]=s});let i=(s,u)=>(n=e(...t,u),ae(n.value instanceof kn,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),ae(zb(n.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),n.value),o=(s,u)=>{let c=n.gradFunc(s,u),l=Array.isArray(c)?c:[c];ae(l.length===t.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),ae(l.every(h=>h instanceof kn),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");let f={};return l.forEach((h,p)=>{f[p]=()=>h}),f};return this.runKernelFunc({forwardFunc:i,backwardsFunc:o,inputs:a})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}async time(e){let t=vd(),n=await this.backend.time(e);return n.wallMs=vd()-t,n}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new md;for(let e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}};hf.nextTensorId=0;hf.nextVariableId=0;function W3e(r){let e=EP(Vi(r),"float32");return ne.makeTensor(e,r,"float32")}function G3e(){let r=NP();if(r._tfengine==null){let e=new $b(r);r._tfengine=new hf(e)}return k3e(r._tfengine.ENV),M3e(()=>r._tfengine),r._tfengine}var ne=G3e();function V3e(r,e){let t={a:r,b:e};return ne.runKernel(ew,t)}function U3e(r,e){let t=r;if(Ma(r))return e==="string"?[]:[r.length];if(DP(r)){let a=r.channels||"RGBA";return[r.height,r.width*a.length]}else if(_P(r))return[r.buffer.size/(e==null?4:Lb(e))];if(!Array.isArray(r))return[];let n=[];for(;Array.isArray(t)||Ma(t)&&e!=="string";)n.push(t.length),t=t[0];return Array.isArray(r)&&Xt().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&OP(r,n,[]),n}function OP(r,e,t){if(t=t||[],!Array.isArray(r)&&!Ma(r)){ae(e.length===0,()=>`Element arr[${t.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}ae(e.length>0,()=>`Element arr[${t.join("][")}] should be a primitive, but is an array of ${r.length} elements`),ae(r.length===e[0],()=>`Element arr[${t.join("][")}] should have ${e[0]} elements, but has ${r.length} elements`);let n=e.slice(1);for(let a=0;a<r.length;++a)OP(r[a],n,t.concat(a))}function ER(r,e,t,n){if(r!=="string_or_numeric"){if(r==null)throw new Error("Expected dtype cannot be null.");if(r!=="numeric"&&r!==e||r==="numeric"&&e==="string")throw new Error(`Argument '${t}' passed to '${n}' must be ${r} tensor, but got ${e} tensor`)}}function Q(r,e,t,n="numeric"){if(r instanceof ue())return ER(n,r.dtype,e,t),r;let a=Sd(r);if(a!=="string"&&["bool","int32","float32"].indexOf(n)>=0&&(a=n),ER(n,a,e,t),r==null||!Ma(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string"){let u=r==null?"null":r.constructor.name;throw new Error(`Argument '${e}' passed to '${t}' must be a Tensor or TensorLike, but got '${u}'`)}let i=U3e(r,a);!Ma(r)&&!Array.isArray(r)&&(r=[r]);let s=a!=="string"?CP(r,a):ff(r,[],!0);return ne.makeTensor(s,i,a)}function PP(r,e,t,n="numeric"){if(!Array.isArray(r))throw new Error(`Argument ${e} passed to ${t} must be a \`Tensor[]\` or \`TensorLike[]\``);return r.map((i,o)=>Q(i,`${e}[${o}]`,t,n))}var H3e="__op";function se(r){let e=Object.keys(r);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let t=e[0],n=r[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+H3e;let a=(...i)=>{ne.startScope(t);try{let o=n(...i);return sw(o)&&console.error("Cannot return a Promise inside of tidy."),ne.endScope(o),o}catch(o){throw ne.endScope(null),o}};return Object.defineProperty(a,"name",{value:t,configurable:!0}),a}function q3e(r,e){let t=Q(r,"x","cast");if(!v3e(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");let n={x:t},a={dtype:e};return ne.runKernel(tw,n,a)}var rt=se({cast_:q3e});function K3e(r,e){let t=Q(r,"a","mul"),n=Q(e,"b","mul");[t,n]=Gr(t,n);let a={a:t,b:n};return ne.runKernel(BO,a)}var ze=se({mul_:K3e});function j3e(r,e=0){let n={x:Q(r,"x","step")},a={alpha:e};return ne.runKernel(xP,n,a)}var Ed=se({step_:j3e});var MP={kernelName:WR,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>ze(r,Ed(rt(t,"float32"),-1))}}};function X3e(r,e){let t=Q(r,"a","floorDiv"),n=Q(e,"b","floorDiv");[t,n]=Gr(t,n);let a={a:t,b:n};return ne.runKernel(yO,a)}var BP=se({floorDiv_:X3e});function Y3e(r,e){let t=Q(r,"a","div"),n=Q(e,"b","div");if([t,n]=Gr(t,n),t.dtype==="int32"&&n.dtype==="int32")return BP(t,n);let a={a:t,b:n},i={};return ne.runKernel(fO,a,i)}var wr=se({div_:Y3e});function Z3e(r){let t={x:Q(r,"x","neg")};return ne.runKernel(LO,t)}var pn=se({neg_:Z3e});function J3e(r,e,t,n){if(n==null)n=Sd(r);else if(n==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(_P(r)||DP(r)){if(n!=="float32"&&n!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${n}.`);return ne.backend.createTensorFromGPUData(r,e||t,n)}if(!Ma(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){bf(e);let a=Vi(e),i=Vi(t);ae(a===i,()=>`Based on the provided shape, [${e}], the tensor should have ${a} values but has ${i}`);for(let o=0;o<t.length;++o){let s=t[o],u=o===t.length-1?s!==Vi(e.slice(o)):!0;ae(t[o]===e[o]||!u,()=>`Error creating a new Tensor. Inferred shape (${t}) does not match the provided shape (${e}). `)}}return!Ma(r)&&!Array.isArray(r)&&(r=[r]),e=e||t,r=n!=="string"?CP(r,n):ff(r,[],!0),ne.makeTensor(r,e,n)}function Wr(r,e){if((Ma(r)&&e!=="string"||Array.isArray(r))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&Ma(r)&&!(r instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return J3e(r,[],[],e)}function Q3e(r){let t={x:Q(r,"x","sqrt","float32")};return ne.runKernel(cP,t)}var Co=se({sqrt_:Q3e});function eFe(r){let e=Q(r,"x","square"),t={};return ne.runKernel("Square",{x:e},t)}var Zr=se({square_:eFe});function tFe(r,e){let t=Q(r,"a","sub"),n=Q(e,"b","sub");[t,n]=Gr(t,n);let a={a:t,b:n};return ne.runKernel(vP,a)}var rn=se({sub_:tFe});var rFe={kernelName:GR,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>{let n=Zr(rt(t,"float32")),a=Co(rn(Wr(1),n));return pn(wr(r,a))}}}};var nFe={kernelName:VR,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>{let n=Co(rn(Zr(rt(t,"float32")),1));return wr(r,n)}}}};function Jr(r,e){let t=[];for(let n=0;n<e.length;n++){let a=r[r.length-n-1],i=e.length-n-1,o=e[i];(a==null||a===1&&o>1)&&t.unshift(i)}return t}function xr(r,e){let t=Math.max(r.length,e.length),n=new Array(t);for(let a=0;a<t;a++){let i=r[r.length-a-1];i==null&&(i=1);let o=e[e.length-a-1];if(o==null&&(o=1),i===1)n[t-a-1]=o;else if(o===1)n[t-a-1]=i;else if(i!==o){let s=`Operands could not be broadcast together with shapes ${r} and ${e}.`;throw Error(s)}else n[t-a-1]=i}return n}function aFe(r,e){let n={x:Q(r,"x","reshape","string_or_numeric")},a={shape:e};return ne.runKernel(jO,n,a)}var he=se({reshape_:aFe});function iFe(r,e=null,t=!1){let n=Q(r,"x","sum");n.dtype==="bool"&&(n=rt(n,"int32"));let a={x:n},i={axis:e,keepDims:t};return ne.runKernel(lP,a,i)}var xt=se({sum_:iFe});var oFe={kernelName:ew,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e,a=xr(t.shape,n.shape);return{a:()=>{let s=r,u=Jr(t.shape,a);return u.length>0&&(s=xt(s,u)),he(s,t.shape)},b:()=>{let s=r,u=Jr(n.shape,a);return u.length>0&&(s=xt(s,u)),he(s,n.shape)}}}};var sFe={kernelName:w_e,saveAllInputs:!0,gradFunc:(r,e)=>{let t={};return e.forEach((n,a)=>{t[a]=()=>r.clone()}),t}};function uFe(r){let t={x:Q(r,"x","zerosLike")};return ne.runKernel(wP,t)}var lr=se({zerosLike_:uFe});var cFe={kernelName:UR,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>lr(t)}}};var lFe={kernelName:HR,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>lr(t)}}};var fFe={kernelName:qR,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>wr(r,Co(rn(Wr(1),Zr(rt(t,"float32")))))}}};function hFe(r,e){let t=Q(r,"a","add"),n=Q(e,"b","add");[t,n]=Gr(t,n);let a={a:t,b:n};return ne.runKernel(ew,a)}var Pa=se({add_:hFe});var pFe={kernelName:KR,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>{let n=Co(Pa(Wr(1),Zr(rt(t,"float32"))));return wr(r,n)}}}};var dFe={kernelName:YR,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e,a=xr(t.shape,n.shape);return{a:()=>{let s=Pa(Zr(t),Zr(n)),u=ze(r,wr(n,s)),c=Jr(t.shape,a);return c.length>0&&(u=xt(u,c)),he(u,t.shape)},b:()=>{let s=Pa(Zr(t),Zr(n)),u=pn(ze(r,wr(t,s))),c=Jr(n.shape,a);return c.length>0&&(u=xt(u,c)),he(u,n.shape)}}}};var vFe={kernelName:jR,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>wr(r,Pa(Zr(rt(t,"float32")),1))}}};var mFe={kernelName:XR,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>wr(r,rn(Wr(1),Zr(rt(t,"float32"))))}}};function gFe(r,e,t,n,a,i,o="channelsLast"){let[s,u]=pf(e),c;if(o==="channelsLast")c=[s,u,r[3],r[3]];else if(o==="channelsFirst")c=[s,u,r[1],r[1]];else throw new Error(`Unknown dataFormat ${o}`);return yFe(r,c,t,n,a,i,!1,o)}function yFe(r,e,t,n,a,i,o=!1,s="channelsLast"){let[u,c,l,f]=[-1,-1,-1,-1];if(s==="channelsLast")[u,c,l,f]=r;else if(s==="channelsFirst")[u,f,c,l]=r;else throw new Error(`Unknown dataFormat ${s}`);let[h,p,,d]=e,[m,v]=pf(t),[g,y]=pf(n),w=jb(h,g),b=jb(p,y),{padInfo:x,outHeight:S,outWidth:T}=xFe(a,c,l,m,v,w,b,i,s),N=o?d*f:d,C;return s==="channelsFirst"?C=[u,N,S,T]:s==="channelsLast"&&(C=[u,S,T,N]),{batchSize:u,dataFormat:s,inHeight:c,inWidth:l,inChannels:f,outHeight:S,outWidth:T,outChannels:N,padInfo:x,strideHeight:m,strideWidth:v,filterHeight:h,filterWidth:p,effectiveFilterHeight:w,effectiveFilterWidth:b,dilationHeight:g,dilationWidth:y,inShape:r,outShape:C,filterShape:e}}function bFe(r,e,t,n,a){n==null&&(n=wFe(r,e,t));let i=r[0],o=r[1],s=gd((i-e+2*n)/t+1,a),u=gd((o-e+2*n)/t+1,a);return[s,u]}function wFe(r,e,t,n=1){let a=jb(e,n);return Math.floor((r[0]*(t-1)-t+a)/2)}function pf(r){return typeof r=="number"?[r,r,r]:r.length===2?[r[0],r[1],1]:r}function jb(r,e){return e<=1?r:r+(r-1)*(e-1)}function xFe(r,e,t,n,a,i,o,s,u){let c,l,f;if(typeof r=="number"){c={top:r,bottom:r,left:r,right:r,type:r===0?"VALID":"NUMBER"};let p=bFe([e,t],i,n,r,s);l=p[0],f=p[1]}else if(r==="same"){l=Math.ceil(e/n),f=Math.ceil(t/a);let h=Math.max(0,(l-1)*n+i-e),p=Math.max(0,(f-1)*a+o-t),d=Math.floor(h/2),m=h-d,v=Math.floor(p/2),g=p-v;c={top:d,bottom:m,left:v,right:g,type:"SAME"}}else if(r==="valid")c={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((e-i+1)/n),f=Math.ceil((t-o+1)/a);else if(typeof r=="object"){let h=u==="channelsLast"?r[1][0]:r[2][0],p=u==="channelsLast"?r[1][1]:r[2][1],d=u==="channelsLast"?r[2][0]:r[3][0],m=u==="channelsLast"?r[2][1]:r[3][1];c={top:h,bottom:p,left:d,right:m,type:h===0&&p===0&&d===0&&m===0?"VALID":"EXPLICIT"},l=gd((e-i+h+p)/n+1,s),f=gd((t-o+d+m)/a+1,s)}else throw Error(`Unknown padding parameter: ${r}`);return{padInfo:c,outHeight:l,outWidth:f}}function gd(r,e){if(!e)return Math.trunc(r);switch(e){case"round":return Math.round(r);case"ceil":return Math.ceil(r);case"floor":return Math.floor(r);default:throw new Error(`Unknown roundingMode ${e}`)}}function df(r){let[e,t,n]=pf(r);return e===1&&t===1&&n===1}function uc(r,e){return df(r)||df(e)}function yd(r){return pf(r).every(e=>e>0)}function ai(r,e,t){if(t!=null){if(typeof e=="string")throw Error(`Error in ${r}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);if(typeof e=="number")ae(lf(e),()=>`Error in ${r}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);else if(typeof e=="object")e.forEach(n=>{n.forEach(a=>{ae(lf(a),()=>`Error in ${r}: pad must be an integer when using dimRoundingMode ${t} but got pad ${a}.`)})});else throw Error(`Error in ${r}: Unknown padding parameter: ${e}`)}}function kFe(r,e,t,n,a,i){let o=Q(r,"dy","avgPool3dGrad"),s=Q(e,"input","avgPool3dGrad"),u=o,c=s,l=!1;s.rank===4&&(l=!0,u=he(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),c=he(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),ae(u.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${u.rank}.`),ae(c.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${c.rank}.`),ai("avgPool3dGrad",a,i);let f={dy:u,input:c},h={filterSize:t,strides:n,pad:a,dimRoundingMode:i},p=ne.runKernel(T_e,f,h);return l?he(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}var SFe=se({avgPool3dGrad_:kFe});var EFe={kernelName:E_e,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{filterSize:a,strides:i,pad:o,dimRoundingMode:s}=t;return{x:()=>SFe(r,n,a,i,o,s)}}};function TFe(r,e,t,n,a){let i=Q(r,"dy","avgPoolGrad"),o=Q(e,"input","avgPoolGrad");ae(o.rank===i.rank,()=>`Rank of input (${o.rank}) does not match rank of dy (${i.rank})`);let s=o,u=i,c=!1;o.rank===3&&(c=!0,s=he(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=he(i,[1,i.shape[0],i.shape[1],i.shape[2]])),ae(u.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${u.rank}.`),ae(s.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${s.rank}.`);let l={dy:u,input:s},f={filterSize:t,strides:n,pad:a},h=ne.runKernel(S_e,l,f);return c?he(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var NFe=se({avgPoolGrad_:TFe});var IFe={kernelName:ZR,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{filterSize:a,strides:i,pad:o}=t;return{x:()=>NFe(r,n,a,i,o)}}};function CFe(r,e,t=!1,n=!1){let a=Q(r,"a","matMul"),i=Q(e,"b","matMul");[a,i]=Gr(a,i);let o={a,b:i},s={transposeA:t,transposeB:n};return ne.runKernel(JR,o,s)}var sa=se({matMul_:CFe});var AFe={kernelName:JR,inputsToSave:["a","b"],gradFunc:(r,e,t)=>{let[n,a]=e,{transposeA:i,transposeB:o}=t;return!i&&!o?{a:()=>sa(r,a,!1,!0),b:()=>sa(n,r,!0,!1)}:!i&&o?{a:()=>sa(r,a,!1,!1),b:()=>sa(r,n,!0,!1)}:i&&!o?{a:()=>sa(a,r,!1,!0),b:()=>sa(n,r,!1,!1)}:{a:()=>sa(a,r,!0,!0),b:()=>sa(r,n,!0,!0)}}};function DFe(r,e,t){let n=Q(r,"x","spaceToBatchND");ae(n.rank>=1+e.length,()=>`input rank ${n.rank} should be > than [blockShape] ${e.length}`),ae(t.length===e.length,()=>`paddings.shape[0] ${t.length} must be equal to [blockShape] ${e.length}`),ae(n.shape.reduce((o,s,u)=>u>0&&u<=e.length?o&&(s+t[u-1][0]+t[u-1][1])%e[u-1]===0:o,!0),()=>`input spatial dimensions ${n.shape.slice(1)} with paddings ${t.toString()} must be divisible by blockShapes ${e.toString()}`);let a={x:n},i={blockShape:e,paddings:t};return ne.runKernel(fP,a,i)}var lw=se({spaceToBatchND_:DFe});var _Fe={kernelName:QR,gradFunc:(r,e,t)=>{let{blockShape:n,crops:a}=t;return{x:()=>lw(r,n,a)}}};var FFe={kernelName:N_e,gradFunc:(r,e,t)=>{let n=t,a=n.inputShape,i=n.shape,o=Array.from(i);for(let u=a.length-1;u>=0;u--)if(a[u]===i[u])o[u]=1;else if(a[u]!==1)throw new Error(`broadcastTo(): [${a}] cannot be broadcast to [${i}].`);let s=[];for(let u=0;u<o.length;u++)o[u]>1&&s.push(u);return{x:()=>xt(r,s,!0)}}};var RFe={kernelName:tw,gradFunc:r=>({x:()=>r.clone()})};var OFe={kernelName:eO,gradFunc:r=>({x:()=>lr(r)})};function PFe(r,e){let t=Q(r,"a","greaterEqual","string_or_numeric"),n=Q(e,"b","greaterEqual","string_or_numeric");[t,n]=Gr(t,n),xr(t.shape,n.shape);let a={a:t,b:n};return ne.runKernel(xO,a)}var Td=se({greaterEqual_:PFe});function MFe(r,e){let t=Q(r,"a","lessEqual","string_or_numeric"),n=Q(e,"b","lessEqual","string_or_numeric");[t,n]=Gr(t,n),xr(t.shape,n.shape);let a={a:t,b:n};return ne.runKernel(q_e,a)}var Nd=se({lessEqual_:MFe});function BFe(r,e){let t=Q(r,"a","logicalAnd","bool"),n=Q(e,"b","logicalAnd","bool");xr(t.shape,n.shape);let a={a:t,b:n};return ne.runKernel(K_e,a)}var vf=se({logicalAnd_:BFe});function LFe(r){let t={x:Q(r,"x","clone","string_or_numeric")};return ne.runKernel(rw,t)}var LP=se({clone_:LFe});function zFe(r,e){let t=Q(r,"broadcastTo","x"),n=t.shape;if(bf(e),e.length<t.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${t.rank}.`);if(e.length>t.rank){let c=t.shape.slice();for(;c.length<e.length;)c.unshift(1);t=he(t,c)}let a=t.shape,i=Array.from(e);for(let c=e.length-1;c>=0;c--)if(a[c]===e[c])i[c]=1;else if(t.shape[c]!==1)throw new Error(`broadcastTo(): [${n}] cannot be broadcast to [${e}].`);if(i.map((c,l)=>c>1?l:-1).filter(c=>c>=0).length===0)return LP(t);let s={x:t},u={reps:i};return ne.runKernel(nw,s,u)}var pd=se({broadcastTo_:zFe});function $Fe(r,e,t){let n=Q(e,"a","where"),a=Q(t,"b","where"),i=Q(r,"condition","where","bool"),o=xr(xr(i.shape,n.shape),a.shape),s=pd(i,o),u=pd(n,o),c=pd(a,o),l={condition:s,t:u,e:c};return ne.runKernel(tP,l)}var Ui=se({where_:$Fe});var WFe={kernelName:tO,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{clipValueMin:a,clipValueMax:i}=t;return{x:()=>Ui(vf(Td(n,a),Nd(n,i)),r,lr(r))}}};var GFe={kernelName:rO,inputsToSave:["x"],gradFunc:MP.gradFunc};function VFe(r,e,t=0){let a={x:Q(r,"x","split")},i={numOrSizeSplits:e,axis:t};return ne.runKernel(hP,a,i)}var bd=se({split_:VFe});var UFe={kernelName:nO,saveAllInputs:!0,gradFunc:(r,e,t)=>{let n=e.map(u=>u.shape),{axis:a}=t,i=xi(a,e[0].shape)[0],o=n.map(u=>u[i]);return bd(r,o,i).map(u=>()=>u)}};function HFe(r,e,t,n,a,i="NHWC",o){let s=r;r.rank===3&&(s=he(r,[1,r.shape[0],r.shape[1],r.shape[2]]));let u=e;u.rank===3&&(u=he(e,[1,e.shape[0],e.shape[1],e.shape[2]])),ae(s.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${s.shape}.`),ae(u.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${u.shape}.`),ae(t.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${t}.`);let c=i==="NHWC"?s.shape[3]:s.shape[1],l=i==="NHWC"?u.shape[3]:u.shape[1];ae(c===t[2],()=>`Error in conv2dDerFilter: depth of input ${c}) must match input depth in filter (${t[2]}.`),ae(l===t[3],()=>`Error in conv2dDerFilter: depth of dy (${l}) must match output depth for filter (${t[3]}).`),ai("conv2dDerFilter",a,o);let f={x:s,dy:u},h={strides:n,pad:a,dataFormat:i,dimRoundingMode:o,filterShape:t};return ne.runKernel(C_e,f,h)}var zP=se({conv2DBackpropFilter_:HFe});function qFe(r,e,t,n,a,i="NHWC",o){ae(r.length===e.rank,()=>`Length of inShape (${r.length}) and rank of dy (${e.rank}) must match`);let s=r,u=e,c=!1;e.rank===3&&(c=!0,u=he(e,[1,e.shape[0],e.shape[1],e.shape[2]]),s=[1,r[0],r[1],r[2]]),ae(s.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${s.length}.`),ae(u.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${u.rank}`),ae(t.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${t.rank}`);let l=i==="NHWC"?s[3]:s[1],f=i==="NHWC"?u.shape[3]:u.shape[1];ae(l===t.shape[2],()=>`Error in conv2dDerInput: depth of input (${l}) must match input depth for filter ${t.shape[2]}.`),ae(f===t.shape[3],()=>`Error in conv2dDerInput: depth of output (${f}) must match output depth for filter ${t.shape[3]}.`),ai("conv2dDerInput",a,o);let h={dy:u,filter:t},p={strides:n,pad:a,dataFormat:i,dimRoundingMode:o,inputShape:s},d=ne.runKernel(iO,h,p);return c?he(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var $P=se({conv2DBackpropInput_:qFe});var KFe={kernelName:aO,inputsToSave:["x","filter"],gradFunc:(r,e,t)=>{let[n,a]=e,{dilations:i,strides:o,pad:s,dataFormat:u}=t;return ae(df(i),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`),{x:()=>$P(n.shape,r,a,o,s,u),filter:()=>zP(n,r,a.shape,o,s,u)}}};function jFe(r,e,t,n,a="NHWC",i=[1,1],o){let s=Q(r,"x","conv2d","float32"),u=Q(e,"filter","conv2d","float32"),c=s,l=!1;s.rank===3&&(l=!0,c=he(s,[1,s.shape[0],s.shape[1],s.shape[2]])),ae(c.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${c.rank}.`),ae(u.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${u.rank}.`),ai("conv2d",n,o);let f=a==="NHWC"?c.shape[3]:c.shape[1];ae(f===u.shape[2],()=>`Error in conv2d: depth of input (${f}) must match input depth for filter ${u.shape[2]}.`),ae(uc(t,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`),ae(yd(i),()=>"Error in conv2D: Dilated rates should be larger than 0."),ae(yd(t),()=>"Error in conv2D: Strides should be larger than 0.");let h={x:c,filter:u},p={strides:t,pad:n,dataFormat:a,dilations:i,dimRoundingMode:o},d=ne.runKernel(aO,h,p);return l?he(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var Id=se({conv2d_:jFe});var XFe={kernelName:iO,inputsToSave:["dy","filter"],gradFunc:(r,e,t)=>{let[n,a]=e,{strides:i,pad:o,dataFormat:s,dimRoundingMode:u}=t;return{dy:()=>Id(r,a,i,o,s,1,u),filter:()=>zP(r,n,a.shape,i,o,s,u)}}};function YFe(r,e,t,n,a){let i=r;r.rank===4&&(i=he(r,[1,r.shape[0],r.shape[1],r.shape[2],r.shape[3]]));let o=e;o.rank===4&&(o=he(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),ae(i.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${i.shape}.`),ae(o.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${o.shape}.`),ae(t.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${t}.`),ae(i.shape[4]===t[3],()=>`Error in conv3dDerFilter: depth of input ${i.shape[4]}) must match input depth in filter (${t[3]}.`),ae(o.shape[4]===t[4],()=>`Error in conv3dDerFilter: depth of dy (${o.shape[4]}) must match output depth for filter (${t[4]}).`);let s={x:i,dy:o},u={strides:n,pad:a,filterShape:t};return ne.runKernel(D_e,s,u)}var ZFe=se({conv3DBackpropFilter_:YFe});function JFe(r,e,t,n,a){ae(r.length===e.rank,()=>`Length of inShape (${r.length}) and rank of dy (${e.rank}) must match`);let i=r,o=e,s=!1;e.rank===4&&(s=!0,o=he(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),i=[1,r[0],r[1],r[2],r[3]]);let u=i[4],c=o.shape[4];ae(i.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${i.length}.`),ae(o.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${o.rank}`),ae(t.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${t.rank}`),ae(u===t.shape[3],()=>`Error in conv3dDerInput: depth of input (${u}) must match input depth for filter ${t.shape[3]}.`),ae(c===t.shape[4],()=>`Error in conv3dDerInput: depth of output (${c}) must match output depth for filter ${t.shape[4]}.`);let l={dy:o,filter:t},f={pad:a,strides:n,inputShape:i},h=ne.runKernel(__e,l,f);return s?he(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var QFe=se({conv3DBackpropInput_:JFe});var eRe={kernelName:A_e,inputsToSave:["x","filter"],gradFunc:(r,e,t)=>{let{dilations:n,strides:a,pad:i}=t;ae(df(n),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${n}'`);let[o,s]=e;return{x:()=>QFe(o.shape,r,s,a,i),filter:()=>ZFe(o,r,s.shape,a,i)}}};function tRe(r){let t={x:Q(r,"x","sin","float32")};return ne.runKernel(aP,t)}var WP=se({sin_:tRe});var rRe={kernelName:oO,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>ze(pn(WP(rt(t,"float32"))),r)}}};function nRe(r){let t={x:Q(r,"x","sinh")};return ne.runKernel(iP,t)}var GP=se({sinh_:nRe});var aRe={kernelName:sO,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>ze(GP(rt(t,"float32")),r)}}};function iRe(r,e){for(let t=0;t<r.length;++t)if(r[r.length-t-1]!==e-1-t)return!1;return!0}function oRe(r,e,t){let n=r.length+e.length,a=[],i=0,o=0;for(let s=0;s<n;s++)t.indexOf(s)===-1?a.push(r[i++]):a.push(e[o++]);return a}function sRe(r,e){let t=[],n=r.length;for(let i=0;i<n;i++)e.indexOf(i)===-1&&t.push(r[i]);let a=e.map(i=>r[i]);return[t,a]}function wd(r,e){let t=e.map(n=>1);return oRe(r,t,e)}function VP(r,e){if(iRe(r,e))return null;let t=[];for(let n=0;n<e;++n)r.indexOf(n)===-1&&t.push(n);return r.forEach(n=>t.push(n)),t}function fw(r){return r.map((e,t)=>[t,e]).sort((e,t)=>e[1]-t[1]).map(e=>e[0])}function uRe(r,e=0,t=!1,n=!1){let i={x:Q(r,"x","cumsum")},o={axis:e,exclusive:t,reverse:n};return ne.runKernel(uO,i,o)}var UP=se({cumsum_:uRe});function cRe(r){Xt().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(r+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}B3e(cRe);function lRe(r,e){return ne.tidy(r,e)}function TR(r){FP(r).forEach(t=>t.dispose())}function fRe(r,e){let t=Q(r,"real","complex"),n=Q(e,"imag","complex");h3e(t.shape,n.shape,`real and imag shapes, ${t.shape} and ${n.shape}, must match in call to tf.complex().`);let a={real:t,imag:n};return ne.runKernel(I_e,a)}var ac=se({complex_:fRe});function hRe(r){let t={input:Q(r,"input","imag")};return ne.runKernel(U_e,t)}var hw=se({imag_:hRe});function pRe(r){let t={input:Q(r,"input","real")};return ne.runKernel(r3e,t)}var xd=se({real_:pRe});function dRe(r,e,t){let n=Q(r,"x","transpose");if(e==null&&(e=n.shape.map((o,s)=>s).reverse()),ae(n.rank===e.length,()=>`Error in transpose: rank of input ${n.rank} must match length of perm ${e}.`),e.forEach(o=>{ae(o>=0&&o<n.rank,()=>`All entries in 'perm' must be between 0 and ${n.rank-1} but got ${e}`)}),n.rank<=1)return n.clone();let a={x:n},i={perm:e};return n.dtype==="complex64"?lRe(()=>{let o=xd(n),s=hw(n);return o=ne.runKernel(ld,{x:o},i),s=ne.runKernel(ld,{x:s},i),t&&(s=pn(s)),ac(o,s)}):ne.runKernel(ld,a,i)}var zs=se({transpose_:dRe});var vRe={kernelName:uO,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{axis:a,exclusive:i,reverse:o}=t;return{x:()=>{let s=VP([a],n.rank),u=UP(r,a,i,!o);return s!=null&&(u=zs(u,s)),u}}}};function mRe(r,e,t,n,a,i=[1,1],o){let s=r;r.rank===3&&(s=he(r,[1,r.shape[0],r.shape[1],r.shape[2]]));let u=e;u.rank===3&&(u=he(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let c={x:s,dy:u},l={strides:n,pad:a,dimRoundingMode:o,dilations:i,filterShape:t};return ne.runKernel(O_e,c,l)}var gRe=se({depthwiseConv2dNativeBackpropFilter_:mRe});function yRe(r,e,t,n,a,i=[1,1],o){let s=e,u=!1;e.rank===3&&(u=!0,s=he(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let c={dy:s,filter:t},l={strides:n,pad:a,dimRoundingMode:o,dilations:i,inputShape:r},f=ne.runKernel(P_e,c,l);return u?he(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var bRe=se({depthwiseConv2dNativeBackpropInput_:yRe});var wRe={kernelName:cO,inputsToSave:["x","filter"],gradFunc:(r,e,t)=>{let{dilations:n,strides:a,pad:i,dimRoundingMode:o}=t,s=n??[1,1];ae(df(s),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${s}'`);let[u,c]=e;return ae(u.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${u.rank}.`),ae(c.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${c.rank}.`),ae(u.shape[3]===c.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${u.shape[3]}) must match the inChannels dimension in filter ${c.shape[2]}.`),ae(uc(a,s),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${a} and dilations '${s}'.`),ai("depthwiseConv2d",i,o),{x:()=>bRe(u.shape,r,c,a,i,s,o),filter:()=>gRe(u,r,c.shape,a,i,s,o)}}};var xRe={kernelName:lO,inputsToSave:["x","filter"],gradFunc:(r,e,t)=>{let[n,a]=e,i={x:n,filter:a,dy:r},o={x:n,filter:a,dy:r};return{x:()=>ne.runKernel(M_e,i,t),filter:()=>ne.runKernel(B_e,o,t)}}};var kRe={kernelName:hO,outputsToSave:[!0],gradFunc:(r,e)=>{let[t]=e,n={dy:r,y:t};return{x:()=>ne.runKernel(L_e,n)}}};function SRe(r){let t={x:Q(r,"x","exp")};return ne.runKernel(dO,t)}var Ao=se({exp_:SRe});var ERe={kernelName:pO,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e,n=ze(Ao(pn(Zr(t))),2/Math.sqrt(Math.PI));return{x:()=>ze(r,n)}}};var TRe={kernelName:dO,outputsToSave:[!0],gradFunc:(r,e)=>{let[t]=e;return{x:()=>ze(r,t)}}};var NRe={kernelName:vO,inputsToSave:["input"],gradFunc:(r,e)=>{let[t]=e;return{input:()=>he(r,t.shape)}}};var IRe={kernelName:mO,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>ze(r,Ao(t))}}};var CRe={kernelName:gO,gradFunc:r=>({x:()=>lr(r)})};var ARe={kernelName:yO,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e,a=xr(t.shape,n.shape);return{a:()=>{let s=wr(r,rt(n,"float32")),u=Jr(t.shape,a);return u.length>0?he(xt(s,u),t.shape):s},b:()=>{let s=ze(r,rt(t,"float32")),u=Jr(n.shape,a);u.length>0&&(s=he(xt(s,u),n.shape));let c=Zr(n);return pn(wr(s,rt(c,"float32")))}}}};function DRe(r){let t={x:Q(r,"x","rsqrt","float32")};return ne.runKernel(eP,t)}var HP=se({rsqrt_:DRe});function _Re(r,e){let t=Q(r,"x","tile","string_or_numeric");ae(t.rank===e.length,()=>`Error in transpose: rank of input ${t.rank} must match length of reps ${e}.`);let n={x:t},a={reps:e};return ne.runKernel(nw,n,a)}var qP=se({tile_:_Re});var FRe={kernelName:bO,inputsToSave:["x","mean","variance","scale"],gradFunc:(r,e,t)=>{let{varianceEpsilon:n}=t,[a,i,o,s]=e,u=s??Wr(1),c=Jr(i.shape,a.shape),l=[];if(i.rank===1){for(let b=0;b<a.shape.length-1;++b)l.push(a.shape[b]);l.push(1)}let f=rn(a,i),h=ze(r,u),p=HP(Pa(o,Wr(n))),d=ze(ze(ze(p,p),p),Wr(-.5));return{x:()=>i.rank===1?he(ze(ze(r,qP(he(p,[1,1,1,i.shape[0]]),l)),u),a.shape):he(ze(ze(r,p),u),a.shape),mean:()=>{let b=ze(ze(p,Wr(-1)),h);return i.rank===1&&(b=xt(b,c)),he(b,i.shape)},variance:()=>{let b=ze(ze(d,f),h);return i.rank===1&&(b=xt(b,c)),he(b,i.shape)},scale:()=>{let b=ze(f,p),x=ze(r,b);return i.rank===1&&(x=xt(x,c)),he(x,i.shape)},offset:()=>{let b=r;return i.rank===1&&(b=xt(b,c)),he(b,i.shape)}}}};function RRe(r,e=0){let t=PP(r,"tensors","stack","string_or_numeric");ae(t.length>=1,()=>"Pass at least one tensor to tf.stack"),t.length>0&&ae(e<=t[0].rank,()=>"Axis must be <= rank of the tensor");let n=t,a={axis:e};return ne.runKernel(WO,n,a)}var pw=se({stack_:RRe});function ORe(r,e,t){let n=Q(r,"x","unsortedSegmentSum"),a=Q(e,"segmentIds","unsortedSegmentSum","int32");ae(lf(t),()=>"numSegments must be of dtype int");let i={x:n,segmentIds:a},o={numSegments:t};return ne.runKernel(bP,i,o)}var KP=se({unsortedSegmentSum_:ORe});var PRe={kernelName:wO,inputsToSave:["x","indices"],gradFunc:(r,e,t)=>{let[n,a]=e,{axis:i,batchDims:o}=t,s=xi(i,n.shape)[0],u=(c,l,f)=>()=>{let h=c.shape,p=l.size,d=h.slice(0,s),m=d.length,v=h.slice(i,h.length).slice(1),g=v.length,y=NR(0,m),w=NR(m+1,m+1+g),b=IR([d,[p],v]),x=he(f,b),S=he(l,[p]),T=IR([[m],y,w]),N=zs(x,T),C=KP(N,S,c.shape[s]),R=fw(T);return C=zs(C,R),C};if(o===1){let c=n.shape[0],l=n.split(c,0);return{x:()=>pw(l.map((p,d)=>u(p,a.slice(d,1),r.slice(d,1))())).reshape(n.shape),indices:()=>a}}else return{x:u(n,a,r),indices:()=>a}}};function NR(r,e){let t=[];for(let n=r;n<e;++n)t.push(n);return t}function IR(r){let e=[];for(let t=0;t<r.length;++t)for(let n=0;n<r[t].length;++n)e.push(r[t][n]);return e}var MRe={kernelName:xO,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e;return{a:()=>lr(t),b:()=>lr(n)}}};var BRe={kernelName:rw,gradFunc:r=>({x:()=>rt(r,"float32")})};var LRe={kernelName:kO,gradFunc:r=>({x:()=>lr(r)})};var zRe={kernelName:SO,gradFunc:r=>({x:()=>lr(r)})};var $Re={kernelName:EO,gradFunc:r=>({x:()=>lr(r)})};function WRe(r,e){let t=Q(r,"a","greater","string_or_numeric"),n=Q(e,"b","greater","string_or_numeric");[t,n]=Gr(t,n),xr(t.shape,n.shape);let a={a:t,b:n};return ne.runKernel(G_e,a)}var cc=se({greater_:WRe});var GRe={kernelName:TO,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{alpha:a}=t,i=cc(n,0);return{x:()=>Ui(i,r,ze(r,a))}}};var VRe={kernelName:IO,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>wr(r,Pa(t,1))}}};var URe={kernelName:NO,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>wr(r,rt(t,"float32"))}}};var HRe={kernelName:Y_e,inputsToSave:[],outputsToSave:[!0],gradFunc:(r,e,t)=>{let[n]=e,{axis:a}=t;return{logits:()=>{let o=Ao(n);return rn(r,ze(xt(r,a,!0),o))}}}};function qRe(r,e,t,n=5,a=1,i=1,o=.5){let s={x:r,y:e,dy:t},u={depthRadius:n,bias:a,alpha:i,beta:o};return ne.runKernel(Z_e,s,u)}var KRe=se({localResponseNormalizationBackprop_:qRe});var jRe={kernelName:CO,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(r,e,t)=>{let[n,a]=e,{depthRadius:i,bias:o,alpha:s,beta:u}=t;return{x:()=>KRe(n,a,r,i,o,s,u)}}};function XRe(r,e){let t=Q(r,"a","equal","string_or_numeric"),n=Q(e,"b","equal","string_or_numeric");[t,n]=Gr(t,n),xr(t.shape,n.shape);let a={a:t,b:n};return ne.runKernel(z_e,a)}var dw=se({equal_:XRe});function jP(r,e,t,n){return e.rank<t.rank&&(e=he(e,wd(e.shape,n))),r.rank<t.rank&&(r=he(r,wd(r.shape,n))),{x:()=>ze(r,rt(dw(t,e),r.dtype))}}var CR={kernelName:AO,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(r,e,t)=>{let n=t,{reductionIndices:a}=n,i=e[0],o=e[1],s=xi(a,i.shape),u=jP(r,o,i,s);return{x:()=>u.x()}}};function YRe(r,e){let t=Q(r,"a","less","string_or_numeric"),n=Q(e,"b","less","string_or_numeric");[t,n]=Gr(t,n),xr(t.shape,n.shape);let a={a:t,b:n};return ne.runKernel(H_e,a)}var XP=se({less_:YRe});var ZRe={kernelName:DO,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e;return{a:()=>ze(r,rt(Td(t,n),"float32")),b:()=>ze(r,rt(XP(t,n),"float32"))}}};function JRe(r,e,t,n,a,i,o){let s=Q(r,"dy","maxPool3dGrad"),u=Q(e,"input","maxPool3dGrad"),c=Q(t,"output","maxPool3dGrad"),l=s,f=u,h=c,p=!1;u.rank===4&&(p=!0,l=he(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]]),f=he(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),h=he(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),ae(l.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`),ae(f.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${f.rank}.`),ae(h.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${h.rank}.`),ai("maxPool3dGrad",i,o);let d={dy:l,input:f,output:h},m={filterSize:n,strides:a,pad:i,dimRoundingMode:o},v=ne.runKernel(e3e,d,m);return p?he(v,[v.shape[1],v.shape[2],v.shape[3],v.shape[4]]):v}var QRe=se({maxPool3dGrad_:JRe});var eOe={kernelName:Q_e,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(r,e,t)=>{let[n,a]=e,{filterSize:i,strides:o,pad:s,dimRoundingMode:u}=t;return{x:()=>QRe(r,n,a,i,o,s,u)}}};function tOe(r,e,t,n,a,i,o){let s=Q(r,"dy","maxPoolGrad"),u=Q(e,"input","maxPoolGrad"),c=Q(t,"output","maxPoolGrad");ae(u.rank===s.rank,()=>`Rank of input (${u.rank}) does not match rank of dy (${s.rank})`),ae(s.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${s.rank}.`),ae(u.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${u.rank}.`),ai("maxPoolGrad",i,o);let l={dy:s,input:u,output:c},f={filterSize:n,strides:a,pad:i,dimRoundingMode:o};return ne.runKernel(J_e,l,f)}var rOe=se({maxPoolGrad_:tOe});var nOe={kernelName:_O,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(r,e,t)=>{let[n,a]=e,{filterSize:i,strides:o,pad:s}=t;return{x:()=>rOe(r,n,a,i,o,s)}}};function mf(r,e="float32"){if(bf(r),e==="complex64"){let n=mf(r,"float32"),a=mf(r,"float32");return ac(n,a)}let t=ow(Vi(r),e);return ne.makeTensor(t,r,e)}function Cd(r,e="float32"){if(bf(r),e==="complex64"){let n=Cd(r,"float32"),a=mf(r,"float32");return ac(n,a)}let t=EP(Vi(r),e);return ne.makeTensor(t,r,e)}var aOe={kernelName:FO,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{axis:a}=t,i=xi(a,n.shape),s=sRe(n.shape,i)[1],u=Vi(s);return{x:()=>{let l=n.shape.slice();i.forEach(p=>{l[p]=1});let f=he(r,l);return wr(ze(f,Cd(n.shape,"float32")),u)}}}};var iOe={kernelName:RO,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(r,e,t)=>{let n=t,{axis:a}=n,[i,o]=e,s=xi(a,i.shape),u=jP(r,o,i,s);return{x:()=>u.x()}}};var oOe={kernelName:OO,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e;return{a:()=>ze(r,rt(Nd(t,n),"float32")),b:()=>ze(r,rt(cc(t,n),"float32"))}}};function sOe(r,e,t){let n=Q(r,"x","slice","string_or_numeric");if(n.rank===0)throw new Error("Slicing scalar is not possible");let a={x:n},i={begin:e,size:t};return ne.runKernel(nP,a,i)}var wi=se({slice_:sOe});var uOe={kernelName:PO,inputsToSave:["x"],gradFunc:(r,e,t)=>{let n=e[0],{paddings:a}=t,i=a.map(o=>o[0]);return{x:()=>wi(r,i,n.shape)}}};function cOe(r){let t={x:Q(r,"x","floor","float32")};return ne.runKernel(gO,t)}var YP=se({floor_:cOe});var lOe={kernelName:MO,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e,a=xr(t.shape,n.shape);return{a:()=>{let s=Jr(t.shape,a);return s.length>0?he(xt(r,s),t.shape):r},b:()=>{let s=ze(r,pn(YP(wr(t,n)))),u=Jr(n.shape,a);return u.length>0?he(xt(s,u),n.shape):s}}}};var fOe={kernelName:BO,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e,a=xr(t.shape,n.shape);return{a:()=>{let s=ze(r,rt(n,"float32")),u=Jr(t.shape,a);return u.length>0?he(xt(s,u),t.shape):s},b:()=>{let s=ze(r,rt(t,"float32")),u=Jr(n.shape,a);return u.length>0?he(xt(s,u),n.shape):s}}}};var hOe={kernelName:LO,gradFunc:r=>({x:()=>pn(r)})};var pOe={kernelName:$O,inputsToSave:["indices"],gradFunc:(r,e)=>{let t=e[0];return{indices:()=>mf(t.shape,"float32")}}};var dOe={kernelName:zO,gradFunc:r=>({x:()=>lr(r)})};function vOe(r,e=0){let t=Q(r,"x","unstack","string_or_numeric");ae(e>=-t.shape.length&&e<t.shape.length,()=>`Axis = ${e} is not in [-${t.shape.length}, ${t.shape.length})`);let n={value:t},a={axis:e};return ne.runKernel(yP,n,a)}var ZP=se({unstack_:vOe});var mOe={kernelName:WO,saveAllInputs:!0,gradFunc:(r,e,t)=>{let{axis:n}=t;return ZP(r,n).map(i=>()=>i)}};var AR={kernelName:GO,inputsToSave:["x"],gradFunc:(r,e,t)=>{let n=e[0],{paddings:a}=t,i=a.map(o=>o[0]);return{x:()=>wi(r,i,n.shape)}}};function gOe(r){let t={x:Q(r,"x","log","float32")};return ne.runKernel(NO,t)}var Ad=se({log_:gOe});function yOe(r,e){let t=Q(r,"base","pow"),n=Q(e,"exp","pow");[t,n]=Gr(t,n);let a={a:t,b:n};return ne.runKernel(VO,a)}var Dd=se({pow_:yOe});var bOe={kernelName:VO,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(r,e)=>{let[t,n,a]=e,i=t,o=n,s=xr(i.shape,o.shape);return{a:()=>{let l=rt(o,"float32"),f=ze(r,ze(l,Dd(i,rn(l,Wr(1))))),h=Jr(i.shape,s);return h.length>0&&(f=xt(f,h)),he(f,i.shape)},b:()=>{let l=cc(i,0),f=Ui(l,Ad(i),lr(i)),h=ze(r,ze(a,f)),p=Jr(o.shape,s);return p.length>0&&(h=xt(h,p)),he(h,o.shape)}}}};var wOe={kernelName:UO,inputsToSave:["x","alpha"],gradFunc:(r,e)=>{let[t,n]=e,a=cc(t,0);return{x:()=>Ui(a,r,ze(r,n)),alpha:()=>{let i=Ui(a,lr(r),ze(r,t)),o=Jr(n.shape,r.shape);return o.length>0&&(i=xt(i,o)),he(i,n.shape)}}}};function xOe(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var Sn=Xt();Sn.registerFlag("DEBUG",()=>!1,r=>{r&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});Sn.registerFlag("IS_BROWSER",()=>xOe());Sn.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");Sn.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));Sn.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));Sn.registerFlag("PROD",()=>!1);Sn.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>Sn.getBool("DEBUG"));Sn.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);Sn.registerFlag("IS_TEST",()=>!1);Sn.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>Sn.getBool("DEBUG"));Sn.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);Sn.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);Sn.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);var $s=class r{static join(e){return new r(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,e==null||(e instanceof Array||(e=[e]),e=e.map(n=>Ma(n)?n.buffer:n),e.length===0))return;this.bufferUniformSize=e[0].byteLength;let t=0;for(let n=0;n<e.length;n++){let a=e[n];n!==e.length-1&&a.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);let i=t+a.byteLength;this.shards.push({buffer:a,start:t,end:i}),t=i}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(e=0,t=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,t=isNaN(Number(t))?0:t,e=Math.max(0,e),t=Math.min(this.byteLength,t),t<=e)return new ArrayBuffer(0);let n=this.findShardForByte(e);if(n===-1)throw new Error(`Could not find start shard for byte ${e}`);let a=t-e,i=new ArrayBuffer(a),o=new Uint8Array(i),s=0;for(let u=n;u<this.shards.length;u++){let c=this.shards[u],f=e+s-c.start,h=s,d=Math.min(t,c.end)-c.start,m=new Uint8Array(c.buffer,f,d-f);if(o.set(m,h),s+=m.length,t<c.end)break}return i}findShardForByte(e){if(this.shards.length===0||e<0||e>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function t(a){return e<a.start?-1:e>=a.end?1:0}if(t(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;let n=kOe(this.shards,t);return n===-1?-1:(this.previousShardIndex=n,this.previousShardIndex)}};function kOe(r,e){let t=0,n=r.length;for(;t<=n;){let a=Math.floor((n-t)/2)+t,i=e(r[a]);if(i===0)return a;i<0?n=a:t=a+1}return-1}var vw=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function DR(r){return vw?Buffer.byteLength(r,"utf8"):new Blob([r]).size}function SOe(r){if(vw)return Buffer.from(r).toString("base64");let e=new Uint8Array(r),t="";for(let n=0,a=e.length;n<a;n++)t+=String.fromCharCode(e[n]);return btoa(t)}function EOe(r){if(vw){let n=Buffer.from(r,"base64");return n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength)}let e=atob(r),t=new Uint8Array(e.length);for(let n=0;n<e.length;++n)t.set([e.charCodeAt(n)],n);return t.buffer}function JP(r,e){let t={modelTopology:r.modelTopology,format:r.format,generatedBy:r.generatedBy,convertedBy:r.convertedBy,weightsManifest:e};return r.signature!=null&&(t.signature=r.signature),r.userDefinedMetadata!=null&&(t.userDefinedMetadata=r.userDefinedMetadata),r.modelInitializer!=null&&(t.modelInitializer=r.modelInitializer),r.initializerSignature!=null&&(t.initializerSignature=r.initializerSignature),r.trainingConfig!=null&&(t.trainingConfig=r.trainingConfig),t}function TOe(r,e,t){let n={modelTopology:r.modelTopology,format:r.format,generatedBy:r.generatedBy,convertedBy:r.convertedBy};if(r.trainingConfig!=null&&(n.trainingConfig=r.trainingConfig),r.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!t)throw new Error("modelJSON has weightsManifest but weightData is null");n.weightSpecs=e,n.weightData=t}return r.signature!=null&&(n.signature=r.signature),r.userDefinedMetadata!=null&&(n.userDefinedMetadata=r.userDefinedMetadata),r.modelInitializer!=null&&(n.modelInitializer=r.modelInitializer),r.initializerSignature!=null&&(n.initializerSignature=r.initializerSignature),n}async function NOe(r,e){let t,n;return r.weightsManifest!=null&&([t,n]=await e(r.weightsManifest)),TOe(r,t,n)}function _d(r){if(r.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:r.modelTopology==null?0:DR(JSON.stringify(r.modelTopology)),weightSpecsBytes:r.weightSpecs==null?0:DR(JSON.stringify(r.weightSpecs)),weightDataBytes:r.weightData==null?0:new $s(r.weightData).byteLength}}function _R(r){let e=[];for(let t of r)e.push(...t.weights);return e}var Hi=class r{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return r.instance==null&&(r.instance=new r),r.instance}static registerSaveRouter(e){r.getInstance().saveRouters.push(e)}static registerLoadRouter(e){r.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return r.getHandlers(e,"save")}static getLoadHandlers(e,t){return r.getHandlers(e,"load",t)}static getHandlers(e,t,n){let a=[];return(t==="load"?r.getInstance().loadRouters:r.getInstance().saveRouters).forEach(o=>{let s=o(e,n);s!==null&&a.push(s)}),a}};var IOe="tensorflowjs",COe=1,cf="models_store",dd="model_info_store";function AOe(){if(!Xt().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");let r=typeof window>"u"?self:window,e=r.indexedDB||r.mozIndexedDB||r.webkitIndexedDB||r.msIndexedDB||r.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function DOe(r){let e=r.result;e.createObjectStore(cf,{keyPath:"modelPath"}),e.createObjectStore(dd,{keyPath:"modelPath"})}var ic=class{constructor(e){if(this.indexedDB=AOe(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,t){return new Promise((n,a)=>{let i=this.indexedDB.open(IOe,COe);i.onupgradeneeded=()=>DOe(i),i.onsuccess=()=>{let o=i.result;if(t==null){let s=o.transaction(cf,"readonly"),c=s.objectStore(cf).get(this.modelPath);c.onsuccess=()=>{if(c.result==null)return o.close(),a(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));n(c.result.modelArtifacts)},c.onerror=l=>(o.close(),a(c.error)),s.oncomplete=()=>o.close()}else{t.weightData=$s.join(t.weightData);let s=_d(t),u=o.transaction(dd,"readwrite"),c=u.objectStore(dd),l;try{l=c.put({modelPath:this.modelPath,modelArtifactsInfo:s})}catch(h){return a(h)}let f;l.onsuccess=()=>{f=o.transaction(cf,"readwrite");let h=f.objectStore(cf),p;try{p=h.put({modelPath:this.modelPath,modelArtifacts:t,modelArtifactsInfo:s})}catch(d){return a(d)}p.onsuccess=()=>n({modelArtifactsInfo:s}),p.onerror=d=>{c=u.objectStore(dd);let m=c.delete(this.modelPath);m.onsuccess=()=>(o.close(),a(p.error)),m.onerror=v=>(o.close(),a(p.error))}},l.onerror=h=>(o.close(),a(l.error)),u.oncomplete=()=>{f==null?o.close():f.oncomplete=()=>o.close()}}},i.onerror=o=>a(i.error)})}};ic.URL_SCHEME="indexeddb://";var QP=r=>Xt().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(ic.URL_SCHEME)?_Oe(r.slice(ic.URL_SCHEME.length)):null;Hi.registerSaveRouter(QP);Hi.registerLoadRouter(QP);function _Oe(r){return new ic(r)}var af="/",of="tensorflowjs_models",FOe="info",ROe="model_topology",OOe="weight_specs",POe="weight_data",MOe="model_metadata";function BOe(r){return{info:[of,r,FOe].join(af),topology:[of,r,ROe].join(af),weightSpecs:[of,r,OOe].join(af),weightData:[of,r,POe].join(af),modelMetadata:[of,r,MOe].join(af)}}function LOe(r){for(let e of Object.values(r))window.localStorage.removeItem(e)}var oc=class{constructor(e){if(!Xt().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=BOe(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{let t=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),a=_d(e),i=$s.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,SOe(i));let o={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(o)),{modelArtifactsInfo:a}}catch{throw LOe(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${a.modelTopologyBytes}, weightSpecsBytes=${a.weightSpecsBytes}, weightDataBytes=${a.weightDataBytes}.`)}}}async load(){let e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");let t={},n=JSON.parse(this.LS.getItem(this.keys.topology));if(n==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);t.modelTopology=n;let a=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(a==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);t.weightSpecs=a;let i=this.LS.getItem(this.keys.modelMetadata);if(i!=null){let s=JSON.parse(i);t.format=s.format,t.generatedBy=s.generatedBy,t.convertedBy=s.convertedBy,s.signature!=null&&(t.signature=s.signature),s.userDefinedMetadata!=null&&(t.userDefinedMetadata=s.userDefinedMetadata),s.modelInitializer!=null&&(t.modelInitializer=s.modelInitializer),s.initializerSignature!=null&&(t.initializerSignature=s.initializerSignature),s.trainingConfig!=null&&(t.trainingConfig=s.trainingConfig)}let o=this.LS.getItem(this.keys.weightData);if(o==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return t.weightData=EOe(o),t}};oc.URL_SCHEME="localstorage://";var eM=r=>Xt().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(oc.URL_SCHEME)?zOe(r.slice(oc.URL_SCHEME.length)):null;Hi.registerSaveRouter(eM);Hi.registerLoadRouter(eM);function zOe(r){return new oc(r)}var $Oe="model",WOe=".json",GOe=".weights.bin";function FR(r){return new Promise(e=>setTimeout(e)).then(r)}var sc=class r{constructor(e){if(!Xt().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(r.URL_SCHEME)&&(e=e.slice(r.URL_SCHEME.length)),(e==null||e.length===0)&&(e=$Oe),this.modelJsonFileName=e+WOe,this.weightDataFileName=e+GOe}async save(e){if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");let t=$s.join(e.weightData),n=window.URL.createObjectURL(new Blob([t],{type:"application/octet-stream"}));if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{let a=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],i=JP(e,a),o=window.URL.createObjectURL(new Blob([JSON.stringify(i)],{type:"application/json"})),s=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor;if(s.download=this.modelJsonFileName,s.href=o,await FR(()=>s.dispatchEvent(new MouseEvent("click"))),e.weightData!=null){let u=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor;u.download=this.weightDataFileName,u.href=n,await FR(()=>u.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:_d(e)}}}};sc.URL_SCHEME="downloads://";var VOe=r=>Xt().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(sc.URL_SCHEME)?UOe(r.slice(sc.URL_SCHEME.length)):null;Hi.registerSaveRouter(VOe);function UOe(r="model"){return new sc(r)}function RR(r,e,t,n){o(r),t=t??0,n=n??1,s(t,n);let a=0,i=u=>(u.then(c=>{let l=t+ ++a/r.length*(n-t);return e(l),c}),u);function o(u){ae(u!=null&&Array.isArray(u)&&u.length>0,()=>"promises must be a none empty array")}function s(u,c){ae(u>=0&&u<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${u}`),ae(c>=0&&c<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${c}`),ae(c>=u,()=>`startFraction must be no more than endFraction, but got startFraction ${u} and endFraction ${c}`)}return Promise.all(r.map(i))}async function HOe(r,e){e==null&&(e={});let t=e.fetchFunc==null?Xt().platform.fetch:e.fetchFunc,n=r.map(f=>t(f,e.requestInit,{isBinary:!0})),s=(e.onProgress==null?await Promise.all(n):await RR(n,e.onProgress,0,.5)).map(f=>f.arrayBuffer());return e.onProgress==null?await Promise.all(s):await RR(s,e.onProgress,.5,1)}function qOe(r,e){var t;let n=e.fetchFunc==null?Xt().platform.fetch:e.fetchFunc,a=0,i;return(t=e.onProgress)===null||t===void 0||t.call(e,0),new ReadableStream({pull:async o=>{for(var s;a<r.length;){i||(i=(await n(r[a],e.requestInit,{isBinary:!0})).body.getReader());let{done:u,value:c}=await i.read();if(u){a++,i=void 0,(s=e.onProgress)===null||s===void 0||s.call(e,a/r.length);continue}o.enqueue(c);return}o.close()}})}var KOe="application/octet-stream",jOe="application/json",gf=class{constructor(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.weightUrlConverter=t.weightUrlConverter,t.fetchFunc!=null?(ae(typeof t.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=t.fetchFunc):this.fetch=Xt().platform.fetch,ae(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&ae(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{},this.loadOptions=t}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");let t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);t.body=new FormData;let n=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],a=JP(e,n);if(t.body.append("model.json",new Blob([JSON.stringify(a)],{type:jOe}),"model.json"),e.weightData!=null){let o=$s.join(e.weightData);t.body.append("model.weights.bin",new Blob([o],{type:KOe}),"model.weights.bin")}let i=await this.fetch(this.path,t);if(i.ok)return{modelArtifactsInfo:_d(e),responses:[i]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${i.status}.`)}async loadModelJSON(){let e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let t;try{t=await e.json()}catch{let o=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?o+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":o+=" Please make sure the server is serving valid JSON for this request.",new Error(o)}let n=t.modelTopology,a=t.weightsManifest;if(n==null&&a==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return t}async load(){if(this.loadOptions.streamWeights)return this.loadStream();let e=await this.loadModelJSON();return NOe(e,t=>this.loadWeights(t))}async loadStream(){let e=await this.loadModelJSON(),t=await this.getWeightUrls(e.weightsManifest),n=_R(e.weightsManifest),a=()=>qOe(t,this.loadOptions);return Object.assign(Object.assign({},e),{weightSpecs:n,getWeightStream:a})}async getWeightUrls(e){let t=Array.isArray(this.path)?this.path[1]:this.path,[n,a]=XOe(t),i=this.weightPathPrefix||n,o=[],s=[];for(let u of e)for(let c of u.paths)this.weightUrlConverter!=null?s.push(this.weightUrlConverter(c)):o.push(i+c+a);return this.weightUrlConverter&&o.push(...await Promise.all(s)),o}async loadWeights(e){let t=await this.getWeightUrls(e),n=_R(e),a=await HOe(t,this.loadOptions);return[n,a]}};gf.URL_SCHEME_REGEX=/^https?:\/\//;function XOe(r){let e=r.lastIndexOf("/"),t=r.lastIndexOf("?"),n=r.substring(0,e),a=t>e?r.substring(t):"";return[n+"/",a]}function OR(r){return r.match(gf.URL_SCHEME_REGEX)!=null}var tM=(r,e)=>{if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;{let t=!0;if(Array.isArray(r)?t=r.every(n=>OR(n)):t=OR(r),t)return YOe(r,e)}return null};Hi.registerSaveRouter(tM);Hi.registerLoadRouter(tM);function YOe(r,e){return new gf(r,e)}function ZOe(r,e,t=1,n=0,a="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);let o={indices:Q(r,"indices","oneHot","int32")},s={dtype:a,depth:e,onValue:t,offValue:n};return ne.runKernel($O,o,s)}var JOe=se({oneHot_:ZOe});function QOe(r,e,t){let n=e.rank>1?e.shape[e.rank-1]:1,a=e.rank>1?e.rank-1:1,i=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${t.shape}, indices.shape: ${e.shape}, shape: ${r}, sliceDim: ${n}, and batchDim: ${a}.`;if(t.rank<a)throw new Error(i+` update.rank < ${a}. `);if(r.length<n+(t.rank-a))throw new Error(i+` Output shape length < ${n+(t.rank-a)}`);if(t.rank!==a+r.length-n)throw new Error(i+` update.rank != ${a+r.length-n}`);for(let o=0;o<a;++o)if(t.shape[o]!==e.shape[o])throw new Error(i+` updates.shape[${o}] (${t.shape[o]}) != indices.shape[${o}] (${e.shape[o]}).`);for(let o=0;o<t.rank-a;++o)if(t.shape[o+a]!==r[o+n])throw new Error(i+` updates.shape[${o+a}] (${t.shape[o+a]}) != shape[${o+a}] (${r[o+a]})`)}function ePe(r,e,t){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(r.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${r.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(t.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${t}`);if(t.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(r.size===0)throw new Error(`Updates specified for empty output. updates shape: ${r.shape}`)}QOe(t,e,r)}function tPe(r,e,t){let n,a=r.shape.length;typeof e=="number"?n=[e,...new Array(a-1).fill(0)]:e.length<a?n=e.concat(new Array(a-e.length).fill(0)):n=e.slice(),n.forEach(o=>{ae(o!==-1,()=>"slice() does not support negative begin indexing.")});let i;return t==null?i=new Array(a).fill(-1):typeof t=="number"?i=[t,...new Array(a-1).fill(-1)]:t.length<a?i=t.concat(new Array(a-t.length).fill(-1)):i=t,i=i.map((o,s)=>o>=0?o:(ae(o===-1,()=>`Negative size values should be exactly -1 but got ${o} for the slice() size at index ${s}.`),r.shape[s]-n[s])),[n,i]}var Xb=class{getClassName(){return this.constructor.className}static fromConfig(e,t){return new e(t)}};function rPe(r){let e=Q(r,"x","abs");if(e.dtype==="complex64"){let t={x:e};return ne.runKernel(rO,t)}else{let t={x:e};return ne.runKernel(WR,t)}}var Gi=se({abs_:rPe});function nPe(r){let t={x:Q(r,"x","acos")};return ne.runKernel(GR,t)}var aPe=se({acos_:nPe});function iPe(r){let t={x:Q(r,"x","acosh")};return ne.runKernel(VR,t)}var oPe=se({acosh_:iPe});function sPe(r,e=null,t=!1){let a={x:Q(r,"x","all","bool")},i={axis:e,keepDims:t};return ne.runKernel(x_e,a,i)}var uPe=se({all_:sPe});function cPe(r,e=null,t=!1){let a={x:Q(r,"x","any","bool")},i={axis:e,keepDims:t};return ne.runKernel(k_e,a,i)}var lPe=se({any_:cPe});function fPe(r,e=0){let n={x:Q(r,"x","argMax")},a={axis:e};return ne.runKernel(UR,n,a)}var hPe=se({argMax_:fPe});function pPe(r,e=0){let n={x:Q(r,"x","argMin")},a={axis:e};return ne.runKernel(HR,n,a)}var dPe=se({argMin_:pPe});function vPe(r){let t={x:Q(r,"x","asin")};return ne.runKernel(qR,t)}var mPe=se({asin_:vPe});function gPe(r){let t={x:Q(r,"x","asinh")};return ne.runKernel(KR,t)}var yPe=se({asinh_:gPe});function bPe(r){let t={x:Q(r,"x","atan")};return ne.runKernel(jR,t)}var wPe=se({atan_:bPe});function xPe(r,e){let t=Q(r,"a","atan2"),n=Q(e,"b","atan2");[t,n]=Gr(t,n);let a={a:t,b:n};return ne.runKernel(YR,a)}var kPe=se({atan2_:xPe});function SPe(r){let t={x:Q(r,"x","atanh")};return ne.runKernel(XR,t)}var EPe=se({atanh_:SPe});function TPe(r,e,t,n,a){let i=Q(r,"x","avgPool","float32"),o=1;ae(uc(t,o),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`);let s=i,u=!1;i.rank===3&&(u=!0,s=he(i,[1,i.shape[0],i.shape[1],i.shape[2]])),ae(s.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${s.rank}.`),ai("avgPool",n,a);let c={x:s},l={filterSize:e,strides:t,pad:n,dimRoundingMode:a},f=ne.runKernel(ZR,c,l);return f=rt(f,i.dtype),u?he(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var rM=se({avgPool_:TPe});function NPe(r,e=0){ae(r.length>=1,()=>"Pass at least one tensor to concat");let t=PP(r,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(i=>{if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${i.dtype}. `)}),t.length===1)return LP(t[0]);let n=t,a={axis:e};return ne.runKernel(nO,n,a)}var yf=se({concat_:NPe});function IPe(r){let t={x:Q(r,"x","sigmoid","float32")};return ne.runKernel(sP,t)}var mw=se({sigmoid_:IPe});function CPe(r){let t={x:Q(r,"x","tanh","float32")};return ne.runKernel(gP,t)}var APe=se({tanh_:CPe});function DPe(r,e,t){let n=Q(r,"x","batchToSpaceND"),a=e.reduce((s,u)=>s*u);ae(n.rank>=1+e.length,()=>`input rank is ${n.rank} but should be > than blockShape.length ${e.length}`),ae(t.length===e.length,()=>`crops.length is ${t.length} but should be equal to blockShape.length  ${e.length}`),ae(n.shape[0]%a===0,()=>`input tensor batch is ${n.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${a}`);let i={x:n},o={blockShape:e,crops:t};return ne.runKernel(QR,i,o)}var gw=se({batchToSpaceND_:DPe});function _Pe(r){let e;return r.rank===0||r.rank===1?e=he(r,[1,1,1,r.size]):r.rank===2?e=he(r,[1,1,r.shape[0],r.shape[1]]):r.rank===3?e=he(r,[1,r.shape[0],r.shape[1],r.shape[2]]):e=r,e}function FPe(r,e,t,n,a,i){i==null&&(i=.001);let o=Q(r,"x","batchNorm"),s=Q(e,"mean","batchNorm"),u=Q(t,"variance","batchNorm"),c;a!=null&&(c=Q(a,"scale","batchNorm"));let l;n!=null&&(l=Q(n,"offset","batchNorm")),ae(s.rank===u.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),ae(l==null||s.rank===l.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),ae(c==null||s.rank===c.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let h={x:_Pe(o),scale:c,offset:l,mean:s,variance:u},p={varianceEpsilon:i},d=ne.runKernel(bO,h,p);return he(d,o.shape)}var RPe=se({batchNorm_:FPe});function OPe(r){let t={x:Q(r,"x","ceil","float32")};return ne.runKernel(eO,t)}var PPe=se({ceil_:OPe});function MPe(r,e,t){bf(r),t=t||Sd(e);let n={shape:r,value:e,dtype:t};return ne.runKernel(W_e,{},n)}function BPe(r,e,t){let n=Q(r,"x","clipByValue");if(ae(e<=t,()=>`Error in clip: min (${e}) must be less than or equal to max (${t}).`),e===t)return MPe(n.shape,e,n.dtype);let a={x:n},i={clipValueMin:e,clipValueMax:t};return ne.runKernel(tO,a,i)}var LPe=se({clipByValue_:BPe});function zPe(r,e,t,n,a="NWC",i=1,o){let s=Q(r,"x","conv1d"),u=Q(e,"filter","conv1d"),c=s,l=!1;s.rank===2&&(l=!0,c=he(s,[1,s.shape[0],s.shape[1]])),ae(c.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${c.rank}.`),ae(u.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${u.rank}.`),ai("conv1d",n,o),ae(c.shape[2]===u.shape[1],()=>`Error in conv1d: depth of input (${c.shape[2]}) must match input depth for filter ${u.shape[1]}.`),ae(uc(t,i),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${t} and dilation '${i}'`),ae(yd(i),()=>"Error in conv1D: Dilated rates should be larger than 0."),ae(yd(t),()=>"Error in conv1D: Stride should be larger than 0."),ae(a==="NWC",()=>`Error in conv1d: got dataFormat of ${a} but only NWC is currently supported.`);let f=he(u,[1,u.shape[0],u.shape[1],u.shape[2]]),h=he(c,[c.shape[0],1,c.shape[1],c.shape[2]]),v=Id(h,f,[1,t],n,"NHWC",[1,i],o);return l?he(v,[v.shape[2],v.shape[3]]):he(v,[v.shape[0],v.shape[2],v.shape[3]])}var $Pe=se({conv1d_:zPe});function WPe(r,e,t,n,a,i){let o=Q(r,"x","conv2dTranspose"),s=Q(e,"filter","conv2dTranspose");return $P(t,o,s,n,a,"NHWC",i)}var GPe=se({conv2dTranspose_:WPe});function VPe(r){let t={x:Q(r,"x","cos","float32")};return ne.runKernel(oO,t)}var yw=se({cos_:VPe});function UPe(r){let t={x:Q(r,"x","cosh","float32")};return ne.runKernel(sO,t)}var nM=se({cosh_:UPe});function HPe(r,e=0,t=!1,n=!1){let i={x:Q(r,"x","cumprod")},o={axis:e,exclusive:t,reverse:n};return ne.runKernel(F_e,i,o)}var Yb=se({cumprod_:HPe});function qPe(r,e,t="NHWC"){let n=Q(r,"x","depthToSpace","float32"),a=t==="NHWC"?n.shape[1]:n.shape[2],i=t==="NHWC"?n.shape[2]:n.shape[3],o=t==="NHWC"?n.shape[3]:n.shape[1];ae(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),ae(a*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${a} and ${e}  for depthToSpace with input shape
    ${n.shape}`),ae(i*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${i} and ${e} for depthToSpace with input shape
        ${n.shape}`),ae(o%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${o} for depthToSpace with input shape ${n.shape}`);let s={x:n},u={blockSize:e,dataFormat:t};return ne.runKernel(R_e,s,u)}var KPe=se({depthToSpace_:qPe});function jPe(r,e,t,n,a="NHWC",i=[1,1],o){let s=Q(r,"x","depthwiseConv2d","float32"),u=Q(e,"filter","depthwiseConv2d","float32"),c=s,l=!1;s.rank===3&&(l=!0,c=he(s,[1,s.shape[0],s.shape[1],s.shape[2]])),ae(c.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${c.rank}.`),ae(u.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${u.rank}.`);let f=a==="NHWC"?c.shape[3]:c.shape[1];ae(f===u.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${f}) must match the inChannels dimension in filter ${u.shape[2]}.`),ai("depthwiseConv2d",n,o);let h={x:c,filter:u},p={strides:t,pad:n,dataFormat:a,dilations:i,dimRoundingMode:o},d=ne.runKernel(cO,h,p);return l?he(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var aM=se({depthwiseConv2d_:jPe});function XPe(r,e,t,n,a=[1,1],i="NHWC"){let o=Q(r,"x","dilation2d"),s=Q(e,"filter","dilation2d");ae(o.rank===3||o.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${o.rank}.`),ae(s.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${s.rank}.`),ae(i==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${i}`);let u=o,c=!1;o.rank===3&&(u=he(o,[1,o.shape[0],o.shape[1],o.shape[2]]),c=!0),ae(u.shape[3]===s.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${u.shape[3]} vs ${s.shape[2]}`);let l={x:u,filter:s},f={strides:t,pad:n,dilations:a},h=ne.runKernel(lO,l,f);return c?he(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var YPe=se({dilation2d_:XPe});function ZPe(r,e){let t=Q(r,"a","div"),n=Q(e,"b","div");[t,n]=Gr(t,n);let a=wr(t,n),i=lr(a),o=dw(n,i);return Ui(o,i,a)}var JPe=se({divNoNan_:ZPe});function QPe(r,e){let t=Q(r,"t1","dot"),n=Q(e,"t2","dot");ae((t.rank===1||t.rank===2)&&(n.rank===1||n.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${t.rank} and ${n.rank}.`);let a=t.rank===1?t.size:t.shape[1],i=n.rank===1?n.size:n.shape[0];if(ae(a===i,()=>`Error in dot: inner dimensions of inputs must match, but got ${a} and ${i}.`),t.rank===1&&n.rank===1){let o=he(t,[1,-1]),s=he(n,[-1,1]),u=sa(o,s);return he(u,[])}else if(t.rank===1&&n.rank===2){let o=he(t,[1,-1]),s=he(n,[n.shape[0],n.shape[1]]),u=sa(o,s);return he(u,[u.size])}else if(t.rank===2&&n.rank===1){let o=he(n,[-1,1]),s=sa(t,o);return he(s,[s.size])}else{let o=he(n,[n.shape[0],n.shape[1]]);return sa(t,o)}}var eMe=se({dot_:QPe});function tMe(r){let t={x:Q(r,"x","elu","float32")};return ne.runKernel(hO,t)}var rMe=se({elu_:tMe});function nMe(r){let e=Q(r,"x","erf");ae(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=rt(e,"float32"));let t={x:e};return ne.runKernel(pO,t)}var aMe=se({erf_:nMe});function iMe(r,e=null,t=!1){let a={x:Q(r,"x","max")},i={reductionIndices:e,keepDims:t};return ne.runKernel(AO,a,i)}var rc=se({max_:iMe});function oMe(r,e=null,t=!1){let a={x:Q(r,"x","min")},i={axis:e,keepDims:t};return ne.runKernel(RO,a,i)}var Zb=se({min_:oMe});function sMe(r,e="euclidean",t=null,n=!1){r=Q(r,"x","norm");let a=iM(r,e,t),i=a.shape;if(n){let o=xi(t,r.shape);i=wd(a.shape,o)}return he(a,i)}function iM(r,e,t=null){if(r.rank===0)return Gi(r);if(r.rank!==1&&t===null)return iM(he(r,[-1]),e,t);if(r.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return xt(Gi(r),t);if(e===1/0)return rc(Gi(r),t);if(e===-1/0)return Zb(Gi(r),t);if(e==="euclidean"||e===2)return Co(xt(Dd(Gi(r),Wr(2,"int32")),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(t)&&t.length===2){if(e===1)return rc(xt(Gi(r),t[0]),t[1]-1);if(e===1/0)return rc(xt(Gi(r),t[1]),t[0]);if(e===-1/0)return Zb(xt(Gi(r),t[1]),t[0]);if(e==="fro"||e==="euclidean")return Co(xt(Zr(r),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${t}`)}var oM=se({norm_:sMe});function uMe(r,e=null,t=!1){return oM(r,"euclidean",e,t)}var cMe=se({euclideanNorm_:uMe});function lMe(r,e=0){let t=Q(r,"x","expandDims","string_or_numeric");ae(e<=t.rank,()=>"Axis must be <= rank of the tensor");let n={input:t},a={dim:e};return ne.runKernel(vO,n,a)}var sM=se({expandDims_:lMe});function fMe(r){let t={x:Q(r,"x","expm1")};return ne.runKernel(mO,t)}var hMe=se({expm1_:fMe});function pMe(r,e,t=0,n=0){let a=Q(r,"x","gather"),i=Q(e,"indices","gather","int32"),o={x:a,indices:i},s={axis:t,batchDims:n};return ne.runKernel(wO,o,s)}var uM=se({gather_:pMe});function dMe(r){let t={x:Q(r,"x","isFinite")};return ne.runKernel(kO,t)}var vMe=se({isFinite_:dMe});function mMe(r){let t={x:Q(r,"x","isInf")};return ne.runKernel(SO,t)}var gMe=se({isInf_:mMe});function yMe(r){let t={x:Q(r,"x","isNaN")};return ne.runKernel(EO,t)}var bMe=se({isNaN_:yMe});function wMe(r,e=.2){let n={x:Q(r,"x","leakyRelu")},a={alpha:e};return ne.runKernel(TO,n,a)}var xMe=se({leakyRelu_:wMe});function kMe(r,e=5,t=1,n=1,a=.5){let i=Q(r,"x","localResponseNormalization");ae(i.rank===4||i.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${i.rank}.`),ae(lf(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let o=i,s=!1;i.rank===3&&(s=!0,o=he(i,[1,i.shape[0],i.shape[1],i.shape[2]]));let u={x:o},c={depthRadius:e,bias:t,alpha:n,beta:a},l=ne.runKernel(CO,u,c);return s?he(l,[l.shape[1],l.shape[2],l.shape[3]]):l}var SMe=se({localResponseNormalization_:kMe});function EMe(r){let t={x:Q(r,"x","log1p")};return ne.runKernel(IO,t)}var TMe=se({log1p_:EMe});function NMe(r,e){ae(zb(r),()=>"The f passed in variableGrads(f) must be a function"),ae(e==null||Array.isArray(e)&&e.every(c=>c instanceof nc),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");let t=e!=null;if(!t){e=[];for(let c in ne.registeredVariables)e.push(ne.registeredVariables[c])}let n=t?e.filter(c=>!c.trainable):null,a=e.length;e=e.filter(c=>c.trainable),ae(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${a} variables is trainable.`);let i=!0,{value:o,grads:s}=ne.gradients(r,e,null,i);ae(s.some(c=>c!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),ae(o.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${o.rank} tensor`);let u={};return e.forEach((c,l)=>{s[l]!=null&&(u[c.name]=s[l])}),n?.forEach(c=>u[c.name]=null),{value:o,grads:u}}function cM(r){return ne.customGrad(r)}function IMe(r){let t={x:Q(r,"x","softplus")};return ne.runKernel(uP,t)}var lM=se({softplus_:IMe});function CMe(r){let e=Q(r,"x","logSigmoid");return cM(n=>({value:pn(lM(pn(n))),gradFunc:o=>ze(o,mw(pn(n)))}))(e)}var AMe=se({logSigmoid_:CMe});function DMe(r,e=-1){let t=Q(r,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and axis was ${e}`);return cM((a,i)=>{let s=rc(a,e,!0),u=rn(a,s),c=rn(rt(u,"float32"),Ad(xt(Ao(u),e,!0)));return i([c]),{value:c,gradFunc:(f,h)=>{let[p]=h,d=!0,m=Ao(p);return rn(f,ze(xt(f,e,d),m))}}})(t)}var _Me=se({logSoftmax_:DMe});function FMe(r,e=null,t=!1){let n=Q(r,"x","logSumExp"),a=xi(e,n.shape),i=rc(n,a,!0),o=rn(n,i),s=Ao(o),u=xt(s,a),c=Ad(u),l=Pa(he(i,c.shape),c);if(t){let f=wd(l.shape,a);return he(l,f)}return l}var RMe=se({logSumExp_:FMe});function OMe(r){let t={x:Q(r,"x","logicalNot","bool")};return ne.runKernel(j_e,t)}var bw=se({logicalNot_:OMe});function PMe(r,e){let t=Q(r,"a","logicalOr","bool"),n=Q(e,"b","logicalOr","bool");xr(t.shape,n.shape);let a={a:t,b:n};return ne.runKernel(X_e,a)}var fM=se({logicalOr_:PMe});function MMe(r,e){let t=Q(r,"a","logicalXor","bool"),n=Q(e,"b","logicalXor","bool");return xr(t.shape,n.shape),vf(fM(r,e),bw(vf(r,e)))}var BMe=se({logicalXor_:MMe});function LMe(r,e,t,n,a){let i=Q(r,"x","maxPool"),o=1,s=i,u=!1;i.rank===3&&(u=!0,s=he(i,[1,i.shape[0],i.shape[1],i.shape[2]])),ae(s.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${s.rank}.`),ae(uc(t,o),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`),ai("maxPool",n,a);let c={x:s},l={filterSize:e,strides:t,pad:n,dimRoundingMode:a},f=ne.runKernel(_O,c,l);return u?he(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var hM=se({maxPool_:LMe});function zMe(r,e){let t=Q(r,"a","maximum"),n=Q(e,"b","maximum");[t,n]=Gr(t,n),t.dtype==="bool"&&(t=rt(t,"int32"),n=rt(n,"int32")),xr(t.shape,n.shape);let a={a:t,b:n};return ne.runKernel(DO,a)}var pM=se({maximum_:zMe});function $Me(r,e=null,t=!1){let a={x:Q(r,"x","mean")},i={axis:e,keepDims:t};return ne.runKernel(FO,a,i)}var WMe=se({mean_:$Me});function GMe(r,e){let t=Q(r,"a","minimum"),n=Q(e,"b","minimum");[t,n]=Gr(t,n),t.dtype==="bool"&&(t=rt(t,"int32"),n=rt(n,"int32")),xr(t.shape,n.shape);let a={a:t,b:n};return ne.runKernel(OO,a)}var VMe=se({minimum_:GMe});function UMe(r,e,t){ae(t==="reflect"||t==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${t}.`);let n=Q(r,"x","mirrorPad");if(n.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");ae(e.length===n.rank,()=>`Padding doesn't match input. Must be ${n.rank}. Got ${e.length}.`);let a=t==="reflect"?1:0;for(let s=0;s<n.rank;s++)ae(e[s].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),ae(e[s][0]>=0&&e[s][0]<=n.shape[s]-a&&e[s][1]>=0&&e[s][1]<=n.shape[s]-a,()=>`Padding in dimension ${s} cannot be greater than or equal to ${n.shape[s]-a} or less than 0 for input of shape ${n.shape}`);let i={paddings:e,mode:t},o={x:n};return ne.runKernel(PO,o,i)}var HMe=se({mirrorPad_:UMe});function qMe(r,e){let t=Q(r,"a","mod"),n=Q(e,"b","mod");[t,n]=Gr(t,n);let a={a:t,b:n};return ne.runKernel(MO,a)}var KMe=se({mod_:qMe});function jMe(r,e){let t=Q(r,"a","notEqual","string_or_numeric"),n=Q(e,"b","notEqual","string_or_numeric");[t,n]=Gr(t,n),xr(t.shape,n.shape);let a={a:t,b:n};return ne.runKernel(t3e,a)}var XMe=se({notEqual_:jMe});function YMe(r){let t={x:Q(r,"x","onesLike")};return ne.runKernel(zO,t)}var ZMe=se({onesLike_:YMe});function JMe(r,e,t=0){let n=Q(r,"x","pad");if(n.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");let a={paddings:e,constantValue:t},i={x:n};return ne.runKernel(GO,i,a)}var dM=se({pad_:JMe});function QMe(r,e,t,n,a,i,o){a==null&&(a=[1,1]),i==null&&(i=1),n===0&&(n="valid");let s=Q(r,"x","maxPool"),u=s,c=!1;s.rank===3&&(c=!0,u=he(s,[1,s.shape[0],s.shape[1],s.shape[2]])),ae(uc(i,a),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${i} and dilations '${a}'`);let l=gFe(u.shape,e,i,a,n),f=[l.dilationHeight,l.dilationWidth],h;n==="same"?h=tBe([l.filterHeight,l.filterWidth],f):h=[[0,0],[0,0]];let p=f[0]===1&&f[1]===1,[d,m]=eBe([l.inHeight,l.inWidth],f,h),v=p?n:"valid",g=p?u:lw(u,f,d),w=(t==="avg"?()=>rM(g,e,i,v,o):()=>hM(g,e,i,v,o))(),b=p?w:gw(w,f,m);return c?he(b,[b.shape[1],b.shape[2],b.shape[3]]):b}function eBe(r,e,t){let n=t.map(l=>l[0]),a=t.map(l=>l[1]),i=r.concat(n,a),o=e.map((l,f)=>(l-i[f]%l)%l),s=a.map((l,f)=>l+o[f]),u=e.map((l,f)=>[n[f],s[f]]),c=e.map((l,f)=>[0,o[f]]);return[u,c]}function tBe(r,e){let n=r.map((o,s)=>o+(o-1)*(e[s]-1)).map(o=>o-1),a=n.map(o=>Math.floor(o/2)),i=n.map((o,s)=>o-a[s]);return n.map((o,s)=>[a[s],i[s]])}var rBe=se({pool_:QMe});function nBe(r,e){let t=Q(r,"x","prelu"),n=Q(e,"alpha","prelu"),a={x:t,alpha:n};return ne.runKernel(UO,a)}var aBe=se({prelu_:nBe});function iBe(r,e=null,t=!1){let n=Q(r,"x","prod");n.dtype==="bool"&&(n=rt(n,"int32"));let a={x:n},i={axis:e,keepDims:t};return ne.runKernel(HO,a,i)}var oBe=se({prod_:iBe});var Ws=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ww={exports:{}},l4e=ww.exports;(function(r){(function(e,t,n){function a(u){var c=this,l=s();c.next=function(){var f=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=f-(c.c=f|0)},c.c=1,c.s0=l(" "),c.s1=l(" "),c.s2=l(" "),c.s0-=l(u),c.s0<0&&(c.s0+=1),c.s1-=l(u),c.s1<0&&(c.s1+=1),c.s2-=l(u),c.s2<0&&(c.s2+=1),l=null}function i(u,c){return c.c=u.c,c.s0=u.s0,c.s1=u.s1,c.s2=u.s2,c}function o(u,c){var l=new a(u),f=c&&c.state,h=l.next;return h.int32=function(){return l.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,f&&(typeof f=="object"&&i(f,l),h.state=function(){return i(l,{})}),h}function s(){var u=4022871197,c=function(l){l=String(l);for(var f=0;f<l.length;f++){u+=l.charCodeAt(f);var h=.02519603282416938*u;u=h>>>0,h-=u,h*=u,u=h>>>0,h-=u,u+=h*4294967296}return(u>>>0)*23283064365386963e-26};return c}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.alea=o})(Ws,r,!1)})(ww);var sBe=ww.exports,xw={exports:{}},f4e=xw.exports;(function(r){(function(e,t,n){function a(s){var u=this,c="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var f=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^f^f>>>8},s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor128=o})(Ws,r,!1)})(xw);var uBe=xw.exports,kw={exports:{}},h4e=kw.exports;(function(r){(function(e,t,n){function a(s){var u=this,c="";u.next=function(){var f=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^(f^f<<1))|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,l==c.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorwow=o})(Ws,r,!1)})(kw);var cBe=kw.exports,Sw={exports:{}},p4e=Sw.exports;(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var l=u.x,f=u.i,h,p,d;return h=l[f],h^=h>>>7,p=h^h<<24,h=l[f+1&7],p^=h^h>>>10,h=l[f+3&7],p^=h^h>>>3,h=l[f+4&7],p^=h^h<<7,h=l[f+7&7],h=h^h<<13,p^=h^h<<9,l[f]=p,u.i=f+1&7,p};function c(l,f){var h,p,d=[];if(f===(f|0))p=d[0]=f;else for(f=""+f,h=0;h<f.length;++h)d[h&7]=d[h&7]<<15^f.charCodeAt(h)+d[h+1&7]<<13;for(;d.length<8;)d.push(0);for(h=0;h<8&&d[h]===0;++h);for(h==8?p=d[7]=-1:p=d[h],l.x=d,l.i=0,h=256;h>0;--h)l.next()}c(u,s)}function i(s,u){return u.x=s.x.slice(),u.i=s.i,u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(l.x&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorshift7=o})(Ws,r,!1)})(Sw);var lBe=Sw.exports,Ew={exports:{}},d4e=Ew.exports;(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var l=u.w,f=u.X,h=u.i,p,d;return u.w=l=l+1640531527|0,d=f[h+34&127],p=f[h=h+1&127],d^=d<<13,p^=p<<17,d^=d>>>15,p^=p>>>12,d=f[h]=d^p,u.i=h,d+(l^l>>>16)|0};function c(l,f){var h,p,d,m,v,g=[],y=128;for(f===(f|0)?(p=f,f=null):(f=f+"\0",p=0,y=Math.max(y,f.length)),d=0,m=-32;m<y;++m)f&&(p^=f.charCodeAt((m+32)%f.length)),m===0&&(v=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,m>=0&&(v=v+1640531527|0,h=g[m&127]^=p+v,d=h==0?d+1:0);for(d>=128&&(g[(f&&f.length||0)&127]=-1),d=127,m=512;m>0;--m)p=g[d+34&127],h=g[d=d+1&127],p^=p<<13,h^=h<<17,p^=p>>>15,h^=h>>>12,g[d]=p^h;l.w=v,l.X=g,l.i=d}c(u,s)}function i(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(l.X&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor4096=o})(Ws,r,!1)})(Ew);var fBe=Ew.exports,Tw={exports:{}},v4e=Tw.exports;(function(r){(function(e,t,n){function a(s){var u=this,c="";u.next=function(){var f=u.b,h=u.c,p=u.d,d=u.a;return f=f<<25^f>>>7^h,h=h-p|0,p=p<<24^p>>>8^d,d=d-f|0,u.b=f=f<<20^f>>>12^h,u.c=h=h-p|0,u.d=p<<16^h>>>16^d,u.a=d-f|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=s|0):c+=s;for(var l=0;l<c.length+20;l++)u.b^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.tychei=o})(Ws,r,!1)})(Tw);var hBe=Tw.exports,Nw={exports:{}},m4e=Nw.exports;(function(r){(function(e,t,n){var a=256,i=6,o=52,s="random",u=n.pow(a,i),c=n.pow(2,o),l=c*2,f=a-1,h;function p(b,x,S){var T=[];x=x==!0?{entropy:!0}:x||{};var N=g(v(x.entropy?[b,w(t)]:b??y(),3),T),C=new d(T),R=function(){for(var _=C.g(i),P=u,$=0;_<c;)_=(_+$)*a,P*=a,$=C.g(1);for(;_>=l;)_/=2,P/=2,$>>>=1;return(_+$)/P};return R.int32=function(){return C.g(4)|0},R.quick=function(){return C.g(4)/4294967296},R.double=R,g(w(C.S),t),(x.pass||S||function(_,P,$,z){return z&&(z.S&&m(z,C),_.state=function(){return m(C,{})}),$?(n[s]=_,P):_})(R,N,"global"in x?x.global:this==n,x.state)}function d(b){var x,S=b.length,T=this,N=0,C=T.i=T.j=0,R=T.S=[];for(S||(b=[S++]);N<a;)R[N]=N++;for(N=0;N<a;N++)R[N]=R[C=f&C+b[N%S]+(x=R[N])],R[C]=x;(T.g=function(_){for(var P,$=0,z=T.i,L=T.j,B=T.S;_--;)P=B[z=f&z+1],$=$*a+B[f&(B[z]=B[L=f&L+P])+(B[L]=P)];return T.i=z,T.j=L,$})(a)}function m(b,x){return x.i=b.i,x.j=b.j,x.S=b.S.slice(),x}function v(b,x){var S=[],T=typeof b,N;if(x&&T=="object")for(N in b)try{S.push(v(b[N],x-1))}catch{}return S.length?S:T=="string"?b:b+"\0"}function g(b,x){for(var S=b+"",T,N=0;N<S.length;)x[f&N]=f&(T^=x[f&N]*19)+S.charCodeAt(N++);return w(x)}function y(){try{var b;return h&&(b=h.randomBytes)?b=b(a):(b=new Uint8Array(a),(e.crypto||e.msCrypto).getRandomValues(b)),w(b)}catch{var x=e.navigator,S=x&&x.plugins;return[+new Date,e,S,e.screen,w(t)]}}function w(b){return String.fromCharCode.apply(0,b)}if(g(n.random(),t),r.exports){r.exports=p;try{h=vc("crypto")}catch{}}else n["seed"+s]=p})(typeof self<"u"?self:Ws,[],Math)})(Nw);var pBe=Nw.exports,dBe=sBe,vBe=uBe,mBe=cBe,gBe=lBe,yBe=fBe,bBe=hBe,lc=pBe;lc.alea=dBe;lc.xor128=vBe;lc.xorwow=mBe;lc.xorshift7=gBe;lc.xor4096=yBe;lc.tychei=bBe;function wBe(r){let t={x:Q(r,"x","reciprocal")};return ne.runKernel(qO,t)}var xBe=se({reciprocal_:wBe});function kBe(r){let t={x:Q(r,"x","relu")};return ne.runKernel(KO,t)}var SBe=se({relu_:kBe});function EBe(r){let t={x:Q(r,"x","relu6")};return ne.runKernel(ZO,t)}var TBe=se({relu6_:EBe});function NBe(r,e){let n={x:Q(r,"x","reverse")},a={dims:e};return ne.runKernel(JO,n,a)}var kd=se({reverse_:NBe});function IBe(r){let t={x:Q(r,"x","round")};return ne.runKernel(QO,t)}var CBe=se({round_:IBe});function ABe(r){let t={x:Q(r,"x","selu")};return ne.runKernel(rP,t)}var DBe=se({selu_:ABe});function _Be(r,e,t,n,a,i=[1,1],o="NHWC"){let s=Q(r,"x","separableConv2d"),u=Q(e,"depthwiseFilter","separableConv2d"),c=Q(t,"pointwiseFilter","separableConv2d"),l=s,f=!1;if(s.rank===3&&(f=!0,l=he(s,[1,s.shape[0],s.shape[1],s.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");ae(l.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${l.rank}.`),ae(u.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${u.rank}.`),ae(c.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${u.rank}.`),ae(c.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${c.shape[0]}.`),ae(c.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${c.shape[1]}.`);let h=u.shape[2],p=u.shape[3];ae(c.shape[2]===h*p,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${h*p}, but got ${c.shape[2]}.`);let d=aM(l,u,n,a,o,i),v=Id(d,c,1,"valid",o);return f?he(v,[v.shape[1],v.shape[2],v.shape[3]]):v}var FBe=se({separableConv2d_:_Be});function RBe(r){let t={x:Q(r,"x","sign")};return ne.runKernel(oP,t)}var OBe=se({sign_:RBe});function PBe(r,e=-1){let t=Q(r,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and dim was ${e}`);let n={logits:t},a={dim:e};return ne.runKernel(pP,n,a)}var MBe=se({softmax_:PBe});function BBe(r){ae(r.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${r.dtype}.`);let e={input:r};return ne.runKernel($_e,e)}var vM=se({fft_:BBe});function LBe(r){ae(r.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${r.dtype}.`);let e={input:r};return ne.runKernel(V_e,e)}var Jb=se({ifft_:LBe});function zBe(r){let e=r.shape[r.shape.length-1],t=r.size/e,n;if(e<=2){let a=he(r,[t,e]);n=Jb(a)}else{let a=[t,2*(e-1)],i=he(xd(r),[t,e]),o=he(hw(r),[t,e]),s=kd(wi(i,[0,1],[t,e-2]),1),u=ze(kd(wi(o,[0,1],[t,e-2]),1),Wr(-1)),c=yf([i,s],1),l=yf([o,u],1),f=he(ac(c,l),[a[0],a[1]]);n=Jb(f)}if(n=xd(n),r.rank===3&&r.shape[0]!==0){let a=n,i=r.shape[0];n=he(n,[i,n.shape[0]/i,n.shape[1]]),a.dispose()}return n}var $Be=se({irfft_:zBe});function WBe(r,e){ae(r.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${r.dtype}`);let t=r.shape[r.shape.length-1],n=r.size/t,a;if(e!=null&&e<t){let d=r.shape.map(v=>0),m=r.shape.map(v=>v);m[r.shape.length-1]=e,a=wi(r,d,m),t=e}else if(e!=null&&e>t){let d=r.shape.map(m=>m);d[r.shape.length-1]=e-t,a=yf([r,mf(d)],r.shape.length-1),t=e}else a=r;let i=lr(a),o=he(ac(a,i),[n,t]),s=vM(o),u=Math.floor(t/2)+1,c=xd(s),l=hw(s),f=bd(c,[u,t-u],c.shape.length-1),h=bd(l,[u,t-u],l.shape.length-1),p=a.shape.slice();return p[a.shape.length-1]=u,he(ac(f[0],h[0]),p)}var GBe=se({rfft_:WBe});function VBe(r,e){let t=Q(r,"a","squaredDifference"),n=Q(e,"b","squaredDifference");[t,n]=Gr(t,n),xr(t.shape,n.shape);let a={a:t,b:n},i={};return ne.runKernel(dP,a,i)}var UBe=se({squaredDifference_:VBe});function HBe(r,e){let t=Q(r,"x","squeeze","string_or_numeric");return he(t,p3e(t.shape,e).newShape)}var qBe=se({squeeze_:HBe});function KBe(r,e,t,n,a=0,i=0,o=0,s=0,u=0){let l={x:Q(r,"x","stridedSlice","string_or_numeric")},f={begin:e,end:t,strides:n,beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u};return ne.runKernel(s3e,l,f)}var jBe=se({stridedSlice_:KBe});function XBe(r){let t={x:Q(r,"x","tan","float32")};return ne.runKernel(mP,t)}var YBe=se({tan_:XBe});function ZBe(r,e,t){let n=Q(r,"tensor","tensorScatterupdate"),a=Q(e,"indices","tensorScatterupdate","int32"),i=Q(t,"updates","tensorScatterupdate");if(ePe(i,a,n.shape),n.dtype!==i.dtype)throw new Error(`tensor and updates must have the same dtype, instead they are ${n.dtype} and ${i.dtype}.`);let o={tensor:n,indices:a,updates:i},s={};return ne.runKernel(i3e,o,s)}var g4e=se({tensorScatterUpdate_:ZBe});function JBe(r,e=1,t=!0){let n=Q(r,"x","topk");if(n.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");let a=n.shape[n.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>a)throw new Error(`'k' passed to topk() must be <= the last dimension (${a}) but got ${e}`);let i={x:n},o={k:e,sorted:t},[s,u]=ne.runKernel(u3e,i,o);return{values:s,indices:u}}var QBe=se({topk_:JBe});function eLe(r,e=0){let t=Q(r,"x","unique","string_or_numeric");ae(t.rank>0,()=>"The input tensor must be at least 1D");let n={x:t},a={axis:e},[i,o]=ne.runKernel(c3e,n,a);return{values:i,indices:o}}var tLe=se({unique_:eLe});function rLe(r,e,t=!1,n=!1){let a=Q(r,"images","resizeBilinear");ae(a.rank===3||a.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${a.rank}.`),ae(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),ae(n===!1||t===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let i=a,o=!1;a.rank===3&&(o=!0,i=he(a,[1,a.shape[0],a.shape[1],a.shape[2]]));let[]=e,s={images:i},u={alignCorners:t,halfPixelCenters:n,size:e},c=ne.runKernel(YO,s,u);return o?he(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var nLe=se({resizeBilinear_:rLe});function aLe(r,e,t=!1,n=!1){let a=Q(r,"images","resizeNearestNeighbor");ae(a.rank===3||a.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${a.rank}.`),ae(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),ae(a.dtype==="float32"||a.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),ae(n===!1||t===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let i=a,o=!1;a.rank===3&&(o=!0,i=he(a,[1,a.shape[0],a.shape[1],a.shape[2]]));let[]=e,s={images:i},u={alignCorners:t,halfPixelCenters:n,size:e},c=ne.runKernel(XO,s,u);return o?he(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var iLe=se({resizeNearestNeighbor_:aLe});var PR;(function(r){r[r.NONE=0]="NONE",r[r.MEAN=1]="MEAN",r[r.SUM=2]="SUM",r[r.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(PR||(PR={}));var Qb=class extends Xb{minimize(e,t=!1,n){let{value:a,grads:i}=this.computeGradients(e,n);if(n!=null){let o=n.map(s=>({name:s.name,tensor:i[s.name]}));this.applyGradients(o)}else this.applyGradients(i);return TR(i),t?a:(a.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,t){return NMe(e,t)}dispose(){this.iterations_!=null&&TR(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:Wr(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}};Object.defineProperty(Qb,Symbol.hasInstance,{value:r=>r.minimize!=null&&r.computeGradients!=null&&r.applyGradients!=null});var MR;(function(r){r[r.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",r[r.VALUE_ROWIDS=1]="VALUE_ROWIDS",r[r.ROW_LENGTHS=2]="ROW_LENGTHS",r[r.ROW_SPLITS=3]="ROW_SPLITS",r[r.ROW_LIMITS=4]="ROW_LIMITS",r[r.ROW_STARTS=5]="ROW_STARTS"})(MR||(MR={}));var oLe=1.7580993408473768,sLe=1.0507009873554805;function uLe(r,e,t){let n=r.shape.slice();n[t]=1;let a=he(e,n),i=Yb(r,t,!0,!1),o=Yb(r,t,!0,!0),s=ze(i,o);return ze(a,s)}function cLe(r,e,t){let n=r.shape.length,a=n-t.length,i=VP(t,n),o=r;i!=null&&(o=zs(r,i));let s=o.shape.slice(),c=s.splice(n-t.length,t.length).reduce((h,p)=>h*p,1);s.push(c);let l=o.reshape(s),f=uLe(l,e,a);if(f=f.reshape(o.shape),i!=null){let h=fw(i);f=zs(f,h)}return f}var lLe={kernelName:HO,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{axis:a}=t,i=[];return a==null?i=n.shape.map((o,s)=>s):typeof a=="number"?i=[a]:i=a,{x:()=>cLe(n,r,i)}}};var fLe={kernelName:fO,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e,a=xr(t.shape,n.shape);return{a:()=>{let s=wr(r,rt(n,"float32")),u=Jr(t.shape,a);return u.length>0?he(xt(s,u),t.shape):s},b:()=>{let s=ze(r,rt(t,"float32")),u=Jr(n.shape,a);u.length>0&&(s=he(xt(s,u),n.shape));let c=Zr(n);return pn(wr(s,rt(c,"float32")))}}}};var hLe={kernelName:qO,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>wr(r,pn(Zr(t)))}}};var pLe={kernelName:ZO,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e,n=ze(Nd(t,6),Ed(t));return{x:()=>ze(r,rt(n,"float32"))}}};var dLe={kernelName:KO,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>ze(r,rt(Ed(t),"float32"))}}};var vLe={kernelName:jO,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>he(r,t.shape)}}};var mLe={kernelName:YO,inputsToSave:["images"],gradFunc:(r,e,t)=>{let[n]=e,a={dy:r,images:n};return{images:()=>ne.runKernel(a3e,a,t)}}};var gLe={kernelName:XO,inputsToSave:["images"],gradFunc:(r,e,t)=>{let[n]=e,a={dy:r,images:n};return{images:()=>ne.runKernel(n3e,a,t)}}};var yLe={kernelName:JO,gradFunc:(r,e,t)=>{let{dims:n}=t,a=xi(n,r.shape);return{x:()=>kd(r,a)}}};var bLe={kernelName:QO,gradFunc:r=>({x:()=>lr(r)})};var wLe={kernelName:eP,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>pn(wr(r,ze(Dd(t,1.5),2)))}}};var xLe={kernelName:tP,inputsToSave:["condition"],gradFunc:(r,e)=>{let[t]=e;return{condition:()=>rt(lr(t),"float32"),t:()=>ze(r,rt(t,r.dtype)),e:()=>ze(r,rt(bw(t),r.dtype))}}};var kLe={kernelName:rP,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>{let n=cc(t,Wr(0)),a=Wr(oLe),i=Wr(sLe),o=ze(r,i),s=ze(ze(r,a),Ao(rt(t,"float32")));return Ui(n,o,s)}}}};var SLe={kernelName:sP,outputsToSave:[!0],gradFunc:(r,e)=>{let[t]=e;return{x:()=>ze(r,ze(t,rn(Wr(1),t)))}}};var ELe={kernelName:oP,gradFunc:r=>({x:()=>lr(r)})};var TLe={kernelName:aP,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>ze(yw(rt(t,"float32")),r)}}};var NLe={kernelName:iP,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>ze(nM(rt(t,"float32")),r)}}};var ILe={kernelName:nP,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{begin:a,size:i}=t,o=n.shape,[s,u]=tPe(n,a,i),c=[];for(let l=0;l<r.rank;l++)c.push([s[l],o[l]-s[l]-u[l]]);return{x:()=>dM(r,c)}}};var CLe={kernelName:pP,outputsToSave:[!0],gradFunc:(r,e,t)=>{let[n]=e,{dim:a}=t,i=!0,o=ze(r,n);return{logits:()=>rn(o,ze(xt(o,[a],i),n))}}};var ALe={kernelName:uP,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>ze(r,mw(t))}}};var BR={kernelName:fP,gradFunc:(r,e,t)=>{let{blockShape:n,paddings:a}=t;return{x:()=>gw(r,n,a)}}};var LR={kernelName:hP,gradFunc:(r,e,t)=>{let{axis:n}=t;return{x:()=>yf(r,n)}}};var DLe={kernelName:cP,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>wr(r,ze(Co(rt(t,"float32")),2))}}};var _Le={kernelName:o3e,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>ze(r,ze(rt(t,"float32"),2))}}};var FLe={kernelName:dP,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e,a=Wr(2);return{a:()=>ze(r,ze(a,rn(t,n))),b:()=>ze(r,ze(a,rn(n,t)))}}};var RLe={kernelName:xP,gradFunc:r=>({x:()=>lr(r)})};var OLe={kernelName:vP,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e,a=xr(t.shape,n.shape);return{a:()=>{let s=r,u=Jr(t.shape,a);return u.length>0&&(s=xt(s,u)),he(s,t.shape)},b:()=>{let s=r,u=Jr(n.shape,a);return u.length>0&&(s=xt(s,u)),he(pn(s),n.shape)}}}};var PLe={kernelName:lP,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,a=n.shape.slice(),{axis:i}=t;xi(i,n.shape).forEach(c=>{a[c]=1});let s=he(r,a),u=ze(s,Cd(n.shape,"float32"));return{x:()=>u}}};var MLe={kernelName:mP,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>wr(r,Zr(yw(t)))}}};var BLe={kernelName:gP,outputsToSave:[!0],gradFunc:(r,e)=>{let[t]=e;return{x:()=>ze(rn(Wr(1),Zr(t)),r)}}};var LLe={kernelName:nw,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{reps:a}=t;return{x:()=>{let o=lr(n);if(n.rank===1)for(let s=0;s<a[0];++s)o=Pa(o,wi(r,[s*n.shape[0]],[n.shape[0]]));else if(n.rank===2)for(let s=0;s<a[0];++s)for(let u=0;u<a[1];++u)o=Pa(o,wi(r,[s*n.shape[0],u*n.shape[1]],[n.shape[0],n.shape[1]]));else if(n.rank===3)for(let s=0;s<a[0];++s)for(let u=0;u<a[1];++u)for(let c=0;c<a[2];++c)o=Pa(o,wi(r,[s*n.shape[0],u*n.shape[1],c*n.shape[2]],[n.shape[0],n.shape[1],n.shape[2]]));else if(n.rank===4)for(let s=0;s<a[0];++s)for(let u=0;u<a[1];++u)for(let c=0;c<a[2];++c)for(let l=0;l<a[3];++l)o=Pa(o,wi(r,[s*n.shape[0],u*n.shape[1],c*n.shape[2],l*n.shape[3]],[n.shape[0],n.shape[1],n.shape[2],n.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${n.rank} tensors yet.`);return o}}}};var zLe={kernelName:ld,gradFunc:(r,e,t)=>{let n=t,{perm:a}=n,i=fw(a);return{x:()=>zs(r,i)}}};var $Le={kernelName:yP,gradFunc:(r,e,t)=>{let n=t,{axis:a}=n;return{value:()=>pw(r,a)}}};var WLe={kernelName:bP,inputsToSave:["segmentIds"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>GLe(r,t)}}};function GLe(r,e){let t=pM(e,lr(e)),n=uM(r,t),a=Td(e,Wr(0,"int32")),i=n.rank-a.rank;for(let s=0;s<i;++s)a=sM(a,s+1);a=vf(a,Cd(n.shape,"bool"));let o=lr(n);return Ui(a,n,o)}var VLe={kernelName:wP,gradFunc:r=>({x:()=>lr(r)})};var ULe=[MP,rFe,nFe,oFe,sFe,cFe,lFe,fFe,pFe,dFe,vFe,mFe,EFe,IFe,AFe,_Fe,FFe,RFe,OFe,WFe,GFe,UFe,XFe,KFe,eRe,rRe,aRe,vRe,wRe,xRe,fLe,kRe,ERe,TRe,NRe,IRe,ARe,CRe,FRe,PRe,MRe,BRe,LRe,zRe,$Re,GRe,VRe,URe,HRe,jRe,CR,CR,ZRe,eOe,nOe,aOe,iOe,oOe,uOe,lOe,fOe,hOe,pOe,dOe,mOe,AR,AR,bOe,wOe,lLe,hLe,pLe,dLe,vLe,mLe,gLe,yLe,bLe,wLe,xLe,kLe,SLe,ELe,TLe,NLe,ILe,CLe,ALe,BR,BR,LR,LR,DLe,FLe,_Le,RLe,OLe,PLe,MLe,BLe,LLe,zLe,$Le,WLe,VLe];for(let r of ULe)E3e(r);ue().prototype.abs=function(){return this.throwIfDisposed(),Gi(this)};ue().prototype.acos=function(){return this.throwIfDisposed(),aPe(this)};ue().prototype.acosh=function(){return this.throwIfDisposed(),oPe(this)};ue().prototype.add=function(r){return this.throwIfDisposed(),Pa(this,r)};ue().prototype.all=function(r,e){return this.throwIfDisposed(),uPe(this,r,e)};ue().prototype.any=function(r,e){return this.throwIfDisposed(),lPe(this,r,e)};ue().prototype.argMax=function(r){return this.throwIfDisposed(),hPe(this,r)};ue().prototype.argMin=function(r){return this.throwIfDisposed(),dPe(this,r)};ue().prototype.asScalar=function(){return this.throwIfDisposed(),ae(this.size===1,()=>"The array must have only 1 element."),he(this,[])};ue().prototype.asType=function(r){return this.throwIfDisposed(),rt(this,r)};ue().prototype.as1D=function(){return this.throwIfDisposed(),he(this,[this.size])};ue().prototype.as2D=function(r,e){return this.throwIfDisposed(),he(this,[r,e])};ue().prototype.as3D=function(r,e,t){return this.throwIfDisposed(),he(this,[r,e,t])};ue().prototype.as4D=function(r,e,t,n){return this.throwIfDisposed(),he(this,[r,e,t,n])};ue().prototype.as5D=function(r,e,t,n,a){return this.throwIfDisposed(),he(this,[r,e,t,n,a])};ue().prototype.asin=function(){return this.throwIfDisposed(),mPe(this)};ue().prototype.asinh=function(){return this.throwIfDisposed(),yPe(this)};ue().prototype.atan=function(){return this.throwIfDisposed(),wPe(this)};ue().prototype.atan2=function(r){return this.throwIfDisposed(),kPe(this,r)};ue().prototype.atanh=function(){return this.throwIfDisposed(),EPe(this)};ue().prototype.avgPool=function(r,e,t,n){return this.throwIfDisposed(),rM(this,r,e,t,n)};ue().prototype.batchToSpaceND=function(r,e){return this.throwIfDisposed(),gw(this,r,e)};ue().prototype.batchNorm=function(r,e,t,n,a){return this.throwIfDisposed(),RPe(this,r,e,t,n,a)};ue().prototype.broadcastTo=function(r){return this.throwIfDisposed(),pd(this,r)};ue().prototype.cast=function(r){return this.throwIfDisposed(),rt(this,r)};ue().prototype.ceil=function(){return this.throwIfDisposed(),PPe(this)};ue().prototype.clipByValue=function(r,e){return this.throwIfDisposed(),LPe(this,r,e)};ue().prototype.concat=function(r,e){return this.throwIfDisposed(),r instanceof kn&&(r=[r]),yf([this,...r],e)};ue().prototype.conv1d=function(r,e,t,n,a,i){return this.throwIfDisposed(),$Pe(this,r,e,t,n,a,i)};ue().prototype.conv2dTranspose=function(r,e,t,n,a){return this.throwIfDisposed(),GPe(this,r,e,t,n,a)};ue().prototype.conv2d=function(r,e,t,n,a,i){return this.throwIfDisposed(),Id(this,r,e,t,n,a,i)};ue().prototype.cos=function(){return this.throwIfDisposed(),yw(this)};ue().prototype.cosh=function(){return this.throwIfDisposed(),nM(this)};ue().prototype.cumprod=function(r,e,t){return this.throwIfDisposed(),Yb(this,r,e,t)};ue().prototype.cumsum=function(r,e,t){return this.throwIfDisposed(),UP(this,r,e,t)};ue().prototype.depthToSpace=function(r,e){return this.throwIfDisposed(),KPe(this,r,e)};ue().prototype.depthwiseConv2d=function(r,e,t,n,a,i){return this.throwIfDisposed(),aM(this,r,e,t,n,a,i)};ue().prototype.dilation2d=function(r,e,t,n,a){return this.throwIfDisposed(),YPe(this,r,e,t,n,a)};ue().prototype.divNoNan=function(r){return this.throwIfDisposed(),JPe(this,r)};ue().prototype.div=function(r){return this.throwIfDisposed(),wr(this,r)};ue().prototype.dot=function(r){return this.throwIfDisposed(),eMe(this,r)};ue().prototype.elu=function(){return this.throwIfDisposed(),rMe(this)};ue().prototype.equal=function(r){return this.throwIfDisposed(),dw(this,r)};ue().prototype.erf=function(){return this.throwIfDisposed(),aMe(this)};ue().prototype.euclideanNorm=function(r,e){return this.throwIfDisposed(),cMe(this,r,e)};ue().prototype.exp=function(){return this.throwIfDisposed(),Ao(this)};ue().prototype.expandDims=function(r){return this.throwIfDisposed(),sM(this,r)};ue().prototype.expm1=function(){return this.throwIfDisposed(),hMe(this)};ue().prototype.fft=function(){return this.throwIfDisposed(),vM(this)};ue().prototype.flatten=function(){return this.throwIfDisposed(),he(this,[this.size])};ue().prototype.floor=function(){return this.throwIfDisposed(),YP(this)};ue().prototype.floorDiv=function(r){return this.throwIfDisposed(),BP(this,r)};ue().prototype.gather=function(r,e,t){return this.throwIfDisposed(),uM(this,r,e,t)};ue().prototype.greaterEqual=function(r){return this.throwIfDisposed(),Td(this,r)};ue().prototype.greater=function(r){return this.throwIfDisposed(),cc(this,r)};ue().prototype.ifft=function(){return this.throwIfDisposed(),Jb(this)};ue().prototype.irfft=function(){return this.throwIfDisposed(),$Be(this)};ue().prototype.isFinite=function(){return this.throwIfDisposed(),vMe(this)};ue().prototype.isInf=function(){return this.throwIfDisposed(),gMe(this)};ue().prototype.isNaN=function(){return this.throwIfDisposed(),bMe(this)};ue().prototype.leakyRelu=function(r){return this.throwIfDisposed(),xMe(this,r)};ue().prototype.lessEqual=function(r){return this.throwIfDisposed(),Nd(this,r)};ue().prototype.less=function(r){return this.throwIfDisposed(),XP(this,r)};ue().prototype.localResponseNormalization=function(r,e,t,n){return this.throwIfDisposed(),SMe(this,r,e,t,n)};ue().prototype.logSigmoid=function(){return this.throwIfDisposed(),AMe(this)};ue().prototype.logSoftmax=function(r){return this.throwIfDisposed(),_Me(this,r)};ue().prototype.logSumExp=function(r,e){return this.throwIfDisposed(),RMe(this,r,e)};ue().prototype.log=function(){return this.throwIfDisposed(),Ad(this)};ue().prototype.log1p=function(){return this.throwIfDisposed(),TMe(this)};ue().prototype.logicalAnd=function(r){return this.throwIfDisposed(),vf(this,r)};ue().prototype.logicalNot=function(){return this.throwIfDisposed(),bw(this)};ue().prototype.logicalOr=function(r){return this.throwIfDisposed(),fM(this,r)};ue().prototype.logicalXor=function(r){return this.throwIfDisposed(),BMe(this,r)};ue().prototype.matMul=function(r,e,t){return this.throwIfDisposed(),sa(this,r,e,t)};ue().prototype.maxPool=function(r,e,t,n){return this.throwIfDisposed(),hM(this,r,e,t,n)};ue().prototype.max=function(r,e){return this.throwIfDisposed(),rc(this,r,e)};ue().prototype.maximum=function(r){return this.throwIfDisposed(),pM(this,r)};ue().prototype.mean=function(r,e){return this.throwIfDisposed(),WMe(this,r,e)};ue().prototype.min=function(r,e){return this.throwIfDisposed(),Zb(this,r,e)};ue().prototype.minimum=function(r){return this.throwIfDisposed(),VMe(this,r)};ue().prototype.mirrorPad=function(r,e){return this.throwIfDisposed(),HMe(this,r,e)};ue().prototype.mod=function(r){return this.throwIfDisposed(),KMe(this,r)};ue().prototype.mul=function(r){return this.throwIfDisposed(),ze(this,r)};ue().prototype.neg=function(){return this.throwIfDisposed(),pn(this)};ue().prototype.norm=function(r,e,t){return this.throwIfDisposed(),oM(this,r,e,t)};ue().prototype.notEqual=function(r){return this.throwIfDisposed(),XMe(this,r)};ue().prototype.oneHot=function(r,e=1,t=0){return this.throwIfDisposed(),JOe(this,r,e,t)};ue().prototype.onesLike=function(){return this.throwIfDisposed(),ZMe(this)};ue().prototype.pad=function(r,e){return this.throwIfDisposed(),dM(this,r,e)};ue().prototype.pool=function(r,e,t,n,a,i){return this.throwIfDisposed(),rBe(this,r,e,t,n,a,i)};ue().prototype.pow=function(r){return this.throwIfDisposed(),Dd(this,r)};ue().prototype.prelu=function(r){return this.throwIfDisposed(),aBe(this,r)};ue().prototype.prod=function(r,e){return this.throwIfDisposed(),oBe(this,r,e)};ue().prototype.reciprocal=function(){return this.throwIfDisposed(),xBe(this)};ue().prototype.relu=function(){return this.throwIfDisposed(),SBe(this)};ue().prototype.relu6=function(){return this.throwIfDisposed(),TBe(this)};ue().prototype.reshapeAs=function(r){return this.throwIfDisposed(),he(this,r.shape)};ue().prototype.reshape=function(r){return this.throwIfDisposed(),he(this,r)};ue().prototype.resizeBilinear=function(r,e,t){return this.throwIfDisposed(),nLe(this,r,e,t)};ue().prototype.resizeNearestNeighbor=function(r,e,t){return this.throwIfDisposed(),iLe(this,r,e,t)};ue().prototype.reverse=function(r){return this.throwIfDisposed(),kd(this,r)};ue().prototype.rfft=function(){return this.throwIfDisposed(),GBe(this)};ue().prototype.round=function(){return this.throwIfDisposed(),CBe(this)};ue().prototype.rsqrt=function(){return this.throwIfDisposed(),HP(this)};ue().prototype.selu=function(){return this.throwIfDisposed(),DBe(this)};ue().prototype.separableConv2d=function(r,e,t,n,a,i){return this.throwIfDisposed(),FBe(this,r,e,t,n,a,i)};ue().prototype.sigmoid=function(){return this.throwIfDisposed(),mw(this)};ue().prototype.sign=function(){return this.throwIfDisposed(),OBe(this)};ue().prototype.sin=function(){return this.throwIfDisposed(),WP(this)};ue().prototype.sinh=function(){return this.throwIfDisposed(),GP(this)};ue().prototype.slice=function(r,e){return this.throwIfDisposed(),wi(this,r,e)};ue().prototype.softmax=function(r){return this.throwIfDisposed(),MBe(this,r)};ue().prototype.softplus=function(){return this.throwIfDisposed(),lM(this)};ue().prototype.spaceToBatchND=function(r,e){return this.throwIfDisposed(),lw(this,r,e)};ue().prototype.split=function(r,e){return this.throwIfDisposed(),bd(this,r,e)};ue().prototype.sqrt=function(){return this.throwIfDisposed(),Co(this)};ue().prototype.square=function(){return this.throwIfDisposed(),Zr(this)};ue().prototype.squaredDifference=function(r){return this.throwIfDisposed(),UBe(this,r)};ue().prototype.squeeze=function(r){return this.throwIfDisposed(),qBe(this,r)};ue().prototype.stack=function(r,e){this.throwIfDisposed();let t=r instanceof kn?[this,r]:[this,...r];return pw(t,e)};ue().prototype.step=function(r){return this.throwIfDisposed(),Ed(this,r)};ue().prototype.stridedSlice=function(r,e,t,n,a,i,o,s){return this.throwIfDisposed(),jBe(this,r,e,t,n,a,i,o,s)};ue().prototype.sub=function(r){return this.throwIfDisposed(),rn(this,r)};ue().prototype.sum=function(r,e){return this.throwIfDisposed(),xt(this,r,e)};ue().prototype.tan=function(){return this.throwIfDisposed(),YBe(this)};ue().prototype.tanh=function(){return this.throwIfDisposed(),APe(this)};ue().prototype.tile=function(r){return this.throwIfDisposed(),qP(this,r)};ue().prototype.toBool=function(){return this.throwIfDisposed(),rt(this,"bool")};ue().prototype.toFloat=function(){return this.throwIfDisposed(),rt(this,"float32")};ue().prototype.toInt=function(){return this.throwIfDisposed(),rt(this,"int32")};ue().prototype.topk=function(r,e){return this.throwIfDisposed(),QBe(this,r,e)};ue().prototype.transpose=function(r){return this.throwIfDisposed(),zs(this,r)};ue().prototype.unique=function(r){return this.throwIfDisposed(),tLe(this,r)};ue().prototype.unsortedSegmentSum=function(r,e){return this.throwIfDisposed(),KP(this,r,e)};ue().prototype.unstack=function(r){return this.throwIfDisposed(),ZP(this,r)};ue().prototype.where=function(r,e){return this.throwIfDisposed(),Ui(r,this,e)};ue().prototype.zerosLike=function(){return this.throwIfDisposed(),lr(this)};var HLe="4.22.0";var qLe={"tfjs-core":Fb.version_core,"tfjs-backend-cpu":Pb.version_cpu,"tfjs-backend-webgl":Mb.version_webgl,"tfjs-data":zR.version_data,"tfjs-layers":Rb.version_layers,"tfjs-converter":Ob.version_converter,tfjs:HLe};ua.data=b_e;ua.version=qLe;Object.keys(Fb).forEach(function(r){r!=="default"&&!ua.hasOwnProperty(r)&&Object.defineProperty(ua,r,{enumerable:!0,get:function(){return Fb[r]}})});Object.keys(Rb).forEach(function(r){r!=="default"&&!ua.hasOwnProperty(r)&&Object.defineProperty(ua,r,{enumerable:!0,get:function(){return Rb[r]}})});Object.keys(Ob).forEach(function(r){r!=="default"&&!ua.hasOwnProperty(r)&&Object.defineProperty(ua,r,{enumerable:!0,get:function(){return Ob[r]}})});Object.keys(Pb).forEach(function(r){r!=="default"&&!ua.hasOwnProperty(r)&&Object.defineProperty(ua,r,{enumerable:!0,get:function(){return Pb[r]}})});Object.keys(Mb).forEach(function(r){r!=="default"&&!ua.hasOwnProperty(r)&&Object.defineProperty(ua,r,{enumerable:!0,get:function(){return Mb[r]}})})});return KLe();})();
/*! Bundled license information:

@tensorflow/tfjs-core/dist/tf-core.node.js:
  (**
   * @license
   * Copyright 2024 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2020 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2023 Google LLC.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2017 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2018 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2019 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2020 Google Inc. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2021 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2022 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the 'License');
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an 'AS IS' BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2022 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2022 Google LLC.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (** @license See the LICENSE file. *)

@tensorflow/tfjs-layers/dist/tf-layers.node.js:
  (**
   * @license
   * Copyright 2024 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2018 Google LLC
   *
   * Use of this source code is governed by an MIT-style
   * license that can be found in the LICENSE file or at
   * https://opensource.org/licenses/MIT.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2022 Google LLC
   *
   * Use of this source code is governed by an MIT-style
   * license that can be found in the LICENSE file or at
   * https://opensource.org/licenses/MIT.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2022 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2020 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2023 Google LLC.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2017 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2018 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2020 Google Inc. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2019 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2022 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the 'License');
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an 'AS IS' BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2019 Google LLC
   *
   * Use of this source code is governed by an MIT-style
   * license that can be found in the LICENSE file or at
   * https://opensource.org/licenses/MIT.
   * =============================================================================
   *)
  (** @license See the LICENSE file. *)
  (**
   * @license
   * Copyright 2020 Google LLC
   *
   * Use of this source code is governed by an MIT-style
   * license that can be found in the LICENSE file or at
   * https://opensource.org/licenses/MIT.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2022 CodeSmith LLC
   *
   * Use of this source code is governed by an MIT-style
   * license that can be found in the LICENSE file or at
   * https://opensource.org/licenses/MIT.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2023 CodeSmith LLC
   *
   * Use of this source code is governed by an MIT-style
   * license that can be found in the LICENSE file or at
   * https://opensource.org/licenses/MIT.
   * =============================================================================
   *)

@tensorflow/tfjs-converter/dist/tf-converter.node.js:
  (**
   * @license
   * Copyright 2024 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2021 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2019 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2019 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2023 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2020 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2023 Google LLC.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2017 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2018 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2020 Google Inc. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2022 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the 'License');
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an 'AS IS' BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2022 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2022 Google LLC.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (** @license See the LICENSE file. *)

@tensorflow/tfjs-data/dist/tf-data.node.js:
  (**
   * @license
   * Copyright 2024 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2018 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *
   * =============================================================================
   *)
  (** @license See the LICENSE file. *)

@tensorflow/tfjs-backend-cpu/dist/tf-backend-cpu.node.js:
  (**
   * @license
   * Copyright 2024 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2019 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2020 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the License);
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an AS IS BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2020 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2023 Google LLC.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2022 Google LLC.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2021 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (** @license See the LICENSE file. *)
  (**
   * @license
   * Copyright 2022 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)

@tensorflow/tfjs-backend-webgl/dist/tf-backend-webgl.node.js:
  (**
   * @license
   * Copyright 2024 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2018 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2019 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2020 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the License);
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an AS IS BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2020 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2023 Google LLC.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2022 Google LLC.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2021 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2017 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (** @license See the LICENSE file. *)
  (**
   * @license
   * Copyright 2020 Google Inc. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2022 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)

@tensorflow/tfjs/dist/tf.node.js:
  (**
   * @license
   * Copyright 2024 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2020 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2017 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2018 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2019 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2023 Google LLC.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2021 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2020 Google Inc. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (** @license See the LICENSE file. *)
  (**
   * @license
   * Copyright 2022 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the 'License');
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an 'AS IS' BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2022 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2022 Google LLC.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2021 Google LLC. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * https://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
  (**
   * @license
   * Copyright 2022 Google Inc. All Rights Reserved.
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   * =============================================================================
   *)
*/
