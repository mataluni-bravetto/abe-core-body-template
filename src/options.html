<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>AiGuardian Configuration</title>
    <link rel="stylesheet" href="../assets/brand/Clash Grotesk Font/Fonts/WEB/css/clash-grotesk.css">
    <style>
      body{
        font:14px 'ClashGrotesk-Variable', 'ClashGrotesk', system-ui, sans-serif; 
        margin:0; 
        padding:20px; 
        max-width:800px; 
        background: linear-gradient(135deg, #081C3D 0%, #134390 50%, #1C64D9 100%);
        color: #F9F9F9;
        min-height: 100vh;
      }
      .section{
        margin:24px 0; 
        padding:20px; 
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius:12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      }
      .section h3{margin:0 0 16px; color:#F9F9F9; font-weight:600}
      label{display:block; margin:12px 0 6px; font-weight:500; color:rgba(249, 249, 249, 0.9)}
      input, select, textarea{
        padding:12px 16px; 
        width:100%; 
        max-width:400px; 
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius:8px;
        color: #F9F9F9;
        backdrop-filter: blur(10px);
      }
      input::placeholder, textarea::placeholder{color: rgba(249, 249, 249, 0.6)}
      input[type="checkbox"]{width:auto; margin-right:8px}
      .checkbox-label{display:flex; align-items:center; margin:8px 0; color:rgba(249, 249, 249, 0.9)}
      button{
        padding:12px 20px; 
        background:#33B8FF; 
        color:#081C3D; 
        border:none; 
        border-radius:8px; 
        cursor:pointer; 
        margin:8px 8px 8px 0;
        font-weight:600;
        transition: all 0.2s;
        box-shadow: 0 2px 8px rgba(51, 184, 255, 0.3);
      }
      button:hover{
        background:#1C64D9; 
        color:#F9F9F9;
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(51, 184, 255, 0.4);
      }
      button.secondary{
        background: rgba(255, 255, 255, 0.1);
        color: #F9F9F9;
        border: 1px solid rgba(255, 255, 255, 0.3);
      }
      button.secondary:hover{
        background: rgba(255, 255, 255, 0.2);
        border-color: #33B8FF;
      }
      .status{
        display:inline-block; 
        padding:6px 12px; 
        border-radius:6px; 
        font-size:12px; 
        margin-left:8px;
        font-weight:500;
      }
      .status.connected{
        background: rgba(51, 184, 255, 0.2);
        color: #33B8FF;
        border: 1px solid rgba(51, 184, 255, 0.4);
      }
      .status.disconnected{
        background: rgba(255, 87, 87, 0.2);
        color: #FF5757;
        border: 1px solid rgba(255, 87, 87, 0.4);
      }
      .guard-service{
        margin:12px 0; 
        padding:16px; 
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius:8px;
      }
      .guard-service h4{margin:0 0 12px; color:#F9F9F9}
      .guard-controls{display:flex; align-items:center; gap:12px}
      .test-results{
        margin:16px 0; 
        padding:16px; 
        background: rgba(0, 0, 0, 0.3);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius:8px; 
        font-family:monospace; 
        font-size:12px;
        color: #F9F9F9;
      }
      .hidden{display:none}
    </style>
  </head>
  <body>
    <div style="display: flex; align-items: center; margin-bottom: 24px;">
      <img src="../assets/brand/AiG_Logos/AIG_Logo_Blue.png" alt="AiGuardian Logo" style="width: 48px; height: 48px; margin-right: 16px;">
      <div>
        <h1 style="margin: 0; color: #33B8FF;">AiGuardian Configuration</h1>
        <p style="margin: 4px 0 0 0; color: rgba(249, 249, 249, 0.8); font-size: 14px;">Finally, AI tools for engineers who don't believe the hype</p>
        <p style="margin: 4px 0 0 0; color: rgba(249, 249, 249, 0.6); font-size: 12px;">
          <a href="https://aiguardian.ai" target="_blank" style="color: #33B8FF; text-decoration: none;">üåê Main Website</a>
        </p>
      </div>
    </div>
    
    <!-- Authentication Configuration -->
    <div class="section">
      <h3>üîê Authentication</h3>
      <p style="color: rgba(249, 249, 249, 0.8); font-size: 13px; margin-bottom: 12px;">
        Your Clerk authentication is automatically configured from the backend when available.
        You can also manually configure it below if needed.
        <br><br>
        <strong>Note:</strong> Payment and subscription management is handled through Stripe on the landing page. 
        Users who sign up through the landing page will automatically be recognized here.
      </p>
      <div style="margin-bottom: 12px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
          <label style="margin: 0;">Clerk Publishable Key</label>
          <span id="clerk_key_status" class="status disconnected" style="font-size: 11px;">Manual</span>
        </div>
        <input id="clerk_publishable_key" type="password" placeholder="Auto-configured from backend or enter manually" />
        <p id="clerk_key_info" style="color: rgba(249, 249, 249, 0.6); font-size: 11px; margin: 6px 0 0 0;">
          <span id="clerk_key_source_text">Manually configured</span>
          <br>
          Get your publishable key from <a href="https://dashboard.clerk.com" target="_blank" style="color: #33B8FF; text-decoration: none;">Clerk Dashboard</a>
        </p>
      </div>
    </div>

    <!-- Subscription Information -->
    <div class="section" id="subscriptionSection" style="display: none;">
      <h3>üí≥ Subscription</h3>
      <div class="guard-service">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
          <div>
            <div style="font-size: 18px; font-weight: 700; color: #33B8FF; text-transform: uppercase;" id="subscriptionTier">Free</div>
            <div style="font-size: 12px; color: rgba(249, 249, 249, 0.8); margin-top: 4px;" id="subscriptionStatus">Status: Loading...</div>
          </div>
          <div id="subscriptionStatusBadge" class="status connected" style="font-size: 11px;">Active</div>
        </div>
        <div style="margin: 12px 0;">
          <div style="font-size: 13px; color: rgba(249, 249, 249, 0.9); margin-bottom: 4px;">Usage Statistics</div>
          <div style="font-size: 12px; color: rgba(249, 249, 249, 0.8);" id="subscriptionUsage">Loading...</div>
        </div>
        <div style="display: flex; gap: 8px; margin-top: 12px;">
          <button id="refresh_subscription" class="secondary">üîÑ Refresh</button>
          <button id="manage_subscription" class="secondary">‚öôÔ∏è Manage</button>
          <button id="upgrade_subscription" class="secondary" style="display: none;">‚¨ÜÔ∏è Upgrade</button>
        </div>
      </div>
    </div>

    <!-- Backend Connection Status -->
    <div class="section">
      <h3>üîå Backend Connection</h3>
      <p style="color: rgba(249, 249, 249, 0.8); font-size: 13px; margin-bottom: 12px;">
        Verify that the extension can connect to your backend server.
      </p>
      <div style="margin-bottom: 12px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
          <label style="margin: 0;">Gateway URL</label>
          <span id="connection_status" class="status disconnected" style="font-size: 11px;">Not Tested</span>
        </div>
        <div style="display: flex; gap: 8px; align-items: center;">
          <input id="connection_gateway_url" type="text" placeholder="https://api.aiguardian.ai" style="flex: 1;" />
          <button id="test_connection" class="secondary">üîç Test Connection</button>
        </div>
        <div id="connection_result" style="margin-top: 8px; font-size: 12px; color: rgba(249, 249, 249, 0.7); display: none;"></div>
      </div>
    </div>

    <!-- Backend Integration Testing -->
    <div class="section">
      <h3>üß™ Backend Integration Testing</h3>
      <p style="color: rgba(249, 249, 249, 0.8); font-size: 13px; margin-bottom: 12px;">
        Test your backend API integration, including the division-by-zero fix for performance tests.
      </p>
      <div style="margin-bottom: 12px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
          <label style="margin: 0;">Gateway URL</label>
        </div>
        <input id="test_gateway_url" type="text" placeholder="https://api.aiguardian.ai" value="https://api.aiguardian.ai" />
      </div>
      <div style="margin-bottom: 12px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
          <label style="margin: 0;">API Key (optional)</label>
        </div>
        <input id="test_api_key" type="password" placeholder="Enter API key if required" />
      </div>
      <div style="display: flex; gap: 8px; margin-top: 12px;">
        <button id="run_all_tests" class="secondary">üöÄ Run All Tests</button>
        <button id="run_performance_test" class="secondary">‚ö° Performance Test Only</button>
        <button id="clear_test_results" class="secondary">üóëÔ∏è Clear Results</button>
      </div>
      <div id="test_results" class="test-results hidden" style="margin-top: 16px;">
    </div>

    <!-- Auth Debug Section -->
    <div class="section">
      <h3>üîç Auth Debug</h3>
      <p style="color: rgba(249, 249, 249, 0.8); font-size: 13px; margin-bottom: 12px;">
        Debug authentication state and test sign-up flow.
      </p>
      <div style="margin-bottom: 12px;">
        <button id="check_auth_state" class="secondary">üîç Check Auth State</button>
        <button id="test_sign_up" class="secondary">üöÄ Test Sign Up</button>
        <button id="clear_debug" class="secondary">üóëÔ∏è Clear Debug</button>
      </div>
      <div id="auth_debug_output" style="margin-top: 16px; padding: 12px; background: rgba(0, 0, 0, 0.3); border-radius: 8px; font-family: monospace; font-size: 11px; max-height: 400px; overflow-y: auto; white-space: pre-wrap; display: none;"></div>
        <div id="test_results_content"></div>
      </div>
    </div>


    <script src="logging.js"></script>
    <script src="auth.js"></script>
    <script src="options.js"></script>
    <script src="../tests/integration/backend-integration.test.js"></script>
    <script src="options-testing.js"></script>
  </body>
</html>

